[{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\[lang]\\dictionaries-client.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\[lang]\\dictionaries.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\[lang]\\layout-protected.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\[tenant]\\[lang]\\admin\\advanced-branding\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":14,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":14,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[506,509],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[506,509],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchSettings'. Either include it or remove the dependency array.","line":23,"column":6,"nodeType":"ArrayExpression","endLine":23,"endColumn":20,"suggestions":[{"desc":"Update the dependencies array to be: [fetchSettings, lang, tenant]","fix":{"range":[888,902],"text":"[fetchSettings, lang, tenant]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":43,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":43,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1546,1549],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1546,1549],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":48,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":48,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1706,1709],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1706,1709],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useEffect, useState } from 'react';\r\nimport Navbar from '@/components/Navbar';\r\nimport { useParams } from 'next/navigation';\r\nimport Link from 'next/link';\r\nimport { getDictionaryClient } from '../../dictionaries-client';\r\nimport { ITenantSettings } from '@/models/Tenant';\r\n\r\nexport default function AdvancedBrandingPage() {\r\n  const params = useParams();\r\n  const tenant = params.tenant as string;\r\n  const lang = params.lang as 'en' | 'es';\r\n  const [dict, setDict] = useState<any>(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [saving, setSaving] = useState(false);\r\n  const [settings, setSettings] = useState<ITenantSettings | null>(null);\r\n  const [message, setMessage] = useState<{ type: 'success' | 'error'; text: string } | null>(null);\r\n\r\n  useEffect(() => {\r\n    getDictionaryClient(lang).then(setDict);\r\n    fetchSettings();\r\n  }, [lang, tenant]);\r\n\r\n  const fetchSettings = async () => {\r\n    try {\r\n      setLoading(true);\r\n      const res = await fetch(`/api/tenants/${tenant}/settings`);\r\n      const data = await res.json();\r\n      if (data.success) {\r\n        setSettings(data.data);\r\n      } else {\r\n        setMessage({ type: 'error', text: data.error || 'Failed to load settings' });\r\n      }\r\n    } catch (error) {\r\n      console.error('Error fetching settings:', error);\r\n      setMessage({ type: 'error', text: 'Failed to load settings. Please check your connection.' });\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const updateSetting = (path: string, value: any) => {\r\n    if (!settings) return;\r\n    \r\n    const keys = path.split('.');\r\n    const newSettings = JSON.parse(JSON.stringify(settings));\r\n    let current: any = newSettings;\r\n    \r\n    for (let i = 0; i < keys.length - 1; i++) {\r\n      if (!current[keys[i]]) {\r\n        current[keys[i]] = {};\r\n      }\r\n      current = current[keys[i]];\r\n    }\r\n    \r\n    current[keys[keys.length - 1]] = value;\r\n    setSettings(newSettings);\r\n  };\r\n\r\n  const handleSave = async () => {\r\n    if (!settings) return;\r\n\r\n    try {\r\n      setSaving(true);\r\n      setMessage(null);\r\n      const res = await fetch(`/api/tenants/${tenant}/settings`, {\r\n        method: 'PUT',\r\n        headers: { \r\n          'Content-Type': 'application/json',\r\n        },\r\n        credentials: 'include',\r\n        body: JSON.stringify({ settings }),\r\n      });\r\n\r\n      const data = await res.json();\r\n      if (data.success) {\r\n        setMessage({ type: 'success', text: dict?.admin?.advancedBrandingSaved || 'Advanced branding settings saved successfully!' });\r\n        setSettings(data.data);\r\n        setTimeout(() => setMessage(null), 3000);\r\n      } else {\r\n        if (res.status === 401 || res.status === 403) {\r\n          setMessage({ type: 'error', text: dict?.settings?.unauthorized || 'Unauthorized. Please login with admin account.' });\r\n        } else {\r\n          setMessage({ type: 'error', text: data.error || dict?.admin?.failedToSaveAdvancedBranding || 'Failed to save settings' });\r\n        }\r\n      }\r\n    } catch (error) {\r\n      console.error('Error saving advanced branding settings:', error);\r\n      setMessage({ type: 'error', text: dict?.admin?.failedToSaveAdvancedBrandingConnection || 'Failed to save settings. Please check your connection.' });\r\n    } finally {\r\n      setSaving(false);\r\n    }\r\n  };\r\n\r\n  if (!dict || loading) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gray-50 flex items-center justify-center\">\r\n        <div className=\"text-center\">\r\n          <div className=\"inline-block animate-spin h-8 w-8 border-b-2 border-blue-600\"></div>\r\n          <p className=\"mt-4 text-gray-600\">{dict?.common?.loading || 'Loading...'}</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (!settings) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gray-50\">\r\n        <Navbar />\r\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 sm:py-8\">\r\n          <div className=\"bg-red-50 border-2 border-red-300 p-5 sm:p-6\">\r\n            <h2 className=\"text-xl font-bold text-red-800 mb-2\">{dict?.settings?.failedToLoad || 'Failed to Load Settings'}</h2>\r\n            <p className=\"text-red-700 mb-4\">\r\n              {message?.text || 'Unable to load tenant settings. Please check your connection and try again.'}\r\n            </p>\r\n            <button\r\n              onClick={fetchSettings}\r\n              className=\"px-4 py-2 bg-red-600 text-white hover:bg-red-700 font-medium transition-colors border border-red-700\"\r\n            >\r\n              {dict?.settings?.retry || 'Retry'}\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50\">\r\n      <Navbar />\r\n      <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 sm:py-8\">\r\n        <div className=\"mb-6\">\r\n          <Link\r\n            href={`/${tenant}/${lang}/admin`}\r\n            className=\"text-blue-600 hover:text-blue-700 font-medium mb-4 inline-flex items-center\"\r\n          >\r\n            <svg className=\"w-4 h-4 mr-2\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15 19l-7-7 7-7\" />\r\n            </svg>\r\n            {dict?.common?.back || 'Back'} to Admin\r\n          </Link>\r\n          <h1 className=\"text-2xl sm:text-3xl lg:text-4xl font-bold text-gray-900 mb-2\">\r\n            {dict?.admin?.advancedBranding || 'Advanced Branding'}\r\n          </h1>\r\n          <p className=\"text-gray-600\">\r\n            {dict?.admin?.advancedBrandingDescription || 'Customize fonts, themes, and CSS for advanced branding control'}\r\n          </p>\r\n        </div>\r\n\r\n        {message && (\r\n          <div\r\n            className={`mb-6 p-4 border ${\r\n              message.type === 'success'\r\n                ? 'bg-green-50 text-green-800 border-green-300'\r\n                : 'bg-red-50 text-red-800 border-red-300'\r\n            }`}\r\n          >\r\n            {message.text}\r\n          </div>\r\n        )}\r\n\r\n        <div className=\"bg-white border border-gray-300 p-6 space-y-8\">\r\n          <div>\r\n            <h2 className=\"text-xl font-bold text-gray-900 mb-5\">\r\n              {dict?.settings?.advancedBranding || 'Advanced Branding'}\r\n            </h2>\r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                  {dict?.admin?.fontSource || 'Font Source'}\r\n                </label>\r\n                <select\r\n                  value={settings.advancedBranding?.fontSource || 'system'}\r\n                  onChange={(e) => {\r\n                    const fontSource = e.target.value as 'google' | 'custom' | 'system';\r\n                    updateSetting('advancedBranding', {\r\n                      ...settings.advancedBranding,\r\n                      fontSource,\r\n                    });\r\n                  }}\r\n                  className=\"w-full px-4 py-3 border-2 border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all bg-white\"\r\n                >\r\n                  <option value=\"system\">{dict?.admin?.systemFont || 'System Font'}</option>\r\n                  <option value=\"google\">{dict?.admin?.googleFont || 'Google Font'}</option>\r\n                  <option value=\"custom\">{dict?.admin?.customFont || 'Custom Font'}</option>\r\n                </select>\r\n              </div>\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                  {dict?.admin?.fontFamilyName || 'Font Family Name'}\r\n                </label>\r\n                <input\r\n                  type=\"text\"\r\n                  value={settings.advancedBranding?.fontFamily || ''}\r\n                  onChange={(e) => updateSetting('advancedBranding', {\r\n                    ...settings.advancedBranding,\r\n                    fontFamily: e.target.value,\r\n                  })}\r\n                  className=\"w-full px-4 py-3 border-2 border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all bg-white\"\r\n                  placeholder={dict?.admin?.fontFamilyPlaceholder || 'e.g., Roboto, Inter, Arial'}\r\n                />\r\n              </div>\r\n              {settings.advancedBranding?.fontSource === 'google' && (\r\n                <div className=\"md:col-span-2\">\r\n                  <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                    {dict?.admin?.googleFontURL || 'Google Font URL'}\r\n                  </label>\r\n                  <input\r\n                    type=\"url\"\r\n                    value={settings.advancedBranding?.googleFontUrl || ''}\r\n                    onChange={(e) => updateSetting('advancedBranding', {\r\n                      ...settings.advancedBranding,\r\n                      googleFontUrl: e.target.value,\r\n                    })}\r\n                    className=\"w-full px-4 py-3 border-2 border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all bg-white\"\r\n                    placeholder={dict?.admin?.googleFontURLPlaceholder || 'https://fonts.googleapis.com/css2?family=Roboto'}\r\n                  />\r\n                </div>\r\n              )}\r\n              {settings.advancedBranding?.fontSource === 'custom' && (\r\n                <div className=\"md:col-span-2\">\r\n                  <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                    {dict?.admin?.customFontURL || 'Custom Font URL'}\r\n                  </label>\r\n                  <input\r\n                    type=\"url\"\r\n                    value={settings.advancedBranding?.customFontUrl || ''}\r\n                    onChange={(e) => updateSetting('advancedBranding', {\r\n                      ...settings.advancedBranding,\r\n                      customFontUrl: e.target.value,\r\n                    })}\r\n                    className=\"w-full px-4 py-3 border-2 border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all bg-white\"\r\n                    placeholder={dict?.admin?.customFontURLPlaceholder || 'https://example.com/fonts/custom-font.woff2'}\r\n                  />\r\n                </div>\r\n              )}\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                  {dict?.admin?.theme || 'Theme'}\r\n                </label>\r\n                <select\r\n                  value={settings.advancedBranding?.theme || 'light'}\r\n                  onChange={(e) => updateSetting('advancedBranding', {\r\n                    ...settings.advancedBranding,\r\n                    theme: e.target.value as 'light' | 'dark' | 'auto' | 'custom',\r\n                  })}\r\n                  className=\"w-full px-4 py-3 border-2 border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all bg-white\"\r\n                >\r\n                  <option value=\"light\">{dict?.admin?.light || 'Light'}</option>\r\n                  <option value=\"dark\">{dict?.admin?.dark || 'Dark'}</option>\r\n                  <option value=\"auto\">{dict?.admin?.autoSystem || 'Auto (System)'}</option>\r\n                  <option value=\"custom\">{dict?.admin?.custom || 'Custom'}</option>\r\n                </select>\r\n              </div>\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                  {dict?.admin?.borderRadius || 'Border Radius'}\r\n                </label>\r\n                <select\r\n                  value={settings.advancedBranding?.borderRadius || 'md'}\r\n                  onChange={(e) => updateSetting('advancedBranding', {\r\n                    ...settings.advancedBranding,\r\n                    borderRadius: e.target.value as 'none' | 'sm' | 'md' | 'lg' | 'xl' | 'custom',\r\n                  })}\r\n                  className=\"w-full px-4 py-3 border-2 border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all bg-white\"\r\n                >\r\n                  <option value=\"none\">{dict?.admin?.none || 'None'}</option>\r\n                  <option value=\"sm\">{dict?.admin?.small || 'Small'}</option>\r\n                  <option value=\"md\">{dict?.admin?.medium || 'Medium'}</option>\r\n                  <option value=\"lg\">{dict?.admin?.large || 'Large'}</option>\r\n                  <option value=\"xl\">{dict?.admin?.extraLarge || 'Extra Large'}</option>\r\n                  <option value=\"custom\">{dict?.admin?.custom || 'Custom'}</option>\r\n                </select>\r\n              </div>\r\n              {settings.advancedBranding?.borderRadius === 'custom' && (\r\n                <div>\r\n                  <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                    {dict?.admin?.customBorderRadius || 'Custom Border Radius'}\r\n                  </label>\r\n                  <input\r\n                    type=\"text\"\r\n                    value={settings.advancedBranding?.customBorderRadius || ''}\r\n                    onChange={(e) => updateSetting('advancedBranding', {\r\n                      ...settings.advancedBranding,\r\n                      customBorderRadius: e.target.value,\r\n                    })}\r\n                    className=\"w-full px-4 py-3 border-2 border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all bg-white\"\r\n                    placeholder={dict?.admin?.customBorderRadiusPlaceholder || 'e.g., 8px, 0.5rem, 12px 8px'}\r\n                  />\r\n                </div>\r\n              )}\r\n              {settings.advancedBranding?.theme === 'custom' && (\r\n                <div className=\"md:col-span-2\">\r\n                  <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                    {dict?.admin?.customCSS || 'Custom CSS'}\r\n                  </label>\r\n                  <textarea\r\n                    value={settings.advancedBranding?.customTheme?.css || ''}\r\n                    onChange={(e) => updateSetting('advancedBranding', {\r\n                      ...settings.advancedBranding,\r\n                      customTheme: {\r\n                        ...settings.advancedBranding?.customTheme,\r\n                        css: e.target.value,\r\n                      },\r\n                    })}\r\n                    rows={10}\r\n                    className=\"w-full px-4 py-3 border-2 border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all bg-white font-mono text-sm\"\r\n                    placeholder={dict?.admin?.customCSSPlaceholder || ':root { --primary-color: #2563eb; }'}\r\n                  />\r\n                  <p className=\"mt-2 text-xs text-gray-500\">\r\n                    {dict?.admin?.customCSSHint || 'Add custom CSS variables or styles. Use CSS variables for better theme integration.'}\r\n                  </p>\r\n                </div>\r\n              )}\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"flex justify-end pt-6 mt-8 border-t border-gray-200\">\r\n            <button\r\n              onClick={handleSave}\r\n              disabled={saving}\r\n              className=\"px-6 py-3 bg-blue-600 text-white hover:bg-blue-700 font-semibold transition-all duration-200 border border-blue-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2\"\r\n            >\r\n              {saving ? (\r\n                <>\r\n                  <div className=\"animate-spin h-5 w-5 border-b-2 border-white\"></div>\r\n                  <span>{dict?.common?.saving || 'Saving...'}</span>\r\n                </>\r\n              ) : (\r\n                <>\r\n                  <svg className=\"w-5 h-5\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M5 13l4 4L19 7\" />\r\n                  </svg>\r\n                  <span>{dict?.common?.save || 'Save Settings'}</span>\r\n                </>\r\n              )}\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\[tenant]\\[lang]\\admin\\attendance\\notifications\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'router' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":25,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":25,"endColumn":15},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":29,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":29,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[914,917],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[914,917],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'fetchNotifications' and 'loadDefaultSettings'. Either include them or remove the dependency array.","line":48,"column":6,"nodeType":"ArrayExpression","endLine":48,"endColumn":12,"suggestions":[{"desc":"Update the dependencies array to be: [dict, fetchNotifications, loadDefaultSettings]","fix":{"range":[1704,1710],"text":"[dict, fetchNotifications, loadDefaultSettings]"}}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React, { useEffect, useState } from 'react';\r\nimport Navbar from '@/components/Navbar';\r\nimport { useParams, useRouter } from 'next/navigation';\r\nimport Link from 'next/link';\r\nimport { getDictionaryClient } from '../../../dictionaries-client';\r\n// Removed incorrect dict import\r\n\r\ninterface Notification {\r\n  type: 'missing_clock_out' | 'late_arrival';\r\n  userId: string;\r\n  userName: string;\r\n  userEmail?: string;\r\n  attendanceId: string;\r\n  clockInTime: string;\r\n  hoursSinceClockIn?: string;\r\n  minutesLate?: number;\r\n  expectedTime?: string;\r\n  message: string;\r\n}\r\n\r\nexport default function AttendanceNotificationsPage() {\r\n  const params = useParams();\r\n  const router = useRouter();\r\n  const tenant = params.tenant as string;\r\n  const lang = params.lang as 'en' | 'es';\r\n  const [notifications, setNotifications] = useState<Notification[]>([]);\r\n  const [dict, setDict] = useState<any>(null);\r\n  const [summary, setSummary] = useState<{ total: number; missingClockOut: number; lateArrivals: number } | null>(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [message, setMessage] = useState<{ type: 'success' | 'error'; text: string } | null>(null);\r\n  const [expectedStartTime, setExpectedStartTime] = useState('09:00');\r\n  const [maxHours, setMaxHours] = useState('12');\r\n  const [sending, setSending] = useState(false);\r\n  const [savingSettings, setSavingSettings] = useState(false);\r\n  \r\n  useEffect(() => {\r\n    getDictionaryClient(lang).then((d) => setDict(d));\r\n  }, [lang]);\r\n\r\n  useEffect(() => {\r\n    if (dict) {\r\n      loadDefaultSettings();\r\n      fetchNotifications();\r\n    }\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [dict]);\r\n\r\n  const loadDefaultSettings = async () => {\r\n    try {\r\n      const res = await fetch(`/api/tenants/${tenant}/settings`);\r\n      const data = await res.json();\r\n      if (data.success && data.data.attendanceNotifications) {\r\n        const attSettings = data.data.attendanceNotifications;\r\n        if (attSettings.expectedStartTime) {\r\n          setExpectedStartTime(attSettings.expectedStartTime);\r\n        }\r\n        if (attSettings.maxHoursWithoutClockOut) {\r\n          setMaxHours(String(attSettings.maxHoursWithoutClockOut));\r\n        }\r\n      }\r\n    } catch (error) {\r\n      console.error('Error loading default settings:', error);\r\n      // Continue with defaults if loading fails\r\n    }\r\n  };\r\n\r\n  const handleSaveDefaultSettings = async () => {\r\n    setSavingSettings(true);\r\n    try {\r\n      const res = await fetch(`/api/tenants/${tenant}/settings`, {\r\n        method: 'PUT',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        credentials: 'include',\r\n        body: JSON.stringify({\r\n          settings: {\r\n            attendanceNotifications: {\r\n              enabled: true,\r\n              expectedStartTime,\r\n              maxHoursWithoutClockOut: parseFloat(maxHours),\r\n            },\r\n          },\r\n        }),\r\n      });\r\n      \r\n      const data = await res.json();\r\n      if (data.success) {\r\n        setMessage({ \r\n          type: 'success', \r\n          text: dict && dict.admin?.settingsSaved ? dict.admin.settingsSaved : 'Settings saved as default' \r\n        });\r\n        // Clear message after 3 seconds\r\n        setTimeout(() => setMessage(null), 3000);\r\n      } else {\r\n        setMessage({ type: 'error', text: data.error || (dict && dict.admin?.failedToSaveSettings ? dict.admin.failedToSaveSettings : 'Failed to save settings') });\r\n      }\r\n    } catch (error) {\r\n      console.error('Error saving settings:', error);\r\n      setMessage({ type: 'error', text: dict && dict.admin?.failedToSaveSettings ? dict.admin.failedToSaveSettings : 'Failed to save settings' });\r\n    } finally {\r\n      setSavingSettings(false);\r\n    }\r\n  };\r\n\r\n  const fetchNotifications = async () => {\r\n    setLoading(true);\r\n    try {\r\n      const params = new URLSearchParams();\r\n      params.append('expectedStartTime', expectedStartTime);\r\n      params.append('maxHoursWithoutClockOut', maxHours);\r\n\r\n      const res = await fetch(`/api/attendance/notifications?${params}`, { credentials: 'include' });\r\n      const data = await res.json();\r\n      if (data.success) {\r\n        setNotifications(data.data.notifications || []);\r\n        setSummary(data.data.summary || null);\r\n        setMessage(null);\r\n      } else {\r\n        setMessage({ type: 'error', text: data.error || dict?.common?.failedToFetchNotifications || 'Failed to fetch notifications' });\r\n      }\r\n    } catch (error) {\r\n      console.error('Error fetching notifications:', error);\r\n      setMessage({ type: 'error', text: dict?.common?.failedToFetchNotifications || 'Failed to fetch notifications' });\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleSendEmails = async () => {\r\n    if (notifications.length === 0) {\r\n      setMessage({ type: 'error', text: dict && dict.admin?.noNotificationsToSend ? dict.admin.noNotificationsToSend : 'No notifications to send' });\r\n      return;\r\n    }\r\n\r\n    const notificationsWithEmail = notifications.filter(n => n.userEmail);\r\n    if (notificationsWithEmail.length === 0) {\r\n      setMessage({ type: 'error', text: dict && dict.admin?.noEmailsToSend ? dict.admin.noEmailsToSend : 'No email addresses found for notifications' });\r\n      return;\r\n    }\r\n\r\n    if (!confirm(dict && dict.admin?.confirmSendEmails ? dict.admin.confirmSendEmails.replace('{count}', notificationsWithEmail.length.toString()) : `Send emails to ${notificationsWithEmail.length} recipient(s)?`)) {\r\n      return;\r\n    }\r\n\r\n    setSending(true);\r\n    try {\r\n      const params = new URLSearchParams();\r\n      params.append('expectedStartTime', expectedStartTime);\r\n      params.append('maxHoursWithoutClockOut', maxHours);\r\n\r\n      const res = await fetch(`/api/attendance/notifications?${params}`, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        credentials: 'include',\r\n        body: JSON.stringify({ notifications: notificationsWithEmail }),\r\n      });\r\n      \r\n      const data = await res.json();\r\n      if (data.success) {\r\n        setMessage({ \r\n          type: 'success', \r\n          text: data.message || (dict && dict.admin?.emailsSentSuccessfully ? dict.admin.emailsSentSuccessfully : 'Emails sent successfully') \r\n        });\r\n      } else {\r\n        setMessage({ type: 'error', text: data.error || (dict && dict.admin?.failedToSendEmails ? dict.admin.failedToSendEmails : 'Failed to send emails') });\r\n      }\r\n    } catch (error) {\r\n      console.error('Error sending emails:', error);\r\n      setMessage({ type: 'error', text: dict && dict.admin?.failedToSendEmails ? dict.admin.failedToSendEmails : 'Failed to send emails' });\r\n    } finally {\r\n      setSending(false);\r\n    }\r\n  };\r\n\r\n  if (!dict) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gray-50 flex items-center justify-center\">\r\n        <div className=\"text-center\">\r\n          <div className=\"inline-block animate-spin h-8 w-8 border-b-2 border-blue-600\"></div>\r\n          <p className=\"mt-4 text-gray-600\">Loading...</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50\">\r\n      <Navbar />\r\n      <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 sm:py-8\">\r\n        <div className=\"mb-6 sm:mb-8\">\r\n          <Link\r\n            href={`/${tenant}/${lang}/admin`}\r\n            className=\"inline-flex items-center text-blue-600 hover:text-blue-700 font-medium mb-4 transition-colors\"\r\n          >\r\n            <svg className=\"w-5 h-5 mr-2\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M10 19l-7-7m0 0l7-7m-7 7h18\" />\r\n            </svg>\r\n            {dict?.admin?.backToAdmin || 'Back to Admin'}\r\n          </Link>\r\n          <div className=\"flex items-center justify-between\">\r\n            <div>\r\n              <h1 className=\"text-2xl sm:text-3xl lg:text-4xl font-bold text-gray-900 mb-2\">\r\n                {dict.admin?.attendanceNotifications || 'Attendance Notifications'}\r\n              </h1>\r\n              <p className=\"text-gray-600\">{dict.admin?.attendanceNotificationsDesc || 'View alerts for late arrivals and missing clock-outs'}</p>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {message && (\r\n          <div className={`mb-6 p-4 border ${message.type === 'success' ? 'bg-green-50 text-green-800 border-green-300' : 'bg-red-50 text-red-800 border-red-300'}`}>\r\n            {message.text}\r\n          </div>\r\n        )}\r\n\r\n        {/* Settings */}\r\n        <div className=\"bg-white border border-gray-300 p-6 mb-6\">\r\n          <h2 className=\"text-lg font-bold text-gray-900 mb-4\">{dict.admin?.settings || 'Settings'}</h2>\r\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n            <div>\r\n              <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                {dict.admin?.expectedStartTime || 'Expected Start Time'}\r\n              </label>\r\n              <input\r\n                type=\"time\"\r\n                value={expectedStartTime}\r\n                onChange={(e) => setExpectedStartTime(e.target.value)}\r\n                className=\"w-full px-4 py-2 border border-gray-300 focus:ring-2 focus:ring-blue-500 bg-white\"\r\n              />\r\n            </div>\r\n            <div>\r\n              <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                {dict.admin?.maxHoursWithoutClockOut || 'Max Hours Without Clock Out'}\r\n              </label>\r\n              <input\r\n                type=\"number\"\r\n                step=\"0.5\"\r\n                min=\"1\"\r\n                value={maxHours}\r\n                onChange={(e) => setMaxHours(e.target.value)}\r\n                className=\"w-full px-4 py-2 border border-gray-300 focus:ring-2 focus:ring-blue-500 bg-white\"\r\n              />\r\n            </div>\r\n            <div className=\"flex items-end gap-2\">\r\n              <button\r\n                onClick={handleSaveDefaultSettings}\r\n                disabled={savingSettings}\r\n                className=\"px-4 py-2 border border-gray-300 hover:bg-gray-50 bg-white font-medium disabled:bg-gray-100 disabled:cursor-not-allowed\"\r\n              >\r\n                {savingSettings ? (dict.common?.saving || 'Saving...') : (dict.admin?.saveAsDefault || 'Save as Default')}\r\n              </button>\r\n              <button\r\n                onClick={fetchNotifications}\r\n                className=\"flex-1 px-4 py-2 bg-blue-600 text-white hover:bg-blue-700 font-medium border border-blue-700\"\r\n              >\r\n                {dict.common?.search || 'Refresh'}\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Summary */}\r\n        {summary && (\r\n          <div className=\"mb-6\">\r\n            <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4\">\r\n              <div className=\"bg-white border border-gray-300 p-6\">\r\n                <div className=\"text-sm text-gray-600 mb-1\">{dict.admin?.totalNotifications || 'Total Notifications'}</div>\r\n                <div className=\"text-2xl font-bold text-gray-900\">{summary.total}</div>\r\n              </div>\r\n              <div className=\"bg-red-50 border border-red-200 p-6\">\r\n                <div className=\"text-sm text-red-600 mb-1\">{dict.admin?.missingClockOut || 'Missing Clock Out'}</div>\r\n                <div className=\"text-2xl font-bold text-red-900\">{summary.missingClockOut}</div>\r\n              </div>\r\n              <div className=\"bg-yellow-50 border border-yellow-200 p-6\">\r\n                <div className=\"text-sm text-yellow-600 mb-1\">{dict.admin?.lateArrivals || 'Late Arrivals'}</div>\r\n                <div className=\"text-2xl font-bold text-yellow-900\">{summary.lateArrivals}</div>\r\n              </div>\r\n            </div>\r\n            {notifications.length > 0 && (\r\n              <div className=\"bg-blue-50 border border-blue-200 p-4 rounded-lg flex items-center justify-between\">\r\n                <div>\r\n                  <p className=\"text-sm font-medium text-blue-900\">\r\n                    {dict.admin?.sendEmailNotifications || 'Send email notifications to employees'}\r\n                  </p>\r\n                  <p className=\"text-xs text-blue-700 mt-1\">\r\n                    {notifications.filter(n => n.userEmail).length} {dict.admin?.recipientsWithEmail || 'recipients with email addresses'}\r\n                  </p>\r\n                </div>\r\n                <button\r\n                  onClick={handleSendEmails}\r\n                  disabled={sending || notifications.filter(n => n.userEmail).length === 0}\r\n                  className=\"px-4 py-2 bg-blue-600 text-white hover:bg-blue-700 font-medium border border-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed\"\r\n                >\r\n                  {sending ? (dict.common?.sending || 'Sending...') : (dict.admin?.sendEmails || 'Send Emails')}\r\n                </button>\r\n              </div>\r\n            )}\r\n          </div>\r\n        )}\r\n\r\n        {/* Notifications List */}\r\n        <div className=\"bg-white border border-gray-300 p-6\">\r\n          {loading ? (\r\n            <div className=\"text-center py-8\">\r\n              <div className=\"inline-block animate-spin h-8 w-8 border-b-2 border-blue-600\"></div>\r\n              <p className=\"mt-4 text-gray-600\">{dict.common?.loading || 'Loading...'}</p>\r\n            </div>\r\n          ) : (\r\n            <div className=\"overflow-x-auto\">\r\n              <table className=\"min-w-full divide-y divide-gray-200\">\r\n                <thead className=\"bg-gray-50\">\r\n                  <tr>\r\n                    <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">{dict.admin?.type || 'Type'}</th>\r\n                    <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">{dict.admin?.employee || 'Employee'}</th>\r\n                    <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">{dict.admin?.clockIn || 'Clock In'}</th>\r\n                    <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">{dict.admin?.details || 'Details'}</th>\r\n                    <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">{dict.admin?.message || 'Message'}</th>\r\n                  </tr>\r\n                </thead>\r\n                <tbody className=\"bg-white divide-y divide-gray-200\">\r\n                  {notifications.map((notification) => (\r\n                    <tr key={`${notification.attendanceId}-${notification.type}`}>\r\n                      <td className=\"px-4 py-4 whitespace-nowrap\">\r\n                        <span className={`px-2 py-1 text-xs font-semibold border ${\r\n                          notification.type === 'missing_clock_out'\r\n                            ? 'bg-red-100 text-red-800 border-red-300'\r\n                            : 'bg-yellow-100 text-yellow-800 border-yellow-300'\r\n                        }`}>\r\n                          {notification.type === 'missing_clock_out'\r\n                            ? (dict.admin?.missingClockOut || 'Missing Clock Out')\r\n                            : (dict.admin?.lateArrival || 'Late Arrival')}\r\n                        </span>\r\n                      </td>\r\n                      <td className=\"px-4 py-4 whitespace-nowrap text-sm font-medium text-gray-900\">\r\n                        {notification.userName}\r\n                        {notification.userEmail && (\r\n                          <div className=\"text-xs text-gray-500\">{notification.userEmail}</div>\r\n                        )}\r\n                      </td>\r\n                      <td className=\"px-4 py-4 whitespace-nowrap text-sm text-gray-500\">\r\n                        {new Date(notification.clockInTime).toLocaleString()}\r\n                      </td>\r\n                      <td className=\"px-4 py-4 text-sm text-gray-500\">\r\n                        {notification.type === 'missing_clock_out' && notification.hoursSinceClockIn && (\r\n                          <div>\r\n                            {dict.admin?.hoursSinceClockIn || 'Hours since clock in'}: {notification.hoursSinceClockIn}h\r\n                          </div>\r\n                        )}\r\n                        {notification.type === 'late_arrival' && (\r\n                          <div>\r\n                            <div>{dict.admin?.minutesLate || 'Minutes late'}: {notification.minutesLate}</div>\r\n                            {notification.expectedTime && (\r\n                              <div className=\"text-xs\">\r\n                                {dict.admin?.expectedTime || 'Expected'}: {new Date(notification.expectedTime).toLocaleTimeString()}\r\n                              </div>\r\n                            )}\r\n                          </div>\r\n                        )}\r\n                      </td>\r\n                      <td className=\"px-4 py-4 text-sm text-gray-500\">\r\n                        {notification.message}\r\n                      </td>\r\n                    </tr>\r\n                  ))}\r\n                </tbody>\r\n              </table>\r\n              {notifications.length === 0 && (\r\n                <div className=\"text-center py-8 text-gray-500\">\r\n                  {dict.admin?.noNotifications || 'No notifications found'}\r\n                </div>\r\n              )}\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\[tenant]\\[lang]\\admin\\attendance\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":52,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":52,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1533,1536],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1533,1536],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchAttendances'. Either include it or remove the dependency array.","line":79,"column":6,"nodeType":"ArrayExpression","endLine":79,"endColumn":42,"suggestions":[{"desc":"Update the dependencies array to be: [startDate, endDate, selectedUserId, fetchAttendances]","fix":{"range":[2586,2622],"text":"[startDate, endDate, selectedUserId, fetchAttendances]"}}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchCurrentSessions'. Either include it or remove the dependency array.","line":86,"column":6,"nodeType":"ArrayExpression","endLine":86,"endColumn":13,"suggestions":[{"desc":"Update the dependencies array to be: [fetchCurrentSessions, users]","fix":{"range":[2782,2789],"text":"[fetchCurrentSessions, users]"}}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React, { useEffect, useState } from 'react';\r\nimport Navbar from '@/components/Navbar';\r\nimport { useParams, useRouter } from 'next/navigation';\r\nimport Link from 'next/link';\r\nimport { getDictionaryClient } from '../../dictionaries-client';\r\nimport { arrayToCSV, downloadCSV, downloadExcel, downloadPDF } from '@/lib/export';\r\nimport dynamic from 'next/dynamic';\r\n\r\n// Dynamically import charts to avoid SSR issues\r\nconst AttendanceTrendsCharts = dynamic(() => import('@/components/AttendanceTrendsCharts'), {\r\n  ssr: false,\r\n  loading: () => (\r\n    <div className=\"w-full h-64 flex items-center justify-center\">\r\n      <div className=\"text-center\">\r\n        <div className=\"inline-block animate-spin h-8 w-8 border-b-2 border-blue-600\"></div>\r\n        <p className=\"mt-4 text-gray-600\">Loading chart...</p>\r\n      </div>\r\n    </div>\r\n  ),\r\n});\r\n\r\ninterface Attendance {\r\n  _id: string;\r\n  userId: string | { _id: string; name: string; email: string };\r\n  clockIn: string;\r\n  clockOut?: string;\r\n  breakStart?: string;\r\n  breakEnd?: string;\r\n  totalHours?: number;\r\n  notes?: string;\r\n  location?: {\r\n    latitude?: number;\r\n    longitude?: number;\r\n    address?: string;\r\n  };\r\n  createdAt: string;\r\n}\r\n\r\ninterface User {\r\n  _id: string;\r\n  name: string;\r\n  email: string;\r\n}\r\n\r\nexport default function AttendancePage() {\r\n  const params = useParams();\r\n  const router = useRouter();\r\n  const tenant = params.tenant as string;\r\n  const lang = params.lang as 'en' | 'es';\r\n  const [dict, setDict] = useState<any>(null);\r\n  const [attendances, setAttendances] = useState<Attendance[]>([]);\r\n  const [users, setUsers] = useState<User[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [selectedUserId, setSelectedUserId] = useState<string>('');\r\n  const [startDate, setStartDate] = useState('');\r\n  const [endDate, setEndDate] = useState('');\r\n  const [currentSessions, setCurrentSessions] = useState<Attendance[]>([]);\r\n  const [message, setMessage] = useState<{ type: 'success' | 'error'; text: string } | null>(null);\r\n\r\n  useEffect(() => {\r\n    getDictionaryClient(lang).then(setDict);\r\n    fetchUsers();\r\n    // Set default date range (last 30 days)\r\n    const end = new Date();\r\n    const start = new Date();\r\n    start.setDate(start.getDate() - 30);\r\n    setEndDate(end.toISOString().split('T')[0]);\r\n    setStartDate(start.toISOString().split('T')[0]);\r\n     \r\n  }, [lang, tenant]);\r\n\r\n  useEffect(() => {\r\n    if (startDate && endDate) {\r\n      fetchAttendances();\r\n    }\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [startDate, endDate, selectedUserId]);\r\n\r\n  useEffect(() => {\r\n    if (users.length > 0) {\r\n      fetchCurrentSessions();\r\n    }\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [users]);\r\n\r\n  const fetchUsers = async () => {\r\n    try {\r\n      const res = await fetch('/api/users', { credentials: 'include' });\r\n      const data = await res.json();\r\n      if (data.success) setUsers(data.data);\r\n    } catch (error) {\r\n      console.error('Error fetching users:', error);\r\n    }\r\n  };\r\n\r\n  const fetchAttendances = async () => {\r\n    try {\r\n      setLoading(true);\r\n      const params = new URLSearchParams();\r\n      if (selectedUserId) params.append('userId', selectedUserId);\r\n      if (startDate) params.append('startDate', startDate);\r\n      if (endDate) params.append('endDate', endDate);\r\n      params.append('limit', '100');\r\n\r\n      const res = await fetch(`/api/attendance?${params}`, { credentials: 'include' });\r\n      const data = await res.json();\r\n      if (data.success) {\r\n        setAttendances(data.data);\r\n        setMessage(null);\r\n      } else {\r\n        setMessage({ type: 'error', text: data.error || dict?.admin?.fetchError || 'Failed to fetch attendance records' });\r\n      }\r\n    } catch (error) {\r\n      console.error('Error fetching attendance:', error);\r\n      setMessage({ type: 'error', text: dict?.admin?.fetchError || 'Failed to fetch attendance records' });\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const fetchCurrentSessions = async () => {\r\n    try {\r\n      // Fetch all users and check their current sessions\r\n      const sessions: Attendance[] = [];\r\n      for (const user of users) {\r\n        try {\r\n          const res = await fetch(`/api/attendance/current?userId=${user._id}`, { credentials: 'include' });\r\n          const data = await res.json();\r\n          if (data.success && data.data) {\r\n            sessions.push({ ...data.data, userId: user });\r\n          }\r\n        } catch {\r\n          // Skip if error fetching for this user\r\n        }\r\n      }\r\n      setCurrentSessions(sessions);\r\n    } catch (error) {\r\n      console.error('Error fetching current sessions:', error);\r\n    }\r\n  };\r\n\r\n  const formatHours = (hours?: number) => {\r\n    if (!hours) return '-';\r\n    const h = Math.floor(hours);\r\n    const m = Math.round((hours - h) * 60);\r\n    return `${h}h ${m}m`;\r\n  };\r\n\r\n  const calculateTotalHours = () => {\r\n    return attendances.reduce((total, att) => total + (att.totalHours || 0), 0);\r\n  };\r\n\r\n  const handleExport = (format: 'csv' | 'excel' | 'pdf' = 'csv') => {\r\n    const headers = [\r\n      'Employee',\r\n      'Clock In',\r\n      'Clock Out',\r\n      'Break Start',\r\n      'Break End',\r\n      'Total Hours',\r\n      'Notes',\r\n      'Date',\r\n    ];\r\n    \r\n    const exportData = attendances.map(attendance => {\r\n      const userName = typeof attendance.userId === 'object' \r\n        ? attendance.userId.name \r\n        : users.find(u => u._id === attendance.userId)?.name || 'Unknown';\r\n      const clockIn = new Date(attendance.clockIn);\r\n      const clockOut = attendance.clockOut ? new Date(attendance.clockOut) : null;\r\n      const breakStart = attendance.breakStart ? new Date(attendance.breakStart) : null;\r\n      const breakEnd = attendance.breakEnd ? new Date(attendance.breakEnd) : null;\r\n      \r\n      return {\r\n        Employee: userName,\r\n        'Clock In': clockIn.toLocaleString(),\r\n        'Clock Out': clockOut ? clockOut.toLocaleString() : 'Active',\r\n        'Break Start': breakStart ? breakStart.toLocaleTimeString() : '',\r\n        'Break End': breakEnd ? breakEnd.toLocaleTimeString() : '',\r\n        'Total Hours': attendance.totalHours ? formatHours(attendance.totalHours) : '-',\r\n        Notes: attendance.notes || '',\r\n        Date: clockIn.toLocaleDateString(),\r\n      };\r\n    });\r\n\r\n    const baseFilename = `attendance_export_${startDate || 'all'}_to_${endDate || 'today'}`;\r\n    \r\n    if (format === 'csv') {\r\n      const csv = arrayToCSV(exportData, headers);\r\n      downloadCSV(csv, `${baseFilename}.csv`);\r\n    } else if (format === 'excel') {\r\n      downloadExcel(exportData, headers, baseFilename);\r\n    } else if (format === 'pdf') {\r\n      downloadPDF(exportData, headers, baseFilename, dict.admin?.attendance || 'Attendance Records');\r\n    }\r\n  };\r\n\r\n  if (!dict) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gray-50 flex items-center justify-center\">\r\n        <div className=\"text-center\">\r\n          <div className=\"inline-block animate-spin h-8 w-8 border-b-2 border-blue-600\"></div>\r\n          <p className=\"mt-4 text-gray-600\">Loading...</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50\">\r\n      <Navbar />\r\n      <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 sm:py-8\">\r\n        <div className=\"mb-6 sm:mb-8\">\r\n          <Link\r\n            href={`/${tenant}/${lang}/admin`}\r\n            className=\"inline-flex items-center text-blue-600 hover:text-blue-700 font-medium mb-4 transition-colors\"\r\n          >\r\n            <svg className=\"w-5 h-5 mr-2\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M10 19l-7-7m0 0l7-7m-7 7h18\" />\r\n            </svg>\r\n            {dict?.admin?.backToAdmin || 'Back to Admin'}\r\n          </Link>\r\n          <div className=\"flex items-center justify-between\">\r\n            <div>\r\n              <h1 className=\"text-2xl sm:text-3xl lg:text-4xl font-bold text-gray-900 mb-2\">\r\n                {dict.admin?.attendance || 'Attendance Management'}\r\n              </h1>\r\n              <p className=\"text-gray-600\">{dict.admin?.attendanceDescription || 'View and manage employee attendance records'}</p>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {message && (\r\n          <div className={`mb-6 p-4 border ${message.type === 'success' ? 'bg-green-50 text-green-800 border-green-300' : 'bg-red-50 text-red-800 border-red-300'}`}>\r\n            {message.text}\r\n          </div>\r\n        )}\r\n\r\n        {/* Current Sessions */}\r\n        {currentSessions.length > 0 && (\r\n          <div className=\"mb-6 bg-blue-50 border-2 border-blue-300 p-6\">\r\n            <h2 className=\"text-lg font-bold text-blue-900 mb-4\">\r\n              {dict.admin?.currentlyClockedIn || 'Currently Clocked In'}\r\n            </h2>\r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\r\n              {currentSessions.map((session) => {\r\n                const userName = typeof session.userId === 'object' ? session.userId.name : users.find(u => u._id === session.userId)?.name || 'Unknown';\r\n                const clockInTime = new Date(session.clockIn);\r\n                const now = new Date();\r\n                const hours = (now.getTime() - clockInTime.getTime()) / (1000 * 60 * 60);\r\n                \r\n                return (\r\n                  <div key={session._id} className=\"bg-white border border-blue-300 p-4\">\r\n                    <div className=\"font-semibold text-gray-900\">{userName}</div>\r\n                    <div className=\"text-sm text-gray-600 mt-1\">\r\n                      {dict.admin?.clockedInAt || 'Clocked in'}: {clockInTime.toLocaleString()}\r\n                    </div>\r\n                    <div className=\"text-sm font-medium text-blue-600 mt-2\">\r\n                      {dict.admin?.currentHours || 'Current hours'}: {hours.toFixed(2)}h\r\n                    </div>\r\n                  </div>\r\n                );\r\n              })}\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {/* Attendance Notifications */}\r\n        <div className=\"bg-white border border-yellow-300 p-6 mb-6\">\r\n          <div className=\"flex justify-between items-center\">\r\n            <div>\r\n              <h2 className=\"text-lg font-bold text-gray-900 mb-1\">{dict.admin?.attendanceNotifications || 'Attendance Notifications'}</h2>\r\n              <p className=\"text-sm text-gray-600\">\r\n                {dict.admin?.attendanceNotificationsDesc || 'View alerts for late arrivals and missing clock-outs'}\r\n              </p>\r\n            </div>\r\n            <button\r\n              onClick={() => router.push(`/${tenant}/${lang}/admin/attendance/notifications`)}\r\n              className=\"px-4 py-2 border border-gray-300 hover:bg-gray-50 bg-white\"\r\n            >\r\n              {dict.admin?.viewNotifications || 'View Notifications'}\r\n            </button>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Filters */}\r\n        <div className=\"bg-white border border-gray-300 p-6 mb-6\">\r\n          <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\r\n            <div>\r\n              <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                {dict.admin?.employee || 'Employee'}\r\n              </label>\r\n              <select\r\n                value={selectedUserId}\r\n                onChange={(e) => setSelectedUserId(e.target.value)}\r\n                className=\"w-full px-4 py-2 border border-gray-300 focus:ring-2 focus:ring-blue-500 bg-white\"\r\n              >\r\n                <option value=\"\">{dict.common?.all || 'All Employees'}</option>\r\n                {users.map((user) => (\r\n                  <option key={user._id} value={user._id}>\r\n                    {user.name} ({user.email})\r\n                  </option>\r\n                ))}\r\n              </select>\r\n            </div>\r\n            <div>\r\n              <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                {dict.reports?.startDate || 'Start Date'}\r\n              </label>\r\n              <input\r\n                type=\"date\"\r\n                value={startDate}\r\n                onChange={(e) => setStartDate(e.target.value)}\r\n                className=\"w-full px-4 py-2 border border-gray-300 focus:ring-2 focus:ring-blue-500 bg-white\"\r\n              />\r\n            </div>\r\n            <div>\r\n              <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                {dict.reports?.endDate || 'End Date'}\r\n              </label>\r\n              <input\r\n                type=\"date\"\r\n                value={endDate}\r\n                onChange={(e) => setEndDate(e.target.value)}\r\n                className=\"w-full px-4 py-2 border border-gray-300 focus:ring-2 focus:ring-blue-500 bg-white\"\r\n              />\r\n            </div>\r\n            <div className=\"flex items-end gap-2\">\r\n              <div className=\"relative group\">\r\n                <button\r\n                  onClick={() => handleExport('csv')}\r\n                  className=\"px-4 py-2 border border-gray-300 hover:bg-gray-50 bg-white font-medium\"\r\n                >\r\n                  {dict.admin?.export || 'Export'} \r\n                </button>\r\n                <div className=\"absolute right-0 mt-1 w-48 bg-white border border-gray-300 shadow-lg hidden group-hover:block z-10\">\r\n                  <button\r\n                    onClick={() => handleExport('csv')}\r\n                    className=\"block w-full text-left px-4 py-2 hover:bg-gray-100 text-sm\"\r\n                  >\r\n                    {dict.admin?.exportCSV || 'Export CSV'}\r\n                  </button>\r\n                  <button\r\n                    onClick={() => handleExport('excel')}\r\n                    className=\"block w-full text-left px-4 py-2 hover:bg-gray-100 text-sm\"\r\n                  >\r\n                    {dict.admin?.exportExcel || 'Export Excel'}\r\n                  </button>\r\n                  <button\r\n                    onClick={() => handleExport('pdf')}\r\n                    className=\"block w-full text-left px-4 py-2 hover:bg-gray-100 text-sm\"\r\n                  >\r\n                    {dict.admin?.exportPDF || 'Export PDF'}\r\n                  </button>\r\n                </div>\r\n              </div>\r\n              <button\r\n                onClick={fetchAttendances}\r\n                className=\"w-full px-4 py-2 bg-blue-600 text-white hover:bg-blue-700 font-medium border border-blue-700\"\r\n              >\r\n                {dict.common?.search || 'Search'}\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Statistics */}\r\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6\">\r\n          <div className=\"bg-white border border-gray-300 p-6\">\r\n            <div className=\"text-sm text-gray-600 mb-1\">{dict.admin?.totalRecords || 'Total Records'}</div>\r\n            <div className=\"text-2xl font-bold text-gray-900\">{attendances.length}</div>\r\n          </div>\r\n          <div className=\"bg-white border border-gray-300 p-6\">\r\n            <div className=\"text-sm text-gray-600 mb-1\">{dict.admin?.totalHours || 'Total Hours'}</div>\r\n            <div className=\"text-2xl font-bold text-gray-900\">{formatHours(calculateTotalHours())}</div>\r\n          </div>\r\n          <div className=\"bg-white border border-gray-300 p-6\">\r\n            <div className=\"text-sm text-gray-600 mb-1\">{dict.admin?.averageHours || 'Average Hours/Record'}</div>\r\n            <div className=\"text-2xl font-bold text-gray-900\">\r\n              {attendances.length > 0 ? formatHours(calculateTotalHours() / attendances.length) : '-'}\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Attendance Trends Charts */}\r\n        {attendances.length > 0 && (\r\n          <div className=\"bg-white border border-gray-300 p-6 mb-6\">\r\n            <h2 className=\"text-xl font-bold text-gray-900 mb-4\">\r\n              {dict.admin?.attendanceTrends || 'Attendance Trends'}\r\n            </h2>\r\n            <AttendanceTrendsCharts attendances={attendances} dict={dict} />\r\n          </div>\r\n        )}\r\n\r\n        {/* Attendance Table */}\r\n        <div className=\"bg-white border border-gray-300 p-6\">\r\n          {loading ? (\r\n            <div className=\"text-center py-8\">\r\n              <div className=\"inline-block animate-spin h-8 w-8 border-b-2 border-blue-600\"></div>\r\n              <p className=\"mt-4 text-gray-600\">{dict.common?.loading || 'Loading...'}</p>\r\n            </div>\r\n          ) : (\r\n            <div className=\"overflow-x-auto\">\r\n              <table className=\"min-w-full divide-y divide-gray-200\">\r\n                <thead className=\"bg-gray-50\">\r\n                  <tr>\r\n                    <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">{dict.admin?.employee || 'Employee'}</th>\r\n                    <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">{dict.admin?.clockIn || 'Clock In'}</th>\r\n                    <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">{dict.admin?.clockOut || 'Clock Out'}</th>\r\n                    <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">{dict.admin?.break || 'Break'}</th>\r\n                    <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">{dict.admin?.totalHours || 'Total Hours'}</th>\r\n                    <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">{dict.admin?.notes || 'Notes'}</th>\r\n                  </tr>\r\n                </thead>\r\n                <tbody className=\"bg-white divide-y divide-gray-200\">\r\n                  {attendances.map((attendance) => {\r\n                    const userName = typeof attendance.userId === 'object' \r\n                      ? attendance.userId.name \r\n                      : users.find(u => u._id === attendance.userId)?.name || 'Unknown';\r\n                    const clockIn = new Date(attendance.clockIn);\r\n                    const clockOut = attendance.clockOut ? new Date(attendance.clockOut) : null;\r\n                    const breakStart = attendance.breakStart ? new Date(attendance.breakStart) : null;\r\n                    const breakEnd = attendance.breakEnd ? new Date(attendance.breakEnd) : null;\r\n\r\n                    return (\r\n                      <tr key={attendance._id}>\r\n                        <td className=\"px-4 py-4 whitespace-nowrap text-sm font-medium text-gray-900\">\r\n                          {userName}\r\n                        </td>\r\n                        <td className=\"px-4 py-4 whitespace-nowrap text-sm text-gray-500\">\r\n                          {clockIn.toLocaleString()}\r\n                        </td>\r\n                        <td className=\"px-4 py-4 whitespace-nowrap text-sm text-gray-500\">\r\n                          {clockOut ? clockOut.toLocaleString() : (\r\n                            <span className=\"text-green-600 font-semibold\">{dict.admin?.active || 'Active'}</span>\r\n                          )}\r\n                        </td>\r\n                        <td className=\"px-4 py-4 whitespace-nowrap text-sm text-gray-500\">\r\n                          {breakStart && breakEnd ? (\r\n                            <span>\r\n                              {breakStart.toLocaleTimeString()} - {breakEnd.toLocaleTimeString()}\r\n                            </span>\r\n                          ) : breakStart ? (\r\n                            <span className=\"text-yellow-600\">{dict.admin?.onBreak || 'On Break'}</span>\r\n                          ) : (\r\n                            '-'\r\n                          )}\r\n                        </td>\r\n                        <td className=\"px-4 py-4 whitespace-nowrap text-sm font-medium text-gray-900\">\r\n                          {formatHours(attendance.totalHours)}\r\n                        </td>\r\n                        <td className=\"px-4 py-4 text-sm text-gray-500\">\r\n                          {attendance.notes ? (\r\n                            <span title={attendance.notes}>{attendance.notes.substring(0, 30)}...</span>\r\n                          ) : (\r\n                            '-'\r\n                          )}\r\n                        </td>\r\n                      </tr>\r\n                    );\r\n                  })}\r\n                </tbody>\r\n              </table>\r\n              {attendances.length === 0 && (\r\n                <div className=\"text-center py-8 text-gray-500\">\r\n                  {dict.common?.noData || 'No attendance records found'}\r\n                </div>\r\n              )}\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\[tenant]\\[lang]\\admin\\audit-logs\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'router' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":34,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":34,"endColumn":15},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":37,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":37,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[904,907],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[904,907],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchAuditLogs'. Either include it or remove the dependency array.","line":62,"column":6,"nodeType":"ArrayExpression","endLine":62,"endColumn":20,"suggestions":[{"desc":"Update the dependencies array to be: [fetchAuditLogs, lang, tenant]","fix":{"range":[1699,1713],"text":"[fetchAuditLogs, lang, tenant]"}}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchAuditLogs'. Either include it or remove the dependency array.","line":67,"column":6,"nodeType":"ArrayExpression","endLine":67,"endColumn":141,"suggestions":[{"desc":"Update the dependencies array to be: [auditFilters.action, auditFilters.entityType, auditFilters.userId, auditFilters.startDate, auditFilters.endDate, auditPagination.page, fetchAuditLogs]","fix":{"range":[1829,1964],"text":"[auditFilters.action, auditFilters.entityType, auditFilters.userId, auditFilters.startDate, auditFilters.endDate, auditPagination.page, fetchAuditLogs]"}}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useEffect, useState } from 'react';\r\nimport Navbar from '@/components/Navbar';\r\nimport { useParams, useRouter } from 'next/navigation';\r\nimport Link from 'next/link';\r\nimport { getDictionaryClient } from '../../dictionaries-client';\r\n\r\ninterface AuditLog {\r\n  _id: string;\r\n  tenantId: string;\r\n  userId?: {\r\n    _id: string;\r\n    name: string;\r\n    email: string;\r\n  } | string;\r\n  action: string;\r\n  entityType: string;\r\n  entityId?: string;\r\n  changes?: Record<string, unknown>;\r\n  ipAddress?: string;\r\n  userAgent?: string;\r\n  metadata?: Record<string, unknown>;\r\n  createdAt: string;\r\n}\r\n\r\ninterface User {\r\n  _id: string;\r\n  name: string;\r\n}\r\n\r\nexport default function AuditLogsPage() {\r\n  const params = useParams();\r\n  const router = useRouter();\r\n  const tenant = params.tenant as string;\r\n  const lang = params.lang as 'en' | 'es';\r\n  const [dict, setDict] = useState<any>(null);\r\n  const [auditLogs, setAuditLogs] = useState<AuditLog[]>([]);\r\n  const [users, setUsers] = useState<User[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [auditLoading, setAuditLoading] = useState(false);\r\n  const [message, setMessage] = useState<{ type: 'success' | 'error'; text: string } | null>(null);\r\n  const [auditFilters, setAuditFilters] = useState({\r\n    action: '',\r\n    entityType: '',\r\n    userId: '',\r\n    startDate: '',\r\n    endDate: '',\r\n  });\r\n  const [auditPagination, setAuditPagination] = useState({\r\n    page: 1,\r\n    limit: 50,\r\n    total: 0,\r\n    pages: 0,\r\n  });\r\n\r\n  useEffect(() => {\r\n    getDictionaryClient(lang).then(setDict);\r\n    fetchUsers();\r\n    fetchAuditLogs();\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [lang, tenant]);\r\n\r\n  useEffect(() => {\r\n    fetchAuditLogs();\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [auditFilters.action, auditFilters.entityType, auditFilters.userId, auditFilters.startDate, auditFilters.endDate, auditPagination.page]);\r\n\r\n  const fetchUsers = async () => {\r\n    try {\r\n      const res = await fetch('/api/users', { credentials: 'include' });\r\n      const data = await res.json();\r\n      if (data.success) {\r\n        setUsers(data.data);\r\n        setLoading(false);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error fetching users:', error);\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const fetchAuditLogs = async () => {\r\n    setAuditLoading(true);\r\n    try {\r\n      const params = new URLSearchParams({\r\n        page: auditPagination.page.toString(),\r\n        limit: auditPagination.limit.toString(),\r\n      });\r\n\r\n      if (auditFilters.action) params.append('action', auditFilters.action);\r\n      if (auditFilters.entityType) params.append('entityType', auditFilters.entityType);\r\n      if (auditFilters.userId) params.append('userId', auditFilters.userId);\r\n      if (auditFilters.startDate) params.append('startDate', auditFilters.startDate);\r\n      if (auditFilters.endDate) params.append('endDate', auditFilters.endDate);\r\n\r\n      const res = await fetch(`/api/audit-logs?${params.toString()}`, { credentials: 'include' });\r\n      const data = await res.json();\r\n      if (data.success) {\r\n        setAuditLogs(data.data);\r\n        setAuditPagination(data.pagination);\r\n      } else {\r\n        setMessage({ type: 'error', text: data.error || dict?.common?.failedToFetchAuditLogs || 'Failed to fetch audit logs' });\r\n      }\r\n    } catch (error) {\r\n      console.error('Error fetching audit logs:', error);\r\n      setMessage({ type: 'error', text: dict?.common?.failedToFetchAuditLogs || 'Failed to fetch audit logs' });\r\n    } finally {\r\n      setAuditLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleAuditFilterChange = (key: string, value: string) => {\r\n    setAuditFilters({ ...auditFilters, [key]: value });\r\n    setAuditPagination({ ...auditPagination, page: 1 });\r\n  };\r\n\r\n  const handleAuditPageChange = (newPage: number) => {\r\n    setAuditPagination({ ...auditPagination, page: newPage });\r\n  };\r\n\r\n  if (!dict || loading) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gray-50 flex items-center justify-center\">\r\n        <div className=\"text-center\">\r\n          <div className=\"inline-block animate-spin h-8 w-8 border-b-2 border-blue-600\"></div>\r\n          <p className=\"mt-4 text-gray-600\">{dict?.common?.loading || 'Loading...'}</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50\">\r\n      <Navbar />\r\n      <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 sm:py-8\">\r\n        <div className=\"mb-6 sm:mb-8\">\r\n          <Link\r\n            href={`/${tenant}/${lang}/admin`}\r\n            className=\"inline-flex items-center text-blue-600 hover:text-blue-700 font-medium mb-4 transition-colors\"\r\n          >\r\n            <svg className=\"w-5 h-5 mr-2\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M10 19l-7-7m0 0l7-7m-7 7h18\" />\r\n            </svg>\r\n            {dict?.admin?.backToAdmin || 'Back to Admin'}\r\n          </Link>\r\n          <div className=\"flex items-center justify-between\">\r\n            <div>\r\n              <h1 className=\"text-2xl sm:text-3xl lg:text-4xl font-bold text-gray-900 mb-2\">\r\n                {dict.admin?.auditLogs || 'Audit Logs'}\r\n              </h1>\r\n              <p className=\"text-gray-600\">{dict.admin?.auditLogsSubtitle || 'View system activity and changes'}</p>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {message && (\r\n          <div className={`mb-6 p-4 border ${message.type === 'success' ? 'bg-green-50 text-green-800 border-green-300' : 'bg-red-50 text-red-800 border-red-300'}`}>\r\n            {message.text}\r\n          </div>\r\n        )}\r\n\r\n        <div className=\"bg-white border border-gray-300 p-6\">\r\n          <div className=\"mb-6\">\r\n            <h2 className=\"text-xl font-bold text-gray-900 mb-4\">{dict.admin?.auditLogs || 'Audit Logs'}</h2>\r\n            \r\n            {/* Filters */}\r\n            <div className=\"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-5 gap-4 mb-4 p-4 bg-gray-50 border border-gray-300\">\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                  {dict.admin?.action || 'Action'}\r\n                </label>\r\n                <select\r\n                  value={auditFilters.action}\r\n                  onChange={(e) => handleAuditFilterChange('action', e.target.value)}\r\n                  className=\"w-full px-3 py-2 border border-gray-300 focus:ring-2 focus:ring-blue-500 text-sm bg-white\"\r\n                >\r\n                  <option value=\"\">All Actions</option>\r\n                  <option value=\"create\">Create</option>\r\n                  <option value=\"update\">Update</option>\r\n                  <option value=\"delete\">Delete</option>\r\n                  <option value=\"view\">View</option>\r\n                  <option value=\"login\">Login</option>\r\n                  <option value=\"logout\">Logout</option>\r\n                </select>\r\n              </div>\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                  {dict.admin?.entityType || 'Entity Type'}\r\n                </label>\r\n                <input\r\n                  type=\"text\"\r\n                  value={auditFilters.entityType}\r\n                  onChange={(e) => handleAuditFilterChange('entityType', e.target.value)}\r\n                  placeholder=\"e.g., user, product\"\r\n                  className=\"w-full px-3 py-2 border border-gray-300 focus:ring-2 focus:ring-blue-500 text-sm bg-white\"\r\n                />\r\n              </div>\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                  {dict.admin?.user || 'User'}\r\n                </label>\r\n                <select\r\n                  value={auditFilters.userId}\r\n                  onChange={(e) => handleAuditFilterChange('userId', e.target.value)}\r\n                  className=\"w-full px-3 py-2 border border-gray-300 focus:ring-2 focus:ring-blue-500 text-sm bg-white\"\r\n                >\r\n                  <option value=\"\">All Users</option>\r\n                  {users.map((u) => (\r\n                    <option key={u._id} value={u._id}>\r\n                      {u.name}\r\n                    </option>\r\n                  ))}\r\n                </select>\r\n              </div>\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                  {dict.admin?.startDate || 'Start Date'}\r\n                </label>\r\n                <input\r\n                  type=\"date\"\r\n                  value={auditFilters.startDate}\r\n                  onChange={(e) => handleAuditFilterChange('startDate', e.target.value)}\r\n                  className=\"w-full px-3 py-2 border border-gray-300 focus:ring-2 focus:ring-blue-500 text-sm bg-white\"\r\n                />\r\n              </div>\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                  {dict.admin?.endDate || 'End Date'}\r\n                </label>\r\n                <input\r\n                  type=\"date\"\r\n                  value={auditFilters.endDate}\r\n                  onChange={(e) => handleAuditFilterChange('endDate', e.target.value)}\r\n                  className=\"w-full px-3 py-2 border border-gray-300 focus:ring-2 focus:ring-blue-500 text-sm bg-white\"\r\n                />\r\n              </div>\r\n            </div>\r\n\r\n            {/* Audit Logs Table */}\r\n            {auditLoading ? (\r\n              <div className=\"text-center py-8\">\r\n                <div className=\"inline-block animate-spin h-8 w-8 border-b-2 border-blue-600\"></div>\r\n                <p className=\"mt-2 text-gray-600\">{dict.common?.loading || 'Loading...'}</p>\r\n              </div>\r\n            ) : (\r\n              <>\r\n                <div className=\"overflow-x-auto\">\r\n                  <table className=\"min-w-full divide-y divide-gray-200\">\r\n                    <thead className=\"bg-gray-50\">\r\n                      <tr>\r\n                        <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">\r\n                          {dict.admin?.timestamp || 'Timestamp'}\r\n                        </th>\r\n                        <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">\r\n                          {dict.admin?.user || 'User'}\r\n                        </th>\r\n                        <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">\r\n                          {dict.admin?.action || 'Action'}\r\n                        </th>\r\n                        <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">\r\n                          {dict.admin?.entityType || 'Entity Type'}\r\n                        </th>\r\n                        <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">\r\n                          {dict.admin?.entityId || 'Entity ID'}\r\n                        </th>\r\n                        <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">\r\n                          IP Address\r\n                        </th>\r\n                      </tr>\r\n                    </thead>\r\n                    <tbody className=\"bg-white divide-y divide-gray-200\">\r\n                      {auditLogs.map((log) => {\r\n                        const userName = typeof log.userId === 'object' && log.userId !== null\r\n                          ? log.userId.name\r\n                          : 'System';\r\n                        const userEmail = typeof log.userId === 'object' && log.userId !== null\r\n                          ? log.userId.email\r\n                          : '';\r\n                        return (\r\n                          <tr key={log._id} className=\"hover:bg-gray-50\">\r\n                            <td className=\"px-4 py-4 whitespace-nowrap text-sm text-gray-900\">\r\n                              {new Date(log.createdAt).toLocaleString()}\r\n                            </td>\r\n                            <td className=\"px-4 py-4 whitespace-nowrap text-sm text-gray-900\">\r\n                              <div>\r\n                                <div className=\"font-medium\">{userName}</div>\r\n                                {userEmail && (\r\n                                  <div className=\"text-xs text-gray-500\">{userEmail}</div>\r\n                                )}\r\n                              </div>\r\n                            </td>\r\n                            <td className=\"px-4 py-4 whitespace-nowrap\">\r\n                              <span className=\"px-2 py-1 text-xs font-semibold border border-blue-300 bg-blue-100 text-blue-800\">\r\n                                {log.action}\r\n                              </span>\r\n                            </td>\r\n                            <td className=\"px-4 py-4 whitespace-nowrap text-sm text-gray-900\">\r\n                              {log.entityType}\r\n                            </td>\r\n                            <td className=\"px-4 py-4 whitespace-nowrap text-sm text-gray-500 font-mono\">\r\n                              {log.entityId || '-'}\r\n                            </td>\r\n                            <td className=\"px-4 py-4 whitespace-nowrap text-sm text-gray-500 font-mono\">\r\n                              {log.ipAddress || '-'}\r\n                            </td>\r\n                          </tr>\r\n                        );\r\n                      })}\r\n                    </tbody>\r\n                  </table>\r\n                </div>\r\n                {auditLogs.length === 0 && !auditLoading && (\r\n                  <div className=\"text-center py-8 text-gray-500\">\r\n                    {dict.common?.noResults || 'No audit logs found'}\r\n                  </div>\r\n                )}\r\n\r\n                {/* Pagination */}\r\n                {auditPagination.pages > 1 && (\r\n                  <div className=\"mt-6 flex items-center justify-between\">\r\n                    <div className=\"text-sm text-gray-700\">\r\n                      {dict.admin?.showing || 'Showing'} {(auditPagination.page - 1) * auditPagination.limit + 1} {dict.admin?.to || 'to'}{' '}\r\n                      {Math.min(auditPagination.page * auditPagination.limit, auditPagination.total)} {dict.admin?.of || 'of'}{' '}\r\n                      {auditPagination.total} {dict.admin?.results || 'results'}\r\n                    </div>\r\n                    <div className=\"flex gap-2\">\r\n                      <button\r\n                        onClick={() => handleAuditPageChange(auditPagination.page - 1)}\r\n                        disabled={auditPagination.page === 1}\r\n                        className=\"px-4 py-2 border border-gray-300 text-sm font-medium text-gray-700 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed bg-white\"\r\n                      >\r\n                        {dict.common?.previous || 'Previous'}\r\n                      </button>\r\n                      <button\r\n                        onClick={() => handleAuditPageChange(auditPagination.page + 1)}\r\n                        disabled={auditPagination.page >= auditPagination.pages}\r\n                        className=\"px-4 py-2 border border-gray-300 text-sm font-medium text-gray-700 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed bg-white\"\r\n                      >\r\n                        {dict.common?.next || 'Next'}\r\n                      </button>\r\n                    </div>\r\n                  </div>\r\n                )}\r\n              </>\r\n            )}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\[tenant]\\[lang]\\admin\\backup-reset\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":13,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":13,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[449,452],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[449,452],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useEffect, useState } from 'react';\r\nimport Navbar from '@/components/Navbar';\r\nimport { useParams } from 'next/navigation';\r\nimport Link from 'next/link';\r\nimport { getDictionaryClient } from '../../dictionaries-client';\r\n\r\nexport default function BackupResetPage() {\r\n  const params = useParams();\r\n  const tenant = params.tenant as string;\r\n  const lang = params.lang as 'en' | 'es';\r\n  const [dict, setDict] = useState<any>(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [message, setMessage] = useState<{ type: 'success' | 'error'; text: string } | null>(null);\r\n  const [selectedCollections, setSelectedCollections] = useState<string[]>([]);\r\n  const [resetResults, setResetResults] = useState<Record<string, { deleted: number }> | null>(null);\r\n  const [backingUp, setBackingUp] = useState(false);\r\n  const [restoring, setRestoring] = useState(false);\r\n  const [restoreFile, setRestoreFile] = useState<File | null>(null);\r\n  const [restoreResults, setRestoreResults] = useState<Record<string, { restored: number; cleared: number }> | null>(null);\r\n  const [resetting, setResetting] = useState(false);\r\n\r\n  useEffect(() => {\r\n    getDictionaryClient(lang).then((d) => {\r\n      setDict(d);\r\n      setLoading(false);\r\n    });\r\n  }, [lang]);\r\n\r\n  if (!dict || loading) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gray-50 flex items-center justify-center\">\r\n        <div className=\"text-center\">\r\n          <div className=\"inline-block animate-spin h-8 w-8 border-b-2 border-blue-600\"></div>\r\n          <p className=\"mt-4 text-gray-600\">{dict?.common?.loading || 'Loading...'}</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50\">\r\n      <Navbar />\r\n      <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 sm:py-8\">\r\n        <div className=\"mb-6 sm:mb-8\">\r\n          <Link\r\n            href={`/${tenant}/${lang}/admin`}\r\n            className=\"inline-flex items-center text-blue-600 hover:text-blue-700 font-medium mb-4 transition-colors\"\r\n          >\r\n            <svg className=\"w-5 h-5 mr-2\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M10 19l-7-7m0 0l7-7m-7 7h18\" />\r\n            </svg>\r\n            {dict?.admin?.backToAdmin || 'Back to Admin'}\r\n          </Link>\r\n          <h1 className=\"text-2xl sm:text-3xl lg:text-4xl font-bold text-gray-900 mb-2\">\r\n            Collection Backup & Reset\r\n          </h1>\r\n          <p className=\"text-gray-600\">\r\n            Backup your data before resetting. Warning: Reset action will permanently delete all data in the selected collections for this tenant. This cannot be undone.\r\n          </p>\r\n        </div>\r\n\r\n        {message && (\r\n          <div\r\n            className={`mb-6 p-4 border ${\r\n              message.type === 'success'\r\n                ? 'bg-green-50 text-green-800 border-green-300'\r\n                : 'bg-red-50 text-red-800 border-red-300'\r\n            }`}\r\n          >\r\n            {message.text}\r\n          </div>\r\n        )}\r\n\r\n        <div className=\"space-y-8\">\r\n          {/* Backup Section */}\r\n          <div className=\"bg-white border border-gray-300 p-5 sm:p-6 lg:p-8\">\r\n            <div className=\"mb-6 p-5 bg-blue-50 border-2 border-blue-300\">\r\n              <h3 className=\"text-lg font-semibold text-blue-900 mb-3\">Backup Collections</h3>\r\n              <p className=\"text-sm text-blue-800 mb-4\">\r\n                Export selected collections as a JSON backup file. You can restore this backup later.\r\n              </p>\r\n              \r\n              <div className=\"flex items-center gap-4\">\r\n                <button\r\n                  onClick={async () => {\r\n                    if (selectedCollections.length === 0) {\r\n                      setMessage({ type: 'error', text: dict?.common?.selectAtLeastOneCollection || 'Please select at least one collection to backup.' });\r\n                      return;\r\n                    }\r\n\r\n                    try {\r\n                      setBackingUp(true);\r\n                      setMessage(null);\r\n\r\n                      const collectionsParam = selectedCollections.join(',');\r\n                      const url = `/api/tenants/${tenant}/reset-collections?collections=${collectionsParam}`;\r\n                      \r\n                      const res = await fetch(url, {\r\n                        method: 'GET',\r\n                        credentials: 'include',\r\n                      });\r\n\r\n                      if (!res.ok) {\r\n                        const data = await res.json();\r\n                        if (res.status === 401 || res.status === 403) {\r\n                          setMessage({ type: 'error', text: dict?.common?.unauthorizedBackup || 'Unauthorized. Only admins can backup collections.' });\r\n                        } else {\r\n                          setMessage({ type: 'error', text: data.error || dict?.common?.failedToCreateBackup || 'Failed to create backup' });\r\n                        }\r\n                        return;\r\n                      }\r\n\r\n                      // Download the file\r\n                      const blob = await res.blob();\r\n                      const downloadUrl = window.URL.createObjectURL(blob);\r\n                      const a = document.createElement('a');\r\n                      a.href = downloadUrl;\r\n                      a.download = `backup-${tenant}-${new Date().toISOString().split('T')[0]}.json`;\r\n                      document.body.appendChild(a);\r\n                      a.click();\r\n                      window.URL.revokeObjectURL(downloadUrl);\r\n                      document.body.removeChild(a);\r\n\r\n                      setMessage({ type: 'success', text: `Backup created successfully for ${selectedCollections.length} collection(s)` });\r\n                    } catch (error) {\r\n                      console.error('Error creating backup:', error);\r\n                      setMessage({ type: 'error', text: dict?.common?.failedToCreateBackup || 'Failed to create backup. Please check your connection.' });\r\n                    } finally {\r\n                      setBackingUp(false);\r\n                    }\r\n                  }}\r\n                  disabled={backingUp || selectedCollections.length === 0}\r\n                  className=\"px-6 py-3 bg-blue-600 text-white hover:bg-blue-700 font-semibold transition-all duration-200 border border-blue-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2\"\r\n                >\r\n                  {backingUp ? (\r\n                    <>\r\n                      <div className=\"animate-spin h-5 w-5 border-b-2 border-white\"></div>\r\n                      <span>Creating Backup...</span>\r\n                    </>\r\n                  ) : (\r\n                    <>\r\n                      <svg className=\"w-5 h-5\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4\" />\r\n                      </svg>\r\n                      <span>Download Backup</span>\r\n                    </>\r\n                  )}\r\n                </button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Restore Section */}\r\n          <div className=\"bg-white border border-gray-300 p-5 sm:p-6 lg:p-8\">\r\n            <div className=\"mb-6 p-5 bg-green-50 border-2 border-green-300\">\r\n              <h3 className=\"text-lg font-semibold text-green-900 mb-3\">Restore Collections</h3>\r\n              <p className=\"text-sm text-green-800 mb-4\">\r\n                Upload a backup JSON file to restore collections. You can choose to clear existing data before restoring.\r\n              </p>\r\n              \r\n              <div className=\"space-y-4\">\r\n                <div>\r\n                  <label className=\"block text-sm font-medium text-green-900 mb-2\">\r\n                    Select Backup File\r\n                  </label>\r\n                  <input\r\n                    type=\"file\"\r\n                    accept=\".json\"\r\n                    onChange={(e) => {\r\n                      const file = e.target.files?.[0];\r\n                      if (file) {\r\n                        setRestoreFile(file);\r\n                        setRestoreResults(null);\r\n                      }\r\n                    }}\r\n                    className=\"w-full px-4 py-2 border-2 border-green-300 focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-all bg-white\"\r\n                  />\r\n                </div>\r\n\r\n                {restoreFile && (\r\n                  <div className=\"p-3 bg-white border border-green-300\">\r\n                    <p className=\"text-sm text-green-800\">\r\n                      <span className=\"font-medium\">Selected:</span> {restoreFile.name} ({(restoreFile.size / 1024).toFixed(2)} KB)\r\n                    </p>\r\n                  </div>\r\n                )}\r\n\r\n                {restoreResults && (\r\n                  <div className=\"p-4 bg-white border-2 border-green-300\">\r\n                    <h4 className=\"font-semibold text-green-900 mb-2\">Restore Results:</h4>\r\n                    <ul className=\"space-y-1\">\r\n                      {Object.entries(restoreResults).map(([collection, result]) => (\r\n                        <li key={collection} className=\"text-sm text-green-800\">\r\n                          <span className=\"font-medium capitalize\">{collection.replace(/([A-Z])/g, ' $1').trim()}:</span> {result.restored} record(s) restored\r\n                          {result.cleared > 0 && `, ${result.cleared} cleared`}\r\n                        </li>\r\n                      ))}\r\n                    </ul>\r\n                  </div>\r\n                )}\r\n\r\n                <div className=\"flex items-center gap-4\">\r\n                  <label className=\"flex items-center\">\r\n                    <input\r\n                      type=\"checkbox\"\r\n                      id=\"clearExisting\"\r\n                      className=\"h-4 w-4 text-green-600 focus:ring-green-500 border-gray-300 cursor-pointer\"\r\n                    />\r\n                    <span className=\"ml-2 text-sm font-medium text-green-900\">\r\n                      Clear existing data before restoring\r\n                    </span>\r\n                  </label>\r\n                </div>\r\n\r\n                <button\r\n                  onClick={async () => {\r\n                    if (!restoreFile) {\r\n                      setMessage({ type: 'error', text: dict?.common?.selectBackupFile || 'Please select a backup file to restore.' });\r\n                      return;\r\n                    }\r\n\r\n                    const clearExisting = (document.getElementById('clearExisting') as HTMLInputElement)?.checked || false;\r\n\r\n                    if (clearExisting && !confirm(\r\n                      dict?.common?.clearExistingDataConfirm || \r\n                      'Are you sure you want to clear existing data before restoring?\\n\\n' +\r\n                      'This will delete all current data in the collections being restored!'\r\n                    )) {\r\n                      return;\r\n                    }\r\n\r\n                    try {\r\n                      setRestoring(true);\r\n                      setMessage(null);\r\n                      setRestoreResults(null);\r\n\r\n                      const fileContent = await restoreFile.text();\r\n                      let backupData;\r\n                      try {\r\n                        backupData = JSON.parse(fileContent);\r\n                      } catch (e) {\r\n                        setMessage({ type: 'error', text: dict?.common?.invalidBackupFormat || 'Invalid backup file format. Please select a valid JSON backup file.' });\r\n                        return;\r\n                      }\r\n\r\n                      if (!backupData.collections) {\r\n                        setMessage({ type: 'error', text: dict?.common?.invalidBackupFile || 'Invalid backup file. Missing collections data.' });\r\n                        return;\r\n                      }\r\n\r\n                      const res = await fetch(`/api/tenants/${tenant}/reset-collections`, {\r\n                        method: 'PUT',\r\n                        headers: {\r\n                          'Content-Type': 'application/json',\r\n                        },\r\n                        credentials: 'include',\r\n                        body: JSON.stringify({ backupData, clearExisting }),\r\n                      });\r\n\r\n                      const data = await res.json();\r\n                      if (data.success) {\r\n                        setMessage({ type: 'success', text: data.data.message });\r\n                        setRestoreResults(data.data.results);\r\n                        setRestoreFile(null);\r\n                        // Reset file input\r\n                        const fileInput = document.querySelector('input[type=\"file\"]') as HTMLInputElement;\r\n                        if (fileInput) fileInput.value = '';\r\n                      } else {\r\n                        if (res.status === 401 || res.status === 403) {\r\n                          setMessage({ type: 'error', text: dict?.common?.unauthorizedRestore || 'Unauthorized. Only admins can restore collections.' });\r\n                        } else {\r\n                          setMessage({ type: 'error', text: data.error || dict?.common?.failedToRestoreBackup || 'Failed to restore backup' });\r\n                        }\r\n                      }\r\n                    } catch (error) {\r\n                      console.error('Error restoring backup:', error);\r\n                      setMessage({ type: 'error', text: dict?.common?.failedToRestoreBackup || 'Failed to restore backup. Please check your connection.' });\r\n                    } finally {\r\n                      setRestoring(false);\r\n                    }\r\n                  }}\r\n                  disabled={restoring || !restoreFile}\r\n                  className=\"px-6 py-3 bg-green-600 text-white hover:bg-green-700 font-semibold transition-all duration-200 border border-green-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2\"\r\n                >\r\n                  {restoring ? (\r\n                    <>\r\n                      <div className=\"animate-spin h-5 w-5 border-b-2 border-white\"></div>\r\n                      <span>Restoring...</span>\r\n                    </>\r\n                  ) : (\r\n                    <>\r\n                      <svg className=\"w-5 h-5\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12\" />\r\n                      </svg>\r\n                      <span>Restore Backup</span>\r\n                    </>\r\n                  )}\r\n                </button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Reset Section */}\r\n          <div className=\"bg-white border border-gray-300 p-5 sm:p-6 lg:p-8\">\r\n            <div className=\"p-5 bg-red-50 border-2 border-red-300\">\r\n              <h3 className=\"text-lg font-semibold text-red-900 mb-3\">Reset Collections</h3>\r\n              <p className=\"text-sm text-red-800 mb-4\">\r\n                Warning: This action will permanently delete all data in the selected collections for this tenant. This cannot be undone.\r\n              </p>\r\n\r\n              {resetResults && (\r\n                <div className=\"mb-6 p-4 bg-blue-50 border-2 border-blue-300\">\r\n                  <h3 className=\"font-semibold text-blue-900 mb-2\">Reset Results:</h3>\r\n                  <ul className=\"space-y-1\">\r\n                    {Object.entries(resetResults).map(([collection, result]) => (\r\n                      <li key={collection} className=\"text-sm text-blue-800\">\r\n                        <span className=\"font-medium capitalize\">{collection.replace(/([A-Z])/g, ' $1').trim()}:</span> {result.deleted} record(s) deleted\r\n                      </li>\r\n                    ))}\r\n                  </ul>\r\n                </div>\r\n              )}\r\n\r\n              <div className=\"space-y-4\">\r\n                <div>\r\n                  <label className=\"block text-sm font-medium text-gray-700 mb-3\">\r\n                    Select Collections to Reset:\r\n                  </label>\r\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3\">\r\n                    {[\r\n                      { key: 'products', label: 'Products' },\r\n                      { key: 'transactions', label: 'Transactions' },\r\n                      { key: 'categories', label: 'Categories' },\r\n                      { key: 'stockMovements', label: 'Stock Movements' },\r\n                      { key: 'expenses', label: 'Expenses' },\r\n                      { key: 'discounts', label: 'Discounts' },\r\n                      { key: 'branches', label: 'Branches' },\r\n                      { key: 'cashDrawerSessions', label: 'Cash Drawer Sessions' },\r\n                      { key: 'productBundles', label: 'Product Bundles' },\r\n                      { key: 'attendance', label: 'Attendance' },\r\n                      { key: 'bookings', label: 'Bookings' },\r\n                      { key: 'savedCarts', label: 'Saved Carts' },\r\n                      { key: 'auditLogs', label: 'Audit Logs' },\r\n                    ].map((collection) => (\r\n                      <label\r\n                        key={collection.key}\r\n                        className=\"flex items-center p-3 border-2 border-gray-300 hover:bg-gray-50 cursor-pointer transition-colors\"\r\n                      >\r\n                        <input\r\n                          type=\"checkbox\"\r\n                          checked={selectedCollections.includes(collection.key)}\r\n                          onChange={(e) => {\r\n                            if (e.target.checked) {\r\n                              setSelectedCollections([...selectedCollections, collection.key]);\r\n                            } else {\r\n                              setSelectedCollections(selectedCollections.filter(c => c !== collection.key));\r\n                            }\r\n                          }}\r\n                          className=\"h-4 w-4 text-red-600 focus:ring-red-500 border-gray-300 cursor-pointer\"\r\n                        />\r\n                        <span className=\"ml-3 text-sm font-medium text-gray-700\">\r\n                          {collection.label}\r\n                        </span>\r\n                      </label>\r\n                    ))}\r\n                  </div>\r\n                </div>\r\n\r\n                <div className=\"flex items-center gap-4 pt-4 border-t border-gray-200\">\r\n                  <button\r\n                    onClick={async () => {\r\n                      if (selectedCollections.length === 0) {\r\n                        setMessage({ type: 'error', text: dict?.common?.selectAtLeastOneCollectionReset || 'Please select at least one collection to reset.' });\r\n                        return;\r\n                      }\r\n\r\n                      const resetConfirmText = dict?.common?.resetCollectionsConfirm\r\n                        ?.replace('{count}', selectedCollections.length.toString())\r\n                        ?.replace('{collections}', selectedCollections.join(', ')) ||\r\n                        `Are you sure you want to reset ${selectedCollections.length} collection(s)?\\n\\n` +\r\n                        `Selected: ${selectedCollections.join(', ')}\\n\\n` +\r\n                        `This action cannot be undone!`;\r\n                      if (!confirm(resetConfirmText)) {\r\n                        return;\r\n                      }\r\n\r\n                      try {\r\n                        setResetting(true);\r\n                        setMessage(null);\r\n                        setResetResults(null);\r\n\r\n                        const res = await fetch(`/api/tenants/${tenant}/reset-collections`, {\r\n                          method: 'POST',\r\n                          headers: {\r\n                            'Content-Type': 'application/json',\r\n                          },\r\n                          credentials: 'include',\r\n                          body: JSON.stringify({ collections: selectedCollections }),\r\n                        });\r\n\r\n                        const data = await res.json();\r\n                        if (data.success) {\r\n                          setMessage({ type: 'success', text: data.data.message });\r\n                          setResetResults(data.data.results);\r\n                          setSelectedCollections([]);\r\n                        } else {\r\n                          if (res.status === 401 || res.status === 403) {\r\n                            setMessage({ type: 'error', text: dict?.common?.unauthorizedReset || 'Unauthorized. Only admins can reset collections.' });\r\n                          } else {\r\n                            setMessage({ type: 'error', text: data.error || dict?.common?.failedToResetCollections || 'Failed to reset collections' });\r\n                          }\r\n                        }\r\n                      } catch (error) {\r\n                        console.error('Error resetting collections:', error);\r\n                        setMessage({ type: 'error', text: dict?.common?.failedToResetCollections || 'Failed to reset collections. Please check your connection.' });\r\n                      } finally {\r\n                        setResetting(false);\r\n                      }\r\n                    }}\r\n                    disabled={resetting || selectedCollections.length === 0}\r\n                    className=\"px-6 py-3 bg-red-600 text-white hover:bg-red-700 font-semibold transition-all duration-200 border border-red-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2\"\r\n                  >\r\n                    {resetting ? (\r\n                      <>\r\n                        <div className=\"animate-spin h-5 w-5 border-b-2 border-white\"></div>\r\n                        <span>Resetting...</span>\r\n                      </>\r\n                    ) : (\r\n                      <>\r\n                        <svg className=\"w-5 h-5\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16\" />\r\n                        </svg>\r\n                        <span>Reset Selected Collections</span>\r\n                      </>\r\n                    )}\r\n                  </button>\r\n                  {selectedCollections.length > 0 && (\r\n                    <button\r\n                      onClick={() => {\r\n                        setSelectedCollections([]);\r\n                        setResetResults(null);\r\n                      }}\r\n                      className=\"px-4 py-2 text-sm text-gray-600 hover:text-gray-800 font-medium\"\r\n                    >\r\n                      Clear Selection\r\n                    </button>\r\n                  )}\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\[tenant]\\[lang]\\admin\\bookings\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Link' is defined but never used. Allowed unused vars must match /^_/u.","line":5,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":12},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":52,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":52,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1468,1471],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1468,1471],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'fetchBookings' and 'fetchStaff'. Either include them or remove the dependency array.","line":90,"column":6,"nodeType":"ArrayExpression","endLine":90,"endColumn":33,"suggestions":[{"desc":"Update the dependencies array to be: [filterStatus, filterStaff, fetchBookings, fetchStaff]","fix":{"range":[2897,2924],"text":"[filterStatus, filterStaff, fetchBookings, fetchStaff]"}}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useEffect, useState } from 'react';\r\nimport { useParams } from 'next/navigation';\r\nimport Link from 'next/link';\r\nimport Navbar from '@/components/Navbar';\r\nimport BookingCalendar from '@/components/BookingCalendar';\r\nimport { getDictionaryClient } from '../../dictionaries-client';\r\nimport { useTenantSettings } from '@/contexts/TenantSettingsContext';\r\nimport { supportsFeature } from '@/lib/business-type-helpers';\r\nimport { getBusinessTypeConfig } from '@/lib/business-types';\r\nimport { getBusinessType } from '@/lib/business-type-helpers';\r\n\r\ninterface Booking {\r\n  _id: string;\r\n  customerName: string;\r\n  customerEmail?: string;\r\n  customerPhone?: string;\r\n  serviceName: string;\r\n  serviceDescription?: string;\r\n  startTime: string;\r\n  endTime: string;\r\n  duration: number;\r\n  status: 'pending' | 'confirmed' | 'completed' | 'cancelled' | 'no-show';\r\n  staffId?: {\r\n    _id: string;\r\n    name: string;\r\n    email: string;\r\n  };\r\n  staffName?: string;\r\n  notes?: string;\r\n  reminderSent?: boolean;\r\n  confirmationSent?: boolean;\r\n  createdAt: string;\r\n  updatedAt: string;\r\n}\r\n\r\ninterface User {\r\n  _id: string;\r\n  name: string;\r\n  email: string;\r\n}\r\n\r\ntype BookingUpdate = Omit<Partial<Booking>, 'staffId'> & {\r\n  staffId?: string;\r\n};\r\n\r\nexport default function BookingsPage() {\r\n  const params = useParams();\r\n  const tenant = params.tenant as string;\r\n  const lang = params.lang as 'en' | 'es';\r\n  const [dict, setDict] = useState<any>(null);\r\n\r\n  const [bookings, setBookings] = useState<Booking[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [selectedBooking, setSelectedBooking] = useState<Booking | null>(null);\r\n  const [selectedDate, setSelectedDate] = useState<Date | null>(null);\r\n  const [showModal, setShowModal] = useState(false);\r\n  const [showCreateModal, setShowCreateModal] = useState(false);\r\n  const [staff, setStaff] = useState<User[]>([]);\r\n  const [filterStatus, setFilterStatus] = useState<string>('all');\r\n  const [filterStaff, setFilterStaff] = useState<string>('all');\r\n  const [message, setMessage] = useState<{ type: 'success' | 'error'; text: string } | null>(null);\r\n  const { settings } = useTenantSettings();\r\n  const bookingEnabled = supportsFeature(settings ?? undefined, 'booking');\r\n  const businessTypeConfig = settings ? getBusinessTypeConfig(getBusinessType(settings)) : null;\r\n\r\n  // Form state\r\n  const [formData, setFormData] = useState({\r\n    customerName: '',\r\n    customerEmail: '',\r\n    customerPhone: '',\r\n    serviceName: '',\r\n    serviceDescription: '',\r\n    startTime: '',\r\n    duration: 60,\r\n    staffId: '',\r\n    notes: '',\r\n    status: 'pending' as Booking['status'],\r\n  });\r\n\r\n  useEffect(() => {\r\n    getDictionaryClient(lang).then(setDict);\r\n  }, [lang]);\r\n\r\n  useEffect(() => {\r\n    fetchBookings();\r\n    fetchStaff();\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [filterStatus, filterStaff]);\r\n\r\n  const fetchBookings = async () => {\r\n    try {\r\n      setLoading(true);\r\n      const token = document.cookie\r\n        .split('; ')\r\n        .find((row) => row.startsWith('auth-token='))\r\n        ?.split('=')[1];\r\n\r\n      let url = `/api/bookings?tenant=${tenant}`;\r\n      if (filterStatus !== 'all') {\r\n        url += `&status=${filterStatus}`;\r\n      }\r\n      if (filterStaff !== 'all') {\r\n        url += `&staffId=${filterStaff}`;\r\n      }\r\n\r\n      const response = await fetch(url, {\r\n        headers: {\r\n          Authorization: `Bearer ${token}`,\r\n        },\r\n      });\r\n\r\n      if (response.ok) {\r\n        const data = await response.json();\r\n        if (data.success) {\r\n          setBookings(data.data || []);\r\n          setMessage(null);\r\n        } else {\r\n          setMessage({ type: 'error', text: data.error || dict?.common?.failedToFetchBookings || 'Failed to fetch bookings' });\r\n        }\r\n      } else {\r\n        const data = await response.json();\r\n        setMessage({ type: 'error', text: data.error || dict?.common?.failedToFetchBookings || 'Failed to fetch bookings' });\r\n      }\r\n    } catch (error) {\r\n      console.error('Failed to fetch bookings:', error);\r\n      setMessage({ type: 'error', text: dict?.common?.failedToFetchBookings || 'Failed to fetch bookings' });\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const fetchStaff = async () => {\r\n    try {\r\n      const token = document.cookie\r\n        .split('; ')\r\n        .find((row) => row.startsWith('auth-token='))\r\n        ?.split('=')[1];\r\n\r\n      const response = await fetch(`/api/users?tenant=${tenant}`, {\r\n        headers: {\r\n          Authorization: `Bearer ${token}`,\r\n        },\r\n      });\r\n\r\n      if (response.ok) {\r\n        const data = await response.json();\r\n        if (data.success) {\r\n          setStaff(data.data || []);\r\n        } else {\r\n          console.error('Failed to fetch staff:', data.error);\r\n        }\r\n      } else {\r\n        const data = await response.json();\r\n        console.error('Failed to fetch staff:', data.error);\r\n      }\r\n    } catch (error) {\r\n      console.error('Failed to fetch staff:', error);\r\n    }\r\n  };\r\n\r\n  const handleCreateBooking = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    try {\r\n      const token = document.cookie\r\n        .split('; ')\r\n        .find((row) => row.startsWith('auth-token='))\r\n        ?.split('=')[1];\r\n\r\n      const response = await fetch(`/api/bookings?tenant=${tenant}`, {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          Authorization: `Bearer ${token}`,\r\n        },\r\n        body: JSON.stringify(formData),\r\n      });\r\n\r\n      if (response.ok) {\r\n        const data = await response.json();\r\n        if (data.success) {\r\n          setMessage({ type: 'success', text: dict?.common?.bookingCreatedSuccess || 'Booking created successfully' });\r\n          await fetchBookings();\r\n          setShowCreateModal(false);\r\n          resetForm();\r\n        } else {\r\n          setMessage({ type: 'error', text: data.error || dict?.common?.failedToCreateBooking || 'Failed to create booking' });\r\n        }\r\n      } else {\r\n        const error = await response.json();\r\n        setMessage({ type: 'error', text: error.error || dict?.common?.failedToCreateBooking || 'Failed to create booking' });\r\n      }\r\n    } catch (error) {\r\n      console.error('Failed to create booking:', error);\r\n      setMessage({ type: 'error', text: dict?.common?.failedToCreateBooking || 'Failed to create booking' });\r\n    }\r\n  };\r\n\r\n  const handleUpdateBooking = async (id: string, updates: BookingUpdate) => {\r\n    try {\r\n      const token = document.cookie\r\n        .split('; ')\r\n        .find((row) => row.startsWith('auth-token='))\r\n        ?.split('=')[1];\r\n\r\n      const response = await fetch(`/api/bookings/${id}?tenant=${tenant}`, {\r\n        method: 'PUT',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          Authorization: `Bearer ${token}`,\r\n        },\r\n        body: JSON.stringify(updates),\r\n      });\r\n\r\n      if (response.ok) {\r\n        const data = await response.json();\r\n        if (data.success) {\r\n          setMessage({ type: 'success', text: dict?.common?.bookingUpdatedSuccess || 'Booking updated successfully' });\r\n          await fetchBookings();\r\n          setShowModal(false);\r\n          setSelectedBooking(null);\r\n        } else {\r\n          setMessage({ type: 'error', text: data.error || dict?.common?.failedToUpdateBooking || 'Failed to update booking' });\r\n        }\r\n      } else {\r\n        const error = await response.json();\r\n        setMessage({ type: 'error', text: error.error || dict?.common?.failedToUpdateBooking || 'Failed to update booking' });\r\n      }\r\n    } catch (error) {\r\n      console.error('Failed to update booking:', error);\r\n      setMessage({ type: 'error', text: dict?.common?.failedToUpdateBooking || 'Failed to update booking' });\r\n    }\r\n  };\r\n\r\n  const handleDeleteBooking = async (id: string) => {\r\n    if (!dict) return;\r\n    if (!confirm(dict.common?.deleteBookingConfirm || 'Are you sure you want to delete this booking?')) {\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const token = document.cookie\r\n        .split('; ')\r\n        .find((row) => row.startsWith('auth-token='))\r\n        ?.split('=')[1];\r\n\r\n      const response = await fetch(`/api/bookings/${id}?tenant=${tenant}`, {\r\n        method: 'DELETE',\r\n        headers: {\r\n          Authorization: `Bearer ${token}`,\r\n        },\r\n      });\r\n\r\n      if (response.ok) {\r\n        const data = await response.json();\r\n        if (data.success) {\r\n          setMessage({ type: 'success', text: dict?.common?.bookingDeletedSuccess || 'Booking deleted successfully' });\r\n          await fetchBookings();\r\n          setShowModal(false);\r\n          setSelectedBooking(null);\r\n        } else {\r\n          setMessage({ type: 'error', text: data.error || dict?.common?.failedToDeleteBooking || 'Failed to delete booking' });\r\n        }\r\n      } else {\r\n        const error = await response.json();\r\n        setMessage({ type: 'error', text: error.error || dict?.common?.failedToDeleteBooking || 'Failed to delete booking' });\r\n      }\r\n    } catch (error) {\r\n      console.error('Failed to delete booking:', error);\r\n      setMessage({ type: 'error', text: dict?.common?.failedToDeleteBooking || 'Failed to delete booking' });\r\n    }\r\n  };\r\n\r\n  const handleSendReminder = async (id: string) => {\r\n    try {\r\n      const token = document.cookie\r\n        .split('; ')\r\n        .find((row) => row.startsWith('auth-token='))\r\n        ?.split('=')[1];\r\n\r\n      const response = await fetch(`/api/bookings/${id}/reminder?tenant=${tenant}`, {\r\n        method: 'POST',\r\n        headers: {\r\n          Authorization: `Bearer ${token}`,\r\n        },\r\n      });\r\n\r\n      if (response.ok) {\r\n        const data = await response.json();\r\n        if (data.success) {\r\n          setMessage({ type: 'success', text: dict?.common?.reminderSentSuccess || 'Reminder sent successfully' });\r\n        } else {\r\n          setMessage({ type: 'error', text: data.error || dict?.common?.failedToSendReminder || 'Failed to send reminder' });\r\n        }\r\n      } else {\r\n        const error = await response.json();\r\n        setMessage({ type: 'error', text: error.error || dict?.common?.failedToSendReminder || 'Failed to send reminder' });\r\n      }\r\n    } catch (error) {\r\n      console.error('Failed to send reminder:', error);\r\n      setMessage({ type: 'error', text: dict?.common?.failedToSendReminder || 'Failed to send reminder' });\r\n    }\r\n  };\r\n\r\n  const resetForm = () => {\r\n    setFormData({\r\n      customerName: '',\r\n      customerEmail: '',\r\n      customerPhone: '',\r\n      serviceName: '',\r\n      serviceDescription: '',\r\n      startTime: '',\r\n      duration: 60,\r\n      staffId: '',\r\n      notes: '',\r\n      status: 'pending',\r\n    });\r\n  };\r\n\r\n  const formatDateTime = (dateString: string) => {\r\n    const date = new Date(dateString);\r\n    return date.toLocaleString('en-US', {\r\n      weekday: 'short',\r\n      year: 'numeric',\r\n      month: 'short',\r\n      day: 'numeric',\r\n      hour: '2-digit',\r\n      minute: '2-digit',\r\n    });\r\n  };\r\n\r\n  const getStatusColor = (status: Booking['status']) => {\r\n    switch (status) {\r\n      case 'confirmed':\r\n        return 'bg-green-100 text-green-800';\r\n      case 'pending':\r\n        return 'bg-yellow-100 text-yellow-800';\r\n      case 'completed':\r\n        return 'bg-blue-100 text-blue-800';\r\n      case 'cancelled':\r\n        return 'bg-red-100 text-red-800';\r\n      case 'no-show':\r\n        return 'bg-gray-100 text-gray-800';\r\n      default:\r\n        return 'bg-gray-100 text-gray-800';\r\n    }\r\n  };\r\n\r\n  if (loading && bookings.length === 0) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gray-50 flex items-center justify-center\">\r\n        <div className=\"text-center\">\r\n          <div className=\"inline-block animate-spin h-8 w-8 border-b-2 border-blue-600\"></div>\r\n          <p className=\"mt-4 text-gray-600\">{dict?.admin?.loadingBookings || 'Loading bookings...'}</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50\">\r\n      <Navbar />\r\n      <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 sm:py-8\">\r\n        <div className=\"mb-6 flex items-center justify-between\">\r\n          <div>\r\n            <h1 className=\"text-2xl sm:text-3xl font-bold text-gray-900 mb-2\">\r\n              {dict?.admin?.bookings || 'Booking & Scheduling'}\r\n            </h1>\r\n            <p className=\"text-gray-600\">{dict?.admin?.bookingsSubtitle || 'Manage appointments and bookings'}</p>\r\n          </div>\r\n          <button\r\n            onClick={() => setShowCreateModal(true)}\r\n            className=\"px-4 py-2 bg-blue-600 text-white hover:bg-blue-700 transition-colors flex items-center gap-2 border border-blue-700\"\r\n          >\r\n            <svg className=\"w-5 h-5 mr-2\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M10 19l-7-7m0 0l7-7m-7 7h18\" />\r\n            </svg>\r\n            {dict?.admin?.newBooking || 'New Booking'}\r\n          </button>\r\n        </div>\r\n\r\n        {message && (\r\n          <div className={`mb-6 p-4 border ${message.type === 'success' ? 'bg-green-50 text-green-800 border-green-300' : 'bg-red-50 text-red-800 border-red-300'}`}>\r\n            {message.text}\r\n          </div>\r\n        )}\r\n\r\n        {!bookingEnabled && (\r\n          <div className=\"mb-6 p-4 bg-yellow-50 border-2 border-yellow-300 text-yellow-800\">\r\n            <div className=\"flex items-start gap-3\">\r\n              <svg className=\"w-6 h-6 flex-shrink-0 mt-0.5\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z\" />\r\n              </svg>\r\n              <div>\r\n                <h3 className=\"text-lg font-semibold text-yellow-900 mb-2\">\r\n                  Booking & Scheduling Not Available\r\n                </h3>\r\n                <p className=\"text-yellow-800\">\r\n                  Booking and scheduling is not enabled for {businessTypeConfig?.name || 'your business type'}. \r\n                  This feature is typically used for service businesses, salons, and laundry services.\r\n                </p>\r\n                <p className=\"text-sm text-yellow-700 mt-2\">\r\n                  If you need booking features, please enable it in Settings  Business or update your business type.\r\n                </p>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {/* Filters */}\r\n        <div className=\"mb-6 flex gap-4\">\r\n          <select\r\n            value={filterStatus}\r\n            onChange={(e) => setFilterStatus(e.target.value)}\r\n            className=\"px-4 py-2 border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white\"\r\n          >\r\n            <option value=\"all\">{dict?.admin?.allStatuses || 'All Statuses'}</option>\r\n            <option value=\"pending\">{dict?.admin?.pending || 'Pending'}</option>\r\n            <option value=\"confirmed\">{dict?.admin?.confirmed || 'Confirmed'}</option>\r\n            <option value=\"completed\">{dict?.admin?.completed || 'Completed'}</option>\r\n            <option value=\"cancelled\">{dict?.admin?.cancelled || 'Cancelled'}</option>\r\n            <option value=\"no-show\">No Show</option>\r\n          </select>\r\n          <select\r\n            value={filterStaff}\r\n            onChange={(e) => setFilterStaff(e.target.value)}\r\n            className=\"px-4 py-2 border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white\"\r\n          >\r\n            <option value=\"all\">{dict?.admin?.allStaff || 'All Staff'}</option>\r\n            {staff.map((s) => (\r\n              <option key={s._id} value={s._id}>\r\n                {s.name}\r\n              </option>\r\n            ))}\r\n          </select>\r\n        </div>\r\n\r\n        {/* Calendar View */}\r\n        <div className=\"mb-8\">\r\n          <BookingCalendar\r\n            bookings={bookings}\r\n            onDateSelect={(date) => {\r\n              setSelectedDate(date);\r\n              const dayBookings = bookings.filter((b) => {\r\n                const bookingDate = new Date(b.startTime).toDateString();\r\n                return bookingDate === date.toDateString();\r\n              });\r\n              if (dayBookings.length > 0) {\r\n                setSelectedBooking(dayBookings[0]);\r\n                setShowModal(true);\r\n              }\r\n            }}\r\n            onBookingSelect={(booking) => {\r\n              setSelectedBooking(booking);\r\n              setShowModal(true);\r\n            }}\r\n            selectedDate={selectedDate || undefined}\r\n          />\r\n        </div>\r\n\r\n        {/* Bookings List */}\r\n        <div className=\"bg-white border border-gray-300 overflow-hidden\">\r\n          <div className=\"px-6 py-4 border-b border-gray-200\">\r\n            <h2 className=\"text-lg font-semibold text-gray-900\">{dict?.admin?.allBookings || 'All Bookings'}</h2>\r\n          </div>\r\n          <div className=\"overflow-x-auto\">\r\n            <table className=\"w-full\">\r\n              <thead className=\"bg-gray-50\">\r\n                <tr>\r\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                    {dict?.admin?.customerName || 'Customer'}\r\n                  </th>\r\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                    {dict?.admin?.serviceName || 'Service'}\r\n                  </th>\r\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                    {dict?.admin?.dateTime || 'Date & Time'}\r\n                  </th>\r\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                    {dict?.admin?.staff || 'Staff'}\r\n                  </th>\r\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                    {dict?.admin?.status || 'Status'}\r\n                  </th>\r\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                    {dict?.common?.actions || 'Actions'}\r\n                  </th>\r\n                </tr>\r\n              </thead>\r\n              <tbody className=\"bg-white divide-y divide-gray-200\">\r\n                {bookings.map((booking) => (\r\n                  <tr key={booking._id} className=\"hover:bg-gray-50\">\r\n                    <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                      <div className=\"text-sm font-medium text-gray-900\">{booking.customerName}</div>\r\n                      {booking.customerEmail && (\r\n                        <div className=\"text-sm text-gray-500\">{booking.customerEmail}</div>\r\n                      )}\r\n                      {booking.customerPhone && (\r\n                        <div className=\"text-sm text-gray-500\">{booking.customerPhone}</div>\r\n                      )}\r\n                    </td>\r\n                    <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                      <div className=\"text-sm text-gray-900\">{booking.serviceName}</div>\r\n                      {booking.serviceDescription && (\r\n                        <div className=\"text-sm text-gray-500\">{booking.serviceDescription}</div>\r\n                      )}\r\n                    </td>\r\n                    <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                      <div className=\"text-sm text-gray-900\">{formatDateTime(booking.startTime)}</div>\r\n                      <div className=\"text-sm text-gray-500\">{dict?.admin?.duration || 'Duration'}: {booking.duration} min</div>\r\n                    </td>\r\n                    <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\">\r\n                      {booking.staffName || booking.staffId?.name || dict?.admin?.unassigned || 'Unassigned'}\r\n                    </td>\r\n                    <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                      <span className={`px-2 py-1 text-xs font-semibold border ${getStatusColor(booking.status)}`}>\r\n                        {dict?.admin?.[booking.status] || booking.status}\r\n                      </span>\r\n                    </td>\r\n                    <td className=\"px-6 py-4 whitespace-nowrap text-sm font-medium\">\r\n                      <div className=\"flex gap-2\">\r\n                        <button\r\n                          onClick={() => {\r\n                            setSelectedBooking(booking);\r\n                            setShowModal(true);\r\n                          }}\r\n                          className=\"text-blue-600 hover:text-blue-900\"\r\n                        >\r\n                          {dict?.common?.view || 'View'}\r\n                        </button>\r\n                        {booking.status === 'pending' || booking.status === 'confirmed' ? (\r\n                          <button\r\n                            onClick={() => handleSendReminder(booking._id)}\r\n                            className=\"text-green-600 hover:text-green-900\"\r\n                          >\r\n                            {dict?.admin?.remind || 'Remind'}\r\n                          </button>\r\n                        ) : null}\r\n                      </div>\r\n                    </td>\r\n                  </tr>\r\n                ))}\r\n              </tbody>\r\n            </table>\r\n            {bookings.length === 0 && (\r\n              <div className=\"text-center py-12 text-gray-500\">\r\n                {dict?.admin?.noBookingsFound || 'No bookings found'}\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Booking Detail Modal */}\r\n      {showModal && selectedBooking && (\r\n        <div className=\"fixed inset-0 bg-gray-900/20 backdrop-blur-sm flex items-center justify-center z-50 p-4\">\r\n          <div className=\"bg-white border border-gray-300 max-w-2xl w-full max-h-[90vh] overflow-y-auto\">\r\n            <div className=\"px-6 py-4 border-b border-gray-200 flex items-center justify-between\">\r\n              <h3 className=\"text-lg font-semibold text-gray-900\">{dict?.admin?.bookingDetails || 'Booking Details'}</h3>\r\n              <button\r\n                onClick={() => {\r\n                  setShowModal(false);\r\n                  setSelectedBooking(null);\r\n                }}\r\n                className=\"text-gray-400 hover:text-gray-600\"\r\n              >\r\n                <svg className=\"w-6 h-6\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\r\n                </svg>\r\n              </button>\r\n            </div>\r\n            <div className=\"px-6 py-4 space-y-4\">\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700\">Customer Name</label>\r\n                <p className=\"mt-1 text-sm text-gray-900\">{selectedBooking.customerName}</p>\r\n              </div>\r\n              {selectedBooking.customerEmail && (\r\n                <div>\r\n                  <label className=\"block text-sm font-medium text-gray-700\">Email</label>\r\n                  <p className=\"mt-1 text-sm text-gray-900\">{selectedBooking.customerEmail}</p>\r\n                </div>\r\n              )}\r\n              {selectedBooking.customerPhone && (\r\n                <div>\r\n                  <label className=\"block text-sm font-medium text-gray-700\">Phone</label>\r\n                  <p className=\"mt-1 text-sm text-gray-900\">{selectedBooking.customerPhone}</p>\r\n                </div>\r\n              )}\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700\">Service</label>\r\n                <p className=\"mt-1 text-sm text-gray-900\">{selectedBooking.serviceName}</p>\r\n                {selectedBooking.serviceDescription && (\r\n                  <p className=\"mt-1 text-sm text-gray-500\">{selectedBooking.serviceDescription}</p>\r\n                )}\r\n              </div>\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700\">Date & Time</label>\r\n                <p className=\"mt-1 text-sm text-gray-900\">{formatDateTime(selectedBooking.startTime)}</p>\r\n                <p className=\"mt-1 text-sm text-gray-500\">Duration: {selectedBooking.duration} minutes</p>\r\n              </div>\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700\">Staff</label>\r\n                <select\r\n                  value={selectedBooking.staffId?._id || ''}\r\n                  onChange={(e) => {\r\n                    handleUpdateBooking(selectedBooking._id, { staffId: e.target.value || undefined });\r\n                  }}\r\n                  className=\"mt-1 block w-full px-3 py-2 border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white\"\r\n                >\r\n                  <option value=\"\">{dict?.admin?.unassigned || 'Unassigned'}</option>\r\n                  {staff.map((s) => (\r\n                    <option key={s._id} value={s._id}>\r\n                      {s.name}\r\n                    </option>\r\n                  ))}\r\n                </select>\r\n              </div>\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700\">Status</label>\r\n                <select\r\n                  value={selectedBooking.status}\r\n                  onChange={(e) => {\r\n                    handleUpdateBooking(selectedBooking._id, { status: e.target.value as Booking['status'] });\r\n                  }}\r\n                  className=\"mt-1 block w-full px-3 py-2 border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white\"\r\n                >\r\n                  <option value=\"pending\">Pending</option>\r\n                  <option value=\"confirmed\">Confirmed</option>\r\n                  <option value=\"completed\">Completed</option>\r\n                  <option value=\"cancelled\">Cancelled</option>\r\n                  <option value=\"no-show\">No Show</option>\r\n                </select>\r\n              </div>\r\n              {selectedBooking.notes && (\r\n                <div>\r\n                  <label className=\"block text-sm font-medium text-gray-700\">Notes</label>\r\n                  <p className=\"mt-1 text-sm text-gray-900\">{selectedBooking.notes}</p>\r\n                </div>\r\n              )}\r\n              <div className=\"flex gap-2 pt-4 border-t border-gray-200\">\r\n                <button\r\n                  onClick={() => handleSendReminder(selectedBooking._id)}\r\n                  className=\"flex-1 px-4 py-2 bg-green-600 text-white hover:bg-green-700 transition-colors border border-green-700\"\r\n                >\r\n                  Send Reminder\r\n                </button>\r\n                <button\r\n                  onClick={() => handleDeleteBooking(selectedBooking._id)}\r\n                  className=\"flex-1 px-4 py-2 bg-red-600 text-white hover:bg-red-700 transition-colors border border-red-700\"\r\n                >\r\n                  Delete\r\n                </button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Create Booking Modal */}\r\n      {showCreateModal && (\r\n        <div className=\"fixed inset-0 bg-gray-900/20 backdrop-blur-sm flex items-center justify-center z-50 p-4\">\r\n          <div className=\"bg-white border border-gray-300 max-w-2xl w-full max-h-[90vh] overflow-y-auto\">\r\n            <div className=\"px-6 py-4 border-b border-gray-200 flex items-center justify-between\">\r\n              <h3 className=\"text-lg font-semibold text-gray-900\">Create New Booking</h3>\r\n              <button\r\n                onClick={() => {\r\n                  setShowCreateModal(false);\r\n                  resetForm();\r\n                }}\r\n                className=\"text-gray-400 hover:text-gray-600\"\r\n              >\r\n                <svg className=\"w-6 h-6\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\r\n                </svg>\r\n              </button>\r\n            </div>\r\n            <form onSubmit={handleCreateBooking} className=\"px-6 py-4 space-y-4\">\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700\">Customer Name *</label>\r\n                <input\r\n                  type=\"text\"\r\n                  required\r\n                  value={formData.customerName}\r\n                  onChange={(e) => setFormData({ ...formData, customerName: e.target.value })}\r\n                  className=\"mt-1 block w-full px-3 py-2 border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white\"\r\n                />\r\n              </div>\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700\">Email</label>\r\n                <input\r\n                  type=\"email\"\r\n                  value={formData.customerEmail}\r\n                  onChange={(e) => setFormData({ ...formData, customerEmail: e.target.value })}\r\n                  className=\"mt-1 block w-full px-3 py-2 border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white\"\r\n                />\r\n              </div>\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700\">Phone</label>\r\n                <input\r\n                  type=\"tel\"\r\n                  value={formData.customerPhone}\r\n                  onChange={(e) => setFormData({ ...formData, customerPhone: e.target.value })}\r\n                  className=\"mt-1 block w-full px-3 py-2 border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white\"\r\n                />\r\n              </div>\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700\">Service Name *</label>\r\n                <input\r\n                  type=\"text\"\r\n                  required\r\n                  value={formData.serviceName}\r\n                  onChange={(e) => setFormData({ ...formData, serviceName: e.target.value })}\r\n                  className=\"mt-1 block w-full px-3 py-2 border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white\"\r\n                />\r\n              </div>\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700\">Service Description</label>\r\n                <textarea\r\n                  value={formData.serviceDescription}\r\n                  onChange={(e) => setFormData({ ...formData, serviceDescription: e.target.value })}\r\n                  rows={3}\r\n                  className=\"mt-1 block w-full px-3 py-2 border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white\"\r\n                />\r\n              </div>\r\n              <div className=\"grid grid-cols-2 gap-4\">\r\n                <div>\r\n                  <label className=\"block text-sm font-medium text-gray-700\">Start Time *</label>\r\n                  <input\r\n                    type=\"datetime-local\"\r\n                    required\r\n                    value={formData.startTime}\r\n                    onChange={(e) => setFormData({ ...formData, startTime: e.target.value })}\r\n                    className=\"mt-1 block w-full px-3 py-2 border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white\"\r\n                  />\r\n                </div>\r\n                <div>\r\n                  <label className=\"block text-sm font-medium text-gray-700\">Duration (minutes) *</label>\r\n                  <input\r\n                    type=\"number\"\r\n                    required\r\n                    min=\"1\"\r\n                    value={formData.duration}\r\n                    onChange={(e) => setFormData({ ...formData, duration: parseInt(e.target.value) })}\r\n                    className=\"mt-1 block w-full px-3 py-2 border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white\"\r\n                  />\r\n                </div>\r\n              </div>\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700\">Staff Member</label>\r\n                <select\r\n                  value={formData.staffId}\r\n                  onChange={(e) => setFormData({ ...formData, staffId: e.target.value })}\r\n                  className=\"mt-1 block w-full px-3 py-2 border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white\"\r\n                >\r\n                  <option value=\"\">{dict?.admin?.unassigned || 'Unassigned'}</option>\r\n                  {staff.map((s) => (\r\n                    <option key={s._id} value={s._id}>\r\n                      {s.name}\r\n                    </option>\r\n                  ))}\r\n                </select>\r\n              </div>\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700\">Status</label>\r\n                <select\r\n                  value={formData.status}\r\n                  onChange={(e) => setFormData({ ...formData, status: e.target.value as Booking['status'] })}\r\n                  className=\"mt-1 block w-full px-3 py-2 border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white\"\r\n                >\r\n                  <option value=\"pending\">Pending</option>\r\n                  <option value=\"confirmed\">Confirmed</option>\r\n                </select>\r\n              </div>\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700\">Notes</label>\r\n                <textarea\r\n                  value={formData.notes}\r\n                  onChange={(e) => setFormData({ ...formData, notes: e.target.value })}\r\n                  rows={3}\r\n                  className=\"mt-1 block w-full px-3 py-2 border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white\"\r\n                />\r\n              </div>\r\n              <div className=\"flex gap-2 pt-4 border-t border-gray-200\">\r\n                <button\r\n                  type=\"button\"\r\n                  onClick={() => {\r\n                    setShowCreateModal(false);\r\n                    resetForm();\r\n                  }}\r\n                  className=\"flex-1 px-4 py-2 border border-gray-300 text-gray-700 hover:bg-gray-50 transition-colors bg-white\"\r\n                >\r\n                  Cancel\r\n                </button>\r\n                <button\r\n                  type=\"submit\"\r\n                  className=\"flex-1 px-4 py-2 bg-blue-600 text-white hover:bg-blue-700 transition-colors border border-blue-700\"\r\n                >\r\n                  Create Booking\r\n                </button>\r\n              </div>\r\n            </form>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\[tenant]\\[lang]\\admin\\branches\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'router' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":38,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":38,"endColumn":15},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":41,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":41,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[952,955],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[952,955],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchBranches'. Either include it or remove the dependency array.","line":54,"column":6,"nodeType":"ArrayExpression","endLine":54,"endColumn":20,"suggestions":[{"desc":"Update the dependencies array to be: [fetchBranches, lang, tenant]","fix":{"range":[1551,1565],"text":"[fetchBranches, lang, tenant]"}}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useEffect, useState } from 'react';\r\nimport Navbar from '@/components/Navbar';\r\nimport { useParams, useRouter } from 'next/navigation';\r\nimport Link from 'next/link';\r\nimport { getDictionaryClient } from '../../dictionaries-client';\r\ninterface Branch {\r\n  _id: string;\r\n  name: string;\r\n  code?: string;\r\n  address?: {\r\n    street?: string;\r\n    city?: string;\r\n    state?: string;\r\n    zipCode?: string;\r\n    country?: string;\r\n  };\r\n  phone?: string;\r\n  email?: string;\r\n  managerId?: {\r\n    _id: string;\r\n    name: string;\r\n    email: string;\r\n  } | string;\r\n  isActive: boolean;\r\n  createdAt: string;\r\n}\r\n\r\ninterface User {\r\n  _id: string;\r\n  name: string;\r\n  email: string;\r\n}\r\n\r\nexport default function BranchesPage() {\r\n  const params = useParams();\r\n  const router = useRouter();\r\n  const tenant = params.tenant as string;\r\n  const lang = params.lang as 'en' | 'es';\r\n  const [dict, setDict] = useState<Record<string, any> | null>(null);\r\n  const [branches, setBranches] = useState<Branch[]>([]);\r\n  const [users, setUsers] = useState<User[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [message, setMessage] = useState<{ type: 'success' | 'error'; text: string } | null>(null);\r\n  const [showBranchModal, setShowBranchModal] = useState(false);\r\n  const [editingBranch, setEditingBranch] = useState<Branch | null>(null);\r\n\r\n  useEffect(() => {\r\n    getDictionaryClient(lang).then(setDict);\r\n    fetchBranches();\r\n    fetchUsers();\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [lang, tenant]);\r\n  \r\n\r\n  const fetchBranches = async () => {\r\n    try {\r\n      const res = await fetch('/api/branches', { credentials: 'include' });\r\n      const data = await res.json();\r\n      if (data.success) {\r\n        setBranches(data.data);\r\n        setMessage(null);\r\n      } else {\r\n        setMessage({ type: 'error', text: data.error || dict?.common?.failedToFetchBranches || 'Failed to fetch branches' });\r\n      }\r\n    } catch (error) {\r\n      console.error('Error fetching branches:', error);\r\n      setMessage({ type: 'error', text: dict?.common?.failedToFetchBranches || 'Failed to fetch branches' });\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const fetchUsers = async () => {\r\n    try {\r\n      const res = await fetch('/api/users', { credentials: 'include' });\r\n      const data = await res.json();\r\n      if (data.success) {\r\n        setUsers(data.data);\r\n      } else {\r\n        console.error('Error fetching users:', data.error);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error fetching users:', error);\r\n    }\r\n  };\r\n\r\n  const handleDeleteBranch = async (branchId: string) => {\r\n    if (!dict) return;\r\n    if (!confirm(dict.common?.deactivateBranchConfirm || dict.admin?.deactivateBranchConfirm || 'Are you sure you want to deactivate this branch?')) return;\r\n    try {\r\n      const res = await fetch(`/api/branches/${branchId}`, { method: 'DELETE', credentials: 'include' });\r\n      const data = await res.json();\r\n      if (data.success) {\r\n        setMessage({ type: 'success', text: dict?.common?.branchDeactivatedSuccess || 'Branch deactivated successfully' });\r\n        fetchBranches();\r\n      } else {\r\n        setMessage({ type: 'error', text: data.error || dict?.common?.failedToDeactivateBranch || 'Failed to deactivate branch' });\r\n      }\r\n    } catch {\r\n      setMessage({ type: 'error', text: dict?.common?.failedToDeactivateBranch || 'Failed to deactivate branch' });\r\n    }\r\n  };\r\n\r\n  const handleToggleBranchStatus = async (branch: Branch) => {\r\n    try {\r\n      const res = await fetch(`/api/branches/${branch._id}`, {\r\n        method: 'PUT',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        credentials: 'include',\r\n        body: JSON.stringify({ isActive: !branch.isActive }),\r\n      });\r\n      const data = await res.json();\r\n      if (data.success) {\r\n        setMessage({ type: 'success', text: `Branch ${!branch.isActive ? (dict?.admin?.activated || 'activated') : (dict?.admin?.deactivated || 'deactivated')} ${dict?.admin?.successfully || 'successfully'}` });\r\n        fetchBranches();\r\n      } else {\r\n        setMessage({ type: 'error', text: data.error || dict?.common?.failedToUpdateBranch || 'Failed to update branch' });\r\n      }\r\n    } catch {\r\n      setMessage({ type: 'error', text: dict?.common?.failedToUpdateBranch || 'Failed to update branch' });\r\n    }\r\n  };\r\n\r\n  if (!dict || loading) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gray-50 flex items-center justify-center\">\r\n        <div className=\"text-center\">\r\n          <div className=\"inline-block animate-spin h-8 w-8 border-b-2 border-blue-600\"></div>\r\n          <p className=\"mt-4 text-gray-600\">Loading...</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50\">\r\n      <Navbar />\r\n      <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 sm:py-8\">\r\n        <div className=\"mb-6 sm:mb-8\">\r\n          <Link\r\n            href={`/${tenant}/${lang}/admin`}\r\n            className=\"inline-flex items-center text-blue-600 hover:text-blue-700 font-medium mb-4 transition-colors\"\r\n          >\r\n            <svg className=\"w-5 h-5 mr-2\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M10 19l-7-7m0 0l7-7m-7 7h18\" />\r\n            </svg>\r\n            {dict?.admin?.backToAdmin || 'Back to Admin'}\r\n          </Link>\r\n          <div className=\"flex items-center justify-between\">\r\n            <div>\r\n              <h1 className=\"text-2xl sm:text-3xl lg:text-4xl font-bold text-gray-900 mb-2\">\r\n                {dict.admin?.branches || 'Branches'}\r\n              </h1>\r\n              <p className=\"text-gray-600\">{dict.admin?.branchesSubtitle || 'Manage store branches and locations'}</p>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {message && (\r\n          <div className={`mb-6 p-4 border ${message.type === 'success' ? 'bg-green-50 text-green-800 border-green-300' : 'bg-red-50 text-red-800 border-red-300'}`}>\r\n            {message.text}\r\n          </div>\r\n        )}\r\n\r\n        <div className=\"bg-white border border-gray-300 p-6\">\r\n          <div className=\"flex justify-between items-center mb-6\">\r\n            <h2 className=\"text-xl font-bold text-gray-900\">{dict.admin?.branches || 'Branches'}</h2>\r\n            <button\r\n              onClick={() => {\r\n                setEditingBranch(null);\r\n                setShowBranchModal(true);\r\n              }}\r\n              className=\"px-4 py-2 bg-blue-600 text-white hover:bg-blue-700 font-medium border border-blue-700\"\r\n            >\r\n              {dict.common?.add || 'Add'} {dict.admin?.branch || 'Branch'}\r\n            </button>\r\n          </div>\r\n          <div className=\"overflow-x-auto\">\r\n            <table className=\"min-w-full divide-y divide-gray-200\">\r\n              <thead className=\"bg-gray-50\">\r\n                <tr>\r\n                  <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">{dict.admin?.name || 'Name'}</th>\r\n                  <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">{dict.admin?.code || 'Code'}</th>\r\n                  <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">{dict.admin?.address || 'Address'}</th>\r\n                  <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">{dict.admin?.manager || 'Manager'}</th>\r\n                  <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">{dict.admin?.status || 'Status'}</th>\r\n                  <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">{dict.common?.actions || 'Actions'}</th>\r\n                </tr>\r\n              </thead>\r\n              <tbody className=\"bg-white divide-y divide-gray-200\">\r\n                {branches.map((branch) => {\r\n                  const managerName = typeof branch.managerId === 'object' && branch.managerId !== null\r\n                    ? branch.managerId.name\r\n                    : '-';\r\n                  const addressStr = branch.address\r\n                    ? `${branch.address.street || ''} ${branch.address.city || ''} ${branch.address.state || ''}`.trim()\r\n                    : '-';\r\n                  return (\r\n                    <tr key={branch._id}>\r\n                      <td className=\"px-4 py-4 whitespace-nowrap text-sm font-medium text-gray-900\">{branch.name}</td>\r\n                      <td className=\"px-4 py-4 whitespace-nowrap text-sm text-gray-500 font-mono\">{branch.code || '-'}</td>\r\n                      <td className=\"px-4 py-4 text-sm text-gray-500\">{addressStr}</td>\r\n                      <td className=\"px-4 py-4 whitespace-nowrap text-sm text-gray-500\">{managerName}</td>\r\n                      <td className=\"px-4 py-4 whitespace-nowrap\">\r\n                        <span className={`px-2 py-1 text-xs font-semibold border ${branch.isActive ? 'bg-green-100 text-green-800 border-green-300' : 'bg-red-100 text-red-800 border-red-300'}`}>\r\n                          {branch.isActive ? (dict.admin?.active || 'Active') : (dict.admin?.inactive || 'Inactive')}\r\n                        </span>\r\n                      </td>\r\n                      <td className=\"px-4 py-4 whitespace-nowrap text-sm font-medium\">\r\n                        <div className=\"flex gap-2\">\r\n                          <button\r\n                            onClick={() => {\r\n                              setEditingBranch(branch);\r\n                              setShowBranchModal(true);\r\n                            }}\r\n                            className=\"text-blue-600 hover:text-blue-900\"\r\n                          >\r\n                            {dict.common?.edit || 'Edit'}\r\n                          </button>\r\n                          <button\r\n                            onClick={() => handleToggleBranchStatus(branch)}\r\n                            className={branch.isActive ? 'text-orange-600 hover:text-orange-900' : 'text-green-600 hover:text-green-900'}\r\n                          >\r\n                            {branch.isActive ? (dict.admin?.deactivate || 'Deactivate') : (dict.admin?.activate || 'Activate')}\r\n                          </button>\r\n                          <button\r\n                            onClick={() => handleDeleteBranch(branch._id)}\r\n                            className=\"text-red-600 hover:text-red-900\"\r\n                          >\r\n                            {dict.common?.delete || 'Delete'}\r\n                          </button>\r\n                        </div>\r\n                      </td>\r\n                    </tr>\r\n                  );\r\n                })}\r\n              </tbody>\r\n            </table>\r\n            {branches.length === 0 && (\r\n              <div className=\"text-center py-8 text-gray-500\">{dict.common?.noResults || 'No branches found'}</div>\r\n            )}\r\n          </div>\r\n        </div>\r\n\r\n        {showBranchModal && (\r\n          <BranchModal\r\n            branch={editingBranch}\r\n            users={users}\r\n            onClose={() => {\r\n              setShowBranchModal(false);\r\n              setEditingBranch(null);\r\n            }}\r\n            onSave={() => {\r\n              fetchBranches();\r\n              setShowBranchModal(false);\r\n              setEditingBranch(null);\r\n            }}\r\n            dict={dict}\r\n          />\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction BranchModal({\r\n  branch,\r\n  users,\r\n  onClose,\r\n  onSave,\r\n  dict,\r\n}: {\r\n  branch: Branch | null;\r\n  users: User[];\r\n  onClose: () => void;\r\n  onSave: () => void;\r\n  dict: Record<string, Record<string, string>> | null;\r\n}) {\r\n  const [formData, setFormData] = useState({\r\n    name: branch?.name || '',\r\n    code: branch?.code || '',\r\n    address: {\r\n      street: branch?.address?.street || '',\r\n      city: branch?.address?.city || '',\r\n      state: branch?.address?.state || '',\r\n      zipCode: branch?.address?.zipCode || '',\r\n      country: branch?.address?.country || '',\r\n    },\r\n    phone: branch?.phone || '',\r\n    email: branch?.email || '',\r\n    managerId: typeof branch?.managerId === 'object' && branch?.managerId !== null\r\n      ? branch.managerId._id\r\n      : branch?.managerId || '',\r\n  });\r\n  const [saving, setSaving] = useState(false);\r\n  const [error, setError] = useState('');\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    setError('');\r\n    setSaving(true);\r\n    try {\r\n      const url = branch ? `/api/branches/${branch._id}` : '/api/branches';\r\n      const method = branch ? 'PUT' : 'POST';\r\n      const body: Record<string, unknown> = {\r\n        name: formData.name,\r\n        code: formData.code || undefined,\r\n        address: formData.address.street || formData.address.city ? formData.address : undefined,\r\n        phone: formData.phone || undefined,\r\n        email: formData.email || undefined,\r\n        managerId: formData.managerId || undefined,\r\n      };\r\n\r\n      const res = await fetch(url, {\r\n        method,\r\n        headers: { 'Content-Type': 'application/json' },\r\n        credentials: 'include',\r\n        body: JSON.stringify(body),\r\n      });\r\n\r\n      const data = await res.json();\r\n      if (data.success) {\r\n        onSave();\r\n      } else {\r\n        setError(data.error || 'Failed to save branch');\r\n      }\r\n    } catch {\r\n      setError('Failed to save branch');\r\n    } finally {\r\n      setSaving(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 bg-gray-900/20 backdrop-blur-sm flex items-center justify-center z-50 p-4\">\r\n      <div className=\"bg-white border border-gray-300 max-w-2xl w-full max-h-[90vh] overflow-y-auto\">\r\n        <div className=\"p-6\">\r\n          <h2 className=\"text-2xl font-bold text-gray-900 mb-4\">\r\n            {branch ? (dict?.admin?.editBranch || 'Edit Branch') : (dict?.admin?.addBranch || 'Add Branch')}\r\n          </h2>\r\n          <form onSubmit={handleSubmit} className=\"space-y-4\">\r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                  {dict?.admin?.name || 'Name'} *\r\n                </label>\r\n                <input\r\n                  type=\"text\"\r\n                  required\r\n                  value={formData.name}\r\n                  onChange={(e) => setFormData({ ...formData, name: e.target.value })}\r\n                  className=\"w-full px-3 py-2 border border-gray-300 focus:ring-2 focus:ring-blue-500 bg-white\"\r\n                />\r\n              </div>\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                  {dict?.admin?.code || 'Code'} (optional)\r\n                </label>\r\n                <input\r\n                  type=\"text\"\r\n                  value={formData.code}\r\n                  onChange={(e) => setFormData({ ...formData, code: e.target.value.toUpperCase() })}\r\n                  className=\"w-full px-3 py-2 border border-gray-300 focus:ring-2 focus:ring-blue-500 bg-white\"\r\n                  placeholder={dict?.admin?.branchCodePlaceholder || 'BR001'}\r\n                />\r\n              </div>\r\n            </div>\r\n            <div>\r\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                {dict?.admin?.address || 'Address'}\r\n              </label>\r\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                <input\r\n                  type=\"text\"\r\n                  value={formData.address.street}\r\n                  onChange={(e) => setFormData({ ...formData, address: { ...formData.address, street: e.target.value } })}\r\n                  className=\"w-full px-3 py-2 border border-gray-300 focus:ring-2 focus:ring-blue-500 bg-white\"\r\n                  placeholder={dict?.admin?.streetPlaceholder || 'Street'}\r\n                />\r\n                <input\r\n                  type=\"text\"\r\n                  value={formData.address.city}\r\n                  onChange={(e) => setFormData({ ...formData, address: { ...formData.address, city: e.target.value } })}\r\n                  className=\"w-full px-3 py-2 border border-gray-300 focus:ring-2 focus:ring-blue-500 bg-white\"\r\n                  placeholder={dict?.admin?.cityPlaceholder || 'City'}\r\n                />\r\n                <input\r\n                  type=\"text\"\r\n                  value={formData.address.state}\r\n                  onChange={(e) => setFormData({ ...formData, address: { ...formData.address, state: e.target.value } })}\r\n                  className=\"w-full px-3 py-2 border border-gray-300 focus:ring-2 focus:ring-blue-500 bg-white\"\r\n                  placeholder={dict?.admin?.statePlaceholder || 'State'}\r\n                />\r\n                <input\r\n                  type=\"text\"\r\n                  value={formData.address.zipCode}\r\n                  onChange={(e) => setFormData({ ...formData, address: { ...formData.address, zipCode: e.target.value } })}\r\n                  className=\"w-full px-3 py-2 border border-gray-300 focus:ring-2 focus:ring-blue-500 bg-white\"\r\n                  placeholder={dict?.admin?.zipPlaceholder || 'ZIP Code'}\r\n                />\r\n                <input\r\n                  type=\"text\"\r\n                  value={formData.address.country}\r\n                  onChange={(e) => setFormData({ ...formData, address: { ...formData.address, country: e.target.value } })}\r\n                  className=\"w-full px-3 py-2 border border-gray-300 focus:ring-2 focus:ring-blue-500 bg-white\"\r\n                  placeholder={dict?.admin?.countryPlaceholder || 'Country'}\r\n                />\r\n              </div>\r\n            </div>\r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                  {dict?.admin?.phone || 'Phone'}\r\n                </label>\r\n                <input\r\n                  type=\"tel\"\r\n                  value={formData.phone}\r\n                  onChange={(e) => setFormData({ ...formData, phone: e.target.value })}\r\n                  className=\"w-full px-3 py-2 border border-gray-300 focus:ring-2 focus:ring-blue-500 bg-white\"\r\n                />\r\n              </div>\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                  {dict?.admin?.email || 'Email'}\r\n                </label>\r\n                <input\r\n                  type=\"email\"\r\n                  value={formData.email}\r\n                  onChange={(e) => setFormData({ ...formData, email: e.target.value })}\r\n                  className=\"w-full px-3 py-2 border border-gray-300 focus:ring-2 focus:ring-blue-500 bg-white\"\r\n                />\r\n              </div>\r\n            </div>\r\n            <div>\r\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                {dict?.admin?.manager || 'Manager'} (optional)\r\n              </label>\r\n              <select\r\n                value={formData.managerId}\r\n                onChange={(e) => setFormData({ ...formData, managerId: e.target.value })}\r\n                className=\"w-full px-3 py-2 border border-gray-300 focus:ring-2 focus:ring-blue-500 bg-white\"\r\n              >\r\n                <option value=\"\">{dict?.common?.select || 'Select Manager'}</option>\r\n                {users.map((u) => (\r\n                  <option key={u._id} value={u._id}>\r\n                    {u.name} ({u.email})\r\n                  </option>\r\n                ))}\r\n              </select>\r\n            </div>\r\n            {error && (\r\n              <div className=\"bg-red-50 text-red-800 border border-red-300 p-3\">\r\n                {error}\r\n              </div>\r\n            )}\r\n            <div className=\"flex gap-3 justify-end pt-4\">\r\n              <button\r\n                type=\"button\"\r\n                onClick={onClose}\r\n                className=\"px-4 py-2 border border-gray-300 text-gray-700 hover:bg-gray-50 bg-white\"\r\n              >\r\n                {dict?.common?.cancel || 'Cancel'}\r\n              </button>\r\n              <button\r\n                type=\"submit\"\r\n                disabled={saving}\r\n                className=\"px-4 py-2 bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-50 border border-blue-700\"\r\n              >\r\n                {saving ? (dict?.common?.loading || 'Saving...') : (dict?.common?.save || 'Save')}\r\n              </button>\r\n            </div>\r\n          </form>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\[tenant]\\[lang]\\admin\\bundles\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":58,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":58,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1785,1788],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1785,1788],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'router' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":70,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":70,"endColumn":15},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":73,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":73,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2125,2128],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2125,2128],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":92,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":92,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3374,3377],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3374,3377],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchBundles'. Either include it or remove the dependency array.","line":111,"column":6,"nodeType":"ArrayExpression","endLine":111,"endColumn":20,"suggestions":[{"desc":"Update the dependencies array to be: [fetchBundles, lang, tenant]","fix":{"range":[4241,4255],"text":"[fetchBundles, lang, tenant]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchAnalytics'. Either include it or remove the dependency array.","line":141,"column":6,"nodeType":"ArrayExpression","endLine":141,"endColumn":59,"suggestions":[{"desc":"Update the dependencies array to be: [showAnalytics, analyticsStartDate, analyticsEndDate, fetchAnalytics]","fix":{"range":[5304,5357],"text":"[showAnalytics, analyticsStartDate, analyticsEndDate, fetchAnalytics]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'fetchBundles' and 'loading'. Either include them or remove the dependency array.","line":207,"column":6,"nodeType":"ArrayExpression","endLine":207,"endColumn":112,"suggestions":[{"desc":"Update the dependencies array to be: [searchTerm, filterActive, filterCategory, filterMinPrice, filterMaxPrice, filterStartDate, filterEndDate, loading, fetchBundles]","fix":{"range":[7612,7718],"text":"[searchTerm, filterActive, filterCategory, filterMinPrice, filterMaxPrice, filterStartDate, filterEndDate, loading, fetchBundles]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":499,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":499,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[21474,21477],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[21474,21477],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":836,"column":9,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":836,"endColumn":12,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[37700,37703],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[37700,37703],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":9,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React, { useEffect, useState, useRef, useMemo } from 'react';\r\nimport Navbar from '@/components/Navbar';\r\nimport { useParams, useRouter } from 'next/navigation';\r\nimport Link from 'next/link';\r\nimport { getDictionaryClient } from '../../dictionaries-client';\r\nimport Currency from '@/components/Currency';\r\nimport { arrayToCSV, downloadCSV, downloadExcel, downloadPDF } from '@/lib/export';\r\nimport dynamic from 'next/dynamic';\r\nimport { useTenantSettings } from '@/contexts/TenantSettingsContext';\r\nimport { getBusinessTypeConfig } from '@/lib/business-types';\r\nimport { getBusinessType } from '@/lib/business-type-helpers';\r\n\r\n// Dynamically import charts to avoid SSR issues\r\nconst BundlePerformanceCharts = dynamic(() => import('@/components/BundlePerformanceCharts'), {\r\n  ssr: false,\r\n  loading: () => (\r\n    <div className=\"w-full h-64 flex items-center justify-center\">\r\n      <div className=\"text-center\">\r\n        <div className=\"inline-block animate-spin h-8 w-8 border-b-2 border-blue-600\"></div>\r\n        <p className=\"mt-4 text-gray-600\">{'Loading chart...'}</p>\r\n      </div>\r\n    </div>\r\n  ),\r\n});\r\n\r\ninterface BundleItem {\r\n  productId: string | { _id: string; name: string; price: number; stock: number };\r\n  productName: string;\r\n  quantity: number;\r\n  variation?: {\r\n    size?: string;\r\n    color?: string;\r\n    type?: string;\r\n  };\r\n}\r\n\r\ninterface Bundle {\r\n  _id: string;\r\n  name: string;\r\n  description?: string;\r\n  price: number;\r\n  items: BundleItem[];\r\n  sku?: string;\r\n  categoryId?: string | { _id: string; name: string };\r\n  trackInventory: boolean;\r\n  isActive: boolean;\r\n  createdAt: string;\r\n}\r\n\r\ninterface Product {\r\n  _id: string;\r\n  name: string;\r\n  price: number;\r\n  stock: number;\r\n  hasVariations: boolean;\r\n  variations?: any[];\r\n  sku?: string;\r\n  description?: string;\r\n}\r\n\r\ninterface Category {\r\n  _id: string;\r\n  name: string;\r\n}\r\n\r\nexport default function BundlesPage() {\r\n  const params = useParams();\r\n  const router = useRouter();\r\n  const tenant = params.tenant as string;\r\n  const lang = params.lang as 'en' | 'es';\r\n  const [dict, setDict] = useState<any>(null);\r\n  const [bundles, setBundles] = useState<Bundle[]>([]);\r\n  const [products, setProducts] = useState<Product[]>([]);\r\n  const [categories, setCategories] = useState<Category[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [productsLoading, setProductsLoading] = useState(true);\r\n  const [message, setMessage] = useState<{ type: 'success' | 'error'; text: string } | null>(null);\r\n  const [showBundleModal, setShowBundleModal] = useState(false);\r\n  const [editingBundle, setEditingBundle] = useState<Bundle | null>(null);\r\n  const [searchTerm, setSearchTerm] = useState('');\r\n  const [filterActive, setFilterActive] = useState<boolean | null>(null);\r\n  const [filterCategory, setFilterCategory] = useState('');\r\n  const [filterMinPrice, setFilterMinPrice] = useState('');\r\n  const [filterMaxPrice, setFilterMaxPrice] = useState('');\r\n  const [filterStartDate, setFilterStartDate] = useState('');\r\n  const [filterEndDate, setFilterEndDate] = useState('');\r\n  const [selectedBundles, setSelectedBundles] = useState<Set<string>>(new Set());\r\n  const [showAdvancedFilters, setShowAdvancedFilters] = useState(false);\r\n  const [showAnalytics, setShowAnalytics] = useState(false);\r\n  const [analytics, setAnalytics] = useState<any>(null);\r\n  const [analyticsLoading, setAnalyticsLoading] = useState(false);\r\n  const [analyticsStartDate, setAnalyticsStartDate] = useState('');\r\n  const [analyticsEndDate, setAnalyticsEndDate] = useState('');\r\n  const { settings } = useTenantSettings();\r\n  const businessTypeConfig = settings ? getBusinessTypeConfig(getBusinessType(settings)) : null;\r\n  const bundlesAllowed = businessTypeConfig?.productTypes?.includes('bundle') ?? true;\r\n\r\n  useEffect(() => {\r\n    getDictionaryClient(lang).then(setDict);\r\n    fetchBundles();\r\n    fetchProducts();\r\n    fetchCategories();\r\n    // Set default analytics date range (last 30 days)\r\n    const end = new Date();\r\n    const start = new Date();\r\n    start.setDate(start.getDate() - 30);\r\n    setAnalyticsEndDate(end.toISOString().split('T')[0]);\r\n    setAnalyticsStartDate(start.toISOString().split('T')[0]);\r\n  }, [lang, tenant]);\r\n\r\n  const fetchAnalytics = async () => {\r\n    if (!analyticsStartDate || !analyticsEndDate) return;\r\n    \r\n    setAnalyticsLoading(true);\r\n    try {\r\n      const params = new URLSearchParams();\r\n      params.append('startDate', analyticsStartDate);\r\n      params.append('endDate', analyticsEndDate);\r\n      \r\n      const res = await fetch(`/api/bundles/analytics?${params}`, { credentials: 'include' });\r\n      const data = await res.json();\r\n      if (data.success) {\r\n        setAnalytics(data.data);\r\n      } else {\r\n        setMessage({ type: 'error', text: data.error || dict?.common?.failedToFetchAnalytics || 'Failed to fetch analytics' });\r\n      }\r\n    } catch (error) {\r\n      console.error('Error fetching analytics:', error);\r\n      setMessage({ type: 'error', text: dict?.common?.failedToFetchAnalytics || 'Failed to fetch analytics' });\r\n    } finally {\r\n      setAnalyticsLoading(false);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (showAnalytics && analyticsStartDate && analyticsEndDate) {\r\n      fetchAnalytics();\r\n    }\r\n  }, [showAnalytics, analyticsStartDate, analyticsEndDate]);\r\n\r\n  const fetchBundles = async () => {\r\n    try {\r\n      const params = new URLSearchParams();\r\n      if (searchTerm) params.append('search', searchTerm);\r\n      if (filterActive !== null) params.append('isActive', filterActive.toString());\r\n      if (filterCategory) params.append('categoryId', filterCategory);\r\n      if (filterMinPrice) params.append('minPrice', filterMinPrice);\r\n      if (filterMaxPrice) params.append('maxPrice', filterMaxPrice);\r\n      if (filterStartDate) params.append('startDate', filterStartDate);\r\n      if (filterEndDate) params.append('endDate', filterEndDate);\r\n      \r\n      const res = await fetch(`/api/bundles?${params}`, { credentials: 'include' });\r\n      const data = await res.json();\r\n      if (data.success) {\r\n        setBundles(data.data);\r\n        setMessage(null);\r\n      } else {\r\n        setMessage({ type: 'error', text: data.error || dict?.common?.failedToFetchBundles || 'Failed to fetch bundles' });\r\n      }\r\n    } catch (error) {\r\n      console.error('Error fetching bundles:', error);\r\n      setMessage({ type: 'error', text: dict?.common?.failedToFetchBundles || 'Failed to fetch bundles' });\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const fetchProducts = async () => {\r\n    setProductsLoading(true);\r\n    try {\r\n      const res = await fetch('/api/products', { credentials: 'include' });\r\n      const data = await res.json();\r\n      if (data.success) {\r\n        setProducts(data.data || []);\r\n      } else {\r\n        console.error('Error fetching products:', data.error);\r\n        setProducts([]);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error fetching products:', error);\r\n      setProducts([]);\r\n    } finally {\r\n      setProductsLoading(false);\r\n    }\r\n  };\r\n\r\n  const fetchCategories = async () => {\r\n    try {\r\n      const res = await fetch('/api/categories', { credentials: 'include' });\r\n      const data = await res.json();\r\n      if (data.success) {\r\n        setCategories(data.data);\r\n      } else {\r\n        console.error('Error fetching categories:', data.error);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error fetching categories:', error);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (!loading) {\r\n      fetchBundles();\r\n    }\r\n  }, [searchTerm, filterActive, filterCategory, filterMinPrice, filterMaxPrice, filterStartDate, filterEndDate]);\r\n\r\n  const handleDeleteBundle = async (bundleId: string) => {\r\n    if (!confirm(dict?.admin?.deleteBundleConfirm || 'Are you sure you want to delete this bundle?')) return;\r\n    try {\r\n      const res = await fetch(`/api/bundles/${bundleId}`, { method: 'DELETE', credentials: 'include' });\r\n      const data = await res.json();\r\n      if (data.success) {\r\n        setMessage({ type: 'success', text: dict?.admin?.deleteBundleSuccess || 'Bundle deleted successfully' });\r\n        fetchBundles();\r\n      } else {\r\n        setMessage({ type: 'error', text: data.error || dict?.admin?.deleteBundleError || 'Failed to delete bundle' });\r\n      }\r\n    } catch (error) {\r\n      setMessage({ type: 'error', text: dict?.admin?.deleteBundleError || 'Failed to delete bundle' });\r\n    }\r\n  };\r\n\r\n  const handleToggleStatus = async (bundle: Bundle) => {\r\n    try {\r\n      const res = await fetch(`/api/bundles/${bundle._id}`, {\r\n        method: 'PUT',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        credentials: 'include',\r\n        body: JSON.stringify({ isActive: !bundle.isActive }),\r\n      });\r\n      const data = await res.json();\r\n      if (data.success) {\r\n        setMessage({ type: 'success', text: `Bundle ${!bundle.isActive ? (dict?.admin?.activated || 'activated') : (dict?.admin?.deactivated || 'deactivated')} ${dict?.admin?.successfully || 'successfully'}` });\r\n        fetchBundles();\r\n      } else {\r\n        setMessage({ type: 'error', text: data.error || dict?.common?.failedToUpdateBundle || 'Failed to update bundle' });\r\n      }\r\n    } catch (error) {\r\n      setMessage({ type: 'error', text: dict?.common?.failedToUpdateBundle || 'Failed to update bundle' });\r\n    }\r\n  };\r\n\r\n  const handleBulkOperation = async (action: 'activate' | 'deactivate') => {\r\n    if (selectedBundles.size === 0) {\r\n      setMessage({ type: 'error', text: dict?.common?.selectAtLeastOneBundle || 'Please select at least one bundle' });\r\n      return;\r\n    }\r\n\r\n    const confirmText = dict?.common?.bulkActionBundleConfirm?.replace('{action}', action).replace('{count}', selectedBundles.size.toString()) || `Are you sure you want to ${action} ${selectedBundles.size} bundle(s)?`;\r\n    if (!confirm(confirmText)) {\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const res = await fetch('/api/bundles/bulk', {\r\n        method: 'PUT',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        credentials: 'include',\r\n        body: JSON.stringify({\r\n          bundleIds: Array.from(selectedBundles),\r\n          action,\r\n        }),\r\n      });\r\n      const data = await res.json();\r\n      if (data.success) {\r\n        setMessage({ type: 'success', text: data.message || `Bundles ${action}d successfully` });\r\n        setSelectedBundles(new Set());\r\n        fetchBundles();\r\n      } else {\r\n        setMessage({ type: 'error', text: data.error || `Failed to ${action} bundles` });\r\n      }\r\n    } catch (error) {\r\n      setMessage({ type: 'error', text: `Failed to ${action} bundles` });\r\n    }\r\n  };\r\n\r\n  const handleSelectAll = () => {\r\n    if (selectedBundles.size === bundles.length) {\r\n      setSelectedBundles(new Set());\r\n    } else {\r\n      setSelectedBundles(new Set(bundles.map(b => b._id)));\r\n    }\r\n  };\r\n\r\n  const handleSelectBundle = (bundleId: string) => {\r\n    const newSelected = new Set(selectedBundles);\r\n    if (newSelected.has(bundleId)) {\r\n      newSelected.delete(bundleId);\r\n    } else {\r\n      newSelected.add(bundleId);\r\n    }\r\n    setSelectedBundles(newSelected);\r\n  };\r\n\r\n  const handleExport = (format: 'csv' | 'excel' | 'pdf' = 'csv') => {\r\n    const headers = [\r\n      'Name',\r\n      'SKU',\r\n      'Category',\r\n      'Price',\r\n      'Items Count',\r\n      'Status',\r\n      'Description',\r\n      'Created At',\r\n    ];\r\n    \r\n    const exportData = bundles.map(bundle => ({\r\n      Name: bundle.name,\r\n      SKU: bundle.sku || '',\r\n      Category: typeof bundle.categoryId === 'object' && bundle.categoryId?.name ? bundle.categoryId.name : '',\r\n      Price: bundle.price,\r\n      'Items Count': bundle.items.length,\r\n      Status: bundle.isActive ? 'Active' : 'Inactive',\r\n      Description: bundle.description || '',\r\n      'Created At': new Date(bundle.createdAt).toLocaleString(),\r\n    }));\r\n\r\n    const baseFilename = `bundles_export_${new Date().toISOString().split('T')[0]}`;\r\n    \r\n    if (format === 'csv') {\r\n      const csv = arrayToCSV(exportData, headers);\r\n      downloadCSV(csv, `${baseFilename}.csv`);\r\n    } else if (format === 'excel') {\r\n      downloadExcel(exportData, headers, baseFilename);\r\n    } else if (format === 'pdf') {\r\n      downloadPDF(exportData, headers, baseFilename, dict.admin?.bundles || 'Bundles');\r\n    }\r\n  };\r\n\r\n  const clearFilters = () => {\r\n    setSearchTerm('');\r\n    setFilterActive(null);\r\n    setFilterCategory('');\r\n    setFilterMinPrice('');\r\n    setFilterMaxPrice('');\r\n    setFilterStartDate('');\r\n    setFilterEndDate('');\r\n  };\r\n\r\n  if (!dict || loading) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gray-50 flex items-center justify-center\">\r\n        <div className=\"text-center\">\r\n          <div className=\"inline-block animate-spin h-8 w-8 border-b-2 border-blue-600\"></div>\r\n          <p className=\"mt-4 text-gray-600\">{dict?.common?.loading || 'Loading...'}</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50\">\r\n      <Navbar />\r\n      <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 sm:py-8\">\r\n        <div className=\"mb-6 sm:mb-8\">\r\n          <Link\r\n            href={`/${tenant}/${lang}/admin`}\r\n            className=\"inline-flex items-center text-blue-600 hover:text-blue-700 font-medium mb-4 transition-colors\"\r\n          >\r\n            <svg className=\"w-5 h-5 mr-2\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M10 19l-7-7m0 0l7-7m-7 7h18\" />\r\n            </svg>\r\n            {dict?.admin?.backToAdmin || 'Back to Admin'}\r\n          </Link>\r\n          <div className=\"flex items-center justify-between\">\r\n            <div>\r\n              <h1 className=\"text-2xl sm:text-3xl lg:text-4xl font-bold text-gray-900 mb-2\">\r\n                {dict.admin?.bundles || 'Product Bundles'}\r\n              </h1>\r\n              <p className=\"text-gray-600\">{dict.admin?.bundlesDescription || 'Manage product bundles and packages'}</p>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {message && (\r\n          <div className={`mb-6 p-4 border ${message.type === 'success' ? 'bg-green-50 text-green-800 border-green-300' : 'bg-red-50 text-red-800 border-red-300'}`}>\r\n            {message.text}\r\n          </div>\r\n        )}\r\n\r\n        {!bundlesAllowed && (\r\n          <div className=\"mb-6 p-4 bg-yellow-50 border-2 border-yellow-300 text-yellow-800\">\r\n            <div className=\"flex items-start gap-3\">\r\n              <svg className=\"w-6 h-6 flex-shrink-0 mt-0.5\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z\" />\r\n              </svg>\r\n              <div>\r\n                <h3 className=\"text-lg font-semibold text-yellow-900 mb-2\">\r\n                  Bundles Not Available\r\n                </h3>\r\n                <p className=\"text-yellow-800\">\r\n                  Product bundles are not available for {businessTypeConfig?.name || 'your business type'}. \r\n                  This feature is typically used for retail and restaurant businesses.\r\n                </p>\r\n                <p className=\"text-sm text-yellow-700 mt-2\">\r\n                  If you need bundles, please update your business type in Settings.\r\n                </p>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {/* Bundle Analytics Section */}\r\n        <div className=\"bg-white border border-gray-300 p-6 mb-6\">\r\n          <div className=\"flex justify-between items-center mb-4\">\r\n            <h2 className=\"text-xl font-bold text-gray-900\">{dict.admin?.bundleAnalytics || 'Bundle Analytics'}</h2>\r\n            <button\r\n              onClick={() => setShowAnalytics(!showAnalytics)}\r\n              className=\"px-4 py-2 border border-gray-300 hover:bg-gray-50 bg-white\"\r\n            >\r\n              {showAnalytics ? (dict.common?.hide || 'Hide') : (dict.admin?.viewAnalytics || 'View Analytics')}\r\n            </button>\r\n          </div>\r\n          {showAnalytics && (\r\n            <div>\r\n              <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4\">\r\n                <div>\r\n                  <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                    {dict.reports?.startDate || 'Start Date'}\r\n                  </label>\r\n                  <input\r\n                    type=\"date\"\r\n                    value={analyticsStartDate}\r\n                    onChange={(e) => setAnalyticsStartDate(e.target.value)}\r\n                    className=\"w-full px-3 py-2 border border-gray-300 focus:ring-2 focus:ring-blue-500 bg-white\"\r\n                  />\r\n                </div>\r\n                <div>\r\n                  <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                    {dict.reports?.endDate || 'End Date'}\r\n                  </label>\r\n                  <input\r\n                    type=\"date\"\r\n                    value={analyticsEndDate}\r\n                    onChange={(e) => setAnalyticsEndDate(e.target.value)}\r\n                    className=\"w-full px-3 py-2 border border-gray-300 focus:ring-2 focus:ring-blue-500 bg-white\"\r\n                  />\r\n                </div>\r\n                <div className=\"flex items-end\">\r\n                  <button\r\n                    onClick={fetchAnalytics}\r\n                    className=\"w-full px-4 py-2 bg-blue-600 text-white hover:bg-blue-700 font-medium border border-blue-700\"\r\n                  >\r\n                    {dict.admin?.loadAnalytics || 'Load Analytics'}\r\n                  </button>\r\n                </div>\r\n              </div>\r\n              \r\n              {analyticsLoading ? (\r\n                <div className=\"text-center py-8\">\r\n                  <div className=\"inline-block animate-spin h-8 w-8 border-b-2 border-blue-600\"></div>\r\n                  <p className=\"mt-4 text-gray-600\">{dict.common?.loading || 'Loading...'}</p>\r\n                </div>\r\n              ) : analytics && (\r\n                <div>\r\n                  {/* Summary Cards */}\r\n                  <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6\">\r\n                    <div className=\"bg-blue-50 border border-blue-200 p-4\">\r\n                      <div className=\"text-sm text-blue-600 mb-1\">{dict.admin?.totalBundles || 'Total Bundles'}</div>\r\n                      <div className=\"text-2xl font-bold text-blue-900\">{analytics.summary.totalBundles}</div>\r\n                    </div>\r\n                    <div className=\"bg-green-50 border border-green-200 p-4\">\r\n                      <div className=\"text-sm text-green-600 mb-1\">{dict.admin?.totalSales || 'Total Sales'}</div>\r\n                      <div className=\"text-2xl font-bold text-green-900\">\r\n                        <Currency amount={analytics.summary.totalSales} />\r\n                      </div>\r\n                    </div>\r\n                    <div className=\"bg-purple-50 border border-purple-200 p-4\">\r\n                      <div className=\"text-sm text-purple-600 mb-1\">{dict.admin?.totalQuantity || 'Total Quantity'}</div>\r\n                      <div className=\"text-2xl font-bold text-purple-900\">{analytics.summary.totalQuantity}</div>\r\n                    </div>\r\n                    <div className=\"bg-orange-50 border border-orange-200 p-4\">\r\n                      <div className=\"text-sm text-orange-600 mb-1\">{dict.admin?.totalTransactions || 'Transactions'}</div>\r\n                      <div className=\"text-2xl font-bold text-orange-900\">{analytics.summary.totalTransactions}</div>\r\n                    </div>\r\n                  </div>\r\n\r\n                  {/* Bundle Performance Charts */}\r\n                  {analytics.analytics && analytics.analytics.length > 0 && (\r\n                    <BundlePerformanceCharts analytics={analytics.analytics} dict={dict} />\r\n                  )}\r\n\r\n                  {/* Analytics Table */}\r\n                  <div className=\"overflow-x-auto\">\r\n                    <table className=\"min-w-full divide-y divide-gray-200\">\r\n                      <thead className=\"bg-gray-50\">\r\n                        <tr>\r\n                          <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">{dict.admin?.bundle || 'Bundle'}</th>\r\n                          <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">{dict.admin?.price || 'Price'}</th>\r\n                          <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">{dict.admin?.totalSales || 'Total Sales'}</th>\r\n                          <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">{dict.admin?.quantity || 'Quantity'}</th>\r\n                          <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">{dict.admin?.transactions || 'Transactions'}</th>\r\n                          <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">{dict.admin?.avgOrderValue || 'Avg Order Value'}</th>\r\n                        </tr>\r\n                      </thead>\r\n                      <tbody className=\"bg-white divide-y divide-gray-200\">\r\n                        {analytics.analytics.map((item: any) => (\r\n                          <tr key={item.bundleId}>\r\n                            <td className=\"px-4 py-4 text-sm font-medium text-gray-900\">{item.bundleName}</td>\r\n                            <td className=\"px-4 py-4 text-sm text-gray-500\"><Currency amount={item.bundlePrice} /></td>\r\n                            <td className=\"px-4 py-4 text-sm font-medium text-gray-900\"><Currency amount={item.totalSales} /></td>\r\n                            <td className=\"px-4 py-4 text-sm text-gray-500\">{item.totalQuantity}</td>\r\n                            <td className=\"px-4 py-4 text-sm text-gray-500\">{item.transactionCount}</td>\r\n                            <td className=\"px-4 py-4 text-sm text-gray-500\"><Currency amount={item.averageOrderValue} /></td>\r\n                          </tr>\r\n                        ))}\r\n                      </tbody>\r\n                    </table>\r\n                    {analytics.analytics.length === 0 && (\r\n                      <div className=\"text-center py-8 text-gray-500\">\r\n                        {dict.admin?.noAnalyticsData || 'No sales data for selected period'}\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n                </div>\r\n              )}\r\n            </div>\r\n          )}\r\n        </div>\r\n\r\n        <div className=\"bg-white border border-gray-300 p-6\">\r\n          <div className=\"flex justify-between items-center mb-4 flex-wrap gap-4\">\r\n            <div className=\"flex-1 max-w-md\">\r\n              <input\r\n                type=\"text\"\r\n                placeholder={dict.common?.search || 'Search bundles...'}\r\n                value={searchTerm}\r\n                onChange={(e) => setSearchTerm(e.target.value)}\r\n                className=\"w-full px-4 py-2 border border-gray-300 focus:ring-2 focus:ring-blue-500 bg-white\"\r\n              />\r\n            </div>\r\n            <div className=\"flex gap-2\">\r\n              <select\r\n                value={filterActive === null ? 'all' : filterActive.toString()}\r\n                onChange={(e) => {\r\n                  const value = e.target.value;\r\n                  setFilterActive(value === 'all' ? null : value === 'true');\r\n                }}\r\n                className=\"px-4 py-2 border border-gray-300 focus:ring-2 focus:ring-blue-500 bg-white\"\r\n              >\r\n                <option value=\"all\">{dict.common?.all || 'All'}</option>\r\n                <option value=\"true\">{dict.admin?.active || 'Active'}</option>\r\n                <option value=\"false\">{dict.admin?.inactive || 'Inactive'}</option>\r\n              </select>\r\n              <button\r\n                onClick={() => setShowAdvancedFilters(!showAdvancedFilters)}\r\n                className=\"px-4 py-2 border border-gray-300 hover:bg-gray-50 bg-white\"\r\n              >\r\n                {dict.admin?.advancedFilters || 'Advanced Filters'}\r\n              </button>\r\n              <div className=\"relative group\">\r\n                <button\r\n                  onClick={() => handleExport('csv')}\r\n                  className=\"px-4 py-2 border border-gray-300 hover:bg-gray-50 bg-white\"\r\n                >\r\n                  {dict.admin?.export || 'Export'} \r\n                </button>\r\n                <div className=\"absolute right-0 mt-1 w-48 bg-white border border-gray-300 shadow-lg hidden group-hover:block z-10\">\r\n                  <button\r\n                    onClick={() => handleExport('csv')}\r\n                    className=\"block w-full text-left px-4 py-2 hover:bg-gray-100 text-sm\"\r\n                  >\r\n                    {dict.admin?.exportCSV || 'Export CSV'}\r\n                  </button>\r\n                  <button\r\n                    onClick={() => handleExport('excel')}\r\n                    className=\"block w-full text-left px-4 py-2 hover:bg-gray-100 text-sm\"\r\n                  >\r\n                    {dict.admin?.exportExcel || 'Export Excel'}\r\n                  </button>\r\n                  <button\r\n                    onClick={() => handleExport('pdf')}\r\n                    className=\"block w-full text-left px-4 py-2 hover:bg-gray-100 text-sm\"\r\n                  >\r\n                    {dict.admin?.exportPDF || 'Export PDF'}\r\n                  </button>\r\n                </div>\r\n              </div>\r\n              {bundlesAllowed && (\r\n                <button\r\n                  onClick={() => {\r\n                    setEditingBundle(null);\r\n                    setShowBundleModal(true);\r\n                  }}\r\n                  className=\"px-4 py-2 bg-blue-600 text-white hover:bg-blue-700 font-medium border border-blue-700\"\r\n                >\r\n                  {dict.common?.add || 'Add'} {dict.admin?.bundle || 'Bundle'}\r\n                </button>\r\n              )}\r\n            </div>\r\n          </div>\r\n\r\n          {/* Advanced Filters */}\r\n          {showAdvancedFilters && (\r\n            <div className=\"mb-4 p-4 bg-gray-50 border border-gray-200\">\r\n              <div className=\"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-6 gap-4\">\r\n                <div>\r\n                  <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                    {dict.admin?.category || 'Category'}\r\n                  </label>\r\n                  <select\r\n                    value={filterCategory}\r\n                    onChange={(e) => setFilterCategory(e.target.value)}\r\n                    className=\"w-full px-3 py-2 border border-gray-300 focus:ring-2 focus:ring-blue-500 bg-white\"\r\n                  >\r\n                    <option value=\"\">{dict.common?.all || 'All'}</option>\r\n                    {categories.map((cat) => (\r\n                      <option key={cat._id} value={cat._id}>\r\n                        {cat.name}\r\n                      </option>\r\n                    ))}\r\n                  </select>\r\n                </div>\r\n                <div>\r\n                  <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                    {dict.admin?.minPrice || 'Min Price'}\r\n                  </label>\r\n                  <input\r\n                    type=\"number\"\r\n                    step=\"0.01\"\r\n                    value={filterMinPrice}\r\n                    onChange={(e) => setFilterMinPrice(e.target.value)}\r\n                    className=\"w-full px-3 py-2 border border-gray-300 focus:ring-2 focus:ring-blue-500 bg-white\"\r\n                    placeholder=\"0.00\"\r\n                  />\r\n                </div>\r\n                <div>\r\n                  <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                    {dict.admin?.maxPrice || 'Max Price'}\r\n                  </label>\r\n                  <input\r\n                    type=\"number\"\r\n                    step=\"0.01\"\r\n                    value={filterMaxPrice}\r\n                    onChange={(e) => setFilterMaxPrice(e.target.value)}\r\n                    className=\"w-full px-3 py-2 border border-gray-300 focus:ring-2 focus:ring-blue-500 bg-white\"\r\n                    placeholder=\"999999.99\"\r\n                  />\r\n                </div>\r\n                <div>\r\n                  <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                    {dict.reports?.startDate || 'Start Date'}\r\n                  </label>\r\n                  <input\r\n                    type=\"date\"\r\n                    value={filterStartDate}\r\n                    onChange={(e) => setFilterStartDate(e.target.value)}\r\n                    className=\"w-full px-3 py-2 border border-gray-300 focus:ring-2 focus:ring-blue-500 bg-white\"\r\n                  />\r\n                </div>\r\n                <div>\r\n                  <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                    {dict.reports?.endDate || 'End Date'}\r\n                  </label>\r\n                  <input\r\n                    type=\"date\"\r\n                    value={filterEndDate}\r\n                    onChange={(e) => setFilterEndDate(e.target.value)}\r\n                    className=\"w-full px-3 py-2 border border-gray-300 focus:ring-2 focus:ring-blue-500 bg-white\"\r\n                  />\r\n                </div>\r\n                <div className=\"flex items-end\">\r\n                  <button\r\n                    onClick={clearFilters}\r\n                    className=\"w-full px-4 py-2 border border-gray-300 hover:bg-gray-50 bg-white\"\r\n                  >\r\n                    {dict.common?.clear || 'Clear'}\r\n                  </button>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          {/* Bulk Actions */}\r\n          {selectedBundles.size > 0 && (\r\n            <div className=\"mb-4 p-3 bg-blue-50 border border-blue-200 flex items-center justify-between\">\r\n              <span className=\"text-sm font-medium text-blue-900\">\r\n                {selectedBundles.size} {dict.admin?.selected || 'selected'}\r\n              </span>\r\n              <div className=\"flex gap-2\">\r\n                <button\r\n                  onClick={() => handleBulkOperation('activate')}\r\n                  className=\"px-4 py-2 bg-green-600 text-white hover:bg-green-700 text-sm\"\r\n                >\r\n                  {dict.admin?.bulkActivate || 'Activate Selected'}\r\n                </button>\r\n                <button\r\n                  onClick={() => handleBulkOperation('deactivate')}\r\n                  className=\"px-4 py-2 bg-yellow-600 text-white hover:bg-yellow-700 text-sm\"\r\n                >\r\n                  {dict.admin?.bulkDeactivate || 'Deactivate Selected'}\r\n                </button>\r\n                <button\r\n                  onClick={() => setSelectedBundles(new Set())}\r\n                  className=\"px-4 py-2 border border-gray-300 hover:bg-gray-50 bg-white text-sm\"\r\n                >\r\n                  {dict.common?.cancel || 'Cancel'}\r\n                </button>\r\n              </div>\r\n            </div>\r\n          )}\r\n          <div className=\"overflow-x-auto\">\r\n            <table className=\"min-w-full divide-y divide-gray-200\">\r\n              <thead className=\"bg-gray-50\">\r\n                <tr>\r\n                  <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase w-12\">\r\n                    <input\r\n                      type=\"checkbox\"\r\n                      checked={selectedBundles.size === bundles.length && bundles.length > 0}\r\n                      onChange={handleSelectAll}\r\n                      className=\"rounded border-gray-300\"\r\n                    />\r\n                  </th>\r\n                  <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">{dict.admin?.name || 'Name'}</th>\r\n                  <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">SKU</th>\r\n                  <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">{dict.admin?.category || 'Category'}</th>\r\n                  <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">{dict.admin?.price || 'Price'}</th>\r\n                  <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">{dict.admin?.items || 'Items'}</th>\r\n                  <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">{dict.admin?.status || 'Status'}</th>\r\n                  <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">{dict.common?.actions || 'Actions'}</th>\r\n                </tr>\r\n              </thead>\r\n              <tbody className=\"bg-white divide-y divide-gray-200\">\r\n                {bundles.map((bundle) => (\r\n                  <tr key={bundle._id}>\r\n                    <td className=\"px-4 py-4\">\r\n                      <input\r\n                        type=\"checkbox\"\r\n                        checked={selectedBundles.has(bundle._id)}\r\n                        onChange={() => handleSelectBundle(bundle._id)}\r\n                        className=\"rounded border-gray-300\"\r\n                      />\r\n                    </td>\r\n                    <td className=\"px-4 py-4\">\r\n                      <div className=\"text-sm font-medium text-gray-900\">{bundle.name}</div>\r\n                      {bundle.description && (\r\n                        <div className=\"text-xs text-gray-500 mt-1\">{bundle.description.substring(0, 50)}...</div>\r\n                      )}\r\n                    </td>\r\n                    <td className=\"px-4 py-4 whitespace-nowrap text-sm text-gray-500\">{bundle.sku || '-'}</td>\r\n                    <td className=\"px-4 py-4 whitespace-nowrap text-sm text-gray-500\">\r\n                      {typeof bundle.categoryId === 'object' && bundle.categoryId?.name ? bundle.categoryId.name : '-'}\r\n                    </td>\r\n                    <td className=\"px-4 py-4 whitespace-nowrap text-sm font-medium text-gray-900\">\r\n                      <Currency amount={bundle.price} />\r\n                    </td>\r\n                    <td className=\"px-4 py-4 whitespace-nowrap text-sm text-gray-500\">\r\n                      {bundle.items.length} {dict.admin?.item || 'item'}{bundle.items.length !== 1 ? 's' : ''}\r\n                    </td>\r\n                    <td className=\"px-4 py-4 whitespace-nowrap\">\r\n                      <span className={`px-2 py-1 text-xs font-semibold border ${\r\n                        bundle.isActive\r\n                          ? 'bg-green-100 text-green-800 border-green-300'\r\n                          : 'bg-gray-100 text-gray-800 border-gray-300'\r\n                      }`}>\r\n                        {bundle.isActive ? (dict.admin?.active || 'Active') : (dict.admin?.inactive || 'Inactive')}\r\n                      </span>\r\n                    </td>\r\n                    <td className=\"px-4 py-4 whitespace-nowrap text-sm font-medium\">\r\n                      <div className=\"flex gap-2\">\r\n                        <button\r\n                          onClick={() => {\r\n                            setEditingBundle(bundle);\r\n                            setShowBundleModal(true);\r\n                          }}\r\n                          className=\"text-blue-600 hover:text-blue-900\"\r\n                        >\r\n                          {dict.common?.edit || 'Edit'}\r\n                        </button>\r\n                        <button\r\n                          onClick={() => handleToggleStatus(bundle)}\r\n                          className={`${bundle.isActive ? 'text-yellow-600 hover:text-yellow-900' : 'text-green-600 hover:text-green-900'}`}\r\n                        >\r\n                          {bundle.isActive ? (dict.admin?.deactivate || 'Deactivate') : (dict.admin?.activate || 'Activate')}\r\n                        </button>\r\n                        <button\r\n                          onClick={() => handleDeleteBundle(bundle._id)}\r\n                          className=\"text-red-600 hover:text-red-900\"\r\n                        >\r\n                          {dict.common?.delete || 'Delete'}\r\n                        </button>\r\n                      </div>\r\n                    </td>\r\n                  </tr>\r\n                ))}\r\n              </tbody>\r\n            </table>\r\n            {bundles.length === 0 && (\r\n              <div className=\"text-center py-8 text-gray-500\">\r\n                {searchTerm || filterActive !== null ? (dict.common?.noResults || 'No bundles found') : (dict.common?.noData || 'No bundles yet')}\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n\r\n        {showBundleModal && bundlesAllowed && (\r\n          <BundleModal\r\n            bundle={editingBundle}\r\n            products={products}\r\n            productsLoading={productsLoading}\r\n            categories={categories}\r\n            onClose={() => {\r\n              setShowBundleModal(false);\r\n              setEditingBundle(null);\r\n            }}\r\n            onSave={() => {\r\n              fetchBundles();\r\n              setShowBundleModal(false);\r\n              setEditingBundle(null);\r\n            }}\r\n            dict={dict}\r\n          />\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction BundleModal({\r\n  bundle,\r\n  products,\r\n  productsLoading,\r\n  categories,\r\n  onClose,\r\n  onSave,\r\n  dict,\r\n}: {\r\n  bundle: Bundle | null;\r\n  products: Product[];\r\n  productsLoading: boolean;\r\n  categories: Category[];\r\n  onClose: () => void;\r\n  onSave: () => void;\r\n  dict: any;\r\n}) {\r\n  const [formData, setFormData] = useState({\r\n    name: bundle?.name || '',\r\n    description: bundle?.description || '',\r\n    price: bundle?.price || 0,\r\n    sku: bundle?.sku || '',\r\n    categoryId: typeof bundle?.categoryId === 'object' && bundle.categoryId?._id ? bundle.categoryId._id : bundle?.categoryId || '',\r\n    trackInventory: bundle?.trackInventory !== undefined ? bundle.trackInventory : true,\r\n    items: bundle?.items || [] as BundleItem[],\r\n  });\r\n  const [saving, setSaving] = useState(false);\r\n  const [error, setError] = useState('');\r\n  const [productSearch, setProductSearch] = useState('');\r\n  const [showProductSuggestions, setShowProductSuggestions] = useState(false);\r\n  const [selectedProduct, setSelectedProduct] = useState<Product | null>(null);\r\n  const [itemQuantity, setItemQuantity] = useState(1);\r\n  const [highlightedIndex, setHighlightedIndex] = useState(-1);\r\n  const searchInputRef = useRef<HTMLInputElement>(null);\r\n  const suggestionsRef = useRef<HTMLDivElement>(null);\r\n  const suggestionItemsRef = useRef<(HTMLButtonElement | null)[]>([]);\r\n\r\n  const filteredProducts = useMemo(() => {\r\n    if (!productSearch.trim()) {\r\n      // Show all products when search is empty (limit to first 20 for performance)\r\n      return products.slice(0, 20);\r\n    }\r\n    \r\n    const searchLower = productSearch.toLowerCase().trim();\r\n    const searchTerms = searchLower.split(/\\s+/);\r\n    \r\n    // Get products that match, with scoring for better sorting\r\n    const scored = products\r\n      .map(product => {\r\n        const nameLower = (product.name || '').toLowerCase();\r\n        const skuLower = (product.sku || '').toLowerCase();\r\n        const descLower = (product.description || '').toLowerCase();\r\n        \r\n        let score = 0;\r\n        let matches = false;\r\n        \r\n        // Check if all search terms match\r\n        const allTermsMatch = searchTerms.every(term => \r\n          nameLower.includes(term) || \r\n          skuLower.includes(term) || \r\n          descLower.includes(term)\r\n        );\r\n        \r\n        if (!allTermsMatch) return null;\r\n        \r\n        matches = true;\r\n        \r\n        // Exact match gets highest score\r\n        if (nameLower === searchLower) score += 1000;\r\n        else if (nameLower.startsWith(searchLower)) score += 50;\r\n        else if (nameLower.includes(searchLower)) score += 10;\r\n        \r\n        // SKU exact match\r\n        if (skuLower === searchLower) score += 500;\r\n        else if (skuLower.includes(searchLower)) score += 20;\r\n        \r\n        // Description match\r\n        if (descLower.includes(searchLower)) score += 5;\r\n        \r\n        return { product, score, matches };\r\n      })\r\n      .filter((item): item is { product: Product; score: number; matches: boolean } => item !== null)\r\n      .sort((a, b) => b.score - a.score)\r\n      .map(item => item.product);\r\n    \r\n    return scored;\r\n  }, [products, productSearch]);\r\n\r\n  // Auto-select product if there's an exact match\r\n  useEffect(() => {\r\n    if (productSearch.trim()) {\r\n      const exactMatch = products.find(\r\n        p => p.name.toLowerCase() === productSearch.toLowerCase()\r\n      );\r\n      if (exactMatch) {\r\n        setSelectedProduct(exactMatch);\r\n      } else if (filteredProducts.length === 1) {\r\n        // Auto-select if only one match\r\n        setSelectedProduct(filteredProducts[0]);\r\n      } else {\r\n        setSelectedProduct(null);\r\n      }\r\n    } else {\r\n      setSelectedProduct(null);\r\n    }\r\n    // Reset highlighted index when search changes\r\n    setHighlightedIndex(-1);\r\n  }, [productSearch, products, filteredProducts]);\r\n\r\n  // Close suggestions when clicking outside\r\n  useEffect(() => {\r\n    const handleClickOutside = (event: MouseEvent) => {\r\n      if (\r\n        searchInputRef.current &&\r\n        !searchInputRef.current.contains(event.target as Node) &&\r\n        suggestionsRef.current &&\r\n        !suggestionsRef.current.contains(event.target as Node)\r\n      ) {\r\n        setShowProductSuggestions(false);\r\n      }\r\n    };\r\n\r\n    document.addEventListener('mousedown', handleClickOutside);\r\n    return () => {\r\n      document.removeEventListener('mousedown', handleClickOutside);\r\n    };\r\n  }, []);\r\n\r\n  const handleAddItem = () => {\r\n    // Use highlighted product, selected product, or try to find match\r\n    let productToAdd = highlightedIndex >= 0 \r\n      ? filteredProducts[highlightedIndex]\r\n      : selectedProduct;\r\n    \r\n    if (!productToAdd && productSearch.trim()) {\r\n      const exactMatch = products.find(\r\n        p => p.name.toLowerCase() === productSearch.toLowerCase()\r\n      );\r\n      if (exactMatch) {\r\n        productToAdd = exactMatch;\r\n      } else if (filteredProducts.length === 1) {\r\n        productToAdd = filteredProducts[0];\r\n      }\r\n    }\r\n    \r\n    if (!productToAdd) {\r\n      return;\r\n    }\r\n    \r\n    // Check if product is already in bundle\r\n    const alreadyAdded = formData.items.some(\r\n      item => (typeof item.productId === 'string' ? item.productId : item.productId._id) === productToAdd._id\r\n    );\r\n    \r\n    if (alreadyAdded) {\r\n      setError(dict?.admin?.productAlreadyInBundle || 'This product is already in the bundle');\r\n      setTimeout(() => setError(''), 3000);\r\n      return;\r\n    }\r\n    \r\n    const newItem: BundleItem = {\r\n      productId: productToAdd._id,\r\n      productName: productToAdd.name,\r\n      quantity: itemQuantity,\r\n    };\r\n    \r\n    setFormData({\r\n      ...formData,\r\n      items: [...formData.items, newItem],\r\n    });\r\n    setSelectedProduct(null);\r\n    setProductSearch('');\r\n    setItemQuantity(1);\r\n    setShowProductSuggestions(false);\r\n    setHighlightedIndex(-1);\r\n    // Focus back on search input\r\n    setTimeout(() => searchInputRef.current?.focus(), 100);\r\n  };\r\n\r\n  const handleProductSearchKeyDown = (e: React.KeyboardEvent<HTMLInputElement>) => {\r\n    if (e.key === 'ArrowDown') {\r\n      e.preventDefault();\r\n      setShowProductSuggestions(true);\r\n      setHighlightedIndex(prev => \r\n        prev < filteredProducts.length - 1 ? prev + 1 : prev\r\n      );\r\n      // Scroll into view\r\n      if (highlightedIndex + 1 < filteredProducts.length) {\r\n        suggestionItemsRef.current[highlightedIndex + 1]?.scrollIntoView({\r\n          block: 'nearest',\r\n          behavior: 'smooth'\r\n        });\r\n      }\r\n    } else if (e.key === 'ArrowUp') {\r\n      e.preventDefault();\r\n      setHighlightedIndex(prev => prev > 0 ? prev - 1 : -1);\r\n      // Scroll into view\r\n      if (highlightedIndex > 0) {\r\n        suggestionItemsRef.current[highlightedIndex - 1]?.scrollIntoView({\r\n          block: 'nearest',\r\n          behavior: 'smooth'\r\n        });\r\n      }\r\n    } else if (e.key === 'Enter') {\r\n      e.preventDefault();\r\n      const productToSelect = highlightedIndex >= 0 \r\n        ? filteredProducts[highlightedIndex]\r\n        : filteredProducts.length > 0 \r\n          ? filteredProducts[0]\r\n          : selectedProduct;\r\n      \r\n      if (productToSelect) {\r\n        // Check if product is already in bundle\r\n        const alreadyAdded = formData.items.some(\r\n          item => (typeof item.productId === 'string' ? item.productId : item.productId._id) === productToSelect._id\r\n        );\r\n        \r\n        if (alreadyAdded) {\r\n          setError(dict?.admin?.productAlreadyInBundle || 'This product is already in the bundle');\r\n          setTimeout(() => setError(''), 3000);\r\n          return;\r\n        }\r\n        \r\n        const newItem: BundleItem = {\r\n          productId: productToSelect._id,\r\n          productName: productToSelect.name,\r\n          quantity: itemQuantity,\r\n        };\r\n        \r\n        setFormData({\r\n          ...formData,\r\n          items: [...formData.items, newItem],\r\n        });\r\n        setSelectedProduct(null);\r\n        setProductSearch('');\r\n        setItemQuantity(1);\r\n        setShowProductSuggestions(false);\r\n        setHighlightedIndex(-1);\r\n        // Focus back on search input\r\n        setTimeout(() => searchInputRef.current?.focus(), 100);\r\n      }\r\n    } else if (e.key === 'Escape') {\r\n      setShowProductSuggestions(false);\r\n      setHighlightedIndex(-1);\r\n    }\r\n  };\r\n\r\n  const handleRemoveItem = (index: number) => {\r\n    setFormData({\r\n      ...formData,\r\n      items: formData.items.filter((_, i) => i !== index),\r\n    });\r\n  };\r\n\r\n  // Helper function to highlight matching text\r\n  const highlightMatch = (text: string, search: string) => {\r\n    if (!search.trim()) return text;\r\n    \r\n    const parts = text.split(new RegExp(`(${search.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&')})`, 'gi'));\r\n    return parts.map((part, i) => \r\n      part.toLowerCase() === search.toLowerCase() ? (\r\n        <mark key={i} className=\"bg-yellow-200 font-semibold\">{part}</mark>\r\n      ) : part\r\n    );\r\n  };\r\n\r\n  const handleSubmit = async (e: React.FormEvent<HTMLFormElement>) => {\r\n    e.preventDefault();\r\n    setError('');\r\n    \r\n    if (formData.items.length === 0) {\r\n      setError(dict?.admin?.bundleItemsRequired || 'At least one item is required');\r\n      return;\r\n    }\r\n\r\n    setSaving(true);\r\n    try {\r\n      const url = bundle ? `/api/bundles/${bundle._id}` : '/api/bundles';\r\n      const method = bundle ? 'PUT' : 'POST';\r\n      const body = {\r\n        name: formData.name,\r\n        description: formData.description || undefined,\r\n        price: formData.price,\r\n        sku: formData.sku || undefined,\r\n        categoryId: formData.categoryId || undefined,\r\n        trackInventory: formData.trackInventory,\r\n        items: formData.items.map(item => ({\r\n          productId: typeof item.productId === 'object' ? item.productId._id : item.productId,\r\n          productName: item.productName,\r\n          quantity: item.quantity,\r\n          variation: item.variation,\r\n        })),\r\n      };\r\n\r\n      const res = await fetch(url, {\r\n        method,\r\n        headers: { 'Content-Type': 'application/json' },\r\n        credentials: 'include',\r\n        body: JSON.stringify(body),\r\n      });\r\n\r\n      const data = await res.json();\r\n      if (data.success) {\r\n        onSave();\r\n      } else {\r\n        setError(data.error || dict?.admin?.saveBundleError || 'Failed to save bundle');\r\n      }\r\n    } catch (error) {\r\n      setError(dict?.admin?.saveBundleError || 'Failed to save bundle');\r\n    } finally {\r\n      setSaving(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 bg-gray-900/20 backdrop-blur-sm flex items-center justify-center z-50 p-4\">\r\n      <div className=\"bg-white border border-gray-300 max-w-3xl w-full max-h-[90vh] overflow-y-auto overflow-x-hidden\">\r\n        <div className=\"p-6\">\r\n          <h2 className=\"text-2xl font-bold text-gray-900 mb-4\">\r\n            {bundle ? (dict.admin?.editBundle || 'Edit Bundle') : (dict.admin?.addBundle || 'Add Bundle')}\r\n          </h2>\r\n          <form onSubmit={handleSubmit} className=\"space-y-4\">\r\n            <div className=\"grid grid-cols-2 gap-4\">\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                  {dict.admin?.name || 'Name'} *\r\n                </label>\r\n                <input\r\n                  type=\"text\"\r\n                  required\r\n                  value={formData.name}\r\n                  onChange={(e) => setFormData({ ...formData, name: e.target.value })}\r\n                  className=\"w-full px-3 py-2 border border-gray-300 focus:ring-2 focus:ring-blue-500 bg-white\"\r\n                />\r\n              </div>\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">SKU</label>\r\n                <input\r\n                  type=\"text\"\r\n                  value={formData.sku}\r\n                  onChange={(e) => setFormData({ ...formData, sku: e.target.value })}\r\n                  className=\"w-full px-3 py-2 border border-gray-300 focus:ring-2 focus:ring-blue-500 bg-white\"\r\n                />\r\n              </div>\r\n            </div>\r\n            <div>\r\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                {dict.admin?.description || 'Description'}\r\n              </label>\r\n              <textarea\r\n                value={formData.description}\r\n                onChange={(e) => setFormData({ ...formData, description: e.target.value })}\r\n                rows={3}\r\n                className=\"w-full px-3 py-2 border border-gray-300 focus:ring-2 focus:ring-blue-500 bg-white\"\r\n              />\r\n            </div>\r\n            <div className=\"grid grid-cols-2 gap-4\">\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                  {dict.admin?.price || 'Price'} *\r\n                </label>\r\n                <input\r\n                  type=\"number\"\r\n                  step=\"0.01\"\r\n                  min=\"0\"\r\n                  required\r\n                  value={formData.price}\r\n                  onChange={(e) => setFormData({ ...formData, price: parseFloat(e.target.value) || 0 })}\r\n                  className=\"w-full px-3 py-2 border border-gray-300 focus:ring-2 focus:ring-blue-500 bg-white\"\r\n                />\r\n              </div>\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                  {dict.admin?.category || 'Category'}\r\n                </label>\r\n                <select\r\n                  value={typeof formData.categoryId === 'string' ? formData.categoryId : formData.categoryId?._id || ''}\r\n                  onChange={(e) => setFormData({ ...formData, categoryId: e.target.value })}\r\n                  className=\"w-full px-3 py-2 border border-gray-300 focus:ring-2 focus:ring-blue-500 bg-white\"\r\n                >\r\n                  <option value=\"\">{dict.common?.none || 'None'}</option>\r\n                  {categories.map((cat) => (\r\n                    <option key={cat._id} value={cat._id}>\r\n                      {cat.name}\r\n                    </option>\r\n                  ))}\r\n                </select>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Bundle Items */}\r\n            <div>\r\n              <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                {dict.admin?.bundleItems || 'Bundle Items'} *\r\n              </label>\r\n              \r\n              {/* Add Item Section */}\r\n              <div className=\"mb-4 p-4 border border-gray-300 bg-gray-50\">\r\n                <div className=\"grid grid-cols-3 gap-2 mb-2\">\r\n                  <div className=\"col-span-2 relative z-10\">\r\n                    <input\r\n                      ref={searchInputRef}\r\n                      type=\"text\"\r\n                      value={productSearch}\r\n                      onChange={(e) => {\r\n                        setProductSearch(e.target.value);\r\n                        setShowProductSuggestions(true);\r\n                      }}\r\n                      onFocus={() => {\r\n                        if (!productsLoading) {\r\n                          setShowProductSuggestions(true);\r\n                        }\r\n                      }}\r\n                      onKeyDown={handleProductSearchKeyDown}\r\n                      placeholder={dict.admin?.searchProduct || 'Search products...'}\r\n                      className=\"w-full px-3 py-2 border border-gray-300 focus:ring-2 focus:ring-blue-500 bg-white\"\r\n                      autoComplete=\"off\"\r\n                    />\r\n                    {showProductSuggestions && (\r\n                      <div \r\n                        ref={suggestionsRef}\r\n                        className=\"absolute z-[100] w-full mt-1 bg-white border border-gray-300 shadow-xl rounded-md max-h-60 overflow-y-auto\"\r\n                        style={{ top: '100%' }}\r\n                      >\r\n                        {productsLoading ? (\r\n                          <div className=\"px-4 py-2 text-sm text-gray-500\">\r\n                            {dict.admin?.loadingProducts || 'Loading products...'}\r\n                          </div>\r\n                        ) : products.length === 0 ? (\r\n                          <div className=\"px-4 py-2 text-sm text-gray-500\">\r\n                            {dict.admin?.noProductsAvailable || 'No products available'}\r\n                          </div>\r\n                        ) : filteredProducts.length > 0 ? (\r\n                          filteredProducts.map((product, index) => {\r\n                            const isHighlighted = index === highlightedIndex;\r\n                            const isAlreadyAdded = formData.items.some(\r\n                              item => (typeof item.productId === 'string' ? item.productId : item.productId._id) === product._id\r\n                            );\r\n                            \r\n                            return (\r\n                              <button\r\n                                key={product._id}\r\n                                ref={el => { suggestionItemsRef.current[index] = el; }}\r\n                                type=\"button\"\r\n                                onClick={() => {\r\n                                  if (isAlreadyAdded) {\r\n                                    setError(dict?.admin?.productAlreadyInBundle || 'This product is already in the bundle');\r\n                                    setTimeout(() => setError(''), 3000);\r\n                                    return;\r\n                                  }\r\n                                  setSelectedProduct(product);\r\n                                  setProductSearch(product.name);\r\n                                  setShowProductSuggestions(false);\r\n                                  setHighlightedIndex(-1);\r\n                                }}\r\n                                onMouseEnter={() => setHighlightedIndex(index)}\r\n                                className={`w-full text-left px-4 py-2 focus:outline-none transition-colors border-b border-gray-100 last:border-b-0 ${\r\n                                  isHighlighted \r\n                                    ? 'bg-blue-100 border-blue-300' \r\n                                    : 'hover:bg-blue-50'\r\n                                } ${isAlreadyAdded ? 'opacity-50 cursor-not-allowed' : ''}`}\r\n                                disabled={isAlreadyAdded}\r\n                              >\r\n                                <div className=\"font-medium flex items-center justify-between\">\r\n                                  <span>{highlightMatch(product.name, productSearch)}</span>\r\n                                  {isAlreadyAdded && (\r\n                                    <span className=\"text-xs text-gray-400 ml-2\">(Already added)</span>\r\n                                  )}\r\n                                </div>\r\n                                <div className=\"text-sm text-gray-500 flex items-center gap-2 mt-1\">\r\n                                  <Currency amount={product.price} />\r\n                                  {product.sku && (\r\n                                    <span className=\"text-xs\">SKU: {highlightMatch(product.sku, productSearch)}</span>\r\n                                  )}\r\n                                  {product.stock !== undefined && (\r\n                                    <span className={`ml-2 ${product.stock === 0 ? 'text-red-500' : ''}`}>\r\n                                       Stock: {product.stock}\r\n                                    </span>\r\n                                  )}\r\n                                </div>\r\n                              </button>\r\n                            );\r\n                          })\r\n                        ) : (\r\n                          <div className=\"px-4 py-2 text-sm text-gray-500\">\r\n                            {dict.admin?.noProductsFound || 'No products found'}\r\n                          </div>\r\n                        )}\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n                  <div>\r\n                    <input\r\n                      type=\"number\"\r\n                      min=\"1\"\r\n                      value={itemQuantity}\r\n                      onChange={(e) => setItemQuantity(parseInt(e.target.value) || 1)}\r\n                      placeholder={dict.admin?.quantity || 'Qty'}\r\n                      className=\"w-full px-3 py-2 border border-gray-300 focus:ring-2 focus:ring-blue-500 bg-white\"\r\n                    />\r\n                  </div>\r\n                  <button\r\n                    type=\"button\"\r\n                    onClick={handleAddItem}\r\n                    disabled={\r\n                      !selectedProduct && \r\n                      highlightedIndex < 0 && \r\n                      filteredProducts.length !== 1 &&\r\n                      !productSearch.trim()\r\n                    }\r\n                    className=\"px-4 py-2 bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed border border-blue-700 transition-colors\"\r\n                  >\r\n                    {dict.common?.add || 'Add'}\r\n                  </button>\r\n                </div>\r\n              </div>\r\n\r\n              {/* Items List */}\r\n              <div className=\"space-y-2\">\r\n                {formData.items.map((item, index) => (\r\n                  <div key={index} className=\"flex items-center justify-between p-3 border border-gray-300 bg-white\">\r\n                    <div className=\"flex-1\">\r\n                      <span className=\"font-medium\">{item.productName}</span>\r\n                      <span className=\"ml-2 text-sm text-gray-500\">x {item.quantity}</span>\r\n                    </div>\r\n                    <button\r\n                      type=\"button\"\r\n                      onClick={() => handleRemoveItem(index)}\r\n                      className=\"text-red-600 hover:text-red-900 ml-4\"\r\n                    >\r\n                      {dict.common?.remove || 'Remove'}\r\n                    </button>\r\n                  </div>\r\n                ))}\r\n                {formData.items.length === 0 && (\r\n                  <div className=\"text-center py-4 text-gray-500 text-sm\">\r\n                    {dict.admin?.noItems || 'No items added. Add products to create a bundle.'}\r\n                  </div>\r\n                )}\r\n              </div>\r\n            </div>\r\n\r\n            <div>\r\n              <label className=\"flex items-center\">\r\n                <input\r\n                  type=\"checkbox\"\r\n                  checked={formData.trackInventory}\r\n                  onChange={(e) => setFormData({ ...formData, trackInventory: e.target.checked })}\r\n                  className=\"mr-2\"\r\n                />\r\n                <span className=\"text-sm font-medium text-gray-700\">\r\n                  {dict.admin?.trackInventory || 'Track Inventory'}\r\n                </span>\r\n              </label>\r\n            </div>\r\n\r\n            {error && (\r\n              <div className=\"bg-red-50 text-red-800 border border-red-300 p-3\">\r\n                {error}\r\n              </div>\r\n            )}\r\n            <div className=\"flex gap-3 justify-end pt-4\">\r\n              <button\r\n                type=\"button\"\r\n                onClick={onClose}\r\n                className=\"px-4 py-2 border border-gray-300 text-gray-700 hover:bg-gray-50 bg-white\"\r\n              >\r\n                {dict.common?.cancel || 'Cancel'}\r\n              </button>\r\n              <button\r\n                type=\"submit\"\r\n                disabled={saving}\r\n                className=\"px-4 py-2 bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-50 border border-blue-700\"\r\n              >\r\n                {saving ? (dict.common?.loading || 'Saving...') : (dict.common?.save || 'Save')}\r\n              </button>\r\n            </div>\r\n          </form>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\[tenant]\\[lang]\\admin\\business-hours\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":15,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":15,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[588,591],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[588,591],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchSettings'. Either include it or remove the dependency array.","line":22,"column":6,"nodeType":"ArrayExpression","endLine":22,"endColumn":20,"suggestions":[{"desc":"Update the dependencies array to be: [fetchSettings, lang, tenant]","fix":{"range":[821,835],"text":"[fetchSettings, lang, tenant]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useEffect, useState } from 'react';\r\nimport Navbar from '@/components/Navbar';\r\nimport BusinessHoursManager from '@/components/settings/BusinessHoursManager';\r\nimport { useParams } from 'next/navigation';\r\nimport Link from 'next/link';\r\nimport { getDictionaryClient } from '../../dictionaries-client';\r\nimport { ITenantSettings } from '@/models/Tenant';\r\n\r\nexport default function BusinessHoursAdminPage() {\r\n  const params = useParams();\r\n  const tenant = params.tenant as string;\r\n  const lang = params.lang as 'en' | 'es';\r\n  const [dict, setDict] = useState<any>(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [settings, setSettings] = useState<ITenantSettings | null>(null);\r\n\r\n  useEffect(() => {\r\n    getDictionaryClient(lang).then(setDict);\r\n    fetchSettings();\r\n  }, [lang, tenant]);\r\n\r\n  const fetchSettings = async () => {\r\n    try {\r\n      setLoading(true);\r\n      const res = await fetch(`/api/tenants/${tenant}/settings`);\r\n      const data = await res.json();\r\n      if (data.success) {\r\n        setSettings(data.data);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error fetching settings:', error);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  if (!dict || loading || !settings) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gray-50 flex items-center justify-center\">\r\n        <div className=\"text-center\">\r\n          <div className=\"inline-block animate-spin h-8 w-8 border-b-2 border-blue-600\"></div>\r\n          <p className=\"mt-4 text-gray-600\">{dict?.common?.loading || 'Loading...'}</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50\">\r\n      <Navbar />\r\n      <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 sm:py-8\">\r\n        <div className=\"mb-6 sm:mb-8\">\r\n          <Link\r\n            href={`/${tenant}/${lang}/admin`}\r\n            className=\"inline-flex items-center text-blue-600 hover:text-blue-700 font-medium mb-4 transition-colors\"\r\n          >\r\n            <svg className=\"w-5 h-5 mr-2\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M10 19l-7-7m0 0l7-7m-7 7h18\" />\r\n            </svg>\r\n            {dict?.admin?.backToAdmin || 'Back to Admin'}\r\n          </Link>\r\n          <h1 className=\"text-2xl sm:text-3xl lg:text-4xl font-bold text-gray-900 mb-2\">\r\n            {dict?.admin?.businessHours || 'Business Hours'}\r\n          </h1>\r\n          <p className=\"text-gray-600\">\r\n            {dict?.admin?.businessHoursSubtitle || 'Configure weekly schedule, special hours, and break times. This affects booking availability and business operations.'}\r\n          </p>\r\n        </div>\r\n\r\n        <div className=\"bg-white border border-gray-300 p-5 sm:p-6 lg:p-8\">\r\n          <BusinessHoursManager\r\n            settings={settings}\r\n            tenant={tenant}\r\n            onUpdate={(updates) => {\r\n              setSettings({ ...settings, ...updates });\r\n            }}\r\n          />\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\[tenant]\\[lang]\\admin\\cash-drawer\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'router' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":28,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":28,"endColumn":15},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":31,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":31,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[970,973],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[970,973],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'settings' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":37,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":37,"endColumn":19},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchSessions'. Either include it or remove the dependency array.","line":43,"column":6,"nodeType":"ArrayExpression","endLine":43,"endColumn":34,"suggestions":[{"desc":"Update the dependencies array to be: [lang, tenant, statusFilter, fetchSessions]","fix":{"range":[1505,1533],"text":"[lang, tenant, statusFilter, fetchSessions]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useEffect, useState } from 'react';\r\nimport Navbar from '@/components/Navbar';\r\nimport { useParams, useRouter } from 'next/navigation';\r\nimport Link from 'next/link';\r\nimport { getDictionaryClient } from '../../dictionaries-client';\r\nimport Currency from '@/components/Currency';\r\nimport { useTenantSettings } from '@/contexts/TenantSettingsContext';\r\n\r\ninterface CashDrawerSession {\r\n  _id: string;\r\n  userId: string | { _id: string; name: string; email: string };\r\n  openingAmount: number;\r\n  closingAmount?: number;\r\n  expectedAmount?: number;\r\n  shortage?: number;\r\n  overage?: number;\r\n  openingTime: string;\r\n  closingTime?: string;\r\n  status: 'open' | 'closed';\r\n  notes?: string;\r\n  createdAt: string;\r\n}\r\n\r\nexport default function CashDrawerPage() {\r\n  const params = useParams();\r\n  const router = useRouter();\r\n  const tenant = params.tenant as string;\r\n  const lang = params.lang as 'en' | 'es';\r\n  const [dict, setDict] = useState<any>(null);\r\n  const [sessions, setSessions] = useState<CashDrawerSession[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [selectedSession, setSelectedSession] = useState<CashDrawerSession | null>(null);\r\n  const [statusFilter, setStatusFilter] = useState<string>('');\r\n  const [message, setMessage] = useState<{ type: 'success' | 'error'; text: string } | null>(null);\r\n  const { settings } = useTenantSettings();\r\n\r\n   \r\n  useEffect(() => {\r\n    getDictionaryClient(lang).then(setDict);\r\n    fetchSessions();\r\n  }, [lang, tenant, statusFilter]);\r\n\r\n  const fetchSessions = async () => {\r\n    try {\r\n      let url = '/api/cash-drawer/sessions';\r\n      if (statusFilter) url += `?status=${statusFilter}`;\r\n      \r\n      const res = await fetch(url, { credentials: 'include' });\r\n      const data = await res.json();\r\n      if (data.success) {\r\n        setSessions(data.data);\r\n        setMessage(null);\r\n      } else {\r\n        setMessage({ type: 'error', text: data.error || dict?.common?.failedToFetchCashDrawerSessions || 'Failed to fetch cash drawer sessions' });\r\n      }\r\n    } catch (error) {\r\n      console.error('Error fetching cash drawer sessions:', error);\r\n      setMessage({ type: 'error', text: dict?.common?.failedToFetchCashDrawerSessions || 'Failed to fetch cash drawer sessions' });\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  if (!dict || loading) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gray-50 flex items-center justify-center\">\r\n        <div className=\"text-center\">\r\n          <div className=\"inline-block animate-spin h-8 w-8 border-b-2 border-blue-600\"></div>\r\n          <p className=\"mt-4 text-gray-600\">{dict?.common?.loading || 'Loading...'}</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50\">\r\n      <Navbar />\r\n      <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 sm:py-8\">\r\n        <div className=\"mb-6 sm:mb-8\">\r\n          <Link\r\n            href={`/${tenant}/${lang}/admin`}\r\n            className=\"inline-flex items-center text-blue-600 hover:text-blue-700 font-medium mb-4 transition-colors\"\r\n          >\r\n            <svg className=\"w-5 h-5 mr-2\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M10 19l-7-7m0 0l7-7m-7 7h18\" />\r\n            </svg>\r\n            {dict?.admin?.backToAdmin || 'Back to Admin'}\r\n          </Link>\r\n          <div className=\"flex items-center justify-between\">\r\n            <div>\r\n              <h1 className=\"text-2xl sm:text-3xl lg:text-4xl font-bold text-gray-900 mb-2\">\r\n                {dict.admin?.cashDrawer || 'Cash Drawer Sessions'}\r\n              </h1>\r\n              <p className=\"text-gray-600\">{dict.admin?.cashDrawerSubtitle || 'Manage and monitor cash drawer operations'}</p>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {message && (\r\n          <div className={`mb-6 p-4 border ${message.type === 'success' ? 'bg-green-50 text-green-800 border-green-300' : 'bg-red-50 text-red-800 border-red-300'}`}>\r\n            {message.text}\r\n          </div>\r\n        )}\r\n\r\n        <div className=\"bg-white border border-gray-300 p-6\">\r\n          <div className=\"mb-4\">\r\n            <select\r\n              value={statusFilter}\r\n              onChange={(e) => setStatusFilter(e.target.value)}\r\n              className=\"px-4 py-2 border border-gray-300 focus:ring-2 focus:ring-blue-500 bg-white\"\r\n            >\r\n              <option value=\"\">{dict.admin?.allSessions || 'All Sessions'}</option>\r\n              <option value=\"open\">{dict.admin?.openSessions || 'Open Sessions'}</option>\r\n              <option value=\"closed\">{dict.admin?.closedSessions || 'Closed Sessions'}</option>\r\n            </select>\r\n          </div>\r\n          <div className=\"overflow-x-auto\">\r\n            <table className=\"min-w-full divide-y divide-gray-200\">\r\n              <thead className=\"bg-gray-50\">\r\n                <tr>\r\n                  <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">{dict.admin?.user || 'User'}</th>\r\n                  <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">{dict.admin?.openingTime || 'Opening Time'}</th>\r\n                  <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">{dict.admin?.openingAmount || 'Opening Amount'}</th>\r\n                  <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">{dict.admin?.closingTime || 'Closing Time'}</th>\r\n                  <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">{dict.admin?.expectedAmount || 'Expected Amount'}</th>\r\n                  <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">{dict.admin?.closingAmount || 'Closing Amount'}</th>\r\n                  <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">{dict.admin?.difference || 'Difference'}</th>\r\n                  <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">{dict.admin?.status || 'Status'}</th>\r\n                  <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">{dict.common?.actions || 'Actions'}</th>\r\n                </tr>\r\n              </thead>\r\n              <tbody className=\"bg-white divide-y divide-gray-200\">\r\n                {sessions.map((session) => {\r\n                  const userName = typeof session.userId === 'object' ? session.userId.name : 'Unknown';\r\n                  const difference = session.closingAmount !== undefined && session.expectedAmount !== undefined\r\n                    ? session.closingAmount - session.expectedAmount\r\n                    : null;\r\n                  \r\n                  return (\r\n                    <tr key={session._id}>\r\n                      <td className=\"px-4 py-4 whitespace-nowrap text-sm text-gray-900\">{userName}</td>\r\n                      <td className=\"px-4 py-4 whitespace-nowrap text-sm text-gray-500\">\r\n                        {new Date(session.openingTime).toLocaleString()}\r\n                      </td>\r\n                      <td className=\"px-4 py-4 whitespace-nowrap text-sm font-medium text-gray-900\">\r\n                        <Currency amount={session.openingAmount} />\r\n                      </td>\r\n                      <td className=\"px-4 py-4 whitespace-nowrap text-sm text-gray-500\">\r\n                        {session.closingTime ? new Date(session.closingTime).toLocaleString() : '-'}\r\n                      </td>\r\n                      <td className=\"px-4 py-4 whitespace-nowrap text-sm text-gray-500\">\r\n                        {session.expectedAmount !== undefined ? <Currency amount={session.expectedAmount} /> : '-'}\r\n                      </td>\r\n                      <td className=\"px-4 py-4 whitespace-nowrap text-sm font-medium text-gray-900\">\r\n                        {session.closingAmount !== undefined ? <Currency amount={session.closingAmount} /> : '-'}\r\n                      </td>\r\n                      <td className=\"px-4 py-4 whitespace-nowrap text-sm font-medium\">\r\n                        {difference !== null ? (\r\n                          <span className={difference >= 0 ? 'text-green-600' : 'text-red-600'}>\r\n                            {difference >= 0 ? '+' : ''}<Currency amount={Math.abs(difference)} />\r\n                            {session.shortage && <div className=\"text-xs text-red-600\">{dict.admin?.shortage || 'Shortage'}: <Currency amount={session.shortage} /></div>}\r\n                            {session.overage && <div className=\"text-xs text-green-600\">{dict.admin?.overage || 'Overage'}: <Currency amount={session.overage} /></div>}\r\n                          </span>\r\n                        ) : '-'}\r\n                      </td>\r\n                      <td className=\"px-4 py-4 whitespace-nowrap\">\r\n                        <span className={`px-2 py-1 text-xs font-semibold border ${\r\n                          session.status === 'open' ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-800'\r\n                        }`}>\r\n                          {session.status === 'open' ? (dict.admin?.open || 'Open') : (dict.admin?.closed || 'Closed')}\r\n                        </span>\r\n                      </td>\r\n                      <td className=\"px-4 py-4 whitespace-nowrap text-sm font-medium\">\r\n                        <button\r\n                          onClick={() => setSelectedSession(session)}\r\n                          className=\"text-blue-600 hover:text-blue-900\"\r\n                        >\r\n                          {dict.common?.view || 'View'}\r\n                        </button>\r\n                      </td>\r\n                    </tr>\r\n                  );\r\n                })}\r\n              </tbody>\r\n            </table>\r\n            {sessions.length === 0 && (\r\n              <div className=\"text-center py-8 text-gray-500\">{dict.common?.noResults || 'No cash drawer sessions found'}</div>\r\n            )}\r\n          </div>\r\n        </div>\r\n\r\n        {selectedSession && (\r\n          <CashDrawerDetailModal\r\n            session={selectedSession}\r\n            onClose={() => setSelectedSession(null)}\r\n            dict={dict}\r\n          />\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction CashDrawerDetailModal({\r\n  session,\r\n  onClose,\r\n  dict,\r\n}: {\r\n  session: CashDrawerSession;\r\n  onClose: () => void;\r\n  dict: Record<string, Record<string, string>> | null;\r\n}) {\r\n  const userName = typeof session.userId === 'object' ? session.userId.name : 'Unknown';\r\n  const userEmail = typeof session.userId === 'object' ? session.userId.email : '';\r\n  \r\n  return (\r\n    <div className=\"fixed inset-0 bg-gray-900/20 backdrop-blur-sm flex items-center justify-center z-50 p-4\">\r\n      <div className=\"bg-white border border-gray-300 max-w-2xl w-full max-h-[90vh] overflow-y-auto\">\r\n        <div className=\"p-6\">\r\n          <div className=\"flex justify-between items-center mb-4\">\r\n            <h2 className=\"text-2xl font-bold text-gray-900\">\r\n              {dict?.admin?.cashDrawerDetails || 'Cash Drawer Session Details'}\r\n            </h2>\r\n            <button\r\n              onClick={onClose}\r\n              className=\"text-gray-400 hover:text-gray-600\"\r\n            >\r\n              <svg className=\"w-6 h-6\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\r\n              </svg>\r\n            </button>\r\n          </div>\r\n          <div className=\"space-y-4\">\r\n            <div className=\"grid grid-cols-2 gap-4\">\r\n              <div>\r\n                <label className=\"text-sm font-medium text-gray-500\">{dict?.admin?.user || 'User'}</label>\r\n                <div className=\"text-lg\">{userName}</div>\r\n                {userEmail && <div className=\"text-sm text-gray-500\">{userEmail}</div>}\r\n              </div>\r\n              <div>\r\n                <label className=\"text-sm font-medium text-gray-500\">{dict?.admin?.status || 'Status'}</label>\r\n                <div>\r\n                  <span className={`px-2 py-1 text-xs font-semibold border ${\r\n                    session.status === 'open' ? 'bg-green-100 text-green-800 border-green-300' : 'bg-gray-100 text-gray-800 border-gray-300'\r\n                  }`}>\r\n                    {session.status === 'open' ? (dict?.admin?.open || 'Open') : (dict?.admin?.closed || 'Closed')}\r\n                  </span>\r\n                </div>\r\n              </div>\r\n            </div>\r\n            <div className=\"grid grid-cols-2 gap-4\">\r\n              <div>\r\n                <label className=\"text-sm font-medium text-gray-500\">{dict?.admin?.openingTime || 'Opening Time'}</label>\r\n                <div className=\"text-lg\">{new Date(session.openingTime).toLocaleString()}</div>\r\n              </div>\r\n              {session.closingTime && (\r\n                <div>\r\n                  <label className=\"text-sm font-medium text-gray-500\">{dict?.admin?.closingTime || 'Closing Time'}</label>\r\n                  <div className=\"text-lg\">{new Date(session.closingTime).toLocaleString()}</div>\r\n                </div>\r\n              )}\r\n            </div>\r\n            <div className=\"border-t pt-4 space-y-2\">\r\n              <div className=\"flex justify-between\">\r\n                <span className=\"text-gray-600\">Opening Amount:</span>\r\n                <span className=\"font-medium\"><Currency amount={session.openingAmount} /></span>\r\n              </div>\r\n              {session.expectedAmount !== undefined && (\r\n                <div className=\"flex justify-between\">\r\n                  <span className=\"text-gray-600\">Expected Amount:</span>\r\n                  <span className=\"font-medium\"><Currency amount={session.expectedAmount} /></span>\r\n                </div>\r\n              )}\r\n              {session.closingAmount !== undefined && (\r\n                <div className=\"flex justify-between\">\r\n                  <span className=\"text-gray-600\">Closing Amount:</span>\r\n                  <span className=\"font-medium\"><Currency amount={session.closingAmount} /></span>\r\n                </div>\r\n              )}\r\n              {session.shortage !== undefined && session.shortage > 0 && (\r\n                <div className=\"flex justify-between text-red-600\">\r\n                  <span>Shortage:</span>\r\n                  <span className=\"font-medium\"><Currency amount={session.shortage} /></span>\r\n                </div>\r\n              )}\r\n              {session.overage !== undefined && session.overage > 0 && (\r\n                <div className=\"flex justify-between text-green-600\">\r\n                  <span>Overage:</span>\r\n                  <span className=\"font-medium\"><Currency amount={session.overage} /></span>\r\n                </div>\r\n              )}\r\n              {session.closingAmount !== undefined && session.expectedAmount !== undefined && (\r\n                <div className=\"flex justify-between text-lg font-bold border-t pt-2\">\r\n                  <span>Difference:</span>\r\n                  <span className={session.closingAmount >= session.expectedAmount ? 'text-green-600' : 'text-red-600'}>\r\n                    {session.closingAmount >= session.expectedAmount ? '+' : ''}\r\n                    <Currency amount={Math.abs(session.closingAmount - session.expectedAmount)} />\r\n                  </span>\r\n                </div>\r\n              )}\r\n            </div>\r\n            {session.notes && (\r\n              <div>\r\n                <label className=\"text-sm font-medium text-gray-500 mb-1 block\">Notes</label>\r\n                <div className=\"p-3 bg-gray-50 border border-gray-300\">{session.notes}</div>\r\n              </div>\r\n            )}\r\n          </div>\r\n          <div className=\"mt-6 flex justify-end\">\r\n            <button\r\n              onClick={onClose}\r\n              className=\"px-4 py-2 bg-gray-200 text-gray-700 hover:bg-gray-300 border border-gray-400\"\r\n            >\r\n              {dict?.common?.close || 'Close'}\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\[tenant]\\[lang]\\admin\\categories\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'router' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":19,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":19,"endColumn":15},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":22,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":22,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[619,622],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[619,622],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchCategories'. Either include it or remove the dependency array.","line":33,"column":6,"nodeType":"ArrayExpression","endLine":33,"endColumn":20,"suggestions":[{"desc":"Update the dependencies array to be: [fetchCategories, lang, tenant]","fix":{"range":[1102,1116],"text":"[fetchCategories, lang, tenant]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useEffect, useState } from 'react';\r\nimport Navbar from '@/components/Navbar';\r\nimport { useParams, useRouter } from 'next/navigation';\r\nimport Link from 'next/link';\r\nimport { getDictionaryClient } from '../../dictionaries-client';\r\n\r\ninterface Category {\r\n  _id: string;\r\n  name: string;\r\n  description?: string;\r\n  isActive: boolean;\r\n  createdAt: string;\r\n}\r\n\r\nexport default function CategoriesPage() {\r\n  const params = useParams();\r\n  const router = useRouter();\r\n  const tenant = params.tenant as string;\r\n  const lang = params.lang as 'en' | 'es';\r\n  const [dict, setDict] = useState<any>(null);\r\n  const [categories, setCategories] = useState<Category[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [message, setMessage] = useState<{ type: 'success' | 'error'; text: string } | null>(null);\r\n  const [showCategoryModal, setShowCategoryModal] = useState(false);\r\n  const [editingCategory, setEditingCategory] = useState<Category | null>(null);\r\n\r\n   \r\n  useEffect(() => {\r\n    getDictionaryClient(lang).then(setDict);\r\n    fetchCategories();\r\n  }, [lang, tenant]);\r\n\r\n  const fetchCategories = async () => {\r\n    try {\r\n      const res = await fetch('/api/categories', { credentials: 'include' });\r\n      const data = await res.json();\r\n      if (data.success) {\r\n        setCategories(data.data);\r\n        setMessage(null);\r\n      } else {\r\n        setMessage({ type: 'error', text: data.error || dict?.common?.failedToFetchCategories || 'Failed to fetch categories' });\r\n      }\r\n    } catch (error) {\r\n      console.error('Error fetching categories:', error);\r\n      setMessage({ type: 'error', text: dict?.common?.failedToFetchCategories || 'Failed to fetch categories' });\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleDeleteCategory = async (categoryId: string) => {\r\n    if (!dict) return;\r\n    if (!confirm(dict.common?.deleteCategoryConfirm || dict.admin?.deleteCategoryConfirm || 'Are you sure you want to delete this category?')) return;\r\n    try {\r\n      const res = await fetch(`/api/categories/${categoryId}`, { method: 'DELETE', credentials: 'include' });\r\n      const data = await res.json();\r\n      if (data.success) {\r\n        setMessage({ type: 'success', text: dict?.common?.categoryDeletedSuccess || 'Category deleted successfully' });\r\n        fetchCategories();\r\n      } else {\r\n        setMessage({ type: 'error', text: data.error || dict?.common?.failedToDeleteCategory || 'Failed to delete category' });\r\n      }\r\n    } catch (_error) {\r\n      setMessage({ type: 'error', text: dict?.common?.failedToDeleteCategory || 'Failed to delete category' });\r\n    }\r\n  };\r\n\r\n  const handleToggleCategoryStatus = async (category: Category) => {\r\n    try {\r\n      const res = await fetch(`/api/categories/${category._id}`, {\r\n        method: 'PUT',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        credentials: 'include',\r\n        body: JSON.stringify({ isActive: !category.isActive }),\r\n      });\r\n      const data = await res.json();\r\n      if (data.success) {\r\n        setMessage({ type: 'success', text: `Category ${!category.isActive ? (dict?.admin?.activated || 'activated') : (dict?.admin?.deactivated || 'deactivated')} ${dict?.admin?.successfully || 'successfully'}` });\r\n        fetchCategories();\r\n      } else {\r\n        setMessage({ type: 'error', text: data.error || dict?.common?.failedToUpdateCategory || 'Failed to update category' });\r\n      }\r\n    } catch (_error) {\r\n      setMessage({ type: 'error', text: dict?.common?.failedToUpdateCategory || 'Failed to update category' });\r\n    }\r\n  };\r\n\r\n  if (!dict || loading) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gray-50 flex items-center justify-center\">\r\n        <div className=\"text-center\">\r\n          <div className=\"inline-block animate-spin h-8 w-8 border-b-2 border-blue-600\"></div>\r\n          <p className=\"mt-4 text-gray-600\">{dict?.common?.loading || 'Loading...'}</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50\">\r\n      <Navbar />\r\n      <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 sm:py-8\">\r\n        <div className=\"mb-6 sm:mb-8\">\r\n          <Link\r\n            href={`/${tenant}/${lang}/admin`}\r\n            className=\"inline-flex items-center text-blue-600 hover:text-blue-700 font-medium mb-4 transition-colors\"\r\n          >\r\n            <svg className=\"w-5 h-5 mr-2\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M10 19l-7-7m0 0l7-7m-7 7h18\" />\r\n            </svg>\r\n            {dict?.admin?.backToAdmin || 'Back to Admin'}\r\n          </Link>\r\n          <div className=\"flex items-center justify-between\">\r\n            <div>\r\n              <h1 className=\"text-2xl sm:text-3xl lg:text-4xl font-bold text-gray-900 mb-2\">\r\n                {dict.admin?.categories || 'Categories'}\r\n              </h1>\r\n              <p className=\"text-gray-600\">{dict.admin?.categoriesSubtitle || 'Manage product categories'}</p>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {message && (\r\n          <div className={`mb-6 p-4 border ${message.type === 'success' ? 'bg-green-50 text-green-800 border-green-300' : 'bg-red-50 text-red-800 border-red-300'}`}>\r\n            {message.text}\r\n          </div>\r\n        )}\r\n\r\n        <div className=\"bg-white border border-gray-300 p-6\">\r\n          <div className=\"flex justify-between items-center mb-6\">\r\n            <h2 className=\"text-xl font-bold text-gray-900\">{dict.admin?.categories || 'Categories'}</h2>\r\n            <button\r\n              onClick={() => {\r\n                setEditingCategory(null);\r\n                setShowCategoryModal(true);\r\n              }}\r\n              className=\"px-4 py-2 bg-blue-600 text-white hover:bg-blue-700 font-medium border border-blue-700\"\r\n            >\r\n              {dict.common?.add || 'Add'} {dict.admin?.category || 'Category'}\r\n            </button>\r\n          </div>\r\n          <div className=\"overflow-x-auto\">\r\n            <table className=\"min-w-full divide-y divide-gray-200\">\r\n              <thead className=\"bg-gray-50\">\r\n                <tr>\r\n                  <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">{dict.admin?.name || 'Name'}</th>\r\n                  <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">{dict.admin?.description || 'Description'}</th>\r\n                  <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">{dict.admin?.status || 'Status'}</th>\r\n                  <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">{dict.common?.actions || 'Actions'}</th>\r\n                </tr>\r\n              </thead>\r\n              <tbody className=\"bg-white divide-y divide-gray-200\">\r\n                {categories.map((category) => (\r\n                  <tr key={category._id}>\r\n                    <td className=\"px-4 py-4 whitespace-nowrap text-sm font-medium text-gray-900\">{category.name}</td>\r\n                    <td className=\"px-4 py-4 text-sm text-gray-500\">{category.description || '-'}</td>\r\n                    <td className=\"px-4 py-4 whitespace-nowrap\">\r\n                      <span className={`px-2 py-1 text-xs font-semibold border ${category.isActive ? 'bg-green-100 text-green-800 border-green-300' : 'bg-red-100 text-red-800 border-red-300'}`}>\r\n                        {category.isActive ? (dict.admin?.active || 'Active') : (dict.admin?.inactive || 'Inactive')}\r\n                      </span>\r\n                    </td>\r\n                    <td className=\"px-4 py-4 whitespace-nowrap text-sm font-medium\">\r\n                      <div className=\"flex gap-2\">\r\n                        <button\r\n                          onClick={() => {\r\n                            setEditingCategory(category);\r\n                            setShowCategoryModal(true);\r\n                          }}\r\n                          className=\"text-blue-600 hover:text-blue-900\"\r\n                        >\r\n                          {dict.common?.edit || 'Edit'}\r\n                        </button>\r\n                        <button\r\n                          onClick={() => handleToggleCategoryStatus(category)}\r\n                          className={category.isActive ? 'text-orange-600 hover:text-orange-900' : 'text-green-600 hover:text-green-900'}\r\n                        >\r\n                          {category.isActive ? (dict.admin?.deactivate || 'Deactivate') : (dict.admin?.activate || 'Activate')}\r\n                        </button>\r\n                        <button\r\n                          onClick={() => handleDeleteCategory(category._id)}\r\n                          className=\"text-red-600 hover:text-red-900\"\r\n                        >\r\n                          {dict.common?.delete || 'Delete'}\r\n                        </button>\r\n                      </div>\r\n                    </td>\r\n                  </tr>\r\n                ))}\r\n              </tbody>\r\n            </table>\r\n            {categories.length === 0 && (\r\n              <div className=\"text-center py-8 text-gray-500\">{dict.common?.noResults || 'No categories found'}</div>\r\n            )}\r\n          </div>\r\n        </div>\r\n\r\n        {showCategoryModal && (\r\n          <CategoryModal\r\n            category={editingCategory}\r\n            onClose={() => {\r\n              setShowCategoryModal(false);\r\n              setEditingCategory(null);\r\n            }}\r\n            onSave={() => {\r\n              fetchCategories();\r\n              setShowCategoryModal(false);\r\n              setEditingCategory(null);\r\n            }}\r\n            dict={dict}\r\n          />\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction CategoryModal({\r\n  category,\r\n  onClose,\r\n  onSave,\r\n  dict,\r\n}: {\r\n  category: Category | null;\r\n  onClose: () => void;\r\n  onSave: () => void;\r\n  dict: Record<string, Record<string, string>> | null;\r\n}) {\r\n  const [formData, setFormData] = useState({\r\n    name: category?.name || '',\r\n    description: category?.description || '',\r\n  });\r\n  const [saving, setSaving] = useState(false);\r\n  const [error, setError] = useState('');\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    setError('');\r\n    setSaving(true);\r\n    try {\r\n      const url = category ? `/api/categories/${category._id}` : '/api/categories';\r\n      const method = category ? 'PUT' : 'POST';\r\n      const body = {\r\n        name: formData.name,\r\n        description: formData.description || undefined,\r\n      };\r\n\r\n      const res = await fetch(url, {\r\n        method,\r\n        headers: { 'Content-Type': 'application/json' },\r\n        credentials: 'include',\r\n        body: JSON.stringify(body),\r\n      });\r\n\r\n      const data = await res.json();\r\n      if (data.success) {\r\n        onSave();\r\n      } else {\r\n        setError(data.error || 'Failed to save category');\r\n      }\r\n    } catch (_error) {\r\n      setError('Failed to save category');\r\n    } finally {\r\n      setSaving(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 bg-gray-900/20 backdrop-blur-sm flex items-center justify-center z-50 p-4\">\r\n      <div className=\"bg-white border border-gray-300 max-w-md w-full\">\r\n        <div className=\"p-6\">\r\n          <h2 className=\"text-2xl font-bold text-gray-900 mb-4\">\r\n            {category\r\n              ? (dict?.admin?.editCategory || 'Edit Category')\r\n              : (dict?.admin?.addCategory || 'Add Category')}\r\n          </h2>\r\n          <form onSubmit={handleSubmit} className=\"space-y-4\">\r\n            <div>\r\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                {dict?.admin?.name || 'Name'} *\r\n              </label>\r\n              <input\r\n                type=\"text\"\r\n                required\r\n                value={formData.name}\r\n                onChange={(e) => setFormData({ ...formData, name: e.target.value })}\r\n                className=\"w-full px-3 py-2 border border-gray-300 focus:ring-2 focus:ring-blue-500 bg-white\"\r\n              />\r\n            </div>\r\n            <div>\r\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                {dict?.admin?.description || 'Description'} (optional)\r\n              </label>\r\n              <textarea\r\n                value={formData.description}\r\n                onChange={(e) => setFormData({ ...formData, description: e.target.value })}\r\n                rows={3}\r\n                className=\"w-full px-3 py-2 border border-gray-300 focus:ring-2 focus:ring-blue-500 bg-white\"\r\n              />\r\n            </div>\r\n            {error && (\r\n              <div className=\"bg-red-50 text-red-800 border border-red-300 p-3\">\r\n                {error}\r\n              </div>\r\n            )}\r\n            <div className=\"flex gap-3 justify-end pt-4\">\r\n              <button\r\n                type=\"button\"\r\n                onClick={onClose}\r\n                className=\"px-4 py-2 border border-gray-300 text-gray-700 hover:bg-gray-50 bg-white\"\r\n              >\r\n                {(dict?.common?.cancel) || 'Cancel'}\r\n              </button>\r\n              <button\r\n                type=\"submit\"\r\n                disabled={saving}\r\n                className=\"px-4 py-2 bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-50 border border-blue-700\"\r\n              >\r\n                {saving ? (dict?.common?.loading || 'Saving...') : (dict?.common?.save || 'Save')}\r\n              </button>\r\n            </div>\r\n          </form>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\[tenant]\\[lang]\\admin\\discounts\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'router' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":33,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":33,"endColumn":15},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":36,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":36,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1150,1153],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1150,1153],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchDiscounts'. Either include it or remove the dependency array.","line":49,"column":6,"nodeType":"ArrayExpression","endLine":49,"endColumn":20,"suggestions":[{"desc":"Update the dependencies array to be: [fetchDiscounts, lang, tenant]","fix":{"range":[1849,1863],"text":"[fetchDiscounts, lang, tenant]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":311,"column":9,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":311,"endColumn":12,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14830,14833],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14830,14833],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":399,"column":87,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":399,"endColumn":90,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[18770,18773],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[18770,18773],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useEffect, useState } from 'react';\r\nimport Navbar from '@/components/Navbar';\r\nimport { useParams, useRouter } from 'next/navigation';\r\nimport Link from 'next/link';\r\nimport { getDictionaryClient } from '../../dictionaries-client';\r\nimport Currency from '@/components/Currency';\r\nimport { useTenantSettings } from '@/contexts/TenantSettingsContext';\r\nimport { supportsFeature } from '@/lib/business-type-helpers';\r\nimport { getBusinessTypeConfig } from '@/lib/business-types';\r\nimport { getBusinessType } from '@/lib/business-type-helpers';\r\n\r\ninterface Discount {\r\n  _id: string;\r\n  code: string;\r\n  name?: string;\r\n  description?: string;\r\n  type: 'percentage' | 'fixed';\r\n  value: number;\r\n  minPurchaseAmount?: number;\r\n  maxDiscountAmount?: number;\r\n  validFrom: string;\r\n  validUntil: string;\r\n  usageLimit?: number;\r\n  usageCount: number;\r\n  isActive: boolean;\r\n  createdAt: string;\r\n}\r\n\r\nexport default function DiscountsPage() {\r\n  const params = useParams();\r\n  const router = useRouter();\r\n  const tenant = params.tenant as string;\r\n  const lang = params.lang as 'en' | 'es';\r\n  const [dict, setDict] = useState<any>(null);\r\n  const [discounts, setDiscounts] = useState<Discount[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [message, setMessage] = useState<{ type: 'success' | 'error'; text: string } | null>(null);\r\n  const [showDiscountModal, setShowDiscountModal] = useState(false);\r\n  const [editingDiscount, setEditingDiscount] = useState<Discount | null>(null);\r\n  const { settings } = useTenantSettings();\r\n  const discountsEnabled = supportsFeature(settings ?? undefined, 'discounts');\r\n  const businessTypeConfig = settings ? getBusinessTypeConfig(getBusinessType(settings)) : null;\r\n\r\n  useEffect(() => {\r\n    getDictionaryClient(lang).then(setDict);\r\n    fetchDiscounts();\r\n  }, [lang, tenant]);\r\n\r\n  const fetchDiscounts = async () => {\r\n    try {\r\n      const res = await fetch('/api/discounts', { credentials: 'include' });\r\n      const data = await res.json();\r\n      if (data.success) {\r\n        setDiscounts(data.data);\r\n        setMessage(null);\r\n      } else {\r\n        setMessage({ type: 'error', text: data.error || dict?.common?.failedToFetchDiscounts || 'Failed to fetch discounts' });\r\n      }\r\n    } catch (error) {\r\n      console.error('Error fetching discounts:', error);\r\n      setMessage({ type: 'error', text: dict?.common?.failedToFetchDiscounts || 'Failed to fetch discounts' });\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleDeleteDiscount = async (discountId: string) => {\r\n    if (!dict) return;\r\n    if (!confirm(dict.admin?.deleteConfirm || 'Are you sure you want to delete this discount?')) return;\r\n    try {\r\n      const res = await fetch(`/api/discounts/${discountId}`, { method: 'DELETE', credentials: 'include' });\r\n      const data = await res.json();\r\n      if (data.success) {\r\n        setMessage({ type: 'success', text: dict.admin?.deleteSuccess || 'Discount deleted successfully' });\r\n        fetchDiscounts();\r\n      } else {\r\n        setMessage({ type: 'error', text: data.error || dict.admin?.deleteError || 'Failed to delete discount' });\r\n      }\r\n    } catch (error) {\r\n      setMessage({ type: 'error', text: dict.admin?.deleteError || 'Failed to delete discount' });\r\n    }\r\n  };\r\n\r\n  const handleToggleDiscountStatus = async (discount: Discount) => {\r\n    try {\r\n      const res = await fetch(`/api/discounts/${discount._id}`, {\r\n        method: 'PUT',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        credentials: 'include',\r\n        body: JSON.stringify({ isActive: !discount.isActive }),\r\n      });\r\n      const data = await res.json();\r\n      if (data.success) {\r\n        setMessage({ type: 'success', text: `${dict.admin?.discount || 'Discount'} ${!discount.isActive ? (dict.admin?.activated || 'activated') : (dict.admin?.deactivated || 'deactivated')} ${dict.admin?.successfully || 'successfully'}` });\r\n        fetchDiscounts();\r\n      } else {\r\n        setMessage({ type: 'error', text: data.error || dict.admin?.updateError || 'Failed to update discount' });\r\n      }\r\n    } catch (error) {\r\n      setMessage({ type: 'error', text: dict.admin?.updateError || 'Failed to update discount' });\r\n    }\r\n  };\r\n\r\n  const isDiscountValid = (discount: Discount) => {\r\n    const now = new Date();\r\n    const validFrom = new Date(discount.validFrom);\r\n    const validUntil = new Date(discount.validUntil);\r\n    return now >= validFrom && now <= validUntil && discount.isActive;\r\n  };\r\n\r\n  if (!dict || loading) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gray-50 flex items-center justify-center\">\r\n        <div className=\"text-center\">\r\n          <div className=\"inline-block animate-spin h-8 w-8 border-b-2 border-blue-600\"></div>\r\n          <p className=\"mt-4 text-gray-600\">{dict?.common?.loading || 'Loading...'}</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50\">\r\n      <Navbar />\r\n      <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 sm:py-8\">\r\n        <div className=\"mb-6 sm:mb-8\">\r\n          <Link\r\n            href={`/${tenant}/${lang}/admin`}\r\n            className=\"inline-flex items-center text-blue-600 hover:text-blue-700 font-medium mb-4 transition-colors\"\r\n          >\r\n            <svg className=\"w-5 h-5 mr-2\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M10 19l-7-7m0 0l7-7m-7 7h18\" />\r\n            </svg>\r\n            {dict?.admin?.backToAdmin || 'Back to Admin'}\r\n          </Link>\r\n          <div className=\"flex items-center justify-between\">\r\n            <div>\r\n              <h1 className=\"text-2xl sm:text-3xl lg:text-4xl font-bold text-gray-900 mb-2\">\r\n                {dict.admin?.discounts || 'Discounts'}\r\n              </h1>\r\n              <p className=\"text-gray-600\">{dict.admin?.discountsSubtitle || 'Manage discount codes and promotions'}</p>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {message && (\r\n          <div className={`mb-6 p-4 border ${message.type === 'success' ? 'bg-green-50 text-green-800 border-green-300' : 'bg-red-50 text-red-800 border-red-300'}`}>\r\n            {message.text}\r\n          </div>\r\n        )}\r\n\r\n        {!discountsEnabled && (\r\n          <div className=\"mb-6 p-4 bg-yellow-50 border-2 border-yellow-300 text-yellow-800\">\r\n            <div className=\"flex items-start gap-3\">\r\n              <svg className=\"w-6 h-6 flex-shrink-0 mt-0.5\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z\" />\r\n              </svg>\r\n              <div>\r\n                <h3 className=\"text-lg font-semibold text-yellow-900 mb-2\">\r\n                  Discounts Not Available\r\n                </h3>\r\n                <p className=\"text-yellow-800\">\r\n                  Discounts are not enabled for {businessTypeConfig?.name || 'your business type'}. \r\n                  This feature is typically used for retail and restaurant businesses.\r\n                </p>\r\n                <p className=\"text-sm text-yellow-700 mt-2\">\r\n                  If you need discounts, please enable it in Settings  Business or update your business type.\r\n                </p>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        <div className=\"bg-white border border-gray-300 p-6\">\r\n          <div className=\"flex justify-between items-center mb-6\">\r\n            <h2 className=\"text-xl font-bold text-gray-900\">{dict.admin?.discounts || 'Discounts'}</h2>\r\n            {discountsEnabled && (\r\n              <button\r\n                onClick={() => {\r\n                  setEditingDiscount(null);\r\n                  setShowDiscountModal(true);\r\n                }}\r\n                className=\"px-4 py-2 bg-blue-600 text-white hover:bg-blue-700 font-medium border border-blue-700\"\r\n              >\r\n                {dict.common?.add || 'Add'} {dict.admin?.discount || 'Discount'}\r\n              </button>\r\n            )}\r\n          </div>\r\n          <div className=\"overflow-x-auto\">\r\n            <table className=\"min-w-full divide-y divide-gray-200\">\r\n              <thead className=\"bg-gray-50\">\r\n                <tr>\r\n                  <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">{dict.admin?.code || 'Code'}</th>\r\n                  <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">{dict.admin?.name || 'Name'}</th>\r\n                  <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">{dict.common?.type || 'Type'}</th>\r\n                  <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">{dict.admin?.value || 'Value'}</th>\r\n                  <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">{dict.admin?.validPeriod || 'Valid Period'}</th>\r\n                  <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">{dict.admin?.usage || 'Usage'}</th>\r\n                  <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">{dict.admin?.status || 'Status'}</th>\r\n                  <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">{dict.common?.actions || 'Actions'}</th>\r\n                </tr>\r\n              </thead>\r\n              <tbody className=\"bg-white divide-y divide-gray-200\">\r\n                {discounts.map((discount) => {\r\n                  const isValid = isDiscountValid(discount);\r\n                  return (\r\n                    <tr key={discount._id}>\r\n                      <td className=\"px-4 py-4 whitespace-nowrap\">\r\n                        <span className=\"text-sm font-mono font-bold text-gray-900\">{discount.code}</span>\r\n                      </td>\r\n                      <td className=\"px-4 py-4\">\r\n                        <div className=\"text-sm font-medium text-gray-900\">{discount.name || '-'}</div>\r\n                        {discount.description && (\r\n                          <div className=\"text-xs text-gray-500 mt-1\">{discount.description.substring(0, 50)}...</div>\r\n                        )}\r\n                      </td>\r\n                      <td className=\"px-4 py-4 whitespace-nowrap\">\r\n                        <span className=\"px-2 py-1 text-xs font-semibold border border-blue-300 bg-blue-100 text-blue-800\">\r\n                          {discount.type}\r\n                        </span>\r\n                      </td>\r\n                      <td className=\"px-4 py-4 whitespace-nowrap text-sm text-gray-900\">\r\n                        {discount.type === 'percentage' ? `${discount.value}%` : <Currency amount={discount.value} />}\r\n                        {discount.maxDiscountAmount && discount.type === 'percentage' && (\r\n                          <div className=\"text-xs text-gray-500\">Max: <Currency amount={discount.maxDiscountAmount} /></div>\r\n                        )}\r\n                      </td>\r\n                      <td className=\"px-4 py-4 whitespace-nowrap text-sm text-gray-500\">\r\n                        <div>{new Date(discount.validFrom).toLocaleDateString()}</div>\r\n                        <div className=\"text-xs\">{dict.admin?.to || 'to'} {new Date(discount.validUntil).toLocaleDateString()}</div>\r\n                      </td>\r\n                      <td className=\"px-4 py-4 whitespace-nowrap text-sm text-gray-500\">\r\n                        {discount.usageCount} / {discount.usageLimit || ''}\r\n                      </td>\r\n                      <td className=\"px-4 py-4 whitespace-nowrap\">\r\n                        <span className={`px-2 py-1 text-xs font-semibold border ${\r\n                          isValid ? 'bg-green-100 text-green-800 border-green-300' : \r\n                          !discount.isActive ? 'bg-red-100 text-red-800 border-red-300' : \r\n                          'bg-yellow-100 text-yellow-800 border-yellow-300'\r\n                        }`}>\r\n                          {isValid ? (dict.admin?.valid || 'Valid') : !discount.isActive ? (dict.admin?.inactive || 'Inactive') : (dict.admin?.expired || 'Expired')}\r\n                        </span>\r\n                      </td>\r\n                      <td className=\"px-4 py-4 whitespace-nowrap text-sm font-medium\">\r\n                        <div className=\"flex gap-2\">\r\n                          <button\r\n                            onClick={() => {\r\n                              setEditingDiscount(discount);\r\n                              setShowDiscountModal(true);\r\n                            }}\r\n                            className=\"text-blue-600 hover:text-blue-900\"\r\n                          >\r\n                            {dict.common?.edit || 'Edit'}\r\n                          </button>\r\n                          <button\r\n                            onClick={() => handleToggleDiscountStatus(discount)}\r\n                            className={discount.isActive ? 'text-orange-600 hover:text-orange-900' : 'text-green-600 hover:text-green-900'}\r\n                          >\r\n                            {discount.isActive ? (dict.admin?.deactivate || 'Deactivate') : (dict.admin?.activate || 'Activate')}\r\n                          </button>\r\n                          <button\r\n                            onClick={() => handleDeleteDiscount(discount._id)}\r\n                            className=\"text-red-600 hover:text-red-900\"\r\n                          >\r\n                            {dict.common?.delete || 'Delete'}\r\n                          </button>\r\n                        </div>\r\n                      </td>\r\n                    </tr>\r\n                  );\r\n                })}\r\n              </tbody>\r\n            </table>\r\n            {discounts.length === 0 && (\r\n              <div className=\"text-center py-8 text-gray-500\">{dict.common?.noResults || 'No discounts found'}</div>\r\n            )}\r\n          </div>\r\n        </div>\r\n\r\n        {showDiscountModal && discountsEnabled && (\r\n          <DiscountModal\r\n            discount={editingDiscount}\r\n            onClose={() => {\r\n              setShowDiscountModal(false);\r\n              setEditingDiscount(null);\r\n            }}\r\n            onSave={() => {\r\n              fetchDiscounts();\r\n              setShowDiscountModal(false);\r\n              setEditingDiscount(null);\r\n            }}\r\n            dict={dict}\r\n          />\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction DiscountModal({\r\n  discount,\r\n  onClose,\r\n  onSave,\r\n  dict,\r\n}: {\r\n  discount: Discount | null;\r\n  onClose: () => void;\r\n  onSave: () => void;\r\n  dict: any;\r\n}) {\r\n  const [formData, setFormData] = useState({\r\n    code: discount?.code || '',\r\n    name: discount?.name || '',\r\n    description: discount?.description || '',\r\n    type: discount?.type || 'percentage',\r\n    value: discount?.value || 0,\r\n    minPurchaseAmount: discount?.minPurchaseAmount || 0,\r\n    maxDiscountAmount: discount?.maxDiscountAmount || 0,\r\n    validFrom: discount ? new Date(discount.validFrom).toISOString().split('T')[0] : new Date().toISOString().split('T')[0],\r\n    validUntil: discount ? new Date(discount.validUntil).toISOString().split('T')[0] : new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],\r\n    usageLimit: discount?.usageLimit || 0,\r\n    isActive: discount?.isActive !== undefined ? discount.isActive : true,\r\n  });\r\n  const [saving, setSaving] = useState(false);\r\n  const [error, setError] = useState('');\r\n  const { settings } = useTenantSettings();\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    setError('');\r\n    setSaving(true);\r\n    try {\r\n      const url = discount ? `/api/discounts/${discount._id}` : '/api/discounts';\r\n      const method = discount ? 'PUT' : 'POST';\r\n      const body = {\r\n        code: formData.code.toUpperCase(),\r\n        name: formData.name || undefined,\r\n        description: formData.description || undefined,\r\n        type: formData.type,\r\n        value: formData.value,\r\n        minPurchaseAmount: formData.minPurchaseAmount > 0 ? formData.minPurchaseAmount : undefined,\r\n        maxDiscountAmount: formData.maxDiscountAmount > 0 ? formData.maxDiscountAmount : undefined,\r\n        validFrom: new Date(formData.validFrom),\r\n        validUntil: new Date(formData.validUntil),\r\n        usageLimit: formData.usageLimit > 0 ? formData.usageLimit : undefined,\r\n        isActive: formData.isActive,\r\n      };\r\n\r\n      const res = await fetch(url, {\r\n        method,\r\n        headers: { 'Content-Type': 'application/json' },\r\n        credentials: 'include',\r\n        body: JSON.stringify(body),\r\n      });\r\n\r\n      const data = await res.json();\r\n      if (data.success) {\r\n        onSave();\r\n      } else {\r\n        setError(data.error || dict.admin?.saveError || 'Failed to save discount');\r\n      }\r\n    } catch (error) {\r\n      setError(dict.admin?.saveError || 'Failed to save discount');\r\n    } finally {\r\n      setSaving(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 bg-gray-900/20 backdrop-blur-sm flex items-center justify-center z-50 p-4\">\r\n      <div className=\"bg-white border border-gray-300 max-w-2xl w-full max-h-[90vh] overflow-y-auto\">\r\n        <div className=\"p-6\">\r\n          <h2 className=\"text-2xl font-bold text-gray-900 mb-4\">\r\n            {discount ? (dict.admin?.editDiscount || 'Edit Discount') : (dict.admin?.addDiscount || 'Add Discount')}\r\n          </h2>\r\n          <form onSubmit={handleSubmit} className=\"space-y-4\">\r\n            <div className=\"grid grid-cols-2 gap-4\">\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                  {dict.admin?.code || 'Code'} *\r\n                </label>\r\n                <input\r\n                  type=\"text\"\r\n                  required\r\n                  value={formData.code}\r\n                  onChange={(e) => setFormData({ ...formData, code: e.target.value.toUpperCase() })}\r\n                  className=\"w-full px-3 py-2 border border-gray-300 focus:ring-2 focus:ring-blue-500 bg-white\"\r\n                  placeholder={dict?.admin?.discountCodePlaceholder || 'DISCOUNT10'}\r\n                />\r\n              </div>\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                  {dict.common?.type || 'Type'} *\r\n                </label>\r\n                <select\r\n                  value={formData.type}\r\n                  onChange={(e) => setFormData({ ...formData, type: e.target.value as any })}\r\n                  className=\"w-full px-3 py-2 border border-gray-300 focus:ring-2 focus:ring-blue-500 bg-white\"\r\n                >\r\n                  <option value=\"percentage\">{dict.admin?.percentage || 'Percentage'}</option>\r\n                  <option value=\"fixed\">{dict.admin?.fixed || 'Fixed Amount'}</option>\r\n                </select>\r\n              </div>\r\n            </div>\r\n            <div>\r\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                {dict.admin?.name || 'Name'}\r\n              </label>\r\n              <input\r\n                type=\"text\"\r\n                value={formData.name}\r\n                onChange={(e) => setFormData({ ...formData, name: e.target.value })}\r\n                className=\"w-full px-3 py-2 border border-gray-300 focus:ring-2 focus:ring-blue-500 bg-white\"\r\n              />\r\n            </div>\r\n            <div>\r\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                {dict.admin?.description || 'Description'}\r\n              </label>\r\n              <textarea\r\n                value={formData.description}\r\n                onChange={(e) => setFormData({ ...formData, description: e.target.value })}\r\n                rows={2}\r\n                className=\"w-full px-3 py-2 border border-gray-300 focus:ring-2 focus:ring-blue-500 bg-white\"\r\n              />\r\n            </div>\r\n            <div className=\"grid grid-cols-2 gap-4\">\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                  {dict.admin?.value || 'Value'} * {formData.type === 'percentage' ? '(%)' : `(${settings?.currency || 'USD'})`}\r\n                </label>\r\n                <input\r\n                  type=\"number\"\r\n                  step=\"0.01\"\r\n                  min=\"0\"\r\n                  required\r\n                  value={formData.value}\r\n                  onChange={(e) => setFormData({ ...formData, value: parseFloat(e.target.value) || 0 })}\r\n                  className=\"w-full px-3 py-2 border border-gray-300 focus:ring-2 focus:ring-blue-500 bg-white\"\r\n                />\r\n              </div>\r\n              {formData.type === 'percentage' && (\r\n                <div>\r\n                  <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                    {dict.admin?.maxDiscount || 'Max Discount Amount'} ({settings?.currencySymbol || '$'})\r\n                  </label>\r\n                  <input\r\n                    type=\"number\"\r\n                    step=\"0.01\"\r\n                    min=\"0\"\r\n                    value={formData.maxDiscountAmount}\r\n                    onChange={(e) => setFormData({ ...formData, maxDiscountAmount: parseFloat(e.target.value) || 0 })}\r\n                    className=\"w-full px-3 py-2 border border-gray-300 focus:ring-2 focus:ring-blue-500 bg-white\"\r\n                  />\r\n                </div>\r\n              )}\r\n            </div>\r\n            <div className=\"grid grid-cols-2 gap-4\">\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                    {dict.admin?.minPurchase || 'Min Purchase Amount'} ({settings?.currencySymbol || '$'})\r\n                </label>\r\n                <input\r\n                  type=\"number\"\r\n                  step=\"0.01\"\r\n                  min=\"0\"\r\n                  value={formData.minPurchaseAmount}\r\n                  onChange={(e) => setFormData({ ...formData, minPurchaseAmount: parseFloat(e.target.value) || 0 })}\r\n                  className=\"w-full px-3 py-2 border border-gray-300 focus:ring-2 focus:ring-blue-500 bg-white\"\r\n                />\r\n              </div>\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                  {dict.admin?.usageLimit || 'Usage Limit'}\r\n                </label>\r\n                <input\r\n                  type=\"number\"\r\n                  min=\"0\"\r\n                  value={formData.usageLimit}\r\n                  onChange={(e) => setFormData({ ...formData, usageLimit: parseInt(e.target.value) || 0 })}\r\n                  className=\"w-full px-3 py-2 border border-gray-300 focus:ring-2 focus:ring-blue-500 bg-white\"\r\n                  placeholder={dict.admin?.unlimited || 'Unlimited if 0'}\r\n                />\r\n              </div>\r\n            </div>\r\n            <div className=\"grid grid-cols-2 gap-4\">\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                  {dict.admin?.validFrom || 'Valid From'} *\r\n                </label>\r\n                <input\r\n                  type=\"date\"\r\n                  required\r\n                  value={formData.validFrom}\r\n                  onChange={(e) => setFormData({ ...formData, validFrom: e.target.value })}\r\n                  className=\"w-full px-3 py-2 border border-gray-300 focus:ring-2 focus:ring-blue-500 bg-white\"\r\n                />\r\n              </div>\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                  {dict.admin?.validUntil || 'Valid Until'} *\r\n                </label>\r\n                <input\r\n                  type=\"date\"\r\n                  required\r\n                  value={formData.validUntil}\r\n                  onChange={(e) => setFormData({ ...formData, validUntil: e.target.value })}\r\n                  className=\"w-full px-3 py-2 border border-gray-300 focus:ring-2 focus:ring-blue-500 bg-white\"\r\n                />\r\n              </div>\r\n            </div>\r\n            <div>\r\n              <label className=\"flex items-center\">\r\n                <input\r\n                  type=\"checkbox\"\r\n                  checked={formData.isActive}\r\n                  onChange={(e) => setFormData({ ...formData, isActive: e.target.checked })}\r\n                  className=\"mr-2\"\r\n                />\r\n                <span className=\"text-sm font-medium text-gray-700\">\r\n                  {dict.admin?.active || 'Active'}\r\n                </span>\r\n              </label>\r\n            </div>\r\n            {error && (\r\n              <div className=\"bg-red-50 text-red-800 border border-red-300 p-3\">\r\n                {error}\r\n              </div>\r\n            )}\r\n            <div className=\"flex gap-3 justify-end pt-4\">\r\n              <button\r\n                type=\"button\"\r\n                onClick={onClose}\r\n                className=\"px-4 py-2 border border-gray-300 text-gray-700 hover:bg-gray-50 bg-white\"\r\n              >\r\n                {dict.common?.cancel || 'Cancel'}\r\n              </button>\r\n              <button\r\n                type=\"submit\"\r\n                disabled={saving}\r\n                className=\"px-4 py-2 bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-50 border border-blue-700\"\r\n              >\r\n                {saving ? (dict.common?.loading || 'Saving...') : (dict.common?.save || 'Save')}\r\n              </button>\r\n            </div>\r\n          </form>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\[tenant]\\[lang]\\admin\\expenses\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'router' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":30,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":30,"endColumn":15},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":33,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":33,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[930,933],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[930,933],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'settings' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":55,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":55,"endColumn":19},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchExpenses'. Either include it or remove the dependency array.","line":60,"column":6,"nodeType":"ArrayExpression","endLine":60,"endColumn":20,"suggestions":[{"desc":"Update the dependencies array to be: [fetchExpenses, lang, tenant]","fix":{"range":[1851,1865],"text":"[fetchExpenses, lang, tenant]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":363,"column":9,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":363,"endColumn":12,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16173,16176],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16173,16176],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":462,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":462,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[19225,19228],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[19225,19228],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":546,"column":96,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":546,"endColumn":99,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[23230,23233],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[23230,23233],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchExpenses'. Either include it or remove the dependency array.","line":65,"column":6,"nodeType":"ArrayExpression","endLine":65,"endColumn":56,"suggestions":[{"desc":"Update the dependencies array to be: [filters.startDate, filters.endDate, filters.name, fetchExpenses]","fix":{"range":[1980,2030],"text":"[filters.startDate, filters.endDate, filters.name, fetchExpenses]"}}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useEffect, useState } from 'react';\r\nimport Navbar from '@/components/Navbar';\r\nimport { useParams, useRouter } from 'next/navigation';\r\nimport Link from 'next/link';\r\nimport { getDictionaryClient } from '../../dictionaries-client';\r\nimport Currency from '@/components/Currency';\r\nimport { useTenantSettings } from '@/contexts/TenantSettingsContext';\r\n\r\ninterface Expense {\r\n  _id: string;\r\n  name: string;\r\n  description: string;\r\n  amount: number;\r\n  date: string;\r\n  paymentMethod: 'cash' | 'card' | 'digital' | 'other';\r\n  receipt?: string;\r\n  notes?: string;\r\n  userId?: {\r\n    _id: string;\r\n    name: string;\r\n    email: string;\r\n  } | string;\r\n  createdAt: string;\r\n}\r\n\r\nexport default function ExpensesPage() {\r\n  const params = useParams();\r\n  const router = useRouter();\r\n  const tenant = params.tenant as string;\r\n  const lang = params.lang as 'en' | 'es';\r\n  const [dict, setDict] = useState<any>(null);\r\n  const [expenses, setExpenses] = useState<Expense[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [message, setMessage] = useState<{ type: 'success' | 'error'; text: string } | null>(null);\r\n  \r\n  // Auto-dismiss messages after 5 seconds\r\n  useEffect(() => {\r\n    if (message) {\r\n      const timer = setTimeout(() => {\r\n        setMessage(null);\r\n      }, 5000);\r\n      return () => clearTimeout(timer);\r\n    }\r\n  }, [message]);\r\n  const [showExpenseModal, setShowExpenseModal] = useState(false);\r\n  const [editingExpense, setEditingExpense] = useState<Expense | null>(null);\r\n  const [filters, setFilters] = useState({\r\n    startDate: '',\r\n    endDate: '',\r\n    name: '',\r\n  });\r\n  const [expenseNames, setExpenseNames] = useState<string[]>([]);\r\n  const { settings } = useTenantSettings();\r\n\r\n  useEffect(() => {\r\n    getDictionaryClient(lang).then(setDict);\r\n    fetchExpenses();\r\n  }, [lang, tenant]);\r\n\r\n  useEffect(() => {\r\n    fetchExpenses();\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [filters.startDate, filters.endDate, filters.name]);\r\n\r\n  // Validate date range\r\n  const handleDateFilterChange = (field: 'startDate' | 'endDate', value: string) => {\r\n    if (field === 'endDate' && filters.startDate && value && new Date(filters.startDate) > new Date(value)) {\r\n      setMessage({ type: 'error', text: dict?.common?.endDateAfterStartDate || 'End date must be after start date' });\r\n      return;\r\n    }\r\n    if (field === 'startDate' && filters.endDate && value && new Date(value) > new Date(filters.endDate)) {\r\n      setMessage({ type: 'error', text: dict?.common?.startDateBeforeEndDate || 'Start date must be before end date' });\r\n      return;\r\n    }\r\n    setFilters({ ...filters, [field]: value });\r\n  };\r\n\r\n  const fetchExpenses = async () => {\r\n    try {\r\n      setLoading(true);\r\n      const params = new URLSearchParams();\r\n      if (filters.startDate) params.append('startDate', filters.startDate);\r\n      if (filters.endDate) params.append('endDate', filters.endDate);\r\n      if (filters.name) params.append('name', filters.name);\r\n\r\n      const res = await fetch(`/api/expenses?${params.toString()}`, { credentials: 'include' });\r\n      const data = await res.json();\r\n      if (data.success) {\r\n        setExpenses(data.data);\r\n        // Extract unique expense names\r\n        const uniqueNames = Array.from(new Set(data.data.map((e: Expense) => e.name))).sort() as string[];\r\n        setExpenseNames(uniqueNames);\r\n        setMessage(null);\r\n      } else {\r\n        setMessage({ type: 'error', text: data.error || dict?.common?.failedToFetchExpenses || 'Failed to fetch expenses' });\r\n      }\r\n    } catch (error) {\r\n      console.error('Error fetching expenses:', error);\r\n      setMessage({ type: 'error', text: dict?.common?.failedToFetchExpenses || 'Failed to fetch expenses' });\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const [deletingId, setDeletingId] = useState<string | null>(null);\r\n\r\n  const handleDeleteExpense = async (expenseId: string) => {\r\n    if (!dict) return;\r\n    if (!confirm(dict.common?.deleteExpenseConfirm || dict.admin?.deleteExpenseConfirm || 'Are you sure you want to delete this expense?')) return;\r\n    setDeletingId(expenseId);\r\n    try {\r\n      const res = await fetch(`/api/expenses/${expenseId}`, { method: 'DELETE', credentials: 'include' });\r\n      const data = await res.json();\r\n      if (data.success) {\r\n        setMessage({ type: 'success', text: data.message || dict?.admin?.expenseDeletedSuccess || 'Expense deleted successfully' });\r\n        fetchExpenses();\r\n      } else {\r\n        setMessage({ type: 'error', text: data.error || dict?.admin?.failedToDeleteExpense || 'Failed to delete expense' });\r\n      }\r\n    } catch (error) {\r\n      setMessage({ type: 'error', text: dict?.admin?.failedToDeleteExpense || 'Failed to delete expense' });\r\n    } finally {\r\n      setDeletingId(null);\r\n    }\r\n  };\r\n\r\n  const totalAmount = expenses.reduce((sum, expense) => sum + expense.amount, 0);\r\n\r\n  if (!dict || loading) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gray-50 flex items-center justify-center\">\r\n        <div className=\"text-center\">\r\n          <div className=\"inline-block animate-spin h-8 w-8 border-b-2 border-blue-600\"></div>\r\n          <p className=\"mt-4 text-gray-600\">{dict?.common?.loading || 'Loading...'}</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50\">\r\n      <Navbar />\r\n      <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 sm:py-8\">\r\n        <div className=\"mb-6 sm:mb-8\">\r\n          <Link\r\n            href={`/${tenant}/${lang}/admin`}\r\n            className=\"inline-flex items-center text-blue-600 hover:text-blue-700 font-medium mb-4 transition-colors\"\r\n          >\r\n            <svg className=\"w-5 h-5 mr-2\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M10 19l-7-7m0 0l7-7m-7 7h18\" />\r\n            </svg>\r\n            {dict?.admin?.backToAdmin || 'Back to Admin'}\r\n          </Link>\r\n          <div className=\"flex items-center justify-between\">\r\n            <div>\r\n              <h1 className=\"text-2xl sm:text-3xl lg:text-4xl font-bold text-gray-900 mb-2\">\r\n                {dict.admin?.expenses || 'Expenses'}\r\n              </h1>\r\n              <p className=\"text-gray-600\">{dict.admin?.expensesSubtitle || 'Manage and track business expenses'}</p>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {message && (\r\n          <div className={`mb-6 p-4 border flex items-center justify-between ${message.type === 'success' ? 'bg-green-50 text-green-800 border-green-300' : 'bg-red-50 text-red-800 border-red-300'}`}>\r\n            <span>{message.text}</span>\r\n            <button\r\n              onClick={() => setMessage(null)}\r\n              className=\"ml-4 text-gray-500 hover:text-gray-700\"\r\n            >\r\n              <svg className=\"w-5 h-5\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\r\n              </svg>\r\n            </button>\r\n          </div>\r\n        )}\r\n\r\n        {/* Summary Card */}\r\n        <div className=\"bg-white border border-gray-300 p-6 mb-6\">\r\n          <div className=\"flex items-center justify-between\">\r\n            <div>\r\n              <h3 className=\"text-sm font-medium text-gray-500\">{dict.admin?.totalExpenses || 'Total Expenses'}</h3>\r\n              <p className=\"text-3xl font-bold text-gray-900 mt-2\">\r\n                <Currency amount={totalAmount} />\r\n              </p>\r\n            </div>\r\n            <div className=\"text-right\">\r\n              <p className=\"text-sm text-gray-500\">{dict.admin?.totalRecords || 'Total Records'}</p>\r\n              <p className=\"text-2xl font-semibold text-gray-900 mt-2\">{expenses.length}</p>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"bg-white border border-gray-300 p-6\">\r\n          <div className=\"flex justify-between items-center mb-6\">\r\n            <h2 className=\"text-xl font-bold text-gray-900\">{dict.admin?.expenses || 'Expenses'}</h2>\r\n            <button\r\n              onClick={() => {\r\n                setEditingExpense(null);\r\n                setShowExpenseModal(true);\r\n              }}\r\n              className=\"px-4 py-2 bg-blue-600 text-white hover:bg-blue-700 font-medium border border-blue-700\"\r\n            >\r\n              {dict.common?.add || 'Add'} {dict.admin?.expense || 'Expense'}\r\n            </button>\r\n          </div>\r\n\r\n          {/* Filters */}\r\n          <div className=\"mb-6 p-4 bg-gray-50 border border-gray-300\">\r\n            <div className=\"flex items-center justify-between mb-4\">\r\n              <h3 className=\"text-sm font-medium text-gray-700\">{dict.admin?.filters || 'Filters'}</h3>\r\n              {(filters.startDate || filters.endDate || filters.name) && (\r\n                <button\r\n                  onClick={() => setFilters({ startDate: '', endDate: '', name: '' })}\r\n                  className=\"text-sm text-blue-600 hover:text-blue-800\"\r\n                >\r\n                  {dict.common?.clearFilters || 'Clear Filters'}\r\n                </button>\r\n              )}\r\n            </div>\r\n            <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n            <div>\r\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                {dict.admin?.startDate || 'Start Date'}\r\n              </label>\r\n              <input\r\n                type=\"date\"\r\n                value={filters.startDate}\r\n                onChange={(e) => handleDateFilterChange('startDate', e.target.value)}\r\n                className=\"w-full px-3 py-2 border border-gray-300 focus:ring-2 focus:ring-blue-500 text-sm bg-white\"\r\n              />\r\n            </div>\r\n            <div>\r\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                {dict.admin?.endDate || 'End Date'}\r\n              </label>\r\n              <input\r\n                type=\"date\"\r\n                value={filters.endDate}\r\n                onChange={(e) => handleDateFilterChange('endDate', e.target.value)}\r\n                className=\"w-full px-3 py-2 border border-gray-300 focus:ring-2 focus:ring-blue-500 text-sm bg-white\"\r\n              />\r\n            </div>\r\n            <div>\r\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                {dict.admin?.expenseName || 'Name of Expense'}\r\n              </label>\r\n              <select\r\n                value={filters.name}\r\n                onChange={(e) => setFilters({ ...filters, name: e.target.value })}\r\n                className=\"w-full px-3 py-2 border border-gray-300 focus:ring-2 focus:ring-blue-500 text-sm bg-white\"\r\n              >\r\n                <option value=\"\">{dict.common?.all || 'All Names'}</option>\r\n                {expenseNames.map((name) => (\r\n                  <option key={name} value={name}>\r\n                    {name}\r\n                  </option>\r\n                ))}\r\n              </select>\r\n            </div>\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"overflow-x-auto\">\r\n            <table className=\"min-w-full divide-y divide-gray-200\">\r\n              <thead className=\"bg-gray-50\">\r\n                <tr>\r\n                  <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">{dict.admin?.date || 'Date'}</th>\r\n                  <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">{dict.admin?.expenseName || 'Name of Expense'}</th>\r\n                  <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">{dict.admin?.description || 'Description'}</th>\r\n                  <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">{dict.admin?.amount || 'Amount'}</th>\r\n                  <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">{dict.admin?.paymentMethod || 'Payment Method'}</th>\r\n                  <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">{dict.admin?.user || 'User'}</th>\r\n                  <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">{dict.common?.actions || 'Actions'}</th>\r\n                </tr>\r\n              </thead>\r\n              <tbody className=\"bg-white divide-y divide-gray-200\">\r\n                {expenses.map((expense) => {\r\n                  const userName = typeof expense.userId === 'object' && expense.userId !== null\r\n                    ? expense.userId.name\r\n                    : '-';\r\n                  return (\r\n                    <tr key={expense._id} className=\"hover:bg-gray-50\">\r\n                      <td className=\"px-4 py-4 whitespace-nowrap text-sm text-gray-900\">\r\n                        {new Date(expense.date).toLocaleDateString()}\r\n                      </td>\r\n                      <td className=\"px-4 py-4 whitespace-nowrap text-sm text-gray-900\">\r\n                        <span className=\"px-2 py-1 text-xs font-semibold border border-blue-300 bg-blue-100 text-blue-800\">\r\n                          {expense.name}\r\n                        </span>\r\n                      </td>\r\n                      <td className=\"px-4 py-4 text-sm text-gray-900\">{expense.description}</td>\r\n                      <td className=\"px-4 py-4 whitespace-nowrap text-sm font-semibold text-gray-900\">\r\n                        <Currency amount={expense.amount} />\r\n                      </td>\r\n                      <td className=\"px-4 py-4 whitespace-nowrap text-sm text-gray-500 capitalize\">\r\n                        {expense.paymentMethod}\r\n                      </td>\r\n                      <td className=\"px-4 py-4 whitespace-nowrap text-sm text-gray-500\">{userName}</td>\r\n                      <td className=\"px-4 py-4 whitespace-nowrap text-sm font-medium\">\r\n                        <div className=\"flex gap-2\">\r\n                          <button\r\n                            onClick={() => {\r\n                              setEditingExpense(expense);\r\n                              setShowExpenseModal(true);\r\n                            }}\r\n                            className=\"text-blue-600 hover:text-blue-900\"\r\n                          >\r\n                            {dict.common?.edit || 'Edit'}\r\n                          </button>\r\n                          <button\r\n                            onClick={() => handleDeleteExpense(expense._id)}\r\n                            disabled={deletingId === expense._id}\r\n                            className=\"text-red-600 hover:text-red-900 disabled:opacity-50 disabled:cursor-not-allowed\"\r\n                          >\r\n                            {deletingId === expense._id ? (dict.common?.deleting || 'Deleting...') : (dict.common?.delete || 'Delete')}\r\n                          </button>\r\n                        </div>\r\n                      </td>\r\n                    </tr>\r\n                  );\r\n                })}\r\n              </tbody>\r\n            </table>\r\n            {expenses.length === 0 && (\r\n              <div className=\"text-center py-8 text-gray-500\">{dict.common?.noResults || 'No expenses found'}</div>\r\n            )}\r\n          </div>\r\n        </div>\r\n\r\n        {showExpenseModal && (\r\n          <ExpenseModal\r\n            expense={editingExpense}\r\n            onClose={() => {\r\n              setShowExpenseModal(false);\r\n              setEditingExpense(null);\r\n            }}\r\n            onSave={() => {\r\n              fetchExpenses();\r\n              setShowExpenseModal(false);\r\n              setEditingExpense(null);\r\n              setMessage({ type: 'success', text: editingExpense ? (dict?.common?.expenseUpdatedSuccess || 'Expense updated successfully') : (dict?.common?.expenseCreatedSuccess || 'Expense created successfully') });\r\n            }}\r\n            dict={dict}\r\n          />\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction ExpenseModal({\r\n  expense,\r\n  onClose,\r\n  onSave,\r\n  dict,\r\n}: {\r\n  expense: Expense | null;\r\n  onClose: () => void;\r\n  onSave: () => void;\r\n  dict: any;\r\n}) {\r\n  const getInitialFormData = () => ({\r\n    name: expense?.name || '',\r\n    description: expense?.description || '',\r\n    amount: expense?.amount?.toString() || '',\r\n    date: expense?.date ? new Date(expense.date).toISOString().split('T')[0] : new Date().toISOString().split('T')[0],\r\n    paymentMethod: expense?.paymentMethod || 'cash',\r\n    receipt: expense?.receipt || '',\r\n    notes: expense?.notes || '',\r\n  });\r\n\r\n  const [formData, setFormData] = useState(getInitialFormData());\r\n  const [saving, setSaving] = useState(false);\r\n  const [error, setError] = useState('');\r\n\r\n  // Reset form when expense changes (for edit mode)\r\n  useEffect(() => {\r\n    setFormData({\r\n      name: expense?.name || '',\r\n      description: expense?.description || '',\r\n      amount: expense?.amount?.toString() || '',\r\n      date: expense?.date ? new Date(expense.date).toISOString().split('T')[0] : new Date().toISOString().split('T')[0],\r\n      paymentMethod: expense?.paymentMethod || 'cash',\r\n      receipt: expense?.receipt || '',\r\n      notes: expense?.notes || '',\r\n    });\r\n    setError('');\r\n  }, [expense]);\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    setError('');\r\n    \r\n    // Validation\r\n    if (!formData.name?.trim()) {\r\n      setError('Name of expense is required');\r\n      return;\r\n    }\r\n    \r\n    if (!formData.description?.trim()) {\r\n      setError('Description is required');\r\n      return;\r\n    }\r\n    \r\n    if (!formData.amount || formData.amount === '') {\r\n      setError('Amount is required');\r\n      return;\r\n    }\r\n    \r\n    const amountValue = parseFloat(formData.amount);\r\n    if (isNaN(amountValue) || amountValue <= 0) {\r\n      setError('Amount must be a positive number');\r\n      return;\r\n    }\r\n    \r\n    if (!formData.date) {\r\n      setError('Date is required');\r\n      return;\r\n    }\r\n\r\n    setSaving(true);\r\n    try {\r\n      const url = expense ? `/api/expenses/${expense._id}` : '/api/expenses';\r\n      const method = expense ? 'PUT' : 'POST';\r\n      const body = {\r\n        name: formData.name.trim(),\r\n        description: formData.description.trim(),\r\n        amount: amountValue,\r\n        date: formData.date,\r\n        paymentMethod: formData.paymentMethod,\r\n        receipt: formData.receipt?.trim() || undefined,\r\n        notes: formData.notes?.trim() || undefined,\r\n      };\r\n\r\n      const res = await fetch(url, {\r\n        method,\r\n        headers: { 'Content-Type': 'application/json' },\r\n        credentials: 'include',\r\n        body: JSON.stringify(body),\r\n      });\r\n\r\n      const data = await res.json();\r\n      if (data.success) {\r\n        // Reset form on success\r\n        setFormData({\r\n          name: '',\r\n          description: '',\r\n          amount: '',\r\n          date: new Date().toISOString().split('T')[0],\r\n          paymentMethod: 'cash',\r\n          receipt: '',\r\n          notes: '',\r\n        });\r\n        setError('');\r\n        onSave();\r\n      } else {\r\n        setError(data.error || 'Failed to save expense');\r\n      }\r\n    } catch (error: any) {\r\n      setError(error.message || 'Failed to save expense. Please try again.');\r\n    } finally {\r\n      setSaving(false);\r\n    }\r\n  };\r\n\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 bg-gray-900/20 backdrop-blur-sm flex items-center justify-center z-50 p-4\">\r\n      <div className=\"bg-white border border-gray-300 max-w-2xl w-full max-h-[90vh] overflow-y-auto\">\r\n        <div className=\"p-6\">\r\n          <h2 className=\"text-2xl font-bold text-gray-900 mb-4\">\r\n            {expense ? (dict.admin?.editExpense || 'Edit Expense') : (dict.admin?.addExpense || 'Add Expense')}\r\n          </h2>\r\n          <form onSubmit={handleSubmit} className=\"space-y-4\">\r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                  {dict.admin?.expenseName || 'Name of Expense'} *\r\n                </label>\r\n                <input\r\n                  type=\"text\"\r\n                  value={formData.name}\r\n                  onChange={(e) => setFormData({ ...formData, name: e.target.value })}\r\n                  placeholder={dict.admin?.expenseNamePlaceholder || 'Enter expense name (e.g., Office Supplies, Rent, Utilities)'}\r\n                  className=\"w-full px-3 py-2 border border-gray-300 focus:ring-2 focus:ring-blue-500 bg-white\"\r\n                  required\r\n                />\r\n              </div>\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                  {dict.admin?.amount || 'Amount'} *\r\n                </label>\r\n                <input\r\n                  type=\"number\"\r\n                  step=\"0.01\"\r\n                  min=\"0\"\r\n                  required\r\n                  value={formData.amount}\r\n                  onChange={(e) => {\r\n                    const value = e.target.value;\r\n                    // Allow empty, numbers, and one decimal point\r\n                    if (value === '' || /^\\d*\\.?\\d*$/.test(value)) {\r\n                      setFormData({ ...formData, amount: value });\r\n                    }\r\n                  }}\r\n                  placeholder=\"0.00\"\r\n                  className=\"w-full px-3 py-2 border border-gray-300 focus:ring-2 focus:ring-blue-500 bg-white\"\r\n                />\r\n              </div>\r\n            </div>\r\n            <div>\r\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                {dict.admin?.description || 'Description'} *\r\n              </label>\r\n                <textarea\r\n                  required\r\n                  value={formData.description}\r\n                  onChange={(e) => setFormData({ ...formData, description: e.target.value })}\r\n                  rows={2}\r\n                  placeholder={dict?.admin?.expenseDescriptionPlaceholder || 'Enter expense description'}\r\n                  className=\"w-full px-3 py-2 border border-gray-300 focus:ring-2 focus:ring-blue-500 bg-white\"\r\n                />\r\n            </div>\r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                  {dict.admin?.date || 'Date'} *\r\n                </label>\r\n                <input\r\n                  type=\"date\"\r\n                  required\r\n                  value={formData.date}\r\n                  onChange={(e) => setFormData({ ...formData, date: e.target.value })}\r\n                  className=\"w-full px-3 py-2 border border-gray-300 focus:ring-2 focus:ring-blue-500 bg-white\"\r\n                />\r\n              </div>\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                  {dict.admin?.paymentMethod || 'Payment Method'} *\r\n                </label>\r\n                <select\r\n                  value={formData.paymentMethod}\r\n                  onChange={(e) => setFormData({ ...formData, paymentMethod: e.target.value as any })}\r\n                  className=\"w-full px-3 py-2 border border-gray-300 focus:ring-2 focus:ring-blue-500 bg-white\"\r\n                  required\r\n                >\r\n                  <option value=\"cash\">Cash</option>\r\n                  <option value=\"card\">Card</option>\r\n                  <option value=\"digital\">Digital</option>\r\n                  <option value=\"other\">Other</option>\r\n                </select>\r\n              </div>\r\n            </div>\r\n            <div>\r\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                {dict.admin?.receipt || 'Receipt'} (optional)\r\n              </label>\r\n              <input\r\n                type=\"text\"\r\n                value={formData.receipt}\r\n                onChange={(e) => setFormData({ ...formData, receipt: e.target.value })}\r\n                placeholder={dict?.admin?.receiptURLPlaceholder || 'Receipt URL or reference'}\r\n                className=\"w-full px-3 py-2 border border-gray-300 focus:ring-2 focus:ring-blue-500 bg-white\"\r\n              />\r\n            </div>\r\n            <div>\r\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                {dict.admin?.notes || 'Notes'} (optional)\r\n              </label>\r\n              <textarea\r\n                value={formData.notes}\r\n                onChange={(e) => setFormData({ ...formData, notes: e.target.value })}\r\n                rows={3}\r\n                className=\"w-full px-3 py-2 border border-gray-300 focus:ring-2 focus:ring-blue-500 bg-white\"\r\n              />\r\n            </div>\r\n            {error && (\r\n              <div className=\"bg-red-50 text-red-800 border border-red-300 p-3\">\r\n                {error}\r\n              </div>\r\n            )}\r\n            <div className=\"flex gap-3 justify-end pt-4\">\r\n              <button\r\n                type=\"button\"\r\n                onClick={onClose}\r\n                className=\"px-4 py-2 border border-gray-300 text-gray-700 hover:bg-gray-50 bg-white\"\r\n              >\r\n                {dict.common?.cancel || 'Cancel'}\r\n              </button>\r\n              <button\r\n                type=\"submit\"\r\n                disabled={saving}\r\n                className=\"px-4 py-2 bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-50 border border-blue-700\"\r\n              >\r\n                {saving ? (dict.common?.loading || 'Saving...') : (dict.common?.save || 'Save')}\r\n              </button>\r\n            </div>\r\n          </form>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\[tenant]\\[lang]\\admin\\feature-flags\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":17,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":17,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[700,703],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[700,703],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchSettings'. Either include it or remove the dependency array.","line":28,"column":6,"nodeType":"ArrayExpression","endLine":28,"endColumn":20,"suggestions":[{"desc":"Update the dependencies array to be: [fetchSettings, lang, tenant]","fix":{"range":[1253,1267],"text":"[fetchSettings, lang, tenant]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":57,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":57,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2220,2223],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2220,2223],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":62,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":62,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2380,2383],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2380,2383],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useEffect, useState } from 'react';\r\nimport Navbar from '@/components/Navbar';\r\nimport { useParams } from 'next/navigation';\r\nimport Link from 'next/link';\r\nimport { getDictionaryClient } from '../../dictionaries-client';\r\nimport { ITenantSettings } from '@/models/Tenant';\r\nimport { useTenantSettings } from '@/contexts/TenantSettingsContext';\r\nimport { getBusinessTypeConfig } from '@/lib/business-types';\r\nimport { getBusinessType } from '@/lib/business-type-helpers';\r\n\r\nexport default function FeatureFlagsPage() {\r\n  const params = useParams();\r\n  const tenant = params.tenant as string;\r\n  const lang = params.lang as 'en' | 'es';\r\n  const [dict, setDict] = useState<any>(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [saving, setSaving] = useState(false);\r\n  const [settings, setSettings] = useState<ITenantSettings | null>(null);\r\n  const [message, setMessage] = useState<{ type: 'success' | 'error'; text: string } | null>(null);\r\n  const { settings: tenantSettings } = useTenantSettings();\r\n  const businessTypeConfig = tenantSettings ? getBusinessTypeConfig(getBusinessType(tenantSettings)) : null;\r\n\r\n  useEffect(() => {\r\n    getDictionaryClient(lang).then(setDict);\r\n    fetchSettings();\r\n  }, [lang, tenant]);\r\n\r\n  const fetchSettings = async () => {\r\n    try {\r\n      setLoading(true);\r\n      const res = await fetch(`/api/tenants/${tenant}/settings`);\r\n      const data = await res.json();\r\n      if (data.success) {\r\n        const defaultSettings = {\r\n          enableInventory: true,\r\n          enableCategories: true,\r\n          enableDiscounts: false,\r\n          enableLoyaltyProgram: false,\r\n          enableCustomerManagement: false,\r\n          enableBookingScheduling: false,\r\n          ...data.data,\r\n        };\r\n        setSettings(defaultSettings);\r\n      } else {\r\n        setMessage({ type: 'error', text: data.error || 'Failed to load settings' });\r\n      }\r\n    } catch (error) {\r\n      console.error('Error fetching settings:', error);\r\n      setMessage({ type: 'error', text: 'Failed to load settings. Please check your connection.' });\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const updateSetting = (path: string, value: any) => {\r\n    if (!settings) return;\r\n    \r\n    const keys = path.split('.');\r\n    const newSettings = JSON.parse(JSON.stringify(settings));\r\n    let current: any = newSettings;\r\n    \r\n    for (let i = 0; i < keys.length - 1; i++) {\r\n      if (!current[keys[i]]) {\r\n        current[keys[i]] = {};\r\n      }\r\n      current = current[keys[i]];\r\n    }\r\n    \r\n    current[keys[keys.length - 1]] = value;\r\n    setSettings(newSettings);\r\n  };\r\n\r\n  const handleSave = async () => {\r\n    if (!settings) return;\r\n\r\n    try {\r\n      setSaving(true);\r\n      setMessage(null);\r\n      const res = await fetch(`/api/tenants/${tenant}/settings`, {\r\n        method: 'PUT',\r\n        headers: { \r\n          'Content-Type': 'application/json',\r\n        },\r\n        credentials: 'include',\r\n        body: JSON.stringify({ settings }),\r\n      });\r\n\r\n      const data = await res.json();\r\n      if (data.success) {\r\n        setMessage({ type: 'success', text: dict?.admin?.featureFlagsSavedSuccess || 'Feature flags saved successfully!' });\r\n        setSettings(data.data);\r\n        setTimeout(() => setMessage(null), 3000);\r\n      } else {\r\n        if (res.status === 401 || res.status === 403) {\r\n          setMessage({ type: 'error', text: dict?.settings?.unauthorized || 'Unauthorized. Please login with admin account.' });\r\n        } else {\r\n          setMessage({ type: 'error', text: data.error || dict?.admin?.failedToSaveFeatureFlags || 'Failed to save feature flags' });\r\n        }\r\n      }\r\n    } catch (error) {\r\n      console.error('Error saving feature flags:', error);\r\n      setMessage({ type: 'error', text: dict?.admin?.failedToSaveFeatureFlagsConnection || 'Failed to save feature flags. Please check your connection.' });\r\n    } finally {\r\n      setSaving(false);\r\n    }\r\n  };\r\n\r\n  if (!dict || loading) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gray-50 flex items-center justify-center\">\r\n        <div className=\"text-center\">\r\n          <div className=\"inline-block animate-spin h-8 w-8 border-b-2 border-blue-600\"></div>\r\n          <p className=\"mt-4 text-gray-600\">{dict?.common?.loading || 'Loading...'}</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (!settings) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gray-50\">\r\n        <Navbar />\r\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 sm:py-8\">\r\n          <div className=\"bg-red-50 border-2 border-red-300 p-5 sm:p-6\">\r\n            <h2 className=\"text-xl font-bold text-red-800 mb-2\">Failed to Load Settings</h2>\r\n            <p className=\"text-red-700 mb-4\">\r\n              {message?.text || 'Unable to load tenant settings. Please check your connection and try again.'}\r\n            </p>\r\n            <button\r\n              onClick={fetchSettings}\r\n              className=\"px-4 py-2 bg-red-600 text-white hover:bg-red-700 font-medium transition-colors border border-red-700\"\r\n            >\r\n              Retry\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50\">\r\n      <Navbar />\r\n      <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 sm:py-8\">\r\n        <div className=\"mb-6 sm:mb-8\">\r\n          <Link\r\n            href={`/${tenant}/${lang}/admin`}\r\n            className=\"inline-flex items-center text-blue-600 hover:text-blue-700 font-medium mb-4 transition-colors\"\r\n          >\r\n            <svg className=\"w-5 h-5 mr-2\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M10 19l-7-7m0 0l7-7m-7 7h18\" />\r\n            </svg>\r\n            {dict?.admin?.backToAdmin || 'Back to Admin'}\r\n          </Link>\r\n          <h1 className=\"text-2xl sm:text-3xl lg:text-4xl font-bold text-gray-900 mb-2\">\r\n            {dict?.admin?.featureFlags || 'Feature Flags'}\r\n          </h1>\r\n          <p className=\"text-gray-600\">\r\n            {dict?.admin?.featureFlagsSubtitle || 'Enable or disable system-wide features. Changes affect the entire application.'}\r\n          </p>\r\n        </div>\r\n\r\n        {message && (\r\n          <div\r\n            className={`mb-6 p-4 border ${\r\n              message.type === 'success'\r\n                ? 'bg-green-50 text-green-800 border-green-300'\r\n                : 'bg-red-50 text-red-800 border-red-300'\r\n            }`}\r\n          >\r\n            {message.text}\r\n          </div>\r\n        )}\r\n\r\n        {businessTypeConfig && (\r\n          <div className=\"mb-6 p-4 bg-blue-50 border-2 border-blue-300\">\r\n            <div className=\"flex items-start gap-3\">\r\n              <svg className=\"w-6 h-6 flex-shrink-0 mt-0.5 text-blue-600\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n              </svg>\r\n              <div>\r\n                <h3 className=\"text-lg font-semibold text-blue-900 mb-2\">\r\n                  Current Business Type: {businessTypeConfig.name}\r\n                </h3>\r\n                <p className=\"text-blue-800 mb-2\">\r\n                  {businessTypeConfig.description}\r\n                </p>\r\n                <p className=\"text-sm text-blue-700\">\r\n                  Default features for this business type are auto-configured. You can override them below.\r\n                </p>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        <div className=\"bg-white border border-gray-300 p-5 sm:p-6 lg:p-8\">\r\n                <section>\r\n                  <h2 className=\"text-xl font-bold text-gray-900 mb-5\">{dict?.admin?.systemFeatures || 'System Features'}</h2>\r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n              <div className=\"flex items-center p-4 border-2 border-gray-300 hover:bg-gray-50 transition-colors\">\r\n                <input\r\n                  type=\"checkbox\"\r\n                  id=\"enableInventory\"\r\n                  checked={settings.enableInventory !== false}\r\n                  onChange={(e) => updateSetting('enableInventory', e.target.checked)}\r\n                  className=\"h-5 w-5 text-blue-600 focus:ring-blue-500 border-gray-300 cursor-pointer\"\r\n                />\r\n                <label htmlFor=\"enableInventory\" className=\"ml-3 flex-1\">\r\n                  <div className=\"text-sm font-medium text-gray-900\">\r\n                    {dict?.admin?.enableInventoryManagement || 'Enable Inventory Management'}\r\n                  </div>\r\n                  <div className=\"text-xs text-gray-500 mt-1\">\r\n                    {dict?.admin?.enableInventoryManagementDesc || 'Enable real-time stock tracking and inventory management'}\r\n                  </div>\r\n                </label>\r\n              </div>\r\n              <div className=\"flex items-center p-4 border-2 border-gray-300 hover:bg-gray-50 transition-colors\">\r\n                <input\r\n                  type=\"checkbox\"\r\n                  id=\"enableCategories\"\r\n                  checked={settings.enableCategories !== false}\r\n                  onChange={(e) => updateSetting('enableCategories', e.target.checked)}\r\n                  className=\"h-5 w-5 text-blue-600 focus:ring-blue-500 border-gray-300 cursor-pointer\"\r\n                />\r\n                <label htmlFor=\"enableCategories\" className=\"ml-3 flex-1\">\r\n                  <div className=\"text-sm font-medium text-gray-900\">\r\n                    {dict?.admin?.enableCategories || 'Enable Categories'}\r\n                  </div>\r\n                  <div className=\"text-xs text-gray-500 mt-1\">\r\n                    {dict?.admin?.enableCategoriesDesc || 'Enable product categorization and organization'}\r\n                  </div>\r\n                </label>\r\n              </div>\r\n              <div className=\"flex items-center p-4 border-2 border-gray-300 hover:bg-gray-50 transition-colors\">\r\n                <input\r\n                  type=\"checkbox\"\r\n                  id=\"enableDiscounts\"\r\n                  checked={settings.enableDiscounts || false}\r\n                  onChange={(e) => updateSetting('enableDiscounts', e.target.checked)}\r\n                  className=\"h-5 w-5 text-blue-600 focus:ring-blue-500 border-gray-300 cursor-pointer\"\r\n                />\r\n                <label htmlFor=\"enableDiscounts\" className=\"ml-3 flex-1\">\r\n                  <div className=\"text-sm font-medium text-gray-900\">\r\n                    {dict?.admin?.enableDiscounts || 'Enable Discounts'}\r\n                  </div>\r\n                  <div className=\"text-xs text-gray-500 mt-1\">\r\n                    {dict?.admin?.enableDiscountsDesc || 'Enable discount codes and promotional pricing'}\r\n                  </div>\r\n                </label>\r\n              </div>\r\n              <div className=\"flex items-center p-4 border-2 border-gray-300 hover:bg-gray-50 transition-colors\">\r\n                <input\r\n                  type=\"checkbox\"\r\n                  id=\"enableLoyaltyProgram\"\r\n                  checked={settings.enableLoyaltyProgram || false}\r\n                  onChange={(e) => updateSetting('enableLoyaltyProgram', e.target.checked)}\r\n                  className=\"h-5 w-5 text-blue-600 focus:ring-blue-500 border-gray-300 cursor-pointer\"\r\n                />\r\n                <label htmlFor=\"enableLoyaltyProgram\" className=\"ml-3 flex-1\">\r\n                  <div className=\"text-sm font-medium text-gray-900\">\r\n                    {dict?.admin?.enableLoyaltyProgram || 'Enable Loyalty Program'}\r\n                  </div>\r\n                  <div className=\"text-xs text-gray-500 mt-1\">\r\n                    {dict?.admin?.enableLoyaltyProgramDesc || 'Enable customer loyalty points and rewards system'}\r\n                  </div>\r\n                </label>\r\n              </div>\r\n              <div className=\"flex items-center p-4 border-2 border-gray-300 hover:bg-gray-50 transition-colors\">\r\n                <input\r\n                  type=\"checkbox\"\r\n                  id=\"enableCustomerManagement\"\r\n                  checked={settings.enableCustomerManagement || false}\r\n                  onChange={(e) => updateSetting('enableCustomerManagement', e.target.checked)}\r\n                  className=\"h-5 w-5 text-blue-600 focus:ring-blue-500 border-gray-300 cursor-pointer\"\r\n                />\r\n                <label htmlFor=\"enableCustomerManagement\" className=\"ml-3 flex-1\">\r\n                  <div className=\"text-sm font-medium text-gray-900\">\r\n                    {dict?.admin?.enableCustomerManagement || 'Enable Customer Management'}\r\n                  </div>\r\n                  <div className=\"text-xs text-gray-500 mt-1\">\r\n                    {dict?.admin?.enableCustomerManagementDesc || 'Enable customer profiles and history tracking'}\r\n                  </div>\r\n                </label>\r\n              </div>\r\n              <div className=\"flex items-center p-4 border-2 border-gray-300 hover:bg-gray-50 transition-colors\">\r\n                <input\r\n                  type=\"checkbox\"\r\n                  id=\"enableBookingScheduling\"\r\n                  checked={settings.enableBookingScheduling || false}\r\n                  onChange={(e) => updateSetting('enableBookingScheduling', e.target.checked)}\r\n                  className=\"h-5 w-5 text-blue-600 focus:ring-blue-500 border-gray-300 cursor-pointer\"\r\n                />\r\n                <label htmlFor=\"enableBookingScheduling\" className=\"ml-3 flex-1\">\r\n                  <div className=\"text-sm font-medium text-gray-900\">\r\n                    {dict?.admin?.enableBookingScheduling || 'Enable Booking & Scheduling'}\r\n                  </div>\r\n                  <div className=\"text-xs text-gray-500 mt-1\">\r\n                    {dict?.admin?.enableBookingSchedulingDesc || 'Enable appointment booking and scheduling features for salons, cleaners, and service businesses'}\r\n                  </div>\r\n                </label>\r\n              </div>\r\n            </div>\r\n          </section>\r\n\r\n          {/* Save Button */}\r\n          <div className=\"flex justify-end pt-6 mt-8 border-t border-gray-200\">\r\n            <button\r\n              onClick={handleSave}\r\n              disabled={saving}\r\n              className=\"px-6 py-3 bg-blue-600 text-white hover:bg-blue-700 font-semibold transition-all duration-200 border border-blue-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2\"\r\n            >\r\n              {saving ? (\r\n                <>\r\n                  <div className=\"animate-spin h-5 w-5 border-b-2 border-white\"></div>\r\n                  <span>{dict?.settings?.saving || 'Saving...'}</span>\r\n                </>\r\n              ) : (\r\n                <>\r\n                  <svg className=\"w-5 h-5\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M5 13l4 4L19 7\" />\r\n                  </svg>\r\n                  <span>{dict?.admin?.saveFeatureFlags || 'Save Feature Flags'}</span>\r\n                </>\r\n              )}\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\[tenant]\\[lang]\\admin\\hardware\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":17,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":17,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[683,686],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[683,686],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchSettings'. Either include it or remove the dependency array.","line":26,"column":6,"nodeType":"ArrayExpression","endLine":26,"endColumn":20,"suggestions":[{"desc":"Update the dependencies array to be: [fetchSettings, lang, tenant]","fix":{"range":[1065,1079],"text":"[fetchSettings, lang, tenant]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useEffect, useState } from 'react';\r\nimport Navbar from '@/components/Navbar';\r\nimport HardwareStatusChecker from '@/components/HardwareStatus';\r\nimport HardwareSettings from '@/components/HardwareSettings';\r\nimport { useParams } from 'next/navigation';\r\nimport Link from 'next/link';\r\nimport { getDictionaryClient } from '../../dictionaries-client';\r\nimport { ITenantSettings } from '@/models/Tenant';\r\nimport { hardwareService } from '@/lib/hardware';\r\n\r\nexport default function HardwareAdminPage() {\r\n  const params = useParams();\r\n  const tenant = params.tenant as string;\r\n  const lang = params.lang as 'en' | 'es';\r\n  const [dict, setDict] = useState<any>(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [saving, setSaving] = useState(false);\r\n  const [settings, setSettings] = useState<ITenantSettings | null>(null);\r\n  const [message, setMessage] = useState<{ type: 'success' | 'error'; text: string } | null>(null);\r\n\r\n  useEffect(() => {\r\n    getDictionaryClient(lang).then(setDict);\r\n    fetchSettings();\r\n  }, [lang, tenant]);\r\n\r\n  // Sync hardware config to hardware service when settings change\r\n  useEffect(() => {\r\n    if (settings?.hardwareConfig) {\r\n      hardwareService.setConfig(settings.hardwareConfig);\r\n    }\r\n  }, [settings?.hardwareConfig]);\r\n\r\n  const fetchSettings = async () => {\r\n    try {\r\n      setLoading(true);\r\n      const res = await fetch(`/api/tenants/${tenant}/settings`);\r\n      const data = await res.json();\r\n      if (data.success) {\r\n        const defaultSettings = {\r\n          hardwareConfig: {},\r\n          ...data.data,\r\n        };\r\n        setSettings(defaultSettings);\r\n      } else {\r\n        setMessage({ type: 'error', text: data.error || 'Failed to load settings' });\r\n      }\r\n    } catch (error) {\r\n      console.error('Error fetching settings:', error);\r\n      setMessage({ type: 'error', text: 'Failed to load settings. Please check your connection.' });\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleSave = async () => {\r\n    if (!settings) return;\r\n\r\n    try {\r\n      setSaving(true);\r\n      setMessage(null);\r\n      const res = await fetch(`/api/tenants/${tenant}/settings`, {\r\n        method: 'PUT',\r\n        headers: { \r\n          'Content-Type': 'application/json',\r\n        },\r\n        credentials: 'include',\r\n        body: JSON.stringify({ settings }),\r\n      });\r\n\r\n      const data = await res.json();\r\n      if (data.success) {\r\n        setMessage({ type: 'success', text: dict?.admin?.hardwareSettingsSavedSuccess || 'Hardware settings saved successfully!' });\r\n        setSettings(data.data);\r\n        setTimeout(() => setMessage(null), 3000);\r\n      } else {\r\n        if (res.status === 401 || res.status === 403) {\r\n          setMessage({ type: 'error', text: dict?.settings?.unauthorized || 'Unauthorized. Please login with admin account.' });\r\n        } else {\r\n          setMessage({ type: 'error', text: data.error || dict?.admin?.failedToSaveHardwareSettings || 'Failed to save hardware settings' });\r\n        }\r\n      }\r\n    } catch (error) {\r\n      console.error('Error saving hardware settings:', error);\r\n      setMessage({ type: 'error', text: dict?.admin?.failedToSaveHardwareSettingsConnection || 'Failed to save hardware settings. Please check your connection.' });\r\n    } finally {\r\n      setSaving(false);\r\n    }\r\n  };\r\n\r\n  if (!dict || loading) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gray-50 flex items-center justify-center\">\r\n        <div className=\"text-center\">\r\n          <div className=\"inline-block animate-spin h-8 w-8 border-b-2 border-blue-600\"></div>\r\n          <p className=\"mt-4 text-gray-600\">{dict?.common?.loading || 'Loading...'}</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (!settings) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gray-50\">\r\n        <Navbar />\r\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 sm:py-8\">\r\n          <div className=\"bg-red-50 border-2 border-red-300 p-5 sm:p-6\">\r\n            <h2 className=\"text-xl font-bold text-red-800 mb-2\">Failed to Load Settings</h2>\r\n            <p className=\"text-red-700 mb-4\">\r\n              {message?.text || 'Unable to load tenant settings. Please check your connection and try again.'}\r\n            </p>\r\n            <button\r\n              onClick={fetchSettings}\r\n              className=\"px-4 py-2 bg-red-600 text-white hover:bg-red-700 font-medium transition-colors border border-red-700\"\r\n            >\r\n              Retry\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50\">\r\n      <Navbar />\r\n      <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 sm:py-8\">\r\n        <div className=\"mb-6 sm:mb-8\">\r\n          <Link\r\n            href={`/${tenant}/${lang}/admin`}\r\n            className=\"inline-flex items-center text-blue-600 hover:text-blue-700 font-medium mb-4 transition-colors\"\r\n          >\r\n            <svg className=\"w-5 h-5 mr-2\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M10 19l-7-7m0 0l7-7m-7 7h18\" />\r\n            </svg>\r\n            {dict?.admin?.backToAdmin || 'Back to Admin'}\r\n          </Link>\r\n          <h1 className=\"text-2xl sm:text-3xl lg:text-4xl font-bold text-gray-900 mb-2\">\r\n            {dict?.admin?.hardwareSettings || 'Hardware Settings'}\r\n          </h1>\r\n          <p className=\"text-gray-600\">\r\n            {dict?.admin?.hardwareSettingsSubtitle || 'Configure printers, barcode scanners, QR readers, cash drawers, and other hardware devices.'}\r\n          </p>\r\n        </div>\r\n\r\n        {message && (\r\n          <div\r\n            className={`mb-6 p-4 border ${\r\n              message.type === 'success'\r\n                ? 'bg-green-50 text-green-800 border-green-300'\r\n                : 'bg-red-50 text-red-800 border-red-300'\r\n            }`}\r\n          >\r\n            {message.text}\r\n          </div>\r\n        )}\r\n\r\n        <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\r\n          <div className=\"lg:col-span-2\">\r\n            <div className=\"bg-white border border-gray-300 p-5 sm:p-6 lg:p-8\">\r\n              <HardwareSettings \r\n                hideSaveButton={true}\r\n                config={settings.hardwareConfig}\r\n                onChange={(hardwareConfig) => {\r\n                  setSettings({ ...settings, hardwareConfig });\r\n                }}\r\n              />\r\n              <div className=\"flex justify-end pt-6 mt-8 border-t border-gray-200\">\r\n                <button\r\n                  onClick={handleSave}\r\n                  disabled={saving}\r\n                  className=\"px-6 py-3 bg-blue-600 text-white hover:bg-blue-700 font-semibold transition-all duration-200 border border-blue-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2\"\r\n                >\r\n                  {saving ? (\r\n                    <>\r\n                      <div className=\"animate-spin h-5 w-5 border-b-2 border-white\"></div>\r\n                      <span>{dict?.settings?.saving || 'Saving...'}</span>\r\n                    </>\r\n                  ) : (\r\n                    <>\r\n                      <svg className=\"w-5 h-5\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M5 13l4 4L19 7\" />\r\n                      </svg>\r\n                      <span>{dict?.admin?.saveHardwareSettings || 'Save Hardware Settings'}</span>\r\n                    </>\r\n                  )}\r\n                </button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <div className=\"lg:col-span-1\">\r\n            <HardwareStatusChecker showActions={false} autoRefresh={true} sidebar={true} />\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\[tenant]\\[lang]\\admin\\holidays\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":15,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":15,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[573,576],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[573,576],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchSettings'. Either include it or remove the dependency array.","line":22,"column":6,"nodeType":"ArrayExpression","endLine":22,"endColumn":20,"suggestions":[{"desc":"Update the dependencies array to be: [fetchSettings, lang, tenant]","fix":{"range":[806,820],"text":"[fetchSettings, lang, tenant]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useEffect, useState } from 'react';\r\nimport Navbar from '@/components/Navbar';\r\nimport HolidaysManager from '@/components/settings/HolidaysManager';\r\nimport { useParams } from 'next/navigation';\r\nimport Link from 'next/link';\r\nimport { getDictionaryClient } from '../../dictionaries-client';\r\nimport { ITenantSettings } from '@/models/Tenant';\r\n\r\nexport default function HolidaysAdminPage() {\r\n  const params = useParams();\r\n  const tenant = params.tenant as string;\r\n  const lang = params.lang as 'en' | 'es';\r\n  const [dict, setDict] = useState<any>(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [settings, setSettings] = useState<ITenantSettings | null>(null);\r\n\r\n  useEffect(() => {\r\n    getDictionaryClient(lang).then(setDict);\r\n    fetchSettings();\r\n  }, [lang, tenant]);\r\n\r\n  const fetchSettings = async () => {\r\n    try {\r\n      setLoading(true);\r\n      const res = await fetch(`/api/tenants/${tenant}/settings`);\r\n      const data = await res.json();\r\n      if (data.success) {\r\n        setSettings(data.data);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error fetching settings:', error);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  if (!dict || loading || !settings) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gray-50 flex items-center justify-center\">\r\n        <div className=\"text-center\">\r\n          <div className=\"inline-block animate-spin h-8 w-8 border-b-2 border-blue-600\"></div>\r\n          <p className=\"mt-4 text-gray-600\">{dict?.common?.loading || 'Loading...'}</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50\">\r\n      <Navbar />\r\n      <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 sm:py-8\">\r\n        <div className=\"mb-6 sm:mb-8\">\r\n          <Link\r\n            href={`/${tenant}/${lang}/admin`}\r\n            className=\"inline-flex items-center text-blue-600 hover:text-blue-700 font-medium mb-4 transition-colors\"\r\n          >\r\n            <svg className=\"w-5 h-5 mr-2\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M10 19l-7-7m0 0l7-7m-7 7h18\" />\r\n            </svg>\r\n            {dict?.admin?.backToAdmin || 'Back to Admin'}\r\n          </Link>\r\n          <h1 className=\"text-2xl sm:text-3xl lg:text-4xl font-bold text-gray-900 mb-2\">\r\n            {dict?.admin?.holidayCalendar || 'Holiday Calendar'}\r\n          </h1>\r\n          <p className=\"text-gray-600\">\r\n            {dict?.admin?.holidaysSubtitle || 'Manage holidays and recurring holidays. Mark holidays when the business is closed to affect booking availability.'}\r\n          </p>\r\n        </div>\r\n\r\n        <div className=\"bg-white border border-gray-300 p-5 sm:p-6 lg:p-8\">\r\n          <HolidaysManager\r\n            settings={settings}\r\n            tenant={tenant}\r\n            onUpdate={(updates) => {\r\n              setSettings({ ...settings, ...updates });\r\n            }}\r\n          />\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\[tenant]\\[lang]\\admin\\layout.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useEffect' is defined but never used. Allowed unused vars must match /^_/u.","line":3,"column":21,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":30},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useState' is defined but never used. Allowed unused vars must match /^_/u.","line":3,"column":32,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":40}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { ReactNode, useEffect, useState } from 'react';\r\nimport ProtectedRoute from '@/components/ProtectedRoute';\r\nimport { TenantSettingsProvider } from '@/contexts/TenantSettingsContext';\r\nimport { SubscriptionProvider } from '@/contexts/SubscriptionContext';\r\nimport { SubscriptionStatusBar } from '@/components/SubscriptionStatusBar';\r\nimport { SubscriptionGuard } from '@/components/SubscriptionGuard';\r\n\r\n/**\r\n * Admin Layout\r\n *\r\n * This layout wraps all admin pages and ensures:\r\n * - Only admin, owner, or manager roles can access\r\n * - Provides consistent admin page structure\r\n * - Tenant settings context is available\r\n * - Subscription context and status bar are available\r\n */\r\nexport default function AdminLayout({ children }: { children: ReactNode }) {\r\n  return (\r\n    <TenantSettingsProvider>\r\n      <SubscriptionProvider>\r\n        <ProtectedRoute requiredRoles={['owner', 'admin', 'manager']}>\r\n          <SubscriptionGuard>\r\n            <SubscriptionStatusBar />\r\n            {children}\r\n          </SubscriptionGuard>\r\n        </ProtectedRoute>\r\n      </SubscriptionProvider>\r\n    </TenantSettingsProvider>\r\n  );\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\[tenant]\\[lang]\\admin\\multi-currency\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":14,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":14,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[503,506],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[503,506],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchSettings'. Either include it or remove the dependency array.","line":24,"column":6,"nodeType":"ArrayExpression","endLine":24,"endColumn":20,"suggestions":[{"desc":"Update the dependencies array to be: [fetchSettings, lang, tenant]","fix":{"range":[947,961],"text":"[fetchSettings, lang, tenant]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":54,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":54,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1902,1905],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1902,1905],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":59,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":59,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2062,2065],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2062,2065],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":94,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":94,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3294,3297],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3294,3297],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useEffect, useState } from 'react';\r\nimport Navbar from '@/components/Navbar';\r\nimport { useParams } from 'next/navigation';\r\nimport Link from 'next/link';\r\nimport { getDictionaryClient } from '../../dictionaries-client';\r\nimport { ITenantSettings } from '@/models/Tenant';\r\n\r\nexport default function MultiCurrencyPage() {\r\n  const params = useParams();\r\n  const tenant = params.tenant as string;\r\n  const lang = params.lang as 'en' | 'es';\r\n  const [dict, setDict] = useState<any>(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [saving, setSaving] = useState(false);\r\n  const [settings, setSettings] = useState<ITenantSettings | null>(null);\r\n  const [message, setMessage] = useState<{ type: 'success' | 'error'; text: string } | null>(null);\r\n  const [fetchingRates, setFetchingRates] = useState(false);\r\n\r\n  useEffect(() => {\r\n    getDictionaryClient(lang).then(setDict);\r\n    fetchSettings();\r\n  }, [lang, tenant]);\r\n\r\n  const fetchSettings = async () => {\r\n    try {\r\n      setLoading(true);\r\n      const res = await fetch(`/api/tenants/${tenant}/settings`);\r\n      const data = await res.json();\r\n      if (data.success) {\r\n        const defaultSettings = {\r\n          multiCurrency: {\r\n            enabled: false,\r\n            displayCurrencies: [],\r\n            exchangeRates: {},\r\n            exchangeRateSource: 'manual',\r\n            exchangeRateApiKey: '',\r\n          },\r\n          ...data.data,\r\n        };\r\n        setSettings(defaultSettings);\r\n      } else {\r\n        setMessage({ type: 'error', text: data.error || 'Failed to load settings' });\r\n      }\r\n    } catch (error) {\r\n      console.error('Error fetching settings:', error);\r\n      setMessage({ type: 'error', text: 'Failed to load settings. Please check your connection.' });\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const updateSetting = (path: string, value: any) => {\r\n    if (!settings) return;\r\n    \r\n    const keys = path.split('.');\r\n    const newSettings = JSON.parse(JSON.stringify(settings));\r\n    let current: any = newSettings;\r\n    \r\n    for (let i = 0; i < keys.length - 1; i++) {\r\n      if (!current[keys[i]]) {\r\n        current[keys[i]] = {};\r\n      }\r\n      current = current[keys[i]];\r\n    }\r\n    \r\n    current[keys[keys.length - 1]] = value;\r\n    setSettings(newSettings);\r\n  };\r\n\r\n  const fetchExchangeRates = async () => {\r\n    if (!settings) return;\r\n    setFetchingRates(true);\r\n    setMessage(null);\r\n    try {\r\n      const res = await fetch(`/api/tenants/${tenant}/exchange-rates`, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        credentials: 'include',\r\n        body: JSON.stringify({ action: 'fetch' }),\r\n      });\r\n      const data = await res.json();\r\n      if (data.success) {\r\n        setMessage({ type: 'success', text: dict?.admin?.exchangeRatesUpdated || 'Exchange rates updated successfully' });\r\n        updateSetting('multiCurrency', {\r\n          ...settings.multiCurrency,\r\n          exchangeRates: data.data.exchangeRates,\r\n          lastUpdated: new Date(data.data.lastUpdated),\r\n        });\r\n      } else {\r\n        setMessage({ type: 'error', text: data.error || dict?.admin?.failedToFetchRates || 'Failed to fetch exchange rates' });\r\n      }\r\n    } catch (error: any) {\r\n      setMessage({ type: 'error', text: error.message || dict?.admin?.failedToFetchRates || 'Failed to fetch exchange rates' });\r\n    } finally {\r\n      setFetchingRates(false);\r\n    }\r\n  };\r\n\r\n  const handleSave = async () => {\r\n    if (!settings) return;\r\n\r\n    try {\r\n      setSaving(true);\r\n      setMessage(null);\r\n      const res = await fetch(`/api/tenants/${tenant}/settings`, {\r\n        method: 'PUT',\r\n        headers: { \r\n          'Content-Type': 'application/json',\r\n        },\r\n        credentials: 'include',\r\n        body: JSON.stringify({ settings }),\r\n      });\r\n\r\n      const data = await res.json();\r\n      if (data.success) {\r\n        setMessage({ type: 'success', text: dict?.admin?.multiCurrencySaved || 'Multi-currency settings saved successfully!' });\r\n        setSettings(data.data);\r\n        setTimeout(() => setMessage(null), 3000);\r\n      } else {\r\n        if (res.status === 401 || res.status === 403) {\r\n          setMessage({ type: 'error', text: dict?.settings?.unauthorized || 'Unauthorized. Please login with admin account.' });\r\n        } else {\r\n          setMessage({ type: 'error', text: data.error || dict?.admin?.failedToSaveMultiCurrency || 'Failed to save settings' });\r\n        }\r\n      }\r\n    } catch (error) {\r\n      console.error('Error saving multi-currency settings:', error);\r\n      setMessage({ type: 'error', text: dict?.admin?.failedToSaveMultiCurrencyConnection || 'Failed to save settings. Please check your connection.' });\r\n    } finally {\r\n      setSaving(false);\r\n    }\r\n  };\r\n\r\n  if (!dict || loading) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gray-50 flex items-center justify-center\">\r\n        <div className=\"text-center\">\r\n          <div className=\"inline-block animate-spin h-8 w-8 border-b-2 border-blue-600\"></div>\r\n          <p className=\"mt-4 text-gray-600\">{dict?.common?.loading || 'Loading...'}</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  const multiCurrency = settings?.multiCurrency || {\r\n    enabled: false,\r\n    displayCurrencies: [],\r\n    exchangeRates: {},\r\n    exchangeRateSource: 'manual',\r\n    exchangeRateApiKey: '',\r\n  };\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50\">\r\n      <Navbar />\r\n      <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 sm:py-8\">\r\n        <div className=\"mb-6\">\r\n          <Link\r\n            href={`/${tenant}/${lang}/admin`}\r\n            className=\"text-blue-600 hover:text-blue-700 font-medium mb-4 inline-flex items-center\"\r\n          >\r\n            <svg className=\"w-4 h-4 mr-2\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15 19l-7-7 7-7\" />\r\n            </svg>\r\n            {dict?.common?.back || 'Back'} to Admin\r\n          </Link>\r\n          <h1 className=\"text-2xl sm:text-3xl lg:text-4xl font-bold text-gray-900 mb-2\">\r\n            {dict?.admin?.multiCurrency || 'Multi-Currency Management'}\r\n          </h1>\r\n          <p className=\"text-gray-600\">\r\n            {dict?.admin?.multiCurrencyDescription || 'Configure exchange rates and API settings for multi-currency support'}\r\n          </p>\r\n        </div>\r\n\r\n        {message && (\r\n          <div\r\n            className={`mb-6 p-4 border ${\r\n              message.type === 'success'\r\n                ? 'bg-green-50 text-green-800 border-green-300'\r\n                : 'bg-red-50 text-red-800 border-red-300'\r\n            }`}\r\n          >\r\n            {message.text}\r\n          </div>\r\n        )}\r\n\r\n        <div className=\"bg-white border border-gray-300 p-6 space-y-6\">\r\n          <div>\r\n            <h2 className=\"text-xl font-bold text-gray-900 mb-4\">\r\n              {dict?.admin?.exchangeRateSource || 'Exchange Rate Source'}\r\n            </h2>\r\n            <div className=\"space-y-4\">\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                  {dict?.admin?.exchangeRateSource || 'Exchange Rate Source'}\r\n                </label>\r\n                <select\r\n                  value={multiCurrency.exchangeRateSource || 'manual'}\r\n                  onChange={(e) => {\r\n                    updateSetting('multiCurrency.exchangeRateSource', e.target.value);\r\n                  }}\r\n                  className=\"w-full px-4 py-3 border-2 border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all bg-white\"\r\n                >\r\n                  <option value=\"manual\">{dict?.admin?.manualEntry || 'Manual Entry'}</option>\r\n                  <option value=\"api\">{dict?.admin?.automaticAPI || 'Automatic (API)'}</option>\r\n                </select>\r\n              </div>\r\n\r\n              {multiCurrency.exchangeRateSource === 'api' && (\r\n                <div>\r\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                    {dict?.admin?.exchangeRateApiKey || 'Exchange Rate API Key (Optional)'}\r\n                  </label>\r\n                  <input\r\n                    type=\"text\"\r\n                    value={multiCurrency.exchangeRateApiKey || ''}\r\n                    onChange={(e) => {\r\n                      updateSetting('multiCurrency.exchangeRateApiKey', e.target.value);\r\n                    }}\r\n                    className=\"w-full px-4 py-3 border-2 border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all bg-white\"\r\n                    placeholder={dict?.admin?.apiKeyPlaceholder || 'API key for exchange rate service'}\r\n                  />\r\n                  <p className=\"mt-2 text-xs text-gray-500\">\r\n                    {dict?.admin?.apiKeyHint || 'Leave empty to use free tier (exchangerate-api.com)'}\r\n                  </p>\r\n                </div>\r\n              )}\r\n            </div>\r\n          </div>\r\n\r\n          {multiCurrency.displayCurrencies && multiCurrency.displayCurrencies.length > 0 && (\r\n            <div>\r\n              <div className=\"flex items-center justify-between mb-4\">\r\n                <h2 className=\"text-xl font-bold text-gray-900\">\r\n                  {dict?.admin?.exchangeRates || 'Exchange Rates'}\r\n                </h2>\r\n                <button\r\n                  type=\"button\"\r\n                  onClick={fetchExchangeRates}\r\n                  disabled={fetchingRates || multiCurrency.exchangeRateSource !== 'api'}\r\n                  className=\"px-4 py-2 bg-blue-600 text-white text-sm font-medium hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed\"\r\n                >\r\n                  {fetchingRates \r\n                    ? (dict?.admin?.fetching || 'Fetching...') \r\n                    : (dict?.admin?.fetchLatestRates || 'Fetch Latest Rates')}\r\n                </button>\r\n              </div>\r\n              {multiCurrency.lastUpdated && (\r\n                <p className=\"text-xs text-gray-500 mb-4\">\r\n                  {dict?.admin?.lastUpdated || 'Last updated'}: {new Date(multiCurrency.lastUpdated).toLocaleString()}\r\n                </p>\r\n              )}\r\n              <div className=\"space-y-2\">\r\n                {multiCurrency.displayCurrencies.map((currency: string) => {\r\n                  const rate = multiCurrency.exchangeRates?.[currency];\r\n                  return (\r\n                    <div key={currency} className=\"flex items-center justify-between p-3 bg-gray-50 rounded border border-gray-200\">\r\n                      <span className=\"text-sm font-medium text-gray-900\">{currency}</span>\r\n                      <input\r\n                        type=\"number\"\r\n                        step=\"0.0001\"\r\n                        value={rate || ''}\r\n                        onChange={(e) => {\r\n                          const newRates = {\r\n                            ...(multiCurrency.exchangeRates || {}),\r\n                            [currency]: parseFloat(e.target.value) || 0,\r\n                          };\r\n                          updateSetting('multiCurrency.exchangeRates', newRates);\r\n                        }}\r\n                        className=\"w-32 px-3 py-2 border border-gray-300 rounded text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\r\n                        placeholder={dict?.admin?.ratePlaceholder || 'Rate'}\r\n                      />\r\n                    </div>\r\n                  );\r\n                })}\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          {(!multiCurrency.displayCurrencies || multiCurrency.displayCurrencies.length === 0) && (\r\n            <div className=\"p-4 bg-yellow-50 border border-yellow-300 rounded\">\r\n              <p className=\"text-sm text-yellow-800\">\r\n                {dict?.admin?.noDisplayCurrencies || 'No display currencies configured. Please configure display currencies in Settings  Multi-Currency.'}\r\n              </p>\r\n            </div>\r\n          )}\r\n\r\n          <div className=\"flex justify-end pt-6 mt-8 border-t border-gray-200\">\r\n            <button\r\n              onClick={handleSave}\r\n              disabled={saving}\r\n              className=\"px-6 py-3 bg-blue-600 text-white hover:bg-blue-700 font-semibold transition-all duration-200 border border-blue-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2\"\r\n            >\r\n              {saving ? (\r\n                <>\r\n                  <div className=\"animate-spin h-5 w-5 border-b-2 border-white\"></div>\r\n                  <span>{dict?.common?.saving || 'Saving...'}</span>\r\n                </>\r\n              ) : (\r\n                <>\r\n                  <svg className=\"w-5 h-5\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M5 13l4 4L19 7\" />\r\n                  </svg>\r\n                  <span>{dict?.common?.save || 'Save Settings'}</span>\r\n                </>\r\n              )}\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\[tenant]\\[lang]\\admin\\notification-templates\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":15,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":15,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[607,610],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[607,610],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchSettings'. Either include it or remove the dependency array.","line":22,"column":6,"nodeType":"ArrayExpression","endLine":22,"endColumn":20,"suggestions":[{"desc":"Update the dependencies array to be: [fetchSettings, lang, tenant]","fix":{"range":[840,854],"text":"[fetchSettings, lang, tenant]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useEffect, useState } from 'react';\r\nimport Navbar from '@/components/Navbar';\r\nimport { useParams } from 'next/navigation';\r\nimport Link from 'next/link';\r\nimport { getDictionaryClient } from '../../dictionaries-client';\r\nimport NotificationTemplatesManager from '@/components/settings/NotificationTemplatesManager';\r\nimport { ITenantSettings } from '@/models/Tenant';\r\n\r\nexport default function NotificationTemplatesPage() {\r\n  const params = useParams();\r\n  const tenant = params.tenant as string;\r\n  const lang = params.lang as 'en' | 'es';\r\n  const [dict, setDict] = useState<any>(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [settings, setSettings] = useState<ITenantSettings | null>(null);\r\n\r\n  useEffect(() => {\r\n    getDictionaryClient(lang).then(setDict);\r\n    fetchSettings();\r\n  }, [lang, tenant]);\r\n\r\n  const fetchSettings = async () => {\r\n    try {\r\n      setLoading(true);\r\n      const res = await fetch(`/api/tenants/${tenant}/settings`);\r\n      const data = await res.json();\r\n      if (data.success) {\r\n        setSettings(data.data);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error fetching settings:', error);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  if (!dict || loading || !settings) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gray-50 flex items-center justify-center\">\r\n        <div className=\"text-center\">\r\n          <div className=\"inline-block animate-spin h-8 w-8 border-b-2 border-blue-600\"></div>\r\n          <p className=\"mt-4 text-gray-600\">{dict?.common?.loading || 'Loading...'}</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50\">\r\n      <Navbar />\r\n      <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 sm:py-8\">\r\n        <div className=\"mb-6\">\r\n          <Link\r\n            href={`/${tenant}/${lang}/admin`}\r\n            className=\"text-blue-600 hover:text-blue-700 font-medium mb-4 inline-flex items-center\"\r\n          >\r\n            <svg className=\"w-4 h-4 mr-2\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15 19l-7-7 7-7\" />\r\n            </svg>\r\n            {dict?.common?.back || 'Back'} to Admin\r\n          </Link>\r\n          <h1 className=\"text-2xl sm:text-3xl lg:text-4xl font-bold text-gray-900 mb-2\">\r\n            {dict?.admin?.notificationTemplates || 'Notification Templates'}\r\n          </h1>\r\n          <p className=\"text-gray-600\">\r\n            {dict?.admin?.notificationTemplatesDescription || 'Customize email and SMS templates for bookings, alerts, and notifications'}\r\n          </p>\r\n        </div>\r\n\r\n        <div className=\"bg-white border border-gray-300 p-6\">\r\n          <NotificationTemplatesManager\r\n            settings={settings}\r\n            tenant={tenant}\r\n            onUpdate={(updates) => {\r\n              setSettings({ ...settings, ...updates });\r\n            }}\r\n          />\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\[tenant]\\[lang]\\admin\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'router' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":14,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":14,"endColumn":15},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":17,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":17,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[680,683],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[680,683],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useEffect, useState } from 'react';\r\nimport Navbar from '@/components/Navbar';\r\nimport { useParams, useRouter } from 'next/navigation';\r\nimport { getDictionaryClient } from '../dictionaries-client';\r\nimport Link from 'next/link';\r\nimport { useTenantSettings } from '@/contexts/TenantSettingsContext';\r\nimport { getDefaultTenantSettings } from '@/lib/currency';\r\nimport { useSubscription } from '@/contexts/SubscriptionContext';\r\n\r\nexport default function AdminPage() {\r\n  const params = useParams();\r\n  const router = useRouter();\r\n  const tenant = params.tenant as string;\r\n  const lang = params.lang as 'en' | 'es';\r\n  const [dict, setDict] = useState<any>(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const { settings } = useTenantSettings();\r\n  const tenantSettings = settings || getDefaultTenantSettings();\r\n  const primaryColor = tenantSettings.primaryColor || '#2563eb';\r\n  const { subscriptionStatus } = useSubscription();\r\n\r\n  useEffect(() => {\r\n    getDictionaryClient(lang).then((d) => {\r\n      setDict(d);\r\n      setLoading(false);\r\n    });\r\n  }, [lang]);\r\n\r\n  if (!dict || loading) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gray-50 flex items-center justify-center\">\r\n        <div className=\"text-center\">\r\n          <div\r\n            className=\"inline-block animate-spin h-8 w-8 border-b-2 rounded-full\"\r\n            style={{ borderColor: primaryColor, borderBottomColor: 'transparent' }}\r\n          ></div>\r\n          <p className=\"mt-4 text-gray-600\">{dict?.common?.loading || 'Loading...'}</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  const allAdminCards = [\r\n    {\r\n      title: dict.admin?.users || 'Users',\r\n      description: dict.admin?.usersDescription || 'Manage system users, roles, and permissions',\r\n      href: `/${tenant}/${lang}/admin/users`,\r\n      featureFlag: undefined as keyof typeof settings | undefined,\r\n      icon: (\r\n        <svg className=\"w-8 h-8\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z\" />\r\n        </svg>\r\n      ),\r\n      color: 'blue',\r\n    },\r\n    {\r\n      title: dict.admin?.tenants || 'Tenants',\r\n      description: dict.admin?.tenantsDescription || 'Manage multi-tenant organizations and settings',\r\n      href: `/${tenant}/${lang}/admin/tenants`,\r\n      featureFlag: undefined as keyof typeof settings | undefined,\r\n      icon: (\r\n        <svg className=\"w-8 h-8\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4\" />\r\n        </svg>\r\n      ),\r\n      color: 'green',\r\n    },\r\n    {\r\n      title: dict.admin?.branches || 'Branches',\r\n      description: dict.admin?.branchesDescription || 'Manage store branches and locations',\r\n      href: `/${tenant}/${lang}/admin/branches`,\r\n      featureFlag: undefined as keyof typeof settings | undefined,\r\n      icon: (\r\n        <svg className=\"w-8 h-8\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z\" />\r\n          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15 11a3 3 0 11-6 0 3 3 0 016 0z\" />\r\n        </svg>\r\n      ),\r\n      color: 'orange',\r\n    },\r\n    {\r\n      title: dict.admin?.categories || 'Categories',\r\n      description: dict.admin?.categoriesDescription || 'Manage product categories',\r\n      href: `/${tenant}/${lang}/admin/categories`,\r\n      featureFlag: 'enableCategories' as keyof typeof settings,\r\n      icon: (\r\n        <svg className=\"w-8 h-8\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z\" />\r\n        </svg>\r\n      ),\r\n      color: 'indigo',\r\n    },\r\n    {\r\n      title: dict.admin?.products || 'Products',\r\n      description: dict.admin?.productsDescription || 'Manage products, variations, and bundles',\r\n      href: `/${tenant}/${lang}/admin/products`,\r\n      featureFlag: undefined as keyof typeof settings | undefined,\r\n      icon: (\r\n        <svg className=\"w-8 h-8\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4\" />\r\n        </svg>\r\n      ),\r\n      color: 'teal',\r\n    },\r\n    {\r\n      title: dict.admin?.discounts || 'Discounts',\r\n      description: dict.admin?.discountsDescription || 'Manage discount codes and promotions',\r\n      href: `/${tenant}/${lang}/admin/discounts`,\r\n      featureFlag: 'enableDiscounts' as keyof typeof settings,\r\n      icon: (\r\n        <svg className=\"w-8 h-8\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n        </svg>\r\n      ),\r\n      color: 'yellow',\r\n    },\r\n    {\r\n      title: dict.admin?.transactions || 'Transactions',\r\n      description: dict.admin?.transactionsDescription || 'View and manage all sales transactions',\r\n      href: `/${tenant}/${lang}/admin/transactions`,\r\n      icon: (\r\n        <svg className=\"w-8 h-8\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01\" />\r\n        </svg>\r\n      ),\r\n      color: 'cyan',\r\n    },\r\n    {\r\n      title: dict.admin?.stockMovements || 'Stock Movements',\r\n      description: dict.admin?.stockMovementsDescription || 'Track all inventory changes and movements',\r\n      href: `/${tenant}/${lang}/admin/stock-movements`,\r\n      featureFlag: 'enableInventory' as keyof typeof settings,\r\n      icon: (\r\n        <svg className=\"w-8 h-8\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4\" />\r\n        </svg>\r\n      ),\r\n      color: 'pink',\r\n    },\r\n    {\r\n      title: dict.admin?.cashDrawer || 'Cash Drawer',\r\n      description: dict.admin?.cashDrawerDescription || 'Manage and monitor cash drawer operations',\r\n      href: `/${tenant}/${lang}/admin/cash-drawer`,\r\n      icon: (\r\n        <svg className=\"w-8 h-8\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z\" />\r\n        </svg>\r\n      ),\r\n      color: 'emerald',\r\n    },\r\n    {\r\n      title: dict.admin?.expenses || 'Expenses',\r\n      description: dict.admin?.expensesDescription || 'Manage and track business expenses',\r\n      href: `/${tenant}/${lang}/admin/expenses`,\r\n      icon: (\r\n        <svg className=\"w-8 h-8\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z\" />\r\n        </svg>\r\n      ),\r\n      color: 'red',\r\n    },\r\n    {\r\n      title: dict.admin?.auditLogs || 'Audit Logs',\r\n      description: dict.admin?.auditLogsDescription || 'View system activity, changes, and user actions',\r\n      href: `/${tenant}/${lang}/admin/audit-logs`,\r\n      icon: (\r\n        <svg className=\"w-8 h-8\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z\" />\r\n        </svg>\r\n      ),\r\n      color: 'purple',\r\n    },\r\n    {\r\n      title: dict.admin?.bookings || 'Bookings',\r\n      description: dict.admin?.bookingsDescription || 'Manage appointments, scheduling, and bookings',\r\n      href: `/${tenant}/${lang}/admin/bookings`,\r\n      featureFlag: 'enableBookingScheduling' as keyof typeof settings,\r\n      icon: (\r\n        <svg className=\"w-8 h-8\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z\" />\r\n        </svg>\r\n      ),\r\n      color: 'violet',\r\n    },\r\n    {\r\n      title: dict.admin?.bundles || 'Bundles',\r\n      description: dict.admin?.bundlesDescription || 'Manage product bundles and packages',\r\n      href: `/${tenant}/${lang}/admin/bundles`,\r\n      icon: (\r\n        <svg className=\"w-8 h-8\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4\" />\r\n        </svg>\r\n      ),\r\n      color: 'amber',\r\n    },\r\n    {\r\n      title: dict.admin?.attendance || 'Attendance',\r\n      description: dict.admin?.attendanceDescription || 'View and manage employee attendance records',\r\n      href: `/${tenant}/${lang}/admin/attendance`,\r\n      icon: (\r\n        <svg className=\"w-8 h-8\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n        </svg>\r\n      ),\r\n      color: 'rose',\r\n    },\r\n    {\r\n      title: dict.admin?.subscriptions || 'Subscriptions',\r\n      description: dict.admin?.subscriptionsDescription || 'Manage subscription plans and billing',\r\n      href: `/${tenant}/${lang}/admin/subscriptions`,\r\n      featureFlag: undefined as keyof typeof settings | undefined,\r\n      icon: (\r\n        <svg className=\"w-8 h-8\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n        </svg>\r\n      ),\r\n      color: 'emerald',\r\n    },\r\n    {\r\n      title: dict.admin?.reports || 'Reports',\r\n      description: dict.admin?.reportsDescription || 'View detailed reports and analytics',\r\n      href: `/${tenant}/${lang}/reports`,\r\n      icon: (\r\n        <svg className=\"w-8 h-8\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z\" />\r\n        </svg>\r\n      ),\r\n      color: 'slate',\r\n    },\r\n  ];\r\n\r\n  return (\r\n    <div>\r\n      <Navbar />\r\n      <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 sm:py-8\">\r\n        <div className=\"mb-6 sm:mb-8\">\r\n          <h1 className=\"text-2xl sm:text-3xl lg:text-4xl font-bold text-gray-900 mb-2\">\r\n            {dict.admin?.title || 'Admin Management'}\r\n          </h1>\r\n          <p className=\"text-gray-600\">{dict.admin?.subtitle || 'Manage users, tenants, and system settings'}</p>\r\n        </div>\r\n\r\n        {/* Subscription Usage Summary */}\r\n        {subscriptionStatus && (\r\n          <div\r\n            className=\"col-span-full mb-6 bg-gradient-to-r rounded-lg\"\r\n            style={{\r\n              background: `linear-gradient(to right, ${primaryColor}11, #a5b4fc22)`,\r\n              border: `1px solid ${primaryColor}55`,\r\n            }}\r\n          >\r\n            <div className=\"p-6\">\r\n              <div className=\"flex items-center justify-between mb-4\">\r\n                <div>\r\n                  <h2 className=\"text-lg font-semibold text-gray-900\">{dict.admin?.subscriptionUsage || 'Subscription Usage'}</h2>\r\n                  <p className=\"text-sm text-gray-600\">{subscriptionStatus.planName} {dict.admin?.plan || 'Plan'}</p>\r\n                </div>\r\n                <span className={`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${\r\n                  subscriptionStatus.isActive\r\n                    ? 'bg-green-100 text-green-800'\r\n                    : 'bg-red-100 text-red-800'\r\n                }`}>\r\n                  {subscriptionStatus.isActive ? (dict.admin?.active || \"Active\") : (dict.admin?.inactive || \"Inactive\")}\r\n                </span>\r\n              </div>\r\n              <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\r\n                <div className=\"text-center\">\r\n                  <div className=\"text-2xl font-bold\" style={{ color: primaryColor }}>{subscriptionStatus.usage.currentUsers}</div>\r\n                  <div className=\"text-xs text-gray-500\">\r\n                    {dict.admin?.users || 'Users'} ({subscriptionStatus.limits.maxUsers === -1 ? '' : subscriptionStatus.limits.maxUsers})\r\n                  </div>\r\n                </div>\r\n                <div className=\"text-center\">\r\n                  <div className=\"text-2xl font-bold text-green-600\">{subscriptionStatus.usage.currentBranches}</div>\r\n                  <div className=\"text-xs text-gray-500\">\r\n                    {dict.admin?.branches || 'Branches'} ({subscriptionStatus.limits.maxBranches === -1 ? '' : subscriptionStatus.limits.maxBranches})\r\n                  </div>\r\n                </div>\r\n                <div className=\"text-center\">\r\n                  <div className=\"text-2xl font-bold text-orange-600\">{subscriptionStatus.usage.currentProducts}</div>\r\n                  <div className=\"text-xs text-gray-500\">\r\n                    {dict.admin?.products || 'Products'} ({subscriptionStatus.limits.maxProducts === -1 ? '' : subscriptionStatus.limits.maxProducts})\r\n                  </div>\r\n                </div>\r\n                <div className=\"text-center\">\r\n                  <div className=\"text-2xl font-bold text-purple-600\">{subscriptionStatus.usage.currentTransactions}</div>\r\n                  <div className=\"text-xs text-gray-500\">\r\n                    {dict.admin?.transactions || 'Transactions'} ({subscriptionStatus.limits.maxTransactions === -1 ? '' : subscriptionStatus.limits.maxTransactions})\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\r\n          {allAdminCards\r\n            .filter(card => {\r\n              if (!card.featureFlag) return true;\r\n              if (!settings) return true; // Show by default if settings not loaded yet\r\n\r\n              // Check subscription features first\r\n              if (subscriptionStatus && !subscriptionStatus.features[card.featureFlag]) {\r\n                return false; // Hide if subscription doesn't support this feature\r\n              }\r\n\r\n              return settings[card.featureFlag] !== false; // Show if enabled or undefined (default enabled)\r\n            })\r\n            .map((card, index) => (\r\n            <Link\r\n              key={index}\r\n              href={card.href}\r\n              className=\"bg-white border border-gray-300 p-6 transition-all duration-200\"\r\n              style={{\r\n                borderColor: primaryColor,\r\n                ...(card.color === 'blue' && { boxShadow: `0 0 0 2px ${primaryColor}33` }),\r\n              }}\r\n            >\r\n              <div\r\n                className={`inline-flex p-3 border mb-4`}\r\n                style={card.color === 'blue'\r\n                  ? { background: `${primaryColor}11`, color: primaryColor, borderColor: primaryColor }\r\n                  : {}}\r\n              >\r\n                {card.icon}\r\n              </div>\r\n              <h2 className=\"text-xl font-bold text-gray-900 mb-2\">{card.title}</h2>\r\n              <p className=\"text-gray-600 text-sm\">{card.description}</p>\r\n              <div className=\"mt-4 flex items-center font-medium text-sm\"\r\n                style={card.color === 'blue' ? { color: primaryColor } : {}}>\r\n                <span>{dict.common?.view || 'View'} {card.title}</span>\r\n                <svg className=\"w-4 h-4 ml-2\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 5l7 7-7 7\" />\r\n                </svg>\r\n              </div>\r\n            </Link>\r\n          ))}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\[tenant]\\[lang]\\admin\\products\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getAllowedProductTypes' is defined but never used. Allowed unused vars must match /^_/u.","line":12,"column":33,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":55},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":29,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":29,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[958,961],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[958,961],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'router' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":64,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":64,"endColumn":15},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":67,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":67,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1942,1945],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1942,1945],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":77,"column":64,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":77,"endColumn":67,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2583,2586],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2583,2586],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchProducts'. Either include it or remove the dependency array.","line":83,"column":6,"nodeType":"ArrayExpression","endLine":83,"endColumn":20,"suggestions":[{"desc":"Update the dependencies array to be: [fetchProducts, lang, tenant]","fix":{"range":[2716,2730],"text":"[fetchProducts, lang, tenant]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":323,"column":9,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":323,"endColumn":12,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13076,13079],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13076,13079],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":324,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":324,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13104,13107],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13104,13107],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":325,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":325,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13122,13125],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13122,13125],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":441,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":441,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[18296,18299],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[18296,18299],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":674,"column":94,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":674,"endColumn":97,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[29202,29205],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[29202,29205],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":774,"column":96,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":774,"endColumn":99,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[34400,34403],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[34400,34403],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":12,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React, { useEffect, useState, useRef, useMemo } from 'react';\r\nimport Navbar from '@/components/Navbar';\r\nimport { useParams, useRouter } from 'next/navigation';\r\nimport Link from 'next/link';\r\nimport { getDictionaryClient } from '../../dictionaries-client';\r\nimport Currency from '@/components/Currency';\r\nimport { useTenantSettings } from '@/contexts/TenantSettingsContext';\r\nimport { showToast } from '@/lib/toast';\r\nimport { useConfirm } from '@/lib/confirm';\r\nimport { getBusinessTypeConfig, getAllowedProductTypes } from '@/lib/business-types';\r\nimport { getBusinessType } from '@/lib/business-type-helpers';\r\n\r\ninterface Product {\r\n  _id: string;\r\n  name: string;\r\n  description?: string;\r\n  price: number;\r\n  stock: number;\r\n  sku?: string;\r\n  category?: string;\r\n  categoryId?: {\r\n    _id: string;\r\n    name: string;\r\n  } | string;\r\n  productType: 'regular' | 'bundle' | 'service';\r\n  hasVariations: boolean;\r\n  variations?: any[];\r\n  trackInventory: boolean;\r\n  lowStockThreshold?: number;\r\n  createdAt: string;\r\n  // Restaurant-specific fields\r\n  modifiers?: Array<{\r\n    name: string;\r\n    options: Array<{ name: string; price: number }>;\r\n    required: boolean;\r\n  }>;\r\n  allergens?: string[];\r\n  nutritionInfo?: {\r\n    calories?: number;\r\n    protein?: number;\r\n    carbs?: number;\r\n    fat?: number;\r\n  };\r\n  // Laundry-specific fields\r\n  serviceType?: 'wash' | 'dry-clean' | 'press' | 'repair' | 'other';\r\n  weightBased?: boolean;\r\n  pickupDelivery?: boolean;\r\n  estimatedDuration?: number;\r\n  // Service-specific fields\r\n  serviceDuration?: number;\r\n  staffRequired?: number;\r\n  equipmentRequired?: string[];\r\n}\r\n\r\ninterface Category {\r\n  _id: string;\r\n  name: string;\r\n}\r\n\r\nexport default function ProductsPage() {\r\n  const params = useParams();\r\n  const router = useRouter();\r\n  const tenant = params.tenant as string;\r\n  const lang = params.lang as 'en' | 'es';\r\n  const [dict, setDict] = useState<any>(null);\r\n  const [products, setProducts] = useState<Product[]>([]);\r\n  const [categories, setCategories] = useState<Category[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [message, setMessage] = useState<{ type: 'success' | 'error'; text: string } | null>(null);\r\n  const [showProductModal, setShowProductModal] = useState(false);\r\n  const [editingProduct, setEditingProduct] = useState<Product | null>(null);\r\n  const [searchTerm, setSearchTerm] = useState('');\r\n  const { settings } = useTenantSettings();\r\n  const { confirm, Dialog } = useConfirm();\r\n  const [businessTypeConfig, setBusinessTypeConfig] = useState<any>(null);\r\n\r\n  useEffect(() => {\r\n    getDictionaryClient(lang).then(setDict);\r\n    fetchProducts();\r\n    fetchCategories();\r\n  }, [lang, tenant]);\r\n\r\n  useEffect(() => {\r\n    if (settings) {\r\n      const businessType = getBusinessType(settings);\r\n      const config = getBusinessTypeConfig(businessType);\r\n      setBusinessTypeConfig(config);\r\n    }\r\n  }, [settings]);\r\n\r\n  const fetchProducts = async () => {\r\n    try {\r\n      const res = await fetch('/api/products', { credentials: 'include' });\r\n      const data = await res.json();\r\n      if (data.success) {\r\n        setProducts(data.data);\r\n        setMessage(null);\r\n      } else {\r\n        setMessage({ type: 'error', text: data.error || dict?.common?.failedToFetchProducts || 'Failed to fetch products' });\r\n      }\r\n    } catch (error) {\r\n      console.error('Error fetching products:', error);\r\n      setMessage({ type: 'error', text: dict?.common?.failedToFetchProducts || 'Failed to fetch products' });\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const fetchCategories = async () => {\r\n    try {\r\n      const res = await fetch('/api/categories', { credentials: 'include' });\r\n      const data = await res.json();\r\n      if (data.success) {\r\n        setCategories(data.data);\r\n      } else {\r\n        console.error('Error fetching categories:', data.error);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error fetching categories:', error);\r\n    }\r\n  };\r\n\r\n  const handleDeleteProduct = async (productId: string) => {\r\n    if (!dict) return;\r\n    const confirmed = await confirm(\r\n      dict.common?.deleteProductConfirmTitle || 'Delete Product',\r\n      dict.common?.deleteProductConfirm || 'Are you sure you want to delete this product?',\r\n      { variant: 'danger' }\r\n    );\r\n    if (!confirmed) return;\r\n    try {\r\n      const res = await fetch(`/api/products/${productId}`, { method: 'DELETE', credentials: 'include' });\r\n      const data = await res.json();\r\n      if (data.success) {\r\n        showToast.success(dict.common?.productDeletedSuccess || 'Product deleted successfully');\r\n        fetchProducts();\r\n      } else {\r\n        showToast.error(data.error || dict.common?.failedToDeleteProduct || 'Failed to delete product');\r\n      }\r\n    } catch (error) {\r\n      showToast.error(dict.common?.failedToDeleteProduct || 'Failed to delete product');\r\n    }\r\n  };\r\n\r\n  const filteredProducts = products.filter(product =>\r\n    product.name.toLowerCase().includes(searchTerm.toLowerCase()) ||\r\n    product.sku?.toLowerCase().includes(searchTerm.toLowerCase()) ||\r\n    product.description?.toLowerCase().includes(searchTerm.toLowerCase())\r\n  );\r\n\r\n  if (!dict || loading) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gray-50 flex items-center justify-center\">\r\n        <div className=\"text-center\">\r\n          <div className=\"inline-block animate-spin h-8 w-8 border-b-2 border-blue-600\"></div>\r\n          <p className=\"mt-4 text-gray-600\">{dict?.common?.loading || 'Loading...'}</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50\">\r\n      {Dialog}\r\n      <Navbar />\r\n      <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 sm:py-8\">\r\n        <div className=\"mb-6 sm:mb-8\">\r\n          <Link\r\n            href={`/${tenant}/${lang}/admin`}\r\n            className=\"inline-flex items-center text-blue-600 hover:text-blue-700 font-medium mb-4 transition-colors\"\r\n          >\r\n            <svg className=\"w-5 h-5 mr-2\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M10 19l-7-7m0 0l7-7m-7 7h18\" />\r\n            </svg>\r\n            {dict?.admin?.backToAdmin || 'Back to Admin'}\r\n          </Link>\r\n          <div className=\"flex items-center justify-between\">\r\n            <div>\r\n              <h1 className=\"text-2xl sm:text-3xl lg:text-4xl font-bold text-gray-900 mb-2\">\r\n                {dict.admin?.products || 'Products'}\r\n              </h1>\r\n              <p className=\"text-gray-600\">{dict.admin?.productsSubtitle || 'Manage products, variations, and bundles'}</p>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {message && (\r\n          <div className={`mb-6 p-4 border ${message.type === 'success' ? 'bg-green-50 text-green-800 border-green-300' : 'bg-red-50 text-red-800 border-red-300'}`}>\r\n            {message.text}\r\n          </div>\r\n        )}\r\n\r\n        <div className=\"bg-white border border-gray-300 p-6\">\r\n          <div className=\"flex justify-between items-center mb-6\">\r\n            <div className=\"flex-1 max-w-md\">\r\n              <input\r\n                type=\"text\"\r\n                placeholder={dict.common?.search || 'Search products...'}\r\n                value={searchTerm}\r\n                onChange={(e) => setSearchTerm(e.target.value)}\r\n                className=\"w-full px-4 py-2 border border-gray-300 focus:ring-2 focus:ring-blue-500 bg-white\"\r\n              />\r\n            </div>\r\n            <button\r\n              onClick={() => {\r\n                setEditingProduct(null);\r\n                setShowProductModal(true);\r\n              }}\r\n              className=\"ml-4 px-4 py-2 bg-blue-600 text-white hover:bg-blue-700 font-medium border border-blue-700\"\r\n            >\r\n              {dict.common?.add || 'Add'} {dict.admin?.product || 'Product'}\r\n            </button>\r\n          </div>\r\n          <div className=\"overflow-x-auto\">\r\n            <table className=\"min-w-full divide-y divide-gray-200\">\r\n              <thead className=\"bg-gray-50\">\r\n                <tr>\r\n                  <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">{dict.admin?.name || 'Name'}</th>\r\n                  <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">SKU</th>\r\n                  <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">{dict.admin?.category || 'Category'}</th>\r\n                  <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">{dict.admin?.price || 'Price'}</th>\r\n                  <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">{dict.admin?.stock || 'Stock'}</th>\r\n                  <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">{dict.common?.type || 'Type'}</th>\r\n                  <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">{dict.common?.actions || 'Actions'}</th>\r\n                </tr>\r\n              </thead>\r\n              <tbody className=\"bg-white divide-y divide-gray-200\">\r\n                {filteredProducts.map((product) => (\r\n                  <tr key={product._id}>\r\n                    <td className=\"px-4 py-4\">\r\n                      <div className=\"text-sm font-medium text-gray-900\">{product.name}</div>\r\n                      {product.description && (\r\n                        <div className=\"text-xs text-gray-500 mt-1\">{product.description.substring(0, 50)}...</div>\r\n                      )}\r\n                    </td>\r\n                    <td className=\"px-4 py-4 whitespace-nowrap text-sm text-gray-500\">{product.sku || '-'}</td>\r\n                    <td className=\"px-4 py-4 whitespace-nowrap text-sm text-gray-500\">\r\n                      {typeof product.categoryId === 'object' && product.categoryId?.name ? product.categoryId.name : product.category || '-'}\r\n                    </td>\r\n                    <td className=\"px-4 py-4 whitespace-nowrap text-sm font-medium text-gray-900\">\r\n                      <Currency amount={product.price} />\r\n                    </td>\r\n                    <td className=\"px-4 py-4 whitespace-nowrap\">\r\n                      <span className={`text-sm font-medium ${product.stock < (product.lowStockThreshold || 10) ? 'text-red-600' : 'text-gray-900'}`}>\r\n                        {product.trackInventory ? product.stock : ''}\r\n                      </span>\r\n                    </td>\r\n                    <td className=\"px-4 py-4 whitespace-nowrap\">\r\n                      <span className=\"px-2 py-1 text-xs font-semibold border border-blue-300 bg-blue-100 text-blue-800\">\r\n                        {product.productType}\r\n                        {product.hasVariations && ' (variations)'}\r\n                      </span>\r\n                    </td>\r\n                    <td className=\"px-4 py-4 whitespace-nowrap text-sm font-medium\">\r\n                      <div className=\"flex gap-2\">\r\n                        <button\r\n                          onClick={() => {\r\n                            setEditingProduct(product);\r\n                            setShowProductModal(true);\r\n                          }}\r\n                          className=\"text-blue-600 hover:text-blue-900\"\r\n                        >\r\n                          {dict.common?.edit || 'Edit'}\r\n                        </button>\r\n                        <button\r\n                          onClick={() => handleDeleteProduct(product._id)}\r\n                          className=\"text-red-600 hover:text-red-900\"\r\n                        >\r\n                          {dict.common?.delete || 'Delete'}\r\n                        </button>\r\n                      </div>\r\n                    </td>\r\n                  </tr>\r\n                ))}\r\n              </tbody>\r\n            </table>\r\n            {filteredProducts.length === 0 && (\r\n              <div className=\"text-center py-8 text-gray-500\">\r\n                {searchTerm ? (dict.common?.noResults || 'No products found') : (dict.common?.noData || 'No products yet')}\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n\r\n        {showProductModal && (\r\n          <ProductModal\r\n            product={editingProduct}\r\n            categories={categories}\r\n            onClose={() => {\r\n              setShowProductModal(false);\r\n              setEditingProduct(null);\r\n            }}\r\n            onSave={() => {\r\n              fetchProducts();\r\n              setShowProductModal(false);\r\n              setEditingProduct(null);\r\n            }}\r\n            dict={dict}\r\n            businessTypeConfig={businessTypeConfig}\r\n            settings={settings}\r\n          />\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction ProductModal({\r\n  product,\r\n  categories,\r\n  onClose,\r\n  onSave,\r\n  dict,\r\n  businessTypeConfig,\r\n  settings,\r\n}: {\r\n  product: Product | null;\r\n  categories: Category[];\r\n  onClose: () => void;\r\n  onSave: () => void;\r\n  dict: any;\r\n  businessTypeConfig: any;\r\n  settings: any;\r\n}) {\r\n  const [formData, setFormData] = useState({\r\n    name: product?.name || '',\r\n    description: product?.description || '',\r\n    price: product?.price || 0,\r\n    stock: product?.stock || 0,\r\n    sku: product?.sku || '',\r\n    categoryId: typeof product?.categoryId === 'object' && product.categoryId?._id ? product.categoryId._id : product?.categoryId || '',\r\n    productType: product?.productType || (businessTypeConfig?.productTypes?.[0] || 'regular'),\r\n    trackInventory: product?.trackInventory !== undefined ? product.trackInventory : (businessTypeConfig?.defaultFeatures?.enableInventory ?? true),\r\n    lowStockThreshold: product?.lowStockThreshold || 10,\r\n    // Restaurant-specific fields\r\n    modifiers: product?.modifiers || [],\r\n    allergens: product?.allergens || [],\r\n    nutritionInfo: product?.nutritionInfo || { calories: undefined, protein: undefined, carbs: undefined, fat: undefined },\r\n    // Laundry-specific fields\r\n    serviceType: product?.serviceType || 'wash',\r\n    weightBased: product?.weightBased || false,\r\n    pickupDelivery: product?.pickupDelivery || false,\r\n    estimatedDuration: product?.estimatedDuration || undefined,\r\n    // Service-specific fields\r\n    serviceDuration: product?.serviceDuration || undefined,\r\n    staffRequired: product?.staffRequired || 1,\r\n    equipmentRequired: product?.equipmentRequired || [],\r\n  });\r\n\r\n  // Update formData when product or businessTypeConfig changes\r\n  useEffect(() => {\r\n    setFormData({\r\n      name: product?.name || '',\r\n      description: product?.description || '',\r\n      price: product?.price || 0,\r\n      stock: product?.stock || 0,\r\n      sku: product?.sku || '',\r\n      categoryId: typeof product?.categoryId === 'object' && product.categoryId?._id ? product.categoryId._id : product?.categoryId || '',\r\n      productType: product?.productType || (businessTypeConfig?.productTypes?.[0] || 'regular'),\r\n      trackInventory: product?.trackInventory !== undefined ? product.trackInventory : (businessTypeConfig?.defaultFeatures?.enableInventory ?? true),\r\n      lowStockThreshold: product?.lowStockThreshold || 10,\r\n      // Restaurant-specific fields\r\n      modifiers: product?.modifiers || [],\r\n      allergens: product?.allergens || [],\r\n      nutritionInfo: product?.nutritionInfo || { calories: undefined, protein: undefined, carbs: undefined, fat: undefined },\r\n      // Laundry-specific fields\r\n      serviceType: product?.serviceType || 'wash',\r\n      weightBased: product?.weightBased || false,\r\n      pickupDelivery: product?.pickupDelivery || false,\r\n      estimatedDuration: product?.estimatedDuration || undefined,\r\n      // Service-specific fields\r\n      serviceDuration: product?.serviceDuration || undefined,\r\n      staffRequired: product?.staffRequired || 1,\r\n      equipmentRequired: product?.equipmentRequired || [],\r\n    });\r\n  }, [product, businessTypeConfig]);\r\n  const [saving, setSaving] = useState(false);\r\n  const [error, setError] = useState('');\r\n  const [categorySearch, setCategorySearch] = useState('');\r\n  const [showCategorySuggestions, setShowCategorySuggestions] = useState(false);\r\n  const categoryInputRef = useRef<HTMLInputElement>(null);\r\n  const categoryListRef = useRef<HTMLDivElement>(null);\r\n\r\n  // Initialize category search with current category name\r\n  useEffect(() => {\r\n    if (product?.categoryId) {\r\n      const currentCategory = categories.find(\r\n        cat => cat._id === (typeof product.categoryId === 'object' && product.categoryId?._id ? product.categoryId._id : product.categoryId)\r\n      );\r\n      if (currentCategory) {\r\n        setCategorySearch(currentCategory.name);\r\n      } else {\r\n        setCategorySearch('');\r\n      }\r\n    } else {\r\n      setCategorySearch('');\r\n    }\r\n  }, [product, categories]);\r\n\r\n  // Filter categories based on search\r\n  const filteredCategories = useMemo(() => {\r\n    if (!categorySearch.trim()) return categories;\r\n    return categories.filter(cat =>\r\n      cat.name.toLowerCase().includes(categorySearch.toLowerCase())\r\n    );\r\n  }, [categorySearch, categories]);\r\n\r\n  // Handle category selection\r\n  const handleCategorySelect = (category: Category) => {\r\n    setFormData({ ...formData, categoryId: category._id });\r\n    setCategorySearch(category.name);\r\n    setShowCategorySuggestions(false);\r\n  };\r\n\r\n  // Handle clicks outside to close suggestions\r\n  useEffect(() => {\r\n    const handleClickOutside = (event: MouseEvent) => {\r\n      if (\r\n        categoryInputRef.current &&\r\n        categoryListRef.current &&\r\n        !categoryInputRef.current.contains(event.target as Node) &&\r\n        !categoryListRef.current.contains(event.target as Node)\r\n      ) {\r\n        setShowCategorySuggestions(false);\r\n      }\r\n    };\r\n\r\n    document.addEventListener('mousedown', handleClickOutside);\r\n    return () => document.removeEventListener('mousedown', handleClickOutside);\r\n  }, []);\r\n\r\n  const handleSubmit = async (e: React.FormEvent<HTMLFormElement>) => {\r\n    e.preventDefault();\r\n    setError('');\r\n    setSaving(true);\r\n    try {\r\n      const url = product ? `/api/products/${product._id}` : '/api/products';\r\n      const method = product ? 'PUT' : 'POST';\r\n      const body: any = {\r\n        name: formData.name,\r\n        description: formData.description || undefined,\r\n        price: formData.price,\r\n        stock: formData.stock,\r\n        sku: formData.sku || undefined,\r\n        categoryId: formData.categoryId || undefined,\r\n        productType: formData.productType,\r\n        trackInventory: formData.trackInventory,\r\n        lowStockThreshold: formData.lowStockThreshold,\r\n      };\r\n\r\n      // Add restaurant-specific fields\r\n      if (settings?.businessType?.toLowerCase() === 'restaurant') {\r\n        if (formData.allergens && formData.allergens.length > 0) {\r\n          body.allergens = formData.allergens;\r\n        }\r\n        if (formData.nutritionInfo && (formData.nutritionInfo.calories || formData.nutritionInfo.protein)) {\r\n          body.nutritionInfo = formData.nutritionInfo;\r\n        }\r\n        if (formData.modifiers && formData.modifiers.length > 0) {\r\n          body.modifiers = formData.modifiers;\r\n        }\r\n      }\r\n\r\n      // Add laundry-specific fields\r\n      if (settings?.businessType?.toLowerCase() === 'laundry') {\r\n        body.serviceType = formData.serviceType;\r\n        body.weightBased = formData.weightBased;\r\n        body.pickupDelivery = formData.pickupDelivery;\r\n        if (formData.estimatedDuration) {\r\n          body.estimatedDuration = formData.estimatedDuration;\r\n        }\r\n      }\r\n\r\n      // Add service-specific fields\r\n      if (settings?.businessType?.toLowerCase() === 'service') {\r\n        if (formData.serviceDuration) {\r\n          body.serviceDuration = formData.serviceDuration;\r\n        }\r\n        body.staffRequired = formData.staffRequired;\r\n        if (formData.equipmentRequired && formData.equipmentRequired.length > 0) {\r\n          body.equipmentRequired = formData.equipmentRequired;\r\n        }\r\n      }\r\n\r\n      const res = await fetch(url, {\r\n        method,\r\n        headers: { 'Content-Type': 'application/json' },\r\n        credentials: 'include',\r\n        body: JSON.stringify(body),\r\n      });\r\n\r\n      const data = await res.json();\r\n      if (data.success) {\r\n        onSave();\r\n      } else {\r\n        setError(data.error || 'Failed to save product');\r\n      }\r\n    } catch (error) {\r\n      setError('Failed to save product');\r\n    } finally {\r\n      setSaving(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 bg-gray-900/20 backdrop-blur-sm flex items-center justify-center z-50 p-4\">\r\n      <div className=\"bg-white border border-gray-300 max-w-2xl w-full max-h-[90vh] overflow-y-auto\">\r\n        <div className=\"p-6\">\r\n          <h2 className=\"text-2xl font-bold text-gray-900 mb-4\">\r\n            {product ? (dict.admin?.editProduct || 'Edit Product') : (dict.admin?.addProduct || 'Add Product')}\r\n          </h2>\r\n          {businessTypeConfig && (\r\n            <div className=\"mb-4 p-3 bg-blue-50 border border-blue-200 rounded\">\r\n              <p className=\"text-sm text-blue-900\">\r\n                <strong>Business Type:</strong> {businessTypeConfig.name}\r\n              </p>\r\n              <p className=\"text-xs text-blue-700 mt-1\">\r\n                {businessTypeConfig.description}\r\n              </p>\r\n              {businessTypeConfig.requiredFields.length > 0 && (\r\n                <p className=\"text-xs text-blue-700 mt-1\">\r\n                  <strong>Required fields:</strong> {businessTypeConfig.requiredFields.join(', ')}\r\n                </p>\r\n              )}\r\n            </div>\r\n          )}\r\n          <form onSubmit={handleSubmit} className=\"space-y-4\">\r\n            <div className=\"grid grid-cols-2 gap-4\">\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                  {dict.admin?.name || 'Name'} *\r\n                </label>\r\n                <input\r\n                  type=\"text\"\r\n                  required\r\n                  value={formData.name}\r\n                  onChange={(e) => setFormData({ ...formData, name: e.target.value })}\r\n                  className=\"w-full px-3 py-2 border border-gray-300 focus:ring-2 focus:ring-blue-500 bg-white\"\r\n                />\r\n              </div>\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                  SKU {businessTypeConfig?.requiredFields?.includes('sku') && <span className=\"text-red-500\">*</span>}\r\n                </label>\r\n                <input\r\n                  type=\"text\"\r\n                  required={businessTypeConfig?.requiredFields?.includes('sku')}\r\n                  value={formData.sku}\r\n                  onChange={(e) => setFormData({ ...formData, sku: e.target.value })}\r\n                  className=\"w-full px-3 py-2 border border-gray-300 focus:ring-2 focus:ring-blue-500 bg-white\"\r\n                />\r\n              </div>\r\n            </div>\r\n            <div>\r\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                {dict.admin?.description || 'Description'}\r\n              </label>\r\n              <textarea\r\n                value={formData.description}\r\n                onChange={(e) => setFormData({ ...formData, description: e.target.value })}\r\n                rows={3}\r\n                className=\"w-full px-3 py-2 border border-gray-300 focus:ring-2 focus:ring-blue-500 bg-white\"\r\n              />\r\n            </div>\r\n            <div className={`grid gap-4 ${businessTypeConfig?.defaultFeatures?.enableInventory !== false ? 'grid-cols-3' : 'grid-cols-1'}`}>\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                  {dict.admin?.price || 'Price'} *\r\n                </label>\r\n                <input\r\n                  type=\"number\"\r\n                  step=\"0.01\"\r\n                  min=\"0\"\r\n                  required\r\n                  value={formData.price}\r\n                  onChange={(e) => setFormData({ ...formData, price: parseFloat(e.target.value) || 0 })}\r\n                  className=\"w-full px-3 py-2 border border-gray-300 focus:ring-2 focus:ring-blue-500 bg-white\"\r\n                />\r\n              </div>\r\n              {businessTypeConfig?.defaultFeatures?.enableInventory !== false && (\r\n                <div>\r\n                  <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                    {dict.admin?.stock || 'Stock'}\r\n                  </label>\r\n                  <input\r\n                    type=\"number\"\r\n                    min=\"0\"\r\n                    value={formData.stock}\r\n                    onChange={(e) => setFormData({ ...formData, stock: parseInt(e.target.value) || 0 })}\r\n                    className=\"w-full px-3 py-2 border border-gray-300 focus:ring-2 focus:ring-blue-500 bg-white\"\r\n                    disabled={!formData.trackInventory}\r\n                  />\r\n                </div>\r\n              )}\r\n              {businessTypeConfig?.defaultFeatures?.enableInventory !== false && (\r\n                <div>\r\n                  <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                    {dict.admin?.lowStockThreshold || 'Low Stock Threshold'}\r\n                  </label>\r\n                  <input\r\n                    type=\"number\"\r\n                    min=\"0\"\r\n                    value={formData.lowStockThreshold}\r\n                    onChange={(e) => setFormData({ ...formData, lowStockThreshold: parseInt(e.target.value) || 10 })}\r\n                    className=\"w-full px-3 py-2 border border-gray-300 focus:ring-2 focus:ring-blue-500 bg-white\"\r\n                  />\r\n                </div>\r\n              )}\r\n            </div>\r\n            <div className=\"grid grid-cols-2 gap-4\">\r\n              <div className=\"relative\">\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                  {dict.admin?.category || 'Category'}\r\n                </label>\r\n                <div ref={categoryInputRef} className=\"relative\">\r\n                  <input\r\n                    type=\"text\"\r\n                    value={categorySearch}\r\n                    onChange={(e) => {\r\n                      const value = e.target.value;\r\n                      setCategorySearch(value);\r\n                      setShowCategorySuggestions(true);\r\n                      // Clear categoryId if search doesn't match any category\r\n                      const matchingCategory = categories.find(\r\n                        cat => cat.name.toLowerCase() === value.toLowerCase()\r\n                      );\r\n                      if (matchingCategory) {\r\n                        setFormData({ ...formData, categoryId: matchingCategory._id });\r\n                      } else {\r\n                        setFormData({ ...formData, categoryId: '' });\r\n                      }\r\n                    }}\r\n                    onFocus={() => setShowCategorySuggestions(true)}\r\n                    placeholder={dict.admin?.searchCategory || 'Type to search categories...'}\r\n                    className=\"w-full px-3 py-2 border border-gray-300 focus:ring-2 focus:ring-blue-500 bg-white\"\r\n                  />\r\n                  {showCategorySuggestions && filteredCategories.length > 0 && (\r\n                    <div\r\n                      ref={categoryListRef}\r\n                      className=\"absolute z-50 w-full mt-1 bg-white border border-gray-300 max-h-60 overflow-y-auto\"\r\n                    >\r\n                      {filteredCategories.map((cat) => (\r\n                        <button\r\n                          key={cat._id}\r\n                          type=\"button\"\r\n                          onClick={() => handleCategorySelect(cat)}\r\n                          className={`w-full text-left px-4 py-2 hover:bg-blue-50 focus:bg-blue-50 focus:outline-none transition-colors ${\r\n                            formData.categoryId === cat._id ? 'bg-blue-100' : ''\r\n                          }`}\r\n                        >\r\n                          {cat.name}\r\n                        </button>\r\n                      ))}\r\n                    </div>\r\n                  )}\r\n                  {showCategorySuggestions && categorySearch && filteredCategories.length === 0 && (\r\n                    <div\r\n                      ref={categoryListRef}\r\n                      className=\"absolute z-50 w-full mt-1 bg-white border border-gray-300 p-4 text-sm text-gray-500\"\r\n                    >\r\n                      {dict.admin?.noCategoryFound || 'No category found'}\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              </div>\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                  {dict.common?.type || 'Type'} {businessTypeConfig && `(${businessTypeConfig.name})`}\r\n                </label>\r\n                <select\r\n                  value={formData.productType}\r\n                  onChange={(e) => setFormData({ ...formData, productType: e.target.value as any })}\r\n                  className=\"w-full px-3 py-2 border border-gray-300 focus:ring-2 focus:ring-blue-500 bg-white\"\r\n                >\r\n                  {businessTypeConfig?.productTypes?.map((type: string) => (\r\n                    <option key={type} value={type}>\r\n                      {type === 'regular' ? (dict.admin?.regular || 'Regular') : \r\n                       type === 'bundle' ? (dict.admin?.bundle || 'Bundle') : \r\n                       (dict.admin?.service || 'Service')}\r\n                    </option>\r\n                  )) || (\r\n                    <>\r\n                      <option value=\"regular\">{dict.admin?.regular || 'Regular'}</option>\r\n                      <option value=\"bundle\">{dict.admin?.bundle || 'Bundle'}</option>\r\n                      <option value=\"service\">{dict.admin?.service || 'Service'}</option>\r\n                    </>\r\n                  )}\r\n                </select>\r\n                {businessTypeConfig && businessTypeConfig.productTypes.length === 1 && (\r\n                  <p className=\"mt-1 text-xs text-gray-500\">\r\n                    Only {businessTypeConfig.productTypes[0]} products are allowed for {businessTypeConfig.name}\r\n                  </p>\r\n                )}\r\n              </div>\r\n            </div>\r\n            {businessTypeConfig?.defaultFeatures?.enableInventory !== false && (\r\n              <div>\r\n                <label className=\"flex items-center\">\r\n                  <input\r\n                    type=\"checkbox\"\r\n                    checked={formData.trackInventory}\r\n                    onChange={(e) => setFormData({ ...formData, trackInventory: e.target.checked })}\r\n                    className=\"mr-2\"\r\n                  />\r\n                  <span className=\"text-sm font-medium text-gray-700\">\r\n                    {dict.admin?.trackInventory || 'Track Inventory'}\r\n                  </span>\r\n                </label>\r\n              </div>\r\n            )}\r\n\r\n            {/* Restaurant-specific fields */}\r\n            {settings?.businessType?.toLowerCase() === 'restaurant' && (\r\n              <div className=\"space-y-4 pt-4 border-t border-gray-200\">\r\n                <h3 className=\"text-lg font-semibold text-gray-900\">Restaurant Information</h3>\r\n                \r\n                <div>\r\n                  <label className=\"block text-sm font-medium text-gray-700 mb-1\">Allergens (comma-separated)</label>\r\n                  <input\r\n                    type=\"text\"\r\n                    value={Array.isArray(formData.allergens) ? formData.allergens.join(', ') : formData.allergens || ''}\r\n                    onChange={(e) => {\r\n                      const allergens = e.target.value.split(',').map(a => a.trim()).filter(a => a);\r\n                      setFormData({ ...formData, allergens });\r\n                    }}\r\n                    className=\"w-full px-3 py-2 border border-gray-300 focus:ring-2 focus:ring-blue-500 bg-white\"\r\n                    placeholder=\"e.g., gluten, dairy, nuts\"\r\n                  />\r\n                </div>\r\n\r\n                <div className=\"grid grid-cols-2 gap-4\">\r\n                  <div>\r\n                    <label className=\"block text-sm font-medium text-gray-700 mb-1\">Calories</label>\r\n                    <input\r\n                      type=\"number\"\r\n                      min=\"0\"\r\n                      value={formData.nutritionInfo?.calories || ''}\r\n                      onChange={(e) => setFormData({\r\n                        ...formData,\r\n                        nutritionInfo: { ...formData.nutritionInfo, calories: parseInt(e.target.value) || undefined }\r\n                      })}\r\n                      className=\"w-full px-3 py-2 border border-gray-300 focus:ring-2 focus:ring-blue-500 bg-white\"\r\n                    />\r\n                  </div>\r\n                  <div>\r\n                    <label className=\"block text-sm font-medium text-gray-700 mb-1\">Protein (g)</label>\r\n                    <input\r\n                      type=\"number\"\r\n                      min=\"0\"\r\n                      step=\"0.1\"\r\n                      value={formData.nutritionInfo?.protein || ''}\r\n                      onChange={(e) => setFormData({\r\n                        ...formData,\r\n                        nutritionInfo: { ...formData.nutritionInfo, protein: parseFloat(e.target.value) || undefined }\r\n                      })}\r\n                      className=\"w-full px-3 py-2 border border-gray-300 focus:ring-2 focus:ring-blue-500 bg-white\"\r\n                    />\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            )}\r\n\r\n            {/* Laundry-specific fields */}\r\n            {settings?.businessType?.toLowerCase() === 'laundry' && (\r\n              <div className=\"space-y-4 pt-4 border-t border-gray-200\">\r\n                <h3 className=\"text-lg font-semibold text-gray-900\">Laundry Service Information</h3>\r\n                \r\n                <div>\r\n                  <label className=\"block text-sm font-medium text-gray-700 mb-1\">Service Type</label>\r\n                  <select\r\n                    value={formData.serviceType}\r\n                    onChange={(e) => setFormData({ ...formData, serviceType: e.target.value as any })}\r\n                    className=\"w-full px-3 py-2 border border-gray-300 focus:ring-2 focus:ring-blue-500 bg-white\"\r\n                  >\r\n                    <option value=\"wash\">Wash</option>\r\n                    <option value=\"dry-clean\">Dry Clean</option>\r\n                    <option value=\"press\">Press</option>\r\n                    <option value=\"repair\">Repair</option>\r\n                    <option value=\"other\">Other</option>\r\n                  </select>\r\n                </div>\r\n\r\n                <div className=\"grid grid-cols-2 gap-4\">\r\n                  <div>\r\n                    <label className=\"flex items-center\">\r\n                      <input\r\n                        type=\"checkbox\"\r\n                        checked={formData.weightBased}\r\n                        onChange={(e) => setFormData({ ...formData, weightBased: e.target.checked })}\r\n                        className=\"mr-2\"\r\n                      />\r\n                      <span className=\"text-sm font-medium text-gray-700\">Weight-based pricing</span>\r\n                    </label>\r\n                  </div>\r\n                  <div>\r\n                    <label className=\"flex items-center\">\r\n                      <input\r\n                        type=\"checkbox\"\r\n                        checked={formData.pickupDelivery}\r\n                        onChange={(e) => setFormData({ ...formData, pickupDelivery: e.target.checked })}\r\n                        className=\"mr-2\"\r\n                      />\r\n                      <span className=\"text-sm font-medium text-gray-700\">Pickup & Delivery</span>\r\n                    </label>\r\n                  </div>\r\n                </div>\r\n\r\n                <div>\r\n                  <label className=\"block text-sm font-medium text-gray-700 mb-1\">Estimated Duration (minutes)</label>\r\n                  <input\r\n                    type=\"number\"\r\n                    min=\"0\"\r\n                    value={formData.estimatedDuration || ''}\r\n                    onChange={(e) => setFormData({ ...formData, estimatedDuration: parseInt(e.target.value) || undefined })}\r\n                    className=\"w-full px-3 py-2 border border-gray-300 focus:ring-2 focus:ring-blue-500 bg-white\"\r\n                  />\r\n                </div>\r\n              </div>\r\n            )}\r\n\r\n            {/* Service-specific fields */}\r\n            {settings?.businessType?.toLowerCase() === 'service' && (\r\n              <div className=\"space-y-4 pt-4 border-t border-gray-200\">\r\n                <h3 className=\"text-lg font-semibold text-gray-900\">Service Information</h3>\r\n                \r\n                <div className=\"grid grid-cols-2 gap-4\">\r\n                  <div>\r\n                    <label className=\"block text-sm font-medium text-gray-700 mb-1\">Service Duration (minutes)</label>\r\n                    <input\r\n                      type=\"number\"\r\n                      min=\"0\"\r\n                      value={formData.serviceDuration || ''}\r\n                      onChange={(e) => setFormData({ ...formData, serviceDuration: parseInt(e.target.value) || undefined })}\r\n                      className=\"w-full px-3 py-2 border border-gray-300 focus:ring-2 focus:ring-blue-500 bg-white\"\r\n                    />\r\n                  </div>\r\n                  <div>\r\n                    <label className=\"block text-sm font-medium text-gray-700 mb-1\">Staff Required</label>\r\n                    <input\r\n                      type=\"number\"\r\n                      min=\"1\"\r\n                      value={formData.staffRequired || 1}\r\n                      onChange={(e) => setFormData({ ...formData, staffRequired: parseInt(e.target.value) || 1 })}\r\n                      className=\"w-full px-3 py-2 border border-gray-300 focus:ring-2 focus:ring-blue-500 bg-white\"\r\n                    />\r\n                  </div>\r\n                </div>\r\n\r\n                <div>\r\n                  <label className=\"block text-sm font-medium text-gray-700 mb-1\">Equipment Required (comma-separated)</label>\r\n                  <input\r\n                    type=\"text\"\r\n                    value={Array.isArray(formData.equipmentRequired) ? formData.equipmentRequired.join(', ') : formData.equipmentRequired || ''}\r\n                    onChange={(e) => {\r\n                      const equipment = e.target.value.split(',').map(e => e.trim()).filter(e => e);\r\n                      setFormData({ ...formData, equipmentRequired: equipment });\r\n                    }}\r\n                    className=\"w-full px-3 py-2 border border-gray-300 focus:ring-2 focus:ring-blue-500 bg-white\"\r\n                    placeholder=\"e.g., scissors, clippers, styling chair\"\r\n                  />\r\n                </div>\r\n              </div>\r\n            )}\r\n            {error && (\r\n              <div className=\"bg-red-50 text-red-800 border border-red-300 p-3\">\r\n                {error}\r\n              </div>\r\n            )}\r\n            <div className=\"flex gap-3 justify-end pt-4\">\r\n              <button\r\n                type=\"button\"\r\n                onClick={onClose}\r\n                className=\"px-4 py-2 border border-gray-300 text-gray-700 hover:bg-gray-50 bg-white\"\r\n              >\r\n                {dict.common?.cancel || 'Cancel'}\r\n              </button>\r\n              <button\r\n                type=\"submit\"\r\n                disabled={saving}\r\n                className=\"px-4 py-2 bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-50 border border-blue-700\"\r\n              >\r\n                {saving ? (dict.common?.loading || 'Saving...') : (dict.common?.save || 'Save')}\r\n              </button>\r\n            </div>\r\n          </form>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\[tenant]\\[lang]\\admin\\stock-movements\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'router' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":35,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":35,"endColumn":15},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":38,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":38,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1329,1332],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1329,1332],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchMovements'. Either include it or remove the dependency array.","line":55,"column":6,"nodeType":"ArrayExpression","endLine":55,"endColumn":35,"suggestions":[{"desc":"Update the dependencies array to be: [lang, tenant, page, filters, fetchMovements]","fix":{"range":[2059,2088],"text":"[lang, tenant, page, filters, fetchMovements]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useEffect, useState } from 'react';\r\nimport Navbar from '@/components/Navbar';\r\nimport { useParams, useRouter } from 'next/navigation';\r\nimport Link from 'next/link';\r\nimport { getDictionaryClient } from '../../dictionaries-client';\r\nimport { useTenantSettings } from '@/contexts/TenantSettingsContext';\r\nimport { supportsFeature } from '@/lib/business-type-helpers';\r\nimport { getBusinessTypeConfig } from '@/lib/business-types';\r\nimport { getBusinessType } from '@/lib/business-type-helpers';\r\n\r\ninterface StockMovement {\r\n  _id: string;\r\n  productId: string | { _id: string; name: string; sku?: string };\r\n  branchId?: string | { _id: string; name: string };\r\n  variation?: {\r\n    size?: string;\r\n    color?: string;\r\n    type?: string;\r\n  };\r\n  type: 'sale' | 'purchase' | 'adjustment' | 'return' | 'damage' | 'transfer';\r\n  quantity: number;\r\n  previousStock: number;\r\n  newStock: number;\r\n  reason?: string;\r\n  transactionId?: string | { receiptNumber?: string };\r\n  userId?: string | { name: string; email: string };\r\n  notes?: string;\r\n  createdAt: string;\r\n}\r\n\r\nexport default function StockMovementsPage() {\r\n  const params = useParams();\r\n  const router = useRouter();\r\n  const tenant = params.tenant as string;\r\n  const lang = params.lang as 'en' | 'es';\r\n  const [dict, setDict] = useState<any>(null);\r\n  const [movements, setMovements] = useState<StockMovement[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [page, setPage] = useState(1);\r\n  const [totalPages, setTotalPages] = useState(1);\r\n  const [filters, setFilters] = useState({\r\n    type: '',\r\n    productId: '',\r\n  });\r\n  const [message, setMessage] = useState<{ type: 'success' | 'error'; text: string } | null>(null);\r\n  const { settings } = useTenantSettings();\r\n  const inventoryEnabled = supportsFeature(settings ?? undefined, 'inventory');\r\n  const businessTypeConfig = settings ? getBusinessTypeConfig(getBusinessType(settings)) : null;\r\n\r\n  useEffect(() => {\r\n    getDictionaryClient(lang).then(setDict);\r\n    fetchMovements();\r\n  }, [lang, tenant, page, filters]);\r\n\r\n  const fetchMovements = async () => {\r\n    try {\r\n      let url = `/api/stock-movements?page=${page}&limit=50`;\r\n      if (filters.type) url += `&type=${filters.type}`;\r\n      if (filters.productId) url += `&productId=${filters.productId}`;\r\n      \r\n      const res = await fetch(url, { credentials: 'include' });\r\n      const data = await res.json();\r\n      if (data.success) {\r\n        setMovements(data.data);\r\n        setTotalPages(data.pagination?.pages || 1);\r\n        setMessage(null);\r\n      } else {\r\n        setMessage({ type: 'error', text: data.error || dict?.common?.failedToFetchStockMovements || 'Failed to fetch stock movements' });\r\n      }\r\n    } catch (error) {\r\n      console.error('Error fetching stock movements:', error);\r\n      setMessage({ type: 'error', text: dict?.common?.failedToFetchStockMovements || 'Failed to fetch stock movements' });\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const getTypeColor = (type: string) => {\r\n    const colors: Record<string, string> = {\r\n      sale: 'bg-red-100 text-red-800',\r\n      purchase: 'bg-green-100 text-green-800',\r\n      adjustment: 'bg-blue-100 text-blue-800',\r\n      return: 'bg-yellow-100 text-yellow-800',\r\n      damage: 'bg-orange-100 text-orange-800',\r\n      transfer: 'bg-purple-100 text-purple-800',\r\n    };\r\n    return colors[type] || 'bg-gray-100 text-gray-800';\r\n  };\r\n\r\n  if (!dict || loading) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gray-50 flex items-center justify-center\">\r\n        <div className=\"text-center\">\r\n          <div className=\"inline-block animate-spin h-8 w-8 border-b-2 border-blue-600\"></div>\r\n          <p className=\"mt-4 text-gray-600\">{dict?.common?.loading || 'Loading...'}</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50\">\r\n      <Navbar />\r\n      <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 sm:py-8\">\r\n        <div className=\"mb-6 sm:mb-8\">\r\n          <Link\r\n            href={`/${tenant}/${lang}/admin`}\r\n            className=\"inline-flex items-center text-blue-600 hover:text-blue-700 font-medium mb-4 transition-colors\"\r\n          >\r\n            <svg className=\"w-5 h-5 mr-2\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M10 19l-7-7m0 0l7-7m-7 7h18\" />\r\n            </svg>\r\n            {dict?.admin?.backToAdmin || 'Back to Admin'}\r\n          </Link>\r\n          <div className=\"flex items-center justify-between\">\r\n            <div>\r\n              <h1 className=\"text-2xl sm:text-3xl lg:text-4xl font-bold text-gray-900 mb-2\">\r\n                {dict.admin?.stockMovements || 'Stock Movements'}\r\n              </h1>\r\n              <p className=\"text-gray-600\">{dict.admin?.stockMovementsSubtitle || 'Track all inventory changes and movements'}</p>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {message && (\r\n          <div className={`mb-6 p-4 border ${message.type === 'success' ? 'bg-green-50 text-green-800 border-green-300' : 'bg-red-50 text-red-800 border-red-300'}`}>\r\n            {message.text}\r\n          </div>\r\n        )}\r\n\r\n        {!inventoryEnabled && (\r\n          <div className=\"mb-6 p-4 bg-yellow-50 border-2 border-yellow-300 text-yellow-800\">\r\n            <div className=\"flex items-start gap-3\">\r\n              <svg className=\"w-6 h-6 flex-shrink-0 mt-0.5\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z\" />\r\n              </svg>\r\n              <div>\r\n                <h3 className=\"text-lg font-semibold text-yellow-900 mb-2\">\r\n                  Stock Movements Not Available\r\n                </h3>\r\n                <p className=\"text-yellow-800\">\r\n                  Stock movements tracking is not available for {businessTypeConfig?.name || 'your business type'}. \r\n                  This feature requires inventory management to be enabled.\r\n                </p>\r\n                <p className=\"text-sm text-yellow-700 mt-2\">\r\n                  If you need stock tracking, please enable inventory management in Settings.\r\n                </p>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {inventoryEnabled && (\r\n          <div className=\"bg-white border border-gray-300 p-6\">\r\n          <div className=\"mb-4 flex gap-4\">\r\n            <select\r\n              value={filters.type}\r\n              onChange={(e) => setFilters({ ...filters, type: e.target.value })}\r\n              className=\"px-4 py-2 border border-gray-300 focus:ring-2 focus:ring-blue-500 bg-white\"\r\n            >\r\n              <option value=\"\">{dict.admin?.allTypes || 'All Types'}</option>\r\n              <option value=\"sale\">{dict.admin?.sale || 'Sale'}</option>\r\n              <option value=\"purchase\">{dict.admin?.purchase || 'Purchase'}</option>\r\n              <option value=\"adjustment\">{dict.admin?.adjustment || 'Adjustment'}</option>\r\n              <option value=\"return\">{dict.admin?.returnType || 'Return'}</option>\r\n              <option value=\"damage\">{dict.admin?.damageType || 'Damage'}</option>\r\n              <option value=\"transfer\">{dict.admin?.transferType || 'Transfer'}</option>\r\n            </select>\r\n          </div>\r\n          <div className=\"overflow-x-auto\">\r\n            <table className=\"min-w-full divide-y divide-gray-200\">\r\n              <thead className=\"bg-gray-50\">\r\n                <tr>\r\n                  <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">{dict.admin?.date || 'Date'}</th>\r\n                  <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">{dict.admin?.product || 'Product'}</th>\r\n                  <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">{dict.admin?.type || 'Type'}</th>\r\n                  <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">{dict.admin?.quantity || 'Quantity'}</th>\r\n                  <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">{dict.admin?.stockChange || 'Stock Change'}</th>\r\n                  <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">{dict.admin?.user || 'User'}</th>\r\n                  <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">{dict.admin?.transaction || 'Transaction'}</th>\r\n                  <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">{dict.admin?.notes || 'Notes'}</th>\r\n                </tr>\r\n              </thead>\r\n              <tbody className=\"bg-white divide-y divide-gray-200\">\r\n                {movements.map((movement) => {\r\n                  const productName = typeof movement.productId === 'object' && movement.productId !== null ? movement.productId.name : 'Unknown';\r\n                  const productSku = typeof movement.productId === 'object' && movement.productId !== null ? movement.productId.sku : '';\r\n                  const userName = typeof movement.userId === 'object' && movement.userId !== null ? movement.userId.name : 'System';\r\n                  const receiptNumber = typeof movement.transactionId === 'object' && movement.transactionId !== null && movement.transactionId?.receiptNumber \r\n                    ? movement.transactionId.receiptNumber \r\n                    : typeof movement.transactionId === 'string' \r\n                    ? movement.transactionId \r\n                    : '-';\r\n                  \r\n                  return (\r\n                    <tr key={movement._id}>\r\n                      <td className=\"px-4 py-4 whitespace-nowrap text-sm text-gray-500\">\r\n                        {new Date(movement.createdAt).toLocaleString()}\r\n                      </td>\r\n                      <td className=\"px-4 py-4\">\r\n                        <div className=\"text-sm font-medium text-gray-900\">{productName}</div>\r\n                        {productSku && (\r\n                          <div className=\"text-xs text-gray-500\">SKU: {productSku}</div>\r\n                        )}\r\n                        {movement.variation && (\r\n                          <div className=\"text-xs text-gray-500\">\r\n                            {Object.entries(movement.variation).filter(([_, v]) => v).map(([k, v]) => `${k}: ${v}`).join(', ')}\r\n                          </div>\r\n                        )}\r\n                      </td>\r\n                      <td className=\"px-4 py-4 whitespace-nowrap\">\r\n                        <span className={`px-2 py-1 text-xs font-semibold border ${getTypeColor(movement.type)}`}>\r\n                          {({\r\n                            sale: dict.admin?.sale || 'Sale',\r\n                            purchase: dict.admin?.purchase || 'Purchase',\r\n                            adjustment: dict.admin?.adjustment || 'Adjustment',\r\n                            return: dict.admin?.returnType || 'Return',\r\n                            damage: dict.admin?.damageType || 'Damage',\r\n                            transfer: dict.admin?.transferType || 'Transfer',\r\n                          } as Record<string, string>)[movement.type] || movement.type}\r\n                        </span>\r\n                      </td>\r\n                      <td className=\"px-4 py-4 whitespace-nowrap text-sm font-medium\">\r\n                        <span className={movement.quantity > 0 ? 'text-green-600' : 'text-red-600'}>\r\n                          {movement.quantity > 0 ? '+' : ''}{movement.quantity}\r\n                        </span>\r\n                      </td>\r\n                      <td className=\"px-4 py-4 whitespace-nowrap text-sm text-gray-500\">\r\n                        {movement.previousStock}  {movement.newStock}\r\n                      </td>\r\n                      <td className=\"px-4 py-4 whitespace-nowrap text-sm text-gray-500\">\r\n                        {userName}\r\n                      </td>\r\n                      <td className=\"px-4 py-4 whitespace-nowrap text-sm text-gray-500 font-mono\">\r\n                        {receiptNumber}\r\n                      </td>\r\n                      <td className=\"px-4 py-4 text-sm text-gray-500\">\r\n                        {movement.notes || movement.reason || '-'}\r\n                      </td>\r\n                    </tr>\r\n                  );\r\n                })}\r\n              </tbody>\r\n            </table>\r\n            {movements.length === 0 && (\r\n              <div className=\"text-center py-8 text-gray-500\">{dict.common?.noResults || 'No stock movements found'}</div>\r\n            )}\r\n          </div>\r\n          {totalPages > 1 && (\r\n            <div className=\"mt-4 flex justify-center gap-2\">\r\n              <button\r\n                onClick={() => setPage(p => Math.max(1, p - 1))}\r\n                disabled={page === 1}\r\n                className=\"px-4 py-2 border border-gray-300 disabled:opacity-50 bg-white\"\r\n              >\r\n                {dict.common?.previous || 'Previous'}\r\n              </button>\r\n              <span className=\"px-4 py-2 text-sm text-gray-700\">\r\n                {dict.admin?.page || 'Page'} {page} / {totalPages}\r\n              </span>\r\n              <button\r\n                onClick={() => setPage(p => Math.min(totalPages, p + 1))}\r\n                disabled={page === totalPages}\r\n                className=\"px-4 py-2 border border-gray-300 disabled:opacity-50 bg-white\"\r\n              >\r\n                {dict.common?.next || 'Next'}\r\n              </button>\r\n            </div>\r\n          )}\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\[tenant]\\[lang]\\admin\\subscriptions\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'showToast' is defined but never used. Allowed unused vars must match /^_/u.","line":8,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CheckCircle' is defined but never used. Allowed unused vars must match /^_/u.","line":9,"column":57,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":68},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'XCircle' is defined but never used. Allowed unused vars must match /^_/u.","line":9,"column":70,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":77},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":83,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":83,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2296,2299],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2296,2299],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'subscriptionStatus' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":88,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":88,"endColumn":29},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'refreshSubscription' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":88,"column":31,"nodeType":null,"messageId":"unusedVar","endLine":88,"endColumn":50}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport Navbar from '@/components/Navbar';\r\nimport { useParams, useRouter } from 'next/navigation';\r\nimport { getDictionaryClient } from '../../dictionaries-client';\r\nimport { useSubscription } from '@/contexts/SubscriptionContext';\r\nimport { showToast } from '@/lib/toast';\r\nimport { Loader2, Users, Building, Package, CreditCard, CheckCircle, XCircle, Clock, AlertTriangle, ArrowUp, Receipt } from 'lucide-react';\r\n\r\ninterface SubscriptionPlan {\r\n  _id: string;\r\n  name: string;\r\n  tier: string;\r\n  description?: string;\r\n  price: {\r\n    monthly: number;\r\n    currency: string;\r\n  };\r\n  features: {\r\n    maxUsers: number;\r\n    maxBranches: number;\r\n    maxProducts: number;\r\n    maxTransactions: number;\r\n    enableInventory: boolean;\r\n    enableCategories: boolean;\r\n    enableDiscounts: boolean;\r\n    enableLoyaltyProgram: boolean;\r\n    enableCustomerManagement: boolean;\r\n    enableBookingScheduling: boolean;\r\n    enableReports: boolean;\r\n    enableMultiBranch: boolean;\r\n    enableHardwareIntegration: boolean;\r\n    prioritySupport: boolean;\r\n    customIntegrations: boolean;\r\n    dedicatedAccountManager: boolean;\r\n  };\r\n  isActive: boolean;\r\n  isCustom: boolean;\r\n}\r\n\r\ninterface Subscription {\r\n  _id: string;\r\n  tenantId: {\r\n    _id: string;\r\n    slug: string;\r\n    name: string;\r\n  };\r\n  planId: SubscriptionPlan;\r\n  status: 'active' | 'inactive' | 'cancelled' | 'suspended' | 'trial';\r\n  billingCycle: 'monthly' | 'yearly';\r\n  startDate: string;\r\n  endDate?: string;\r\n  trialEndDate?: string;\r\n  nextBillingDate?: string;\r\n  isTrial: boolean;\r\n  autoRenew: boolean;\r\n  usage: {\r\n    currentUsers: number;\r\n    currentBranches: number;\r\n    currentProducts: number;\r\n    currentTransactions: number;\r\n  };\r\n}\r\n\r\ninterface BillingTransaction {\r\n  _id: string;\r\n  amount: number;\r\n  currency: string;\r\n  status: 'paid' | 'pending' | 'failed' | 'refunded';\r\n  billingCycle: 'monthly' | 'yearly';\r\n  periodStart: string;\r\n  periodEnd: string;\r\n  createdAt: string;\r\n  description?: string;\r\n}\r\n\r\nexport default function SubscriptionsPage() {\r\n  const params = useParams();\r\n  const router = useRouter();\r\n  const tenant = params.tenant as string;\r\n  const lang = params.lang as 'en' | 'es';\r\n  const [dict, setDict] = useState<any>(null);\r\n  const [subscription, setSubscription] = useState<Subscription | null>(null);\r\n  const [billingHistory, setBillingHistory] = useState<BillingTransaction[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [billingLoading, setBillingLoading] = useState(false);\r\n  const { subscriptionStatus, refreshSubscription } = useSubscription();\r\n\r\n  const fetchSubscription = async () => {\r\n    try {\r\n      setLoading(true);\r\n      const res = await fetch('/api/subscriptions/current', { credentials: 'include' });\r\n      const data = await res.json();\r\n      if (data.success) {\r\n        setSubscription(data.data);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error fetching subscription:', error);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const fetchBillingHistory = async () => {\r\n    try {\r\n      setBillingLoading(true);\r\n      const res = await fetch('/api/subscriptions/billing-history', { credentials: 'include' });\r\n      const data = await res.json();\r\n      if (data.success) {\r\n        setBillingHistory(data.data || []);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error fetching billing history:', error);\r\n    } finally {\r\n      setBillingLoading(false);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    getDictionaryClient(lang).then(setDict);\r\n    fetchSubscription();\r\n    fetchBillingHistory();\r\n  }, [lang, tenant]);\r\n\r\n  if (!dict) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gray-50 flex items-center justify-center\">\r\n        <div className=\"text-center\">\r\n          <Loader2 className=\"h-8 w-8 animate-spin mx-auto\" />\r\n          <p className=\"mt-4 text-gray-600\">{dict?.common?.loading || 'Loading...'}</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div>\r\n      <Navbar />\r\n      <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 sm:py-8\">\r\n        <div className=\"mb-6 sm:mb-8\">\r\n          <h1 className=\"text-2xl sm:text-3xl lg:text-4xl font-bold text-gray-900 mb-2\">\r\n            {dict.admin?.subscriptions || 'My Subscription'}\r\n          </h1>\r\n          <p className=\"text-gray-600\">{dict.admin?.subscriptionDescription || 'View your current subscription and billing history'}</p>\r\n        </div>\r\n\r\n        {loading ? (\r\n          <div className=\"flex items-center justify-center py-12\">\r\n            <Loader2 className=\"h-8 w-8 animate-spin\" />\r\n          </div>\r\n        ) : (\r\n          <div className=\"space-y-8\">\r\n            {/* Current Subscription */}\r\n            <div className=\"bg-white border border-gray-300 rounded-lg overflow-hidden\">\r\n              <div className=\"px-6 py-4 border-b border-gray-200\">\r\n                <h2 className=\"text-lg font-semibold text-gray-900\">{dict?.admin?.currentSubscription || 'Current Subscription'}</h2>\r\n              </div>\r\n              <div className=\"p-6\">\r\n                {subscription ? (\r\n                  <div className=\"space-y-6\">\r\n                    {/* Subscription Overview */}\r\n                    <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\r\n                      <div className=\"bg-gray-50 p-4 rounded-lg\">\r\n                        <div className=\"flex items-center\">\r\n                          <CreditCard className=\"h-8 w-8 text-blue-600\" />\r\n                          <div className=\"ml-3\">\r\n                            <p className=\"text-sm font-medium text-gray-600\">{dict?.admin?.plan || 'Plan'}</p>\r\n                            <p className=\"text-lg font-semibold text-gray-900\">{subscription.planId?.name}</p>\r\n                          </div>\r\n                        </div>\r\n                      </div>\r\n                      <div className=\"bg-gray-50 p-4 rounded-lg\">\r\n                        <div className=\"flex items-center\">\r\n                          <Clock className=\"h-8 w-8 text-green-600\" />\r\n                          <div className=\"ml-3\">\r\n                            <p className=\"text-sm font-medium text-gray-600\">{dict?.admin?.status || 'Status'}</p>\r\n                            <span className={`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${\r\n                              subscription.status === 'active'\r\n                                ? 'bg-green-100 text-green-800'\r\n                                : subscription.status === 'trial'\r\n                                ? 'bg-blue-100 text-blue-800'\r\n                                : 'bg-red-100 text-red-800'\r\n                            }`}>\r\n                              {\r\n                                {\r\n                                  active: dict?.admin?.active || 'Active',\r\n                                  inactive: dict?.admin?.inactive || 'Inactive',\r\n                                  trial: dict?.admin?.trial || 'Trial',\r\n                                  suspended: dict?.admin?.suspended || 'Suspended',\r\n                                  cancelled: subscription.status.charAt(0).toUpperCase() + subscription.status.slice(1),\r\n                                }[subscription.status] || (subscription.status.charAt(0).toUpperCase() + subscription.status.slice(1))\r\n                              }\r\n                            </span>\r\n                          </div>\r\n                        </div>\r\n                      </div>\r\n                      <div className=\"bg-gray-50 p-4 rounded-lg\">\r\n                        <div className=\"flex items-center\">\r\n                          <Receipt className=\"h-8 w-8 text-purple-600\" />\r\n                          <div className=\"ml-3\">\r\n                            <p className=\"text-sm font-medium text-gray-600\">{dict?.admin?.billingCycle || 'Billing Cycle'}</p>\r\n                            <p className=\"text-lg font-semibold text-gray-900 capitalize\">{subscription.billingCycle}</p>\r\n                          </div>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n\r\n                    {/* Usage Limits */}\r\n                    <div className=\"border-t border-gray-200 pt-6\">\r\n                      <h3 className=\"text-md font-semibold text-gray-900 mb-4\">{dict?.admin?.usageLimits || 'Usage Limits'}</h3>\r\n                      <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\r\n                        <div className=\"text-center\">\r\n                          <Users className=\"h-6 w-6 mx-auto mb-2 text-blue-600\" />\r\n                          <p className=\"text-sm text-gray-600\">{dict?.admin?.users || 'Users'}</p>\r\n                          <p className=\"text-lg font-semibold\">\r\n                            {subscription.usage.currentUsers} / {subscription.planId?.features.maxUsers === -1 ? '' : subscription.planId?.features.maxUsers}\r\n                          </p>\r\n                        </div>\r\n                        <div className=\"text-center\">\r\n                          <Building className=\"h-6 w-6 mx-auto mb-2 text-green-600\" />\r\n                          <p className=\"text-sm text-gray-600\">{dict?.admin?.branches || 'Branches'}</p>\r\n                          <p className=\"text-lg font-semibold\">\r\n                            {subscription.usage.currentBranches} / {subscription.planId?.features.maxBranches === -1 ? '' : subscription.planId?.features.maxBranches}\r\n                          </p>\r\n                        </div>\r\n                        <div className=\"text-center\">\r\n                          <Package className=\"h-6 w-6 mx-auto mb-2 text-purple-600\" />\r\n                          <p className=\"text-sm text-gray-600\">{dict?.admin?.products || 'Products'}</p>\r\n                          <p className=\"text-lg font-semibold\">\r\n                            {subscription.usage.currentProducts} / {subscription.planId?.features.maxProducts === -1 ? '' : subscription.planId?.features.maxProducts}\r\n                          </p>\r\n                        </div>\r\n                        <div className=\"text-center\">\r\n                          <Receipt className=\"h-6 w-6 mx-auto mb-2 text-orange-600\" />\r\n                          <p className=\"text-sm text-gray-600\">{dict?.admin?.transactions || 'Transactions'}</p>\r\n                          <p className=\"text-lg font-semibold\">\r\n                            {subscription.usage.currentTransactions} / {subscription.planId?.features.maxTransactions === -1 ? '' : subscription.planId?.features.maxTransactions}\r\n                          </p>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n\r\n                    {/* Subscription Actions */}\r\n                    <div className=\"border-t border-gray-200 pt-6\">\r\n                      <div className=\"flex justify-between items-center\">\r\n                        <div>\r\n                          <p className=\"text-sm text-gray-600\">Need to upgrade or modify your plan?</p>\r\n                        </div>\r\n                        <button\r\n                          onClick={() => router.push(`/${tenant}/${lang}/subscription`)}\r\n                          className=\"bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 flex items-center text-sm font-medium\"\r\n                        >\r\n                          <ArrowUp className=\"h-4 w-4 mr-2\" />\r\n                          Upgrade Plan\r\n                        </button>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                ) : (\r\n                  <div className=\"text-center py-12\">\r\n                    <AlertTriangle className=\"h-12 w-12 mx-auto mb-4 text-gray-400\" />\r\n                    <h3 className=\"text-lg font-medium text-gray-900 mb-2\">No Active Subscription</h3>\r\n                    <p className=\"text-gray-600 mb-4\">You don&apos;t have an active subscription. Contact support to get started.</p>\r\n                    <button\r\n                      onClick={() => router.push(`/${tenant}/${lang}/subscription`)}\r\n                      className=\"bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700\"\r\n                    >\r\n                      View Plans\r\n                    </button>\r\n                  </div>\r\n                )}\r\n              </div>\r\n            </div>\r\n\r\n            {/* Billing History */}\r\n            <div className=\"bg-white border border-gray-300 rounded-lg overflow-hidden\">\r\n              <div className=\"px-6 py-4 border-b border-gray-200 flex justify-between items-center\">\r\n                <h2 className=\"text-lg font-semibold text-gray-900\">Billing History</h2>\r\n                <button\r\n                  onClick={fetchBillingHistory}\r\n                  disabled={billingLoading}\r\n                  className=\"text-sm text-blue-600 hover:text-blue-500 disabled:opacity-50\"\r\n                >\r\n                  {billingLoading ? 'Loading...' : 'Refresh'}\r\n                </button>\r\n              </div>\r\n              <div className=\"p-6\">\r\n                {billingHistory.length > 0 ? (\r\n                  <div className=\"space-y-4\">\r\n                    {billingHistory.map((transaction) => (\r\n                      <div key={transaction._id} className=\"flex items-center justify-between p-4 border border-gray-200 rounded-lg\">\r\n                        <div className=\"flex items-center space-x-4\">\r\n                          <div className={`p-2 rounded-full ${\r\n                            transaction.status === 'paid' ? 'bg-green-100' :\r\n                            transaction.status === 'pending' ? 'bg-yellow-100' :\r\n                            transaction.status === 'failed' ? 'bg-red-100' : 'bg-gray-100'\r\n                          }`}>\r\n                            <Receipt className={`h-5 w-5 ${\r\n                              transaction.status === 'paid' ? 'text-green-600' :\r\n                              transaction.status === 'pending' ? 'text-yellow-600' :\r\n                              transaction.status === 'failed' ? 'text-red-600' : 'text-gray-600'\r\n                            }`} />\r\n                          </div>\r\n                          <div>\r\n                            <p className=\"font-medium text-gray-900\">\r\n                              {transaction.amount} - {transaction.billingCycle} billing\r\n                            </p>\r\n                            <p className=\"text-sm text-gray-600\">\r\n                              {new Date(transaction.periodStart).toLocaleDateString()} - {new Date(transaction.periodEnd).toLocaleDateString()}\r\n                            </p>\r\n                            <p className=\"text-xs text-gray-500\">\r\n                              {new Date(transaction.createdAt).toLocaleDateString()} {new Date(transaction.createdAt).toLocaleTimeString()}\r\n                            </p>\r\n                          </div>\r\n                        </div>\r\n                        <div className=\"text-right\">\r\n                          <span className={`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${\r\n                            transaction.status === 'paid' ? 'bg-green-100 text-green-800' :\r\n                            transaction.status === 'pending' ? 'bg-yellow-100 text-yellow-800' :\r\n                            transaction.status === 'failed' ? 'bg-red-100 text-red-800' :\r\n                            'bg-gray-100 text-gray-800'\r\n                          }`}>\r\n                            {transaction.status.charAt(0).toUpperCase() + transaction.status.slice(1)}\r\n                          </span>\r\n                        </div>\r\n                      </div>\r\n                    ))}\r\n                  </div>\r\n                ) : (\r\n                  <div className=\"text-center py-8\">\r\n                    <Receipt className=\"h-12 w-12 mx-auto mb-4 text-gray-400\" />\r\n                    <p className=\"text-gray-600\">No billing history available</p>\r\n                  </div>\r\n                )}\r\n              </div>\r\n            </div>\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\[tenant]\\[lang]\\admin\\tax-rules\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":15,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":15,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[573,576],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[573,576],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchSettings'. Either include it or remove the dependency array.","line":22,"column":6,"nodeType":"ArrayExpression","endLine":22,"endColumn":20,"suggestions":[{"desc":"Update the dependencies array to be: [fetchSettings, lang, tenant]","fix":{"range":[806,820],"text":"[fetchSettings, lang, tenant]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useEffect, useState } from 'react';\r\nimport Navbar from '@/components/Navbar';\r\nimport TaxRulesManager from '@/components/settings/TaxRulesManager';\r\nimport { useParams } from 'next/navigation';\r\nimport Link from 'next/link';\r\nimport { getDictionaryClient } from '../../dictionaries-client';\r\nimport { ITenantSettings } from '@/models/Tenant';\r\n\r\nexport default function TaxRulesAdminPage() {\r\n  const params = useParams();\r\n  const tenant = params.tenant as string;\r\n  const lang = params.lang as 'en' | 'es';\r\n  const [dict, setDict] = useState<any>(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [settings, setSettings] = useState<ITenantSettings | null>(null);\r\n\r\n  useEffect(() => {\r\n    getDictionaryClient(lang).then(setDict);\r\n    fetchSettings();\r\n  }, [lang, tenant]);\r\n\r\n  const fetchSettings = async () => {\r\n    try {\r\n      setLoading(true);\r\n      const res = await fetch(`/api/tenants/${tenant}/settings`);\r\n      const data = await res.json();\r\n      if (data.success) {\r\n        setSettings(data.data);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error fetching settings:', error);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  if (!dict || loading || !settings) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gray-50 flex items-center justify-center\">\r\n        <div className=\"text-center\">\r\n          <div className=\"inline-block animate-spin h-8 w-8 border-b-2 border-blue-600\"></div>\r\n          <p className=\"mt-4 text-gray-600\">{dict?.common?.loading || 'Loading...'}</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50\">\r\n      <Navbar />\r\n      <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 sm:py-8\">\r\n        <div className=\"mb-6 sm:mb-8\">\r\n          <Link\r\n            href={`/${tenant}/${lang}/admin`}\r\n            className=\"inline-flex items-center text-blue-600 hover:text-blue-700 font-medium mb-4 transition-colors\"\r\n          >\r\n            <svg className=\"w-5 h-5 mr-2\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M10 19l-7-7m0 0l7-7m-7 7h18\" />\r\n            </svg>\r\n            {dict?.admin?.backToAdmin || 'Back to Admin'}\r\n          </Link>\r\n          <h1 className=\"text-2xl sm:text-3xl lg:text-4xl font-bold text-gray-900 mb-2\">\r\n            {dict?.admin?.taxRules || 'Tax Rules'}\r\n          </h1>\r\n          <p className=\"text-gray-600\">\r\n            {dict?.admin?.taxRulesSubtitle || 'Configure multiple tax rates based on region, product type, or category. Set priorities to control which rules apply.'}\r\n          </p>\r\n        </div>\r\n\r\n        <div className=\"bg-white border border-gray-300 p-5 sm:p-6 lg:p-8\">\r\n          <TaxRulesManager\r\n            settings={settings}\r\n            tenant={tenant}\r\n            onUpdate={(updates) => {\r\n              setSettings({ ...settings, ...updates });\r\n            }}\r\n          />\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\[tenant]\\[lang]\\admin\\tenants\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'router' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":29,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":29,"endColumn":15},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":32,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":32,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[818,821],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[818,821],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setMessage' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":35,"column":19,"nodeType":null,"messageId":"unusedVar","endLine":35,"endColumn":29},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchTenants'. Either include it or remove the dependency array.","line":42,"column":6,"nodeType":"ArrayExpression","endLine":42,"endColumn":20,"suggestions":[{"desc":"Update the dependencies array to be: [fetchTenants, lang, tenant]","fix":{"range":[1275,1289],"text":"[fetchTenants, lang, tenant]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":199,"column":9,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":199,"endColumn":12,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8297,8300],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8297,8300],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":215,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":215,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8946,8949],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8946,8949],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":250,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":250,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10033,10036],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10033,10036],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useEffect, useState } from 'react';\r\nimport Navbar from '@/components/Navbar';\r\nimport { useParams, useRouter } from 'next/navigation';\r\nimport Link from 'next/link';\r\nimport { getDictionaryClient } from '../../dictionaries-client';\r\n\r\ninterface Tenant {\r\n  _id: string;\r\n  slug: string;\r\n  name: string;\r\n  domain?: string;\r\n  subdomain?: string;\r\n  isActive: boolean;\r\n  createdAt: string;\r\n  settings: {\r\n    currency: string;\r\n    language: 'en' | 'es';\r\n    email?: string;\r\n    phone?: string;\r\n    companyName?: string;\r\n    businessType?: string;\r\n  };\r\n}\r\n\r\nexport default function TenantsPage() {\r\n  const params = useParams();\r\n  const router = useRouter();\r\n  const tenant = params.tenant as string;\r\n  const lang = params.lang as 'en' | 'es';\r\n  const [dict, setDict] = useState<any>(null);\r\n  const [tenants, setTenants] = useState<Tenant[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [message, setMessage] = useState<{ type: 'success' | 'error'; text: string } | null>(null);\r\n  const [showTenantModal, setShowTenantModal] = useState(false);\r\n  const [editingTenant, setEditingTenant] = useState<Tenant | null>(null);\r\n\r\n  useEffect(() => {\r\n    getDictionaryClient(lang).then(setDict);\r\n    fetchTenants();\r\n  }, [lang, tenant]);\r\n\r\n  const fetchTenants = async () => {\r\n    try {\r\n      // Fetch current tenant only (tenant-level admin)\r\n      const res = await fetch(`/api/tenants/${tenant}`, { credentials: 'include' });\r\n      const data = await res.json();\r\n      if (data.success) {\r\n        // Set as single-item array for consistency with existing UI\r\n        setTenants([data.data]);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error fetching tenant:', error);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n\r\n  if (!dict || loading) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gray-50 flex items-center justify-center\">\r\n        <div className=\"text-center\">\r\n          <div className=\"inline-block animate-spin h-8 w-8 border-b-2 border-blue-600\"></div>\r\n          <p className=\"mt-4 text-gray-600\">{dict?.common?.loading || 'Loading...'}</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50\">\r\n      <Navbar />\r\n      <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 sm:py-8\">\r\n        <div className=\"mb-6 sm:mb-8\">\r\n          <Link\r\n            href={`/${tenant}/${lang}/admin`}\r\n            className=\"inline-flex items-center text-blue-600 hover:text-blue-700 font-medium mb-4 transition-colors\"\r\n          >\r\n            <svg className=\"w-5 h-5 mr-2\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M10 19l-7-7m0 0l7-7m-7 7h18\" />\r\n            </svg>\r\n            {dict?.admin?.backToAdmin || 'Back to Admin'}\r\n          </Link>\r\n          <div className=\"flex items-center justify-between\">\r\n            <div>\r\n              <h1 className=\"text-2xl sm:text-3xl lg:text-4xl font-bold text-gray-900 mb-2\">\r\n                {dict.admin?.tenants || 'Tenants'}\r\n              </h1>\r\n              <p className=\"text-gray-600\">{dict.admin?.tenantsSubtitle || 'View and manage your organization settings'}</p>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {message && (\r\n          <div className={`mb-6 p-4 border ${message.type === 'success' ? 'bg-green-50 text-green-800 border-green-300' : 'bg-red-50 text-red-800 border-red-300'}`}>\r\n            {message.text}\r\n          </div>\r\n        )}\r\n\r\n        <div className=\"bg-white border border-gray-300 p-6\">\r\n          <div className=\"flex justify-between items-center mb-6\">\r\n            <h2 className=\"text-xl font-bold text-gray-900\">{dict.admin?.tenantInfo || 'Tenant Information'}</h2>\r\n            {tenants.length > 0 && (\r\n              <button\r\n                onClick={() => {\r\n                  setEditingTenant(tenants[0]);\r\n                  setShowTenantModal(true);\r\n                }}\r\n                className=\"px-4 py-2 bg-blue-600 text-white hover:bg-blue-700 font-medium border border-blue-700\"\r\n              >\r\n                {dict.common?.edit || 'Edit'} {dict.admin?.settings || 'Settings'}\r\n              </button>\r\n            )}\r\n          </div>\r\n          <div className=\"overflow-x-auto\">\r\n            <table className=\"min-w-full divide-y divide-gray-200\">\r\n              <thead className=\"bg-gray-50\">\r\n                <tr>\r\n                  <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">{dict.admin?.name || 'Name'}</th>\r\n                  <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">{dict.admin?.slug || 'Slug'}</th>\r\n                  <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">{dict.admin?.businessType || 'Business Type'}</th>\r\n                  <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">{dict.admin?.currency || 'Currency'}</th>\r\n                  <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">{dict.admin?.status || 'Status'}</th>\r\n                  <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">{dict.common?.actions || 'Actions'}</th>\r\n                </tr>\r\n              </thead>\r\n              <tbody className=\"bg-white divide-y divide-gray-200\">\r\n                {tenants.map((tenantItem) => (\r\n                  <tr key={tenantItem._id}>\r\n                    <td className=\"px-4 py-4 whitespace-nowrap text-sm font-medium text-gray-900\">{tenantItem.name}</td>\r\n                    <td className=\"px-4 py-4 whitespace-nowrap text-sm text-gray-500\">{tenantItem.slug}</td>\r\n                    <td className=\"px-4 py-4 whitespace-nowrap text-sm text-gray-500\">\r\n                      {tenantItem.settings.businessType ? (\r\n                        <span className=\"px-2 py-1 text-xs font-medium bg-blue-100 text-blue-800 border border-blue-300\">\r\n                          {tenantItem.settings.businessType}\r\n                        </span>\r\n                      ) : (\r\n                        <span className=\"text-gray-400 italic\">Not set</span>\r\n                      )}\r\n                    </td>\r\n                    <td className=\"px-4 py-4 whitespace-nowrap text-sm text-gray-500\">{tenantItem.settings.currency}</td>\r\n                    <td className=\"px-4 py-4 whitespace-nowrap\">\r\n                      <span className={`px-2 py-1 text-xs font-semibold border ${tenantItem.isActive ? 'bg-green-100 text-green-800 border-green-300' : 'bg-red-100 text-red-800 border-red-300'}`}>\r\n                        {tenantItem.isActive ? (dict.admin?.active || 'Active') : (dict.admin?.inactive || 'Inactive')}\r\n                      </span>\r\n                    </td>\r\n                    <td className=\"px-4 py-4 whitespace-nowrap text-sm font-medium\">\r\n                      <button\r\n                        onClick={() => {\r\n                          setEditingTenant(tenantItem);\r\n                          setShowTenantModal(true);\r\n                        }}\r\n                        className=\"text-blue-600 hover:text-blue-900\"\r\n                      >\r\n                        {dict.common?.edit || 'Edit'}\r\n                      </button>\r\n                    </td>\r\n                  </tr>\r\n                ))}\r\n              </tbody>\r\n            </table>\r\n            {tenants.length === 0 && (\r\n              <div className=\"text-center py-8 text-gray-500\">{dict.common?.noData || 'No tenant information available'}</div>\r\n            )}\r\n          </div>\r\n        </div>\r\n\r\n        {showTenantModal && (\r\n          <TenantModal\r\n            tenant={editingTenant}\r\n            onClose={() => {\r\n              setShowTenantModal(false);\r\n              setEditingTenant(null);\r\n            }}\r\n            onSave={() => {\r\n              fetchTenants();\r\n              setShowTenantModal(false);\r\n              setEditingTenant(null);\r\n            }}\r\n            dict={dict}\r\n          />\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction TenantModal({\r\n  tenant,\r\n  onClose,\r\n  onSave,\r\n  dict,\r\n}: {\r\n  tenant: Tenant | null;\r\n  onClose: () => void;\r\n  onSave: () => void;\r\n  dict: any;\r\n}) {\r\n  const [formData, setFormData] = useState({\r\n    slug: tenant?.slug || '',\r\n    name: tenant?.name || '',\r\n    domain: tenant?.domain || '',\r\n    subdomain: tenant?.subdomain || '',\r\n    currency: tenant?.settings.currency || 'USD',\r\n    language: tenant?.settings.language || 'en',\r\n    email: tenant?.settings.email || '',\r\n    phone: tenant?.settings.phone || '',\r\n    companyName: tenant?.settings.companyName || '',\r\n    businessType: tenant?.settings.businessType || 'general',\r\n  });\r\n  const [saving, setSaving] = useState(false);\r\n  const [error, setError] = useState('');\r\n  const [businessTypes, setBusinessTypes] = useState<any[]>([]);\r\n  const [loadingBusinessTypes, setLoadingBusinessTypes] = useState(true);\r\n  const [businessTypeWarning, setBusinessTypeWarning] = useState<string | null>(null);\r\n\r\n  useEffect(() => {\r\n    loadBusinessTypes();\r\n  }, []);\r\n\r\n  const loadBusinessTypes = async () => {\r\n    try {\r\n      setLoadingBusinessTypes(true);\r\n      const res = await fetch('/api/business-types');\r\n      const data = await res.json();\r\n      if (data.success) {\r\n        setBusinessTypes(data.data);\r\n      }\r\n    } catch (err) {\r\n      console.error('Failed to load business types:', err);\r\n    } finally {\r\n      setLoadingBusinessTypes(false);\r\n    }\r\n  };\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    setError('');\r\n    setSaving(true);\r\n    try {\r\n      // Tenant-level: only allow editing current tenant\r\n      if (!tenant) {\r\n        setError(dict?.admin?.cannotEditTenant || 'Cannot edit: tenant information not available');\r\n        return;\r\n      }\r\n      const url = `/api/tenants/${tenant.slug}`;\r\n      const method = 'PUT';\r\n      const body: any = {\r\n        name: formData.name,\r\n        settings: {\r\n          currency: formData.currency,\r\n          language: formData.language,\r\n          email: formData.email || undefined,\r\n          phone: formData.phone || undefined,\r\n          companyName: formData.companyName || undefined,\r\n          businessType: formData.businessType || undefined,\r\n        },\r\n      };\r\n      if (formData.domain) body.domain = formData.domain;\r\n      if (formData.subdomain) body.subdomain = formData.subdomain;\r\n\r\n      const res = await fetch(url, {\r\n        method,\r\n        headers: { 'Content-Type': 'application/json' },\r\n        credentials: 'include',\r\n        body: JSON.stringify(body),\r\n      });\r\n\r\n      const data = await res.json();\r\n      if (data.success) {\r\n        onSave();\r\n      } else {\r\n        setError(data.error || dict?.admin?.failedToSaveTenant || 'Failed to save tenant');\r\n      }\r\n    } catch (error) {\r\n      setError(dict?.admin?.failedToSaveTenant || 'Failed to save tenant');\r\n    } finally {\r\n      setSaving(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 bg-gray-900/20 backdrop-blur-sm flex items-center justify-center z-50 p-4\">\r\n      <div className=\"bg-white border border-gray-300 max-w-md w-full max-h-[90vh] overflow-y-auto\">\r\n        <div className=\"p-6\">\r\n          <h2 className=\"text-2xl font-bold text-gray-900 mb-4\">\r\n            {tenant ? (dict.admin?.editTenant || 'Edit Tenant') : (dict.admin?.addTenant || 'Add Tenant')}\r\n          </h2>\r\n          <form onSubmit={handleSubmit} className=\"space-y-4\">\r\n            <div>\r\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                {dict.admin?.name || 'Name'}\r\n              </label>\r\n              <input\r\n                type=\"text\"\r\n                required\r\n                value={formData.name}\r\n                onChange={(e) => setFormData({ ...formData, name: e.target.value })}\r\n                className=\"w-full px-3 py-2 border border-gray-300 focus:ring-2 focus:ring-blue-500 bg-white\"\r\n              />\r\n            </div>\r\n            <div>\r\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                {dict.admin?.domain || 'Domain'} (optional)\r\n              </label>\r\n              <input\r\n                type=\"text\"\r\n                value={formData.domain}\r\n                onChange={(e) => setFormData({ ...formData, domain: e.target.value })}\r\n                className=\"w-full px-3 py-2 border border-gray-300 focus:ring-2 focus:ring-blue-500 bg-white\"\r\n              />\r\n            </div>\r\n            <div>\r\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                {dict.admin?.subdomain || 'Subdomain'} (optional)\r\n              </label>\r\n              <input\r\n                type=\"text\"\r\n                value={formData.subdomain}\r\n                onChange={(e) => setFormData({ ...formData, subdomain: e.target.value.toLowerCase() })}\r\n                className=\"w-full px-3 py-2 border border-gray-300 focus:ring-2 focus:ring-blue-500 bg-white\"\r\n              />\r\n            </div>\r\n            <div>\r\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                {dict.admin?.currency || 'Currency'}\r\n              </label>\r\n              <input\r\n                type=\"text\"\r\n                required\r\n                value={formData.currency}\r\n                onChange={(e) => setFormData({ ...formData, currency: e.target.value.toUpperCase() })}\r\n                className=\"w-full px-3 py-2 border border-gray-300 focus:ring-2 focus:ring-blue-500 bg-white\"\r\n                maxLength={3}\r\n              />\r\n            </div>\r\n            <div>\r\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                {dict.admin?.language || 'Language'}\r\n              </label>\r\n              <select\r\n                value={formData.language}\r\n                onChange={(e) => setFormData({ ...formData, language: e.target.value as 'en' | 'es' })}\r\n                className=\"w-full px-3 py-2 border border-gray-300 focus:ring-2 focus:ring-blue-500 bg-white\"\r\n              >\r\n                <option value=\"en\">English</option>\r\n                <option value=\"es\">Espaol</option>\r\n              </select>\r\n            </div>\r\n            <div>\r\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                {dict.admin?.businessType || 'Business Type'} <span className=\"text-red-500\">*</span>\r\n              </label>\r\n              {loadingBusinessTypes ? (\r\n                <div className=\"w-full px-3 py-2 border border-gray-300 bg-gray-50 flex items-center gap-2\">\r\n                  <div className=\"w-4 h-4 border-2 border-gray-400 border-t-transparent animate-spin\"></div>\r\n                  <span className=\"text-xs text-gray-600\">Loading business types...</span>\r\n                </div>\r\n              ) : (\r\n                <>\r\n                  <select\r\n                    value={formData.businessType}\r\n                    onChange={(e) => {\r\n                      const newType = e.target.value;\r\n                      if (newType !== tenant?.settings.businessType) {\r\n                        setBusinessTypeWarning(\r\n                          `Changing business type to \"${newType}\" will automatically configure features. This may enable or disable certain features based on the business type.`\r\n                        );\r\n                      } else {\r\n                        setBusinessTypeWarning(null);\r\n                      }\r\n                      setFormData({ ...formData, businessType: newType });\r\n                    }}\r\n                    className=\"w-full px-3 py-2 border border-gray-300 focus:ring-2 focus:ring-blue-500 bg-white\"\r\n                  >\r\n                    {businessTypes.map((type) => (\r\n                      <option key={type.type} value={type.type}>\r\n                        {type.name}\r\n                      </option>\r\n                    ))}\r\n                  </select>\r\n                  {businessTypeWarning && (\r\n                    <div className=\"mt-2 p-2 bg-yellow-50 border border-yellow-300 text-yellow-800 text-xs\">\r\n                      <div className=\"flex items-start gap-2\">\r\n                        <svg className=\"w-4 h-4 flex-shrink-0 mt-0.5\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z\" />\r\n                        </svg>\r\n                        <span>{businessTypeWarning}</span>\r\n                      </div>\r\n                    </div>\r\n                  )}\r\n                  {formData.businessType && !loadingBusinessTypes && (\r\n                    <div className=\"mt-2 p-3 bg-blue-50 border border-blue-200\">\r\n                      <p className=\"text-xs text-blue-900 font-medium mb-1\">\r\n                        {businessTypes.find((t) => t.type === formData.businessType)?.name || 'Business Type'}\r\n                      </p>\r\n                      <p className=\"text-xs text-blue-700\">\r\n                        {businessTypes.find((t) => t.type === formData.businessType)?.description || ''}\r\n                      </p>\r\n                    </div>\r\n                  )}\r\n                </>\r\n              )}\r\n            </div>\r\n            <div>\r\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                {dict.admin?.email || 'Email'} (optional)\r\n              </label>\r\n              <input\r\n                type=\"email\"\r\n                value={formData.email}\r\n                onChange={(e) => setFormData({ ...formData, email: e.target.value })}\r\n                className=\"w-full px-3 py-2 border border-gray-300 focus:ring-2 focus:ring-blue-500 bg-white\"\r\n              />\r\n            </div>\r\n            <div>\r\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                {dict.admin?.phone || 'Phone'} (optional)\r\n              </label>\r\n              <input\r\n                type=\"tel\"\r\n                value={formData.phone}\r\n                onChange={(e) => setFormData({ ...formData, phone: e.target.value })}\r\n                className=\"w-full px-3 py-2 border border-gray-300 focus:ring-2 focus:ring-blue-500 bg-white\"\r\n              />\r\n            </div>\r\n            <div>\r\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                {dict.admin?.companyName || 'Company Name'} (optional)\r\n              </label>\r\n              <input\r\n                type=\"text\"\r\n                value={formData.companyName}\r\n                onChange={(e) => setFormData({ ...formData, companyName: e.target.value })}\r\n                className=\"w-full px-3 py-2 border border-gray-300 focus:ring-2 focus:ring-blue-500 bg-white\"\r\n              />\r\n            </div>\r\n            {error && (\r\n              <div className=\"bg-red-50 text-red-800 border border-red-300 p-3\">\r\n                {error}\r\n              </div>\r\n            )}\r\n            <div className=\"flex gap-3 justify-end pt-4\">\r\n              <button\r\n                type=\"button\"\r\n                onClick={onClose}\r\n                className=\"px-4 py-2 border border-gray-300 text-gray-700 hover:bg-gray-50 bg-white\"\r\n              >\r\n                {dict.common?.cancel || 'Cancel'}\r\n              </button>\r\n              <button\r\n                type=\"submit\"\r\n                disabled={saving}\r\n                className=\"px-4 py-2 bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-50 border border-blue-700\"\r\n              >\r\n                {saving ? (dict.common?.loading || 'Saving...') : (dict.common?.save || 'Save')}\r\n              </button>\r\n            </div>\r\n          </form>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\[tenant]\\[lang]\\admin\\transactions\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'router' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":36,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":36,"endColumn":15},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":39,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":39,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1166,1169],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1166,1169],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'settings' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":46,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":46,"endColumn":19},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchTransactions'. Either include it or remove the dependency array.","line":51,"column":6,"nodeType":"ArrayExpression","endLine":51,"endColumn":26,"suggestions":[{"desc":"Update the dependencies array to be: [lang, tenant, page, fetchTransactions]","fix":{"range":[1731,1751],"text":"[lang, tenant, page, fetchTransactions]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":236,"column":9,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":236,"endColumn":12,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11305,11308],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11305,11308],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useEffect, useState } from 'react';\r\nimport Navbar from '@/components/Navbar';\r\nimport { useParams, useRouter } from 'next/navigation';\r\nimport Link from 'next/link';\r\nimport { getDictionaryClient } from '../../dictionaries-client';\r\nimport Currency from '@/components/Currency';\r\nimport { useTenantSettings } from '@/contexts/TenantSettingsContext';\r\n\r\ninterface Transaction {\r\n  _id: string;\r\n  receiptNumber?: string;\r\n  items: Array<{\r\n    product: string | { name: string };\r\n    name: string;\r\n    price: number;\r\n    quantity: number;\r\n    subtotal: number;\r\n  }>;\r\n  subtotal: number;\r\n  discountCode?: string;\r\n  discountAmount?: number;\r\n  total: number;\r\n  paymentMethod: 'cash' | 'card' | 'digital';\r\n  cashReceived?: number;\r\n  change?: number;\r\n  status: 'completed' | 'cancelled' | 'refunded';\r\n  userId?: string | { name: string; email: string };\r\n  notes?: string;\r\n  createdAt: string;\r\n}\r\n\r\nexport default function TransactionsPage() {\r\n  const params = useParams();\r\n  const router = useRouter();\r\n  const tenant = params.tenant as string;\r\n  const lang = params.lang as 'en' | 'es';\r\n  const [dict, setDict] = useState<any>(null);\r\n  const [transactions, setTransactions] = useState<Transaction[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [page, setPage] = useState(1);\r\n  const [totalPages, setTotalPages] = useState(1);\r\n  const [selectedTransaction, setSelectedTransaction] = useState<Transaction | null>(null);\r\n  const [message, setMessage] = useState<{ type: 'success' | 'error'; text: string } | null>(null);\r\n  const { settings } = useTenantSettings();\r\n\r\n  useEffect(() => {\r\n    getDictionaryClient(lang).then(setDict);\r\n    fetchTransactions();\r\n  }, [lang, tenant, page]);\r\n\r\n  const fetchTransactions = async () => {\r\n    setLoading(true);\r\n    try {\r\n      const res = await fetch(`/api/transactions?page=${page}&limit=50`, { credentials: 'include' });\r\n      const data = await res.json();\r\n      if (data.success) {\r\n        setTransactions(data.data || []);\r\n        setTotalPages(data.pagination?.pages || 1);\r\n        setMessage(null);\r\n      } else {\r\n        setMessage({ type: 'error', text: data.error || dict?.common?.failedToFetchTransactions || 'Failed to fetch transactions' });\r\n        setTransactions([]);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error fetching transactions:', error);\r\n      setMessage({ type: 'error', text: dict?.common?.failedToFetchTransactions || 'Failed to fetch transactions' });\r\n      setTransactions([]);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  if (!dict || loading) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gray-50 flex items-center justify-center\">\r\n        <div className=\"text-center\">\r\n          <div className=\"inline-block animate-spin h-8 w-8 border-b-2 border-blue-600\"></div>\r\n          <p className=\"mt-4 text-gray-600\">{dict?.common?.loading || 'Loading...'}</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50\">\r\n      <Navbar />\r\n      <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 sm:py-8\">\r\n        <div className=\"mb-6 sm:mb-8\">\r\n          <Link\r\n            href={`/${tenant}/${lang}/admin`}\r\n            className=\"inline-flex items-center text-blue-600 hover:text-blue-700 font-medium mb-4 transition-colors\"\r\n          >\r\n            <svg className=\"w-5 h-5 mr-2\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M10 19l-7-7m0 0l7-7m-7 7h18\" />\r\n            </svg>\r\n            {dict?.admin?.backToAdmin || 'Back to Admin'}\r\n          </Link>\r\n          <div className=\"flex items-center justify-between\">\r\n            <div>\r\n              <h1 className=\"text-2xl sm:text-3xl lg:text-4xl font-bold text-gray-900 mb-2\">\r\n                {dict.admin?.transactions || 'Transactions'}\r\n              </h1>\r\n              <p className=\"text-gray-600\">{dict.admin?.transactionsSubtitle || 'View and manage all sales transactions'}</p>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {message && (\r\n          <div className={`mb-6 p-4 border ${message.type === 'success' ? 'bg-green-50 text-green-800 border-green-300' : 'bg-red-50 text-red-800 border-red-300'}`}>\r\n            {message.text}\r\n          </div>\r\n        )}\r\n\r\n        <div className=\"bg-white border border-gray-300 p-6\">\r\n          <div className=\"overflow-x-auto\">\r\n            <table className=\"min-w-full divide-y divide-gray-200\">\r\n              <thead className=\"bg-gray-50\">\r\n                <tr>\r\n                  <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">{dict.admin?.receiptNumber || 'Receipt #'}</th>\r\n                  <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">{dict.transactions?.date || dict.admin?.date || 'Date'}</th>\r\n                  <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">{dict.transactions?.items || 'Items'}</th>\r\n                  <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">{dict.admin?.subtotal || 'Subtotal'}</th>\r\n                  <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">{dict.admin?.discount || 'Discount'}</th>\r\n                  <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">{dict.common?.total || 'Total'}</th>\r\n                  <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">{dict.transactions?.payment || 'Payment'}</th>\r\n                  <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">{dict.admin?.status || 'Status'}</th>\r\n                  <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">{dict.common?.actions || 'Actions'}</th>\r\n                </tr>\r\n              </thead>\r\n              <tbody className=\"bg-white divide-y divide-gray-200\">\r\n                {transactions.map((transaction) => (\r\n                  <tr key={transaction._id}>\r\n                    <td className=\"px-4 py-4 whitespace-nowrap text-sm font-mono text-gray-900\">\r\n                      {transaction.receiptNumber || '-'}\r\n                    </td>\r\n                    <td className=\"px-4 py-4 whitespace-nowrap text-sm text-gray-500\">\r\n                      {new Date(transaction.createdAt).toLocaleString()}\r\n                    </td>\r\n                    <td className=\"px-4 py-4 text-sm text-gray-500\">\r\n                      {transaction.items.length} {transaction.items.length === 1 ? (dict.transactions?.item || 'item') : (dict.transactions?.items || 'items')}\r\n                    </td>\r\n                    <td className=\"px-4 py-4 whitespace-nowrap text-sm text-gray-900\">\r\n                      <Currency amount={transaction.subtotal} />\r\n                    </td>\r\n                    <td className=\"px-4 py-4 whitespace-nowrap text-sm text-gray-500\">\r\n                      {transaction.discountAmount ? (\r\n                        <div>\r\n                          <div className=\"text-xs text-gray-400\">{transaction.discountCode}</div>\r\n                          <div className=\"text-red-600\">-<Currency amount={transaction.discountAmount} /></div>\r\n                        </div>\r\n                      ) : '-'}\r\n                    </td>\r\n                    <td className=\"px-4 py-4 whitespace-nowrap text-sm font-medium text-gray-900\">\r\n                      <Currency amount={transaction.total} />\r\n                    </td>\r\n                    <td className=\"px-4 py-4 whitespace-nowrap\">\r\n                      <span className=\"px-2 py-1 text-xs font-semibold border border-blue-300 bg-blue-100 text-blue-800\">\r\n                        {transaction.paymentMethod}\r\n                      </span>\r\n                      {transaction.paymentMethod === 'cash' && transaction.change !== undefined && (\r\n                        <div className=\"text-xs text-gray-500 mt-1\">{dict.transactions?.change || dict.admin?.change || 'Change'}: <Currency amount={transaction.change} /></div>\r\n                      )}\r\n                    </td>\r\n                    <td className=\"px-4 py-4 whitespace-nowrap\">\r\n                      <span className={`px-2 py-1 text-xs font-semibold border ${\r\n                        transaction.status === 'completed' ? 'bg-green-100 text-green-800' :\r\n                        transaction.status === 'refunded' ? 'bg-orange-100 text-orange-800' :\r\n                        'bg-red-100 text-red-800'\r\n                      }`}>\r\n                        {transaction.status === 'completed' ? (dict.transactions?.completed || dict.admin?.completed || 'completed') :\r\n                         transaction.status === 'cancelled' ? (dict.transactions?.cancelled || dict.admin?.cancelled || 'cancelled') :\r\n                         transaction.status === 'refunded' ? (dict.transactions?.refunded || 'refunded') :\r\n                         transaction.status}\r\n                      </span>\r\n                    </td>\r\n                    <td className=\"px-4 py-4 whitespace-nowrap text-sm font-medium\">\r\n                      <button\r\n                        onClick={() => setSelectedTransaction(transaction)}\r\n                        className=\"text-blue-600 hover:text-blue-900\"\r\n                      >\r\n                        {dict.common?.view || 'View'}\r\n                      </button>\r\n                    </td>\r\n                  </tr>\r\n                ))}\r\n              </tbody>\r\n            </table>\r\n            {transactions.length === 0 && (\r\n              <div className=\"text-center py-8 text-gray-500\">{dict.common?.noResults || 'No transactions found'}</div>\r\n            )}\r\n          </div>\r\n          {totalPages > 1 && (\r\n            <div className=\"mt-4 flex justify-center gap-2\">\r\n              <button\r\n                onClick={() => setPage(p => Math.max(1, p - 1))}\r\n                disabled={page === 1}\r\n                className=\"px-4 py-2 border border-gray-300 disabled:opacity-50 bg-white\"\r\n              >\r\n                {dict.transactions?.previous || dict.common?.previous || 'Previous'}\r\n              </button>\r\n              <span className=\"px-4 py-2 text-sm text-gray-700\">\r\n                {dict.transactions?.page || dict.admin?.page || 'Page'} {page} {dict.transactions?.of || dict.admin?.of || 'of'} {totalPages}\r\n              </span>\r\n              <button\r\n                onClick={() => setPage(p => Math.min(totalPages, p + 1))}\r\n                disabled={page === totalPages}\r\n                className=\"px-4 py-2 border border-gray-300 disabled:opacity-50 bg-white\"\r\n              >\r\n                {dict.transactions?.next || dict.common?.next || 'Next'}\r\n              </button>\r\n            </div>\r\n          )}\r\n        </div>\r\n\r\n        {selectedTransaction && (\r\n          <TransactionDetailModal\r\n            transaction={selectedTransaction}\r\n            onClose={() => setSelectedTransaction(null)}\r\n            dict={dict}\r\n          />\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction TransactionDetailModal({\r\n  transaction,\r\n  onClose,\r\n  dict,\r\n}: {\r\n  transaction: Transaction;\r\n  onClose: () => void;\r\n  dict: any;\r\n}) {\r\n  return (\r\n    <div className=\"fixed inset-0 bg-gray-900/20 backdrop-blur-sm flex items-center justify-center z-50 p-4\">\r\n      <div className=\"bg-white border border-gray-300 max-w-2xl w-full max-h-[90vh] overflow-y-auto\">\r\n        <div className=\"p-6\">\r\n          <div className=\"flex justify-between items-center mb-4\">\r\n            <h2 className=\"text-2xl font-bold text-gray-900\">\r\n              {dict.admin?.transactionDetails || 'Transaction Details'}\r\n            </h2>\r\n            <button\r\n              onClick={onClose}\r\n              className=\"text-gray-400 hover:text-gray-600\"\r\n            >\r\n              <svg className=\"w-6 h-6\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\r\n              </svg>\r\n            </button>\r\n          </div>\r\n          <div className=\"space-y-4\">\r\n            <div className=\"grid grid-cols-2 gap-4\">\r\n              <div>\r\n                <label className=\"text-sm font-medium text-gray-500\">{dict.admin?.receiptNumber || 'Receipt Number'}</label>\r\n                <div className=\"text-lg font-mono\">{transaction.receiptNumber || '-'}</div>\r\n              </div>\r\n              <div>\r\n                <label className=\"text-sm font-medium text-gray-500\">{dict.transactions?.date || dict.admin?.date || 'Date'}</label>\r\n                <div className=\"text-lg\">{new Date(transaction.createdAt).toLocaleString()}</div>\r\n              </div>\r\n              <div>\r\n                <label className=\"text-sm font-medium text-gray-500\">{dict.admin?.status || 'Status'}</label>\r\n                <div>\r\n                  <span className={`px-2 py-1 text-xs font-semibold border ${\r\n                    transaction.status === 'completed' ? 'bg-green-100 text-green-800 border-green-300' :\r\n                    transaction.status === 'refunded' ? 'bg-orange-100 text-orange-800 border-orange-300' :\r\n                    'bg-red-100 text-red-800 border-red-300'\r\n                  }`}>\r\n                    {transaction.status === 'completed' ? (dict.transactions?.completed || dict.admin?.completed || 'completed') :\r\n                     transaction.status === 'cancelled' ? (dict.transactions?.cancelled || dict.admin?.cancelled || 'cancelled') :\r\n                     transaction.status === 'refunded' ? (dict.transactions?.refunded || 'refunded') :\r\n                     transaction.status}\r\n                  </span>\r\n                </div>\r\n              </div>\r\n              <div>\r\n                <label className=\"text-sm font-medium text-gray-500\">{dict.transactions?.payment || 'Payment Method'}</label>\r\n                <div className=\"text-lg capitalize\">{transaction.paymentMethod}</div>\r\n              </div>\r\n            </div>\r\n            <div>\r\n              <label className=\"text-sm font-medium text-gray-500 mb-2 block\">{dict.transactions?.items || 'Items'}</label>\r\n              <div className=\"border border-gray-300 divide-y\">\r\n                {transaction.items.map((item, idx) => (\r\n                  <div key={idx} className=\"p-3 flex justify-between\">\r\n                    <div>\r\n                      <div className=\"font-medium\">{item.name}</div>\r\n                      <div className=\"text-sm text-gray-500\">Qty: {item.quantity}  <Currency amount={item.price} /></div>\r\n                    </div>\r\n                    <div className=\"font-medium\"><Currency amount={item.subtotal} /></div>\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            </div>\r\n            <div className=\"border-t pt-4 space-y-2\">\r\n              <div className=\"flex justify-between\">\r\n                <span className=\"text-gray-600\">{dict.admin?.subtotal || 'Subtotal'}:</span>\r\n                <span className=\"font-medium\"><Currency amount={transaction.subtotal} /></span>\r\n              </div>\r\n              {transaction.discountAmount && (\r\n                <div className=\"flex justify-between text-red-600\">\r\n                  <span>Discount ({transaction.discountCode}):</span>\r\n                  <span>-<Currency amount={transaction.discountAmount} /></span>\r\n                </div>\r\n              )}\r\n              <div className=\"flex justify-between text-lg font-bold border-t pt-2\">\r\n                <span>Total:</span>\r\n                <span><Currency amount={transaction.total} /></span>\r\n              </div>\r\n              {transaction.paymentMethod === 'cash' && transaction.cashReceived && (\r\n                <div className=\"flex justify-between text-sm text-gray-500\">\r\n                  <span>Cash Received:</span>\r\n                  <span><Currency amount={transaction.cashReceived} /></span>\r\n                </div>\r\n              )}\r\n              {transaction.paymentMethod === 'cash' && transaction.change !== undefined && (\r\n                <div className=\"flex justify-between text-sm text-gray-500\">\r\n                  <span>Change:</span>\r\n                  <span><Currency amount={transaction.change} /></span>\r\n                </div>\r\n              )}\r\n            </div>\r\n            {transaction.notes && (\r\n              <div>\r\n                <label className=\"text-sm font-medium text-gray-500 mb-1 block\">Notes</label>\r\n                <div className=\"p-3 bg-gray-50 border border-gray-300\">{transaction.notes}</div>\r\n              </div>\r\n            )}\r\n          </div>\r\n          <div className=\"mt-6 flex justify-end\">\r\n            <button\r\n              onClick={onClose}\r\n              className=\"px-4 py-2 bg-gray-200 text-gray-700 hover:bg-gray-300 border border-gray-400\"\r\n            >\r\n              {dict.common?.close || 'Close'}\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\[tenant]\\[lang]\\admin\\users\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'router' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":27,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":27,"endColumn":15},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":30,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":30,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[926,929],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[926,929],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchUsers'. Either include it or remove the dependency array.","line":44,"column":6,"nodeType":"ArrayExpression","endLine":44,"endColumn":20,"suggestions":[{"desc":"Update the dependencies array to be: [fetchUsers, lang, tenant]","fix":{"range":[1587,1601],"text":"[fetchUsers, lang, tenant]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":308,"column":9,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":308,"endColumn":12,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12869,12872],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12869,12872],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":326,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":326,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13405,13408],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13405,13408],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":405,"column":85,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":405,"endColumn":88,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16544,16547],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16544,16547],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":452,"column":9,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":452,"endColumn":12,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[18235,18238],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[18235,18238],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":594,"column":9,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":594,"endColumn":12,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[22902,22905],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[22902,22905],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchQRCode'. Either include it or remove the dependency array.","line":604,"column":6,"nodeType":"ArrayExpression","endLine":604,"endColumn":16,"suggestions":[{"desc":"Update the dependencies array to be: [fetchQRCode, user._id]","fix":{"range":[23263,23273],"text":"[fetchQRCode, user._id]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":9,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useEffect, useState } from 'react';\r\nimport Navbar from '@/components/Navbar';\r\nimport { useParams, useRouter } from 'next/navigation';\r\nimport Link from 'next/link';\r\nimport { getDictionaryClient } from '../../dictionaries-client';\r\nimport { useAuth } from '@/contexts/AuthContext';\r\nimport QRCodeDisplay from '@/components/QRCodeDisplay';\r\nimport { showToast } from '@/lib/toast';\r\nimport { useConfirm } from '@/lib/confirm';\r\n\r\ninterface User {\r\n  _id: string;\r\n  email: string;\r\n  name: string;\r\n  role: 'owner' | 'admin' | 'manager' | 'cashier' | 'viewer';\r\n  isActive: boolean;\r\n  createdAt: string;\r\n  lastLogin?: string;\r\n  hasPIN?: boolean;\r\n  qrToken?: string;\r\n}\r\n\r\nexport default function UsersPage() {\r\n  const params = useParams();\r\n  const router = useRouter();\r\n  const tenant = params.tenant as string;\r\n  const lang = params.lang as 'en' | 'es';\r\n  const [dict, setDict] = useState<any>(null);\r\n  const [users, setUsers] = useState<User[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [message, setMessage] = useState<{ type: 'success' | 'error'; text: string } | null>(null);\r\n  const [showUserModal, setShowUserModal] = useState(false);\r\n  const [showPINModal, setShowPINModal] = useState(false);\r\n  const [showQRModal, setShowQRModal] = useState(false);\r\n  const [editingUser, setEditingUser] = useState<User | null>(null);\r\n  const { user: currentUser } = useAuth();\r\n  const { confirm, Dialog: ConfirmDialog } = useConfirm();\r\n\r\n  useEffect(() => {\r\n    getDictionaryClient(lang).then(setDict);\r\n    fetchUsers();\r\n  }, [lang, tenant]);\r\n\r\n  const fetchUsers = async () => {\r\n    try {\r\n      const res = await fetch('/api/users', { credentials: 'include' });\r\n      const data = await res.json();\r\n      if (data.success) {\r\n        setUsers(data.data);\r\n        setMessage(null);\r\n      } else {\r\n        setMessage({ type: 'error', text: data.error || dict?.common?.failedToFetchUsers || 'Failed to fetch users' });\r\n      }\r\n    } catch (error) {\r\n      console.error('Error fetching users:', error);\r\n      setMessage({ type: 'error', text: dict?.common?.failedToFetchUsers || 'Failed to fetch users' });\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleDeleteUser = async (userId: string) => {\r\n    if (!dict) return;\r\n    const confirmed = await confirm(\r\n      dict.common?.deleteUserConfirmTitle || 'Delete User',\r\n      dict.common?.deleteUserConfirm || 'Are you sure you want to delete this user?',\r\n      { variant: 'danger' }\r\n    );\r\n    if (!confirmed) return;\r\n    try {\r\n      const res = await fetch(`/api/users/${userId}`, { method: 'DELETE', credentials: 'include' });\r\n      const data = await res.json();\r\n      if (data.success) {\r\n        showToast.success(dict?.admin?.userDeletedSuccess || dict?.common?.userDeletedSuccess || 'User deleted successfully');\r\n        fetchUsers();\r\n      } else {\r\n        setMessage({ type: 'error', text: data.error || dict?.admin?.failedToDeleteUser || dict?.common?.failedToDeleteUser || 'Failed to delete user' });\r\n      }\r\n    } catch (error) {\r\n      setMessage({ type: 'error', text: dict?.admin?.failedToDeleteUser || dict?.common?.failedToDeleteUser || 'Failed to delete user' });\r\n    }\r\n  };\r\n\r\n  const handleToggleUserStatus = async (user: User) => {\r\n    try {\r\n      const res = await fetch(`/api/users/${user._id}`, {\r\n        method: 'PUT',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        credentials: 'include',\r\n        body: JSON.stringify({ isActive: !user.isActive }),\r\n      });\r\n      const data = await res.json();\r\n      if (data.success) {\r\n        setMessage({ type: 'success', text: `User ${!user.isActive ? (dict?.admin?.activated || 'activated') : (dict?.admin?.deactivated || 'deactivated')} ${dict?.admin?.successfully || 'successfully'}` });\r\n        fetchUsers();\r\n      } else {\r\n        setMessage({ type: 'error', text: data.error || dict?.common?.failedToUpdateUser || 'Failed to update user' });\r\n      }\r\n    } catch (error) {\r\n      setMessage({ type: 'error', text: dict?.common?.failedToUpdateUser || 'Failed to update user' });\r\n    }\r\n  };\r\n\r\n  if (!dict || loading) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gray-50 flex items-center justify-center\">\r\n        <div className=\"text-center\">\r\n          <div className=\"inline-block animate-spin h-8 w-8 border-b-2 border-blue-600\"></div>\r\n          <p className=\"mt-4 text-gray-600\">{dict?.common?.loading || 'Loading...'}</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50\">\r\n      {ConfirmDialog}\r\n      <Navbar />\r\n      <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 sm:py-8\">\r\n        <div className=\"mb-6 sm:mb-8\">\r\n          <Link\r\n            href={`/${tenant}/${lang}/admin`}\r\n            className=\"inline-flex items-center text-blue-600 hover:text-blue-700 font-medium mb-4 transition-colors\"\r\n          >\r\n            <svg className=\"w-5 h-5 mr-2\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M10 19l-7-7m0 0l7-7m-7 7h18\" />\r\n            </svg>\r\n            {dict?.admin?.backToAdmin || 'Back to Admin'}\r\n          </Link>\r\n          <div className=\"flex items-center justify-between\">\r\n            <div>\r\n              <h1 className=\"text-2xl sm:text-3xl lg:text-4xl font-bold text-gray-900 mb-2\">\r\n                {dict.admin?.users || 'Users'}\r\n              </h1>\r\n              <p className=\"text-gray-600\">{dict.admin?.usersSubtitle || 'Manage system users and their permissions'}</p>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {message && (\r\n          <div className={`mb-6 p-4 border ${message.type === 'success' ? 'bg-green-50 text-green-800 border-green-300' : 'bg-red-50 text-red-800 border-red-300'}`}>\r\n            {message.text}\r\n          </div>\r\n        )}\r\n\r\n        <div className=\"bg-white border border-gray-300 p-6\">\r\n          <div className=\"flex justify-between items-center mb-6\">\r\n            <h2 className=\"text-xl font-bold text-gray-900\">{dict.admin?.users || 'Users'}</h2>\r\n            <button\r\n              onClick={() => {\r\n                setEditingUser(null);\r\n                setShowUserModal(true);\r\n              }}\r\n              className=\"px-4 py-2 bg-blue-600 text-white hover:bg-blue-700 font-medium border border-blue-700\"\r\n            >\r\n              {dict.common?.add || 'Add'} {dict.admin?.user || 'User'}\r\n            </button>\r\n          </div>\r\n          <div className=\"overflow-x-auto\">\r\n            <table className=\"min-w-full divide-y divide-gray-200\">\r\n              <thead className=\"bg-gray-50\">\r\n                <tr>\r\n                  <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">{dict.admin?.name || 'Name'}</th>\r\n                  <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">{dict.admin?.email || 'Email'}</th>\r\n                  <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">{dict.admin?.role || 'Role'}</th>\r\n                  <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">{dict.admin?.status || 'Status'}</th>\r\n                  <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">PIN/QR</th>\r\n                  <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">{dict.common?.actions || 'Actions'}</th>\r\n                </tr>\r\n              </thead>\r\n              <tbody className=\"bg-white divide-y divide-gray-200\">\r\n                {users.map((user) => (\r\n                  <tr key={user._id}>\r\n                    <td className=\"px-4 py-4 whitespace-nowrap text-sm font-medium text-gray-900\">{user.name}</td>\r\n                    <td className=\"px-4 py-4 whitespace-nowrap text-sm text-gray-500\">{user.email}</td>\r\n                    <td className=\"px-4 py-4 whitespace-nowrap\">\r\n                      <span className=\"px-2 py-1 text-xs font-semibold border border-blue-300 bg-blue-100 text-blue-800 capitalize\">\r\n                        {user.role}\r\n                      </span>\r\n                    </td>\r\n                    <td className=\"px-4 py-4 whitespace-nowrap\">\r\n                      <span className={`px-2 py-1 text-xs font-semibold border ${user.isActive ? 'bg-green-100 text-green-800 border-green-300' : 'bg-red-100 text-red-800 border-red-300'}`}>\r\n                        {user.isActive ? (dict.admin?.active || 'Active') : (dict.admin?.inactive || 'Inactive')}\r\n                      </span>\r\n                    </td>\r\n                    <td className=\"px-4 py-4 whitespace-nowrap text-sm\">\r\n                      <div className=\"flex gap-2\">\r\n                        <button\r\n                          onClick={() => {\r\n                            setEditingUser(user);\r\n                            setShowPINModal(true);\r\n                          }}\r\n                          className=\"text-purple-600 hover:text-purple-900 text-xs\"\r\n                          title={dict?.admin?.managePIN || 'Manage PIN'}\r\n                        >\r\n                          PIN\r\n                        </button>\r\n                        <button\r\n                          onClick={() => {\r\n                            setEditingUser(user);\r\n                            setShowQRModal(true);\r\n                          }}\r\n                          className=\"text-indigo-600 hover:text-indigo-900 text-xs\"\r\n                          title={dict?.admin?.viewQRCode || 'View QR Code'}\r\n                        >\r\n                          QR\r\n                        </button>\r\n                      </div>\r\n                    </td>\r\n                    <td className=\"px-4 py-4 whitespace-nowrap text-sm font-medium\">\r\n                      <div className=\"flex gap-2\">\r\n                        <button\r\n                          onClick={() => {\r\n                            setEditingUser(user);\r\n                            setShowUserModal(true);\r\n                          }}\r\n                          className=\"text-blue-600 hover:text-blue-900\"\r\n                        >\r\n                          {dict.common?.edit || 'Edit'}\r\n                        </button>\r\n                        <button\r\n                          onClick={() => handleToggleUserStatus(user)}\r\n                          className={user.isActive ? 'text-orange-600 hover:text-orange-900' : 'text-green-600 hover:text-green-900'}\r\n                        >\r\n                          {user.isActive ? (dict.admin?.deactivate || 'Deactivate') : (dict.admin?.activate || 'Activate')}\r\n                        </button>\r\n                        {currentUser?._id !== user._id && (\r\n                          <button\r\n                            onClick={() => handleDeleteUser(user._id)}\r\n                            className=\"text-red-600 hover:text-red-900\"\r\n                          >\r\n                            {dict.common?.delete || 'Delete'}\r\n                          </button>\r\n                        )}\r\n                      </div>\r\n                    </td>\r\n                  </tr>\r\n                ))}\r\n              </tbody>\r\n            </table>\r\n            {users.length === 0 && (\r\n              <div className=\"text-center py-8 text-gray-500\">{dict.common?.noResults || 'No users found'}</div>\r\n            )}\r\n          </div>\r\n        </div>\r\n\r\n        {showUserModal && (\r\n          <UserModal\r\n            user={editingUser}\r\n            onClose={() => {\r\n              setShowUserModal(false);\r\n              setEditingUser(null);\r\n            }}\r\n            onSave={() => {\r\n              fetchUsers();\r\n              setShowUserModal(false);\r\n              setEditingUser(null);\r\n            }}\r\n            dict={dict}\r\n          />\r\n        )}\r\n\r\n        {showPINModal && editingUser && (\r\n          <PINModal\r\n            user={editingUser}\r\n            onClose={() => {\r\n              setShowPINModal(false);\r\n              setEditingUser(null);\r\n            }}\r\n            onSave={() => {\r\n              fetchUsers();\r\n              setShowPINModal(false);\r\n              setEditingUser(null);\r\n            }}\r\n            dict={dict}\r\n          />\r\n        )}\r\n\r\n        {showQRModal && editingUser && (\r\n          <QRModal\r\n            user={editingUser}\r\n            onClose={() => {\r\n              setShowQRModal(false);\r\n              setEditingUser(null);\r\n            }}\r\n            onRegenerate={() => {\r\n              fetchUsers();\r\n            }}\r\n            dict={dict}\r\n          />\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction UserModal({\r\n  user,\r\n  onClose,\r\n  onSave,\r\n  dict,\r\n}: {\r\n  user: User | null;\r\n  onClose: () => void;\r\n  onSave: () => void;\r\n  dict: any;\r\n}) {\r\n  const [formData, setFormData] = useState({\r\n    email: user?.email || '',\r\n    name: user?.name || '',\r\n    password: '',\r\n    role: user?.role || 'cashier',\r\n  });\r\n  const [saving, setSaving] = useState(false);\r\n  const [error, setError] = useState('');\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    setError('');\r\n    setSaving(true);\r\n    try {\r\n      const url = user ? `/api/users/${user._id}` : '/api/users';\r\n      const method = user ? 'PUT' : 'POST';\r\n      const body: any = {\r\n        email: formData.email,\r\n        name: formData.name,\r\n        role: formData.role,\r\n      };\r\n      if (!user || formData.password) {\r\n        body.password = formData.password;\r\n      }\r\n\r\n      const res = await fetch(url, {\r\n        method,\r\n        headers: { 'Content-Type': 'application/json' },\r\n        credentials: 'include',\r\n        body: JSON.stringify(body),\r\n      });\r\n\r\n      const data = await res.json();\r\n      if (data.success) {\r\n        onSave();\r\n      } else {\r\n        setError(data.error || 'Failed to save user');\r\n      }\r\n    } catch (error) {\r\n      setError('Failed to save user');\r\n    } finally {\r\n      setSaving(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 bg-gray-900/20 backdrop-blur-sm flex items-center justify-center z-50 p-4\">\r\n      <div className=\"bg-white border border-gray-300 max-w-md w-full max-h-[90vh] overflow-y-auto\">\r\n        <div className=\"p-6\">\r\n          <h2 className=\"text-2xl font-bold text-gray-900 mb-4\">\r\n            {user ? (dict.admin?.editUser || 'Edit User') : (dict.admin?.addUser || 'Add User')}\r\n          </h2>\r\n          <form onSubmit={handleSubmit} className=\"space-y-4\">\r\n            <div>\r\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                {dict.admin?.email || 'Email'}\r\n              </label>\r\n              <input\r\n                type=\"email\"\r\n                required\r\n                value={formData.email}\r\n                onChange={(e) => setFormData({ ...formData, email: e.target.value })}\r\n                className=\"w-full px-3 py-2 border border-gray-300 focus:ring-2 focus:ring-blue-500 bg-white\"\r\n              />\r\n            </div>\r\n            <div>\r\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                {dict.admin?.name || 'Name'}\r\n              </label>\r\n              <input\r\n                type=\"text\"\r\n                required\r\n                value={formData.name}\r\n                onChange={(e) => setFormData({ ...formData, name: e.target.value })}\r\n                className=\"w-full px-3 py-2 border border-gray-300 focus:ring-2 focus:ring-blue-500 bg-white\"\r\n              />\r\n            </div>\r\n            <div>\r\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                {dict.admin?.password || 'Password'} {user && '(leave blank to keep current)'}\r\n              </label>\r\n              <input\r\n                type=\"password\"\r\n                required={!user}\r\n                value={formData.password}\r\n                onChange={(e) => setFormData({ ...formData, password: e.target.value })}\r\n                className=\"w-full px-3 py-2 border border-gray-300 focus:ring-2 focus:ring-blue-500 bg-white\"\r\n              />\r\n            </div>\r\n            <div>\r\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                {dict.admin?.role || 'Role'}\r\n              </label>\r\n              <select\r\n                value={formData.role}\r\n                onChange={(e) => setFormData({ ...formData, role: e.target.value as any })}\r\n                className=\"w-full px-3 py-2 border border-gray-300 focus:ring-2 focus:ring-blue-500 bg-white\"\r\n              >\r\n                <option value=\"viewer\">{dict.admin?.viewer || 'Viewer'}</option>\r\n                <option value=\"cashier\">{dict.admin?.cashier || 'Cashier'}</option>\r\n                <option value=\"manager\">{dict.admin?.manager || 'Manager'}</option>\r\n                <option value=\"admin\">{dict.admin?.adminRole || 'Admin'}</option>\r\n                <option value=\"owner\">{dict.admin?.owner || 'Owner'}</option>\r\n              </select>\r\n            </div>\r\n            {error && (\r\n              <div className=\"bg-red-50 text-red-800 border border-red-300 p-3\">\r\n                {error}\r\n              </div>\r\n            )}\r\n            <div className=\"flex gap-3 justify-end pt-4\">\r\n              <button\r\n                type=\"button\"\r\n                onClick={onClose}\r\n                className=\"px-4 py-2 border border-gray-300 text-gray-700 hover:bg-gray-50 bg-white\"\r\n              >\r\n                {dict.common?.cancel || 'Cancel'}\r\n              </button>\r\n              <button\r\n                type=\"submit\"\r\n                disabled={saving}\r\n                className=\"px-4 py-2 bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-50 border border-blue-700\"\r\n              >\r\n                {saving ? (dict.common?.loading || 'Saving...') : (dict.common?.save || 'Save')}\r\n              </button>\r\n            </div>\r\n          </form>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction PINModal({\r\n  user,\r\n  onClose,\r\n  onSave,\r\n  dict,\r\n}: {\r\n  user: User;\r\n  onClose: () => void;\r\n  onSave: () => void;\r\n  dict: any;\r\n}) {\r\n  const [pin, setPin] = useState('');\r\n  const [saving, setSaving] = useState(false);\r\n  const [error, setError] = useState('');\r\n  const [removing, setRemoving] = useState(false);\r\n  const { confirm, Dialog } = useConfirm();\r\n\r\n  const handleSetPIN = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    setError('');\r\n    \r\n    if (!pin || !/^\\d{4,8}$/.test(pin)) {\r\n      setError(dict?.admin?.pinDigits || 'PIN must be 4-8 digits');\r\n      return;\r\n    }\r\n\r\n    setSaving(true);\r\n    try {\r\n      const res = await fetch(`/api/users/${user._id}/pin`, {\r\n        method: 'PUT',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        credentials: 'include',\r\n        body: JSON.stringify({ pin }),\r\n      });\r\n\r\n      const data = await res.json();\r\n      if (data.success) {\r\n        onSave();\r\n      } else {\r\n        setError(data.error || 'Failed to set PIN');\r\n      }\r\n    } catch (error) {\r\n      setError('Failed to set PIN');\r\n    } finally {\r\n      setSaving(false);\r\n    }\r\n  };\r\n\r\n  const handleRemovePIN = async () => {\r\n    if (!dict) return;\r\n    const confirmed = await confirm(\r\n      dict.common?.removePINConfirmTitle || 'Remove PIN',\r\n      dict.common?.removePINConfirm || dict.admin?.removePINConfirm || 'Are you sure you want to remove the PIN for this user?',\r\n      { variant: 'warning' }\r\n    );\r\n    if (!confirmed) return;\r\n    \r\n    setRemoving(true);\r\n    setError('');\r\n    try {\r\n      const res = await fetch(`/api/users/${user._id}/pin`, {\r\n        method: 'DELETE',\r\n        credentials: 'include',\r\n      });\r\n\r\n      const data = await res.json();\r\n      if (data.success) {\r\n        onSave();\r\n      } else {\r\n        setError(data.error || 'Failed to remove PIN');\r\n      }\r\n    } catch (error) {\r\n      setError('Failed to remove PIN');\r\n    } finally {\r\n      setRemoving(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 bg-gray-900/20 backdrop-blur-sm flex items-center justify-center z-50 p-4\">\r\n      {Dialog}\r\n      <div className=\"bg-white border border-gray-300 max-w-md w-full\">\r\n        <div className=\"p-6\">\r\n          <h2 className=\"text-2xl font-bold text-gray-900 mb-4\">\r\n            {dict?.admin?.managePINFor || 'Manage PIN for'} {user.name}\r\n          </h2>\r\n          <form onSubmit={handleSetPIN} className=\"space-y-4\">\r\n            <div>\r\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                {dict?.admin?.pinDigits || 'PIN (4-8 digits)'}\r\n              </label>\r\n              <input\r\n                type=\"text\"\r\n                inputMode=\"numeric\"\r\n                pattern=\"[0-9]{4,8}\"\r\n                maxLength={8}\r\n                value={pin}\r\n                onChange={(e) => {\r\n                  const value = e.target.value.replace(/\\D/g, '');\r\n                  if (value.length <= 8) setPin(value);\r\n                }}\r\n                className=\"w-full px-3 py-2 border border-gray-300 focus:ring-2 focus:ring-blue-500 text-center text-2xl font-mono tracking-widest bg-white\"\r\n                placeholder=\"0000\"\r\n                required\r\n              />\r\n            </div>\r\n            {error && (\r\n              <div className=\"bg-red-50 text-red-800 border border-red-300 p-3\">\r\n                {error}\r\n              </div>\r\n            )}\r\n            <div className=\"flex gap-3 justify-end pt-4\">\r\n              <button\r\n                type=\"button\"\r\n                onClick={handleRemovePIN}\r\n                disabled={removing}\r\n                className=\"px-4 py-2 border border-red-300 text-red-700 hover:bg-red-50 disabled:opacity-50 bg-white\"\r\n              >\r\n                {removing ? (dict?.admin?.removing || 'Removing...') : (dict?.admin?.removePIN || 'Remove PIN')}\r\n              </button>\r\n              <button\r\n                type=\"button\"\r\n                onClick={onClose}\r\n                className=\"px-4 py-2 border border-gray-300 text-gray-700 hover:bg-gray-50 bg-white\"\r\n              >\r\n                {dict.common?.cancel || 'Cancel'}\r\n              </button>\r\n              <button\r\n                type=\"submit\"\r\n                disabled={saving}\r\n                className=\"px-4 py-2 bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-50 border border-blue-700\"\r\n              >\r\n                {saving ? (dict?.common?.saving || 'Saving...') : (dict?.admin?.setPIN || 'Set PIN')}\r\n              </button>\r\n            </div>\r\n          </form>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction QRModal({\r\n  user,\r\n  onClose,\r\n  onRegenerate,\r\n  dict,\r\n}: {\r\n  user: User;\r\n  onClose: () => void;\r\n  onRegenerate: () => void;\r\n  dict: any;\r\n}) {\r\n  const [qrData, setQrData] = useState<{ qrToken: string; name: string; email: string } | null>(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [regenerating, setRegenerating] = useState(false);\r\n  const [error, setError] = useState('');\r\n  const { confirm, Dialog } = useConfirm();\r\n\r\n  useEffect(() => {\r\n    fetchQRCode();\r\n  }, [user._id]);\r\n\r\n  const fetchQRCode = async () => {\r\n    setLoading(true);\r\n    setError('');\r\n    try {\r\n      const res = await fetch(`/api/users/${user._id}/qr-code`, {\r\n        credentials: 'include',\r\n      });\r\n      const data = await res.json();\r\n      if (data.success) {\r\n        setQrData(data.data);\r\n      } else {\r\n        setError(data.error || 'Failed to load QR code');\r\n      }\r\n    } catch (error) {\r\n      setError('Failed to load QR code');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleRegenerate = async () => {\r\n    if (!dict) return;\r\n    const confirmed = await confirm(\r\n      dict.common?.regenerateQRConfirmTitle || 'Regenerate QR Code',\r\n      dict.common?.regenerateQRConfirm || dict.admin?.regenerateQRConfirm || 'Are you sure you want to regenerate the QR code? The old QR code will no longer work.',\r\n      { variant: 'warning' }\r\n    );\r\n    if (!confirmed) return;\r\n    \r\n    setRegenerating(true);\r\n    setError('');\r\n    try {\r\n      const res = await fetch(`/api/users/${user._id}/qr-code`, {\r\n        method: 'POST',\r\n        credentials: 'include',\r\n      });\r\n      const data = await res.json();\r\n      if (data.success) {\r\n        setQrData({ ...qrData!, qrToken: data.data.qrToken });\r\n        onRegenerate();\r\n      } else {\r\n        setError(data.error || 'Failed to regenerate QR code');\r\n      }\r\n    } catch (error) {\r\n      setError('Failed to regenerate QR code');\r\n    } finally {\r\n      setRegenerating(false);\r\n    }\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"fixed inset-0 bg-gray-900/20 backdrop-blur-sm flex items-center justify-center z-50 p-4\">\r\n        <div className=\"bg-white border border-gray-300 p-6\">\r\n          <div className=\"text-center\">\r\n            <div className=\"inline-block animate-spin h-8 w-8 border-b-2 border-blue-600\"></div>\r\n            <p className=\"mt-4 text-gray-600\">{dict?.admin?.loadingQRCode || 'Loading QR code...'}</p>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 bg-gray-900/20 backdrop-blur-sm flex items-center justify-center z-50 p-4\">\r\n      {Dialog}\r\n      <div className=\"bg-white border border-gray-300 max-w-md w-full\">\r\n        <div className=\"p-6\">\r\n          <h2 className=\"text-2xl font-bold text-gray-900 mb-4\">\r\n            QR Code for {user.name}\r\n          </h2>\r\n          {error && (\r\n            <div className=\"bg-red-50 text-red-800 border border-red-300 p-3 mb-4\">\r\n              {error}\r\n            </div>\r\n          )}\r\n          {qrData && (\r\n            <div className=\"space-y-4\">\r\n              <div className=\"flex justify-center p-4 bg-gray-50 border border-gray-300\">\r\n                <QRCodeDisplay qrToken={qrData.qrToken} name={qrData.name} />\r\n              </div>\r\n              <div className=\"flex gap-3 justify-end pt-4\">\r\n                <button\r\n                  onClick={handleRegenerate}\r\n                  disabled={regenerating}\r\n                  className=\"px-4 py-2 border border-orange-300 text-orange-700 hover:bg-orange-50 disabled:opacity-50 bg-white\"\r\n                >\r\n                  {regenerating ? 'Regenerating...' : 'Regenerate QR Code'}\r\n                </button>\r\n                <button\r\n                  onClick={onClose}\r\n                  className=\"px-4 py-2 bg-blue-600 text-white hover:bg-blue-700 border border-blue-700\"\r\n                >\r\n                  {dict.common?.close || 'Close'}\r\n                </button>\r\n              </div>\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\[tenant]\\[lang]\\dictionaries-client.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":3,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[55,58],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[55,58],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":30,"column":73,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":30,"endColumn":76,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[987,990],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[987,990],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\ntype DictionaryLoader = () => Promise<any>;\r\n\r\nconst dictionaries: Record<'en' | 'es', DictionaryLoader> = {\r\n  en: async () => {\r\n    try {\r\n      const mod = await import('./dictionaries/en.json');\r\n      // JSON imports in Next.js can be the default export or the module itself\r\n      return mod.default || mod;\r\n    } catch (error) {\r\n      console.error('Error loading English dictionary:', error);\r\n      throw error;\r\n    }\r\n  },\r\n  es: async () => {\r\n    try {\r\n      const mod = await import('./dictionaries/es.json');\r\n      // JSON imports in Next.js can be the default export or the module itself\r\n      return mod.default || mod;\r\n    } catch (error) {\r\n      console.error('Error loading Spanish dictionary:', error);\r\n      // Fallback to English if Spanish fails\r\n      const modEn = await import('./dictionaries/en.json');\r\n      return modEn.default || modEn;\r\n    }\r\n  },\r\n};\r\n\r\nexport const getDictionaryClient = async (locale: 'en' | 'es'): Promise<any> => {\r\n  // Validate locale\r\n  if (locale !== 'en' && locale !== 'es') {\r\n    console.warn(`Invalid locale \"${locale}\", falling back to English`);\r\n    locale = 'en';\r\n  }\r\n  \r\n  const loader = dictionaries[locale];\r\n  \r\n  if (!loader) {\r\n    console.error(`Dictionary loader for locale \"${locale}\" not found`);\r\n    // Fallback to English\r\n    return dictionaries.en();\r\n  }\r\n  \r\n  if (typeof loader !== 'function') {\r\n    console.error(`Dictionary loader for locale \"${locale}\" is not a function, got:`, typeof loader);\r\n    // Fallback to English\r\n    return dictionaries.en();\r\n  }\r\n  \r\n  try {\r\n    return await loader();\r\n  } catch (error) {\r\n    console.error(`Error loading dictionary for locale \"${locale}\":`, error);\r\n    // Fallback to English\r\n    return dictionaries.en();\r\n  }\r\n};\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\[tenant]\\[lang]\\dictionaries.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\[tenant]\\[lang]\\inventory\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":25,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":25,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[928,931],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[928,931],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'loading' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":28,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":28,"endColumn":17},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchBranches'. Either include it or remove the dependency array.","line":39,"column":6,"nodeType":"ArrayExpression","endLine":39,"endColumn":14,"suggestions":[{"desc":"Update the dependencies array to be: [fetchBranches, tenant]","fix":{"range":[1435,1443],"text":"[fetchBranches, tenant]"}}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'update' is defined but never used. Allowed unused args must match /^_/u.","line":56,"column":30,"nodeType":null,"messageId":"unusedVar","endLine":56,"endColumn":36},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":56,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":56,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1892,1895],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1892,1895],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useEffect, useState } from 'react';\r\nimport { useParams } from 'next/navigation';\r\nimport Navbar from '@/components/Navbar';\r\nimport PageTitle from '@/components/PageTitle';\r\nimport LowStockAlerts from '@/components/LowStockAlerts';\r\nimport RealTimeStockTracker from '@/components/RealTimeStockTracker';\r\nimport { getDictionaryClient } from '../dictionaries-client';\r\nimport { useTenantSettings } from '@/contexts/TenantSettingsContext';\r\nimport { getBusinessTypeConfig } from '@/lib/business-types';\r\nimport { getBusinessType, supportsFeature } from '@/lib/business-type-helpers';\r\n\r\ninterface Branch {\r\n  _id: string;\r\n  name: string;\r\n  code?: string;\r\n}\r\n\r\nexport default function InventoryPage() {\r\n  const params = useParams();\r\n  const tenant = params.tenant as string;\r\n  const lang = params.lang as 'en' | 'es';\r\n  const { settings } = useTenantSettings();\r\n  const [dict, setDict] = useState<any>(null);\r\n  const [selectedBranch, setSelectedBranch] = useState<string>('');\r\n  const [branches, setBranches] = useState<Branch[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  \r\n  const inventoryEnabled = supportsFeature(settings ?? undefined, 'inventory');\r\n  const businessTypeConfig = settings ? getBusinessTypeConfig(getBusinessType(settings)) : null;\r\n\r\n  useEffect(() => {\r\n    getDictionaryClient(lang).then(setDict);\r\n  }, [lang]);\r\n\r\n  useEffect(() => {\r\n    fetchBranches();\r\n  }, [tenant]);\r\n\r\n  const fetchBranches = async () => {\r\n    try {\r\n      setLoading(true);\r\n      const res = await fetch(`/api/branches?tenant=${tenant}&isActive=true`);\r\n      const data = await res.json();\r\n      if (data.success) {\r\n        setBranches(data.data || []);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error fetching branches:', error);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleStockUpdate = (update: any) => {\r\n    // Handle real-time stock updates\r\n    // Stock updates are handled by the RealTimeStockTracker component\r\n  };\r\n\r\n  if (!dict) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gray-50 flex items-center justify-center\">\r\n        <div className=\"text-center\">\r\n          <div className=\"inline-block animate-spin h-8 w-8 border-b-2 border-blue-600\"></div>\r\n          <p className=\"mt-4 text-gray-600\">{dict?.common?.loading || 'Loading...'}</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // If inventory is not enabled for this business type, show message\r\n  if (!inventoryEnabled) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gray-50\">\r\n        <Navbar />\r\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\r\n          <div className=\"mb-6\">\r\n            <PageTitle />\r\n            <h1 className=\"text-2xl sm:text-3xl lg:text-4xl font-bold text-gray-900 mb-4\">\r\n              {dict?.inventory?.title || 'Inventory Management'}\r\n            </h1>\r\n          </div>\r\n          <div className=\"bg-yellow-50 border-2 border-yellow-300 p-6 rounded-lg\">\r\n            <div className=\"flex items-start gap-3\">\r\n              <svg className=\"w-6 h-6 text-yellow-600 flex-shrink-0 mt-0.5\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z\" />\r\n              </svg>\r\n              <div>\r\n                <h3 className=\"text-lg font-semibold text-yellow-900 mb-2\">\r\n                  Inventory Management Not Available\r\n                </h3>\r\n                <p className=\"text-yellow-800\">\r\n                  Inventory management is not enabled for {businessTypeConfig?.name || 'your business type'}. \r\n                  This feature is typically used for retail businesses that need to track physical stock.\r\n                </p>\r\n                <p className=\"text-sm text-yellow-700 mt-2\">\r\n                  If you need inventory management, please update your business type in Settings.\r\n                </p>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50\">\r\n      <Navbar />\r\n      <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\r\n        <div className=\"mb-6\">\r\n          <PageTitle />\r\n          <h1 className=\"text-2xl sm:text-3xl lg:text-4xl font-bold text-gray-900 mb-4\">\r\n            {dict?.inventory?.title || 'Inventory Management'}\r\n          </h1>\r\n          <div className=\"mt-4 flex items-center justify-between\">\r\n            <div className=\"flex items-center gap-4\">\r\n              <label className=\"text-sm font-medium text-gray-700\">\r\n                {dict?.inventory?.branch || 'Branch'}:\r\n              </label>\r\n              <select\r\n                value={selectedBranch}\r\n                onChange={(e) => setSelectedBranch(e.target.value)}\r\n                className=\"block w-48 border-2 border-gray-300 focus:border-blue-500 focus:ring-blue-500 sm:text-sm bg-white\"\r\n              >\r\n                <option value=\"\">{dict?.inventory?.allBranches || 'All Branches'}</option>\r\n                {branches.map((branch) => (\r\n                  <option key={branch._id} value={branch._id}>\r\n                    {branch.name} {branch.code && `(${branch.code})`}\r\n                  </option>\r\n                ))}\r\n              </select>\r\n            </div>\r\n            <RealTimeStockTracker\r\n              branchId={selectedBranch || undefined}\r\n              onStockUpdate={handleStockUpdate}\r\n            />\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\r\n          <div className=\"lg:col-span-2\">\r\n            <LowStockAlerts\r\n              autoRefresh={true}\r\n              refreshInterval={30000}\r\n              onProductClick={(productId) => {\r\n                // Navigate to product edit page\r\n                window.location.href = `/${tenant}/${lang}/products?edit=${productId}`;\r\n              }}\r\n            />\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"mt-8 bg-white border border-gray-300 p-6\">\r\n          <h2 className=\"text-lg font-semibold text-gray-900 mb-4\">\r\n            {dict?.inventory?.features || 'Inventory Features'}\r\n          </h2>\r\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\r\n            <div className=\"p-4 border border-gray-300\">\r\n              <h3 className=\"font-medium text-gray-900 mb-2\">\r\n                 {dict?.inventory?.realtimeTracking || 'Real-time Stock Tracking'}\r\n              </h3>\r\n              <p className=\"text-sm text-gray-600\">\r\n                {dict?.inventory?.realtimeTrackingDesc || 'Monitor stock levels in real-time across all branches'}\r\n              </p>\r\n            </div>\r\n            <div className=\"p-4 border border-gray-300\">\r\n              <h3 className=\"font-medium text-gray-900 mb-2\">\r\n                 {dict?.inventory?.lowStockAlerts || 'Low Stock Alerts'}\r\n              </h3>\r\n              <p className=\"text-sm text-gray-600\">\r\n                {dict?.inventory?.lowStockAlertsDesc || 'Get notified when products fall below threshold'}\r\n              </p>\r\n            </div>\r\n            <div className=\"p-4 border border-gray-300\">\r\n              <h3 className=\"font-medium text-gray-900 mb-2\">\r\n                 {dict?.inventory?.autoDecrement || 'Auto-decrement on Sale'}\r\n              </h3>\r\n              <p className=\"text-sm text-gray-600\">\r\n                {dict?.inventory?.autoDecrementDesc || 'Stock automatically decreases when items are sold'}\r\n              </p>\r\n            </div>\r\n            <div className=\"p-4 border border-gray-300\">\r\n              <h3 className=\"font-medium text-gray-900 mb-2\">\r\n                 {dict?.inventory?.multiBranch || 'Multi-branch Monitoring'}\r\n              </h3>\r\n              <p className=\"text-sm text-gray-600\">\r\n                {dict?.inventory?.multiBranchDesc || 'Track inventory across multiple locations'}\r\n              </p>\r\n            </div>\r\n            <div className=\"p-4 border border-gray-300\">\r\n              <h3 className=\"font-medium text-gray-900 mb-2\">\r\n                 {dict?.inventory?.itemVariations || 'Item Variations'}\r\n              </h3>\r\n              <p className=\"text-sm text-gray-600\">\r\n                {dict?.inventory?.itemVariationsDesc || 'Support for size, color, and type variations'}\r\n              </p>\r\n            </div>\r\n            <div className=\"p-4 border border-gray-300\">\r\n              <h3 className=\"font-medium text-gray-900 mb-2\">\r\n                 {dict?.inventory?.bundledProducts || 'Bundled Products'}\r\n              </h3>\r\n              <p className=\"text-sm text-gray-600\">\r\n                {dict?.inventory?.bundledProductsDesc || 'Create service + materials packages'}\r\n              </p>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\[tenant]\\[lang]\\layout-protected.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\[tenant]\\[lang]\\layout.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'headers' is defined but never used. Allowed unused vars must match /^_/u.","line":7,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'geistSans' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":9,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'geistMono' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":14,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":14,"endColumn":16}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import type { Metadata, Viewport } from \"next\";\r\nimport { Geist, Geist_Mono } from \"next/font/google\";\r\nimport \"../../globals.css\";\r\nimport LangSetter from \"@/components/LangSetter\";\r\nimport { getTenantBySlug } from \"@/lib/tenant\";\r\nimport ProtectedLayout from \"./layout-protected\";\r\nimport { headers } from \"next/headers\";\r\n\r\nconst geistSans = Geist({\r\n  variable: \"--font-geist-sans\",\r\n  subsets: [\"latin\"],\r\n});\r\n\r\nconst geistMono = Geist_Mono({\r\n  variable: \"--font-geist-mono\",\r\n  subsets: [\"latin\"],\r\n});\r\n\r\nexport const metadata: Metadata = {\r\n  title: \"POS System - Point of Sale\",\r\n  description: \"Complete POS system with product management and sales tracking\",\r\n};\r\n\r\nexport const viewport: Viewport = {\r\n  width: \"device-width\",\r\n  initialScale: 1,\r\n  maximumScale: 5,\r\n};\r\n\r\nexport async function generateStaticParams() {\r\n  return [\r\n    { tenant: 'default', lang: 'en' },\r\n    { tenant: 'default', lang: 'es' },\r\n  ];\r\n}\r\n\r\nexport default async function RootLayout({\r\n  children,\r\n  params,\r\n}: Readonly<{\r\n  children: React.ReactNode;\r\n  params: Promise<{ tenant: string; lang: string }>;\r\n}>) {\r\n  const { tenant: tenantSlug, lang } = await params;\r\n  \r\n  // If lang is \"forbidden\", it means Next.js incorrectly matched /tenant/forbidden to this route\r\n  // We need to prevent this layout from rendering and let Next.js match the forbidden.tsx route\r\n  // Use notFound() which will cause Next.js to try the next route match (forbidden.tsx)\r\n  // This prevents infinite redirect loops\r\n  if (lang === 'forbidden') {\r\n    const { notFound } = await import('next/navigation');\r\n    notFound();\r\n  }\r\n  \r\n  // Validate lang is a valid locale - if not, redirect to English\r\n  if (lang !== 'en' && lang !== 'es') {\r\n    const { redirect } = await import('next/navigation');\r\n    redirect(`/${tenantSlug}/en`);\r\n  }\r\n  \r\n  // Get tenant info for settings\r\n  const tenant = await getTenantBySlug(tenantSlug);\r\n  const tenantLang = tenant?.settings.language || lang;\r\n  \r\n  // Ensure lang is always valid\r\n  const validLang = (tenantLang === 'en' || tenantLang === 'es') ? tenantLang : 'en';\r\n  \r\n  // Use a client component to set the lang attribute to avoid hydration mismatch\r\n  return (\r\n    <>\r\n      <LangSetter lang={validLang} />\r\n      <ProtectedLayout>\r\n        {children}\r\n      </ProtectedLayout>\r\n    </>\r\n  );\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\[tenant]\\[lang]\\login\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":19,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":19,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[757,760],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[757,760],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'pin' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":23,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":23,"endColumn":13}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport { useRouter, useParams } from 'next/navigation';\r\nimport { useAuth } from '@/contexts/AuthContext';\r\nimport Link from 'next/link';\r\nimport PINInput from '@/components/PINInput';\r\nimport QRCodeScanner from '@/components/QRCodeScanner';\r\nimport { getDictionaryClient } from '../dictionaries-client';\r\n\r\ntype LoginMethod = 'email' | 'pin' | 'qr';\r\n\r\nexport default function LoginPage() {\r\n  const router = useRouter();\r\n  const params = useParams();\r\n  const tenant = (params?.tenant as string) || 'default';\r\n  const lang = (params?.lang as 'en' | 'es') || 'en';\r\n  const { login, loginPIN, loginQR, isAuthenticated, loading: authLoading } = useAuth();\r\n  const [dict, setDict] = useState<any>(null);\r\n  const [loginMethod, setLoginMethod] = useState<LoginMethod>('email');\r\n  const [email, setEmail] = useState('');\r\n  const [password, setPassword] = useState('');\r\n  const [pin, setPin] = useState('');\r\n  const [error, setError] = useState('');\r\n  const [loggingIn, setLoggingIn] = useState(false);\r\n  const [showQRScanner, setShowQRScanner] = useState(false);\r\n\r\n  useEffect(() => {\r\n    getDictionaryClient(lang).then(setDict);\r\n  }, [lang]);\r\n\r\n  useEffect(() => {\r\n    if (isAuthenticated && !authLoading) {\r\n      router.push(`/${tenant}/${lang}`);\r\n    }\r\n  }, [isAuthenticated, authLoading, router, tenant, lang]);\r\n\r\n  const handleEmailSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    setError('');\r\n    setLoggingIn(true);\r\n\r\n    if (!email || !password) {\r\n      setError(dict?.login?.enterBoth || 'Please enter both email and password');\r\n      setLoggingIn(false);\r\n      return;\r\n    }\r\n\r\n    const result = await login(email, password, tenant);\r\n    \r\n    if (result.success) {\r\n      router.push(`/${tenant}/${lang}`);\r\n    } else {\r\n      setError(result.error || dict?.login?.loginFailed || 'Login failed. Please check your credentials.');\r\n      setLoggingIn(false);\r\n    }\r\n  };\r\n\r\n  const handlePINComplete = async (enteredPin: string) => {\r\n    setError('');\r\n    setLoggingIn(true);\r\n    setPin(enteredPin);\r\n\r\n    const result = await loginPIN(enteredPin, tenant);\r\n    \r\n    if (result.success) {\r\n      router.push(`/${tenant}/${lang}`);\r\n    } else {\r\n      setError(result.error || dict?.login?.invalidPIN || 'Invalid PIN');\r\n      setLoggingIn(false);\r\n      setPin('');\r\n    }\r\n  };\r\n\r\n  const handleQRScan = async (qrToken: string) => {\r\n    setError('');\r\n    setLoggingIn(true);\r\n    setShowQRScanner(false);\r\n\r\n    const result = await loginQR(qrToken, tenant);\r\n    \r\n    if (result.success) {\r\n      router.push(`/${tenant}/${lang}`);\r\n    } else {\r\n      setError(result.error || dict?.login?.invalidQR || 'Invalid QR code');\r\n      setLoggingIn(false);\r\n    }\r\n  };\r\n\r\n  if (authLoading) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 flex items-center justify-center\">\r\n        <div className=\"text-center\">\r\n          <div className=\"inline-block animate-spin h-8 w-8 border-b-2 border-blue-600\"></div>\r\n          <p className=\"mt-4 text-gray-600\">{dict?.common?.loading || 'Loading...'}</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (isAuthenticated) {\r\n    return null; // Will redirect\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 flex items-center justify-center px-4 py-12\">\r\n      <div className=\"max-w-md w-full bg-white border border-gray-300 p-6 sm:p-8 animate-fade-in\">\r\n        <div className=\"text-center mb-8\">\r\n          <div className=\"inline-flex items-center justify-center w-16 h-16 bg-blue-600 border border-blue-700 mb-4\">\r\n            <svg className=\"w-8 h-8 text-white\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z\" />\r\n            </svg>\r\n          </div>\r\n          <h1 className=\"text-3xl sm:text-4xl font-bold text-gray-900 mb-2\">{dict?.login?.title || 'Staff Login'}</h1>\r\n          <p className=\"text-gray-600 text-sm sm:text-base\">{dict?.login?.subtitle || 'Choose your login method'}</p>\r\n        </div>\r\n\r\n        {/* Login Method Tabs */}\r\n        <div className=\"flex gap-0 mb-6 bg-gray-100 border border-gray-300\">\r\n          <button\r\n            onClick={() => { setLoginMethod('email'); setError(''); }}\r\n            className={`flex-1 py-2 px-4 text-sm font-medium transition-all border-r border-gray-300 last:border-r-0 ${\r\n              loginMethod === 'email'\r\n                ? 'bg-white text-blue-600 border-b-2 border-b-blue-600'\r\n                : 'text-gray-600 hover:text-gray-900 hover:bg-gray-50'\r\n            }`}\r\n          >\r\n            {dict?.login?.email || 'Email'}\r\n          </button>\r\n          <button\r\n            onClick={() => { setLoginMethod('pin'); setError(''); }}\r\n            className={`flex-1 py-2 px-4 text-sm font-medium transition-all border-r border-gray-300 last:border-r-0 ${\r\n              loginMethod === 'pin'\r\n                ? 'bg-white text-blue-600 border-b-2 border-b-blue-600'\r\n                : 'text-gray-600 hover:text-gray-900 hover:bg-gray-50'\r\n            }`}\r\n          >\r\n            {dict?.login?.pin || 'PIN'}\r\n          </button>\r\n          <button\r\n            onClick={() => { setLoginMethod('qr'); setError(''); setShowQRScanner(true); }}\r\n            className={`flex-1 py-2 px-4 text-sm font-medium transition-all border-r border-gray-300 last:border-r-0 ${\r\n              loginMethod === 'qr'\r\n                ? 'bg-white text-blue-600 border-b-2 border-b-blue-600'\r\n                : 'text-gray-600 hover:text-gray-900 hover:bg-gray-50'\r\n            }`}\r\n          >\r\n            {dict?.login?.qrCode || 'QR Code'}\r\n          </button>\r\n        </div>\r\n\r\n        {error && (\r\n          <div className=\"mb-4 p-3 bg-red-50 border-2 border-red-300 text-red-700 text-sm flex items-center gap-2 animate-fade-in\">\r\n            <svg className=\"w-5 h-5 flex-shrink-0\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n            </svg>\r\n            <span>{error}</span>\r\n          </div>\r\n        )}\r\n\r\n        {/* Email Login Form */}\r\n        {loginMethod === 'email' && (\r\n          <form onSubmit={handleEmailSubmit} className=\"space-y-6\">\r\n            <div>\r\n              <label htmlFor=\"email\" className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                {dict?.login?.emailAddress || 'Email Address'}\r\n              </label>\r\n              <input\r\n                type=\"email\"\r\n                id=\"email\"\r\n                value={email}\r\n                onChange={(e) => setEmail(e.target.value)}\r\n                required\r\n                className=\"w-full px-4 py-3 border-2 border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white transition-all text-base\"\r\n                placeholder=\"admin@example.com\"\r\n                autoComplete=\"email\"\r\n                disabled={loggingIn}\r\n              />\r\n            </div>\r\n\r\n            <div>\r\n              <label htmlFor=\"password\" className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                {dict?.login?.password || 'Password'}\r\n              </label>\r\n              <input\r\n                type=\"password\"\r\n                id=\"password\"\r\n                value={password}\r\n                onChange={(e) => setPassword(e.target.value)}\r\n                required\r\n                className=\"w-full px-4 py-3 border-2 border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white transition-all text-base\"\r\n                placeholder={dict?.login?.enterPassword || 'Enter your password'}\r\n                autoComplete=\"current-password\"\r\n                disabled={loggingIn}\r\n              />\r\n            </div>\r\n\r\n            <button\r\n              type=\"submit\"\r\n              disabled={loggingIn}\r\n              className=\"w-full bg-blue-600 text-white py-3.5 font-semibold hover:bg-blue-700 active:bg-blue-800 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed text-base border border-blue-700 flex items-center justify-center gap-2\"\r\n            >\r\n              {loggingIn ? (\r\n                <>\r\n                  <div className=\"animate-spin h-5 w-5 border-b-2 border-white\"></div>\r\n                  <span>{dict?.login?.signingIn || 'Signing in...'}</span>\r\n                </>\r\n              ) : (\r\n                <>\r\n                  <svg className=\"w-5 h-5\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1\" />\r\n                  </svg>\r\n                  <span>{dict?.login?.signIn || 'Sign In'}</span>\r\n                </>\r\n              )}\r\n            </button>\r\n          </form>\r\n        )}\r\n\r\n        {/* PIN Login */}\r\n        {loginMethod === 'pin' && (\r\n          <div className=\"space-y-6\">\r\n            <div>\r\n              <label className=\"block text-sm font-medium text-gray-700 mb-4 text-center\">\r\n                {dict?.login?.enterPin || 'Enter your PIN'}\r\n              </label>\r\n              <PINInput\r\n                length={4}\r\n                onComplete={handlePINComplete}\r\n                disabled={loggingIn}\r\n                error={error}\r\n              />\r\n            </div>\r\n            {loggingIn && (\r\n              <div className=\"flex items-center justify-center gap-2 text-blue-600\">\r\n                <div className=\"animate-spin h-5 w-5 border-b-2 border-blue-600\"></div>\r\n                <span>{dict?.login?.verifyingPin || 'Verifying PIN...'}</span>\r\n              </div>\r\n            )}\r\n          </div>\r\n        )}\r\n\r\n        {/* QR Code Login */}\r\n        {loginMethod === 'qr' && (\r\n          <div className=\"space-y-4\">\r\n            <button\r\n              onClick={() => setShowQRScanner(true)}\r\n              disabled={loggingIn}\r\n              className=\"w-full bg-blue-600 text-white py-3.5 font-semibold hover:bg-blue-700 active:bg-blue-800 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed text-base border border-blue-700 flex items-center justify-center gap-2\"\r\n            >\r\n              <svg className=\"w-5 h-5\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1zm12 0h2a1 1 0 001-1V5a1 1 0 00-1-1h-2a1 1 0 00-1 1v2a1 1 0 001 1zM5 20h2a1 1 0 001-1v-2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z\" />\r\n              </svg>\r\n              <span>{dict?.login?.scanQRCode || 'Scan QR Code'}</span>\r\n            </button>\r\n            <p className=\"text-sm text-gray-600 text-center\">\r\n              {dict?.login?.scanQRDescription || 'Click the button above to scan your employee QR code'}\r\n            </p>\r\n          </div>\r\n        )}\r\n\r\n        {showQRScanner && (\r\n          <QRCodeScanner\r\n            onScan={handleQRScan}\r\n            onClose={() => setShowQRScanner(false)}\r\n            enabled={showQRScanner}\r\n          />\r\n        )}\r\n\r\n        <div className=\"mt-6 pt-6 border-t border-gray-200 text-center\">\r\n          <Link\r\n            href=\"/login\"\r\n            className=\"text-sm text-blue-600 hover:text-blue-800 font-medium\"\r\n          >\r\n            {dict?.login?.switchStore || 'Switch to different store'}\r\n          </Link>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\[tenant]\\[lang]\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'router' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":43,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":43,"endColumn":15},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":49,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":49,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1654,1657],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1654,1657],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchStats'. Either include it or remove the dependency array.","line":71,"column":6,"nodeType":"ArrayExpression","endLine":71,"endColumn":22,"suggestions":[{"desc":"Update the dependencies array to be: [fetchStats, period, tenant]","fix":{"range":[2440,2456],"text":"[fetchStats, period, tenant]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":102,"column":75,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":102,"endColumn":78,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3623,3626],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3623,3626],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useEffect, useState } from 'react';\r\nimport dynamic from 'next/dynamic';\r\nimport Navbar from '@/components/Navbar';\r\nimport Currency from '@/components/Currency';\r\nimport PageTitle from '@/components/PageTitle';\r\nimport { useParams, useRouter } from 'next/navigation';\r\nimport { getDictionaryClient } from './dictionaries-client';\r\nimport { handleApiResponse } from '@/lib/api-client';\r\n\r\n// Dynamically import chart to avoid SSR issues with Recharts\r\nconst SalesChart = dynamic(() => import('@/components/SalesChart'), {\r\n  ssr: false,\r\n  loading: () => (\r\n    <div className=\"w-full h-64 sm:h-80 lg:h-96 flex items-center justify-center\">\r\n      <div className=\"text-center\">\r\n        <div className=\"inline-block animate-spin h-8 w-8 border-b-2 border-blue-600\"></div>\r\n        <p className=\"mt-4 text-gray-600\">Loading chart...</p>\r\n      </div>\r\n    </div>\r\n  ),\r\n});\r\n\r\ninterface ChartDataPoint {\r\n  date: string;\r\n  sales: number;\r\n  transactions: number;\r\n}\r\n\r\ninterface Stats {\r\n  totalSales: number;\r\n  totalTransactions: number;\r\n  averageTransaction: number;\r\n  totalExpenses: number;\r\n  expenseCount: number;\r\n  paymentMethods: Array<{ _id: string; total: number; count: number }>;\r\n  chartData: ChartDataPoint[];\r\n}\r\n\r\nexport default function Dashboard() {\r\n  const params = useParams();\r\n  const router = useRouter();\r\n  const tenant = params.tenant as string;\r\n  const lang = params.lang as 'en' | 'es' | 'forbidden';\r\n  const [stats, setStats] = useState<Stats | null>(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [period, setPeriod] = useState('today');\r\n  const [dict, setDict] = useState<any>(null);\r\n  \r\n  // If lang is \"forbidden\", this route was incorrectly matched\r\n  // Redirect to the forbidden page using hard redirect to prevent loops\r\n  useEffect(() => {\r\n    if (lang === 'forbidden' && typeof window !== 'undefined') {\r\n      const currentPath = window.location.pathname;\r\n      const targetPath = `/${tenant}/forbidden`;\r\n      // Only redirect if we're not already on the forbidden page\r\n      if (!currentPath.includes('/forbidden') && currentPath !== targetPath) {\r\n        // Use hard redirect to prevent Next.js from matching the route again\r\n        window.location.href = targetPath;\r\n      }\r\n    }\r\n  }, [lang, tenant]);\r\n\r\n  useEffect(() => {\r\n    getDictionaryClient(lang).then(setDict);\r\n  }, [lang]);\r\n\r\n  useEffect(() => {\r\n    fetchStats();\r\n  }, [period, tenant]);\r\n  \r\n  // Don't render if lang is \"forbidden\" (will redirect)\r\n  if (lang === 'forbidden') {\r\n    return (\r\n      <div className=\"min-h-screen bg-gray-50 flex items-center justify-center\">\r\n        <div className=\"text-center\">\r\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4\"></div>\r\n          <p className=\"text-gray-600\">Redirecting...</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  const fetchStats = async () => {\r\n    // Don't fetch if we're already on the forbidden page\r\n    if (typeof window !== 'undefined' && window.location.pathname.includes('/forbidden')) {\r\n      return;\r\n    }\r\n    \r\n    try {\r\n      setLoading(true);\r\n      const res = await fetch(`/api/transactions/stats?period=${period}&tenant=${tenant}`);\r\n      \r\n      // Handle API response (automatically redirects on 403)\r\n      const data = await handleApiResponse(res, {\r\n        defaultRedirect: `/${tenant}/forbidden`\r\n      });\r\n      \r\n      if (data.success && data.data) {\r\n        // Ensure chartData is properly formatted with numeric values\r\n        const processedChartData = (data.data.chartData || []).map((item: any) => {\r\n          const salesValue = typeof item.sales === 'number' ? item.sales : parseFloat(String(item.sales)) || 0;\r\n          const transactionsValue = typeof item.transactions === 'number' ? item.transactions : parseInt(String(item.transactions)) || 0;\r\n          return {\r\n            date: item.date || '',\r\n            sales: salesValue,\r\n            transactions: transactionsValue,\r\n          };\r\n        });\r\n        \r\n        const processedData = {\r\n          ...data.data,\r\n          chartData: processedChartData,\r\n        };\r\n        \r\n        setStats(processedData);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error fetching stats:', error);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  if (!dict) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gray-50 flex items-center justify-center\">\r\n        <div className=\"text-center\">\r\n          <div className=\"inline-block animate-spin h-8 w-8 border-b-2 border-blue-600\"></div>\r\n          <p className=\"mt-4 text-gray-600\">{dict?.common?.loading || 'Loading...'}</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50\">\r\n      <PageTitle />\r\n      <Navbar />\r\n      <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 sm:py-8\">\r\n        <div className=\"mb-6 sm:mb-8\">\r\n          <h1 className=\"text-2xl sm:text-3xl lg:text-4xl font-bold text-gray-900 mb-4 sm:mb-6\">\r\n            {dict.dashboard.title}\r\n          </h1>\r\n          {/* Period buttons - Full width on mobile, inline on desktop */}\r\n          <div className=\"flex flex-wrap gap-0\">\r\n            {(['today', 'week', 'month', 'all'] as const).map((p) => (\r\n              <button\r\n                key={p}\r\n                type=\"button\"\r\n                onClick={() => setPeriod(p)}\r\n                className={`px-4 py-2.5 sm:px-5 text-sm sm:text-base font-semibold transition-all duration-200 border border-gray-300 border-r-0 last:border-r ${\r\n                  period === p\r\n                    ? 'text-white bg-blue-600'\r\n                    : 'bg-white text-gray-700 hover:bg-gray-100 active:bg-gray-200'\r\n                }`}\r\n              >\r\n                {dict.dashboard.periods[p]}\r\n              </button>\r\n            ))}\r\n          </div>\r\n        </div>\r\n\r\n        {loading ? (\r\n          <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 sm:gap-6 mb-6 sm:mb-8\">\r\n            {[1, 2, 3, 4].map((i) => (\r\n              <div key={i} className=\"bg-white border border-gray-300 p-5 sm:p-6 animate-pulse\">\r\n                <div className=\"h-4 bg-gray-200 w-24 mb-4\"></div>\r\n                <div className=\"h-10 bg-gray-200 w-32\"></div>\r\n              </div>\r\n            ))}\r\n          </div>\r\n        ) : stats ? (\r\n          <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 sm:gap-6 mb-6 sm:mb-8\">\r\n            <div className=\"bg-white border border-gray-300 p-5 sm:p-6 card-hover animate-fade-in\">\r\n              <div className=\"flex items-center justify-between mb-4\">\r\n                <h3 className=\"text-xs sm:text-sm font-semibold text-gray-500 uppercase tracking-wide\">\r\n                  {dict.dashboard.totalSales}\r\n                </h3>\r\n                <div className=\"p-2 bg-green-100 border border-green-300\">\r\n                  <svg className=\"w-5 h-5 sm:w-6 sm:h-6 text-green-600\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n                  </svg>\r\n                </div>\r\n              </div>\r\n              <p className=\"text-3xl sm:text-4xl lg:text-5xl font-bold text-gray-900\">\r\n                <Currency amount={stats.totalSales} />\r\n              </p>\r\n            </div>\r\n            <div className=\"bg-white border border-gray-300 p-5 sm:p-6 card-hover animate-fade-in\">\r\n              <div className=\"flex items-center justify-between mb-4\">\r\n                <h3 className=\"text-xs sm:text-sm font-semibold text-gray-500 uppercase tracking-wide\">\r\n                  {dict.dashboard.totalTransactions}\r\n                </h3>\r\n                <div className=\"p-2 bg-blue-100 border border-blue-300\">\r\n                  <svg className=\"w-5 h-5 sm:w-6 sm:h-6 text-blue-600\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2\" />\r\n                  </svg>\r\n                </div>\r\n              </div>\r\n              <p className=\"text-3xl sm:text-4xl lg:text-5xl font-bold text-gray-900\">\r\n                {stats.totalTransactions}\r\n              </p>\r\n            </div>\r\n            <div className=\"bg-white border border-gray-300 p-5 sm:p-6 card-hover animate-fade-in\">\r\n              <div className=\"flex items-center justify-between mb-4\">\r\n                <h3 className=\"text-xs sm:text-sm font-semibold text-gray-500 uppercase tracking-wide\">\r\n                  {dict.dashboard.averageTransaction}\r\n                </h3>\r\n                <div className=\"p-2 bg-purple-100 border border-purple-300\">\r\n                  <svg className=\"w-5 h-5 sm:w-6 sm:h-6 text-purple-600\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M13 7h8m0 0v8m0-8l-8 8-4-4-6 6\" />\r\n                  </svg>\r\n                </div>\r\n              </div>\r\n              <p className=\"text-3xl sm:text-4xl lg:text-5xl font-bold text-gray-900\">\r\n                <Currency amount={stats.averageTransaction} />\r\n              </p>\r\n            </div>\r\n            <div className=\"bg-white border border-gray-300 p-5 sm:p-6 card-hover animate-fade-in\">\r\n              <div className=\"flex items-center justify-between mb-4\">\r\n                <h3 className=\"text-xs sm:text-sm font-semibold text-gray-500 uppercase tracking-wide\">\r\n                  {dict.dashboard?.totalExpenses || 'Total Expenses'}\r\n                </h3>\r\n                <div className=\"p-2 bg-red-100 border border-red-300\">\r\n                  <svg className=\"w-5 h-5 sm:w-6 sm:h-6 text-red-600\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z\" />\r\n                  </svg>\r\n                </div>\r\n              </div>\r\n              <p className=\"text-3xl sm:text-4xl lg:text-5xl font-bold text-gray-900\">\r\n                <Currency amount={stats.totalExpenses || 0} />\r\n              </p>\r\n              {stats.expenseCount > 0 && (\r\n                <p className=\"text-sm text-gray-500 mt-2\">\r\n                  {stats.expenseCount} {stats.expenseCount === 1 ? (dict.dashboard?.expense || 'expense') : (dict.dashboard?.expenses || 'expenses')}\r\n                </p>\r\n              )}\r\n            </div>\r\n          </div>\r\n        ) : null}\r\n\r\n        {stats && (\r\n          <div className=\"bg-white border border-gray-300 p-5 sm:p-6 lg:p-8 mb-6 sm:mb-8 animate-fade-in\">\r\n            <h2 className=\"text-xl sm:text-2xl font-bold text-gray-900 mb-5 sm:mb-6\">\r\n              {dict.dashboard.salesTrend || 'Sales Trend'}\r\n            </h2>\r\n            {stats.chartData && stats.chartData.length > 0 ? (\r\n              <SalesChart data={stats.chartData} dict={dict} />\r\n            ) : (\r\n              <div className=\"w-full h-64 sm:h-80 lg:h-96 flex items-center justify-center\">\r\n                <div className=\"text-center\">\r\n                  <svg className=\"mx-auto h-16 w-16 text-gray-300 mb-4\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z\" />\r\n                  </svg>\r\n                  <p className=\"text-gray-500 text-lg\">{dict?.dashboard?.noChartData || 'No sales data available for the selected period'}</p>\r\n                </div>\r\n              </div>\r\n            )}\r\n          </div>\r\n        )}\r\n\r\n        {stats && stats.paymentMethods.length > 0 && (\r\n          <div className=\"bg-white border border-gray-300 p-5 sm:p-6 lg:p-8 animate-fade-in\">\r\n            <h2 className=\"text-xl sm:text-2xl font-bold text-gray-900 mb-5 sm:mb-6\">{dict.dashboard.paymentMethods}</h2>\r\n            <div className=\"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4 sm:gap-6\">\r\n              {stats.paymentMethods.map((method, index) => (\r\n                <div \r\n                  key={method._id} \r\n                  className=\"bg-gray-50 border border-gray-300 p-5 card-hover transition-all\"\r\n                  style={{ animationDelay: `${index * 0.1}s` }}\r\n                >\r\n                  <div className=\"flex items-center justify-between mb-4\">\r\n                    <h3 className=\"text-xs sm:text-sm font-semibold text-gray-700 uppercase tracking-wide capitalize\">\r\n                      {method._id}\r\n                    </h3>\r\n                    <div className={`w-3 h-3 border border-gray-400 ${\r\n                      method._id === 'cash' ? 'bg-green-500' :\r\n                      method._id === 'card' ? 'bg-blue-500' :\r\n                      'bg-purple-500'\r\n                    }`}></div>\r\n                  </div>\r\n                  <p className=\"text-2xl sm:text-3xl lg:text-4xl font-bold text-gray-900 mb-2\">\r\n                    <Currency amount={method.total} />\r\n                  </p>\r\n                  <p className=\"text-sm text-gray-500\">\r\n                    {method.count} {dict.dashboard.transactions}\r\n                  </p>\r\n                </div>\r\n              ))}\r\n            </div>\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\[tenant]\\[lang]\\pos\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":53,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":53,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1993,1996],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1993,1996],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":61,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":61,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2533,2536],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2533,2536],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":67,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":67,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2926,2929],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2926,2929],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ConfirmDialog' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":73,"column":28,"nodeType":null,"messageId":"unusedVar","endLine":73,"endColumn":41},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":105,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":105,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4562,4565],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4562,4565],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":106,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":106,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4640,4643],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4640,4643],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":107,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":107,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4721,4724],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4721,4724],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":108,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":108,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4796,4799],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4796,4799],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":109,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":109,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4874,4877],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4874,4877],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":110,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":110,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4948,4951],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4948,4951],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":116,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":116,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5148,5151],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5148,5151],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":117,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":117,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5207,5210],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5207,5210],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":118,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":118,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5269,5272],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5269,5272],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":119,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":119,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5327,5330],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5327,5330],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":120,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":120,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5388,5391],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5388,5391],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":121,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":121,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5443,5446],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5443,5446],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":365,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":365,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13650,13653],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13650,13653],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":548,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":548,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20044,20047],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20044,20047],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":655,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":655,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[23252,23255],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[23252,23255],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":671,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":671,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[23723,23726],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[23723,23726],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":750,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":750,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[26350,26353],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[26350,26353],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":776,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":776,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[27350,27353],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[27350,27353],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1423,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1423,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[63483,63486],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[63483,63486],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":23,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useEffect, useState, useCallback } from 'react';\r\nimport Navbar from '@/components/Navbar';\r\nimport Currency from '@/components/Currency';\r\nimport OfflineIndicator from '@/components/OfflineIndicator';\r\nimport { useParams } from 'next/navigation';\r\nimport { getDictionaryClient } from '../dictionaries-client';\r\nimport { useNetworkStatus } from '@/hooks/useNetworkStatus';\r\nimport { getOfflineStorage } from '@/lib/offline-storage';\r\nimport BarcodeScanner from '@/components/BarcodeScanner';\r\nimport QRCodeScanner from '@/components/QRCodeScanner';\r\nimport HardwareStatusChecker from '@/components/HardwareStatus';\r\nimport { hardwareService } from '@/lib/hardware';\r\nimport { useTenantSettings } from '@/contexts/TenantSettingsContext';\r\nimport { showToast } from '@/lib/toast';\r\nimport { useConfirm } from '@/lib/confirm';\r\nimport { formatCurrency, getDefaultTenantSettings } from '@/lib/currency';\r\nimport { formatDateTime } from '@/lib/formatting';\r\n\r\ninterface Product {\r\n  _id: string;\r\n  name: string;\r\n  price: number;\r\n  stock: number;\r\n  sku?: string;\r\n  category?: string;\r\n  pinned?: boolean;\r\n  trackInventory?: boolean;\r\n  allowOutOfStockSales?: boolean;\r\n}\r\n\r\ninterface CartItem {\r\n  productId: string;\r\n  name: string;\r\n  price: number;\r\n  quantity: number;\r\n  stock: number;\r\n}\r\n\r\nexport default function POSPage() {\r\n  const params = useParams();\r\n  const tenant = params.tenant as string;\r\n  const lang = params.lang as 'en' | 'es';\r\n  const [products, setProducts] = useState<Product[]>([]);\r\n  const [cart, setCart] = useState<CartItem[]>([]);\r\n  const [search, setSearch] = useState('');\r\n  const [loading, setLoading] = useState(true);\r\n  const [processing, setProcessing] = useState(false);\r\n  const [paymentMethod, setPaymentMethod] = useState<'cash' | 'card' | 'digital'>('cash');\r\n  const [cashReceived, setCashReceived] = useState('');\r\n  const [showPaymentModal, setShowPaymentModal] = useState(false);\r\n  const [dict, setDict] = useState<any>(null);\r\n  const { isOnline } = useNetworkStatus(tenant);\r\n  const { settings } = useTenantSettings();\r\n  const [showQRScanner, setShowQRScanner] = useState(false);\r\n  const [promoCode, setPromoCode] = useState('');\r\n  const [appliedDiscount, setAppliedDiscount] = useState<{ code: string; amount: number; name?: string } | null>(null);\r\n  const [showRefundModal, setShowRefundModal] = useState(false);\r\n  const [refundTransactionId, setRefundTransactionId] = useState('');\r\n  const [refundTransaction, setRefundTransaction] = useState<any>(null);\r\n  const [refundItems, setRefundItems] = useState<Record<string, number>>({});\r\n  const [refundReason, setRefundReason] = useState('');\r\n  const [refundNotes, setRefundNotes] = useState('');\r\n  const [processingRefund, setProcessingRefund] = useState(false);\r\n  const [showSavedCartsModal, setShowSavedCartsModal] = useState(false);\r\n  const [savedCarts, setSavedCarts] = useState<any[]>([]);\r\n  const [loadingSavedCarts, setLoadingSavedCarts] = useState(false);\r\n  const [savingCart, setSavingCart] = useState(false);\r\n  const [showSaveCartModal, setShowSaveCartModal] = useState(false);\r\n  const [cartName, setCartName] = useState('');\r\n  const [isFullscreen, setIsFullscreen] = useState(false);\r\n  const { confirm, Dialog: ConfirmDialog } = useConfirm();\r\n\r\n  useEffect(() => {\r\n    getDictionaryClient(lang).then(setDict);\r\n  }, [lang]);\r\n\r\n  // Handle fullscreen changes\r\n  useEffect(() => {\r\n    const handleFullscreenChange = () => {\r\n      setIsFullscreen(!!document.fullscreenElement);\r\n    };\r\n\r\n    document.addEventListener('fullscreenchange', handleFullscreenChange);\r\n    document.addEventListener('webkitfullscreenchange', handleFullscreenChange);\r\n    document.addEventListener('mozfullscreenchange', handleFullscreenChange);\r\n    document.addEventListener('MSFullscreenChange', handleFullscreenChange);\r\n\r\n    return () => {\r\n      document.removeEventListener('fullscreenchange', handleFullscreenChange);\r\n      document.removeEventListener('webkitfullscreenchange', handleFullscreenChange);\r\n      document.removeEventListener('mozfullscreenchange', handleFullscreenChange);\r\n      document.removeEventListener('MSFullscreenChange', handleFullscreenChange);\r\n    };\r\n  }, []);\r\n\r\n  // Toggle fullscreen\r\n  const toggleFullscreen = async () => {\r\n    try {\r\n      if (!document.fullscreenElement) {\r\n        // Enter fullscreen\r\n        if (document.documentElement.requestFullscreen) {\r\n          await document.documentElement.requestFullscreen();\r\n        } else if ((document.documentElement as any).webkitRequestFullscreen) {\r\n          await (document.documentElement as any).webkitRequestFullscreen();\r\n        } else if ((document.documentElement as any).mozRequestFullScreen) {\r\n          await (document.documentElement as any).mozRequestFullScreen();\r\n        } else if ((document.documentElement as any).msRequestFullscreen) {\r\n          await (document.documentElement as any).msRequestFullscreen();\r\n        }\r\n      } else {\r\n        // Exit fullscreen\r\n        if (document.exitFullscreen) {\r\n          await document.exitFullscreen();\r\n        } else if ((document as any).webkitExitFullscreen) {\r\n          await (document as any).webkitExitFullscreen();\r\n        } else if ((document as any).mozCancelFullScreen) {\r\n          await (document as any).mozCancelFullScreen();\r\n        } else if ((document as any).msExitFullscreen) {\r\n          await (document as any).msExitFullscreen();\r\n        }\r\n      }\r\n    } catch (error) {\r\n      console.error('Error toggling fullscreen:', error);\r\n    }\r\n  };\r\n\r\n  // Initialize hardware services\r\n  useEffect(() => {\r\n    if (settings) {\r\n      // Load hardware config from localStorage (per-tenant)\r\n      const hardwareConfigKey = `hardware_config_${tenant}`;\r\n      const savedConfig = localStorage.getItem(hardwareConfigKey);\r\n      if (savedConfig) {\r\n        try {\r\n          const config = JSON.parse(savedConfig);\r\n          hardwareService.setConfig(config);\r\n        } catch (error) {\r\n          console.error('Failed to load hardware config:', error);\r\n        }\r\n      }\r\n    }\r\n  }, [settings, tenant]);\r\n\r\n  // Add to cart function\r\n  const addToCart = useCallback((product: Product) => {\r\n    if (!dict) return;\r\n    \r\n    // Check if product is out of stock and if sales are allowed when out of stock\r\n    const isOutOfStock = product.stock === 0;\r\n    const canSellOutOfStock = product.allowOutOfStockSales === true;\r\n    const trackInventory = product.trackInventory !== false; // Default to true if not set\r\n    \r\n    if (isOutOfStock && !canSellOutOfStock) {\r\n      showToast.error(dict.pos.outOfStock);\r\n      return;\r\n    }\r\n\r\n    setCart((prevCart) => {\r\n      const existingItem = prevCart.find((item) => item.productId === product._id);\r\n      if (existingItem) {\r\n        // If tracking inventory and not allowing out of stock sales, check stock\r\n        if (trackInventory && !canSellOutOfStock && existingItem.quantity >= product.stock) {\r\n          showToast.error(dict.pos.insufficientStock);\r\n          return prevCart;\r\n        }\r\n        return prevCart.map((item) =>\r\n          item.productId === product._id\r\n            ? { ...item, quantity: item.quantity + 1 }\r\n            : item\r\n        );\r\n      } else {\r\n        return [\r\n          ...prevCart,\r\n          {\r\n            productId: product._id,\r\n            name: product.name,\r\n            price: product.price,\r\n            quantity: 1,\r\n            stock: product.stock,\r\n          },\r\n        ];\r\n      }\r\n    });\r\n  }, [dict]);\r\n\r\n  // Handle barcode scanning\r\n  const handleBarcodeScan = useCallback((barcode: string) => {\r\n    // Try to find product by SKU or barcode\r\n    const product = products.find(\r\n      p => p.sku === barcode || p._id === barcode\r\n    );\r\n    if (product && (product.stock > 0 || product.allowOutOfStockSales)) {\r\n      addToCart(product);\r\n    } else {\r\n      if (dict) {\r\n        showToast.error(dict.pos.productNotFound || 'Product not found');\r\n      }\r\n    }\r\n  }, [products, dict, addToCart]);\r\n\r\n  // Handle QR code scan\r\n  const handleQRScan = useCallback((data: string) => {\r\n    // QR codes might contain product IDs, URLs, or other data\r\n    // Try to parse as product ID first\r\n    const product = products.find(p => p._id === data);\r\n    if (product && (product.stock > 0 || product.allowOutOfStockSales)) {\r\n      addToCart(product);\r\n      setShowQRScanner(false);\r\n    }\r\n  }, [products, addToCart]);\r\n\r\n  const loadCachedProducts = useCallback(async () => {\r\n    try {\r\n      const storage = await getOfflineStorage();\r\n      const cached = await storage.getCachedProducts(tenant);\r\n      if (cached.length > 0) {\r\n        // Filter by search if provided\r\n        let filtered = cached;\r\n        if (search) {\r\n          const searchLower = search.toLowerCase();\r\n          filtered = cached.filter(\r\n            p =>\r\n              p.name.toLowerCase().includes(searchLower) ||\r\n              p.sku?.toLowerCase().includes(searchLower) ||\r\n              p.category?.toLowerCase().includes(searchLower)\r\n          );\r\n        }\r\n        setProducts(filtered);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error loading cached products:', error);\r\n    }\r\n  }, [search, tenant]);\r\n\r\n  const fetchProducts = useCallback(async () => {\r\n    try {\r\n      setLoading(true);\r\n      \r\n      if (isOnline) {\r\n        // Try to fetch from server\r\n        try {\r\n          const res = await fetch(`/api/products?search=${encodeURIComponent(search)}&tenant=${tenant}`);\r\n          const data = await res.json();\r\n          if (data.success) {\r\n            setProducts(data.data);\r\n            // Cache products for offline use\r\n            const storage = await getOfflineStorage();\r\n            await storage.cacheProducts(data.data, tenant);\r\n          }\r\n        } catch (error) {\r\n          console.error('Error fetching products from server:', error);\r\n          // Fall back to cached products\r\n          await loadCachedProducts();\r\n        }\r\n      } else {\r\n        // Load from cache when offline\r\n        await loadCachedProducts();\r\n      }\r\n    } catch (error) {\r\n      console.error('Error fetching products:', error);\r\n      // Try to load from cache as fallback\r\n      await loadCachedProducts();\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }, [search, tenant, isOnline, loadCachedProducts]);\r\n\r\n  useEffect(() => {\r\n    fetchProducts();\r\n  }, [fetchProducts]);\r\n\r\n  const updateQuantity = (productId: string, quantity: number) => {\r\n    if (!dict) return;\r\n    if (quantity <= 0) {\r\n      removeFromCart(productId);\r\n      return;\r\n    }\r\n    const item = cart.find((item) => item.productId === productId);\r\n    const product = products.find(p => p._id === productId);\r\n    const canSellOutOfStock = product?.allowOutOfStockSales === true;\r\n    const trackInventory = product?.trackInventory !== false; // Default to true if not set\r\n    \r\n    // Check stock only if tracking inventory and not allowing out of stock sales\r\n    if (item && trackInventory && !canSellOutOfStock && quantity > item.stock) {\r\n      showToast.error(dict.pos.insufficientStock);\r\n      return;\r\n    }\r\n    setCart(\r\n      cart.map((item) =>\r\n        item.productId === productId ? { ...item, quantity } : item\r\n      )\r\n    );\r\n  };\r\n\r\n  const removeFromCart = (productId: string) => {\r\n    setCart(cart.filter((item) => item.productId !== productId));\r\n  };\r\n\r\n  const getSubtotal = () => {\r\n    return cart.reduce((sum, item) => sum + item.price * item.quantity, 0);\r\n  };\r\n\r\n  const getTotal = () => {\r\n    const subtotal = getSubtotal();\r\n    const discount = appliedDiscount?.amount || 0;\r\n    return Math.max(0, subtotal - discount);\r\n  };\r\n\r\n  const applyDiscount = async () => {\r\n    if (!dict || !promoCode.trim()) return;\r\n\r\n    try {\r\n      const subtotal = getSubtotal();\r\n      const res = await fetch(`/api/discounts/validate?tenant=${tenant}`, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ code: promoCode, subtotal }),\r\n      });\r\n\r\n      const data = await res.json();\r\n      if (data.success) {\r\n        setAppliedDiscount({\r\n          code: data.data.code,\r\n          amount: data.data.discountAmount,\r\n          name: data.data.name,\r\n        });\r\n        setPromoCode('');\r\n        showToast.success(dict.pos.discountApplied || 'Discount applied successfully');\r\n      } else {\r\n        showToast.error(data.error || dict.pos.invalidDiscountCode);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error applying discount:', error);\r\n      showToast.error(dict.pos.invalidDiscountCode);\r\n    }\r\n  };\r\n\r\n  const removeDiscount = () => {\r\n    setAppliedDiscount(null);\r\n    setPromoCode('');\r\n  };\r\n\r\n  const lookupTransaction = async () => {\r\n    if (!dict || !refundTransactionId.trim()) return;\r\n\r\n    try {\r\n      const res = await fetch(`/api/transactions/${refundTransactionId}?tenant=${tenant}`);\r\n      const data = await res.json();\r\n\r\n      if (data.success) {\r\n        const transaction = data.data;\r\n        if (transaction.status === 'refunded') {\r\n          showToast.error(dict.pos.alreadyRefunded || 'This transaction has already been refunded');\r\n          return;\r\n        }\r\n        if (transaction.status !== 'completed') {\r\n          showToast.error(dict.pos.onlyCompletedRefundable || 'Only completed transactions can be refunded');\r\n          return;\r\n        }\r\n        setRefundTransaction(transaction);\r\n        // Initialize refund items with all items at full quantity\r\n        const items: Record<string, number> = {};\r\n        transaction.items.forEach((item: any) => {\r\n          items[item.product.toString()] = item.quantity;\r\n        });\r\n        setRefundItems(items);\r\n      } else {\r\n        showToast.error(data.error || dict.pos.noTransactionFound);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error looking up transaction:', error);\r\n      showToast.error(dict.pos.noTransactionFound);\r\n    }\r\n  };\r\n\r\n  const processRefund = async () => {\r\n    if (!dict || !refundTransaction) return;\r\n\r\n    const selectedItems = Object.entries(refundItems)\r\n      .filter(([_, qty]) => qty > 0)\r\n      .map(([productId, quantity]) => ({ productId, quantity }));\r\n\r\n    if (selectedItems.length === 0) {\r\n      showToast.error(dict.pos.selectAtLeastOneItem);\r\n      return;\r\n    }\r\n\r\n    setProcessingRefund(true);\r\n    try {\r\n      const res = await fetch(`/api/transactions/${refundTransaction._id}/refund?tenant=${tenant}`, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({\r\n          items: selectedItems,\r\n          reason: refundReason,\r\n          notes: refundNotes,\r\n        }),\r\n      });\r\n\r\n      const data = await res.json();\r\n      if (data.success) {\r\n        showToast.success(dict.pos.refundSuccess);\r\n        setShowRefundModal(false);\r\n        setRefundTransaction(null);\r\n        setRefundTransactionId('');\r\n        setRefundItems({});\r\n        setRefundReason('');\r\n        setRefundNotes('');\r\n        fetchProducts();\r\n      } else {\r\n        showToast.error(data.error || dict.pos.refundError);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error processing refund:', error);\r\n      showToast.error(dict.pos.refundError);\r\n    } finally {\r\n      setProcessingRefund(false);\r\n    }\r\n  };\r\n\r\n  const handleCheckout = () => {\r\n    if (!dict) return;\r\n    if (cart.length === 0) {\r\n      showToast.error(dict.pos.cartEmptyAlert);\r\n      return;\r\n    }\r\n    setShowPaymentModal(true);\r\n  };\r\n\r\n  const processPayment = async () => {\r\n    if (!dict) return;\r\n    if (paymentMethod === 'cash') {\r\n      const cash = parseFloat(cashReceived);\r\n      const total = getTotal();\r\n      if (isNaN(cash) || cash < total) {\r\n        showToast.error(dict.pos.insufficientCash);\r\n        return;\r\n      }\r\n    }\r\n\r\n    setProcessing(true);\r\n    try {\r\n      if (isOnline) {\r\n        // Try to process online\r\n        try {\r\n          const res = await fetch(`/api/transactions?tenant=${tenant}`, {\r\n            method: 'POST',\r\n            headers: { 'Content-Type': 'application/json' },\r\n            body: JSON.stringify({\r\n              items: cart.map((item) => ({\r\n                productId: item.productId,\r\n                quantity: item.quantity,\r\n              })),\r\n              paymentMethod,\r\n              cashReceived: paymentMethod === 'cash' ? parseFloat(cashReceived) : undefined,\r\n              discountCode: appliedDiscount?.code,\r\n            }),\r\n          });\r\n\r\n          const data = await res.json();\r\n            if (data.success) {\r\n            const transaction = data.data;\r\n            const tenantSettings = settings || getDefaultTenantSettings();\r\n            const totalFormatted = formatCurrency(getTotal(), tenantSettings);\r\n            \r\n            // Print receipt if configured\r\n            if (settings) {\r\n              await printReceipt(transaction);\r\n              \r\n              // Open cash drawer if cash payment\r\n              if (paymentMethod === 'cash') {\r\n                await hardwareService.openCashDrawer();\r\n              }\r\n            }\r\n            \r\n            showToast.success(`${dict.pos.transactionCompleted} ${totalFormatted}`);\r\n            setCart([]);\r\n            setShowPaymentModal(false);\r\n            setCashReceived('');\r\n            setPaymentMethod('cash');\r\n            setAppliedDiscount(null);\r\n            setPromoCode('');\r\n            fetchProducts();\r\n            return;\r\n          } else {\r\n            throw new Error(data.error || 'Failed to process transaction');\r\n          }\r\n        } catch (error) {\r\n          // If online request fails, fall through to offline save\r\n          console.error('Online transaction failed, saving offline:', error);\r\n        }\r\n      }\r\n\r\n      // Save to offline storage\r\n      const storage = await getOfflineStorage();\r\n      await storage.saveTransaction({\r\n        tenant,\r\n        items: cart.map((item) => ({\r\n          productId: item.productId,\r\n          quantity: item.quantity,\r\n        })),\r\n        paymentMethod,\r\n        cashReceived: paymentMethod === 'cash' ? parseFloat(cashReceived) : undefined,\r\n        discountCode: appliedDiscount?.code,\r\n      });\r\n\r\n      // Update local product stock (optimistic update) - only if tracking inventory\r\n      for (const item of cart) {\r\n        const product = products.find(p => p._id === item.productId);\r\n        if (product && product.trackInventory !== false) {\r\n          const newStock = product.stock - item.quantity;\r\n          setProducts(products.map(p => \r\n            p._id === item.productId ? { ...p, stock: Math.max(0, newStock) } : p\r\n          ));\r\n          // Update cache\r\n          await storage.updateProductStock(item.productId, newStock, tenant);\r\n        }\r\n      }\r\n\r\n      const tenantSettings = settings || getDefaultTenantSettings();\r\n      const totalFormatted = formatCurrency(getTotal(), tenantSettings);\r\n      \r\n      // Create transaction object for receipt printing (offline)\r\n      const subtotal = getSubtotal();\r\n      const discountAmount = appliedDiscount?.amount || 0;\r\n      const offlineTransaction = {\r\n        receiptNumber: `OFF-${Date.now()}`,\r\n        date: formatDateTime(new Date(), tenantSettings),\r\n        items: cart.map(item => ({\r\n          name: item.name,\r\n          quantity: item.quantity,\r\n          price: item.price,\r\n          subtotal: item.price * item.quantity,\r\n        })),\r\n        subtotal,\r\n        discountCode: appliedDiscount?.code,\r\n        discountAmount: discountAmount > 0 ? discountAmount : undefined,\r\n        total: getTotal(),\r\n        paymentMethod,\r\n        cashReceived: paymentMethod === 'cash' ? parseFloat(cashReceived) : undefined,\r\n        change: paymentMethod === 'cash' ? parseFloat(cashReceived) - getTotal() : undefined,\r\n      };\r\n      \r\n      // Print receipt if configured (even for offline transactions)\r\n      if (settings) {\r\n        await printReceipt(offlineTransaction as any);\r\n        \r\n        // Open cash drawer if cash payment\r\n        if (paymentMethod === 'cash') {\r\n          await hardwareService.openCashDrawer();\r\n        }\r\n      }\r\n      \r\n      const message = isOnline \r\n        ? `${dict.pos.transactionCompleted} ${totalFormatted}`\r\n        : `${dict.pos.transactionSavedOffline || 'Transaction saved offline'} ${totalFormatted}. ${dict.pos.willSyncWhenOnline || 'Will sync when connection is restored.'}`;\r\n      \r\n      showToast.success(message);\r\n      setCart([]);\r\n      setShowPaymentModal(false);\r\n      setCashReceived('');\r\n      setPaymentMethod('cash');\r\n      setAppliedDiscount(null);\r\n      setPromoCode('');\r\n      \r\n      // Refresh products if online\r\n      if (isOnline) {\r\n        fetchProducts();\r\n      }\r\n    } catch (error) {\r\n      console.error('Error processing transaction:', error);\r\n      showToast.error(dict.pos.transactionError || 'Failed to process transaction');\r\n    } finally {\r\n      setProcessing(false);\r\n    }\r\n  };\r\n\r\n  const clearCart = async () => {\r\n    if (!dict) return;\r\n    const confirmed = await confirm(\r\n      dict.pos.clearCartConfirmTitle || 'Clear Cart',\r\n      dict.pos.clearCartConfirm,\r\n      { variant: 'warning' }\r\n    );\r\n    if (confirmed) {\r\n      setCart([]);\r\n      setAppliedDiscount(null);\r\n      setPromoCode('');\r\n      showToast.success(dict.pos.cartCleared || 'Cart cleared');\r\n    }\r\n  };\r\n\r\n  const saveCart = async () => {\r\n    if (!dict || cart.length === 0) return;\r\n    if (!cartName.trim()) {\r\n      showToast.error(dict.pos?.cartNameRequired || 'Please enter a name for this cart');\r\n      return;\r\n    }\r\n\r\n    try {\r\n      setSavingCart(true);\r\n      const subtotal = getSubtotal();\r\n      const total = getTotal();\r\n\r\n      const res = await fetch('/api/saved-carts', {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        credentials: 'include',\r\n        body: JSON.stringify({\r\n          name: cartName.trim(),\r\n          items: cart,\r\n          subtotal,\r\n          discountCode: appliedDiscount?.code,\r\n          discountAmount: appliedDiscount?.amount,\r\n          total,\r\n        }),\r\n      });\r\n\r\n      const data = await res.json();\r\n      if (data.success) {\r\n        showToast.success(dict.pos?.cartSaved || 'Cart saved successfully');\r\n        setShowSaveCartModal(false);\r\n        setCartName('');\r\n        loadSavedCarts();\r\n      } else {\r\n        showToast.error(data.error || dict.pos?.saveCartError || 'Failed to save cart');\r\n      }\r\n    } catch (error) {\r\n      console.error('Error saving cart:', error);\r\n      showToast.error(dict.pos?.saveCartError || 'Failed to save cart');\r\n    } finally {\r\n      setSavingCart(false);\r\n    }\r\n  };\r\n\r\n  const loadSavedCarts = async () => {\r\n    try {\r\n      setLoadingSavedCarts(true);\r\n      const res = await fetch('/api/saved-carts', {\r\n        credentials: 'include',\r\n      });\r\n      const data = await res.json();\r\n      if (data.success) {\r\n        setSavedCarts(data.data);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error loading saved carts:', error);\r\n    } finally {\r\n      setLoadingSavedCarts(false);\r\n    }\r\n  };\r\n\r\n  const loadCart = async (savedCart: any) => {\r\n    if (!dict) return;\r\n    \r\n    if (cart.length > 0) {\r\n      const confirmed = await confirm(\r\n        dict.pos?.loadCartConfirmTitle || 'Load Saved Cart',\r\n        dict.pos?.loadCartConfirm || 'Loading a saved cart will replace your current cart. Continue?',\r\n        { variant: 'warning' }\r\n      );\r\n      if (!confirmed) {\r\n        return;\r\n      }\r\n    }\r\n\r\n    try {\r\n      // Restore cart items\r\n      const restoredCart = savedCart.items.map((item: any) => ({\r\n        productId: item.productId.toString(),\r\n        name: item.name,\r\n        price: item.price,\r\n        quantity: item.quantity,\r\n        stock: item.stock,\r\n      }));\r\n\r\n      setCart(restoredCart);\r\n      \r\n      // Restore discount if applicable\r\n      if (savedCart.discountCode && savedCart.discountAmount) {\r\n        setAppliedDiscount({\r\n          code: savedCart.discountCode,\r\n          amount: savedCart.discountAmount,\r\n        });\r\n      } else {\r\n        setAppliedDiscount(null);\r\n      }\r\n      \r\n      setPromoCode('');\r\n      setShowSavedCartsModal(false);\r\n      \r\n      // Refresh products to get current stock\r\n      fetchProducts();\r\n      showToast.success(dict.pos?.cartLoaded || 'Cart loaded successfully');\r\n    } catch (error) {\r\n      console.error('Error loading cart:', error);\r\n      showToast.error(dict.pos?.loadCartError || 'Failed to load cart');\r\n    }\r\n  };\r\n\r\n  const deleteSavedCart = async (cartId: string) => {\r\n    if (!dict) return;\r\n    const confirmed = await confirm(\r\n      dict.pos?.deleteCartConfirmTitle || 'Delete Saved Cart',\r\n      dict.pos?.deleteCartConfirm || 'Are you sure you want to delete this saved cart?',\r\n      { variant: 'danger' }\r\n    );\r\n    if (!confirmed) {\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const res = await fetch(`/api/saved-carts/${cartId}`, {\r\n        method: 'DELETE',\r\n        credentials: 'include',\r\n      });\r\n\r\n      const data = await res.json();\r\n      if (data.success) {\r\n        showToast.success(dict.pos?.cartDeleted || 'Cart deleted successfully');\r\n        loadSavedCarts();\r\n      } else {\r\n        showToast.error(data.error || dict.pos?.deleteCartError || 'Failed to delete cart');\r\n      }\r\n    } catch (error) {\r\n      console.error('Error deleting cart:', error);\r\n      showToast.error(dict.pos?.deleteCartError || 'Failed to delete cart');\r\n    }\r\n  };\r\n\r\n  const handleTogglePin = async (productId: string, currentPinned: boolean) => {\r\n    try {\r\n      // Optimistic update\r\n      const newPinnedStatus = !currentPinned;\r\n      setProducts(prev => prev.map(p => \r\n        p._id === productId ? { ...p, pinned: newPinnedStatus } : p\r\n      ));\r\n\r\n      const res = await fetch(`/api/products/${productId}/pin?tenant=${tenant}`, {\r\n        method: 'POST',\r\n        credentials: 'include',\r\n      });\r\n      const data = await res.json();\r\n      if (data.success) {\r\n        // Update cache with the new data - convert to CachedProduct format\r\n        const storage = await getOfflineStorage();\r\n        const cached = await storage.getCachedProducts(tenant);\r\n        const updatedCache = cached.map((p: any) => {\r\n          if (p._id === productId) {\r\n            return { ...p, pinned: newPinnedStatus };\r\n          }\r\n          return p;\r\n        });\r\n        // cacheProducts will add tenant and lastUpdated automatically\r\n        await storage.cacheProducts(updatedCache, tenant);\r\n      } else {\r\n        // Revert optimistic update on error\r\n        setProducts(prev => prev.map(p => \r\n          p._id === productId ? { ...p, pinned: currentPinned } : p\r\n        ));\r\n        showToast.error(data.error || dict?.common?.failedToTogglePin || 'Failed to toggle pin status');\r\n      }\r\n    } catch (error) {\r\n      // Revert optimistic update on error\r\n      setProducts(prev => prev.map(p => \r\n        p._id === productId ? { ...p, pinned: currentPinned } : p\r\n      ));\r\n      console.error('Error toggling pin:', error);\r\n      showToast.error(dict?.common?.failedToTogglePin || 'Failed to toggle pin status');\r\n    }\r\n  };\r\n\r\n  // Print receipt helper\r\n  const printReceipt = async (transaction: any) => {\r\n    if (!settings) return;\r\n\r\n    const receiptData = {\r\n      storeName: settings.companyName,\r\n      address: settings.address ? \r\n        `${settings.address.street || ''}, ${settings.address.city || ''}, ${settings.address.state || ''} ${settings.address.zipCode || ''}`.trim() : \r\n        undefined,\r\n      phone: settings.phone,\r\n      receiptNumber: transaction.receiptNumber || transaction._id?.slice(-8) || 'N/A',\r\n      date: transaction.date || formatDateTime(new Date(transaction.createdAt || Date.now()), settings || getDefaultTenantSettings()),\r\n      items: transaction.items || [],\r\n      subtotal: transaction.subtotal || transaction.total,\r\n      discountCode: transaction.discountCode,\r\n      discountAmount: transaction.discountAmount,\r\n      tax: settings.taxEnabled && settings.taxRate ? \r\n        ((transaction.subtotal || transaction.total) - (transaction.discountAmount || 0)) * (settings.taxRate / 100) : \r\n        undefined,\r\n      total: transaction.total,\r\n      paymentMethod: transaction.paymentMethod,\r\n      cashReceived: transaction.cashReceived,\r\n      change: transaction.change,\r\n      footer: settings.receiptFooter,\r\n    };\r\n\r\n    try {\r\n      await hardwareService.printReceipt(receiptData);\r\n    } catch (error) {\r\n      console.error('Failed to print receipt:', error);\r\n    }\r\n  };\r\n\r\n  if (!dict) {\r\n    return <div className=\"text-center py-12\">{dict?.common?.loading || 'Loading...'}</div>;\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen\">\r\n      <OfflineIndicator />\r\n      <BarcodeScanner onScan={handleBarcodeScan} enabled={true} />\r\n      {showQRScanner && (\r\n        <QRCodeScanner \r\n          onScan={handleQRScan} \r\n          onClose={() => setShowQRScanner(false)}\r\n          enabled={true}\r\n        />\r\n      )}\r\n      <Navbar />\r\n      <div className=\"fixed bottom-4 right-4 z-40\">\r\n        <HardwareStatusChecker compact={true} autoRefresh={true} />\r\n      </div>\r\n      <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 sm:py-8\">\r\n        {/* Mobile: Cart first (sticky at top), then products below */}\r\n        {/* Desktop: Products left, Cart right */}\r\n        <div className=\"flex flex-col lg:grid lg:grid-cols-3 gap-4 sm:gap-6\">\r\n          {/* Cart Section - Mobile: First, Desktop: Right */}\r\n          <div className=\"lg:col-span-1 order-1 lg:order-2\">\r\n            <div className=\"bg-white border border-gray-300 p-5 sm:p-6 lg:sticky lg:top-20 flex flex-col h-full max-h-[calc(100vh-6rem)]\">\r\n              <div className=\"flex justify-between items-center mb-4 pb-4 border-b border-gray-200\">\r\n                <h2 className=\"text-lg sm:text-xl font-bold text-gray-900 flex items-center gap-2\">\r\n                  <svg className=\"w-5 h-5 sm:w-6 sm:h-6 text-blue-600\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\" strokeWidth={2}>\r\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z\" />\r\n                  </svg>\r\n                  {dict.pos.cart}\r\n                  {cart.length > 0 && (\r\n                    <span className=\"ml-2 px-2.5 py-1 bg-blue-600 text-white text-xs font-bold border border-blue-700\">\r\n                      {cart.length}\r\n                    </span>\r\n                  )}\r\n                </h2>\r\n                <div className=\"flex items-center gap-1.5\">\r\n                  {cart.length > 0 && (\r\n                    <>\r\n                      <button\r\n                        onClick={() => setShowSaveCartModal(true)}\r\n                        className=\"p-2 text-green-600 hover:text-green-700 hover:bg-green-50 transition-colors\"\r\n                        title={dict.pos?.saveCart || 'Save Cart'}\r\n                      >\r\n                        <svg className=\"w-5 h-5\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\" strokeWidth={2}>\r\n                          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4\" />\r\n                        </svg>\r\n                      </button>\r\n                      <button\r\n                        onClick={clearCart}\r\n                        className=\"p-2 text-red-600 hover:text-red-700 hover:bg-red-50 transition-colors\"\r\n                        title={dict.common.clear}\r\n                      >\r\n                        <svg className=\"w-5 h-5\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\" strokeWidth={2}>\r\n                          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16\" />\r\n                        </svg>\r\n                      </button>\r\n                    </>\r\n                  )}\r\n                  <button\r\n                    onClick={() => {\r\n                      setShowSavedCartsModal(true);\r\n                      loadSavedCarts();\r\n                    }}\r\n                    className=\"p-2 text-blue-600 hover:text-blue-700 hover:bg-blue-50 transition-colors\"\r\n                    title={dict.pos?.loadCart || 'Load Saved Cart'}\r\n                  >\r\n                    <svg className=\"w-5 h-5\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\" strokeWidth={2}>\r\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12\" />\r\n                    </svg>\r\n                  </button>\r\n                </div>\r\n              </div>\r\n\r\n              {cart.length === 0 ? (\r\n                <div className=\"flex-1 flex items-center justify-center py-12 text-gray-500\">\r\n                  <div className=\"text-center\">\r\n                    <svg className=\"mx-auto h-16 w-16 text-gray-300 mb-4\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\" strokeWidth={1.5}>\r\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z\" />\r\n                    </svg>\r\n                    <p className=\"text-base font-medium\">{dict.pos.cartEmpty}</p>\r\n                  </div>\r\n                </div>\r\n              ) : (\r\n                <>\r\n                  <div className=\"flex-1 overflow-y-auto pr-2 -mr-2 space-y-3 mb-4\">\r\n                    {cart.map((item) => (\r\n                      <div key={item.productId} className=\"bg-gray-50 p-4 border border-gray-300 hover:border-gray-400 transition-colors\">\r\n                        <div className=\"flex justify-between items-start mb-3\">\r\n                          <div className=\"flex-1 min-w-0 pr-2\">\r\n                            <div className=\"font-semibold text-gray-900 text-base mb-1\">{item.name}</div>\r\n                            <div className=\"text-sm text-gray-500\">\r\n                              <Currency amount={item.price} /> {dict.pos.each}\r\n                            </div>\r\n                          </div>\r\n                          <button\r\n                            onClick={() => removeFromCart(item.productId)}\r\n                            className=\"p-1.5 text-red-600 hover:text-red-700 hover:bg-red-50 transition-colors flex-shrink-0\"\r\n                            aria-label={dict?.pos?.removeItem || 'Remove item'}\r\n                          >\r\n                            <svg className=\"w-5 h-5\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\" strokeWidth={2}>\r\n                              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M6 18L18 6M6 6l12 12\" />\r\n                            </svg>\r\n                          </button>\r\n                        </div>\r\n                        <div className=\"flex items-center justify-between gap-3\">\r\n                          <div className=\"flex items-center border-2 border-gray-300 overflow-hidden bg-white\">\r\n                            <button\r\n                              type=\"button\"\r\n                              onClick={() => updateQuantity(item.productId, item.quantity - 1)}\r\n                              className=\"px-3 py-2 hover:bg-gray-100 active:bg-gray-200 font-bold text-lg transition-colors\"\r\n                              aria-label={dict?.pos?.decreaseQuantity || 'Decrease quantity'}\r\n                            >\r\n                              \r\n                            </button>\r\n                            <span className=\"px-4 py-2 min-w-[3rem] text-center font-semibold text-base bg-white\">\r\n                              {item.quantity}\r\n                            </span>\r\n                            <button\r\n                              type=\"button\"\r\n                              onClick={() => updateQuantity(item.productId, item.quantity + 1)}\r\n                              className=\"px-3 py-2 hover:bg-gray-100 active:bg-gray-200 font-bold text-lg disabled:opacity-50 disabled:cursor-not-allowed transition-colors\"\r\n                              disabled={(() => {\r\n                                const product = products.find(p => p._id === item.productId);\r\n                                const canSellOutOfStock = product?.allowOutOfStockSales === true;\r\n                                const trackInventory = product?.trackInventory !== false;\r\n                                return trackInventory && !canSellOutOfStock && item.quantity >= item.stock;\r\n                              })()}\r\n                              aria-label={dict?.pos?.increaseQuantity || 'Increase quantity'}\r\n                            >\r\n                              +\r\n                            </button>\r\n                          </div>\r\n                          <div className=\"font-bold text-gray-900 text-lg\">\r\n                            <Currency amount={item.price * item.quantity} />\r\n                          </div>\r\n                        </div>\r\n                      </div>\r\n                    ))}\r\n                  </div>\r\n\r\n                  {/* Discount Section */}\r\n                  <div className=\"border-t border-gray-200 pt-4 mt-auto\">\r\n                    {!appliedDiscount ? (\r\n                      <div className=\"mb-4\">\r\n                        <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                          {dict.pos.promoCode}\r\n                        </label>\r\n                        <div className=\"flex gap-2 items-stretch\">\r\n                          <input\r\n                            type=\"text\"\r\n                            placeholder={dict.pos.promoCode || 'Enter promo code'}\r\n                            value={promoCode}\r\n                            onChange={(e) => setPromoCode(e.target.value.toUpperCase())}\r\n                            onKeyPress={(e) => e.key === 'Enter' && applyDiscount()}\r\n                            className=\"flex-1 min-w-0 px-4 py-3 text-base border-2 border-gray-300 focus:ring-2 focus:ring-green-500 focus:border-green-500 bg-white transition-all placeholder:text-gray-400\"\r\n                          />\r\n                          <button\r\n                            type=\"button\"\r\n                            onClick={applyDiscount}\r\n                            disabled={!promoCode.trim()}\r\n                            className=\"p-3 bg-green-600 text-white hover:bg-green-700 active:bg-green-800 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 border border-green-700 flex items-center justify-center flex-shrink-0\"\r\n                            title={dict.pos.applyDiscount || 'Apply Discount'}\r\n                          >\r\n                            <svg className=\"w-6 h-6\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\" strokeWidth={2}>\r\n                              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n                            </svg>\r\n                          </button>\r\n                        </div>\r\n                      </div>\r\n                    ) : (\r\n                      <div className=\"mb-4 p-4 bg-gradient-to-r from-green-50 to-emerald-50 border-2 border-green-300\">\r\n                        <div className=\"flex justify-between items-start\">\r\n                          <div className=\"flex-1\">\r\n                            <div className=\"flex items-center gap-2 mb-1\">\r\n                              <svg className=\"w-5 h-5 text-green-600\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\" strokeWidth={2}>\r\n                                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n                              </svg>\r\n                              <div className=\"text-sm font-bold text-green-800\">{dict.pos.discountApplied}</div>\r\n                            </div>\r\n                            <div className=\"text-sm text-green-700 font-medium ml-7\">\r\n                              {appliedDiscount.code}\r\n                              {appliedDiscount.name && (\r\n                                <span className=\"text-green-600\"> - {appliedDiscount.name}</span>\r\n                              )}\r\n                            </div>\r\n                          </div>\r\n                          <button\r\n                            type=\"button\"\r\n                            onClick={removeDiscount}\r\n                            className=\"p-2 text-red-600 hover:text-red-700 hover:bg-red-50 transition-colors flex-shrink-0\"\r\n                            title={dict.pos.removeDiscount}\r\n                          >\r\n                            <svg className=\"w-5 h-5\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\" strokeWidth={2}>\r\n                              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M6 18L18 6M6 6l12 12\" />\r\n                            </svg>\r\n                          </button>\r\n                        </div>\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n\r\n                  <div className=\"border-t border-gray-300 pt-4 mt-4 bg-gray-50 -mx-5 sm:-mx-6 px-5 sm:px-6 pb-5 sm:pb-6\">\r\n                    <div className=\"space-y-2 mb-4\">\r\n                      <div className=\"flex justify-between items-center text-sm\">\r\n                        <span className=\"text-gray-600\">{dict.pos.subtotal}:</span>\r\n                        <span className=\"font-semibold text-gray-900\">\r\n                          <Currency amount={getSubtotal()} />\r\n                        </span>\r\n                      </div>\r\n                      {appliedDiscount && (\r\n                        <div className=\"flex justify-between items-center text-sm\">\r\n                          <span className=\"text-gray-600\">{dict.pos.discount}:</span>\r\n                          <span className=\"font-semibold text-green-600\">\r\n                            -<Currency amount={appliedDiscount.amount} />\r\n                          </span>\r\n                        </div>\r\n                      )}\r\n                    </div>\r\n                    <div className=\"flex justify-between items-center mb-4 pt-3 border-t-2 border-gray-300\">\r\n                      <span className=\"text-lg sm:text-xl font-bold text-gray-900\">{dict.common.total}:</span>\r\n                      <span className=\"text-2xl sm:text-3xl font-bold text-blue-600\">\r\n                        <Currency amount={getTotal()} />\r\n                      </span>\r\n                    </div>\r\n                    <button\r\n                      type=\"button\"\r\n                      onClick={handleCheckout}\r\n                      disabled={processing}\r\n                      className=\"w-full bg-blue-600 text-white py-4 font-bold hover:bg-blue-700 active:bg-blue-800 transition-all duration-200 text-lg border border-blue-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2\"\r\n                    >\r\n                      {processing ? (\r\n                        <>\r\n                          <div className=\"animate-spin h-6 w-6 border-b-2 border-white\"></div>\r\n                          <span>Processing...</span>\r\n                        </>\r\n                      ) : (\r\n                        <>\r\n                          <svg className=\"w-5 h-5 sm:w-6 sm:h-6\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\" strokeWidth={2}>\r\n                            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n                          </svg>\r\n                          {dict.pos.checkout}\r\n                        </>\r\n                      )}\r\n                    </button>\r\n                  </div>\r\n                </>\r\n              )}\r\n            </div>\r\n          </div>\r\n          \r\n          {/* Products Section - Mobile: Second, Desktop: Left */}\r\n          <div className=\"lg:col-span-2 order-2 lg:order-1\">\r\n            <div className=\"mb-6 sm:mb-8\">\r\n              <h1 className=\"text-2xl sm:text-3xl lg:text-4xl font-bold text-gray-900 mb-4 sm:mb-6\">{dict.pos.title}</h1>\r\n              <div className=\"flex gap-2\">\r\n                <div className=\"relative flex-1\">\r\n                  <input\r\n                    type=\"text\"\r\n                    placeholder={dict.pos.searchPlaceholder}\r\n                    value={search}\r\n                    onChange={(e) => setSearch(e.target.value)}\r\n                    className=\"w-full px-4 py-3 pl-11 text-base border-2 border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white transition-all\"\r\n                  />\r\n                  <svg className=\"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z\" />\r\n                  </svg>\r\n                </div>\r\n                <button\r\n                  onClick={() => setShowQRScanner(true)}\r\n                  className=\"px-4 py-3 bg-blue-600 text-white hover:bg-blue-700 transition-colors border border-blue-700\"\r\n                  title=\"Scan QR Code\"\r\n                >\r\n                  <svg className=\"w-5 h-5\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1zm12 0h2a1 1 0 001-1V5a1 1 0 00-1-1h-2a1 1 0 00-1 1v2a1 1 0 001 1zM5 20h2a1 1 0 001-1v-2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z\" />\r\n                  </svg>\r\n                </button>\r\n                <button\r\n                  onClick={toggleFullscreen}\r\n                  className={`px-4 py-3 transition-colors border ${\r\n                    isFullscreen\r\n                      ? 'bg-green-600 text-white hover:bg-green-700 border-green-700'\r\n                      : 'bg-gray-600 text-white hover:bg-gray-700 border-gray-700'\r\n                  }`}\r\n                  title={isFullscreen ? 'Exit Fullscreen' : 'Enter Fullscreen'}\r\n                >\r\n                  {isFullscreen ? (\r\n                    <svg className=\"w-5 h-5\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6h12v12\" />\r\n                    </svg>\r\n                  ) : (\r\n                    <svg className=\"w-5 h-5\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4\" />\r\n                    </svg>\r\n                  )}\r\n                </button>\r\n                <button\r\n                  onClick={() => setShowRefundModal(true)}\r\n                  className=\"px-4 py-3 bg-red-600 text-white hover:bg-red-700 transition-colors border border-red-700\"\r\n                  title={dict.pos.refunds}\r\n                >\r\n                  <svg className=\"w-5 h-5\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6\" />\r\n                  </svg>\r\n                </button>\r\n              </div>\r\n            </div>\r\n\r\n            {loading ? (\r\n              <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4\">\r\n                {[1, 2, 3, 4, 5, 6, 7, 8, 9].map((i) => (\r\n                  <div key={i} className=\"bg-white border border-gray-300 p-5 animate-pulse\">\r\n                    <div className=\"h-6 bg-gray-200 w-3/4 mb-3\"></div>\r\n                    <div className=\"h-4 bg-gray-200 w-1/2 mb-3\"></div>\r\n                    <div className=\"h-8 bg-gray-200 w-20 mb-4\"></div>\r\n                    <div className=\"h-8 bg-gray-200 w-full\"></div>\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            ) : products.length === 0 ? (\r\n              <div className=\"text-center py-16 bg-white border border-gray-300\">\r\n                <svg className=\"mx-auto h-16 w-16 text-gray-300 mb-4\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4\" />\r\n                </svg>\r\n                <p className=\"text-gray-500 text-lg\">{dict.common.noResults}</p>\r\n              </div>\r\n            ) : (\r\n              <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4\">\r\n                {[...products]\r\n                  .sort((a, b) => {\r\n                    // Pinned products first\r\n                    if (a.pinned && !b.pinned) return -1;\r\n                    if (!a.pinned && b.pinned) return 1;\r\n                    return 0;\r\n                  })\r\n                  .map((product) => (\r\n                  <div\r\n                    key={product._id}\r\n                    className={`bg-white border border-gray-300 p-5 hover:border-gray-400 transition-all duration-200 relative ${\r\n                      product.stock === 0 && !product.allowOutOfStockSales ? 'opacity-60' : ''\r\n                    }`}\r\n                  >\r\n                    <div className=\"flex flex-col h-full\">\r\n                      <div className=\"flex-1\">\r\n                        <div className=\"flex items-start gap-2 mb-2\">\r\n                          <h3 className=\"font-semibold text-gray-900 text-lg line-clamp-2 flex-1\">\r\n                            {product.name}\r\n                          </h3>\r\n                          <button\r\n                            type=\"button\"\r\n                            onClick={(e) => {\r\n                              e.stopPropagation();\r\n                              e.preventDefault();\r\n                              handleTogglePin(product._id, product.pinned || false);\r\n                            }}\r\n                            className={`p-1.5 transition-all duration-200 flex-shrink-0 mt-0.5 flex items-center justify-center border ${\r\n                              product.pinned\r\n                                ? 'bg-amber-50 hover:bg-amber-100 text-amber-600 border-amber-300'\r\n                                : 'bg-gray-50 hover:bg-gray-100 text-gray-400 hover:text-gray-600 border-gray-300'\r\n                            }`}\r\n                            title={product.pinned ? 'Unpin Product' : 'Pin Product'}\r\n                          >\r\n                            <svg className=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                              <path d=\"M16,12V4H17V2H7V4H8V12L6,14V16H11.2V22H12.8V16H18V14L16,12M8.5,12V4H15.5V12L17.5,14H14.3V20H9.7V14H6.5L8.5,12Z\"/>\r\n                            </svg>\r\n                          </button>\r\n                        </div>\r\n                        {product.category && (\r\n                          <p className=\"text-xs text-gray-500 mb-3\">\r\n                            {product.category}\r\n                          </p>\r\n                        )}\r\n                        <div className=\"mb-3\">\r\n                          <span\r\n                            className={`inline-block text-xs font-semibold px-3 py-1.5 border ${\r\n                              product.stock > 10\r\n                                ? 'bg-green-100 text-green-800 border-green-300'\r\n                                : product.stock > 0\r\n                                ? 'bg-yellow-100 text-yellow-800 border-yellow-300'\r\n                                : 'bg-red-100 text-red-800 border-red-300'\r\n                            }`}\r\n                          >\r\n                            {product.stock} {dict.pos.inStock}\r\n                          </span>\r\n                        </div>\r\n                        <div className=\"font-bold text-blue-600 text-2xl mb-4\">\r\n                          <Currency amount={product.price} />\r\n                        </div>\r\n                      </div>\r\n                      <button\r\n                        type=\"button\"\r\n                        disabled={product.stock === 0 && !product.allowOutOfStockSales}\r\n                        onClick={() => {\r\n                          if (product.stock > 0 || product.allowOutOfStockSales) {\r\n                            addToCart(product);\r\n                          }\r\n                        }}\r\n                        className={`w-full px-4 py-3 font-medium text-sm transition-all duration-200 ${\r\n                          product.stock > 0 || product.allowOutOfStockSales\r\n                            ? 'bg-blue-600 text-white hover:bg-blue-700 border border-blue-700'\r\n                            : 'bg-gray-200 text-gray-400 cursor-not-allowed border border-gray-300'\r\n                        }`}\r\n                      >\r\n                        {product.stock > 0 || product.allowOutOfStockSales \r\n                          ? dict.common.add \r\n                          : dict.pos.outOfStock}\r\n                      </button>\r\n                    </div>\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Payment Modal */}\r\n      {showPaymentModal && (\r\n        <div \r\n          className=\"fixed inset-0 bg-gray-900/30 backdrop-blur-md z-50\"\r\n          onClick={() => {\r\n            setShowPaymentModal(false);\r\n            setCashReceived('');\r\n          }}\r\n        >\r\n          <div \r\n            className=\"absolute inset-y-0 right-0 w-full max-w-md bg-white border-l border-gray-300 flex flex-col animate-slide-in-right\"\r\n            onClick={(e) => e.stopPropagation()}\r\n          >\r\n            <div className=\"flex items-center justify-between p-5 sm:p-6 border-b border-gray-200\">\r\n              <h2 className=\"text-xl sm:text-2xl font-bold text-gray-900\">{dict.pos.payment}</h2>\r\n              <button\r\n                onClick={() => {\r\n                  setShowPaymentModal(false);\r\n                  setCashReceived('');\r\n                }}\r\n                className=\"text-gray-400 hover:text-gray-600 transition-colors\"\r\n              >\r\n                <svg className=\"w-6 h-6\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\r\n                </svg>\r\n              </button>\r\n            </div>\r\n            <div className=\"flex-1 overflow-y-auto p-5 sm:p-6\">\r\n            <div className=\"mb-5\">\r\n              <div className=\"text-lg font-semibold text-gray-900 mb-5\">\r\n                {dict.common.total}: <Currency amount={getTotal()} />\r\n              </div>\r\n              <div className=\"space-y-4\">\r\n                <div>\r\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                    {dict.pos.paymentMethod}\r\n                  </label>\r\n                  <div className=\"grid grid-cols-3 gap-2\">\r\n                    {(['cash', 'card', 'digital'] as const).map((method) => (\r\n                      <button\r\n                        key={method}\r\n                        type=\"button\"\r\n                        onClick={() => {\r\n                          setPaymentMethod(method);\r\n                          if (method !== 'cash') setCashReceived('');\r\n                        }}\r\n                        className={`px-3 sm:px-4 py-2.5 border-2 font-medium text-sm sm:text-base transition-all duration-200 ${\r\n                          paymentMethod === method\r\n                            ? 'bg-blue-600 text-white border-blue-700'\r\n                            : 'bg-white text-gray-700 border-gray-300 hover:bg-gray-100'\r\n                        }`}\r\n                      >\r\n                        {dict.pos[method]}\r\n                      </button>\r\n                    ))}\r\n                  </div>\r\n                </div>\r\n                {paymentMethod === 'cash' && (\r\n                  <div>\r\n                    <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                      {dict.pos.cashReceived}\r\n                    </label>\r\n                    <input\r\n                      type=\"number\"\r\n                      step=\"0.01\"\r\n                      value={cashReceived}\r\n                      onChange={(e) => setCashReceived(e.target.value)}\r\n                      className=\"w-full px-4 py-3 text-base border-2 border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\r\n                      placeholder=\"0.00\"\r\n                    />\r\n                    {cashReceived && parseFloat(cashReceived) >= getTotal() && (\r\n                      <div className=\"mt-2 text-sm text-green-600 font-medium\">\r\n                        {dict.pos.change}: <Currency amount={parseFloat(cashReceived) - getTotal()} />\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n                )}\r\n              </div>\r\n            </div>\r\n            <div className=\"flex flex-col sm:flex-row justify-end gap-3 mt-6\">\r\n              <button\r\n                type=\"button\"\r\n                onClick={() => {\r\n                  setShowPaymentModal(false);\r\n                  setCashReceived('');\r\n                }}\r\n                className=\"w-full sm:w-auto px-4 py-2.5 border-2 border-gray-300 text-gray-700 hover:bg-gray-100 font-medium transition-colors bg-white\"\r\n              >\r\n                {dict.common.cancel}\r\n              </button>\r\n              <button\r\n                type=\"button\"\r\n                onClick={processPayment}\r\n                disabled={processing || (paymentMethod === 'cash' && (!cashReceived || parseFloat(cashReceived) < getTotal()))}\r\n                className=\"w-full sm:w-auto px-4 py-2.5 bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed font-medium transition-colors border border-blue-700\"\r\n              >\r\n                {processing ? dict.pos.processing : dict.pos.completePayment}\r\n              </button>\r\n            </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Refund Modal */}\r\n      {showRefundModal && (\r\n        <div \r\n          className=\"fixed inset-0 bg-gray-900/30 backdrop-blur-md z-50\"\r\n          onClick={() => {\r\n            setShowRefundModal(false);\r\n            setRefundTransactionId('');\r\n            setRefundTransaction(null);\r\n            setRefundItems({});\r\n            setRefundReason('');\r\n            setRefundNotes('');\r\n          }}\r\n        >\r\n          <div \r\n            className=\"absolute inset-y-0 right-0 w-full max-w-2xl bg-white border-l border-gray-300 flex flex-col animate-slide-in-right\"\r\n            onClick={(e) => e.stopPropagation()}\r\n          >\r\n            <div className=\"flex items-center justify-between p-5 sm:p-6 border-b border-gray-200\">\r\n              <h2 className=\"text-xl sm:text-2xl font-bold text-gray-900\">{dict.pos.refundTransaction}</h2>\r\n              <button\r\n                onClick={() => {\r\n                  setShowRefundModal(false);\r\n                  setRefundTransactionId('');\r\n                  setRefundTransaction(null);\r\n                  setRefundItems({});\r\n                  setRefundReason('');\r\n                  setRefundNotes('');\r\n                }}\r\n                className=\"text-gray-400 hover:text-gray-600 transition-colors\"\r\n              >\r\n                <svg className=\"w-6 h-6\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\r\n                </svg>\r\n              </button>\r\n            </div>\r\n            <div className=\"flex-1 overflow-y-auto p-5 sm:p-6\">\r\n            \r\n            {!refundTransaction ? (\r\n              <div>\r\n                <div className=\"mb-5\">\r\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                    {dict.pos.transactionId} / {dict.pos.receiptNumber}\r\n                  </label>\r\n                  <div className=\"flex gap-2\">\r\n                    <input\r\n                      type=\"text\"\r\n                      value={refundTransactionId}\r\n                      onChange={(e) => setRefundTransactionId(e.target.value)}\r\n                      onKeyPress={(e) => e.key === 'Enter' && lookupTransaction()}\r\n                      className=\"flex-1 px-4 py-3 text-base border-2 border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\r\n                      placeholder={dict.pos.transactionId}\r\n                    />\r\n                    <button\r\n                      type=\"button\"\r\n                      onClick={lookupTransaction}\r\n                      disabled={!refundTransactionId.trim()}\r\n                      className=\"px-4 py-3 bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed font-medium transition-colors border border-blue-700\"\r\n                    >\r\n                      {dict.pos.lookupTransaction}\r\n                    </button>\r\n                  </div>\r\n                </div>\r\n                <div className=\"flex justify-end gap-3\">\r\n                  <button\r\n                    type=\"button\"\r\n                    onClick={() => {\r\n                      setShowRefundModal(false);\r\n                      setRefundTransactionId('');\r\n                    }}\r\n                    className=\"px-4 py-2.5 border-2 border-gray-300 text-gray-700 hover:bg-gray-100 font-medium transition-colors bg-white\"\r\n                  >\r\n                    {dict.common.cancel}\r\n                  </button>\r\n                </div>\r\n              </div>\r\n            ) : (\r\n              <div>\r\n                <div className=\"mb-5 p-4 bg-gray-50 border border-gray-300\">\r\n                  <div className=\"text-sm text-gray-600 mb-1\">{dict.pos.receiptNumber}</div>\r\n                  <div className=\"font-semibold text-lg\">{refundTransaction.receiptNumber || refundTransaction._id}</div>\r\n                  <div className=\"text-sm text-gray-600 mt-2\">\r\n                    {formatDateTime(new Date(refundTransaction.createdAt), settings || getDefaultTenantSettings())}\r\n                  </div>\r\n                  <div className=\"text-sm text-gray-600\">\r\n                    {dict.common.total}: <Currency amount={refundTransaction.total} />\r\n                  </div>\r\n                </div>\r\n\r\n                <div className=\"mb-5\">\r\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                    {dict.pos.selectItemsToRefund}\r\n                  </label>\r\n                  <div className=\"space-y-3 max-h-64 overflow-y-auto border border-gray-300 p-3\">\r\n                    {refundTransaction.items.map((item: any) => {\r\n                      const productId = item.product.toString();\r\n                      const maxQty = item.quantity;\r\n                      const currentQty = refundItems[productId] || 0;\r\n                      \r\n                      return (\r\n                        <div key={productId} className=\"flex items-center justify-between p-2 hover:bg-gray-50 border-b border-gray-200 last:border-b-0\">\r\n                          <div className=\"flex-1\">\r\n                            <div className=\"font-medium text-gray-900\">{item.name}</div>\r\n                            <div className=\"text-sm text-gray-500\">\r\n                              {dict.pos.each}: <Currency amount={item.price} />  {maxQty} {dict.common.items}\r\n                            </div>\r\n                          </div>\r\n                          <div className=\"flex items-center gap-2\">\r\n                            <button\r\n                              type=\"button\"\r\n                              onClick={() => setRefundItems({ ...refundItems, [productId]: Math.max(0, currentQty - 1) })}\r\n                              className=\"px-3 py-1 border border-gray-300 hover:bg-gray-100\"\r\n                            >\r\n                              \r\n                            </button>\r\n                            <input\r\n                              type=\"number\"\r\n                              min=\"0\"\r\n                              max={maxQty}\r\n                              value={currentQty}\r\n                              onChange={(e) => {\r\n                                const val = Math.max(0, Math.min(maxQty, parseInt(e.target.value) || 0));\r\n                                setRefundItems({ ...refundItems, [productId]: val });\r\n                              }}\r\n                              className=\"w-16 px-2 py-1 text-center border border-gray-300\"\r\n                            />\r\n                            <button\r\n                              type=\"button\"\r\n                              onClick={() => setRefundItems({ ...refundItems, [productId]: Math.min(maxQty, currentQty + 1) })}\r\n                              className=\"px-3 py-1 border border-gray-300 hover:bg-gray-100\"\r\n                            >\r\n                              +\r\n                            </button>\r\n                            <button\r\n                              type=\"button\"\r\n                              onClick={() => setRefundItems({ ...refundItems, [productId]: maxQty })}\r\n                              className=\"ml-2 px-2 py-1 text-xs bg-blue-100 text-blue-700 border border-blue-300 hover:bg-blue-200\"\r\n                            >\r\n                              {dict.pos.fullRefund}\r\n                            </button>\r\n                          </div>\r\n                        </div>\r\n                      );\r\n                    })}\r\n                  </div>\r\n                </div>\r\n\r\n                <div className=\"mb-5\">\r\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                    {dict.pos.refundReason}\r\n                  </label>\r\n                  <input\r\n                    type=\"text\"\r\n                    value={refundReason}\r\n                    onChange={(e) => setRefundReason(e.target.value)}\r\n                    className=\"w-full px-4 py-3 text-base border-2 border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\r\n                    placeholder={dict?.pos?.refundReasonPlaceholder || 'Reason for refund'}\r\n                  />\r\n                </div>\r\n\r\n                <div className=\"mb-5\">\r\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                    {dict.pos.refundNotes}\r\n                  </label>\r\n                  <textarea\r\n                    value={refundNotes}\r\n                    onChange={(e) => setRefundNotes(e.target.value)}\r\n                    rows={3}\r\n                    className=\"w-full px-4 py-3 text-base border-2 border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\r\n                    placeholder={dict?.pos?.refundNotesPlaceholder || 'Additional notes'}\r\n                  />\r\n                </div>\r\n\r\n                <div className=\"flex justify-end gap-3\">\r\n                  <button\r\n                    type=\"button\"\r\n                    onClick={() => {\r\n                      setShowRefundModal(false);\r\n                      setRefundTransaction(null);\r\n                      setRefundTransactionId('');\r\n                      setRefundItems({});\r\n                      setRefundReason('');\r\n                      setRefundNotes('');\r\n                    }}\r\n                    className=\"px-4 py-2.5 border-2 border-gray-300 text-gray-700 hover:bg-gray-100 font-medium transition-colors bg-white\"\r\n                  >\r\n                    {dict.common.cancel}\r\n                  </button>\r\n                  <button\r\n                    type=\"button\"\r\n                    onClick={processRefund}\r\n                    disabled={processingRefund || Object.values(refundItems).every(qty => qty === 0)}\r\n                    className=\"px-4 py-2.5 bg-red-600 text-white hover:bg-red-700 disabled:opacity-50 disabled:cursor-not-allowed font-medium transition-colors border border-red-700\"\r\n                  >\r\n                    {processingRefund ? dict.pos.processing : dict.pos.processRefund}\r\n                  </button>\r\n                </div>\r\n              </div>\r\n            )}\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Save Cart Modal */}\r\n      {showSaveCartModal && (\r\n        <div \r\n          className=\"fixed inset-0 bg-gray-900/30 backdrop-blur-md z-50\"\r\n          onClick={() => {\r\n            setShowSaveCartModal(false);\r\n            setCartName('');\r\n          }}\r\n        >\r\n          <div \r\n            className=\"absolute inset-y-0 right-0 w-full max-w-md bg-white border-l border-gray-300 flex flex-col animate-slide-in-right\"\r\n            onClick={(e) => e.stopPropagation()}\r\n          >\r\n            <div className=\"flex items-center justify-between p-5 sm:p-6 border-b border-gray-200\">\r\n              <h2 className=\"text-xl sm:text-2xl font-bold text-gray-900\">\r\n                {dict.pos?.saveCart || 'Save Cart'}\r\n              </h2>\r\n              <button\r\n                onClick={() => {\r\n                  setShowSaveCartModal(false);\r\n                  setCartName('');\r\n                }}\r\n                className=\"text-gray-400 hover:text-gray-600 transition-colors\"\r\n              >\r\n                <svg className=\"w-6 h-6\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\r\n                </svg>\r\n              </button>\r\n            </div>\r\n            <div className=\"flex-1 overflow-y-auto p-5 sm:p-6\">\r\n            <div className=\"mb-5\">\r\n              <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                {dict.pos?.cartName || 'Cart Name'}\r\n              </label>\r\n              <input\r\n                type=\"text\"\r\n                value={cartName}\r\n                onChange={(e) => setCartName(e.target.value)}\r\n                onKeyPress={(e) => e.key === 'Enter' && saveCart()}\r\n                className=\"w-full px-4 py-3 text-base border-2 border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\r\n                placeholder={dict.pos?.cartNamePlaceholder || 'Enter a name for this cart'}\r\n                autoFocus\r\n              />\r\n              <p className=\"text-sm text-gray-500 mt-2\">\r\n                {dict.pos?.cartNameHint || 'This cart will be saved for later processing'}\r\n              </p>\r\n            </div>\r\n            <div className=\"flex justify-end gap-3\">\r\n              <button\r\n                type=\"button\"\r\n                onClick={() => {\r\n                  setShowSaveCartModal(false);\r\n                  setCartName('');\r\n                }}\r\n                className=\"px-4 py-2.5 border-2 border-gray-300 text-gray-700 hover:bg-gray-100 font-medium transition-colors bg-white\"\r\n              >\r\n                {dict.common.cancel}\r\n              </button>\r\n              <button\r\n                type=\"button\"\r\n                onClick={saveCart}\r\n                disabled={savingCart || !cartName.trim()}\r\n                className=\"px-4 py-2.5 bg-green-600 text-white hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed font-medium transition-colors border border-green-700\"\r\n              >\r\n                {savingCart ? (dict.common.saving || 'Saving...') : (dict.common.save || 'Save')}\r\n              </button>\r\n            </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Load Saved Carts Modal */}\r\n      {showSavedCartsModal && (\r\n        <div \r\n          className=\"fixed inset-0 bg-gray-900/30 backdrop-blur-md z-50\"\r\n          onClick={() => setShowSavedCartsModal(false)}\r\n        >\r\n          <div \r\n            className=\"absolute inset-y-0 right-0 w-full max-w-2xl bg-white border-l border-gray-300 flex flex-col animate-slide-in-right\"\r\n            onClick={(e) => e.stopPropagation()}\r\n          >\r\n            <div className=\"flex items-center justify-between p-5 sm:p-6 border-b border-gray-200\">\r\n              <h2 className=\"text-xl sm:text-2xl font-bold text-gray-900\">\r\n                {dict.pos?.savedCarts || 'Saved Carts'}\r\n              </h2>\r\n              <button\r\n                onClick={() => setShowSavedCartsModal(false)}\r\n                className=\"text-gray-400 hover:text-gray-600 transition-colors\"\r\n              >\r\n                <svg className=\"w-6 h-6\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\r\n                </svg>\r\n              </button>\r\n            </div>\r\n            <div className=\"flex-1 overflow-y-auto p-5 sm:p-6\">\r\n\r\n            {loadingSavedCarts ? (\r\n              <div className=\"text-center py-12\">\r\n                <div className=\"inline-block animate-spin h-8 w-8 border-b-2 border-blue-600\"></div>\r\n                <p className=\"mt-4 text-gray-600\">{dict.common.loading || 'Loading...'}</p>\r\n              </div>\r\n            ) : savedCarts.length === 0 ? (\r\n              <div className=\"text-center py-12\">\r\n                <svg className=\"mx-auto h-16 w-16 text-gray-300 mb-4\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z\" />\r\n                </svg>\r\n                <p className=\"text-gray-500 text-lg\">{dict.pos?.noSavedCarts || 'No saved carts found'}</p>\r\n              </div>\r\n            ) : (\r\n              <div className=\"space-y-3\">\r\n                {savedCarts.map((savedCart) => (\r\n                  <div\r\n                    key={savedCart._id}\r\n                    className=\"border-2 border-gray-300 p-4 hover:border-blue-500 transition-colors\"\r\n                  >\r\n                    <div className=\"flex justify-between items-start mb-3\">\r\n                      <div className=\"flex-1\">\r\n                        <h3 className=\"font-semibold text-gray-900 text-lg mb-1\">{savedCart.name}</h3>\r\n                        <p className=\"text-sm text-gray-500\">\r\n                          {formatDateTime(new Date(savedCart.createdAt), settings || getDefaultTenantSettings())}\r\n                        </p>\r\n                        <p className=\"text-sm text-gray-600 mt-2\">\r\n                          {savedCart.items.length} {savedCart.items.length === 1 ? (dict.pos?.item || 'item') : (dict.pos?.items || 'items')}\r\n                        </p>\r\n                      </div>\r\n                      <div className=\"text-right\">\r\n                        <div className=\"font-bold text-lg text-blue-600 mb-2\">\r\n                          <Currency amount={savedCart.total} />\r\n                        </div>\r\n                        {savedCart.discountCode && (\r\n                          <div className=\"text-xs text-green-600\">\r\n                            {dict.pos?.discount || 'Discount'}: {savedCart.discountCode}\r\n                          </div>\r\n                        )}\r\n                      </div>\r\n                    </div>\r\n                    <div className=\"flex gap-2\">\r\n                      <button\r\n                        onClick={() => loadCart(savedCart)}\r\n                        className=\"flex-1 px-4 py-2 bg-blue-600 text-white hover:bg-blue-700 font-medium transition-colors border border-blue-700\"\r\n                      >\r\n                        {dict.pos?.loadCart || 'Load Cart'}\r\n                      </button>\r\n                      <button\r\n                        onClick={() => deleteSavedCart(savedCart._id)}\r\n                        className=\"px-4 py-2 bg-red-600 text-white hover:bg-red-700 font-medium transition-colors border border-red-700\"\r\n                        title={dict.pos?.deleteCart || 'Delete Cart'}\r\n                      >\r\n                        <svg className=\"w-5 h-5\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16\" />\r\n                        </svg>\r\n                      </button>\r\n                    </div>\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            )}\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\[tenant]\\[lang]\\products\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":40,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":40,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1536,1539],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1536,1539],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchProducts'. Either include it or remove the dependency array.","line":65,"column":6,"nodeType":"ArrayExpression","endLine":65,"endColumn":22,"suggestions":[{"desc":"Update the dependencies array to be: [fetchProducts, search, tenant]","fix":{"range":[2381,2397],"text":"[fetchProducts, search, tenant]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useEffect, useState } from 'react';\r\nimport Navbar from '@/components/Navbar';\r\nimport Currency from '@/components/Currency';\r\nimport PageTitle from '@/components/PageTitle';\r\nimport ProductModal from '@/components/ProductModal';\r\nimport StockRefillModal from '@/components/StockRefillModal';\r\nimport { useParams } from 'next/navigation';\r\nimport { getDictionaryClient } from '../dictionaries-client';\r\nimport { showToast } from '@/lib/toast';\r\nimport { useConfirm } from '@/lib/confirm';\r\nimport { useTenantSettings } from '@/contexts/TenantSettingsContext';\r\nimport { supportsFeature } from '@/lib/business-type-helpers';\r\n\r\ninterface Product {\r\n  _id: string;\r\n  name: string;\r\n  description?: string;\r\n  price: number;\r\n  stock: number;\r\n  sku?: string;\r\n  category?: string;\r\n  pinned?: boolean;\r\n  trackInventory?: boolean;\r\n  allowOutOfStockSales?: boolean;\r\n}\r\n\r\nexport default function ProductsPage() {\r\n  const params = useParams();\r\n  const tenant = params.tenant as string;\r\n  const lang = params.lang as 'en' | 'es';\r\n  const [products, setProducts] = useState<Product[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [search, setSearch] = useState('');\r\n  const [isModalOpen, setIsModalOpen] = useState(false);\r\n  const [isRefillModalOpen, setIsRefillModalOpen] = useState(false);\r\n  const [editingProduct, setEditingProduct] = useState<Product | null>(null);\r\n  const [refillingProduct, setRefillingProduct] = useState<Product | null>(null);\r\n  const [dict, setDict] = useState<any>(null);\r\n  const [displayMode, setDisplayMode] = useState<'grid' | 'list'>('grid');\r\n  const { confirm, Dialog: ConfirmDialog } = useConfirm();\r\n  const { settings } = useTenantSettings();\r\n  const inventoryEnabled = supportsFeature(settings ?? undefined, 'inventory');\r\n\r\n  useEffect(() => {\r\n    getDictionaryClient(lang).then(setDict);\r\n  }, [lang]);\r\n\r\n  // Load display mode from localStorage\r\n  useEffect(() => {\r\n    const savedDisplayMode = localStorage.getItem(`displayMode_${tenant}`);\r\n    if (savedDisplayMode === 'list' || savedDisplayMode === 'grid') {\r\n      setDisplayMode(savedDisplayMode);\r\n    }\r\n  }, [tenant]);\r\n\r\n  // Save display mode to localStorage\r\n  useEffect(() => {\r\n    localStorage.setItem(`displayMode_${tenant}`, displayMode);\r\n  }, [displayMode, tenant]);\r\n\r\n  useEffect(() => {\r\n    fetchProducts();\r\n  }, [search, tenant]);\r\n\r\n  // Sort products: pinned first, then by creation date\r\n  const sortedProducts = [...products].sort((a, b) => {\r\n    if (a.pinned && !b.pinned) return -1;\r\n    if (!a.pinned && b.pinned) return 1;\r\n    return 0;\r\n  });\r\n\r\n  const fetchProducts = async () => {\r\n    try {\r\n      setLoading(true);\r\n      const res = await fetch(`/api/products?search=${encodeURIComponent(search)}&tenant=${tenant}`);\r\n      const data = await res.json();\r\n      if (data.success) {\r\n        setProducts(data.data);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error fetching products:', error);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleDelete = async (id: string) => {\r\n    if (!dict) return;\r\n    const confirmed = await confirm(\r\n      dict.products.deleteConfirmTitle || 'Delete Product',\r\n      dict.products.deleteConfirm,\r\n      { variant: 'danger' }\r\n    );\r\n    if (!confirmed) return;\r\n\r\n    try {\r\n      const res = await fetch(`/api/products/${id}?tenant=${tenant}`, { method: 'DELETE' });\r\n      const data = await res.json();\r\n      if (data.success) {\r\n        showToast.success(dict.products.productDeleted || 'Product deleted successfully');\r\n        fetchProducts();\r\n      } else {\r\n        showToast.error(data.error || dict.products.deleteError);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error deleting product:', error);\r\n      showToast.error(dict.products.deleteError);\r\n    }\r\n  };\r\n\r\n  const handleEdit = async (product: Product) => {\r\n    try {\r\n      // Fetch the full product to ensure all fields are included\r\n      const res = await fetch(`/api/products/${product._id}?tenant=${tenant}`);\r\n      const data = await res.json();\r\n      if (data.success) {\r\n        setEditingProduct(data.data);\r\n        setIsModalOpen(true);\r\n      } else {\r\n        // Fallback to the product from list if fetch fails\r\n        setEditingProduct(product);\r\n        setIsModalOpen(true);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error fetching product:', error);\r\n      // Fallback to the product from list if fetch fails\r\n      setEditingProduct(product);\r\n      setIsModalOpen(true);\r\n    }\r\n  };\r\n\r\n  const handleCloseModal = () => {\r\n    setIsModalOpen(false);\r\n    setEditingProduct(null);\r\n    fetchProducts();\r\n  };\r\n\r\n  const handleRefill = (product: Product) => {\r\n    setRefillingProduct(product);\r\n    setIsRefillModalOpen(true);\r\n  };\r\n\r\n  const handleCloseRefillModal = () => {\r\n    setIsRefillModalOpen(false);\r\n    setRefillingProduct(null);\r\n  };\r\n\r\n  const handleRefillSuccess = () => {\r\n    fetchProducts();\r\n  };\r\n\r\n  if (!dict) {\r\n    return <div className=\"text-center py-12\">{dict?.common?.loading || 'Loading...'}</div>;\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50\">\r\n      {ConfirmDialog}\r\n      <PageTitle />\r\n      <Navbar />\r\n      <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 sm:py-8\">\r\n        <div className=\"mb-6 sm:mb-8 flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4\">\r\n          <h1 className=\"text-2xl sm:text-3xl lg:text-4xl font-bold text-gray-900\">{dict.products.title}</h1>\r\n          <button\r\n            onClick={() => setIsModalOpen(true)}\r\n            className=\"w-full sm:w-auto bg-blue-600 text-white px-5 py-2.5 hover:bg-blue-700 font-semibold transition-all duration-200 border border-blue-700 flex items-center justify-center gap-2\"\r\n          >\r\n            <svg className=\"w-5 h-5\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 4v16m8-8H4\" />\r\n            </svg>\r\n            {dict.products.addProduct}\r\n          </button>\r\n        </div>\r\n\r\n        <div className=\"mb-6 flex flex-col sm:flex-row gap-3 sm:gap-4 items-stretch sm:items-center\">\r\n          <div className=\"relative flex-1 max-w-md\">\r\n            <input\r\n              type=\"text\"\r\n              placeholder={dict.products.searchPlaceholder}\r\n              value={search}\r\n              onChange={(e) => setSearch(e.target.value)}\r\n              className=\"w-full px-4 py-3 pl-11 text-base border-2 border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white transition-all\"\r\n            />\r\n            <svg className=\"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z\" />\r\n            </svg>\r\n          </div>\r\n          {/* Display Mode Toggle */}\r\n          <div className=\"flex gap-2\">\r\n            <button\r\n              onClick={() => setDisplayMode('grid')}\r\n              className={`px-4 py-3 bg-white border-2 transition-all duration-200 flex items-center justify-center gap-2 text-sm font-medium ${\r\n                displayMode === 'grid'\r\n                  ? 'border-blue-600 bg-blue-50 text-blue-700'\r\n                  : 'border-gray-300 text-gray-700 hover:bg-gray-100 hover:border-blue-500'\r\n              }`}\r\n              title={dict?.common?.gridView || 'Grid View'}\r\n              aria-label={dict?.common?.gridView || 'Grid View'}\r\n            >\r\n              <svg className=\"w-5 h-5\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\" strokeWidth={2}>\r\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z\" />\r\n              </svg>\r\n              <span className=\"hidden sm:inline\">{dict?.common?.gridView || 'Grid'}</span>\r\n            </button>\r\n            <button\r\n              onClick={() => setDisplayMode('list')}\r\n              className={`px-4 py-3 bg-white border-2 transition-all duration-200 flex items-center justify-center gap-2 text-sm font-medium ${\r\n                displayMode === 'list'\r\n                  ? 'border-blue-600 bg-blue-50 text-blue-700'\r\n                  : 'border-gray-300 text-gray-700 hover:bg-gray-100 hover:border-blue-500'\r\n              }`}\r\n              title={dict?.common?.listView || 'List View'}\r\n              aria-label={dict?.common?.listView || 'List View'}\r\n            >\r\n              <svg className=\"w-5 h-5\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\" strokeWidth={2}>\r\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M4 6h16M4 12h16M4 18h16\" />\r\n              </svg>\r\n              <span className=\"hidden sm:inline\">List</span>\r\n            </button>\r\n          </div>\r\n        </div>\r\n\r\n        {loading ? (\r\n          displayMode === 'grid' ? (\r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6\">\r\n              {[1, 2, 3, 4, 5, 6].map((i) => (\r\n                <div key={i} className=\"bg-white border border-gray-300 rounded-lg p-4 sm:p-5 animate-pulse\">\r\n                  <div className=\"h-6 bg-gray-200 w-3/4 mb-3\"></div>\r\n                  <div className=\"h-4 bg-gray-200 w-full mb-2\"></div>\r\n                  <div className=\"h-4 bg-gray-200 w-2/3 mb-4\"></div>\r\n                  <div className=\"border-t border-gray-200 pt-4 mt-auto\">\r\n                    <div className=\"flex justify-between mb-4\">\r\n                      <div className=\"h-5 bg-gray-200 w-20\"></div>\r\n                      <div className=\"h-6 bg-gray-200 w-16\"></div>\r\n                    </div>\r\n                    <div className=\"flex gap-2\">\r\n                      <div className=\"h-10 bg-gray-200 flex-1\"></div>\r\n                      <div className=\"h-10 bg-gray-200 flex-1\"></div>\r\n                      <div className=\"h-10 bg-gray-200 flex-1\"></div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              ))}\r\n            </div>\r\n          ) : (\r\n            <div className=\"bg-white border border-gray-300 divide-y divide-gray-300\">\r\n              {[1, 2, 3, 4, 5, 6].map((i) => (\r\n                <div key={i} className=\"p-4 sm:p-6 animate-pulse\">\r\n                  <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4\">\r\n                    <div className=\"flex-1\">\r\n                      <div className=\"h-6 bg-gray-200 w-1/3 mb-2\"></div>\r\n                      <div className=\"h-4 bg-gray-200 w-1/2 mb-2\"></div>\r\n                      <div className=\"flex gap-4\">\r\n                        <div className=\"h-4 bg-gray-200 w-20\"></div>\r\n                        <div className=\"h-4 bg-gray-200 w-24\"></div>\r\n                      </div>\r\n                    </div>\r\n                    <div className=\"flex items-center gap-4\">\r\n                      <div className=\"h-5 bg-gray-200 w-20\"></div>\r\n                      <div className=\"h-6 bg-gray-200 w-16\"></div>\r\n                      <div className=\"flex gap-2\">\r\n                        <div className=\"h-9 bg-gray-200 w-9\"></div>\r\n                        <div className=\"h-9 bg-gray-200 w-9\"></div>\r\n                        <div className=\"h-9 bg-gray-200 w-9\"></div>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              ))}\r\n            </div>\r\n          )\r\n        ) : products.length === 0 ? (\r\n          <div className=\"text-center py-16 bg-white border border-gray-300\">\r\n            <svg className=\"mx-auto h-16 w-16 text-gray-300 mb-4\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4\" />\r\n            </svg>\r\n            <p className=\"text-gray-500 text-lg\">{dict.common.noResults}</p>\r\n          </div>\r\n        ) : displayMode === 'grid' ? (\r\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6\">\r\n            {sortedProducts.map((product) => (\r\n              <div\r\n                key={product._id}\r\n                className=\"group relative bg-white border border-gray-300 rounded-lg p-4 sm:p-5 hover:shadow-lg hover:border-blue-300 transition-all duration-200 flex flex-col\"\r\n              >\r\n                {/* Header Section */}\r\n                <div className=\"flex-1 mb-4\">\r\n                  {/* Name and Pinned Indicator */}\r\n                  <div className=\"flex items-start justify-between mb-2\">\r\n                    <h3 className=\"font-semibold text-gray-900 text-lg sm:text-xl pr-2 flex-1\">\r\n                      {product.name}\r\n                      {product.pinned && (\r\n                        <svg className=\"inline-block w-4 h-4 ml-2 text-blue-600\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n                          <path d=\"M10 2a1 1 0 011 1v1.323l3.954 1.582 1.599-.8a1 1 0 01.894 1.79l-1.233.616 1.738 5.42a1 1 0 01-.285 1.05A3.989 3.989 0 0115 15a3.989 3.989 0 01-2.667-1.019 1 1 0 01-.285-1.05l1.715-5.349L11 6.477V16a1 1 0 11-2 0V6.477L5.237 7.582l1.715 5.349a1 1 0 01-.285 1.05A3.989 3.989 0 013 15a3.989 3.989 0 01-2.667-1.019 1 1 0 01-.285-1.05l1.738-5.42-1.233-.617a1 1 0 01.894-1.788l1.599.799L9 4.323V3a1 1 0 011-1z\" />\r\n                        </svg>\r\n                      )}\r\n                    </h3>\r\n                  </div>\r\n\r\n                  {/* Description */}\r\n                  {product.description && (\r\n                    <p className=\"text-sm text-gray-500 mb-3 line-clamp-2\">\r\n                      {product.description}\r\n                    </p>\r\n                  )}\r\n\r\n                  {/* Metadata Row */}\r\n                  <div className=\"flex flex-wrap gap-3 mb-3 text-xs sm:text-sm text-gray-600\">\r\n                    {product.sku && (\r\n                      <div className=\"flex items-center gap-1\">\r\n                        <span className=\"font-medium\">{dict.products.sku}:</span>\r\n                        <span>{product.sku}</span>\r\n                      </div>\r\n                    )}\r\n                    {product.category && (\r\n                      <div className=\"flex items-center gap-1\">\r\n                        <span className=\"font-medium\">{dict.products.category}:</span>\r\n                        <span className=\"px-2 py-0.5 bg-gray-100 rounded border border-gray-300\">\r\n                          {product.category}\r\n                        </span>\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Footer Section */}\r\n                <div className=\"border-t border-gray-200 pt-4 mt-auto\">\r\n                  <div className=\"flex items-center justify-between mb-4\">\r\n                    {/* Price */}\r\n                    <div>\r\n                      <div className=\"text-xs text-gray-500 mb-1\">{dict.products.price}</div>\r\n                      <div className=\"font-bold text-blue-600 text-xl sm:text-2xl\">\r\n                        <Currency amount={product.price} />\r\n                      </div>\r\n                    </div>\r\n\r\n                    {/* Stock - Only show if inventory is enabled */}\r\n                    {inventoryEnabled && (\r\n                      <div className=\"text-right\">\r\n                        <div className=\"text-xs text-gray-500 mb-1\">{dict.products.stock}</div>\r\n                        <span\r\n                          className={`inline-block text-xs font-semibold px-3 py-1.5 rounded border ${\r\n                            product.stock > 10\r\n                              ? 'bg-green-100 text-green-800 border-green-300'\r\n                              : product.stock > 0\r\n                              ? 'bg-yellow-100 text-yellow-800 border-yellow-300'\r\n                              : 'bg-red-100 text-red-800 border-red-300'\r\n                          }`}\r\n                        >\r\n                          {product.stock} {dict.products.inStock}\r\n                        </span>\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n\r\n                  {/* Actions */}\r\n                  <div className=\"flex gap-2 actions-touch-visible transition-opacity duration-200\">\r\n                      {inventoryEnabled && (\r\n                        <button\r\n                          onClick={() => handleRefill(product)}\r\n                          className=\"flex-1 px-4 py-2.5 bg-green-600 text-white hover:bg-green-700 active:bg-green-800 transition-all duration-200 border border-green-700 flex items-center justify-center gap-2 touch-manipulation min-h-[44px] text-sm font-medium\"\r\n                          title={dict.products.refill?.title || 'Refill Stock'}\r\n                          aria-label={dict.products.refill?.title || 'Refill Stock'}\r\n                        >\r\n                          <svg className=\"w-5 h-5\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 4v16m8-8H4\" />\r\n                          </svg>\r\n                          <span className=\"hidden sm:inline\">{dict.products.refill?.title || 'Refill'}</span>\r\n                        </button>\r\n                      )}\r\n                      <button\r\n                        onClick={() => handleEdit(product)}\r\n                        className=\"flex-1 px-4 py-2.5 bg-blue-600 text-white hover:bg-blue-700 active:bg-blue-800 transition-all duration-200 border border-blue-700 flex items-center justify-center gap-2 touch-manipulation min-h-[44px] text-sm font-medium\"\r\n                        title={dict.common.edit}\r\n                        aria-label={dict.common.edit}\r\n                      >\r\n                        <svg className=\"w-5 h-5\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z\" />\r\n                        </svg>\r\n                        <span className=\"hidden sm:inline\">{dict.common.edit}</span>\r\n                      </button>\r\n                      <button\r\n                        onClick={() => handleDelete(product._id)}\r\n                        className=\"flex-1 px-4 py-2.5 bg-red-600 text-white hover:bg-red-700 active:bg-red-800 transition-all duration-200 border border-red-700 flex items-center justify-center gap-2 touch-manipulation min-h-[44px] text-sm font-medium\"\r\n                        title={dict.common.delete}\r\n                        aria-label={dict.common.delete}\r\n                      >\r\n                        <svg className=\"w-5 h-5\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16\" />\r\n                        </svg>\r\n                        <span className=\"hidden sm:inline\">{dict.common.delete}</span>\r\n                      </button>\r\n                    </div>\r\n                </div>\r\n              </div>\r\n            ))}\r\n          </div>\r\n        ) : (\r\n          <div className=\"bg-white border border-gray-300 divide-y divide-gray-300\">\r\n            {sortedProducts.map((product) => (\r\n              <div\r\n                key={product._id}\r\n                className=\"group relative px-4 sm:px-6 py-4 sm:py-5 hover:bg-gray-50 transition-colors\"\r\n              >\r\n                <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4\">\r\n                  {/* Left Section */}\r\n                  <div className=\"flex-1 min-w-0\">\r\n                    {/* Name and Pinned */}\r\n                    <div className=\"flex items-start gap-2 mb-2\">\r\n                      <h3 className=\"font-semibold text-gray-900 text-base sm:text-lg flex-1\">\r\n                        {product.name}\r\n                        {product.pinned && (\r\n                          <svg className=\"inline-block w-4 h-4 ml-2 text-blue-600\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n                            <path d=\"M10 2a1 1 0 011 1v1.323l3.954 1.582 1.599-.8a1 1 0 01.894 1.79l-1.233.616 1.738 5.42a1 1 0 01-.285 1.05A3.989 3.989 0 0115 15a3.989 3.989 0 01-2.667-1.019 1 1 0 01-.285-1.05l1.715-5.349L11 6.477V16a1 1 0 11-2 0V6.477L5.237 7.582l1.715 5.349a1 1 0 01-.285 1.05A3.989 3.989 0 013 15a3.989 3.989 0 01-2.667-1.019 1 1 0 01-.285-1.05l1.738-5.42-1.233-.617a1 1 0 01.894-1.788l1.599.799L9 4.323V3a1 1 0 011-1z\" />\r\n                          </svg>\r\n                        )}\r\n                      </h3>\r\n                    </div>\r\n\r\n                    {/* Description */}\r\n                    {product.description && (\r\n                      <p className=\"text-sm text-gray-500 mb-2 line-clamp-1\">\r\n                        {product.description}\r\n                      </p>\r\n                    )}\r\n\r\n                    {/* Metadata */}\r\n                    <div className=\"flex flex-wrap gap-x-4 gap-y-2 text-xs sm:text-sm text-gray-600\">\r\n                      {product.sku && (\r\n                        <div className=\"flex items-center gap-1\">\r\n                          <span className=\"font-medium\">{dict.products.sku}:</span>\r\n                          <span>{product.sku}</span>\r\n                        </div>\r\n                      )}\r\n                      {product.category && (\r\n                        <div className=\"flex items-center gap-1\">\r\n                          <span className=\"flex items-center gap-1\">\r\n                            <span className=\"font-medium\">{dict.products.category}:</span>\r\n                            <span className=\"px-2 py-0.5 bg-gray-100 rounded border border-gray-300\">\r\n                              {product.category}\r\n                            </span>\r\n                          </span>\r\n                        </div>\r\n                      )}\r\n                    </div>\r\n                  </div>\r\n\r\n                  {/* Right Section */}\r\n                  <div className=\"flex items-center gap-4 sm:gap-6\">\r\n                    {/* Price */}\r\n                    <div className=\"text-right\">\r\n                      <div className=\"text-xs text-gray-500 mb-1 hidden sm:block\">{dict.products.price}</div>\r\n                      <div className=\"font-bold text-blue-600 text-lg sm:text-xl\">\r\n                        <Currency amount={product.price} />\r\n                      </div>\r\n                    </div>\r\n\r\n                    {/* Stock - Only show if inventory is enabled */}\r\n                    {inventoryEnabled && (\r\n                      <div className=\"text-right\">\r\n                        <div className=\"text-xs text-gray-500 mb-1 hidden sm:block\">{dict.products.stock}</div>\r\n                        <span\r\n                          className={`inline-block text-xs font-semibold px-3 py-1.5 rounded border ${\r\n                            product.stock > 10\r\n                              ? 'bg-green-100 text-green-800 border-green-300'\r\n                              : product.stock > 0\r\n                              ? 'bg-yellow-100 text-yellow-800 border-yellow-300'\r\n                              : 'bg-red-100 text-red-800 border-red-300'\r\n                          }`}\r\n                        >\r\n                          {product.stock} {dict.products.inStock}\r\n                        </span>\r\n                      </div>\r\n                    )}\r\n\r\n                    {/* Actions */}\r\n                    <div className=\"flex gap-2 actions-touch-visible transition-opacity duration-200\">\r\n                        {inventoryEnabled && (\r\n                          <button\r\n                            onClick={() => handleRefill(product)}\r\n                            className=\"px-3 py-2 bg-green-600 text-white hover:bg-green-700 active:bg-green-800 transition-all duration-200 border border-green-700 flex items-center justify-center touch-manipulation min-h-[44px] sm:min-h-0\"\r\n                            title={dict.products.refill?.title || 'Refill Stock'}\r\n                            aria-label={dict.products.refill?.title || 'Refill Stock'}\r\n                          >\r\n                            <svg className=\"w-5 h-5\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 4v16m8-8H4\" />\r\n                            </svg>\r\n                          </button>\r\n                        )}\r\n                        <button\r\n                          onClick={() => handleEdit(product)}\r\n                          className=\"px-3 py-2 bg-blue-600 text-white hover:bg-blue-700 active:bg-blue-800 transition-all duration-200 border border-blue-700 flex items-center justify-center touch-manipulation min-h-[44px] sm:min-h-0\"\r\n                          title={dict.common.edit}\r\n                          aria-label={dict.common.edit}\r\n                        >\r\n                          <svg className=\"w-5 h-5\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z\" />\r\n                          </svg>\r\n                        </button>\r\n                        <button\r\n                          onClick={() => handleDelete(product._id)}\r\n                          className=\"px-3 py-2 bg-red-600 text-white hover:bg-red-700 active:bg-red-800 transition-all duration-200 border border-red-700 flex items-center justify-center touch-manipulation min-h-[44px] sm:min-h-0\"\r\n                          title={dict.common.delete}\r\n                          aria-label={dict.common.delete}\r\n                        >\r\n                          <svg className=\"w-5 h-5\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16\" />\r\n                          </svg>\r\n                        </button>\r\n                      </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            ))}\r\n          </div>\r\n        )}\r\n\r\n        {isModalOpen && (\r\n          <ProductModal\r\n            product={editingProduct}\r\n            onClose={handleCloseModal}\r\n            lang={lang}\r\n          />\r\n        )}\r\n\r\n        {isRefillModalOpen && (\r\n          <StockRefillModal\r\n            product={refillingProduct}\r\n            onClose={handleCloseRefillModal}\r\n            onSuccess={handleRefillSuccess}\r\n            lang={lang}\r\n          />\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\[tenant]\\[lang]\\profile\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ProtectedRoute' is defined but never used. Allowed unused vars must match /^_/u.","line":5,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":22},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'tenant' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":13,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":13,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'user' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":15,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":15,"endColumn":15},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":16,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":16,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[609,612],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[609,612],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":36,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":36,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1343,1346],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1343,1346],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchProfile'. Either include it or remove the dependency array.","line":41,"column":6,"nodeType":"ArrayExpression","endLine":41,"endColumn":12,"suggestions":[{"desc":"Update the dependencies array to be: [fetchProfile, lang]","fix":{"range":[1451,1457],"text":"[fetchProfile, lang]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useEffect, useState } from 'react';\r\nimport Navbar from '@/components/Navbar';\r\nimport ProtectedRoute from '@/components/ProtectedRoute';\r\nimport { useParams } from 'next/navigation';\r\nimport { getDictionaryClient } from '../dictionaries-client';\r\nimport { useAuth } from '@/contexts/AuthContext';\r\nimport QRCodeDisplay from '@/components/QRCodeDisplay';\r\n\r\nexport default function ProfilePage() {\r\n  const params = useParams();\r\n  const tenant = params.tenant as string;\r\n  const lang = params.lang as 'en' | 'es';\r\n  const { user } = useAuth();\r\n  const [dict, setDict] = useState<any>(null);\r\n  const [profileData, setProfileData] = useState({\r\n    name: '',\r\n    email: '',\r\n  });\r\n  const [passwordData, setPasswordData] = useState({\r\n    currentPassword: '',\r\n    newPassword: '',\r\n    confirmPassword: '',\r\n  });\r\n  const [pinData, setPinData] = useState({\r\n    currentPin: '',\r\n    newPin: '',\r\n    confirmPin: '',\r\n  });\r\n  const [loading, setLoading] = useState(false);\r\n  const [saving, setSaving] = useState(false);\r\n  const [message, setMessage] = useState<{ type: 'success' | 'error'; text: string } | null>(null);\r\n  const [showPasswordSection, setShowPasswordSection] = useState(false);\r\n  const [showPinSection, setShowPinSection] = useState(false);\r\n  const [profileInfo, setProfileInfo] = useState<any>(null);\r\n\r\n  useEffect(() => {\r\n    getDictionaryClient(lang).then(setDict);\r\n    fetchProfile();\r\n  }, [lang]);\r\n\r\n  const fetchProfile = async () => {\r\n    try {\r\n      setLoading(true);\r\n      const res = await fetch('/api/auth/profile', { credentials: 'include' });\r\n      const data = await res.json();\r\n      if (data.success && data.user) {\r\n        setProfileInfo(data.user);\r\n        setProfileData({\r\n          name: data.user.name || '',\r\n          email: data.user.email || '',\r\n        });\r\n      } else {\r\n        setMessage({ type: 'error', text: data.error || dict?.common?.failedToLoadProfile || 'Failed to load profile' });\r\n      }\r\n    } catch (error) {\r\n      console.error('Error fetching profile:', error);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleProfileUpdate = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    setSaving(true);\r\n    setMessage(null);\r\n\r\n    try {\r\n      const res = await fetch('/api/auth/profile', {\r\n        method: 'PUT',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        credentials: 'include',\r\n        body: JSON.stringify(profileData),\r\n      });\r\n\r\n      const data = await res.json();\r\n      if (data.success) {\r\n        setMessage({ type: 'success', text: dict?.profile?.saved || 'Profile updated successfully!' });\r\n        setProfileInfo(data.data);\r\n        // Update auth context if needed\r\n        window.location.reload(); // Refresh to update user in context\r\n      } else {\r\n        setMessage({ type: 'error', text: data.error || dict?.common?.failedToUpdateProfile || 'Failed to update profile' });\r\n      }\r\n    } catch (error) {\r\n      console.error('Error updating profile:', error);\r\n      setMessage({ type: 'error', text: dict?.common?.failedToUpdateProfile || 'Failed to update profile. Please check your connection.' });\r\n    } finally {\r\n      setSaving(false);\r\n    }\r\n  };\r\n\r\n  const handlePasswordUpdate = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    setSaving(true);\r\n    setMessage(null);\r\n\r\n    if (passwordData.newPassword !== passwordData.confirmPassword) {\r\n      setMessage({ type: 'error', text: dict?.profile?.passwordsNotMatch || 'New passwords do not match' });\r\n      setSaving(false);\r\n      return;\r\n    }\r\n\r\n    if (passwordData.newPassword.length < 8) {\r\n      setMessage({ type: 'error', text: dict?.profile?.passwordTooShort || 'Password must be at least 8 characters long' });\r\n      setSaving(false);\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const res = await fetch('/api/auth/profile', {\r\n        method: 'PUT',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        credentials: 'include',\r\n        body: JSON.stringify({\r\n          password: passwordData.newPassword,\r\n          currentPassword: passwordData.currentPassword,\r\n        }),\r\n      });\r\n\r\n      const data = await res.json();\r\n      if (data.success) {\r\n        setMessage({ type: 'success', text: dict?.profile?.passwordSaved || 'Password updated successfully!' });\r\n        setPasswordData({\r\n          currentPassword: '',\r\n          newPassword: '',\r\n          confirmPassword: '',\r\n        });\r\n        setShowPasswordSection(false);\r\n      } else {\r\n        setMessage({ type: 'error', text: data.error || dict?.common?.failedToUpdatePassword || 'Failed to update password' });\r\n      }\r\n    } catch (error) {\r\n      console.error('Error updating password:', error);\r\n      setMessage({ type: 'error', text: dict?.common?.failedToUpdatePassword || 'Failed to update password. Please check your connection.' });\r\n    } finally {\r\n      setSaving(false);\r\n    }\r\n  };\r\n\r\n  const handlePinUpdate = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    setSaving(true);\r\n    setMessage(null);\r\n\r\n    if (pinData.newPin !== pinData.confirmPin) {\r\n      setMessage({ type: 'error', text: dict?.profile?.pinsNotMatch || 'New PINs do not match' });\r\n      setSaving(false);\r\n      return;\r\n    }\r\n\r\n    if (!/^\\d{4,8}$/.test(pinData.newPin)) {\r\n      setMessage({ type: 'error', text: dict?.profile?.pinInvalid || 'PIN must be 4-8 digits' });\r\n      setSaving(false);\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const res = await fetch('/api/auth/profile', {\r\n        method: 'PUT',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        credentials: 'include',\r\n        body: JSON.stringify({\r\n          pin: pinData.newPin,\r\n          currentPin: profileInfo?.hasPin ? pinData.currentPin : undefined,\r\n        }),\r\n      });\r\n\r\n      const data = await res.json();\r\n      if (data.success) {\r\n        setMessage({ type: 'success', text: dict?.profile?.pinSaved || 'PIN updated successfully!' });\r\n        setPinData({\r\n          currentPin: '',\r\n          newPin: '',\r\n          confirmPin: '',\r\n        });\r\n        setShowPinSection(false);\r\n        // Refresh profile to get updated hasPin status\r\n        await fetchProfile();\r\n      } else {\r\n        setMessage({ type: 'error', text: data.error || dict?.common?.failedToUpdatePIN || 'Failed to update PIN' });\r\n      }\r\n    } catch (error) {\r\n      console.error('Error updating PIN:', error);\r\n      setMessage({ type: 'error', text: dict?.common?.failedToUpdatePIN || 'Failed to update PIN. Please check your connection.' });\r\n    } finally {\r\n      setSaving(false);\r\n    }\r\n  };\r\n\r\n  const handleRegenerateQR = async () => {\r\n    try {\r\n      const res = await fetch('/api/auth/qr-code', {\r\n        method: 'POST',\r\n        credentials: 'include',\r\n      });\r\n\r\n      const data = await res.json();\r\n      if (data.success) {\r\n        setMessage({ type: 'success', text: dict?.profile?.qrRegenerated || 'QR code regenerated successfully!' });\r\n        await fetchProfile();\r\n      } else {\r\n        setMessage({ type: 'error', text: data.error || dict?.common?.failedToRegenerateQR || 'Failed to regenerate QR code' });\r\n      }\r\n    } catch (error) {\r\n      console.error('Error regenerating QR code:', error);\r\n      setMessage({ type: 'error', text: dict?.common?.failedToRegenerateQR || 'Failed to regenerate QR code. Please check your connection.' });\r\n    }\r\n  };\r\n\r\n  if (!dict || loading) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gray-50 flex items-center justify-center\">\r\n        <div className=\"text-center\">\r\n          <div className=\"inline-block animate-spin h-8 w-8 border-b-2 border-blue-600\"></div>\r\n          <p className=\"mt-4 text-gray-600\">Loading profile...</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50\">\r\n      <Navbar />\r\n      <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 sm:py-8\">\r\n        <div className=\"mb-6 sm:mb-8\">\r\n          <h1 className=\"text-2xl sm:text-3xl lg:text-4xl font-bold text-gray-900 mb-2\">\r\n            {dict?.profile?.title || 'User Profile'}\r\n          </h1>\r\n          <p className=\"text-gray-600\">{dict?.profile?.subtitle || 'Manage your account information and password'}</p>\r\n        </div>\r\n\r\n        {message && (\r\n          <div\r\n            className={`mb-6 p-4 border ${\r\n              message.type === 'success'\r\n                ? 'bg-green-50 text-green-800 border-green-300'\r\n                : 'bg-red-50 text-red-800 border-red-300'\r\n            }`}\r\n          >\r\n            {message.text}\r\n          </div>\r\n        )}\r\n\r\n        <div className=\"bg-white border border-gray-300 overflow-hidden\">\r\n          <div className=\"p-5 sm:p-6 lg:p-8\">\r\n            {/* Profile Information */}\r\n            <section className=\"mb-6\">\r\n              <h2 className=\"text-xl font-bold text-gray-900 mb-5\">\r\n                {dict?.profile?.information || 'Profile Information'}\r\n              </h2>\r\n              <form onSubmit={handleProfileUpdate} className=\"space-y-6\">\r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                  <div>\r\n                    <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                      {dict?.profile?.name || 'Full Name'}\r\n                    </label>\r\n                    <input\r\n                      type=\"text\"\r\n                      value={profileData.name}\r\n                      onChange={(e) => setProfileData({ ...profileData, name: e.target.value })}\r\n                      required\r\n                      className=\"w-full px-4 py-3 border-2 border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all bg-white\"\r\n                      placeholder={dict?.profile?.namePlaceholder || 'Enter your full name'}\r\n                    />\r\n                  </div>\r\n                  <div>\r\n                    <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                      {dict?.profile?.email || 'Email Address'}\r\n                    </label>\r\n                    <input\r\n                      type=\"email\"\r\n                      value={profileData.email}\r\n                      onChange={(e) => setProfileData({ ...profileData, email: e.target.value })}\r\n                      required\r\n                      className=\"w-full px-4 py-3 border-2 border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all bg-white\"\r\n                      placeholder={dict?.profile?.emailPlaceholder || 'Enter your email'}\r\n                    />\r\n                  </div>\r\n                </div>\r\n\r\n                {profileInfo && (\r\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 pt-4 border-t border-gray-200\">\r\n                    <div>\r\n                      <label className=\"block text-sm font-medium text-gray-500 mb-1\">\r\n                        {dict?.profile?.role || 'Role'}\r\n                      </label>\r\n                      <div className=\"px-4 py-3 bg-gray-50 border-2 border-gray-300 text-gray-700 capitalize\">\r\n                        {profileInfo.role}\r\n                      </div>\r\n                    </div>\r\n                    <div>\r\n                      <label className=\"block text-sm font-medium text-gray-500 mb-1\">\r\n                        {dict?.profile?.memberSince || 'Member Since'}\r\n                      </label>\r\n                      <div className=\"px-4 py-3 bg-gray-50 border-2 border-gray-300 text-gray-700\">\r\n                        {profileInfo.createdAt ? new Date(profileInfo.createdAt).toLocaleDateString() : 'N/A'}\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                )}\r\n\r\n                <div className=\"flex justify-end pt-4\">\r\n                  <button\r\n                    type=\"submit\"\r\n                    disabled={saving}\r\n                    className=\"px-6 py-3 bg-blue-600 text-white hover:bg-blue-700 font-semibold transition-all duration-200 border border-blue-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2\"\r\n                  >\r\n                    {saving ? (\r\n                      <>\r\n                        <div className=\"animate-spin h-5 w-5 border-b-2 border-white\"></div>\r\n                        <span>{dict?.profile?.saving || 'Saving...'}</span>\r\n                      </>\r\n                    ) : (\r\n                      <>\r\n                        <svg className=\"w-5 h-5\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M5 13l4 4L19 7\" />\r\n                        </svg>\r\n                        <span>{dict?.profile?.save || 'Save Changes'}</span>\r\n                      </>\r\n                    )}\r\n                  </button>\r\n                </div>\r\n              </form>\r\n            </section>\r\n\r\n            {/* Password Change Section */}\r\n            <section className=\"pt-8 border-t border-gray-200\">\r\n              <div className=\"flex items-center justify-between mb-5\">\r\n                <h2 className=\"text-xl font-bold text-gray-900\">\r\n                  {dict?.profile?.changePassword || 'Change Password'}\r\n                </h2>\r\n                <button\r\n                  onClick={() => setShowPasswordSection(!showPasswordSection)}\r\n                  className=\"px-4 py-2 text-sm font-medium text-blue-600 bg-blue-50 hover:bg-blue-100 transition-colors border border-blue-300\"\r\n                >\r\n                  {showPasswordSection ? 'Cancel' : 'Change Password'}\r\n                </button>\r\n              </div>\r\n\r\n              {showPasswordSection && (\r\n                <form onSubmit={handlePasswordUpdate} className=\"space-y-6\">\r\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                    <div>\r\n                      <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                        {dict?.profile?.currentPassword || 'Current Password'}\r\n                      </label>\r\n                      <input\r\n                        type=\"password\"\r\n                        value={passwordData.currentPassword}\r\n                        onChange={(e) => setPasswordData({ ...passwordData, currentPassword: e.target.value })}\r\n                        required\r\n                        className=\"w-full px-4 py-3 border-2 border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all bg-white\"\r\n                        placeholder={dict?.profile?.currentPasswordPlaceholder || 'Enter current password'}\r\n                      />\r\n                    </div>\r\n                    <div>\r\n                      <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                        {dict?.profile?.newPassword || 'New Password'}\r\n                      </label>\r\n                      <input\r\n                        type=\"password\"\r\n                        value={passwordData.newPassword}\r\n                        onChange={(e) => setPasswordData({ ...passwordData, newPassword: e.target.value })}\r\n                        required\r\n                        minLength={8}\r\n                        className=\"w-full px-4 py-3 border-2 border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all bg-white\"\r\n                        placeholder={dict?.profile?.newPasswordPlaceholder || 'Enter new password (min 8 chars)'}\r\n                      />\r\n                    </div>\r\n                    <div>\r\n                      <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                        {dict?.profile?.confirmPassword || 'Confirm New Password'}\r\n                      </label>\r\n                      <input\r\n                        type=\"password\"\r\n                        value={passwordData.confirmPassword}\r\n                        onChange={(e) => setPasswordData({ ...passwordData, confirmPassword: e.target.value })}\r\n                        required\r\n                        minLength={8}\r\n                        className=\"w-full px-4 py-3 border-2 border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all bg-white\"\r\n                        placeholder={dict?.profile?.confirmPasswordPlaceholder || 'Confirm new password'}\r\n                      />\r\n                    </div>\r\n                  </div>\r\n\r\n                  <div className=\"flex justify-end pt-4\">\r\n                    <button\r\n                      type=\"submit\"\r\n                      disabled={saving}\r\n                      className=\"px-6 py-3 bg-blue-600 text-white hover:bg-blue-700 font-semibold transition-all duration-200 border border-blue-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2\"\r\n                    >\r\n                      {saving ? (\r\n                        <>\r\n                          <div className=\"animate-spin h-5 w-5 border-b-2 border-white\"></div>\r\n                          <span>{dict?.profile?.saving || 'Saving...'}</span>\r\n                        </>\r\n                      ) : (\r\n                        <>\r\n                          <svg className=\"w-5 h-5\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z\" />\r\n                          </svg>\r\n                          <span>{dict?.profile?.updatePassword || 'Update Password'}</span>\r\n                        </>\r\n                      )}\r\n                    </button>\r\n                  </div>\r\n                </form>\r\n              )}\r\n            </section>\r\n\r\n            {/* PIN Management Section */}\r\n            <section className=\"pt-8 border-t border-gray-200\">\r\n              <div className=\"flex items-center justify-between mb-5\">\r\n                <div>\r\n                  <h2 className=\"text-xl font-bold text-gray-900\">\r\n                    {dict?.profile?.mpin || 'MPIN (Mobile PIN)'}\r\n                  </h2>\r\n                  <p className=\"text-sm text-gray-600 mt-1\">\r\n                    {profileInfo?.hasPin \r\n                      ? dict?.profile?.pinSet || 'Your PIN is set. Use it for quick login.'\r\n                      : dict?.profile?.pinNotSet || 'Set a PIN for quick login (4-8 digits)'}\r\n                  </p>\r\n                </div>\r\n                <button\r\n                  onClick={() => setShowPinSection(!showPinSection)}\r\n                  className=\"px-4 py-2 text-sm font-medium text-blue-600 bg-blue-50 hover:bg-blue-100 transition-colors border border-blue-300\"\r\n                >\r\n                  {showPinSection ? (dict?.common?.cancel || 'Cancel') : (profileInfo?.hasPin ? (dict?.profile?.changePIN || 'Change PIN') : (dict?.profile?.setPIN || 'Set PIN'))}\r\n                </button>\r\n              </div>\r\n\r\n              {showPinSection && (\r\n                <form onSubmit={handlePinUpdate} className=\"space-y-6\">\r\n                  {profileInfo?.hasPin && (\r\n                    <div>\r\n                      <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                        {dict?.profile?.currentPin || 'Current PIN'}\r\n                      </label>\r\n                      <input\r\n                        type=\"password\"\r\n                        inputMode=\"numeric\"\r\n                        pattern=\"[0-9]*\"\r\n                        value={pinData.currentPin}\r\n                        onChange={(e) => setPinData({ ...pinData, currentPin: e.target.value.replace(/\\D/g, '') })}\r\n                        required={profileInfo?.hasPin}\r\n                        maxLength={8}\r\n                        className=\"w-full px-4 py-3 border-2 border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all bg-white\"\r\n                        placeholder={dict?.profile?.currentPinPlaceholder || 'Enter current PIN'}\r\n                      />\r\n                    </div>\r\n                  )}\r\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                    <div>\r\n                      <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                        {profileInfo?.hasPin \r\n                          ? (dict?.profile?.newPin || 'New PIN')\r\n                          : (dict?.profile?.pin || 'PIN')}\r\n                      </label>\r\n                      <input\r\n                        type=\"password\"\r\n                        inputMode=\"numeric\"\r\n                        pattern=\"[0-9]*\"\r\n                        value={pinData.newPin}\r\n                        onChange={(e) => setPinData({ ...pinData, newPin: e.target.value.replace(/\\D/g, '') })}\r\n                        required\r\n                        minLength={4}\r\n                        maxLength={8}\r\n                        className=\"w-full px-4 py-3 border-2 border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all bg-white\"\r\n                        placeholder={profileInfo?.hasPin \r\n                          ? (dict?.profile?.newPinPlaceholder || 'Enter new PIN (4-8 digits)')\r\n                          : (dict?.profile?.pinPlaceholder || 'Enter PIN (4-8 digits)')}\r\n                      />\r\n                    </div>\r\n                    <div>\r\n                      <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                        {profileInfo?.hasPin \r\n                          ? (dict?.profile?.confirmPin || 'Confirm New PIN')\r\n                          : (dict?.profile?.confirmPin || 'Confirm PIN')}\r\n                      </label>\r\n                      <input\r\n                        type=\"password\"\r\n                        inputMode=\"numeric\"\r\n                        pattern=\"[0-9]*\"\r\n                        value={pinData.confirmPin}\r\n                        onChange={(e) => setPinData({ ...pinData, confirmPin: e.target.value.replace(/\\D/g, '') })}\r\n                        required\r\n                        minLength={4}\r\n                        maxLength={8}\r\n                        className=\"w-full px-4 py-3 border-2 border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all bg-white\"\r\n                        placeholder={profileInfo?.hasPin \r\n                          ? (dict?.profile?.confirmPinPlaceholder || 'Confirm new PIN')\r\n                          : (dict?.profile?.confirmPinPlaceholder || 'Confirm PIN')}\r\n                      />\r\n                    </div>\r\n                  </div>\r\n\r\n                  <div className=\"flex justify-end pt-4\">\r\n                    <button\r\n                      type=\"submit\"\r\n                      disabled={saving}\r\n                      className=\"px-6 py-3 bg-blue-600 text-white hover:bg-blue-700 font-semibold transition-all duration-200 border border-blue-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2\"\r\n                    >\r\n                      {saving ? (\r\n                        <>\r\n                          <div className=\"animate-spin h-5 w-5 border-b-2 border-white\"></div>\r\n                          <span>{dict?.profile?.saving || 'Saving...'}</span>\r\n                        </>\r\n                      ) : (\r\n                        <>\r\n                          <svg className=\"w-5 h-5\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z\" />\r\n                          </svg>\r\n                          <span>\r\n                            {profileInfo?.hasPin \r\n                              ? (dict?.profile?.updatePin || 'Change PIN')\r\n                              : (dict?.profile?.setPin || 'Set PIN')}\r\n                          </span>\r\n                        </>\r\n                      )}\r\n                    </button>\r\n                  </div>\r\n                </form>\r\n              )}\r\n            </section>\r\n\r\n            {/* QR Code Section */}\r\n            <section className=\"pt-8 border-t border-gray-200\">\r\n              <div className=\"mb-5\">\r\n                <h2 className=\"text-xl font-bold text-gray-900 mb-1\">\r\n                  {dict?.profile?.qrCode || 'QR Code Authentication'}\r\n                </h2>\r\n                <p className=\"text-sm text-gray-600\">\r\n                  {dict?.profile?.qrCodeDescription || 'Scan this QR code to log in quickly. Keep it secure.'}\r\n                </p>\r\n              </div>\r\n\r\n              {profileInfo?.qrToken ? (\r\n                <div className=\"flex justify-center\">\r\n                  <QRCodeDisplay\r\n                    qrToken={profileInfo.qrToken}\r\n                    name={profileInfo.name}\r\n                    onRegenerate={handleRegenerateQR}\r\n                  />\r\n                </div>\r\n              ) : (\r\n                <div className=\"p-6 bg-blue-50 border-2 border-blue-300 text-center\">\r\n                  <p className=\"text-blue-800 mb-4\">\r\n                    {dict?.profile?.qrNotAvailable || 'QR code not generated yet.'}\r\n                  </p>\r\n                  <button\r\n                    onClick={handleRegenerateQR}\r\n                    className=\"px-6 py-3 bg-blue-600 text-white hover:bg-blue-700 font-semibold transition-all duration-200 border border-blue-700 flex items-center gap-2 mx-auto\"\r\n                  >\r\n                    <svg className=\"w-5 h-5\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15\" />\r\n                    </svg>\r\n                    <span>{dict?.profile?.generateQR || 'Generate QR Code'}</span>\r\n                  </button>\r\n                </div>\r\n              )}\r\n            </section>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\[tenant]\\[lang]\\reports\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":97,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":97,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2469,2472],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2469,2472],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadReports'. Either include it or remove the dependency array.","line":125,"column":6,"nodeType":"ArrayExpression","endLine":125,"endColumn":59,"suggestions":[{"desc":"Update the dependencies array to be: [activeTab, period, startDate, endDate, dict, tenant, loadReports]","fix":{"range":[3690,3743],"text":"[activeTab, period, startDate, endDate, dict, tenant, loadReports]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":311,"column":66,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":311,"endColumn":69,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9978,9981],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9978,9981],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":414,"column":95,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":414,"endColumn":98,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16243,16246],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16243,16246],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":512,"column":99,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":512,"endColumn":102,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20656,20659],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20656,20659],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":586,"column":83,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":586,"endColumn":86,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[24064,24067],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[24064,24067],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":659,"column":102,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":659,"endColumn":105,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[27253,27256],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[27253,27256],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":770,"column":87,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":770,"endColumn":90,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[31973,31976],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[31973,31976],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":8,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useEffect, useState } from 'react';\r\nimport Navbar from '@/components/Navbar';\r\nimport ProtectedRoute from '@/components/ProtectedRoute';\r\nimport { useParams } from 'next/navigation';\r\nimport { getDictionaryClient } from '../dictionaries-client';\r\nimport Currency from '@/components/Currency';\r\nimport { LineChart, Line, BarChart, Bar, PieChart, Pie, Cell, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer } from 'recharts';\r\nimport { useTenantSettings } from '@/contexts/TenantSettingsContext';\r\n\r\nconst DEFAULT_COLORS = ['#3b82f6', '#10b981', '#f59e0b', '#ef4444', '#8b5cf6'];\r\n\r\ninterface SalesReport {\r\n  period: string;\r\n  startDate: string;\r\n  endDate: string;\r\n  totalSales: number;\r\n  totalTransactions: number;\r\n  averageTransaction: number;\r\n  salesByPaymentMethod: {\r\n    cash: number;\r\n    card: number;\r\n    digital: number;\r\n  };\r\n  salesByDay?: Array<{\r\n    date: string;\r\n    sales: number;\r\n    transactions: number;\r\n  }>;\r\n}\r\n\r\ninterface ProductPerformance {\r\n  productId: string;\r\n  productName: string;\r\n  totalSold: number;\r\n  totalRevenue: number;\r\n  averagePrice: number;\r\n  quantitySold: number;\r\n  rank: number;\r\n}\r\n\r\ninterface VATReport {\r\n  vatSales: number;\r\n  nonVatSales: number;\r\n  vatAmount: number;\r\n  totalSales: number;\r\n  vatRate: number;\r\n}\r\n\r\ninterface ProfitLossSummary {\r\n  period: string;\r\n  startDate: string;\r\n  endDate: string;\r\n  revenue: {\r\n    total: number;\r\n    cash: number;\r\n    card: number;\r\n    digital: number;\r\n  };\r\n  expenses: {\r\n    total: number;\r\n    byCategory: Array<{\r\n      category: string;\r\n      amount: number;\r\n    }>;\r\n  };\r\n  grossProfit: number;\r\n  netProfit: number;\r\n  profitMargin: number;\r\n}\r\n\r\ninterface CashDrawerReport {\r\n  sessionId: string;\r\n  userId: string;\r\n  userName: string;\r\n  openingTime: string;\r\n  closingTime?: string;\r\n  openingAmount: number;\r\n  closingAmount?: number;\r\n  expectedAmount?: number;\r\n  shortage?: number;\r\n  overage?: number;\r\n  status: string;\r\n  cashSales: number;\r\n  cashExpenses: number;\r\n  netCash: number;\r\n}\r\n\r\nexport default function ReportsPage() {\r\n  const params = useParams();\r\n  const tenant = params.tenant as string;\r\n  const lang = params.lang as 'en' | 'es';\r\n  const { settings } = useTenantSettings();\r\n  const primaryColor = settings?.primaryColor || '#3b82f6';\r\n  const COLORS = [primaryColor, ...DEFAULT_COLORS.filter(c => c !== primaryColor)].slice(0, 5);\r\n  const [dict, setDict] = useState<any>(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [activeTab, setActiveTab] = useState<'sales' | 'products' | 'vat' | 'profit-loss' | 'cash-drawer'>('sales');\r\n  const [period, setPeriod] = useState<'daily' | 'weekly' | 'monthly'>('daily');\r\n  const [startDate, setStartDate] = useState('');\r\n  const [endDate, setEndDate] = useState('');\r\n\r\n  // Report data\r\n  const [salesReport, setSalesReport] = useState<SalesReport | null>(null);\r\n  const [productPerformance, setProductPerformance] = useState<ProductPerformance[]>([]);\r\n  const [vatReport, setVatReport] = useState<VATReport | null>(null);\r\n  const [profitLoss, setProfitLoss] = useState<ProfitLossSummary | null>(null);\r\n  const [cashDrawerReports, setCashDrawerReports] = useState<CashDrawerReport[]>([]);\r\n\r\n  useEffect(() => {\r\n    getDictionaryClient(lang).then(setDict);\r\n    // Set default date range (last 30 days)\r\n    const end = new Date();\r\n    const start = new Date();\r\n    start.setDate(start.getDate() - 30);\r\n    setEndDate(end.toISOString().split('T')[0]);\r\n    setStartDate(start.toISOString().split('T')[0]);\r\n  }, [lang]);\r\n\r\n  useEffect(() => {\r\n    if (dict && startDate && endDate) {\r\n      loadReports();\r\n    }\r\n  }, [activeTab, period, startDate, endDate, dict, tenant]);\r\n\r\n  const loadReports = async () => {\r\n    setLoading(true);\r\n    try {\r\n      switch (activeTab) {\r\n        case 'sales':\r\n          await loadSalesReport();\r\n          break;\r\n        case 'products':\r\n          await loadProductPerformance();\r\n          break;\r\n        case 'vat':\r\n          await loadVATReport();\r\n          break;\r\n        case 'profit-loss':\r\n          await loadProfitLoss();\r\n          break;\r\n        case 'cash-drawer':\r\n          await loadCashDrawerReports();\r\n          break;\r\n      }\r\n    } catch (error) {\r\n      console.error('Error loading reports:', error);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const loadSalesReport = async () => {\r\n    try {\r\n      const params = new URLSearchParams({\r\n        tenant,\r\n        period,\r\n        ...(startDate && { startDate }),\r\n        ...(endDate && { endDate }),\r\n      });\r\n      const res = await fetch(`/api/reports/sales?${params}`);\r\n      const data = await res.json();\r\n      if (data.success) {\r\n        setSalesReport(data.data);\r\n      } else {\r\n        console.error('Error loading sales report:', data.error);\r\n        setSalesReport(null);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error fetching sales report:', error);\r\n      setSalesReport(null);\r\n    }\r\n  };\r\n\r\n  const loadProductPerformance = async () => {\r\n    try {\r\n      const params = new URLSearchParams({\r\n        tenant,\r\n        ...(startDate && { startDate }),\r\n        ...(endDate && { endDate }),\r\n        limit: '20',\r\n      });\r\n      const res = await fetch(`/api/reports/products?${params}`);\r\n      const data = await res.json();\r\n      if (data.success) {\r\n        setProductPerformance(data.data || []);\r\n      } else {\r\n        console.error('Error loading product performance:', data.error);\r\n        setProductPerformance([]);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error fetching product performance:', error);\r\n      setProductPerformance([]);\r\n    }\r\n  };\r\n\r\n  const loadVATReport = async () => {\r\n    try {\r\n      const params = new URLSearchParams({\r\n        tenant,\r\n        ...(startDate && { startDate }),\r\n        ...(endDate && { endDate }),\r\n      });\r\n      const res = await fetch(`/api/reports/vat?${params}`);\r\n      const data = await res.json();\r\n      if (data.success) {\r\n        setVatReport(data.data);\r\n      } else {\r\n        console.error('Error loading VAT report:', data.error);\r\n        setVatReport(null);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error fetching VAT report:', error);\r\n      setVatReport(null);\r\n    }\r\n  };\r\n\r\n  const loadProfitLoss = async () => {\r\n    try {\r\n      const params = new URLSearchParams({\r\n        tenant,\r\n        ...(startDate && { startDate }),\r\n        ...(endDate && { endDate }),\r\n      });\r\n      const res = await fetch(`/api/reports/profit-loss?${params}`);\r\n      const data = await res.json();\r\n      if (data.success) {\r\n        setProfitLoss(data.data);\r\n      } else {\r\n        console.error('Error loading profit & loss:', data.error);\r\n        setProfitLoss(null);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error fetching profit & loss:', error);\r\n      setProfitLoss(null);\r\n    }\r\n  };\r\n\r\n  const loadCashDrawerReports = async () => {\r\n    try {\r\n      const params = new URLSearchParams({\r\n        tenant,\r\n        ...(startDate && { startDate }),\r\n        ...(endDate && { endDate }),\r\n      });\r\n      const res = await fetch(`/api/reports/cash-drawer?${params}`);\r\n      const data = await res.json();\r\n      if (data.success) {\r\n        setCashDrawerReports(data.data || []);\r\n      } else {\r\n        console.error('Error loading cash drawer reports:', data.error);\r\n        setCashDrawerReports([]);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error fetching cash drawer reports:', error);\r\n      setCashDrawerReports([]);\r\n    }\r\n  };\r\n\r\n  if (!dict) {\r\n    return <div className=\"text-center py-12\">{dict?.common?.loading || 'Loading...'}</div>;\r\n  }\r\n\r\n  return (\r\n    <ProtectedRoute>\r\n      <div className=\"min-h-screen bg-gray-50\">\r\n        <Navbar />\r\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 sm:py-8\">\r\n          <div className=\"mb-6 sm:mb-8\">\r\n            <h1 className=\"text-2xl sm:text-3xl lg:text-4xl font-bold text-gray-900 mb-2\">\r\n              {dict.reports?.title || 'Reports & Analytics'}\r\n            </h1>\r\n            <p className=\"text-gray-600\">\r\n              {dict.reports?.subtitle || 'View detailed reports and analytics for your business'}\r\n            </p>\r\n          </div>\r\n\r\n          {/* Date Range Selector */}\r\n          <div className=\"bg-white border border-gray-300 p-5 sm:p-6 mb-6\">\r\n            <div className=\"flex flex-wrap items-center gap-4\">\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                  {dict.reports?.startDate || 'Start Date'}\r\n                </label>\r\n                <input\r\n                  type=\"date\"\r\n                  value={startDate}\r\n                  onChange={(e) => setStartDate(e.target.value)}\r\n                  className=\"px-4 py-3 border-2 border-gray-300 focus:ring-2 focus:ring-[var(--primary-color)] focus:border-[var(--primary-color)] transition-all bg-white\"\r\n                />\r\n              </div>\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                  {dict.reports?.endDate || 'End Date'}\r\n                </label>\r\n                <input\r\n                  type=\"date\"\r\n                  value={endDate}\r\n                  onChange={(e) => setEndDate(e.target.value)}\r\n                  className=\"px-4 py-3 border-2 border-gray-300 focus:ring-2 focus:ring-[var(--primary-color)] focus:border-[var(--primary-color)] transition-all bg-white\"\r\n                />\r\n              </div>\r\n              {activeTab === 'sales' && (\r\n                <div>\r\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                    {dict.reports?.period || 'Period'}\r\n                  </label>\r\n                  <select\r\n                    value={period}\r\n                    onChange={(e) => setPeriod(e.target.value as any)}\r\n                    className=\"px-4 py-3 border-2 border-gray-300 focus:ring-2 focus:ring-[var(--primary-color)] focus:border-[var(--primary-color)] transition-all bg-white\"\r\n                  >\r\n                    <option value=\"daily\">{dict.reports?.daily || 'Daily'}</option>\r\n                    <option value=\"weekly\">{dict.reports?.weekly || 'Weekly'}</option>\r\n                    <option value=\"monthly\">{dict.reports?.monthly || 'Monthly'}</option>\r\n                  </select>\r\n                </div>\r\n              )}\r\n            </div>\r\n          </div>\r\n\r\n          {/* Tabs */}\r\n          <div className=\"bg-white border border-gray-300 overflow-hidden mb-6\">\r\n            <div className=\"border-b border-gray-200\">\r\n              <nav className=\"flex overflow-x-auto\" aria-label={dict?.common?.tabs || 'Tabs'}>\r\n                {(['sales', 'products', 'vat', 'profit-loss', 'cash-drawer'] as const).map((tab) => (\r\n                  <button\r\n                    key={tab}\r\n                    onClick={() => setActiveTab(tab)}\r\n                    className={`px-6 py-4 text-sm font-medium whitespace-nowrap border-b-2 transition-colors ${\r\n                      activeTab === tab\r\n                        ? 'border-transparent text-gray-900'\r\n                        : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'\r\n                    }`}\r\n                    style={activeTab === tab ? { borderBottomColor: primaryColor, color: primaryColor } : undefined}\r\n                  >\r\n                    {dict.reports?.tabs?.[tab] || tab.replace('-', ' ')}\r\n                  </button>\r\n                ))}\r\n              </nav>\r\n            </div>\r\n\r\n            {/* Tab Content */}\r\n            <div className=\"p-5 sm:p-6 lg:p-8\">\r\n              {loading ? (\r\n                <div className=\"flex items-center justify-center py-12\">\r\n                  <div className=\"animate-spin h-8 w-8 border-b-2\" style={{ borderBottomColor: primaryColor }}></div>\r\n                  <span className=\"ml-3 text-gray-600\">{dict?.common?.loading || 'Loading...'}</span>\r\n                </div>\r\n              ) : (\r\n                <>\r\n                  {activeTab === 'sales' && (\r\n                    salesReport ? (\r\n                      <SalesReportView report={salesReport} dict={dict} primaryColor={primaryColor} colors={COLORS} />\r\n                    ) : (\r\n                      <div className=\"text-center py-16\">\r\n                        <svg className=\"mx-auto h-16 w-16 text-gray-300 mb-4\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z\" />\r\n                        </svg>\r\n                        <p className=\"text-gray-500 text-lg\">{dict.reports?.noData || 'No sales data available for the selected period'}</p>\r\n                      </div>\r\n                    )\r\n                  )}\r\n                  {activeTab === 'products' && (\r\n                    productPerformance.length > 0 ? (\r\n                      <ProductPerformanceView data={productPerformance} dict={dict} primaryColor={primaryColor} />\r\n                    ) : (\r\n                      <div className=\"text-center py-16\">\r\n                        <svg className=\"mx-auto h-16 w-16 text-gray-300 mb-4\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4\" />\r\n                        </svg>\r\n                        <p className=\"text-gray-500 text-lg\">{dict?.reports?.noData || 'No product performance data available for the selected period'}</p>\r\n                      </div>\r\n                    )\r\n                  )}\r\n                  {activeTab === 'vat' && (\r\n                    vatReport ? (\r\n                      <VATReportView report={vatReport} dict={dict} primaryColor={primaryColor} />\r\n                    ) : (\r\n                      <div className=\"text-center py-16\">\r\n                        <svg className=\"mx-auto h-16 w-16 text-gray-300 mb-4\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z\" />\r\n                        </svg>\r\n                        <p className=\"text-gray-500 text-lg\">{dict.reports?.noData || 'No VAT data available for the selected period'}</p>\r\n                      </div>\r\n                    )\r\n                  )}\r\n                  {activeTab === 'profit-loss' && (\r\n                    profitLoss ? (\r\n                      <ProfitLossView summary={profitLoss} dict={dict} primaryColor={primaryColor} colors={COLORS} />\r\n                    ) : (\r\n                      <div className=\"text-center py-16\">\r\n                        <svg className=\"mx-auto h-16 w-16 text-gray-300 mb-4\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n                        </svg>\r\n                        <p className=\"text-gray-500 text-lg\">{dict.reports?.noData || 'No profit & loss data available for the selected period'}</p>\r\n                      </div>\r\n                    )\r\n                  )}\r\n                  {activeTab === 'cash-drawer' && (\r\n                    <CashDrawerReportView reports={cashDrawerReports} dict={dict} />\r\n                  )}\r\n                </>\r\n              )}\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </ProtectedRoute>\r\n  );\r\n}\r\n\r\nfunction SalesReportView({ report, dict, primaryColor, colors }: { report: SalesReport; dict: any; primaryColor: string; colors: string[] }) {\r\n  const paymentMethodData = [\r\n    { name: dict.pos?.cash || 'Cash', value: report.salesByPaymentMethod.cash },\r\n    { name: dict.pos?.card || 'Card', value: report.salesByPaymentMethod.card },\r\n    { name: dict.pos?.digital || 'Digital', value: report.salesByPaymentMethod.digital },\r\n  ];\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      {/* Summary Cards */}\r\n      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4 sm:gap-6\">\r\n        <div className=\"bg-blue-50 border border-blue-300 p-5 sm:p-6\">\r\n          <div className=\"text-xs sm:text-sm text-blue-600 font-semibold mb-2 uppercase tracking-wide\">\r\n            {dict.reports?.totalSales || 'Total Sales'}\r\n          </div>\r\n          <div className=\"text-2xl sm:text-3xl font-bold text-blue-900\">\r\n            <Currency amount={report.totalSales} />\r\n          </div>\r\n        </div>\r\n        <div className=\"bg-green-50 border border-green-300 p-5 sm:p-6\">\r\n          <div className=\"text-xs sm:text-sm text-green-600 font-semibold mb-2 uppercase tracking-wide\">\r\n            {dict.reports?.totalTransactions || 'Total Transactions'}\r\n          </div>\r\n          <div className=\"text-2xl sm:text-3xl font-bold text-green-900\">{report.totalTransactions}</div>\r\n        </div>\r\n        <div className=\"bg-purple-50 border border-purple-300 p-5 sm:p-6\">\r\n          <div className=\"text-xs sm:text-sm text-purple-600 font-semibold mb-2 uppercase tracking-wide\">\r\n            {dict.reports?.averageTransaction || 'Average Transaction'}\r\n          </div>\r\n          <div className=\"text-2xl sm:text-3xl font-bold text-purple-900\">\r\n            <Currency amount={report.averageTransaction} />\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Charts */}\r\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6\">\r\n        {report.salesByDay && report.salesByDay.length > 0 && (\r\n          <div className=\"bg-white border border-gray-300 p-5 sm:p-6\">\r\n            <h3 className=\"text-lg font-semibold text-gray-900 mb-5\">\r\n              {dict.reports?.salesByDay || 'Sales by Day'}\r\n            </h3>\r\n            <ResponsiveContainer width=\"100%\" height={300}>\r\n              <LineChart data={report.salesByDay}>\r\n                <CartesianGrid strokeDasharray=\"3 3\" stroke=\"#e5e7eb\" />\r\n                <XAxis dataKey=\"date\" stroke=\"#6b7280\" style={{ fontSize: '12px' }} />\r\n                <YAxis stroke=\"#6b7280\" style={{ fontSize: '12px' }} />\r\n                <Tooltip \r\n                  contentStyle={{ \r\n                    backgroundColor: '#fff', \r\n                    border: '1px solid #e5e7eb',\r\n                    borderRadius: '8px',\r\n                    boxShadow: '0 4px 6px -1px rgba(0, 0, 0, 0.1)'\r\n                  }}\r\n                />\r\n                <Legend />\r\n                <Line type=\"monotone\" dataKey=\"sales\" stroke={primaryColor} strokeWidth={2} name={dict.reports?.sales || 'Sales'} />\r\n              </LineChart>\r\n            </ResponsiveContainer>\r\n          </div>\r\n        )}\r\n\r\n        <div className=\"bg-white border border-gray-300 p-5 sm:p-6\">\r\n          <h3 className=\"text-lg font-semibold text-gray-900 mb-5\">\r\n            {dict.reports?.paymentMethods || 'Payment Methods'}\r\n          </h3>\r\n          <ResponsiveContainer width=\"100%\" height={300}>\r\n            <PieChart>\r\n              <Pie\r\n                data={paymentMethodData}\r\n                cx=\"50%\"\r\n                cy=\"50%\"\r\n                labelLine={false}\r\n                label={({ name, percent }) => `${name} ${((percent || 0) * 100).toFixed(0)}%`}\r\n                outerRadius={80}\r\n                fill=\"#8884d8\"\r\n                dataKey=\"value\"\r\n              >\r\n                {paymentMethodData.map((entry, index) => (\r\n                  <Cell key={`cell-${index}`} fill={colors[index % colors.length]} />\r\n                ))}\r\n              </Pie>\r\n              <Tooltip\r\n                contentStyle={{\r\n                  backgroundColor: '#fff',\r\n                  border: '1px solid #e5e7eb',\r\n                  borderRadius: '8px',\r\n                  boxShadow: '0 4px 6px -1px rgba(0, 0, 0, 0.1)'\r\n                }}\r\n              />\r\n            </PieChart>\r\n          </ResponsiveContainer>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction ProductPerformanceView({ data, dict, primaryColor }: { data: ProductPerformance[]; dict: any; primaryColor: string }) {\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      <div className=\"bg-white border border-gray-300 p-5 sm:p-6\">\r\n        <h3 className=\"text-lg font-semibold text-gray-900 mb-5\">\r\n          {dict.reports?.topProducts || 'Top Products'}\r\n        </h3>\r\n        <ResponsiveContainer width=\"100%\" height={400}>\r\n          <BarChart data={data.slice(0, 10)}>\r\n            <CartesianGrid strokeDasharray=\"3 3\" stroke=\"#e5e7eb\" />\r\n            <XAxis dataKey=\"productName\" angle={-45} textAnchor=\"end\" height={100} stroke=\"#6b7280\" style={{ fontSize: '12px' }} />\r\n            <YAxis stroke=\"#6b7280\" style={{ fontSize: '12px' }} />\r\n            <Tooltip \r\n              contentStyle={{ \r\n                backgroundColor: '#fff', \r\n                border: '1px solid #e5e7eb',\r\n                borderRadius: '8px',\r\n                boxShadow: '0 4px 6px -1px rgba(0, 0, 0, 0.1)'\r\n              }}\r\n            />\r\n            <Legend />\r\n            <Bar dataKey=\"totalRevenue\" fill={primaryColor} name={dict.reports?.revenue || 'Revenue'} />\r\n          </BarChart>\r\n        </ResponsiveContainer>\r\n      </div>\r\n\r\n      <div className=\"bg-white border border-gray-300 overflow-hidden\">\r\n        <table className=\"min-w-full divide-y divide-gray-200\">\r\n          <thead className=\"bg-gray-50\">\r\n            <tr>\r\n              <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">\r\n                {dict.reports?.rank || 'Rank'}\r\n              </th>\r\n              <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">\r\n                {dict.products?.name || 'Product'}\r\n              </th>\r\n              <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">\r\n                {dict.reports?.quantitySold || 'Quantity Sold'}\r\n              </th>\r\n              <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">\r\n                {dict.reports?.totalRevenue || 'Revenue'}\r\n              </th>\r\n              <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">\r\n                {dict.reports?.averagePrice || 'Avg Price'}\r\n              </th>\r\n            </tr>\r\n          </thead>\r\n          <tbody className=\"bg-white divide-y divide-gray-200\">\r\n            {data.map((product, index) => (\r\n              <tr key={product.productId || `product-${index}`}>\r\n                <td className=\"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900\">\r\n                  #{product.rank}\r\n                </td>\r\n                <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-900\">\r\n                  {product.productName}\r\n                </td>\r\n                <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\">\r\n                  {product.quantitySold}\r\n                </td>\r\n                <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-900\">\r\n                  <Currency amount={product.totalRevenue} />\r\n                </td>\r\n                <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\">\r\n                  <Currency amount={product.averagePrice} />\r\n                </td>\r\n              </tr>\r\n            ))}\r\n          </tbody>\r\n        </table>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction VATReportView({ report, dict, primaryColor }: { report: VATReport; dict: any; primaryColor: string }) {\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 sm:gap-6\">\r\n        <div className=\"bg-blue-50 border border-blue-300 p-5 sm:p-6\">\r\n          <div className=\"text-xs sm:text-sm text-blue-600 font-semibold mb-2 uppercase tracking-wide\">\r\n            {dict.reports?.vatSales || 'VAT Sales'}\r\n          </div>\r\n          <div className=\"text-2xl sm:text-3xl font-bold text-blue-900\">\r\n            <Currency amount={report.vatSales} />\r\n          </div>\r\n        </div>\r\n        <div className=\"bg-green-50 border border-green-300 p-5 sm:p-6\">\r\n          <div className=\"text-xs sm:text-sm text-green-600 font-semibold mb-2 uppercase tracking-wide\">\r\n            {dict.reports?.nonVatSales || 'Non-VAT Sales'}\r\n          </div>\r\n          <div className=\"text-2xl sm:text-3xl font-bold text-green-900\">\r\n            <Currency amount={report.nonVatSales} />\r\n          </div>\r\n        </div>\r\n        <div className=\"bg-purple-50 border border-purple-300 p-5 sm:p-6\">\r\n          <div className=\"text-xs sm:text-sm text-purple-600 font-semibold mb-2 uppercase tracking-wide\">\r\n            {dict.reports?.vatAmount || 'VAT Amount'}\r\n          </div>\r\n          <div className=\"text-2xl sm:text-3xl font-bold text-purple-900\">\r\n            <Currency amount={report.vatAmount} />\r\n          </div>\r\n        </div>\r\n        <div className=\"bg-orange-50 border border-orange-300 p-5 sm:p-6\">\r\n          <div className=\"text-xs sm:text-sm text-orange-600 font-semibold mb-2 uppercase tracking-wide\">\r\n            {dict.reports?.vatRate || 'VAT Rate'}\r\n          </div>\r\n          <div className=\"text-2xl sm:text-3xl font-bold text-orange-900\">{report.vatRate}%</div>\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"bg-white border border-gray-300 p-5 sm:p-6\">\r\n        <h3 className=\"text-lg font-semibold text-gray-900 mb-5\">\r\n          {dict.reports?.vatBreakdown || 'VAT Breakdown'}\r\n        </h3>\r\n        <ResponsiveContainer width=\"100%\" height={300}>\r\n          <PieChart>\r\n            <Pie\r\n              data={[\r\n                { name: dict.reports?.vatSales || 'VAT Sales', value: report.vatSales },\r\n                { name: dict.reports?.nonVatSales || 'Non-VAT Sales', value: report.nonVatSales },\r\n              ]}\r\n              cx=\"50%\"\r\n              cy=\"50%\"\r\n              labelLine={false}\r\n              label={({ name, percent }) => `${name} ${((percent || 0) * 100).toFixed(0)}%`}\r\n              outerRadius={80}\r\n              fill=\"#8884d8\"\r\n              dataKey=\"value\"\r\n            >\r\n              <Cell fill={primaryColor} />\r\n              <Cell fill=\"#10b981\" />\r\n            </Pie>\r\n            <Tooltip \r\n              contentStyle={{ \r\n                backgroundColor: '#fff', \r\n                border: '1px solid #e5e7eb',\r\n                borderRadius: '8px',\r\n                boxShadow: '0 4px 6px -1px rgba(0, 0, 0, 0.1)'\r\n              }}\r\n            />\r\n          </PieChart>\r\n        </ResponsiveContainer>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction ProfitLossView({ summary, dict, primaryColor, colors }: { summary: ProfitLossSummary; dict: any; primaryColor: string; colors: string[] }) {\r\n  const expenseData = summary.expenses.byCategory.map((cat) => ({\r\n    name: cat.category,\r\n    value: cat.amount,\r\n  }));\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      {/* Summary Cards */}\r\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 sm:gap-6\">\r\n        <div className=\"bg-green-50 border border-green-300 p-5 sm:p-6\">\r\n          <div className=\"text-xs sm:text-sm text-green-600 font-semibold mb-2 uppercase tracking-wide\">\r\n            {dict.reports?.totalRevenue || 'Total Revenue'}\r\n          </div>\r\n          <div className=\"text-2xl sm:text-3xl font-bold text-green-900\">\r\n            <Currency amount={summary.revenue.total} />\r\n          </div>\r\n        </div>\r\n        <div className=\"bg-red-50 border border-red-300 p-5 sm:p-6\">\r\n          <div className=\"text-xs sm:text-sm text-red-600 font-semibold mb-2 uppercase tracking-wide\">\r\n            {dict.reports?.totalExpenses || 'Total Expenses'}\r\n          </div>\r\n          <div className=\"text-2xl sm:text-3xl font-bold text-red-900\">\r\n            <Currency amount={summary.expenses.total} />\r\n          </div>\r\n        </div>\r\n        <div className=\"bg-blue-50 border border-blue-300 p-5 sm:p-6\">\r\n          <div className=\"text-xs sm:text-sm text-blue-600 font-semibold mb-2 uppercase tracking-wide\">\r\n            {dict.reports?.netProfit || 'Net Profit'}\r\n          </div>\r\n          <div className=\"text-2xl sm:text-3xl font-bold text-blue-900\">\r\n            <Currency amount={summary.netProfit} />\r\n          </div>\r\n        </div>\r\n        <div className=\"bg-purple-50 border border-purple-300 p-5 sm:p-6\">\r\n          <div className=\"text-xs sm:text-sm text-purple-600 font-semibold mb-2 uppercase tracking-wide\">\r\n            {dict.reports?.profitMargin || 'Profit Margin'}\r\n          </div>\r\n          <div className=\"text-2xl sm:text-3xl font-bold text-purple-900\">\r\n            {summary.profitMargin.toFixed(2)}%\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Revenue by Payment Method */}\r\n      <div className=\"bg-white border border-gray-300 p-5 sm:p-6\">\r\n        <h3 className=\"text-lg font-semibold text-gray-900 mb-5\">\r\n          {dict.reports?.revenueByPaymentMethod || 'Revenue by Payment Method'}\r\n        </h3>\r\n        <ResponsiveContainer width=\"100%\" height={300}>\r\n          <BarChart\r\n            data={[\r\n              { name: dict.pos?.cash || 'Cash', value: summary.revenue.cash },\r\n              { name: dict.pos?.card || 'Card', value: summary.revenue.card },\r\n              { name: dict.pos?.digital || 'Digital', value: summary.revenue.digital },\r\n            ]}\r\n          >\r\n            <CartesianGrid strokeDasharray=\"3 3\" stroke=\"#e5e7eb\" />\r\n            <XAxis dataKey=\"name\" stroke=\"#6b7280\" style={{ fontSize: '12px' }} />\r\n            <YAxis stroke=\"#6b7280\" style={{ fontSize: '12px' }} />\r\n            <Tooltip \r\n              contentStyle={{ \r\n                backgroundColor: '#fff', \r\n                border: '1px solid #e5e7eb',\r\n                borderRadius: '8px',\r\n                boxShadow: '0 4px 6px -1px rgba(0, 0, 0, 0.1)'\r\n              }}\r\n            />\r\n            <Bar dataKey=\"value\" fill={primaryColor} />\r\n          </BarChart>\r\n        </ResponsiveContainer>\r\n      </div>\r\n\r\n      {/* Expenses by Category */}\r\n      {expenseData.length > 0 && (\r\n        <div className=\"bg-white border border-gray-300 p-5 sm:p-6\">\r\n          <h3 className=\"text-lg font-semibold text-gray-900 mb-5\">\r\n            {dict.reports?.expensesByCategory || 'Expenses by Category'}\r\n          </h3>\r\n          <ResponsiveContainer width=\"100%\" height={300}>\r\n            <PieChart>\r\n              <Pie\r\n                data={expenseData}\r\n                cx=\"50%\"\r\n                cy=\"50%\"\r\n                labelLine={false}\r\n                label={({ name, percent }) => `${name} ${((percent || 0) * 100).toFixed(0)}%`}\r\n                outerRadius={80}\r\n                fill=\"#8884d8\"\r\n                dataKey=\"value\"\r\n              >\r\n                {expenseData.map((entry, index) => (\r\n                  <Cell key={`cell-${index}`} fill={colors[index % colors.length]} />\r\n                ))}\r\n              </Pie>\r\n              <Tooltip\r\n                contentStyle={{\r\n                  backgroundColor: '#fff',\r\n                  border: '1px solid #e5e7eb',\r\n                  borderRadius: '8px',\r\n                  boxShadow: '0 4px 6px -1px rgba(0, 0, 0, 0.1)'\r\n                }}\r\n              />\r\n            </PieChart>\r\n          </ResponsiveContainer>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction CashDrawerReportView({ reports, dict }: { reports: CashDrawerReport[]; dict: any }) {\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      <div className=\"bg-white border border-gray-300 overflow-hidden\">\r\n        <table className=\"min-w-full divide-y divide-gray-200\">\r\n          <thead className=\"bg-gray-50\">\r\n            <tr>\r\n              <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">\r\n                {dict.reports?.openingTime || 'Opening Time'}\r\n              </th>\r\n              <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">\r\n                {dict.reports?.closingTime || 'Closing Time'}\r\n              </th>\r\n              <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">\r\n                {dict.reports?.openingAmount || 'Opening'}\r\n              </th>\r\n              <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">\r\n                {dict.reports?.expectedAmount || 'Expected'}\r\n              </th>\r\n              <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">\r\n                {dict.reports?.closingAmount || 'Closing'}\r\n              </th>\r\n              <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">\r\n                {dict.reports?.shortage || 'Shortage'}\r\n              </th>\r\n              <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">\r\n                {dict.reports?.overage || 'Overage'}\r\n              </th>\r\n              <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">\r\n                {dict.reports?.status || 'Status'}\r\n              </th>\r\n            </tr>\r\n          </thead>\r\n          <tbody className=\"bg-white divide-y divide-gray-200\">\r\n            {reports.map((report, index) => (\r\n              <tr key={report.sessionId || `session-${index}`}>\r\n                <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-900\">\r\n                  {new Date(report.openingTime).toLocaleString()}\r\n                </td>\r\n                <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\">\r\n                  {report.closingTime ? new Date(report.closingTime).toLocaleString() : '-'}\r\n                </td>\r\n                <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-900\">\r\n                  <Currency amount={report.openingAmount} />\r\n                </td>\r\n                <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-900\">\r\n                  {report.expectedAmount ? <Currency amount={report.expectedAmount} /> : '-'}\r\n                </td>\r\n                <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-900\">\r\n                  {report.closingAmount ? <Currency amount={report.closingAmount} /> : '-'}\r\n                </td>\r\n                <td className=\"px-6 py-4 whitespace-nowrap text-sm text-red-600\">\r\n                  {report.shortage ? <Currency amount={report.shortage} /> : '-'}\r\n                </td>\r\n                <td className=\"px-6 py-4 whitespace-nowrap text-sm text-green-600\">\r\n                  {report.overage ? <Currency amount={report.overage} /> : '-'}\r\n                </td>\r\n                <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                  <span\r\n                    className={`px-2 py-1 text-xs font-medium border ${\r\n                      report.status === 'closed'\r\n                        ? 'bg-green-100 text-green-800 border-green-300'\r\n                        : 'bg-yellow-100 text-yellow-800 border-yellow-300'\r\n                    }`}\r\n                  >\r\n                    {report.status}\r\n                  </span>\r\n                </td>\r\n              </tr>\r\n            ))}\r\n          </tbody>\r\n        </table>\r\n        {reports.length === 0 && (\r\n          <div className=\"text-center py-16 text-gray-500\">\r\n            <svg className=\"mx-auto h-16 w-16 text-gray-300 mb-4\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2\" />\r\n            </svg>\r\n            <p className=\"text-lg\">{dict.reports?.noCashDrawerReports || 'No cash drawer reports found'}</p>\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\[tenant]\\[lang]\\settings\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ProtectedRoute' is defined but never used. Allowed unused vars must match /^_/u.","line":5,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":22},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":19,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":19,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[864,867],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[864,867],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":27,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":27,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1486,1489],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1486,1489],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchSettings'. Either include it or remove the dependency array.","line":35,"column":6,"nodeType":"ArrayExpression","endLine":35,"endColumn":20,"suggestions":[{"desc":"Update the dependencies array to be: [fetchSettings, lang, tenant]","fix":{"range":[1784,1798],"text":"[fetchSettings, lang, tenant]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":246,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":246,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9287,9290],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9287,9290],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":251,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":251,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9461,9464],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9461,9464],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'autoDetectLocation' and 'detecting'. Either include them or remove the dependency array.","line":96,"column":6,"nodeType":"ArrayExpression","endLine":96,"endColumn":25,"suggestions":[{"desc":"Update the dependencies array to be: [settings, loading, detecting, autoDetectLocation]","fix":{"range":[3989,4008],"text":"[settings, loading, detecting, autoDetectLocation]"}}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useEffect, useState } from 'react';\r\nimport Navbar from '@/components/Navbar';\r\nimport ProtectedRoute from '@/components/ProtectedRoute';\r\nimport { useParams, useRouter } from 'next/navigation';\r\nimport Link from 'next/link';\r\nimport { getDictionaryClient } from '../dictionaries-client';\r\nimport { ITenantSettings } from '@/models/Tenant';\r\nimport { detectLocation, getCurrencySymbolForCode } from '@/lib/location-detection';\r\nimport MultiCurrencyDisplaySettings from '@/components/settings/MultiCurrencyDisplaySettings';\r\nimport ReceiptTemplatesManager from '@/components/settings/ReceiptTemplatesManager';\r\n\r\nexport default function SettingsPage() {\r\n  const params = useParams();\r\n  const router = useRouter();\r\n  const tenant = params.tenant as string;\r\n  const lang = params.lang as 'en' | 'es';\r\n  const [dict, setDict] = useState<any>(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [saving, setSaving] = useState(false);\r\n  const [settings, setSettings] = useState<ITenantSettings | null>(null);\r\n  const [message, setMessage] = useState<{ type: 'success' | 'error'; text: string } | null>(null);\r\n  const [detecting, setDetecting] = useState(false);\r\n  const [detectedInfo, setDetectedInfo] = useState<string | null>(null);\r\n  const [activeTab, setActiveTab] = useState<'general' | 'branding' | 'contact' | 'receipt' | 'business' | 'notifications' | 'multiCurrency'>('general');\r\n  const [businessTypes, setBusinessTypes] = useState<any[]>([]);\r\n  const [loadingBusinessTypes, setLoadingBusinessTypes] = useState(true);\r\n  const [businessTypeWarning, setBusinessTypeWarning] = useState<string | null>(null);\r\n\r\n  useEffect(() => {\r\n    getDictionaryClient(lang).then(setDict);\r\n    fetchSettings();\r\n    loadBusinessTypes();\r\n  }, [lang, tenant]);\r\n\r\n  const loadBusinessTypes = async () => {\r\n    try {\r\n      setLoadingBusinessTypes(true);\r\n      const res = await fetch('/api/business-types');\r\n      const data = await res.json();\r\n      if (data.success) {\r\n        setBusinessTypes(data.data);\r\n      }\r\n    } catch (err) {\r\n      console.error('Failed to load business types:', err);\r\n    } finally {\r\n      setLoadingBusinessTypes(false);\r\n    }\r\n  };\r\n\r\n\r\n  const autoDetectLocation = async () => {\r\n    try {\r\n      setDetecting(true);\r\n      const detected = await detectLocation();\r\n      \r\n      if (!settings) return;\r\n      \r\n      // Update settings with detected values\r\n      const newSettings = JSON.parse(JSON.stringify(settings));\r\n      newSettings.timezone = detected.timezone;\r\n      newSettings.currency = detected.currency;\r\n      newSettings.currencySymbol = getCurrencySymbolForCode(detected.currency);\r\n      newSettings.currencyPosition = detected.currencyPosition;\r\n      newSettings.dateFormat = detected.dateFormat;\r\n      newSettings.timeFormat = detected.timeFormat;\r\n      newSettings.numberFormat = detected.numberFormat;\r\n      \r\n      setSettings(newSettings);\r\n      setDetectedInfo(`Detected: ${detected.locale} (${detected.country || 'Unknown'}) - ${detected.currency} - ${detected.timezone}`);\r\n      \r\n      // Clear message after 5 seconds\r\n      setTimeout(() => setDetectedInfo(null), 5000);\r\n    } catch (error) {\r\n      console.error('Error detecting location:', error);\r\n      setMessage({ type: 'error', text: dict?.settings?.failedToDetect || 'Failed to detect location. Please set manually.' });\r\n    } finally {\r\n      setDetecting(false);\r\n    }\r\n  };\r\n\r\n  // Auto-detect location on first load if settings are default\r\n  useEffect(() => {\r\n    if (settings && !loading && !detecting) {\r\n      // Check if settings are using defaults (likely first time setup)\r\n      const isDefault = settings.timezone === 'UTC' && \r\n                       settings.currency === 'USD' && \r\n                       settings.dateFormat === 'MM/DD/YYYY';\r\n      \r\n      if (isDefault) {\r\n        autoDetectLocation();\r\n      }\r\n    }\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [settings, loading]);\r\n\r\n  const fetchSettings = async () => {\r\n    try {\r\n      setLoading(true);\r\n      const res = await fetch(`/api/tenants/${tenant}/settings`);\r\n      const data = await res.json();\r\n      if (data.success) {\r\n        // Ensure all required fields exist with defaults\r\n        const defaultSettings = {\r\n          currency: 'USD',\r\n          currencyPosition: 'before',\r\n          dateFormat: 'MM/DD/YYYY',\r\n          timeFormat: '12h',\r\n          timezone: 'UTC',\r\n          language: 'en',\r\n          numberFormat: {\r\n            decimalSeparator: '.',\r\n            thousandsSeparator: ',',\r\n            decimalPlaces: 2,\r\n          },\r\n          primaryColor: '#2563eb',\r\n          receiptShowLogo: true,\r\n          receiptShowAddress: true,\r\n          receiptShowPhone: false,\r\n          receiptShowEmail: false,\r\n          taxEnabled: false,\r\n          taxRate: 0,\r\n          taxLabel: 'Tax',\r\n          lowStockThreshold: 10,\r\n          lowStockAlert: true,\r\n          emailNotifications: false,\r\n          smsNotifications: false,\r\n          enableInventory: true,\r\n          enableCategories: true,\r\n          enableDiscounts: false,\r\n          enableLoyaltyProgram: false,\r\n          enableCustomerManagement: false,\r\n          enableBookingScheduling: false,\r\n          hardwareConfig: {},\r\n          ...data.data,\r\n        };\r\n        setSettings(defaultSettings);\r\n      } else {\r\n        setMessage({ type: 'error', text: data.error || dict?.settings?.failedToLoad || 'Failed to load settings' });\r\n      }\r\n    } catch (error) {\r\n      console.error('Error fetching settings:', error);\r\n      setMessage({ type: 'error', text: dict?.common?.failedToLoadSettings || 'Failed to load settings. Please check your connection.' });\r\n      setLoading(false);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const validateSettings = (): string | null => {\r\n    if (!settings) return 'Settings not loaded';\r\n\r\n    // Validate currency\r\n    if (settings.currency && settings.currency.length !== 3) {\r\n      return 'Currency code must be 3 characters (e.g., USD, EUR)';\r\n    }\r\n\r\n    // Validate colors (hex format)\r\n    const colorFields = ['primaryColor', 'secondaryColor', 'accentColor', 'backgroundColor', 'textColor'];\r\n    for (const field of colorFields) {\r\n      const value = settings[field as keyof ITenantSettings] as string | undefined;\r\n      if (value && !/^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/.test(value)) {\r\n        return `Invalid color format for ${field}. Use hex format (e.g., #FF5733)`;\r\n      }\r\n    }\r\n\r\n    // Validate URLs\r\n    if (settings.logo && !/^https?:\\/\\/.+/.test(settings.logo)) {\r\n      return 'Logo URL must be a valid HTTP/HTTPS URL';\r\n    }\r\n    if (settings.favicon && !/^https?:\\/\\/.+/.test(settings.favicon)) {\r\n      return 'Favicon URL must be a valid HTTP/HTTPS URL';\r\n    }\r\n    if (settings.website && !/^https?:\\/\\/.+/.test(settings.website)) {\r\n      return 'Website URL must be a valid HTTP/HTTPS URL';\r\n    }\r\n\r\n    // Validate email\r\n    if (settings.email && !/^\\S+@\\S+\\.\\S+$/.test(settings.email)) {\r\n      return 'Invalid email format';\r\n    }\r\n\r\n    // Validate tax rate\r\n    if (settings.taxEnabled && (settings.taxRate === undefined || settings.taxRate < 0 || settings.taxRate > 100)) {\r\n      return 'Tax rate must be between 0 and 100';\r\n    }\r\n\r\n    // Validate number format\r\n    if (settings.numberFormat) {\r\n      if (settings.numberFormat.decimalPlaces < 0 || settings.numberFormat.decimalPlaces > 4) {\r\n        return 'Decimal places must be between 0 and 4';\r\n      }\r\n    }\r\n\r\n    return null;\r\n  };\r\n\r\n  const handleSave = async () => {\r\n    if (!settings) return;\r\n\r\n    // Validate settings before saving\r\n    const validationError = validateSettings();\r\n    if (validationError) {\r\n      setMessage({ type: 'error', text: validationError });\r\n      return;\r\n    }\r\n\r\n    try {\r\n      setSaving(true);\r\n      setMessage(null);\r\n      const res = await fetch(`/api/tenants/${tenant}/settings`, {\r\n        method: 'PUT',\r\n        headers: { \r\n          'Content-Type': 'application/json',\r\n        },\r\n        credentials: 'include', // Include cookies for authentication\r\n        body: JSON.stringify({ settings }),\r\n      });\r\n\r\n      const data = await res.json();\r\n      if (data.success) {\r\n        setMessage({ type: 'success', text: dict?.settings?.saved || 'Settings saved successfully!' });\r\n        setSettings(data.data);\r\n        // Clear message after 3 seconds\r\n        setTimeout(() => setMessage(null), 3000);\r\n      } else {\r\n        if (res.status === 401 || res.status === 403) {\r\n          setMessage({ type: 'error', text: dict?.settings?.unauthorized || 'Unauthorized. Please login with admin or manager account to save settings.' });\r\n        } else {\r\n          setMessage({ type: 'error', text: data.error || 'Failed to save settings' });\r\n        }\r\n      }\r\n    } catch (error) {\r\n      console.error('Error saving settings:', error);\r\n      setMessage({ type: 'error', text: dict?.common?.failedToSaveSettings || 'Failed to save settings. Please check your connection.' });\r\n    } finally {\r\n      setSaving(false);\r\n    }\r\n  };\r\n\r\n  const handleDetectLocation = async () => {\r\n    await autoDetectLocation();\r\n  };\r\n\r\n  const updateSetting = (path: string, value: any) => {\r\n    if (!settings) return;\r\n    \r\n    const keys = path.split('.');\r\n    const newSettings = JSON.parse(JSON.stringify(settings)); // Deep clone\r\n    let current: any = newSettings;\r\n    \r\n    for (let i = 0; i < keys.length - 1; i++) {\r\n      if (!current[keys[i]]) {\r\n        current[keys[i]] = {};\r\n      }\r\n      current = current[keys[i]];\r\n    }\r\n    \r\n    current[keys[keys.length - 1]] = value;\r\n    \r\n    // If business type is being changed, show warning\r\n    if (path === 'businessType' && value !== settings.businessType) {\r\n      setBusinessTypeWarning(\r\n        `Changing business type to \"${value}\" will automatically configure features. This may enable or disable certain features based on the business type.`\r\n      );\r\n    } else if (path !== 'businessType') {\r\n      setBusinessTypeWarning(null);\r\n    }\r\n    \r\n    setSettings(newSettings);\r\n  };\r\n\r\n  if (!dict || loading) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gray-50 flex items-center justify-center\">\r\n        <div className=\"text-center\">\r\n          <div className=\"inline-block animate-spin h-8 w-8 border-b-2 border-blue-600\"></div>\r\n          <p className=\"mt-4 text-gray-600\">{dict?.settings?.loading || 'Loading settings...'}</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // If settings failed to load, show error but still render form with defaults\r\n  if (!settings) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gray-50\">\r\n        <Navbar />\r\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 sm:py-8\">\r\n          <div className=\"bg-red-50 border-2 border-red-300 p-5 sm:p-6\">\r\n            <h2 className=\"text-xl font-bold text-red-800 mb-2\">{dict?.settings?.failedToLoad || 'Failed to Load Settings'}</h2>\r\n            <p className=\"text-red-700 mb-4\">\r\n              {message?.text || 'Unable to load tenant settings. Please check your connection and try again.'}\r\n            </p>\r\n            <button\r\n              onClick={fetchSettings}\r\n              className=\"px-4 py-2 bg-red-600 text-white hover:bg-red-700 font-medium transition-colors border border-red-700\"\r\n            >\r\n              {dict?.settings?.retry || 'Retry'}\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50\">\r\n      <Navbar />\r\n      <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 sm:py-8\">\r\n        <div className=\"mb-6 sm:mb-8\">\r\n          <h1 className=\"text-2xl sm:text-3xl lg:text-4xl font-bold text-gray-900 mb-2\">\r\n            {dict?.settings?.title || 'Store Settings'}\r\n          </h1>\r\n          <p className=\"text-gray-600\">{dict?.settings?.subtitle || 'Configure your store preferences and branding'}</p>\r\n        </div>\r\n\r\n        {message && (\r\n          <div\r\n            className={`mb-6 p-4 border ${\r\n              message.type === 'success'\r\n                ? 'bg-green-50 text-green-800 border-green-300'\r\n                : 'bg-red-50 text-red-800 border-red-300'\r\n            }`}\r\n          >\r\n            {message.text}\r\n          </div>\r\n        )}\r\n\r\n        <div className=\"bg-white border border-gray-300 overflow-hidden\">\r\n          {/* Tabs */}\r\n          <div className=\"border-b border-gray-200\">\r\n            <nav className=\"flex overflow-x-auto\" aria-label={dict?.common?.tabs || 'Tabs'}>\r\n              <button\r\n                onClick={() => setActiveTab('general')}\r\n                className={`px-6 py-4 text-sm font-medium whitespace-nowrap border-b-2 transition-colors ${\r\n                  activeTab === 'general'\r\n                    ? 'border-blue-600 text-blue-600'\r\n                    : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'\r\n                }`}\r\n              >\r\n                {dict?.settings?.tabs?.general || 'General'}\r\n              </button>\r\n              <button\r\n                onClick={() => setActiveTab('branding')}\r\n                className={`px-6 py-4 text-sm font-medium whitespace-nowrap border-b-2 transition-colors ${\r\n                  activeTab === 'branding'\r\n                    ? 'border-blue-600 text-blue-600'\r\n                    : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'\r\n                }`}\r\n              >\r\n                {dict?.settings?.tabs?.branding || 'Branding'}\r\n              </button>\r\n              <button\r\n                onClick={() => setActiveTab('contact')}\r\n                className={`px-6 py-4 text-sm font-medium whitespace-nowrap border-b-2 transition-colors ${\r\n                  activeTab === 'contact'\r\n                    ? 'border-blue-600 text-blue-600'\r\n                    : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'\r\n                }`}\r\n              >\r\n                {dict?.settings?.tabs?.contact || 'Contact'}\r\n              </button>\r\n              <button\r\n                onClick={() => setActiveTab('receipt')}\r\n                className={`px-6 py-4 text-sm font-medium whitespace-nowrap border-b-2 transition-colors ${\r\n                  activeTab === 'receipt'\r\n                    ? 'border-blue-600 text-blue-600'\r\n                    : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'\r\n                }`}\r\n              >\r\n                {dict?.settings?.tabs?.receipt || 'Receipt'}\r\n              </button>\r\n              <button\r\n                onClick={() => setActiveTab('business')}\r\n                className={`px-6 py-4 text-sm font-medium whitespace-nowrap border-b-2 transition-colors ${\r\n                  activeTab === 'business'\r\n                    ? 'border-blue-600 text-blue-600'\r\n                    : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'\r\n                }`}\r\n              >\r\n                {dict?.settings?.tabs?.business || 'Business'}\r\n              </button>\r\n              <button\r\n                onClick={() => setActiveTab('notifications')}\r\n                className={`px-6 py-4 text-sm font-medium whitespace-nowrap border-b-2 transition-colors ${\r\n                  activeTab === 'notifications'\r\n                    ? 'border-blue-600 text-blue-600'\r\n                    : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'\r\n                }`}\r\n              >\r\n                {dict?.settings?.tabs?.notifications || 'Notifications'}\r\n              </button>\r\n              <button\r\n                onClick={() => setActiveTab('multiCurrency')}\r\n                className={`px-6 py-4 text-sm font-medium whitespace-nowrap border-b-2 transition-colors ${\r\n                  activeTab === 'multiCurrency'\r\n                    ? 'border-blue-600 text-blue-600'\r\n                    : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'\r\n                }`}\r\n              >\r\n                {dict?.settings?.tabs?.multiCurrency || 'Multi-Currency'}\r\n              </button>\r\n            </nav>\r\n          </div>\r\n\r\n          {/* Tab Content */}\r\n          <div className=\"p-5 sm:p-6 lg:p-8\">\r\n            {/* General Tab */}\r\n            {activeTab === 'general' && (\r\n              <div className=\"space-y-8\">\r\n                {/* Currency & Localization */}\r\n                <section>\r\n                  <div className=\"flex items-center justify-between mb-5\">\r\n                    <h2 className=\"text-xl font-bold text-gray-900\">{dict?.settings?.currencyLocalization || 'Currency & Localization'}</h2>\r\n                    <button\r\n                      onClick={handleDetectLocation}\r\n                      disabled={detecting}\r\n                      className=\"px-4 py-2 text-sm font-medium text-blue-600 bg-blue-50 hover:bg-blue-100 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2 border border-blue-300\"\r\n                    >\r\n                      {detecting ? (\r\n                        <>\r\n                          <div className=\"animate-spin h-4 w-4 border-b-2 border-blue-600\"></div>\r\n                          <span>{dict?.settings?.detecting || 'Detecting...'}</span>\r\n                        </>\r\n                      ) : (\r\n                        <>\r\n                          <svg className=\"w-4 h-4\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n                          </svg>\r\n                          <span>{dict?.settings?.detectLocation || 'Auto-Detect Location'}</span>\r\n                        </>\r\n                      )}\r\n                    </button>\r\n                  </div>\r\n                  {detectedInfo && (\r\n                    <div className=\"mb-5 p-3 bg-green-50 border-2 border-green-300 text-sm text-green-800\">\r\n                      <div className=\"flex items-center gap-2\">\r\n                        <svg className=\"w-5 h-5\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n                        </svg>\r\n                        <span>{detectedInfo}</span>\r\n                      </div>\r\n                    </div>\r\n                  )}\r\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                    <div>\r\n                      <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                        Currency Code\r\n                      </label>\r\n                      <input\r\n                        type=\"text\"\r\n                        value={settings.currency || 'USD'}\r\n                        onChange={(e) => {\r\n                          const newCurrency = e.target.value.toUpperCase();\r\n                          updateSetting('currency', newCurrency);\r\n                          // Auto-update currency symbol when currency changes\r\n                          const symbol = getCurrencySymbolForCode(newCurrency);\r\n                          if (symbol !== newCurrency) {\r\n                            updateSetting('currencySymbol', symbol);\r\n                          }\r\n                        }}\r\n                        className=\"w-full px-4 py-3 border-2 border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all bg-white\"\r\n                        placeholder={dict?.settings?.currencyPlaceholder || 'USD'}\r\n                        maxLength={3}\r\n                      />\r\n                    </div>\r\n                    <div>\r\n                      <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                        Currency Symbol\r\n                      </label>\r\n                      <div className=\"relative\">\r\n                        <input\r\n                          type=\"text\"\r\n                          value={settings.currencySymbol || getCurrencySymbolForCode(settings.currency || 'USD')}\r\n                          onChange={(e) => updateSetting('currencySymbol', e.target.value)}\r\n                          className=\"w-full px-4 py-3 border-2 border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all bg-white\"\r\n                          placeholder=\"$\"\r\n                        />\r\n                        {!settings.currencySymbol && (\r\n                          <button\r\n                            type=\"button\"\r\n                            onClick={() => updateSetting('currencySymbol', getCurrencySymbolForCode(settings.currency || 'USD'))}\r\n                            className=\"absolute right-2 top-1/2 -translate-y-1/2 text-xs text-blue-600 hover:text-blue-700 font-medium\"\r\n                            title={dict?.common?.autoFillSymbol || 'Auto-fill symbol'}\r\n                          >\r\n                            Auto\r\n                          </button>\r\n                        )}\r\n                      </div>\r\n                    </div>\r\n                    <div>\r\n                      <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                        Currency Position\r\n                      </label>\r\n                      <select\r\n                        value={settings.currencyPosition || 'before'}\r\n                        onChange={(e) => updateSetting('currencyPosition', e.target.value)}\r\n                        className=\"w-full px-4 py-3 border-2 border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all bg-white\"\r\n                      >\r\n                        <option value=\"before\">Before amount ($100)</option>\r\n                        <option value=\"after\">After amount (100$)</option>\r\n                      </select>\r\n                    </div>\r\n                    <div>\r\n                      <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                        Timezone\r\n                      </label>\r\n                      <input\r\n                        type=\"text\"\r\n                        value={settings.timezone || 'UTC'}\r\n                        onChange={(e) => updateSetting('timezone', e.target.value)}\r\n                        className=\"w-full px-4 py-3 border-2 border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all bg-white\"\r\n                        placeholder={dict?.settings?.timezonePlaceholder || 'America/New_York'}\r\n                        list=\"timezone-suggestions\"\r\n                      />\r\n                      <datalist id=\"timezone-suggestions\">\r\n                        <option value=\"America/New_York\">Eastern Time (US)</option>\r\n                        <option value=\"America/Chicago\">Central Time (US)</option>\r\n                        <option value=\"America/Denver\">Mountain Time (US)</option>\r\n                        <option value=\"America/Los_Angeles\">Pacific Time (US)</option>\r\n                        <option value=\"Europe/London\">London (UK)</option>\r\n                        <option value=\"Europe/Paris\">Paris (France)</option>\r\n                        <option value=\"Europe/Berlin\">Berlin (Germany)</option>\r\n                        <option value=\"Asia/Tokyo\">Tokyo (Japan)</option>\r\n                        <option value=\"Asia/Shanghai\">Shanghai (China)</option>\r\n                        <option value=\"Australia/Sydney\">Sydney (Australia)</option>\r\n                        <option value=\"UTC\">UTC</option>\r\n                      </datalist>\r\n                      <p className=\"mt-2 text-xs text-gray-500\">\r\n                        Detected: {Intl.DateTimeFormat().resolvedOptions().timeZone}\r\n                      </p>\r\n                    </div>\r\n                    <div>\r\n                      <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                        Date Format\r\n                      </label>\r\n                      <select\r\n                        value={settings.dateFormat || 'MM/DD/YYYY'}\r\n                        onChange={(e) => updateSetting('dateFormat', e.target.value)}\r\n                        className=\"w-full px-4 py-3 border-2 border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all bg-white\"\r\n                      >\r\n                        <option value=\"MM/DD/YYYY\">MM/DD/YYYY</option>\r\n                        <option value=\"DD/MM/YYYY\">DD/MM/YYYY</option>\r\n                        <option value=\"YYYY-MM-DD\">YYYY-MM-DD</option>\r\n                      </select>\r\n                    </div>\r\n                    <div>\r\n                      <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                        Time Format\r\n                      </label>\r\n                      <select\r\n                        value={settings.timeFormat || '12h'}\r\n                        onChange={(e) => updateSetting('timeFormat', e.target.value)}\r\n                        className=\"w-full px-4 py-3 border-2 border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all bg-white\"\r\n                      >\r\n                        <option value=\"12h\">12-hour (AM/PM)</option>\r\n                        <option value=\"24h\">24-hour</option>\r\n                      </select>\r\n                    </div>\r\n                    <div>\r\n                      <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                        Language\r\n                      </label>\r\n                      <select\r\n                        value={settings.language || 'en'}\r\n                        onChange={async (e) => {\r\n                          const newLang = e.target.value as 'en' | 'es';\r\n                          updateSetting('language', newLang);\r\n                          \r\n                          // Save settings first\r\n                          try {\r\n                            setSaving(true);\r\n                            setMessage(null);\r\n                            const res = await fetch(`/api/tenants/${tenant}/settings`, {\r\n                              method: 'PUT',\r\n                              headers: { \r\n                                'Content-Type': 'application/json',\r\n                              },\r\n                              credentials: 'include',\r\n                              body: JSON.stringify({ \r\n                                settings: { ...settings, language: newLang } \r\n                              }),\r\n                            });\r\n\r\n                            const data = await res.json();\r\n                            if (data.success) {\r\n                              // Redirect to new language\r\n                              const currentPath = window.location.pathname.replace(`/${tenant}/${lang}`, '') || '/';\r\n                              router.push(`/${tenant}/${newLang}${currentPath}`);\r\n                            } else {\r\n                              setMessage({ type: 'error', text: data.error || 'Failed to save language setting' });\r\n                            }\r\n                          } catch (error) {\r\n                            console.error('Error saving language:', error);\r\n                            setMessage({ type: 'error', text: dict?.common?.failedToSaveLanguageSetting || 'Failed to save language setting' });\r\n                          } finally {\r\n                            setSaving(false);\r\n                          }\r\n                        }}\r\n                        className=\"w-full px-4 py-3 border-2 border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all bg-white\"\r\n                      >\r\n                        <option value=\"en\">English</option>\r\n                        <option value=\"es\">Espaol</option>\r\n                      </select>\r\n                      <p className=\"mt-2 text-xs text-gray-500\">\r\n                        Changing language will save settings and reload the page\r\n                      </p>\r\n                    </div>\r\n                    <div>\r\n                      <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                        Decimal Separator\r\n                      </label>\r\n                      <select\r\n                        value={settings.numberFormat?.decimalSeparator || '.'}\r\n                        onChange={(e) => updateSetting('numberFormat.decimalSeparator', e.target.value)}\r\n                        className=\"w-full px-4 py-3 border-2 border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all bg-white\"\r\n                      >\r\n                        <option value=\".\">Period (.)</option>\r\n                        <option value=\",\">Comma (,)</option>\r\n                      </select>\r\n                    </div>\r\n                    <div>\r\n                      <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                        Thousands Separator\r\n                      </label>\r\n                      <select\r\n                        value={settings.numberFormat?.thousandsSeparator || ','}\r\n                        onChange={(e) => updateSetting('numberFormat.thousandsSeparator', e.target.value)}\r\n                        className=\"w-full px-4 py-3 border-2 border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all bg-white\"\r\n                      >\r\n                        <option value=\",\">Comma (,)</option>\r\n                        <option value=\".\">Period (.)</option>\r\n                        <option value=\" \">Space ( )</option>\r\n                        <option value=\"\">None</option>\r\n                      </select>\r\n                    </div>\r\n                    <div>\r\n                      <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                        Decimal Places\r\n                      </label>\r\n                      <input\r\n                        type=\"number\"\r\n                        min=\"0\"\r\n                        max=\"4\"\r\n                        value={settings.numberFormat?.decimalPlaces || 2}\r\n                        onChange={(e) => updateSetting('numberFormat.decimalPlaces', parseInt(e.target.value) || 2)}\r\n                        className=\"w-full px-4 py-3 border-2 border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all bg-white\"\r\n                      />\r\n                    </div>\r\n                  </div>\r\n                </section>\r\n\r\n                {/* Tax Settings */}\r\n                <section>\r\n                  <h2 className=\"text-xl font-bold text-gray-900 mb-5\">{dict?.settings?.taxSettings || 'Tax Settings'}</h2>\r\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                    <div className=\"flex items-center\">\r\n                      <input\r\n                        type=\"checkbox\"\r\n                        id=\"taxEnabled\"\r\n                        checked={settings.taxEnabled || false}\r\n                        onChange={(e) => updateSetting('taxEnabled', e.target.checked)}\r\n                        className=\"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 cursor-pointer\"\r\n                      />\r\n                      <label htmlFor=\"taxEnabled\" className=\"ml-2 text-sm font-medium text-gray-700\">\r\n                        Enable Tax\r\n                      </label>\r\n                    </div>\r\n                    {settings.taxEnabled && (\r\n                      <>\r\n                        <div>\r\n                          <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                            Tax Rate (%)\r\n                          </label>\r\n                          <input\r\n                            type=\"number\"\r\n                            min=\"0\"\r\n                            max=\"100\"\r\n                            step=\"0.01\"\r\n                            value={settings.taxRate || 0}\r\n                            onChange={(e) => updateSetting('taxRate', parseFloat(e.target.value) || 0)}\r\n                            className=\"w-full px-4 py-3 border-2 border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all bg-white\"\r\n                          />\r\n                        </div>\r\n                        <div>\r\n                          <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                            Tax Label\r\n                          </label>\r\n                          <input\r\n                            type=\"text\"\r\n                            value={settings.taxLabel || 'Tax'}\r\n                            onChange={(e) => updateSetting('taxLabel', e.target.value)}\r\n                            className=\"w-full px-4 py-3 border-2 border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all bg-white\"\r\n                            placeholder={dict?.settings?.taxNamePlaceholder || 'VAT, GST, Sales Tax'}\r\n                          />\r\n                        </div>\r\n                      </>\r\n                    )}\r\n                  </div>\r\n                </section>\r\n              </div>\r\n            )}\r\n\r\n            {/* Branding Tab */}\r\n            {activeTab === 'branding' && (\r\n              <section className=\"space-y-8\">\r\n                <div>\r\n                  <h2 className=\"text-xl font-bold text-gray-900 mb-5\">{dict?.settings?.basicBranding || 'Basic Branding'}</h2>\r\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                  <div>\r\n                    <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                      Company Name\r\n                    </label>\r\n                    <input\r\n                      type=\"text\"\r\n                      value={settings.companyName || ''}\r\n                      onChange={(e) => updateSetting('companyName', e.target.value)}\r\n                      className=\"w-full px-4 py-3 border-2 border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all bg-white\"\r\n                    />\r\n                  </div>\r\n                  <div>\r\n                    <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                      Logo URL\r\n                    </label>\r\n                    <input\r\n                      type=\"url\"\r\n                      value={settings.logo || ''}\r\n                      onChange={(e) => updateSetting('logo', e.target.value)}\r\n                      className=\"w-full px-4 py-3 border-2 border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all bg-white\"\r\n                      placeholder=\"https://example.com/logo.png\"\r\n                    />\r\n                  </div>\r\n                  <div>\r\n                    <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                      Favicon URL\r\n                    </label>\r\n                    <input\r\n                      type=\"url\"\r\n                      value={settings.favicon || ''}\r\n                      onChange={(e) => updateSetting('favicon', e.target.value)}\r\n                      className=\"w-full px-4 py-3 border-2 border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all bg-white\"\r\n                      placeholder=\"https://example.com/favicon.ico\"\r\n                    />\r\n                  </div>\r\n                  <div>\r\n                    <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                      Primary Color\r\n                    </label>\r\n                    <div className=\"flex gap-2\">\r\n                      <input\r\n                        type=\"color\"\r\n                        value={settings.primaryColor || '#2563eb'}\r\n                        onChange={(e) => updateSetting('primaryColor', e.target.value)}\r\n                        className=\"h-10 w-20 border-2 border-gray-300 cursor-pointer bg-white\"\r\n                      />\r\n                      <input\r\n                        type=\"text\"\r\n                        value={settings.primaryColor || '#2563eb'}\r\n                        onChange={(e) => updateSetting('primaryColor', e.target.value)}\r\n                        className=\"flex-1 px-4 py-3 border-2 border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all bg-white\"\r\n                        placeholder=\"#2563eb\"\r\n                      />\r\n                    </div>\r\n                  </div>\r\n                  <div>\r\n                    <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                      Secondary Color\r\n                    </label>\r\n                    <div className=\"flex gap-2\">\r\n                      <input\r\n                        type=\"color\"\r\n                        value={settings.secondaryColor || '#64748b'}\r\n                        onChange={(e) => updateSetting('secondaryColor', e.target.value)}\r\n                        className=\"h-10 w-20 border-2 border-gray-300 cursor-pointer bg-white\"\r\n                      />\r\n                      <input\r\n                        type=\"text\"\r\n                        value={settings.secondaryColor || ''}\r\n                        onChange={(e) => updateSetting('secondaryColor', e.target.value)}\r\n                        className=\"flex-1 px-4 py-3 border-2 border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all bg-white\"\r\n                        placeholder=\"#64748b\"\r\n                      />\r\n                    </div>\r\n                  </div>\r\n                  <div>\r\n                    <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                      Accent Color\r\n                    </label>\r\n                    <div className=\"flex gap-2\">\r\n                      <input\r\n                        type=\"color\"\r\n                        value={settings.accentColor || '#10b981'}\r\n                        onChange={(e) => updateSetting('accentColor', e.target.value)}\r\n                        className=\"h-10 w-20 border-2 border-gray-300 cursor-pointer bg-white\"\r\n                      />\r\n                      <input\r\n                        type=\"text\"\r\n                        value={settings.accentColor || ''}\r\n                        onChange={(e) => updateSetting('accentColor', e.target.value)}\r\n                        className=\"flex-1 px-4 py-3 border-2 border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all bg-white\"\r\n                        placeholder=\"#10b981\"\r\n                      />\r\n                    </div>\r\n                  </div>\r\n                  <div>\r\n                    <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                      Background Color\r\n                    </label>\r\n                    <div className=\"flex gap-2\">\r\n                      <input\r\n                        type=\"color\"\r\n                        value={settings.backgroundColor || '#ffffff'}\r\n                        onChange={(e) => updateSetting('backgroundColor', e.target.value)}\r\n                        className=\"h-10 w-20 border-2 border-gray-300 cursor-pointer bg-white\"\r\n                      />\r\n                      <input\r\n                        type=\"text\"\r\n                        value={settings.backgroundColor || ''}\r\n                        onChange={(e) => updateSetting('backgroundColor', e.target.value)}\r\n                        className=\"flex-1 px-4 py-3 border-2 border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all bg-white\"\r\n                        placeholder=\"#ffffff\"\r\n                      />\r\n                    </div>\r\n                  </div>\r\n                  <div>\r\n                    <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                      Text Color\r\n                    </label>\r\n                    <div className=\"flex gap-2\">\r\n                      <input\r\n                        type=\"color\"\r\n                        value={settings.textColor || '#111827'}\r\n                        onChange={(e) => updateSetting('textColor', e.target.value)}\r\n                        className=\"h-10 w-20 border-2 border-gray-300 cursor-pointer bg-white\"\r\n                      />\r\n                      <input\r\n                        type=\"text\"\r\n                        value={settings.textColor || ''}\r\n                        onChange={(e) => updateSetting('textColor', e.target.value)}\r\n                        className=\"flex-1 px-4 py-3 border-2 border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all bg-white\"\r\n                        placeholder=\"#111827\"\r\n                      />\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n                </div>\r\n\r\n                {/* Advanced Branding Section - Moved to Admin */}\r\n                <div className=\"pt-8 mt-8 border-t-2 border-gray-200\">\r\n                  <div className=\"p-4 bg-blue-50 border border-blue-200 rounded\">\r\n                    <h3 className=\"text-lg font-semibold text-gray-900 mb-2\">{dict?.settings?.advancedBranding || 'Advanced Branding'}</h3>\r\n                    <p className=\"text-sm text-blue-800 mb-3\">\r\n                      Advanced branding features (custom fonts, themes, CSS) have been moved to Admin  Advanced Branding for better access control.\r\n                    </p>\r\n                    <Link\r\n                      href={`/${tenant}/${lang}/admin/advanced-branding`}\r\n                      className=\"inline-flex items-center px-4 py-2 bg-blue-600 text-white text-sm font-medium hover:bg-blue-700 transition-colors\"\r\n                    >\r\n                      {dict?.admin?.advancedBranding || 'Advanced Branding'} \r\n                    </Link>\r\n                  </div>\r\n                </div>\r\n              </section>\r\n            )}\r\n\r\n            {/* Contact Tab */}\r\n            {activeTab === 'contact' && (\r\n              <section>\r\n                <h2 className=\"text-xl font-bold text-gray-900 mb-5\">{dict?.settings?.contactInformation || 'Contact Information'}</h2>\r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                  <div>\r\n                    <label className=\"block text-sm font-medium text-gray-700 mb-1\">Email</label>\r\n                    <input\r\n                      type=\"email\"\r\n                      value={settings.email || ''}\r\n                      onChange={(e) => updateSetting('email', e.target.value)}\r\n                      className=\"w-full px-4 py-3 border-2 border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all bg-white\"\r\n                    />\r\n                  </div>\r\n                  <div>\r\n                    <label className=\"block text-sm font-medium text-gray-700 mb-1\">Phone</label>\r\n                    <input\r\n                      type=\"tel\"\r\n                      value={settings.phone || ''}\r\n                      onChange={(e) => updateSetting('phone', e.target.value)}\r\n                      className=\"w-full px-4 py-3 border-2 border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all bg-white\"\r\n                    />\r\n                  </div>\r\n                  <div className=\"md:col-span-2\">\r\n                    <label className=\"block text-sm font-medium text-gray-700 mb-1\">Street Address</label>\r\n                    <input\r\n                      type=\"text\"\r\n                      value={settings.address?.street || ''}\r\n                      onChange={(e) => updateSetting('address.street', e.target.value)}\r\n                      className=\"w-full px-4 py-3 border-2 border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all bg-white\"\r\n                    />\r\n                  </div>\r\n                  <div>\r\n                    <label className=\"block text-sm font-medium text-gray-700 mb-1\">City</label>\r\n                    <input\r\n                      type=\"text\"\r\n                      value={settings.address?.city || ''}\r\n                      onChange={(e) => updateSetting('address.city', e.target.value)}\r\n                      className=\"w-full px-4 py-3 border-2 border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all bg-white\"\r\n                    />\r\n                  </div>\r\n                  <div>\r\n                    <label className=\"block text-sm font-medium text-gray-700 mb-1\">State/Province</label>\r\n                    <input\r\n                      type=\"text\"\r\n                      value={settings.address?.state || ''}\r\n                      onChange={(e) => updateSetting('address.state', e.target.value)}\r\n                      className=\"w-full px-4 py-3 border-2 border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all bg-white\"\r\n                    />\r\n                  </div>\r\n                  <div>\r\n                    <label className=\"block text-sm font-medium text-gray-700 mb-1\">ZIP/Postal Code</label>\r\n                    <input\r\n                      type=\"text\"\r\n                      value={settings.address?.zipCode || ''}\r\n                      onChange={(e) => updateSetting('address.zipCode', e.target.value)}\r\n                      className=\"w-full px-4 py-3 border-2 border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all bg-white\"\r\n                    />\r\n                  </div>\r\n                  <div>\r\n                    <label className=\"block text-sm font-medium text-gray-700 mb-1\">Country</label>\r\n                    <input\r\n                      type=\"text\"\r\n                      value={settings.address?.country || ''}\r\n                      onChange={(e) => updateSetting('address.country', e.target.value)}\r\n                      className=\"w-full px-4 py-3 border-2 border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all bg-white\"\r\n                    />\r\n                  </div>\r\n                  <div>\r\n                    <label className=\"block text-sm font-medium text-gray-700 mb-1\">Website</label>\r\n                    <input\r\n                      type=\"url\"\r\n                      value={settings.website || ''}\r\n                      onChange={(e) => updateSetting('website', e.target.value)}\r\n                      className=\"w-full px-4 py-3 border-2 border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all bg-white\"\r\n                      placeholder=\"https://example.com\"\r\n                    />\r\n                  </div>\r\n                </div>\r\n              </section>\r\n            )}\r\n\r\n            {/* Receipt Tab */}\r\n            {activeTab === 'receipt' && (\r\n              <section>\r\n                <h2 className=\"text-xl font-bold text-gray-900 mb-5\">{dict?.settings?.receiptInvoiceSettings || 'Receipt & Invoice Settings'}</h2>\r\n                <div className=\"space-y-6\">\r\n                  <div>\r\n                    <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                      Receipt Header\r\n                    </label>\r\n                    <textarea\r\n                      value={settings.receiptHeader || ''}\r\n                      onChange={(e) => updateSetting('receiptHeader', e.target.value)}\r\n                      rows={3}\r\n                      className=\"w-full px-4 py-3 border-2 border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all bg-white\"\r\n                      placeholder={dict?.settings?.receiptHeaderPlaceholder || 'Custom header text to appear at the top of receipts'}\r\n                    />\r\n                  </div>\r\n                  <div>\r\n                    <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                      Receipt Footer\r\n                    </label>\r\n                    <textarea\r\n                      value={settings.receiptFooter || ''}\r\n                      onChange={(e) => updateSetting('receiptFooter', e.target.value)}\r\n                      rows={3}\r\n                      className=\"w-full px-4 py-3 border-2 border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all bg-white\"\r\n                      placeholder={dict?.settings?.receiptFooterPlaceholder || 'Custom footer text to appear at the bottom of receipts'}\r\n                    />\r\n                  </div>\r\n                  <div>\r\n                    <h3 className=\"text-lg font-semibold text-gray-900 mb-3\">Display Options</h3>\r\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                      <div className=\"flex items-center p-4 border-2 border-gray-300 hover:bg-gray-50 transition-colors\">\r\n                        <input\r\n                          type=\"checkbox\"\r\n                          id=\"receiptShowLogo\"\r\n                          checked={settings.receiptShowLogo !== false}\r\n                          onChange={(e) => updateSetting('receiptShowLogo', e.target.checked)}\r\n                          className=\"h-5 w-5 text-blue-600 focus:ring-blue-500 border-gray-300 cursor-pointer\"\r\n                        />\r\n                        <label htmlFor=\"receiptShowLogo\" className=\"ml-3 text-sm font-medium text-gray-700\">\r\n                          Show Logo on Receipts\r\n                        </label>\r\n                      </div>\r\n                      <div className=\"flex items-center p-4 border-2 border-gray-300 hover:bg-gray-50 transition-colors\">\r\n                        <input\r\n                          type=\"checkbox\"\r\n                          id=\"receiptShowAddress\"\r\n                          checked={settings.receiptShowAddress !== false}\r\n                          onChange={(e) => updateSetting('receiptShowAddress', e.target.checked)}\r\n                          className=\"h-5 w-5 text-blue-600 focus:ring-blue-500 border-gray-300 cursor-pointer\"\r\n                        />\r\n                        <label htmlFor=\"receiptShowAddress\" className=\"ml-3 text-sm font-medium text-gray-700\">\r\n                          Show Address on Receipts\r\n                        </label>\r\n                      </div>\r\n                      <div className=\"flex items-center p-4 border-2 border-gray-300 hover:bg-gray-50 transition-colors\">\r\n                        <input\r\n                          type=\"checkbox\"\r\n                          id=\"receiptShowPhone\"\r\n                          checked={settings.receiptShowPhone || false}\r\n                          onChange={(e) => updateSetting('receiptShowPhone', e.target.checked)}\r\n                          className=\"h-5 w-5 text-blue-600 focus:ring-blue-500 border-gray-300 cursor-pointer\"\r\n                        />\r\n                        <label htmlFor=\"receiptShowPhone\" className=\"ml-3 text-sm font-medium text-gray-700\">\r\n                          Show Phone on Receipts\r\n                        </label>\r\n                      </div>\r\n                      <div className=\"flex items-center p-4 border-2 border-gray-300 hover:bg-gray-50 transition-colors\">\r\n                        <input\r\n                          type=\"checkbox\"\r\n                          id=\"receiptShowEmail\"\r\n                          checked={settings.receiptShowEmail || false}\r\n                          onChange={(e) => updateSetting('receiptShowEmail', e.target.checked)}\r\n                          className=\"h-5 w-5 text-blue-600 focus:ring-blue-500 border-gray-300 cursor-pointer\"\r\n                        />\r\n                        <label htmlFor=\"receiptShowEmail\" className=\"ml-3 text-sm font-medium text-gray-700\">\r\n                          Show Email on Receipts\r\n                        </label>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Receipt Templates Section */}\r\n                <div className=\"mt-8 pt-8 border-t-2 border-gray-200\">\r\n                  <ReceiptTemplatesManager\r\n                    settings={settings}\r\n                    tenant={tenant}\r\n                    onUpdate={(updates) => {\r\n                      setSettings({ ...settings, ...updates });\r\n                    }}\r\n                  />\r\n                </div>\r\n              </section>\r\n            )}\r\n\r\n            {/* Business Tab */}\r\n            {activeTab === 'business' && (\r\n              <section>\r\n                <h2 className=\"text-xl font-bold text-gray-900 mb-5\">{dict?.settings?.businessInformation || 'Business Information'}</h2>\r\n                \r\n                {businessTypeWarning && (\r\n                  <div className=\"mb-6 p-4 bg-yellow-50 border-2 border-yellow-300 text-yellow-800 text-sm\">\r\n                    <div className=\"flex items-start gap-2\">\r\n                      <svg className=\"w-5 h-5 flex-shrink-0 mt-0.5\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z\" />\r\n                      </svg>\r\n                      <div>\r\n                        <strong>Note:</strong> {businessTypeWarning}\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                )}\r\n\r\n                <div className=\"space-y-6\">\r\n                  {/* Business Type Selection */}\r\n                  <div>\r\n                    <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                      Business Type <span className=\"text-red-500\">*</span>\r\n                    </label>\r\n                    {loadingBusinessTypes ? (\r\n                      <div className=\"w-full px-4 py-3 border-2 border-gray-300 bg-gray-50 flex items-center gap-2\">\r\n                        <div className=\"w-5 h-5 border-2 border-gray-400 border-t-transparent animate-spin\"></div>\r\n                        <span className=\"text-sm text-gray-600\">Loading business types...</span>\r\n                      </div>\r\n                    ) : (\r\n                      <>\r\n                        <select\r\n                          value={settings.businessType || 'general'}\r\n                          onChange={(e) => updateSetting('businessType', e.target.value)}\r\n                          className=\"w-full px-4 py-3 border-2 border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all bg-white\"\r\n                        >\r\n                          {businessTypes.map((type) => (\r\n                            <option key={type.type} value={type.type}>\r\n                              {type.name}\r\n                            </option>\r\n                          ))}\r\n                        </select>\r\n                        {settings.businessType && !loadingBusinessTypes && (\r\n                          <div className=\"mt-3 p-4 bg-blue-50 border-2 border-blue-200\">\r\n                            <p className=\"text-sm text-blue-900 font-medium mb-2\">\r\n                              {businessTypes.find((t) => t.type === settings.businessType)?.name || 'Business Type'}\r\n                            </p>\r\n                            <p className=\"text-xs text-blue-700 mb-3\">\r\n                              {businessTypes.find((t) => t.type === settings.businessType)?.description || ''}\r\n                            </p>\r\n                            <div className=\"mt-3 pt-3 border-t border-blue-300\">\r\n                              <p className=\"text-xs font-medium text-blue-900 mb-2\">Default Features:</p>\r\n                              <div className=\"grid grid-cols-2 md:grid-cols-3 gap-2\">\r\n                                {businessTypes.find((t) => t.type === settings.businessType)?.defaultFeatures && Object.entries(\r\n                                  businessTypes.find((t) => t.type === settings.businessType)?.defaultFeatures || {}\r\n                                ).map(([feature, enabled]) => (\r\n                                  <div key={feature} className=\"flex items-center gap-2\">\r\n                                    <svg\r\n                                      className={`w-4 h-4 ${enabled ? 'text-green-600' : 'text-gray-400'}`}\r\n                                      fill=\"none\"\r\n                                      viewBox=\"0 0 24 24\"\r\n                                      stroke=\"currentColor\"\r\n                                    >\r\n                                      {enabled ? (\r\n                                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M5 13l4 4L19 7\" />\r\n                                      ) : (\r\n                                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\r\n                                      )}\r\n                                    </svg>\r\n                                    <span className={`text-xs ${enabled ? 'text-green-700' : 'text-gray-500'}`}>\r\n                                      {feature.replace(/([A-Z])/g, ' $1').replace(/^./, str => str.toUpperCase())}\r\n                                    </span>\r\n                                  </div>\r\n                                ))}\r\n                              </div>\r\n                            </div>\r\n                          </div>\r\n                        )}\r\n                      </>\r\n                    )}\r\n                  </div>\r\n\r\n                  {/* Business Details */}\r\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                    <div>\r\n                      <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                        Tax ID / EIN\r\n                      </label>\r\n                      <input\r\n                        type=\"text\"\r\n                        value={settings.taxId || ''}\r\n                        onChange={(e) => updateSetting('taxId', e.target.value)}\r\n                        className=\"w-full px-4 py-3 border-2 border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all bg-white\"\r\n                        placeholder=\"12-3456789\"\r\n                      />\r\n                    </div>\r\n                    <div>\r\n                      <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                        Registration Number\r\n                      </label>\r\n                      <input\r\n                        type=\"text\"\r\n                        value={settings.registrationNumber || ''}\r\n                        onChange={(e) => updateSetting('registrationNumber', e.target.value)}\r\n                        className=\"w-full px-4 py-3 border-2 border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all bg-white\"\r\n                        placeholder={dict?.settings?.registrationNumberPlaceholder || 'Business registration number'}\r\n                      />\r\n                    </div>\r\n                  </div>\r\n\r\n                  {/* Feature Flags Section */}\r\n                  {settings.businessType && (\r\n                    <div className=\"mt-6 pt-6 border-t-2 border-gray-200\">\r\n                      <h3 className=\"text-lg font-semibold text-gray-900 mb-4\">Feature Configuration</h3>\r\n                      <p className=\"text-sm text-gray-600 mb-4\">\r\n                        These features are automatically configured based on your business type. You can override them if needed.\r\n                      </p>\r\n                      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                        <div className=\"flex items-center p-4 border-2 border-gray-300 hover:bg-gray-50 transition-colors\">\r\n                          <input\r\n                            type=\"checkbox\"\r\n                            id=\"enableInventory\"\r\n                            checked={settings.enableInventory !== false}\r\n                            onChange={(e) => updateSetting('enableInventory', e.target.checked)}\r\n                            className=\"h-5 w-5 text-blue-600 focus:ring-blue-500 border-gray-300 cursor-pointer\"\r\n                          />\r\n                          <label htmlFor=\"enableInventory\" className=\"ml-3 flex-1\">\r\n                            <div className=\"text-sm font-medium text-gray-900\">Inventory Management</div>\r\n                            <div className=\"text-xs text-gray-500 mt-1\">Track product stock levels</div>\r\n                          </label>\r\n                        </div>\r\n                        <div className=\"flex items-center p-4 border-2 border-gray-300 hover:bg-gray-50 transition-colors\">\r\n                          <input\r\n                            type=\"checkbox\"\r\n                            id=\"enableCategories\"\r\n                            checked={settings.enableCategories !== false}\r\n                            onChange={(e) => updateSetting('enableCategories', e.target.checked)}\r\n                            className=\"h-5 w-5 text-blue-600 focus:ring-blue-500 border-gray-300 cursor-pointer\"\r\n                          />\r\n                          <label htmlFor=\"enableCategories\" className=\"ml-3 flex-1\">\r\n                            <div className=\"text-sm font-medium text-gray-900\">Categories</div>\r\n                            <div className=\"text-xs text-gray-500 mt-1\">Organize products by categories</div>\r\n                          </label>\r\n                        </div>\r\n                        <div className=\"flex items-center p-4 border-2 border-gray-300 hover:bg-gray-50 transition-colors\">\r\n                          <input\r\n                            type=\"checkbox\"\r\n                            id=\"enableDiscounts\"\r\n                            checked={settings.enableDiscounts || false}\r\n                            onChange={(e) => updateSetting('enableDiscounts', e.target.checked)}\r\n                            className=\"h-5 w-5 text-blue-600 focus:ring-blue-500 border-gray-300 cursor-pointer\"\r\n                          />\r\n                          <label htmlFor=\"enableDiscounts\" className=\"ml-3 flex-1\">\r\n                            <div className=\"text-sm font-medium text-gray-900\">Discounts & Promotions</div>\r\n                            <div className=\"text-xs text-gray-500 mt-1\">Create discount codes and promotions</div>\r\n                          </label>\r\n                        </div>\r\n                        <div className=\"flex items-center p-4 border-2 border-gray-300 hover:bg-gray-50 transition-colors\">\r\n                          <input\r\n                            type=\"checkbox\"\r\n                            id=\"enableLoyaltyProgram\"\r\n                            checked={settings.enableLoyaltyProgram || false}\r\n                            onChange={(e) => updateSetting('enableLoyaltyProgram', e.target.checked)}\r\n                            className=\"h-5 w-5 text-blue-600 focus:ring-blue-500 border-gray-300 cursor-pointer\"\r\n                          />\r\n                          <label htmlFor=\"enableLoyaltyProgram\" className=\"ml-3 flex-1\">\r\n                            <div className=\"text-sm font-medium text-gray-900\">Loyalty Program</div>\r\n                            <div className=\"text-xs text-gray-500 mt-1\">Customer loyalty and rewards</div>\r\n                          </label>\r\n                        </div>\r\n                        <div className=\"flex items-center p-4 border-2 border-gray-300 hover:bg-gray-50 transition-colors\">\r\n                          <input\r\n                            type=\"checkbox\"\r\n                            id=\"enableCustomerManagement\"\r\n                            checked={settings.enableCustomerManagement || false}\r\n                            onChange={(e) => updateSetting('enableCustomerManagement', e.target.checked)}\r\n                            className=\"h-5 w-5 text-blue-600 focus:ring-blue-500 border-gray-300 cursor-pointer\"\r\n                          />\r\n                          <label htmlFor=\"enableCustomerManagement\" className=\"ml-3 flex-1\">\r\n                            <div className=\"text-sm font-medium text-gray-900\">Customer Management</div>\r\n                            <div className=\"text-xs text-gray-500 mt-1\">Manage customer profiles and history</div>\r\n                          </label>\r\n                        </div>\r\n                        <div className=\"flex items-center p-4 border-2 border-gray-300 hover:bg-gray-50 transition-colors\">\r\n                          <input\r\n                            type=\"checkbox\"\r\n                            id=\"enableBookingScheduling\"\r\n                            checked={settings.enableBookingScheduling || false}\r\n                            onChange={(e) => updateSetting('enableBookingScheduling', e.target.checked)}\r\n                            className=\"h-5 w-5 text-blue-600 focus:ring-blue-500 border-gray-300 cursor-pointer\"\r\n                          />\r\n                          <label htmlFor=\"enableBookingScheduling\" className=\"ml-3 flex-1\">\r\n                            <div className=\"text-sm font-medium text-gray-900\">Booking & Scheduling</div>\r\n                            <div className=\"text-xs text-gray-500 mt-1\">Appointment and service scheduling</div>\r\n                          </label>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              </section>\r\n            )}\r\n\r\n            {/* Notifications Tab */}\r\n            {activeTab === 'notifications' && (\r\n              <section>\r\n                <h2 className=\"text-xl font-bold text-gray-900 mb-5\">{dict?.settings?.notificationSettings || 'Notification Settings'}</h2>\r\n                <p className=\"text-sm text-gray-600 mb-6\">\r\n                  {dict?.settings?.configureNotificationPreferences || 'Configure notification preferences and alert thresholds'}\r\n                </p>\r\n                <div className=\"space-y-6\">\r\n                  <div className=\"p-4 bg-blue-50 border border-blue-200 rounded\">\r\n                    <p className=\"text-sm text-blue-800 mb-2\">\r\n                      <strong>Note:</strong> Notification template customization has been moved to Admin  Notification Templates for better access control.\r\n                    </p>\r\n                    <Link\r\n                      href={`/${tenant}/${lang}/admin/notification-templates`}\r\n                      className=\"text-sm text-blue-600 hover:text-blue-700 font-medium underline\"\r\n                    >\r\n                      Customize Templates \r\n                    </Link>\r\n                  </div>\r\n                  <div>\r\n                    <h3 className=\"text-lg font-semibold text-gray-900 mb-3\">{dict?.settings?.stockAlerts || 'Stock Alerts'}</h3>\r\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                      <div>\r\n                        <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                          Low Stock Threshold\r\n                        </label>\r\n                        <input\r\n                          type=\"number\"\r\n                          min=\"0\"\r\n                          value={settings.lowStockThreshold || 10}\r\n                          onChange={(e) => updateSetting('lowStockThreshold', parseInt(e.target.value) || 10)}\r\n                          className=\"w-full px-4 py-3 border-2 border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all bg-white\"\r\n                        />\r\n                        <p className=\"mt-2 text-xs text-gray-500\">\r\n                          Alert when stock falls below this quantity\r\n                        </p>\r\n                      </div>\r\n                      <div className=\"flex items-center p-4 border-2 border-gray-300 hover:bg-gray-50 transition-colors\">\r\n                        <input\r\n                          type=\"checkbox\"\r\n                          id=\"lowStockAlert\"\r\n                          checked={settings.lowStockAlert !== false}\r\n                          onChange={(e) => updateSetting('lowStockAlert', e.target.checked)}\r\n                          className=\"h-5 w-5 text-blue-600 focus:ring-blue-500 border-gray-300 cursor-pointer\"\r\n                        />\r\n                        <label htmlFor=\"lowStockAlert\" className=\"ml-3 flex-1\">\r\n                          <div className=\"text-sm font-medium text-gray-900\">\r\n                            {dict?.settings?.enableLowStockAlerts || 'Enable Low Stock Alerts'}\r\n                          </div>\r\n                          <div className=\"text-xs text-gray-500 mt-1\">\r\n                            Get notified when products fall below threshold\r\n                          </div>\r\n                        </label>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                  <div>\r\n                    <h3 className=\"text-lg font-semibold text-gray-900 mb-3\">{dict?.settings?.notificationChannels || 'Notification Channels'}</h3>\r\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                      <div className=\"flex items-center p-4 border-2 border-gray-300 hover:bg-gray-50 transition-colors\">\r\n                        <input\r\n                          type=\"checkbox\"\r\n                          id=\"emailNotifications\"\r\n                          checked={settings.emailNotifications || false}\r\n                          onChange={(e) => updateSetting('emailNotifications', e.target.checked)}\r\n                          className=\"h-5 w-5 text-blue-600 focus:ring-blue-500 border-gray-300 cursor-pointer\"\r\n                        />\r\n                        <label htmlFor=\"emailNotifications\" className=\"ml-3 flex-1\">\r\n                          <div className=\"text-sm font-medium text-gray-900\">\r\n                            Enable Email Notifications\r\n                          </div>\r\n                          <div className=\"text-xs text-gray-500 mt-1\">\r\n                            Receive notifications via email\r\n                          </div>\r\n                        </label>\r\n                      </div>\r\n                      <div className=\"flex items-center p-4 border-2 border-gray-300 hover:bg-gray-50 transition-colors\">\r\n                        <input\r\n                          type=\"checkbox\"\r\n                          id=\"smsNotifications\"\r\n                          checked={settings.smsNotifications || false}\r\n                          onChange={(e) => updateSetting('smsNotifications', e.target.checked)}\r\n                          className=\"h-5 w-5 text-blue-600 focus:ring-blue-500 border-gray-300 cursor-pointer\"\r\n                        />\r\n                        <label htmlFor=\"smsNotifications\" className=\"ml-3 flex-1\">\r\n                          <div className=\"text-sm font-medium text-gray-900\">\r\n                            Enable SMS Notifications\r\n                          </div>\r\n                          <div className=\"text-xs text-gray-500 mt-1\">\r\n                            Receive notifications via SMS\r\n                          </div>\r\n                        </label>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </section>\r\n            )}\r\n\r\n\r\n            {/* Multi-Currency Tab */}\r\n            {activeTab === 'multiCurrency' && (\r\n              <section>\r\n                <div className=\"mb-6\">\r\n                  <h2 className=\"text-xl font-bold text-gray-900 mb-2\">{dict?.settings?.multiCurrencySettings || 'Multi-Currency Settings'}</h2>\r\n                  <p className=\"text-sm text-gray-600\">\r\n                    {dict?.settings?.multiCurrencySettingsSubtitle || 'Configure which currencies to display'}\r\n                  </p>\r\n                </div>\r\n                <MultiCurrencyDisplaySettings\r\n                  settings={settings}\r\n                  tenant={tenant}\r\n                  lang={lang}\r\n                  onUpdate={(updates) => {\r\n                    setSettings({ ...settings, ...updates });\r\n                  }}\r\n                />\r\n              </section>\r\n            )}\r\n\r\n            {/* Save Button */}\r\n            <div className=\"flex justify-end pt-6 mt-8 border-t border-gray-200\">\r\n                <button\r\n                  onClick={handleSave}\r\n                  disabled={saving}\r\n                  className=\"px-6 py-3 bg-blue-600 text-white hover:bg-blue-700 font-semibold transition-all duration-200 border border-blue-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2\"\r\n                >\r\n                  {saving ? (\r\n                    <>\r\n                      <div className=\"animate-spin h-5 w-5 border-b-2 border-white\"></div>\r\n                      <span>{dict?.settings?.saving || 'Saving...'}</span>\r\n                    </>\r\n                  ) : (\r\n                    <>\r\n                      <svg className=\"w-5 h-5\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M5 13l4 4L19 7\" />\r\n                      </svg>\r\n                      <span>{dict?.settings?.save || 'Save Settings'}</span>\r\n                    </>\r\n                  )}\r\n                </button>\r\n              </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\[tenant]\\[lang]\\subscription\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'AlertTriangle' is defined but never used. Allowed unused vars must match /^_/u.","line":7,"column":56,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":69},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'router' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":42,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":42,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'tenant' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":43,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":43,"endColumn":15},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":45,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":45,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1350,1353],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1350,1353],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":105,"column":72,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":105,"endColumn":75,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3182,3185],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3182,3185],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport { useParams, useRouter } from 'next/navigation';\r\nimport { getDictionaryClient } from '../dictionaries-client';\r\nimport { showToast } from '@/lib/toast';\r\nimport { Users, Building, Package, CheckCircle, Clock, AlertTriangle, ArrowUp, Star, Zap, CreditCard, Loader2 } from 'lucide-react';\r\n\r\ninterface SubscriptionPlan {\r\n  _id: string;\r\n  name: string;\r\n  tier: string;\r\n  description?: string;\r\n  price: {\r\n    monthly: number;\r\n    currency: string;\r\n  };\r\n  features: {\r\n    maxUsers: number;\r\n    maxBranches: number;\r\n    maxProducts: number;\r\n    maxTransactions: number;\r\n    enableInventory: boolean;\r\n    enableCategories: boolean;\r\n    enableDiscounts: boolean;\r\n    enableLoyaltyProgram: boolean;\r\n    enableCustomerManagement: boolean;\r\n    enableBookingScheduling: boolean;\r\n    enableReports: boolean;\r\n    enableMultiBranch: boolean;\r\n    enableHardwareIntegration: boolean;\r\n    prioritySupport: boolean;\r\n    customIntegrations: boolean;\r\n    dedicatedAccountManager: boolean;\r\n  };\r\n  isActive: boolean;\r\n  isCustom: boolean;\r\n}\r\n\r\nexport default function SubscriptionPage() {\r\n  const params = useParams();\r\n  const router = useRouter();\r\n  const tenant = params.tenant as string;\r\n  const lang = params.lang as 'en' | 'es';\r\n  const [dict, setDict] = useState<any>(null);\r\n  const [plans, setPlans] = useState<SubscriptionPlan[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [selectedPlan, setSelectedPlan] = useState<string>('');\r\n  const [upgrading, setUpgrading] = useState(false);\r\n\r\n  const loadPlans = async () => {\r\n    try {\r\n      setLoading(true);\r\n      const response = await fetch('/api/subscription-plans');\r\n      const result = await response.json();\r\n\r\n      if (result.success) {\r\n        setPlans(result.data);\r\n      }\r\n    } catch (error) {\r\n      console.error('Failed to load plans:', error);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    getDictionaryClient(lang).then(setDict);\r\n    loadPlans();\r\n  }, [lang]);\r\n\r\n  const handlePlanSelect = (planId: string) => {\r\n    setSelectedPlan(planId);\r\n  };\r\n\r\n  const handleUpgrade = async (planId: string, billingCycle: 'monthly' | 'yearly' = 'monthly') => {\r\n    const selectedPlanData = plans.find(p => p._id === planId);\r\n    if (!selectedPlanData) return;\r\n\r\n    setUpgrading(true);\r\n    try {\r\n      // Create PayPal payment\r\n      const response = await fetch('/api/paypal/create-payment', {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        credentials: 'include',\r\n        body: JSON.stringify({\r\n          planId: planId,\r\n          billingCycle: billingCycle,\r\n        }),\r\n      });\r\n\r\n      const data = await response.json();\r\n\r\n      if (data.success) {\r\n        // Store plan data for later use\r\n        localStorage.setItem('paypal_subscription_plan', JSON.stringify({\r\n          planId,\r\n          billingCycle,\r\n          amount: data.data.amount,\r\n          currency: data.data.currency,\r\n        }));\r\n\r\n        // Redirect to PayPal\r\n        window.location.href = data.data.paypalOrder.links.find((link: any) => link.rel === 'approve').href;\r\n      } else {\r\n        showToast.error(data.error || 'Failed to create payment');\r\n      }\r\n    } catch (error) {\r\n      console.error('Error creating payment:', error);\r\n      showToast.error('Failed to initiate payment');\r\n    } finally {\r\n      setUpgrading(false);\r\n    }\r\n  };\r\n\r\n  if (!dict || loading) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gray-50 flex items-center justify-center\">\r\n        <div className=\"text-center\">\r\n          <Clock className=\"h-12 w-12 animate-spin mx-auto mb-4 text-blue-600\" />\r\n          <p className=\"text-gray-600\">Loading subscription plans...</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50\">\r\n      {/* Header */}\r\n      <div className=\"bg-white border-b border-gray-200\">\r\n        <div className=\"max-w-7xl mx-auto px-4 py-6\">\r\n          <div className=\"flex items-center space-x-3\">\r\n            <ArrowUp className=\"h-6 w-6 text-blue-600\" />\r\n            <div>\r\n              <h1 className=\"text-2xl font-bold text-gray-900\">\r\n                {dict?.subscription?.upgradeTitle || 'Upgrade Your Subscription'}\r\n              </h1>\r\n              <p className=\"text-gray-600 mt-1\">\r\n                {dict?.subscription?.upgradeMessage || 'Choose a plan that fits your business needs and upgrade today.'}\r\n              </p>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Plans */}\r\n      <div className=\"max-w-7xl mx-auto px-4 py-8\">\r\n        <div className=\"text-center mb-8\">\r\n          <h2 className=\"text-xl font-bold text-gray-900 mb-2\">\r\n            {dict?.subscription?.choosePlanTitle || 'Choose Your Plan'}\r\n          </h2>\r\n          <p className=\"text-sm text-gray-600\">\r\n            {dict?.subscription?.choosePlanSubtitle || 'Select the perfect plan for your growing business'}\r\n          </p>\r\n        </div>\r\n\r\n        <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-8 items-stretch\">\r\n          {plans.filter(plan => plan.tier !== 'enterprise').map((plan) => (\r\n            <div\r\n              key={plan._id}\r\n              className={`flex flex-col h-full bg-white rounded-lg shadow-md border-2 transition-all duration-200 ${\r\n                selectedPlan === plan._id\r\n                  ? 'border-blue-500 shadow-lg'\r\n                  : 'border-gray-200 hover:border-gray-300'\r\n              }`}\r\n            >\r\n              <div className=\"flex-1 flex flex-col p-6 justify-between\">\r\n                <div>\r\n                  <div className=\"text-center mb-6\">\r\n                    <h3 className=\"text-lg font-semibold text-gray-900\">{plan.name}</h3>\r\n                    <div className=\"mt-4\">\r\n                      <span className=\"text-3xl font-bold text-gray-900\">{plan.price.monthly}</span>\r\n                      <span className=\"text-sm text-gray-600\">/month</span>\r\n                    </div>\r\n                  </div>\r\n                  <ul className=\"space-y-3 mb-6\">\r\n                    <li className=\"flex items-center\">\r\n                      <Users className=\"h-4 w-4 text-green-600 mr-3 flex-shrink-0\" />\r\n                      <span className=\"text-sm text-gray-600\">\r\n                        {plan.features.maxUsers === -1 ? 'Unlimited' : plan.features.maxUsers} users\r\n                      </span>\r\n                    </li>\r\n                    <li className=\"flex items-center\">\r\n                      <Building className=\"h-4 w-4 text-green-600 mr-3 flex-shrink-0\" />\r\n                      <span className=\"text-sm text-gray-600\">\r\n                        {plan.features.maxBranches === -1 ? 'Unlimited' : plan.features.maxBranches} branches\r\n                      </span>\r\n                    </li>\r\n                    <li className=\"flex items-center\">\r\n                      <Package className=\"h-4 w-4 text-green-600 mr-3 flex-shrink-0\" />\r\n                      <span className=\"text-sm text-gray-600\">\r\n                        {plan.features.maxProducts === -1 ? 'Unlimited' : plan.features.maxProducts} products\r\n                      </span>\r\n                    </li>\r\n                    {plan.features.enableDiscounts && (\r\n                      <li className=\"flex items-center\">\r\n                        <CheckCircle className=\"h-4 w-4 text-green-600 mr-3 flex-shrink-0\" />\r\n                        <span className=\"text-sm text-gray-600\">Discounts & Promotions</span>\r\n                      </li>\r\n                    )}\r\n                  </ul>\r\n                </div>\r\n                <div>\r\n                  {selectedPlan === plan._id ? (\r\n                    <div className=\"space-y-3\">\r\n                      <div className=\"text-sm font-medium text-gray-700\">Choose Billing Cycle:</div>\r\n                      <div className=\"grid grid-cols-2 gap-3\">\r\n                        <button\r\n                          onClick={() => handleUpgrade(plan._id, 'monthly')}\r\n                          disabled={upgrading}\r\n                          className=\"px-3 py-2 bg-blue-600 text-white rounded text-sm font-medium hover:bg-blue-700 disabled:opacity-50 transition-colors\"\r\n                        >\r\n                          {upgrading ? (\r\n                            <Loader2 className=\"h-4 w-4 animate-spin mx-auto\" />\r\n                          ) : (\r\n                            <>\r\n                              <div>{plan.price.monthly}</div>\r\n                              <div className=\"text-xs opacity-90\">Monthly</div>\r\n                            </>\r\n                          )}\r\n                        </button>\r\n                        <button\r\n                          onClick={() => handleUpgrade(plan._id, 'yearly')}\r\n                          disabled={upgrading}\r\n                          className=\"px-3 py-2 bg-green-600 text-white rounded text-sm font-medium hover:bg-green-700 disabled:opacity-50 transition-colors\"\r\n                        >\r\n                          {upgrading ? (\r\n                            <Loader2 className=\"h-4 w-4 animate-spin mx-auto\" />\r\n                          ) : (\r\n                            <>\r\n                              <div>{(plan.price.monthly * 12 * 0.9).toFixed(0)}</div>\r\n                              <div className=\"text-xs opacity-90\">Yearly (10% off)</div>\r\n                            </>\r\n                          )}\r\n                        </button>\r\n                      </div>\r\n                      <button\r\n                        onClick={() => setSelectedPlan('')}\r\n                        className=\"w-full px-3 py-2 bg-gray-100 text-gray-700 rounded text-sm font-medium hover:bg-gray-200 transition-colors\"\r\n                      >\r\n                        Cancel\r\n                      </button>\r\n                    </div>\r\n                  ) : (\r\n                    <button\r\n                      onClick={() => handlePlanSelect(plan._id)}\r\n                      className=\"w-full px-4 py-2 bg-blue-600 text-white rounded text-sm font-medium hover:bg-blue-700 transition-colors\"\r\n                    >\r\n                      Select Plan\r\n                    </button>\r\n                  )}\r\n                </div>\r\n              </div>\r\n            </div>\r\n          ))}\r\n\r\n          {/* Enterprise Plan Card */}\r\n          <div className=\"flex flex-col h-full bg-gradient-to-r from-purple-600 to-blue-600 rounded-lg shadow-md border-2 border-purple-600 text-white\">\r\n            <div className=\"flex-1 flex flex-col p-6 justify-between\">\r\n              <div>\r\n                <div className=\"text-center mb-6\">\r\n                  <h3 className=\"text-lg font-semibold\">Enterprise</h3>\r\n                  <div className=\"mt-4\">\r\n                    <span className=\"text-3xl font-bold\">Custom Pricing</span>\r\n                    <span className=\"text-sm\">/month</span>\r\n                  </div>\r\n                </div>\r\n                <ul className=\"space-y-3 mb-6\">\r\n                  <li className=\"flex items-center\">\r\n                    <Star className=\"h-4 w-4 text-yellow-300 mr-3 flex-shrink-0\" />\r\n                    <span className=\"text-sm\">Unlimited users, branches, products</span>\r\n                  </li>\r\n                  <li className=\"flex items-center\">\r\n                    <Zap className=\"h-4 w-4 text-yellow-300 mr-3 flex-shrink-0\" />\r\n                    <span className=\"text-sm\">Dedicated support & integrations</span>\r\n                  </li>\r\n                  <li className=\"flex items-center\">\r\n                    <CreditCard className=\"h-4 w-4 text-yellow-300 mr-3 flex-shrink-0\" />\r\n                    <span className=\"text-sm\">Custom billing & account manager</span>\r\n                  </li>\r\n                </ul>\r\n              </div>\r\n              <div>\r\n                <button\r\n                  onClick={() => window.location.href = `mailto:admin@localpro.asia?subject=Enterprise%20Plan%20Inquiry&body=Please%20contact%20me%20regarding%20the%20Enterprise%20plan.`}\r\n                  className=\"w-full px-4 py-2 bg-white text-purple-600 rounded text-sm font-medium hover:bg-gray-50 transition-colors\"\r\n                >\r\n                  Contact Us\r\n                </button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n       \r\n        </div>\r\n\r\n        {/* Trust indicators */}\r\n        <div className=\"mt-12 text-center\">\r\n          <p className=\"text-sm text-gray-500 mb-6\">Trusted by businesses worldwide</p>\r\n          <div className=\"flex justify-center items-center space-x-8\">\r\n            <div className=\"flex items-center space-x-2\">\r\n              <CheckCircle className=\"h-5 w-5 text-green-600\" />\r\n              <span className=\"text-sm font-medium text-gray-600\">Secure Payments</span>\r\n            </div>\r\n            <div className=\"flex items-center space-x-2\">\r\n              <CheckCircle className=\"h-5 w-5 text-green-600\" />\r\n              <span className=\"text-sm font-medium text-gray-600\">30-Day Money Back</span>\r\n            </div>\r\n            <div className=\"flex items-center space-x-2\">\r\n              <CheckCircle className=\"h-5 w-5 text-green-600\" />\r\n              <span className=\"text-sm font-medium text-gray-600\">24/7 Support</span>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Enterprise Plan removed from below, now in main grid above */}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\[tenant]\\[lang]\\subscription\\payment-cancel\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\[tenant]\\[lang]\\subscription\\payment-failed\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":13,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":13,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[460,463],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[460,463],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport { useParams, useRouter } from 'next/navigation';\r\nimport { getDictionaryClient } from '../../dictionaries-client';\r\nimport { XCircle } from 'lucide-react';\r\n\r\nexport default function PaymentFailedPage() {\r\n  const params = useParams();\r\n  const router = useRouter();\r\n  const tenant = params.tenant as string;\r\n  const lang = params.lang as 'en' | 'es';\r\n  const [dict, setDict] = useState<any>(null);\r\n\r\n  useEffect(() => {\r\n    getDictionaryClient(lang).then(setDict);\r\n  }, [lang]);\r\n\r\n  if (!dict) {\r\n    return <div>Loading...</div>;\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50 flex items-center justify-center p-4\">\r\n      <div className=\"max-w-md w-full bg-white rounded-lg shadow-lg p-8 text-center\">\r\n        <XCircle className=\"h-16 w-16 mx-auto mb-4 text-red-600\" />\r\n        <h1 className=\"text-2xl font-bold text-gray-900 mb-2\">Payment Failed</h1>\r\n        <p className=\"text-gray-600 mb-6\">\r\n          Your payment could not be processed. Please try again or contact support if the issue persists.\r\n        </p>\r\n        <div className=\"space-y-3\">\r\n          <button\r\n            onClick={() => router.push(`/${tenant}/${lang}/subscription`)}\r\n            className=\"w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 font-medium\"\r\n          >\r\n            Try Again\r\n          </button>\r\n          <button\r\n            onClick={() => router.push(`/${tenant}/${lang}/admin`)}\r\n            className=\"w-full bg-gray-600 text-white py-2 px-4 rounded-md hover:bg-gray-700 font-medium\"\r\n          >\r\n            Go to Dashboard\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\[tenant]\\[lang]\\subscription\\payment-success\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":14,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":14,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[534,537],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[534,537],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'activateSubscription'. Either include it or remove the dependency array.","line":25,"column":6,"nodeType":"ArrayExpression","endLine":25,"endColumn":12,"suggestions":[{"desc":"Update the dependencies array to be: [activateSubscription, lang]","fix":{"range":[959,965],"text":"[activateSubscription, lang]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":77,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":77,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2608,2611],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2608,2611],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport { useParams, useRouter, useSearchParams } from 'next/navigation';\r\nimport { getDictionaryClient } from '../../dictionaries-client';\r\nimport { CheckCircle, Loader2 } from 'lucide-react';\r\n\r\nexport default function PaymentSuccessPage() {\r\n  const params = useParams();\r\n  const router = useRouter();\r\n  const searchParams = useSearchParams();\r\n  const tenant = params.tenant as string;\r\n  const lang = params.lang as 'en' | 'es';\r\n  const [dict, setDict] = useState<any>(null);\r\n  const [activating, setActivating] = useState(true);\r\n  const [success, setSuccess] = useState(false);\r\n  const [errorMsg, setErrorMsg] = useState<string | null>(null);\r\n\r\n  // Accept both 'orderId' and 'token' as PayPal order ID\r\n  const orderId = searchParams.get('orderId') || searchParams.get('token');\r\n\r\n  useEffect(() => {\r\n    getDictionaryClient(lang).then(setDict);\r\n    activateSubscription();\r\n  }, [lang]);\r\n\r\n  const activateSubscription = async () => {\r\n    if (!orderId) {\r\n      setActivating(false);\r\n      setErrorMsg('Missing PayPal order ID.');\r\n      return;\r\n    }\r\n\r\n    let planId: string | null = null;\r\n    let billingCycle: string | null = null;\r\n    // Try to get plan data from localStorage\r\n    const planData = localStorage.getItem('paypal_subscription_plan');\r\n    if (planData) {\r\n      const parsed = JSON.parse(planData);\r\n      planId = parsed.planId;\r\n      billingCycle = parsed.billingCycle;\r\n    } else {\r\n      // Fallback: get from URL\r\n      planId = searchParams.get('planId');\r\n      billingCycle = searchParams.get('billingCycle') || 'monthly';\r\n    }\r\n    if (!planId) {\r\n      setErrorMsg('Plan ID not found in localStorage or URL.');\r\n      setActivating(false);\r\n      return;\r\n    }\r\n\r\n    try {\r\n      // Activate the subscription\r\n      const response = await fetch('/api/subscriptions/activate', {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        credentials: 'include',\r\n        body: JSON.stringify({\r\n          planId,\r\n          billingCycle,\r\n          paypalOrderId: orderId,\r\n        }),\r\n      });\r\n      const data = await response.json();\r\n      if (data.success) {\r\n        setSuccess(true);\r\n        setErrorMsg(null);\r\n        localStorage.removeItem('paypal_subscription_plan');\r\n        // Instead of reload, redirect to dashboard\r\n        router.replace(`/${tenant}/${lang}/admin`);\r\n        return;\r\n      } else {\r\n        setErrorMsg(data.error || 'Unknown backend error.');\r\n        throw new Error(data.error);\r\n      }\r\n    } catch (error: any) {\r\n      console.error('Error activating subscription:', error);\r\n    } finally {\r\n      setActivating(false);\r\n    }\r\n  };\r\n\r\n  if (!dict) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gray-50 flex items-center justify-center\">\r\n        <Loader2 className=\"h-8 w-8 animate-spin\" />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50 flex items-center justify-center p-4\">\r\n      <div className=\"max-w-md w-full bg-white rounded-lg shadow-lg p-8 text-center\">\r\n        {activating ? (\r\n          <>\r\n            <Loader2 className=\"h-16 w-16 animate-spin mx-auto mb-4 text-blue-600\" />\r\n            <h1 className=\"text-2xl font-bold text-gray-900 mb-2\">Processing Payment</h1>\r\n            <p className=\"text-gray-600\">Please wait while we activate your subscription...</p>\r\n          </>\r\n        ) : success ? (\r\n          <>\r\n            <CheckCircle className=\"h-16 w-16 mx-auto mb-4 text-green-600\" />\r\n            <h1 className=\"text-2xl font-bold text-gray-900 mb-2\">Payment Successful!</h1>\r\n            <p className=\"text-gray-600 mb-6\">Your subscription has been activated successfully.</p>\r\n            <button\r\n              onClick={() => router.push(`/${tenant}/${lang}/admin`)}\r\n              className=\"w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 font-medium\"\r\n            >\r\n              Go to Dashboard\r\n            </button>\r\n          </>\r\n        ) : (\r\n          <>\r\n            <div className=\"text-red-600 mb-4\">\r\n              <svg className=\"h-16 w-16 mx-auto\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z\" />\r\n              </svg>\r\n            </div>\r\n            <h1 className=\"text-2xl font-bold text-gray-900 mb-2\">Activation Failed</h1>\r\n            <p className=\"text-gray-600 mb-6\">There was an issue activating your subscription. Please contact support.</p>\r\n            {errorMsg && (\r\n              <div className=\"text-xs text-red-500 mb-4 break-all\">{errorMsg}</div>\r\n            )}\r\n            <button\r\n              onClick={() => router.push(`/${tenant}/${lang}/subscription`)}\r\n              className=\"w-full bg-gray-600 text-white py-2 px-4 rounded-md hover:bg-gray-700 font-medium\"\r\n            >\r\n              Try Again\r\n            </button>\r\n          </>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\[tenant]\\[lang]\\transactions\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":61,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":61,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2062,2065],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2062,2065],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'fetchExpenses' and 'fetchTransactions'. Either include them or remove the dependency array.","line":84,"column":6,"nodeType":"ArrayExpression","endLine":84,"endColumn":30,"suggestions":[{"desc":"Update the dependencies array to be: [fetchExpenses, fetchTransactions, page, tenant, viewType]","fix":{"range":[2740,2764],"text":"[fetchExpenses, fetchTransactions, page, tenant, viewType]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useEffect, useState } from 'react';\r\nimport Navbar from '@/components/Navbar';\r\nimport Currency from '@/components/Currency';\r\nimport FormattedDate from '@/components/FormattedDate';\r\nimport PageTitle from '@/components/PageTitle';\r\nimport { useParams } from 'next/navigation';\r\nimport { getDictionaryClient } from '../dictionaries-client';\r\nimport { useTenantSettings } from '@/contexts/TenantSettingsContext';\r\nimport { getDefaultTenantSettings } from '@/lib/currency';\r\nimport { formatDateTime } from '@/lib/formatting';\r\n\r\ninterface TransactionItem {\r\n  product: string;\r\n  name: string;\r\n  price: number;\r\n  quantity: number;\r\n  subtotal: number;\r\n}\r\n\r\ninterface Transaction {\r\n  _id: string;\r\n  items: TransactionItem[];\r\n  total: number;\r\n  paymentMethod: 'cash' | 'card' | 'digital';\r\n  cashReceived?: number;\r\n  change?: number;\r\n  status: 'completed' | 'cancelled';\r\n  createdAt: string;\r\n}\r\n\r\ninterface Expense {\r\n  _id: string;\r\n  name: string;\r\n  description: string;\r\n  amount: number;\r\n  date: string;\r\n  paymentMethod: 'cash' | 'card' | 'digital' | 'other';\r\n  receipt?: string;\r\n  notes?: string;\r\n  userId?: string | { name: string; email: string };\r\n  createdAt: string;\r\n}\r\n\r\ntype ViewType = 'all' | 'transactions' | 'expenses';\r\n\r\nexport default function TransactionsPage() {\r\n  const params = useParams();\r\n  const tenant = params.tenant as string;\r\n  const lang = params.lang as 'en' | 'es';\r\n  const [transactions, setTransactions] = useState<Transaction[]>([]);\r\n  const [expenses, setExpenses] = useState<Expense[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [page, setPage] = useState(1);\r\n  const [totalPages, setTotalPages] = useState(1);\r\n  const [selectedTransaction, setSelectedTransaction] = useState<Transaction | null>(null);\r\n  const [selectedExpense, setSelectedExpense] = useState<Expense | null>(null);\r\n  const [viewType, setViewType] = useState<ViewType>('all');\r\n  const [displayMode, setDisplayMode] = useState<'grid' | 'list'>('list');\r\n  const [dict, setDict] = useState<any>(null);\r\n  const { settings } = useTenantSettings();\r\n\r\n  useEffect(() => {\r\n    getDictionaryClient(lang).then(setDict);\r\n  }, [lang]);\r\n\r\n  // Load display mode from localStorage\r\n  useEffect(() => {\r\n    const savedDisplayMode = localStorage.getItem(`transactionsDisplayMode_${tenant}`);\r\n    if (savedDisplayMode === 'list' || savedDisplayMode === 'grid') {\r\n      setDisplayMode(savedDisplayMode);\r\n    }\r\n  }, [tenant]);\r\n\r\n  // Save display mode to localStorage\r\n  useEffect(() => {\r\n    localStorage.setItem(`transactionsDisplayMode_${tenant}`, displayMode);\r\n  }, [displayMode, tenant]);\r\n\r\n  useEffect(() => {\r\n    fetchTransactions();\r\n    fetchExpenses();\r\n  }, [page, tenant, viewType]);\r\n\r\n  const fetchTransactions = async () => {\r\n    try {\r\n      const res = await fetch(`/api/transactions?page=${page}&limit=20&tenant=${tenant}`);\r\n      const data = await res.json();\r\n      if (data.success) {\r\n        setTransactions(data.data);\r\n        setTotalPages(data.pagination.pages);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error fetching transactions:', error);\r\n    }\r\n  };\r\n\r\n  const fetchExpenses = async () => {\r\n    try {\r\n      const res = await fetch(`/api/expenses?tenant=${tenant}`, { credentials: 'include' });\r\n      const data = await res.json();\r\n      if (data.success) {\r\n        setExpenses(data.data);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error fetching expenses:', error);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  // formatDate is now handled by FormattedDate component\r\n  // Keep a simple version for receipt printing (template strings)\r\n  const formatDateForReceipt = (dateString: string) => {\r\n    const tenantSettings = settings || getDefaultTenantSettings();\r\n    return formatDateTime(dateString, tenantSettings);\r\n  };\r\n\r\n  const printReceipt = (transaction: Transaction) => {\r\n    if (!dict) return;\r\n    const receiptWindow = window.open('', '_blank');\r\n    if (!receiptWindow) return;\r\n\r\n    const receiptContent = `\r\n      <!DOCTYPE html>\r\n      <html>\r\n        <head>\r\n          <title>${dict.pos.receipt || 'Receipt'}</title>\r\n          <style>\r\n            body {\r\n              font-family: 'Courier New', monospace;\r\n              width: 300px;\r\n              margin: 0 auto;\r\n              padding: 20px;\r\n            }\r\n            .header {\r\n              text-align: center;\r\n              border-bottom: 2px dashed #000;\r\n              padding-bottom: 10px;\r\n              margin-bottom: 10px;\r\n            }\r\n            .item {\r\n              display: flex;\r\n              justify-content: space-between;\r\n              margin-bottom: 5px;\r\n            }\r\n            .total {\r\n              border-top: 2px dashed #000;\r\n              padding-top: 10px;\r\n              margin-top: 10px;\r\n              font-weight: bold;\r\n            }\r\n            .footer {\r\n              text-align: center;\r\n              margin-top: 20px;\r\n              font-size: 12px;\r\n            }\r\n          </style>\r\n        </head>\r\n        <body>\r\n          <div class=\"header\">\r\n            <h2>${dict.pos.receiptTitle || 'POS SYSTEM'}</h2>\r\n            <p>${dict.pos.receiptNumber || 'Receipt'} #${transaction._id.slice(-8)}</p>\r\n            <p>${formatDateForReceipt(transaction.createdAt)}</p>\r\n          </div>\r\n          ${transaction.items\r\n            .map(\r\n              (item) => `\r\n            <div class=\"item\">\r\n              <div>\r\n                <div>${item.name} x${item.quantity}</div>\r\n                <div style=\"font-size: 12px;\">@ $${item.price.toFixed(2)}</div>\r\n              </div>\r\n              <div>$${item.subtotal.toFixed(2)}</div>\r\n            </div>\r\n          `\r\n            )\r\n            .join('')}\r\n          <div class=\"total\">\r\n            <div class=\"item\">\r\n              <div>${dict.common.total}:</div>\r\n              <div>$${transaction.total.toFixed(2)}</div>\r\n            </div>\r\n            <div class=\"item\">\r\n              <div>${dict.transactions.payment}: ${transaction.paymentMethod.toUpperCase()}</div>\r\n            </div>\r\n            ${transaction.cashReceived\r\n              ? `\r\n                <div class=\"item\">\r\n                  <div>${dict.transactions.cash}:</div>\r\n                  <div>$${transaction.cashReceived.toFixed(2)}</div>\r\n                </div>\r\n                <div class=\"item\">\r\n                  <div>${dict.transactions.change}:</div>\r\n                  <div>$${transaction.change?.toFixed(2) || '0.00'}</div>\r\n                </div>\r\n              `\r\n              : ''}\r\n          </div>\r\n          <div class=\"footer\">\r\n            <p>${dict.pos.thankYou || 'Thank you for your business!'}</p>\r\n          </div>\r\n        </body>\r\n      </html>\r\n    `;\r\n\r\n    receiptWindow.document.write(receiptContent);\r\n    receiptWindow.document.close();\r\n    receiptWindow.print();\r\n  };\r\n\r\n  if (!dict) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gray-50 flex items-center justify-center\">\r\n        <div className=\"text-center\">\r\n          <div className=\"inline-block animate-spin h-8 w-8 border-b-2 border-blue-600\"></div>\r\n          <p className=\"mt-4 text-gray-600\">{dict?.common?.loading || 'Loading...'}</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // Combine and sort transactions and expenses by date\r\n  const allItems = [\r\n    ...transactions.map(t => ({ type: 'transaction' as const, data: t, date: t.createdAt })),\r\n    ...expenses.map(e => ({ type: 'expense' as const, data: e, date: e.date || e.createdAt })),\r\n  ].sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime());\r\n\r\n  const filteredItems = viewType === 'all' \r\n    ? allItems \r\n    : viewType === 'transactions' \r\n    ? allItems.filter(item => item.type === 'transaction')\r\n    : allItems.filter(item => item.type === 'expense');\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50\">\r\n      <PageTitle />\r\n      <Navbar />\r\n      <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 sm:py-6 lg:py-8\">\r\n        <div className=\"flex flex-col gap-4 sm:gap-6 mb-4 sm:mb-6 lg:mb-8\">\r\n          <h1 className=\"text-2xl sm:text-3xl lg:text-4xl font-bold text-gray-900\">{dict.transactions.title}</h1>\r\n          <div className=\"flex flex-col sm:flex-row gap-3 sm:gap-4 items-stretch sm:items-center\">\r\n            {/* View Type Toggle - Mobile-first */}\r\n            <div className=\"flex gap-0 bg-white border border-gray-300 w-full sm:w-auto\">\r\n              {(['all', 'transactions', 'expenses'] as ViewType[]).map((view) => (\r\n                <button\r\n                  key={view}\r\n                  type=\"button\"\r\n                  onClick={() => setViewType(view)}\r\n                  className={`flex-1 sm:flex-none px-3 sm:px-4 py-2.5 sm:py-2 text-xs sm:text-sm font-semibold transition-all duration-200 touch-manipulation min-h-[44px] sm:min-h-0 border-r border-gray-300 last:border-r-0 ${\r\n                    viewType === view\r\n                      ? 'text-white bg-blue-600'\r\n                      : 'text-gray-700 hover:bg-gray-100 active:bg-gray-200 bg-white'\r\n                  }`}\r\n                >\r\n                  {view === 'all' \r\n                    ? (dict.transactions?.all || 'All')\r\n                    : view === 'transactions'\r\n                    ? (dict.transactions?.transactions || 'Transactions')\r\n                    : (dict.transactions?.expenses || 'Expenses')}\r\n                </button>\r\n              ))}\r\n            </div>\r\n            {/* Display Mode Toggle */}\r\n            <div className=\"flex gap-2\">\r\n              <button\r\n                onClick={() => setDisplayMode('grid')}\r\n                className={`px-4 py-2.5 sm:py-2 bg-white border-2 transition-all duration-200 flex items-center justify-center gap-2 text-sm font-medium touch-manipulation min-h-[44px] sm:min-h-0 ${\r\n                  displayMode === 'grid'\r\n                    ? 'border-blue-600 bg-blue-50 text-blue-700'\r\n                    : 'border-gray-300 text-gray-700 hover:bg-gray-100 hover:border-blue-500'\r\n                }`}\r\n                title={dict?.common?.gridView || 'Grid View'}\r\n                aria-label={dict?.common?.gridView || 'Grid View'}\r\n              >\r\n                <svg className=\"w-5 h-5\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\" strokeWidth={2}>\r\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z\" />\r\n                </svg>\r\n                <span className=\"hidden sm:inline\">Grid</span>\r\n              </button>\r\n              <button\r\n                onClick={() => setDisplayMode('list')}\r\n                className={`px-4 py-2.5 sm:py-2 bg-white border-2 transition-all duration-200 flex items-center justify-center gap-2 text-sm font-medium touch-manipulation min-h-[44px] sm:min-h-0 ${\r\n                  displayMode === 'list'\r\n                    ? 'border-blue-600 bg-blue-50 text-blue-700'\r\n                    : 'border-gray-300 text-gray-700 hover:bg-gray-100 hover:border-blue-500'\r\n                }`}\r\n                title={dict?.common?.listView || 'List View'}\r\n                aria-label={dict?.common?.listView || 'List View'}\r\n              >\r\n                <svg className=\"w-5 h-5\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\" strokeWidth={2}>\r\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M4 6h16M4 12h16M4 18h16\" />\r\n                </svg>\r\n                <span className=\"hidden sm:inline\">{dict?.common?.listView || 'List'}</span>\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {loading ? (\r\n          displayMode === 'grid' ? (\r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6\">\r\n              {[1, 2, 3, 4, 5, 6].map((i) => (\r\n                <div key={i} className=\"bg-white border border-gray-300 rounded-lg p-4 sm:p-5 animate-pulse\">\r\n                  <div className=\"h-4 bg-gray-200 w-2/3 mb-3\"></div>\r\n                  <div className=\"h-5 bg-gray-200 w-1/2 mb-4\"></div>\r\n                  <div className=\"h-4 bg-gray-200 w-full mb-2\"></div>\r\n                  <div className=\"h-4 bg-gray-200 w-3/4 mb-4\"></div>\r\n                  <div className=\"border-t border-gray-200 pt-4\">\r\n                    <div className=\"h-6 bg-gray-200 w-24\"></div>\r\n                  </div>\r\n                </div>\r\n              ))}\r\n            </div>\r\n          ) : (\r\n            <div className=\"bg-white border border-gray-300 divide-y divide-gray-300\">\r\n              {[1, 2, 3, 4, 5, 6, 7, 8].map((i) => (\r\n                <div key={i} className=\"p-4 sm:p-5 lg:p-6 animate-pulse\">\r\n                  <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3\">\r\n                    <div className=\"flex-1 space-y-2\">\r\n                      <div className=\"h-4 sm:h-5 bg-gray-200 w-1/2 sm:w-1/3\"></div>\r\n                      <div className=\"h-3 sm:h-4 bg-gray-200 w-1/3 sm:w-1/4\"></div>\r\n                    </div>\r\n                    <div className=\"flex items-center gap-2 sm:gap-4\">\r\n                      <div className=\"h-3 sm:h-4 bg-gray-200 w-16 sm:w-20\"></div>\r\n                      <div className=\"h-3 sm:h-4 bg-gray-200 w-12 sm:w-16\"></div>\r\n                      <div className=\"h-10 sm:h-9 bg-gray-200 w-20 sm:w-24\"></div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              ))}\r\n            </div>\r\n          )\r\n        ) : filteredItems.length === 0 ? (\r\n          <div className=\"text-center py-12 sm:py-16 bg-white border border-gray-300 px-4\">\r\n            <svg className=\"mx-auto h-12 w-12 sm:h-16 sm:w-16 text-gray-300 mb-4\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2\" />\r\n            </svg>\r\n            <p className=\"text-gray-500 text-base sm:text-lg\">\r\n              {viewType === 'expenses' \r\n                ? (dict.transactions?.noExpenses || 'No expenses found')\r\n                : dict.transactions.noTransactions}\r\n            </p>\r\n          </div>\r\n        ) : displayMode === 'grid' ? (\r\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6\">\r\n            {filteredItems.map((item) => {\r\n              if (item.type === 'transaction') {\r\n                const transaction = item.data as Transaction;\r\n                return (\r\n                  <div key={transaction._id} className=\"group relative bg-white border border-gray-300 rounded-lg p-4 sm:p-5 hover:shadow-lg hover:border-blue-300 transition-all duration-200 flex flex-col\">\r\n                    <div className=\"flex-1 mb-4\">\r\n                      <div className=\"flex items-start justify-between mb-2\">\r\n                        <div className=\"flex-1\">\r\n                          <div className=\"text-xs text-gray-500 mb-1\">{dict.transactions.date}</div>\r\n                          <div className=\"text-sm text-gray-600\"><FormattedDate date={transaction.createdAt} includeTime={true} /></div>\r\n                        </div>\r\n                        <span className={`inline-block px-2.5 py-1 text-xs font-medium border ${transaction.status === 'completed' ? 'bg-green-100 text-green-800 border-green-300' : 'bg-red-100 text-red-800 border-red-300'}`}>\r\n                          {dict.transactions[transaction.status]}\r\n                        </span>\r\n                      </div>\r\n                      <div className=\"mb-3\">\r\n                        <div className=\"text-xs text-gray-500 mb-1\">{dict.transactions.items}</div>\r\n                        <div className=\"text-sm font-medium text-gray-900\">\r\n                          {transaction.items.length} {transaction.items.length === 1 ? dict.transactions.item : dict.transactions.items}\r\n                        </div>\r\n                      </div>\r\n                      <div className=\"flex flex-wrap gap-2 mb-3\">\r\n                        <span className=\"inline-block px-2.5 py-1 text-xs font-medium bg-blue-100 text-blue-800 capitalize border border-blue-300\">\r\n                          {dict.pos[transaction.paymentMethod]}\r\n                        </span>\r\n                        {transaction.cashReceived && (\r\n                          <div className=\"text-xs text-gray-500\">\r\n                            {dict.transactions.cash}: <Currency amount={transaction.cashReceived} />\r\n                            {transaction.change && <span className=\"ml-1\">{dict.transactions.change}: <Currency amount={transaction.change} /></span>}\r\n                          </div>\r\n                        )}\r\n                      </div>\r\n                    </div>\r\n                    <div className=\"border-t border-gray-200 pt-4 mt-auto\">\r\n                      <div className=\"flex items-center justify-between mb-4\">\r\n                        <div>\r\n                          <div className=\"text-xs text-gray-500 mb-1\">{dict.common.total}</div>\r\n                          <div className=\"font-bold text-blue-600 text-xl sm:text-2xl\"><Currency amount={transaction.total} /></div>\r\n                        </div>\r\n                      </div>\r\n                      <div className=\"flex gap-2\">\r\n                        <button onClick={() => { setSelectedTransaction(selectedTransaction?._id === transaction._id ? null : transaction); setSelectedExpense(null); }} className=\"flex-1 px-4 py-2.5 bg-gray-100 text-gray-700 hover:bg-gray-200 active:bg-gray-300 transition-all duration-200 border border-gray-300 flex items-center justify-center gap-2 touch-manipulation min-h-[44px] text-sm font-medium\">\r\n                          <svg className=\"w-5 h-5\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15 12a3 3 0 11-6 0 3 3 0 016 0z\" /><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z\" /></svg>\r\n                          <span className=\"hidden sm:inline\">{selectedTransaction?._id === transaction._id ? dict.transactions.hide : dict.transactions.view}</span>\r\n                        </button>\r\n                        <button onClick={() => printReceipt(transaction)} className=\"flex-1 px-4 py-2.5 bg-blue-600 text-white hover:bg-blue-700 active:bg-blue-800 transition-all duration-200 border border-blue-700 flex items-center justify-center gap-2 touch-manipulation min-h-[44px] text-sm font-medium\" title={dict.common.print} aria-label={dict.common.print}>\r\n                          <svg className=\"w-5 h-5\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z\" /></svg>\r\n                          <span className=\"hidden sm:inline\">{dict.common.print}</span>\r\n                        </button>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                );\r\n              } else {\r\n                const expense = item.data as Expense;\r\n                return (\r\n                  <div key={expense._id} className=\"group relative bg-white border-l-4 border-red-500 border border-gray-300 rounded-lg p-4 sm:p-5 hover:shadow-lg hover:border-red-400 transition-all duration-200 flex flex-col\">\r\n                    <div className=\"flex-1 mb-4\">\r\n                      <div className=\"flex items-start justify-between mb-2\">\r\n                        <div className=\"flex-1\">\r\n                          <div className=\"text-xs text-gray-500 mb-1\">{dict.transactions.date}</div>\r\n                          <div className=\"text-sm text-gray-600\"><FormattedDate date={expense.date || expense.createdAt} includeTime={true} /></div>\r\n                        </div>\r\n                        <span className=\"inline-block px-2.5 py-1 text-xs font-medium bg-orange-100 text-orange-800 border border-orange-300\">{dict.transactions?.expense || 'Expense'}</span>\r\n                      </div>\r\n                      <div className=\"mb-3\">\r\n                        <div className=\"text-xs text-gray-500 mb-1\">{dict.transactions?.name || 'Name'}</div>\r\n                        <div className=\"text-base font-semibold text-gray-900\">{expense.name}</div>\r\n                        {expense.description && <div className=\"text-sm text-gray-500 mt-1 line-clamp-2\">{expense.description}</div>}\r\n                      </div>\r\n                      <div className=\"flex flex-wrap gap-2\">\r\n                        <span className=\"inline-block px-2.5 py-1 text-xs font-medium bg-red-100 text-red-800 capitalize border border-red-300\">{dict.pos?.[expense.paymentMethod] || expense.paymentMethod}</span>\r\n                      </div>\r\n                    </div>\r\n                    <div className=\"border-t border-gray-200 pt-4 mt-auto\">\r\n                      <div className=\"flex items-center justify-between mb-4\">\r\n                        <div>\r\n                          <div className=\"text-xs text-gray-500 mb-1\">{dict.common.total}</div>\r\n                          <div className=\"font-bold text-red-600 text-xl sm:text-2xl\"><Currency amount={expense.amount} /></div>\r\n                        </div>\r\n                      </div>\r\n                      <button onClick={() => { setSelectedExpense(selectedExpense?._id === expense._id ? null : expense); setSelectedTransaction(null); }} className=\"w-full px-4 py-2.5 bg-gray-100 text-gray-700 hover:bg-gray-200 active:bg-gray-300 transition-all duration-200 border border-gray-300 flex items-center justify-center gap-2 touch-manipulation min-h-[44px] text-sm font-medium\">\r\n                        <svg className=\"w-5 h-5\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15 12a3 3 0 11-6 0 3 3 0 016 0z\" /><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z\" /></svg>\r\n                        <span className=\"hidden sm:inline\">{selectedExpense?._id === expense._id ? dict.transactions.hide : dict.transactions.view}</span>\r\n                      </button>\r\n                    </div>\r\n                  </div>\r\n                );\r\n              }\r\n            })}\r\n          </div>\r\n        ) : (\r\n          <div className=\"bg-white border border-gray-300 divide-y divide-gray-300\">\r\n            {filteredItems.map((item) => {\r\n              if (item.type === 'transaction') {\r\n                const transaction = item.data as Transaction;\r\n                return (\r\n                  <div key={transaction._id} className=\"group relative px-4 sm:px-6 py-4 sm:py-5 hover:bg-gray-50 transition-colors\">\r\n                    <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4\">\r\n                      <div className=\"flex-1 min-w-0\">\r\n                        <div className=\"flex items-start gap-3 mb-2\">\r\n                          <div className=\"flex-1\">\r\n                            <div className=\"text-xs text-gray-500 mb-1\">{dict.transactions.date}</div>\r\n                            <div className=\"text-sm text-gray-600\"><FormattedDate date={transaction.createdAt} includeTime={true} /></div>\r\n                          </div>\r\n                          <span className={`inline-block px-2.5 py-1 text-xs font-medium border ${transaction.status === 'completed' ? 'bg-green-100 text-green-800 border-green-300' : 'bg-red-100 text-red-800 border-red-300'}`}>{dict.transactions[transaction.status]}</span>\r\n                        </div>\r\n                        <div className=\"mb-2\">\r\n                          <div className=\"text-xs text-gray-500 mb-1\">{dict.transactions.items}</div>\r\n                          <div className=\"text-sm font-medium text-gray-900\">{transaction.items.length} {transaction.items.length === 1 ? dict.transactions.item : dict.transactions.items}</div>\r\n                        </div>\r\n                        <div className=\"flex flex-wrap gap-2 text-xs sm:text-sm text-gray-600\">\r\n                          <span className=\"inline-block px-2.5 py-1 text-xs font-medium bg-blue-100 text-blue-800 capitalize border border-blue-300\">{dict.pos[transaction.paymentMethod]}</span>\r\n                          {transaction.cashReceived && (\r\n                            <div className=\"text-xs text-gray-500\">\r\n                              {dict.transactions.cash}: <Currency amount={transaction.cashReceived} />\r\n                              {transaction.change && <span className=\"ml-1\">{dict.transactions.change}: <Currency amount={transaction.change} /></span>}\r\n                            </div>\r\n                          )}\r\n                        </div>\r\n                      </div>\r\n                      <div className=\"flex items-center gap-4 sm:gap-6\">\r\n                        <div className=\"text-right\">\r\n                          <div className=\"text-xs text-gray-500 mb-1 hidden sm:block\">{dict.common.total}</div>\r\n                          <div className=\"font-bold text-blue-600 text-lg sm:text-xl\"><Currency amount={transaction.total} /></div>\r\n                        </div>\r\n                        <div className=\"flex gap-2 actions-touch-visible transition-opacity duration-200\">\r\n                          <button onClick={() => { setSelectedTransaction(selectedTransaction?._id === transaction._id ? null : transaction); setSelectedExpense(null); }} className=\"px-3 py-2 bg-gray-100 text-gray-700 hover:bg-gray-200 active:bg-gray-300 transition-all duration-200 border border-gray-300 flex items-center justify-center touch-manipulation min-h-[44px] sm:min-h-0\" title={selectedTransaction?._id === transaction._id ? dict.transactions.hide : dict.transactions.view}>\r\n                            <svg className=\"w-5 h-5\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15 12a3 3 0 11-6 0 3 3 0 016 0z\" /><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z\" /></svg>\r\n                          </button>\r\n                          <button onClick={() => printReceipt(transaction)} className=\"px-3 py-2 bg-blue-600 text-white hover:bg-blue-700 active:bg-blue-800 transition-all duration-200 border border-blue-700 flex items-center justify-center touch-manipulation min-h-[44px] sm:min-h-0\" title={dict.common.print} aria-label={dict.common.print}>\r\n                            <svg className=\"w-5 h-5\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z\" /></svg>\r\n                          </button>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                );\r\n              } else {\r\n                const expense = item.data as Expense;\r\n                return (\r\n                  <div key={expense._id} className=\"group relative px-4 sm:px-6 py-4 sm:py-5 hover:bg-gray-50 transition-colors border-l-4 border-red-500\">\r\n                    <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4\">\r\n                      <div className=\"flex-1 min-w-0\">\r\n                        <div className=\"flex items-start gap-3 mb-2\">\r\n                          <div className=\"flex-1\">\r\n                            <div className=\"text-xs text-gray-500 mb-1\">{dict.transactions.date}</div>\r\n                            <div className=\"text-sm text-gray-600\"><FormattedDate date={expense.date || expense.createdAt} includeTime={true} /></div>\r\n                          </div>\r\n                          <span className=\"inline-block px-2.5 py-1 text-xs font-medium bg-orange-100 text-orange-800 border border-orange-300\">{dict.transactions?.expense || 'Expense'}</span>\r\n                        </div>\r\n                        <div className=\"mb-2\">\r\n                          <div className=\"text-xs text-gray-500 mb-1\">{dict.transactions?.name || 'Name'}</div>\r\n                          <div className=\"text-base font-semibold text-gray-900\">{expense.name}</div>\r\n                          {expense.description && <div className=\"text-sm text-gray-500 mt-1 line-clamp-1\">{expense.description}</div>}\r\n                        </div>\r\n                        <div className=\"flex flex-wrap gap-2\">\r\n                          <span className=\"inline-block px-2.5 py-1 text-xs font-medium bg-red-100 text-red-800 capitalize border border-red-300\">{dict.pos?.[expense.paymentMethod] || expense.paymentMethod}</span>\r\n                        </div>\r\n                      </div>\r\n                      <div className=\"flex items-center gap-4 sm:gap-6\">\r\n                        <div className=\"text-right\">\r\n                          <div className=\"text-xs text-gray-500 mb-1 hidden sm:block\">{dict.common.total}</div>\r\n                          <div className=\"font-bold text-red-600 text-lg sm:text-xl\"><Currency amount={expense.amount} /></div>\r\n                        </div>\r\n                        <button onClick={() => { setSelectedExpense(selectedExpense?._id === expense._id ? null : expense); setSelectedTransaction(null); }} className=\"px-3 py-2 bg-gray-100 text-gray-700 hover:bg-gray-200 active:bg-gray-300 transition-all duration-200 border border-gray-300 flex items-center justify-center touch-manipulation min-h-[44px] sm:min-h-0\" title={selectedExpense?._id === expense._id ? dict.transactions.hide : dict.transactions.view}>\r\n                          <svg className=\"w-5 h-5\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15 12a3 3 0 11-6 0 3 3 0 016 0z\" /><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z\" /></svg>\r\n                        </button>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                );\r\n              }\r\n            })}\r\n          </div>\r\n        )}\r\n\r\n        {/* Transaction Details */}\r\n        {selectedTransaction && (\r\n          <div className=\"mt-4 sm:mt-6 bg-white border border-gray-300 p-4 sm:p-5 lg:p-6\">\r\n            <h2 className=\"text-base sm:text-lg lg:text-xl font-bold text-gray-900 mb-4 sm:mb-5\">\r\n              <span className=\"block sm:inline\">{dict.transactions.transactionDetails}</span>\r\n              <span className=\"block sm:inline sm:ml-2 text-sm sm:text-base font-normal text-gray-600 mt-1 sm:mt-0\">\r\n                <FormattedDate date={selectedTransaction.createdAt} includeTime={true} />\r\n              </span>\r\n            </h2>\r\n            <div className=\"space-y-3 sm:space-y-4\">\r\n              {selectedTransaction.items.map((item, index) => (\r\n                <div key={index} className=\"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-2 border-b border-gray-300 pb-3\">\r\n                  <div className=\"flex-1\">\r\n                    <div className=\"font-medium text-gray-900 text-sm sm:text-base\">{item.name}</div>\r\n                    <div className=\"text-xs sm:text-sm text-gray-500 mt-0.5\">\r\n                      <Currency amount={item.price} />  {item.quantity}\r\n                    </div>\r\n                  </div>\r\n                  <div className=\"font-semibold text-gray-900 text-base sm:text-lg\">\r\n                    <Currency amount={item.subtotal} />\r\n                  </div>\r\n                </div>\r\n              ))}\r\n              <div className=\"flex justify-between items-center pt-2 sm:pt-3 border-t-2 border-gray-300 mt-2\">\r\n                <span className=\"text-base sm:text-lg font-bold text-gray-900\">{dict.common.total}:</span>\r\n                <span className=\"text-lg sm:text-xl font-bold text-blue-600\">\r\n                  <Currency amount={selectedTransaction.total} />\r\n                </span>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {/* Expense Details */}\r\n        {selectedExpense && (\r\n          <div className=\"mt-4 sm:mt-6 bg-white border border-gray-300 border-l-4 border-l-red-500 p-4 sm:p-5 lg:p-6\">\r\n            <h2 className=\"text-base sm:text-lg lg:text-xl font-bold text-gray-900 mb-4 sm:mb-5\">\r\n              <span className=\"block sm:inline\">{dict.transactions?.expenseDetails || 'Expense Details'}</span>\r\n              <span className=\"block sm:inline sm:ml-2 text-sm sm:text-base font-normal text-gray-600 mt-1 sm:mt-0\">\r\n                <FormattedDate date={selectedExpense.date || selectedExpense.createdAt} includeTime={true} />\r\n              </span>\r\n            </h2>\r\n            <div className=\"space-y-3 sm:space-y-4\">\r\n              <div className=\"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-2 border-b border-gray-300 pb-3\">\r\n                <span className=\"text-xs sm:text-sm font-medium text-gray-500\">{dict.transactions?.name || 'Name'}:</span>\r\n                <span className=\"text-sm sm:text-base font-semibold text-gray-900\">{selectedExpense.name}</span>\r\n              </div>\r\n              {selectedExpense.description && (\r\n                <div className=\"flex flex-col sm:flex-row sm:justify-between sm:items-start gap-2 border-b border-gray-300 pb-3\">\r\n                  <span className=\"text-xs sm:text-sm font-medium text-gray-500\">{dict.transactions?.description || 'Description'}:</span>\r\n                  <span className=\"text-sm text-gray-900 text-left sm:text-right\">{selectedExpense.description}</span>\r\n                </div>\r\n              )}\r\n              <div className=\"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-2 border-b border-gray-300 pb-3\">\r\n                <span className=\"text-xs sm:text-sm font-medium text-gray-500\">{dict.transactions.payment}:</span>\r\n                <span className=\"inline-block px-2.5 py-1 text-xs font-medium bg-red-100 text-red-800 capitalize w-fit border border-red-300\">\r\n                  {dict.pos?.[selectedExpense.paymentMethod] || selectedExpense.paymentMethod}\r\n                </span>\r\n              </div>\r\n              {selectedExpense.notes && (\r\n                <div className=\"flex flex-col sm:flex-row sm:justify-between sm:items-start gap-2 border-b border-gray-300 pb-3\">\r\n                  <span className=\"text-xs sm:text-sm font-medium text-gray-500\">{dict.transactions?.notes || 'Notes'}:</span>\r\n                  <span className=\"text-sm text-gray-900 text-left sm:text-right\">{selectedExpense.notes}</span>\r\n                </div>\r\n              )}\r\n              <div className=\"flex justify-between items-center pt-2 sm:pt-3 border-t-2 border-gray-300 mt-2\">\r\n                <span className=\"text-base sm:text-lg font-bold text-gray-900\">{dict.common.total}:</span>\r\n                <span className=\"text-lg sm:text-xl font-bold text-red-600\">\r\n                  <Currency amount={selectedExpense.amount} />\r\n                </span>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {/* Pagination - Mobile-first */}\r\n        {totalPages > 1 && (\r\n          <div className=\"mt-4 sm:mt-6 flex flex-col sm:flex-row justify-center items-center gap-3 sm:gap-4\">\r\n            <button\r\n              onClick={() => setPage((p) => Math.max(1, p - 1))}\r\n              disabled={page === 1}\r\n              className=\"w-full sm:w-auto px-6 py-3 sm:px-4 sm:py-2 border border-gray-300 disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-100 active:bg-gray-200 font-medium transition-colors bg-white touch-manipulation min-h-[44px] sm:min-h-0\"\r\n            >\r\n              {dict.transactions.previous}\r\n            </button>\r\n            <span className=\"px-4 py-2 text-sm sm:text-base text-gray-700 font-medium text-center\">\r\n              {dict.transactions.page} {page} {dict.transactions.of} {totalPages}\r\n            </span>\r\n            <button\r\n              onClick={() => setPage((p) => Math.min(totalPages, p + 1))}\r\n              disabled={page === totalPages}\r\n              className=\"w-full sm:w-auto px-6 py-3 sm:px-4 sm:py-2 border border-gray-300 disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-100 active:bg-gray-200 font-medium transition-colors bg-white touch-manipulation min-h-[44px] sm:min-h-0\"\r\n            >\r\n              {dict.transactions.next}\r\n            </button>\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\[tenant]\\error.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":14,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":14,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[345,348],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[345,348],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useEffect, useState } from 'react';\r\nimport Link from 'next/link';\r\nimport { getDictionaryClient } from '@/app/[tenant]/[lang]/dictionaries-client';\r\n\r\nexport default function TenantError({\r\n  error,\r\n  reset,\r\n}: {\r\n  error: Error & { digest?: string };\r\n  reset: () => void;\r\n}) {\r\n  const [dict, setDict] = useState<any>(null);\r\n\r\n  useEffect(() => {\r\n    console.error('Tenant error:', error);\r\n    getDictionaryClient('en').then(setDict);\r\n  }, [error]);\r\n\r\n  return (\r\n    <div className=\"min-h-screen flex items-center justify-center px-4\">\r\n      <div className=\"max-w-md w-full bg-white p-8 text-center\">\r\n        <div className=\"mb-6\">\r\n          <svg\r\n            className=\"mx-auto h-16 w-16 text-red-400\"\r\n            fill=\"none\"\r\n            viewBox=\"0 0 24 24\"\r\n            stroke=\"currentColor\"\r\n          >\r\n            <path\r\n              strokeLinecap=\"round\"\r\n              strokeLinejoin=\"round\"\r\n              strokeWidth={2}\r\n              d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z\"\r\n            />\r\n          </svg>\r\n        </div>\r\n        <h1 className=\"text-2xl font-bold text-gray-900 mb-2\">{dict?.common?.errorLoadingStore || 'Error Loading Store'}</h1>\r\n        <p className=\"text-gray-600 mb-6\">\r\n          {error.message || dict?.common?.errorLoadingStoreMessage || 'An error occurred while loading the store information.'}\r\n        </p>\r\n        <div className=\"space-y-3\">\r\n          <button\r\n            onClick={reset}\r\n            className=\"w-full bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 font-medium transition-colors\"\r\n          >\r\n            {dict?.common?.tryAgain || 'Try Again'}\r\n          </button>\r\n          <Link\r\n            href=\"/default/en\"\r\n            className=\"block w-full bg-gray-100 text-gray-700 px-4 py-2 rounded-md hover:bg-gray-200 font-medium transition-colors\"\r\n          >\r\n            {dict?.common?.goToDefaultStore || 'Go to Default Store'}\r\n          </Link>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\[tenant]\\forbidden.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":25,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":25,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[673,676],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[673,676],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useEffect, useState } from 'react';\r\nimport Link from 'next/link';\r\nimport { useParams, useRouter } from 'next/navigation';\r\nimport { getDictionaryClient } from '@/app/[tenant]/[lang]/dictionaries-client';\r\n\r\ninterface UserInfo {\r\n  userId: string | null;\r\n  tenantSlug: string | null;\r\n  tenantId: string | null;\r\n  tenantName: string | null;\r\n  email: string | null;\r\n  name: string | null;\r\n}\r\n\r\ninterface SecurityViolation {\r\n  userId: string | null;\r\n  userTenantId: string | null;\r\n  attemptedTenantId: string | null;\r\n  attemptedTenantSlug: string | null;\r\n}\r\n\r\nexport default function ForbiddenPage() {\r\n  const [dict, setDict] = useState<any>(null);\r\n  const [userInfo, setUserInfo] = useState<UserInfo>({\r\n    userId: null,\r\n    tenantSlug: null,\r\n    tenantId: null,\r\n    tenantName: null,\r\n    email: null,\r\n    name: null,\r\n  });\r\n  const [securityViolation, setSecurityViolation] = useState<SecurityViolation | null>(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const params = useParams();\r\n  const router = useRouter();\r\n  const currentTenant = params?.tenant as string;\r\n\r\n  useEffect(() => {\r\n    async function loadData() {\r\n      try {\r\n        const [dictData, profileData] = await Promise.all([\r\n          getDictionaryClient('en'),\r\n          fetch('/api/auth/profile', { credentials: 'include' }).then(res => res.json()),\r\n        ]);\r\n        \r\n        setDict(dictData);\r\n        \r\n        if (profileData.success && profileData.user) {\r\n          setUserInfo({\r\n            userId: profileData.user._id || null,\r\n            tenantSlug: profileData.user.tenantSlug || null,\r\n            tenantId: profileData.user.tenantId || null,\r\n            tenantName: profileData.user.tenantName || null,\r\n            email: profileData.user.email || null,\r\n            name: profileData.user.name || null,\r\n          });\r\n          \r\n          // Get attempted tenant ID from API\r\n          // NOTE: We don't use handleApiResponse here to prevent redirect loops\r\n          // The /api/tenants/[slug] route doesn't check tenant access, so it should work\r\n          if (currentTenant) {\r\n            try {\r\n              const tenantRes = await fetch(`/api/tenants/${currentTenant}`, { credentials: 'include' });\r\n              // Don't redirect on 403 here - we're already on the forbidden page\r\n              if (tenantRes.ok) {\r\n                const tenantData = await tenantRes.json();\r\n                \r\n                if (tenantData.success && tenantData.data) {\r\n                  setSecurityViolation({\r\n                    userId: profileData.user._id || null,\r\n                    userTenantId: profileData.user.tenantId || null,\r\n                    attemptedTenantId: tenantData.data._id || null,\r\n                    attemptedTenantSlug: currentTenant,\r\n                  });\r\n                }\r\n              } else {\r\n                // If we can't fetch tenant info, that's okay - we'll just show what we have\r\n                console.warn('Could not fetch tenant info for forbidden page');\r\n              }\r\n            } catch (error) {\r\n              console.error('Error fetching attempted tenant:', error);\r\n            }\r\n          }\r\n        }\r\n      } catch (error) {\r\n        console.error('Error loading forbidden page data:', error);\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    }\r\n    \r\n    loadData();\r\n  }, [currentTenant]);\r\n\r\n  const goToOwnStore = () => {\r\n    if (userInfo.tenantSlug) {\r\n      router.push(`/${userInfo.tenantSlug}/en`);\r\n    } else {\r\n      router.push('/default/en');\r\n    }\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"min-h-screen flex items-center justify-center px-4\">\r\n        <div className=\"text-center\">\r\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4\"></div>\r\n          <p className=\"text-gray-600\">Loading...</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen flex items-center justify-center px-4 py-12\">\r\n      <div className=\"max-w-lg w-full bg-white rounded-lg shadow-xl p-8 text-center\">\r\n        <div className=\"mb-6\">\r\n          <div className=\"mx-auto h-20 w-20 bg-red-100 rounded-full flex items-center justify-center mb-4\">\r\n            <svg\r\n              className=\"h-12 w-12 text-red-600\"\r\n              fill=\"none\"\r\n              viewBox=\"0 0 24 24\"\r\n              stroke=\"currentColor\"\r\n            >\r\n              <path\r\n                strokeLinecap=\"round\"\r\n                strokeLinejoin=\"round\"\r\n                strokeWidth={2}\r\n                d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z\"\r\n              />\r\n            </svg>\r\n          </div>\r\n        </div>\r\n        \r\n        <h1 className=\"text-3xl font-bold text-gray-900 mb-3\">\r\n          {dict?.forbidden?.title || dict?.common?.accessDenied || 'Access Denied'}\r\n        </h1>\r\n        \r\n        <p className=\"text-gray-600 mb-6 text-lg\">\r\n          {dict?.forbidden?.message || \r\n            \"You don't have permission to access this store.\"}\r\n        </p>\r\n\r\n        {/* User Info */}\r\n        {userInfo.name && (\r\n          <div className=\"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6 text-left\">\r\n            <p className=\"text-sm text-blue-800 font-medium mb-2\">\r\n              {dict?.forbidden?.yourAccount || 'Your Account'}:\r\n            </p>\r\n            <p className=\"text-sm text-blue-700\">{userInfo.name}</p>\r\n            {userInfo.email && (\r\n              <p className=\"text-xs text-blue-600 mt-1\">{userInfo.email}</p>\r\n            )}\r\n          </div>\r\n        )}\r\n\r\n        {/* Tenant Comparison */}\r\n        <div className=\"bg-gray-50 border border-gray-200 rounded-lg p-4 mb-6\">\r\n          <div className=\"grid grid-cols-2 gap-4 text-sm\">\r\n            <div>\r\n              <p className=\"text-gray-500 mb-1\">\r\n                {dict?.forbidden?.yourStore || 'Your Store'}:\r\n              </p>\r\n              <p className=\"font-semibold text-gray-900\">\r\n                {userInfo.tenantSlug || 'Unknown'}\r\n              </p>\r\n            </div>\r\n            <div>\r\n              <p className=\"text-gray-500 mb-1\">\r\n                {dict?.forbidden?.attemptedAccess || 'Attempted Access'}:\r\n              </p>\r\n              <p className=\"font-semibold text-red-600\">\r\n                {currentTenant || 'Unknown'}\r\n              </p>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Security Violation Details */}\r\n        {securityViolation && (\r\n          <div className=\"bg-red-50 border border-red-200 rounded-lg p-4 mb-6\">\r\n            <p className=\"text-sm text-red-800 font-semibold mb-2\">\r\n              {dict?.forbidden?.securityViolation || 'Security Violation Detected'}:\r\n            </p>\r\n            <div className=\"text-xs text-red-700 space-y-1 font-mono bg-red-100 p-3 rounded border border-red-300\">\r\n              <p className=\"mb-2\">\r\n                <span className=\"font-semibold\">Security:</span> User {securityViolation.userId || 'Unknown'} from tenant {securityViolation.userTenantId || 'Unknown'} attempted to access tenant {securityViolation.attemptedTenantId || 'Unknown'}\r\n              </p>\r\n              <div className=\"pt-2 border-t border-red-300 space-y-1\">\r\n                <p>\r\n                  <span className=\"font-semibold\">User ID:</span> {securityViolation.userId || 'Unknown'}\r\n                </p>\r\n                <p>\r\n                  <span className=\"font-semibold\">Your Tenant ID:</span> {securityViolation.userTenantId || 'Unknown'}\r\n                </p>\r\n                <p>\r\n                  <span className=\"font-semibold\">Attempted Tenant ID:</span> {securityViolation.attemptedTenantId || 'Unknown'}\r\n                </p>\r\n                {securityViolation.attemptedTenantSlug && (\r\n                  <p>\r\n                    <span className=\"font-semibold\">Attempted Tenant Slug:</span> {securityViolation.attemptedTenantSlug}\r\n                  </p>\r\n                )}\r\n              </div>\r\n            </div>\r\n            <p className=\"text-xs text-red-600 mt-2\">\r\n              This security violation has been logged for audit purposes.\r\n            </p>\r\n          </div>\r\n        )}\r\n\r\n        {/* Security Notice */}\r\n        <div className=\"bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-6\">\r\n          <p className=\"text-sm text-yellow-800\">\r\n            <strong>{dict?.forbidden?.securityNotice || 'Security Notice: This access attempt has been logged for security purposes.'}</strong>\r\n          </p>\r\n        </div>\r\n\r\n        {/* Action Buttons */}\r\n        <div className=\"space-y-3\">\r\n          {userInfo.tenantSlug && (\r\n            <button\r\n              onClick={goToOwnStore}\r\n              className=\"block w-full bg-blue-600 text-white px-6 py-3 rounded-md hover:bg-blue-700 font-medium transition-colors shadow-md hover:shadow-lg\"\r\n            >\r\n              {dict?.forbidden?.goToMyStore || `Go to My Store (${userInfo.tenantSlug})`}\r\n            </button>\r\n          )}\r\n          \r\n          <Link\r\n            href=\"/default/en\"\r\n            className=\"block w-full bg-gray-100 text-gray-700 px-6 py-3 rounded-md hover:bg-gray-200 font-medium transition-colors\"\r\n          >\r\n            {dict?.forbidden?.goToDefaultStore || 'Go to Default Store'}\r\n          </Link>\r\n          \r\n          <button\r\n            onClick={() => router.back()}\r\n            className=\"block w-full text-gray-500 px-4 py-2 rounded-md hover:text-gray-700 font-medium transition-colors text-sm\"\r\n          >\r\n            {dict?.forbidden?.goBack || 'Go Back'}\r\n          </button>\r\n        </div>\r\n\r\n        {/* Help Text */}\r\n        <p className=\"mt-6 text-xs text-gray-500\">\r\n          {dict?.forbidden?.contactAdmin || 'If you believe this is an error, please contact your administrator.'}\r\n        </p>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\[tenant]\\layout.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":35,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":35,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1038,1041],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1038,1041],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { ReactNode } from 'react';\r\nimport { getTenantBySlug } from '@/lib/tenant';\r\nimport { notFound, redirect } from 'next/navigation';\r\nimport connectDB from '@/lib/mongodb';\r\nimport Tenant from '@/models/Tenant';\r\nimport { verifyToken } from '@/lib/auth';\r\nimport { cookies, headers } from 'next/headers';\r\n\r\nexport async function generateStaticParams() {\r\n  // For static generation, you can return common tenants\r\n  // In production, you might want to fetch from database\r\n  return [\r\n    { tenant: 'default' },\r\n  ];\r\n}\r\n\r\nasync function ensureDefaultTenant() {\r\n  await connectDB();\r\n  const existing = await Tenant.findOne({ slug: 'default' });\r\n  \r\n  if (!existing) {\r\n    try {\r\n      // Create default tenant if it doesn't exist\r\n      await Tenant.create({\r\n        slug: 'default',\r\n        name: 'Default Store',\r\n        settings: {\r\n          currency: 'USD',\r\n          timezone: 'UTC',\r\n          language: 'en',\r\n          primaryColor: '#2563eb',\r\n        },\r\n        isActive: true,\r\n      });\r\n    } catch (error: any) {\r\n      // If duplicate key error (11000), another parallel process already created it\r\n      // This can happen during build/prerendering when multiple pages are generated in parallel\r\n      // It's safe to ignore this error and continue\r\n      if (error.code !== 11000) {\r\n        // Re-throw if it's a different error\r\n        throw error;\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nexport default async function TenantLayout({\r\n  children,\r\n  params,\r\n}: {\r\n  children: ReactNode;\r\n  params: Promise<{ tenant: string }>;\r\n}) {\r\n  const { tenant: tenantSlug } = await params;\r\n  \r\n  // IMPORTANT: The forbidden route at app/[tenant]/forbidden.tsx must bypass tenant checks\r\n  // Since we can't easily detect pathname in server components, we use a workaround:\r\n  // 1. Check referer to see if we're being redirected from/to forbidden\r\n  // 2. Always allow rendering if we detect forbidden route patterns\r\n  // This prevents redirect loops when the forbidden page tries to render\r\n  const headersList = await headers();\r\n  const referer = headersList.get('referer') || '';\r\n  // Check if referer indicates we're on or redirecting to forbidden page\r\n  // Also, we'll check the actual route by allowing forbidden to always render\r\n  // The route app/[tenant]/forbidden.tsx should be accessible without tenant checks\r\n  const isForbiddenRoute = referer.includes('/forbidden');\r\n  \r\n  // Since we can't easily detect the current pathname in server components,\r\n  // we'll use a simpler approach: always skip tenant check if we detect forbidden patterns\r\n  // This ensures /[tenant]/forbidden is always accessible\r\n  \r\n  // If it's the default tenant and doesn't exist, create it\r\n  if (tenantSlug === 'default') {\r\n    await ensureDefaultTenant();\r\n  }\r\n  \r\n  // Verify tenant exists and is active\r\n  const tenant = await getTenantBySlug(tenantSlug);\r\n  \r\n  if (!tenant) {\r\n    notFound();\r\n  }\r\n  \r\n  // Get full tenant details including domain/subdomain for domain ownership check\r\n  await connectDB();\r\n  const requestedTenant = await Tenant.findById(tenant._id)\r\n    .select('_id slug domain subdomain')\r\n    .lean();\r\n  \r\n  if (!requestedTenant) {\r\n    notFound();\r\n  }\r\n  \r\n  // SECURITY: Check domain ownership - verify authenticated user's tenant matches requested tenant domain\r\n  // This ensures users can only access tenants they own, and domain matches tenant ownership\r\n  // IMPORTANT: Skip this check if we're on the forbidden route to prevent redirect loops\r\n  // The forbidden route at app/[tenant]/forbidden.tsx should be accessible without tenant checks\r\n  if (!isForbiddenRoute) {\r\n    try {\r\n      const cookieStore = await cookies();\r\n      const authToken = cookieStore.get('auth-token');\r\n      const host = headersList.get('host') || '';\r\n      \r\n      if (authToken?.value) {\r\n        // Verify token and get user's tenant ID\r\n        const payload = verifyToken(authToken.value);\r\n        \r\n        if (payload && payload.tenantId) {\r\n          // Get user's tenant with domain/subdomain info\r\n          const userTenant = await Tenant.findById(payload.tenantId)\r\n            .select('_id slug domain subdomain')\r\n            .lean();\r\n          \r\n          if (userTenant) {\r\n            const userTenantId = userTenant._id.toString();\r\n            const requestedTenantId = requestedTenant._id.toString();\r\n            \r\n            // PRIMARY CHECK: User's tenant ID must match requested tenant ID\r\n            if (userTenantId !== requestedTenantId) {\r\n              // User is trying to access a tenant they don't belong to\r\n              redirect(`/${tenantSlug}/forbidden`);\r\n            }\r\n            \r\n            // DOMAIN OWNERSHIP CHECK: Verify the host matches the requested tenant's domain/subdomain\r\n            // This ensures users can only access their tenant via the correct domain\r\n            if (host && (requestedTenant.subdomain || requestedTenant.domain)) {\r\n              const hostLower = host.toLowerCase();\r\n              \r\n              // Check subdomain match (e.g., store1.example.com matches subdomain \"store1\")\r\n              const isSubdomainMatch = requestedTenant.subdomain && \r\n                hostLower.startsWith(requestedTenant.subdomain.toLowerCase() + '.');\r\n              \r\n              // Check full domain match (e.g., store1.example.com matches domain \"store1.example.com\")\r\n              const isDomainMatch = requestedTenant.domain && \r\n                hostLower === requestedTenant.domain.toLowerCase();\r\n              \r\n              // If tenant has domain/subdomain configured, host must match\r\n              // This prevents accessing tenant via wrong domain (domain ownership verification)\r\n              if (!isSubdomainMatch && !isDomainMatch) {\r\n                // Host doesn't match tenant's configured domain/subdomain\r\n                // User is trying to access tenant via incorrect domain - redirect to forbidden\r\n                redirect(`/${tenantSlug}/forbidden`);\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n    } catch (error) {\r\n      // If auth check fails, allow access (might be unauthenticated user or invalid token)\r\n      // They'll be redirected by ProtectedRoute if needed\r\n      // Silently continue - don't log to avoid noise\r\n    }\r\n  }\r\n  \r\n  return <>{children}</>;\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\[tenant]\\not-found.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":8,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":8,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[257,260],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[257,260],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useEffect, useState } from 'react';\r\nimport Link from 'next/link';\r\nimport { getDictionaryClient } from '@/app/[tenant]/[lang]/dictionaries-client';\r\n\r\nexport default function TenantNotFound() {\r\n  const [dict, setDict] = useState<any>(null);\r\n\r\n  useEffect(() => {\r\n    getDictionaryClient('en').then(setDict);\r\n  }, []);\r\n\r\n  return (\r\n    <div className=\"min-h-screen flex items-center justify-center px-4\">\r\n      <div className=\"max-w-md w-full bg-white p-8 text-center\">\r\n        <div className=\"mb-6\">\r\n          <svg\r\n            className=\"mx-auto h-16 w-16 text-gray-400\"\r\n            fill=\"none\"\r\n            viewBox=\"0 0 24 24\"\r\n            stroke=\"currentColor\"\r\n          >\r\n            <path\r\n              strokeLinecap=\"round\"\r\n              strokeLinejoin=\"round\"\r\n              strokeWidth={2}\r\n              d=\"M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\"\r\n            />\r\n          </svg>\r\n        </div>\r\n        <h1 className=\"text-2xl font-bold text-gray-900 mb-2\">{dict?.common?.storeNotFound || 'Store Not Found'}</h1>\r\n        <p className=\"text-gray-600 mb-6\">\r\n          {dict?.common?.storeNotFoundMessage || \"The store you're looking for doesn't exist or has been deactivated.\"}\r\n        </p>\r\n        <div className=\"space-y-3\">\r\n          <Link\r\n            href=\"/default/en\"\r\n            className=\"block w-full bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 font-medium transition-colors\"\r\n          >\r\n            {dict?.common?.goToDefaultStore || 'Go to Default Store'}\r\n          </Link>\r\n          <Link\r\n            href=\"/\"\r\n            className=\"block w-full bg-gray-100 text-gray-700 px-4 py-2 rounded-md hover:bg-gray-200 font-medium transition-colors\"\r\n          >\r\n            {dict?.common?.goToHome || 'Go to Home'}\r\n          </Link>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\attendance\\current\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":42,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":42,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1215,1218],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1215,1218],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\nimport connectDB from '@/lib/mongodb';\r\nimport Attendance from '@/models/Attendance';\r\nimport { requireAuth } from '@/lib/auth';\r\nimport { getValidationTranslatorFromRequest } from '@/lib/validation-translations';\r\n\r\n/**\r\n * GET - Get current user's active attendance session (if clocked in)\r\n */\r\nexport async function GET(request: NextRequest) {\r\n  try {\r\n    const user = await requireAuth(request);\r\n    await connectDB();\r\n\r\n    const activeSession = await Attendance.findOne({\r\n      userId: user.userId,\r\n      tenantId: user.tenantId,\r\n      clockOut: null,\r\n    })\r\n      .sort({ clockIn: -1 })\r\n      .lean();\r\n\r\n    if (!activeSession) {\r\n      return NextResponse.json({\r\n        success: true,\r\n        data: null,\r\n      });\r\n    }\r\n\r\n    // Calculate current hours worked\r\n    const now = new Date();\r\n    const hoursWorked = (now.getTime() - new Date(activeSession.clockIn).getTime()) / (1000 * 60 * 60);\r\n    const roundedHours = Math.round(hoursWorked * 100) / 100;\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      data: {\r\n        ...activeSession,\r\n        currentHours: roundedHours,\r\n      },\r\n    });\r\n  } catch (error: any) {\r\n    console.error('Get current attendance error:', error);\r\n    const t = await getValidationTranslatorFromRequest(request);\r\n    return NextResponse.json(\r\n      { success: false, error: error.message || t('validation.failedToGetCurrentAttendance', 'Failed to get current attendance') },\r\n      { status: error.message === 'Unauthorized' ? 401 : 500 }\r\n    );\r\n  }\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\attendance\\notifications\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'User' is defined but never used. Allowed unused vars must match /^_/u.","line":4,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":12},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'sendEmail' is defined but never used. Allowed unused vars must match /^_/u.","line":6,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":19},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":43,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":43,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1773,1776],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1773,1776],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":46,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":46,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1891,1894],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1891,1894],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":80,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":80,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3288,3291],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3288,3291],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":122,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":122,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4860,4863],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4860,4863],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'expectedStartTime' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":152,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":152,"endColumn":28},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'maxHoursWithoutClockOut' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":153,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":153,"endColumn":34},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":185,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":185,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7298,7301],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7298,7301],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":205,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":205,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7987,7990],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7987,7990],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":10,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\nimport connectDB from '@/lib/mongodb';\r\nimport Attendance from '@/models/Attendance';\r\nimport User from '@/models/User';\r\nimport { getTenantIdFromRequest } from '@/lib/api-tenant';\r\nimport { sendEmail } from '@/lib/notifications';\r\nimport { getValidationTranslatorFromRequest } from '@/lib/validation-translations';\r\n\r\n/**\r\n * Get attendance notifications - late arrivals, missing clock-outs\r\n */\r\nexport async function GET(request: NextRequest) {\r\n  try {\r\n    await connectDB();\r\n    const tenantId = await getTenantIdFromRequest(request);\r\n    const t = await getValidationTranslatorFromRequest(request);\r\n\r\n    if (!tenantId) {\r\n      return NextResponse.json({ success: false, error: t('validation.tenantNotFound', 'Tenant not found') }, { status: 404 });\r\n    }\r\n\r\n    // Get tenant settings for notification defaults\r\n    const Tenant = (await import('@/models/Tenant')).default;\r\n    const tenant = await Tenant.findById(tenantId).select('settings').lean();\r\n    \r\n    const searchParams = request.nextUrl.searchParams;\r\n    const attendanceSettings = tenant?.settings?.attendanceNotifications || {};\r\n    const expectedStartTime = searchParams.get('expectedStartTime') || attendanceSettings.expectedStartTime || '09:00'; // Default 9 AM\r\n    const maxHoursWithoutClockOut = parseFloat(\r\n      searchParams.get('maxHoursWithoutClockOut') || \r\n      String(attendanceSettings.maxHoursWithoutClockOut || 12)\r\n    ); // Default 12 hours\r\n\r\n    // Get all active sessions (clocked in but not out)\r\n    const activeSessions = await Attendance.find({\r\n      tenantId,\r\n      clockOut: null,\r\n    })\r\n      .populate('userId', 'name email')\r\n      .lean();\r\n\r\n    const now = new Date();\r\n    const notifications: any[] = [];\r\n\r\n    // Check for missing clock-outs (sessions that are too long)\r\n    activeSessions.forEach((session: any) => {\r\n      const clockInTime = new Date(session.clockIn);\r\n      const hoursSinceClockIn = (now.getTime() - clockInTime.getTime()) / (1000 * 60 * 60);\r\n\r\n      if (hoursSinceClockIn > maxHoursWithoutClockOut) {\r\n        notifications.push({\r\n          type: 'missing_clock_out',\r\n          userId: session.userId._id || session.userId,\r\n          userName: typeof session.userId === 'object' ? session.userId.name : 'Unknown',\r\n          userEmail: typeof session.userId === 'object' ? session.userId.email : null,\r\n          attendanceId: session._id,\r\n          clockInTime: session.clockIn,\r\n          hoursSinceClockIn: hoursSinceClockIn.toFixed(2),\r\n          message: `Employee has been clocked in for ${hoursSinceClockIn.toFixed(1)} hours without clocking out`,\r\n        });\r\n      }\r\n    });\r\n\r\n    // Get today's attendance records to check for late arrivals\r\n    const todayStart = new Date();\r\n    todayStart.setHours(0, 0, 0, 0);\r\n    const todayEnd = new Date();\r\n    todayEnd.setHours(23, 59, 59, 999);\r\n\r\n    const todayAttendances = await Attendance.find({\r\n      tenantId,\r\n      clockIn: { $gte: todayStart, $lte: todayEnd },\r\n    })\r\n      .populate('userId', 'name email')\r\n      .lean();\r\n\r\n    // Parse expected start time (HH:MM format)\r\n    const [expectedHour, expectedMinute] = expectedStartTime.split(':').map(Number);\r\n\r\n    todayAttendances.forEach((attendance: any) => {\r\n      const clockInTime = new Date(attendance.clockIn);\r\n      const expectedClockIn = new Date(clockInTime);\r\n      expectedClockIn.setHours(expectedHour, expectedMinute, 0, 0);\r\n\r\n      // Check if clock-in is more than 15 minutes late\r\n      if (clockInTime > expectedClockIn) {\r\n        const minutesLate = (clockInTime.getTime() - expectedClockIn.getTime()) / (1000 * 60);\r\n        if (minutesLate > 15) {\r\n          notifications.push({\r\n            type: 'late_arrival',\r\n            userId: attendance.userId._id || attendance.userId,\r\n            userName: typeof attendance.userId === 'object' ? attendance.userId.name : 'Unknown',\r\n            userEmail: typeof attendance.userId === 'object' ? attendance.userId.email : null,\r\n            attendanceId: attendance._id,\r\n            clockInTime: attendance.clockIn,\r\n            expectedTime: expectedClockIn,\r\n            minutesLate: Math.round(minutesLate),\r\n            message: `Employee arrived ${Math.round(minutesLate)} minutes late`,\r\n          });\r\n        }\r\n      }\r\n    });\r\n\r\n    // Count by type\r\n    const summary = {\r\n      total: notifications.length,\r\n      missingClockOut: notifications.filter(n => n.type === 'missing_clock_out').length,\r\n      lateArrivals: notifications.filter(n => n.type === 'late_arrival').length,\r\n    };\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      data: {\r\n        notifications,\r\n        summary,\r\n        settings: {\r\n          expectedStartTime,\r\n          maxHoursWithoutClockOut,\r\n        },\r\n      },\r\n    });\r\n  } catch (error: any) {\r\n    console.error('Error fetching attendance notifications:', error);\r\n    return NextResponse.json({ success: false, error: error.message }, { status: 500 });\r\n  }\r\n}\r\n\r\n/**\r\n * Send attendance notification emails\r\n */\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    await connectDB();\r\n    const tenantId = await getTenantIdFromRequest(request);\r\n    const t = await getValidationTranslatorFromRequest(request);\r\n    \r\n    if (!tenantId) {\r\n      return NextResponse.json({ success: false, error: t('validation.tenantNotFound', 'Tenant not found') }, { status: 404 });\r\n    }\r\n    \r\n    const body = await request.json();\r\n    const { notifications } = body; // Array of notification objects\r\n    \r\n    if (!notifications || !Array.isArray(notifications) || notifications.length === 0) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.notificationsArrayRequired', 'Notifications array is required') },\r\n        { status: 400 }\r\n      );\r\n    }\r\n    \r\n    const searchParams = request.nextUrl.searchParams;\r\n    const expectedStartTime = searchParams.get('expectedStartTime') || '09:00';\r\n    const maxHoursWithoutClockOut = parseFloat(searchParams.get('maxHoursWithoutClockOut') || '12');\r\n    \r\n    // Import the sendAttendanceNotification function\r\n    const { sendAttendanceNotification } = await import('@/lib/notifications');\r\n    \r\n    const results = {\r\n      sent: 0,\r\n      failed: 0,\r\n      errors: [] as string[],\r\n    };\r\n    \r\n    // Send email for each notification that has an email address\r\n    for (const notification of notifications) {\r\n      if (notification.userEmail) {\r\n        try {\r\n          const sent = await sendAttendanceNotification({\r\n            userName: notification.userName,\r\n            userEmail: notification.userEmail,\r\n            type: notification.type,\r\n            clockInTime: notification.clockInTime,\r\n            hoursSinceClockIn: notification.hoursSinceClockIn ? parseFloat(notification.hoursSinceClockIn) : undefined,\r\n            minutesLate: notification.minutesLate,\r\n            expectedTime: notification.expectedTime,\r\n            message: notification.message,\r\n          });\r\n          \r\n          if (sent) {\r\n            results.sent++;\r\n          } else {\r\n            results.failed++;\r\n            results.errors.push(`Failed to send email to ${notification.userEmail}`);\r\n          }\r\n        } catch (error: any) {\r\n          results.failed++;\r\n          results.errors.push(`Error sending to ${notification.userEmail}: ${error.message}`);\r\n        }\r\n      } else {\r\n        results.failed++;\r\n        results.errors.push(`No email address for ${notification.userName}`);\r\n      }\r\n    }\r\n    \r\n    return NextResponse.json({\r\n      success: true,\r\n      message: `Sent ${results.sent} email(s) successfully${results.failed > 0 ? `, ${results.failed} failed` : ''}`,\r\n      results: {\r\n        sent: results.sent,\r\n        failed: results.failed,\r\n        total: notifications.length,\r\n        errors: results.errors.length > 0 ? results.errors : undefined,\r\n      },\r\n    });\r\n  } catch (error: any) {\r\n    console.error('Error sending attendance notifications:', error);\r\n    return NextResponse.json({ success: false, error: error.message }, { status: 500 });\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\attendance\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":23,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":23,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[862,865],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[862,865],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":54,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":54,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1737,1740],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1737,1740],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":154,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":154,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4924,4927],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4924,4927],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\nimport connectDB from '@/lib/mongodb';\r\nimport Attendance from '@/models/Attendance';\r\nimport { requireAuth } from '@/lib/auth';\r\nimport { createAuditLog, AuditActions } from '@/lib/audit';\r\nimport { getValidationTranslatorFromRequest } from '@/lib/validation-translations';\r\n\r\n/**\r\n * GET - Get attendance records for current user or all users (if manager+)\r\n */\r\nexport async function GET(request: NextRequest) {\r\n  try {\r\n    const user = await requireAuth(request);\r\n    await connectDB();\r\n\r\n    const { searchParams } = new URL(request.url);\r\n    const userId = searchParams.get('userId');\r\n    const startDate = searchParams.get('startDate');\r\n    const endDate = searchParams.get('endDate');\r\n    const limit = parseInt(searchParams.get('limit') || '50');\r\n\r\n    // Build query\r\n    const query: any = { tenantId: user.tenantId };\r\n\r\n    // If userId is provided and user is manager+, allow viewing other users\r\n    if (userId && (user.role === 'owner' || user.role === 'admin' || user.role === 'manager')) {\r\n      query.userId = userId;\r\n    } else {\r\n      // Otherwise, only show own records\r\n      query.userId = user.userId;\r\n    }\r\n\r\n    // Date range filter\r\n    if (startDate || endDate) {\r\n      query.clockIn = {};\r\n      if (startDate) {\r\n        query.clockIn.$gte = new Date(startDate);\r\n      }\r\n      if (endDate) {\r\n        query.clockIn.$lte = new Date(endDate);\r\n      }\r\n    }\r\n\r\n    const attendances = await Attendance.find(query)\r\n      .populate('userId', 'name email')\r\n      .sort({ clockIn: -1 })\r\n      .limit(limit)\r\n      .lean();\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      data: attendances,\r\n    });\r\n  } catch (error: any) {\r\n    console.error('Get attendance error:', error);\r\n    const t = await getValidationTranslatorFromRequest(request);\r\n    return NextResponse.json(\r\n      { success: false, error: error.message || t('validation.failedToGetAttendance', 'Failed to get attendance') },\r\n      { status: error.message === 'Unauthorized' ? 401 : 500 }\r\n    );\r\n  }\r\n}\r\n\r\n/**\r\n * POST - Clock in or out\r\n */\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    const user = await requireAuth(request);\r\n    await connectDB();\r\n\r\n    const body = await request.json();\r\n    const { action, notes, location } = body; // action: 'clock-in' | 'clock-out'\r\n\r\n    const t = await getValidationTranslatorFromRequest(request);\r\n    if (!action || !['clock-in', 'clock-out'].includes(action)) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.attendanceActionRequired', 'Action must be \"clock-in\" or \"clock-out\"') },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    if (action === 'clock-in') {\r\n      // Check if user already has an active session (clocked in but not out)\r\n      const activeSession = await Attendance.findOne({\r\n        userId: user.userId,\r\n        tenantId: user.tenantId,\r\n        clockOut: null,\r\n      });\r\n\r\n      if (activeSession) {\r\n        return NextResponse.json(\r\n          { success: false, error: t('validation.alreadyClockedIn', 'You are already clocked in. Please clock out first.') },\r\n          { status: 400 }\r\n        );\r\n      }\r\n\r\n      // Create new attendance record\r\n      const attendance = await Attendance.create({\r\n        userId: user.userId,\r\n        tenantId: user.tenantId,\r\n        clockIn: new Date(),\r\n        notes,\r\n        location,\r\n      });\r\n\r\n      await createAuditLog(request, {\r\n        tenantId: user.tenantId,\r\n        action: AuditActions.ATTENDANCE_CLOCK_IN,\r\n        entityType: 'attendance',\r\n        entityId: attendance._id.toString(),\r\n        metadata: { action: 'clock-in' },\r\n      });\r\n\r\n      return NextResponse.json({\r\n        success: true,\r\n        data: attendance,\r\n      });\r\n    } else {\r\n      // Clock out\r\n      const activeSession = await Attendance.findOne({\r\n        userId: user.userId,\r\n        tenantId: user.tenantId,\r\n        clockOut: null,\r\n      }).sort({ clockIn: -1 });\r\n\r\n      if (!activeSession) {\r\n        return NextResponse.json(\r\n          { success: false, error: t('validation.noActiveSession', 'No active session found. Please clock in first.') },\r\n          { status: 400 }\r\n        );\r\n      }\r\n\r\n      // Update attendance with clock out time\r\n      activeSession.clockOut = new Date();\r\n      if (notes) {\r\n        activeSession.notes = (activeSession.notes || '') + (activeSession.notes ? '\\n' : '') + notes;\r\n      }\r\n      await activeSession.save();\r\n\r\n      await createAuditLog(request, {\r\n        tenantId: user.tenantId,\r\n        action: AuditActions.ATTENDANCE_CLOCK_OUT,\r\n        entityType: 'attendance',\r\n        entityId: activeSession._id.toString(),\r\n        metadata: { action: 'clock-out' },\r\n      });\r\n\r\n      return NextResponse.json({\r\n        success: true,\r\n        data: activeSession,\r\n      });\r\n    }\r\n  } catch (error: any) {\r\n    console.error('Attendance error:', error);\r\n    const t = await getValidationTranslatorFromRequest(request);\r\n    return NextResponse.json(\r\n      { success: false, error: error.message || t('validation.failedToProcessAttendance', 'Failed to process attendance') },\r\n      { status: error.message === 'Unauthorized' ? 401 : 500 }\r\n    );\r\n  }\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\audit-logs\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'User' is defined but never used. Allowed unused vars must match /^_/u.","line":5,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":12},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":37,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":37,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1362,1365],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1362,1365],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":82,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":82,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2360,2363],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2360,2363],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\nimport connectDB from '@/lib/mongodb';\r\nimport AuditLog from '@/models/AuditLog';\r\nimport { requireAuth } from '@/lib/auth';\r\nimport User from '@/models/User';\r\nimport { getValidationTranslatorFromRequest } from '@/lib/validation-translations';\r\n\r\nexport async function GET(request: NextRequest) {\r\n  try {\r\n    const user = await requireAuth(request);\r\n    await connectDB();\r\n\r\n    // Get translation function\r\n    const t = await getValidationTranslatorFromRequest(request);\r\n\r\n    // Only admin and owner can view audit logs\r\n    if (user.role !== 'admin' && user.role !== 'owner') {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.forbiddenAdminAccess', 'Forbidden: Admin access required') },\r\n        { status: 403 }\r\n      );\r\n    }\r\n\r\n    const { searchParams } = new URL(request.url);\r\n    const page = parseInt(searchParams.get('page') || '1');\r\n    const limit = parseInt(searchParams.get('limit') || '50');\r\n    const skip = (page - 1) * limit;\r\n\r\n    // Filters\r\n    const action = searchParams.get('action');\r\n    const entityType = searchParams.get('entityType');\r\n    const userId = searchParams.get('userId');\r\n    const startDate = searchParams.get('startDate');\r\n    const endDate = searchParams.get('endDate');\r\n\r\n    // Build query\r\n    const query: any = { tenantId: user.tenantId };\r\n\r\n    if (action) {\r\n      query.action = action;\r\n    }\r\n\r\n    if (entityType) {\r\n      query.entityType = entityType;\r\n    }\r\n\r\n    if (userId) {\r\n      query.userId = userId;\r\n    }\r\n\r\n    if (startDate || endDate) {\r\n      query.createdAt = {};\r\n      if (startDate) {\r\n        query.createdAt.$gte = new Date(startDate);\r\n      }\r\n      if (endDate) {\r\n        query.createdAt.$lte = new Date(endDate);\r\n      }\r\n    }\r\n\r\n    // Fetch audit logs with pagination\r\n    const [auditLogs, total] = await Promise.all([\r\n      AuditLog.find(query)\r\n        .populate('userId', 'name email')\r\n        .sort({ createdAt: -1 })\r\n        .skip(skip)\r\n        .limit(limit)\r\n        .lean(),\r\n      AuditLog.countDocuments(query),\r\n    ]);\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      data: auditLogs,\r\n      pagination: {\r\n        page,\r\n        limit,\r\n        total,\r\n        pages: Math.ceil(total / limit),\r\n      },\r\n    });\r\n  } catch (error: any) {\r\n    console.error('Get audit logs error:', error);\r\n    const t = await getValidationTranslatorFromRequest(request);\r\n    return NextResponse.json(\r\n      { success: false, error: error.message || t('validation.failedToFetchAuditLogs', 'Failed to fetch audit logs') },\r\n      { status: error.message === 'Unauthorized' ? 401 : 500 }\r\n    );\r\n  }\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\auth\\change-password\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":82,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":82,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2913,2916],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2913,2916],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\nimport connectDB from '@/lib/mongodb';\r\nimport User from '@/models/User';\r\nimport { validatePassword } from '@/lib/validation';\r\nimport { getValidationTranslatorFromRequest } from '@/lib/validation-translations';\r\nimport { createAuditLog, AuditActions } from '@/lib/audit';\r\nimport { requireAuth } from '@/lib/auth';\r\nimport bcrypt from 'bcryptjs';\r\n\r\n/**\r\n * POST /api/auth/change-password\r\n * Authenticated endpoint for changing the current user's password.\r\n * Body: { currentPassword, newPassword }\r\n */\r\nexport async function POST(request: NextRequest) {\r\n  let t: (key: string, fallback: string) => string;\r\n  try {\r\n    await connectDB();\r\n    t = await getValidationTranslatorFromRequest(request);\r\n\r\n    const currentUser = await requireAuth(request);\r\n    const body = await request.json();\r\n    const { currentPassword, newPassword } = body;\r\n\r\n    if (!currentPassword || !newPassword) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.passwordFieldsRequired', 'Current password and new password are required') },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    const passwordValidation = validatePassword(newPassword, t);\r\n    if (!passwordValidation.valid) {\r\n      return NextResponse.json(\r\n        { success: false, error: 'Password validation failed', errors: passwordValidation.errors },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    const user = await User.findById(currentUser.userId).select('+password');\r\n    if (!user) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.userNotFound', 'User not found') },\r\n        { status: 404 }\r\n      );\r\n    }\r\n\r\n    // Verify current password\r\n    const isCurrentPasswordValid = await bcrypt.compare(currentPassword, user.password);\r\n    if (!isCurrentPasswordValid) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.currentPasswordIncorrect', 'Current password is incorrect') },\r\n        { status: 401 }\r\n      );\r\n    }\r\n\r\n    // Prevent reusing the same password\r\n    const isSamePassword = await bcrypt.compare(newPassword, user.password);\r\n    if (isSamePassword) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.passwordMustDiffer', 'New password must be different from current password') },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    // Update password (pre-save hook will hash it)\r\n    user.password = newPassword;\r\n    await user.save();\r\n\r\n    await createAuditLog(request, {\r\n      tenantId: currentUser.tenantId,\r\n      action: AuditActions.UPDATE,\r\n      entityType: 'user',\r\n      entityId: currentUser.userId,\r\n      changes: { passwordChanged: true },\r\n    });\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      message: t('validation.passwordChangedSuccess', 'Password changed successfully'),\r\n    });\r\n  } catch (error: any) {\r\n    if (error.message === 'Unauthorized') {\r\n      return NextResponse.json({ success: false, error: 'Unauthorized' }, { status: 401 });\r\n    }\r\n    return NextResponse.json(\r\n      { success: false, error: error.message || 'Password change failed' },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\auth\\customer\\send-otp\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Customer' is defined but never used. Allowed unused vars must match /^_/u.","line":4,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getTenantIdFromRequest' is defined but never used. Allowed unused vars must match /^_/u.","line":6,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":32},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":116,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":116,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3637,3640],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3637,3640],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\nimport connectDB from '@/lib/mongodb';\r\nimport CustomerOTP from '@/models/CustomerOTP';\r\nimport Customer from '@/models/Customer';\r\nimport { sendSMS } from '@/lib/notifications';\r\nimport { getTenantIdFromRequest } from '@/lib/api-tenant';\r\nimport { getValidationTranslatorFromRequest } from '@/lib/validation-translations';\r\n\r\n/**\r\n * POST - Send OTP to customer phone number\r\n * Body: { phone: string, tenantSlug?: string }\r\n */\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    await connectDB();\r\n    const t = await getValidationTranslatorFromRequest(request);\r\n    const body = await request.json();\r\n    const { phone, tenantSlug } = body;\r\n\r\n    // Validation\r\n    if (!phone) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.phoneRequired', 'Phone number is required') },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    // Normalize phone number (remove spaces, dashes, etc.)\r\n    const normalizedPhone = phone.replace(/\\D/g, '');\r\n\r\n    if (normalizedPhone.length < 10) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.invalidPhone', 'Invalid phone number') },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    // Get tenant ID\r\n    const Tenant = (await import('@/models/Tenant')).default;\r\n    const tenant = await Tenant.findOne({ \r\n      slug: tenantSlug || 'default', \r\n      isActive: true \r\n    }).lean();\r\n    \r\n    if (!tenant) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.tenantNotFound', 'Tenant not found') },\r\n        { status: 404 }\r\n      );\r\n    }\r\n\r\n    // Check for recent OTP (rate limiting - max 1 per minute)\r\n    const oneMinuteAgo = new Date(Date.now() - 60 * 1000);\r\n    const recentOTP = await CustomerOTP.findOne({\r\n      tenantId: tenant._id,\r\n      phone: normalizedPhone,\r\n      createdAt: { $gte: oneMinuteAgo },\r\n    });\r\n\r\n    if (recentOTP) {\r\n      return NextResponse.json(\r\n        { \r\n          success: false, \r\n          error: t('validation.otpRateLimit', 'Please wait before requesting another OTP'),\r\n          retryAfter: 60,\r\n        },\r\n        { status: 429 }\r\n      );\r\n    }\r\n\r\n    // Generate 6-digit OTP\r\n    const otp = Math.floor(100000 + Math.random() * 900000).toString();\r\n    const expiresAt = new Date(Date.now() + 10 * 60 * 1000); // 10 minutes expiry\r\n\r\n    // Invalidate any existing OTPs for this phone\r\n    await CustomerOTP.updateMany(\r\n      { tenantId: tenant._id, phone: normalizedPhone, verified: false },\r\n      { verified: true } // Mark as used\r\n    );\r\n\r\n    // Create new OTP\r\n    await CustomerOTP.create({\r\n      tenantId: tenant._id,\r\n      phone: normalizedPhone,\r\n      otp,\r\n      expiresAt,\r\n      verified: false,\r\n      attempts: 0,\r\n    });\r\n\r\n    // Send OTP via SMS using Twilio\r\n    const smsMessage = `Your verification code is ${otp}. This code expires in 10 minutes.`;\r\n    \r\n    const smsSent = await sendSMS({\r\n      to: normalizedPhone,\r\n      message: smsMessage,\r\n      type: 'sms',\r\n    });\r\n\r\n    if (!smsSent) {\r\n      console.error('Failed to send OTP SMS');\r\n      // Don't fail the request, OTP is still created\r\n      // In production, you might want to handle this differently\r\n    }\r\n\r\n    // In development, log OTP to console\r\n    if (process.env.NODE_ENV !== 'production') {\r\n      console.log(` OTP for ${normalizedPhone}: ${otp}`);\r\n    }\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      message: t('validation.otpSent', 'OTP sent successfully'),\r\n      // Don't send OTP in response for security\r\n    });\r\n  } catch (error: any) {\r\n    console.error('Send OTP error:', error);\r\n    return NextResponse.json(\r\n      { success: false, error: error.message || 'Failed to send OTP' },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\auth\\customer\\verify-otp\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getTenantIdFromRequest' is defined but never used. Allowed unused vars must match /^_/u.","line":6,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":32},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":141,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":141,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4199,4202],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4199,4202],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\nimport connectDB from '@/lib/mongodb';\r\nimport CustomerOTP from '@/models/CustomerOTP';\r\nimport Customer from '@/models/Customer';\r\nimport { generateCustomerToken } from '@/lib/auth-customer';\r\nimport { getTenantIdFromRequest } from '@/lib/api-tenant';\r\nimport { getValidationTranslatorFromRequest } from '@/lib/validation-translations';\r\n\r\n/**\r\n * POST - Verify OTP and login customer\r\n * Body: { phone: string, otp: string, tenantSlug?: string, firstName?: string, lastName?: string }\r\n */\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    await connectDB();\r\n    const t = await getValidationTranslatorFromRequest(request);\r\n    const body = await request.json();\r\n    const { phone, otp, tenantSlug, firstName, lastName } = body;\r\n\r\n    // Validation\r\n    if (!phone || !otp) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.phoneOtpRequired', 'Phone number and OTP are required') },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    // Normalize phone number\r\n    const normalizedPhone = phone.replace(/\\D/g, '');\r\n\r\n    // Get tenant ID\r\n    const Tenant = (await import('@/models/Tenant')).default;\r\n    const tenant = await Tenant.findOne({ \r\n      slug: tenantSlug || 'default', \r\n      isActive: true \r\n    }).lean();\r\n    \r\n    if (!tenant) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.tenantNotFound', 'Tenant not found') },\r\n        { status: 404 }\r\n      );\r\n    }\r\n\r\n    // Find valid OTP\r\n    const otpRecord = await CustomerOTP.findOne({\r\n      tenantId: tenant._id,\r\n      phone: normalizedPhone,\r\n      otp,\r\n      verified: false,\r\n      expiresAt: { $gt: new Date() },\r\n    });\r\n\r\n    if (!otpRecord) {\r\n      // Increment attempts for rate limiting\r\n      await CustomerOTP.updateOne(\r\n        { tenantId: tenant._id, phone: normalizedPhone, verified: false },\r\n        { $inc: { attempts: 1 } }\r\n      );\r\n\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.invalidOtp', 'Invalid or expired OTP') },\r\n        { status: 401 }\r\n      );\r\n    }\r\n\r\n    // Check max attempts\r\n    if (otpRecord.attempts >= 5) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.maxOtpAttempts', 'Maximum verification attempts exceeded') },\r\n        { status: 429 }\r\n      );\r\n    }\r\n\r\n    // Mark OTP as verified\r\n    otpRecord.verified = true;\r\n    await otpRecord.save();\r\n\r\n    // Find or create customer\r\n    let customer = await Customer.findOne({\r\n      tenantId: tenant._id,\r\n      phone: normalizedPhone,\r\n    });\r\n\r\n    if (!customer) {\r\n      // Create new customer if doesn't exist\r\n      if (!firstName || !lastName) {\r\n        return NextResponse.json(\r\n          { success: false, error: t('validation.nameRequired', 'First name and last name are required for new customers') },\r\n          { status: 400 }\r\n        );\r\n      }\r\n\r\n      customer = await Customer.create({\r\n        tenantId: tenant._id,\r\n        firstName,\r\n        lastName,\r\n        phone: normalizedPhone,\r\n        isActive: true,\r\n      });\r\n    } else {\r\n      // Update last login time (if we add that field)\r\n      // For now, just ensure customer is active\r\n      if (!customer.isActive) {\r\n        customer.isActive = true;\r\n        await customer.save();\r\n      }\r\n    }\r\n\r\n    // Generate JWT token\r\n    const token = generateCustomerToken({\r\n      customerId: customer._id.toString(),\r\n      tenantId: tenant._id.toString(),\r\n      phone: customer.phone,\r\n      email: customer.email,\r\n    });\r\n\r\n    // Set cookie\r\n    const response = NextResponse.json({\r\n      success: true,\r\n      data: {\r\n        customer: {\r\n          _id: customer._id,\r\n          firstName: customer.firstName,\r\n          lastName: customer.lastName,\r\n          email: customer.email,\r\n          phone: customer.phone,\r\n        },\r\n        token,\r\n      },\r\n    });\r\n\r\n    response.cookies.set('customer-auth-token', token, {\r\n      httpOnly: true,\r\n      secure: process.env.NODE_ENV === 'production',\r\n      sameSite: 'lax',\r\n      maxAge: 60 * 60 * 24 * 30, // 30 days\r\n    });\r\n\r\n    return response;\r\n  } catch (error: any) {\r\n    console.error('Verify OTP error:', error);\r\n    return NextResponse.json(\r\n      { success: false, error: error.message || 'Failed to verify OTP' },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\auth\\login-pin\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":127,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":127,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3758,3761],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3758,3761],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\nimport connectDB from '@/lib/mongodb';\r\nimport User from '@/models/User';\r\nimport { generateToken } from '@/lib/auth';\r\nimport { createAuditLog, AuditActions } from '@/lib/audit';\r\nimport bcrypt from 'bcryptjs';\r\nimport { getValidationTranslatorFromRequest } from '@/lib/validation-translations';\r\n\r\nexport async function POST(request: NextRequest) {\r\n  let t: (key: string, fallback: string) => string;\r\n  try {\r\n    await connectDB();\r\n    const body = await request.json();\r\n    const { pin, tenantSlug } = body;\r\n    t = await getValidationTranslatorFromRequest(request);\r\n\r\n    // Validation\r\n    if (!pin) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.pinRequired', 'PIN is required') },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    if (!/^\\d{4,8}$/.test(pin)) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.pinFormat', 'PIN must be 4-8 digits') },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    // Get tenant ID from slug\r\n    const Tenant = (await import('@/models/Tenant')).default;\r\n    const tenant = await Tenant.findOne({ slug: tenantSlug || 'default', isActive: true }).lean();\r\n    \r\n    if (!tenant) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.tenantNotFoundOrInactive', 'Tenant not found or inactive') },\r\n        { status: 404 }\r\n      );\r\n    }\r\n\r\n    // Find all active users with PINs for this tenant\r\n    const users = await User.find({ tenantId: tenant._id, isActive: true })\r\n      .select('+pin');\r\n\r\n    if (!users || users.length === 0) {\r\n      await createAuditLog(request, {\r\n        tenantId: tenant._id,\r\n        action: AuditActions.LOGIN,\r\n        entityType: 'user',\r\n        metadata: { success: false, reason: 'no_users', method: 'pin' },\r\n      });\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.invalidPin', 'Invalid PIN') },\r\n        { status: 401 }\r\n      );\r\n    }\r\n\r\n    // Try to find user with matching PIN\r\n    let user = null;\r\n    for (const u of users) {\r\n      if (u.pin) {\r\n        const isPINValid = await bcrypt.compare(pin, u.pin);\r\n        if (isPINValid) {\r\n          user = u;\r\n          break;\r\n        }\r\n      }\r\n    }\r\n\r\n    if (!user) {\r\n      await createAuditLog(request, {\r\n        tenantId: tenant._id,\r\n        action: AuditActions.LOGIN,\r\n        entityType: 'user',\r\n        metadata: { success: false, reason: 'invalid_pin', method: 'pin' },\r\n      });\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.invalidPin', 'Invalid PIN') },\r\n        { status: 401 }\r\n      );\r\n    }\r\n\r\n    // Update last login\r\n    await User.findByIdAndUpdate(user._id, { lastLogin: new Date() });\r\n\r\n    // Generate token\r\n    const token = generateToken({\r\n      userId: user._id.toString(),\r\n      tenantId: tenant._id.toString(),\r\n      email: user.email,\r\n      role: user.role,\r\n    });\r\n\r\n    // Create audit log\r\n    await createAuditLog(request, {\r\n      tenantId: tenant._id,\r\n      action: AuditActions.LOGIN,\r\n      entityType: 'user',\r\n      entityId: user._id.toString(),\r\n      metadata: { success: true, method: 'pin' },\r\n    });\r\n\r\n    // Set cookie\r\n    const response = NextResponse.json({\r\n      success: true,\r\n      data: {\r\n        user: {\r\n          _id: user._id,\r\n          email: user.email,\r\n          name: user.name,\r\n          role: user.role,\r\n        },\r\n        token,\r\n      },\r\n    });\r\n\r\n    response.cookies.set('auth-token', token, {\r\n      httpOnly: true,\r\n      secure: process.env.NODE_ENV === 'production',\r\n      sameSite: 'lax',\r\n      maxAge: 60 * 60 * 24 * 7, // 7 days\r\n    });\r\n\r\n    return response;\r\n  } catch (error: any) {\r\n    console.error('PIN login error:', error);\r\n    const errorMessage = error.message || 'Login failed';\r\n    return NextResponse.json(\r\n      { success: false, error: errorMessage },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\auth\\login-qr\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":97,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":97,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2854,2857],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2854,2857],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\nimport connectDB from '@/lib/mongodb';\r\nimport User from '@/models/User';\r\nimport { generateToken } from '@/lib/auth';\r\nimport { createAuditLog, AuditActions } from '@/lib/audit';\r\nimport { getValidationTranslatorFromRequest } from '@/lib/validation-translations';\r\n\r\nexport async function POST(request: NextRequest) {\r\n  let t: (key: string, fallback: string) => string;\r\n  try {\r\n    await connectDB();\r\n    const body = await request.json();\r\n    const { qrToken, tenantSlug } = body;\r\n    t = await getValidationTranslatorFromRequest(request);\r\n\r\n    // Validation\r\n    if (!qrToken) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.qrTokenRequired', 'QR token is required') },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    // Get tenant ID from slug\r\n    const Tenant = (await import('@/models/Tenant')).default;\r\n    const tenant = await Tenant.findOne({ slug: tenantSlug || 'default', isActive: true }).lean();\r\n    \r\n    if (!tenant) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.tenantNotFoundOrInactive', 'Tenant not found or inactive') },\r\n        { status: 404 }\r\n      );\r\n    }\r\n\r\n    // Find user by QR token\r\n    const user = await User.findOne({ \r\n      qrToken, \r\n      tenantId: tenant._id, \r\n      isActive: true \r\n    });\r\n\r\n    if (!user) {\r\n      await createAuditLog(request, {\r\n        tenantId: tenant._id,\r\n        action: AuditActions.LOGIN,\r\n        entityType: 'user',\r\n        metadata: { success: false, reason: 'invalid_qr_token', method: 'qr' },\r\n      });\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.invalidQrCode', 'Invalid QR code') },\r\n        { status: 401 }\r\n      );\r\n    }\r\n\r\n    // Update last login\r\n    await User.findByIdAndUpdate(user._id, { lastLogin: new Date() });\r\n\r\n    // Generate token\r\n    const token = generateToken({\r\n      userId: user._id.toString(),\r\n      tenantId: tenant._id.toString(),\r\n      email: user.email,\r\n      role: user.role,\r\n    });\r\n\r\n    // Create audit log\r\n    await createAuditLog(request, {\r\n      tenantId: tenant._id,\r\n      action: AuditActions.LOGIN,\r\n      entityType: 'user',\r\n      entityId: user._id.toString(),\r\n      metadata: { success: true, method: 'qr' },\r\n    });\r\n\r\n    // Set cookie\r\n    const response = NextResponse.json({\r\n      success: true,\r\n      data: {\r\n        user: {\r\n          _id: user._id,\r\n          email: user.email,\r\n          name: user.name,\r\n          role: user.role,\r\n        },\r\n        token,\r\n      },\r\n    });\r\n\r\n    response.cookies.set('auth-token', token, {\r\n      httpOnly: true,\r\n      secure: process.env.NODE_ENV === 'production',\r\n      sameSite: 'lax',\r\n      maxAge: 60 * 60 * 24 * 7, // 7 days\r\n    });\r\n\r\n    return response;\r\n  } catch (error: any) {\r\n    console.error('QR login error:', error);\r\n    const errorMessage = error.message || 'Login failed';\r\n    return NextResponse.json(\r\n      { success: false, error: errorMessage },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\auth\\login\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":94,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":94,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3789,3792],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3789,3792],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":158,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":158,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5544,5547],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5544,5547],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\nimport connectDB from '@/lib/mongodb';\r\nimport User from '@/models/User';\r\nimport { generateToken } from '@/lib/auth';\r\nimport { createAuditLog, AuditActions } from '@/lib/audit';\r\nimport { validateEmail } from '@/lib/validation';\r\nimport bcrypt from 'bcryptjs';\r\nimport { getValidationTranslatorFromRequest } from '@/lib/validation-translations';\r\n\r\nexport async function POST(request: NextRequest) {\r\n  let t: (key: string, fallback: string) => string;\r\n  try {\r\n    await connectDB();\r\n    const body = await request.json();\r\n    const { email, password, tenantSlug } = body;\r\n    t = await getValidationTranslatorFromRequest(request);\r\n\r\n    // Validation\r\n    if (!email || !password) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.emailPasswordRequired', 'Email and password are required') },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    if (!validateEmail(email)) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.invalidEmailFormat', 'Invalid email format') },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    // Get tenant ID from slug\r\n    const Tenant = (await import('@/models/Tenant')).default;\r\n    const tenant = await Tenant.findOne({ slug: tenantSlug || 'default', isActive: true }).lean();\r\n    \r\n    if (!tenant) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.tenantNotFoundOrInactive', 'Tenant not found or inactive') },\r\n        { status: 404 }\r\n      );\r\n    }\r\n\r\n    // First check if user exists in any tenant (to provide better error message)\r\n    const userInAnyTenant = await User.findOne({ email: email.toLowerCase(), isActive: true })\r\n      .select('tenantId');\r\n    \r\n    // Find user with password field in the requested tenant - ensure we get a Mongoose document, not a plain object\r\n    const user = await User.findOne({ email: email.toLowerCase(), tenantId: tenant._id })\r\n      .select('+password');\r\n\r\n    if (!user || !user.isActive) {\r\n      // Provide more specific error message\r\n      if (userInAnyTenant) {\r\n        // User exists but not in this tenant\r\n        await createAuditLog(request, {\r\n          tenantId: tenant._id,\r\n          action: AuditActions.LOGIN,\r\n          entityType: 'user',\r\n          metadata: { success: false, reason: 'user_not_in_tenant', email: email.toLowerCase() },\r\n        });\r\n        return NextResponse.json(\r\n          { success: false, error: 'This account does not have access to this store. Please log in to the correct store or contact your administrator.' },\r\n          { status: 403 }\r\n        );\r\n      } else {\r\n        // User doesn't exist at all\r\n        await createAuditLog(request, {\r\n          tenantId: tenant._id,\r\n          action: AuditActions.LOGIN,\r\n          entityType: 'user',\r\n          metadata: { success: false, reason: 'user_not_found', email: email.toLowerCase() },\r\n        });\r\n        return NextResponse.json(\r\n          { success: false, error: t('validation.invalidCredentials', 'Invalid credentials') },\r\n          { status: 401 }\r\n        );\r\n      }\r\n    }\r\n\r\n    // Check if password exists and is a string\r\n    if (!user.password || typeof user.password !== 'string') {\r\n      console.error('User password is missing or invalid for user:', user._id, 'Password type:', typeof user.password);\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.invalidCredentials', 'Invalid credentials') },\r\n        { status: 401 }\r\n      );\r\n    }\r\n\r\n    // Verify password using bcrypt directly (not the method to avoid 'this' context issues)\r\n    let isPasswordValid = false;\r\n    try {\r\n      isPasswordValid = await bcrypt.compare(password, user.password);\r\n    } catch (bcryptError: any) {\r\n      console.error('Bcrypt comparison error:', bcryptError);\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.invalidCredentials', 'Invalid credentials') },\r\n        { status: 401 }\r\n      );\r\n    }\r\n    \r\n    if (!isPasswordValid) {\r\n      await createAuditLog(request, {\r\n        tenantId: tenant._id,\r\n        action: AuditActions.LOGIN,\r\n        entityType: 'user',\r\n        entityId: user._id.toString(),\r\n        metadata: { success: false, reason: 'invalid_password' },\r\n      });\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.invalidCredentials', 'Invalid credentials') },\r\n        { status: 401 }\r\n      );\r\n    }\r\n\r\n    // Update last login\r\n    await User.findByIdAndUpdate(user._id, { lastLogin: new Date() });\r\n\r\n    // Generate token\r\n    const token = generateToken({\r\n      userId: user._id.toString(),\r\n      tenantId: tenant._id.toString(),\r\n      email: user.email,\r\n      role: user.role,\r\n    });\r\n\r\n    // Create audit log\r\n    await createAuditLog(request, {\r\n      tenantId: tenant._id,\r\n      action: AuditActions.LOGIN,\r\n      entityType: 'user',\r\n      entityId: user._id.toString(),\r\n      metadata: { success: true },\r\n    });\r\n\r\n    // Set cookie\r\n    const response = NextResponse.json({\r\n      success: true,\r\n      data: {\r\n        user: {\r\n          _id: user._id,\r\n          email: user.email,\r\n          name: user.name,\r\n          role: user.role,\r\n        },\r\n        token,\r\n      },\r\n    });\r\n\r\n    response.cookies.set('auth-token', token, {\r\n      httpOnly: true,\r\n      secure: process.env.NODE_ENV === 'production',\r\n      sameSite: 'lax',\r\n      maxAge: 60 * 60 * 24 * 7, // 7 days\r\n    });\r\n\r\n    return response;\r\n  } catch (error: any) {\r\n    console.error('Login error:', error);\r\n    const errorMessage = error.message || 'Login failed';\r\n    return NextResponse.json(\r\n      { success: false, error: errorMessage },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\auth\\logout\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":24,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":24,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[801,804],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[801,804],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\nimport { getCurrentUser } from '@/lib/auth';\r\nimport { createAuditLog, AuditActions } from '@/lib/audit';\r\nimport { getValidationTranslatorFromRequest } from '@/lib/validation-translations';\r\n\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    const user = await getCurrentUser(request);\r\n    \r\n    if (user) {\r\n      await createAuditLog(request, {\r\n        tenantId: user.tenantId,\r\n        action: AuditActions.LOGOUT,\r\n        entityType: 'user',\r\n        entityId: user.userId,\r\n        metadata: { success: true },\r\n      });\r\n    }\r\n\r\n    const response = NextResponse.json({ success: true, message: 'Logged out successfully' });\r\n    response.cookies.delete('auth-token');\r\n    \r\n    return response;\r\n  } catch (error: any) {\r\n    const t = await getValidationTranslatorFromRequest(request);\r\n    return NextResponse.json(\r\n      { success: false, error: error.message || t('validation.logoutFailed', 'Logout failed') },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\auth\\me\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":34,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":34,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1150,1153],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1150,1153],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\nimport { getCurrentUser } from '@/lib/auth';\r\nimport connectDB from '@/lib/mongodb';\r\nimport User from '@/models/User';\r\nimport { getValidationTranslatorFromRequest } from '@/lib/validation-translations';\r\n\r\nexport async function GET(request: NextRequest) {\r\n  try {\r\n    const user = await getCurrentUser(request);\r\n    const t = await getValidationTranslatorFromRequest(request);\r\n    \r\n    if (!user) {\r\n      return NextResponse.json({ success: false, error: t('validation.notAuthenticated', 'Not authenticated') }, { status: 401 });\r\n    }\r\n\r\n    await connectDB();\r\n    const userDoc = await User.findById(user.userId)\r\n      .select('-password')\r\n      .lean();\r\n\r\n    if (!userDoc || !userDoc.isActive) {\r\n      return NextResponse.json({ success: false, error: t('validation.userNotFoundOrInactive', 'User not found or inactive') }, { status: 401 });\r\n    }\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      user: {\r\n        _id: userDoc._id,\r\n        email: userDoc.email,\r\n        name: userDoc.name,\r\n        role: userDoc.role,\r\n      },\r\n    });\r\n  } catch (error: any) {\r\n    return NextResponse.json({ success: false, error: error.message }, { status: 500 });\r\n  }\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\auth\\profile\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\auth\\qr-code\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'t' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":60,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":60,"endColumn":6}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\nimport crypto from 'crypto';\r\nimport connectDB from '@/lib/mongodb';\r\nimport User from '@/models/User';\r\nimport { requireAuth } from '@/lib/auth';\r\nimport { getValidationTranslatorFromRequest } from '@/lib/validation-translations';\r\n\r\n/**\r\n * GET - Get current user's QR code token (generates one if it doesn't exist)\r\n */\r\nexport async function GET(request: NextRequest) {\r\n  let t: (key: string, fallback: string) => string;\r\n  try {\r\n    const user = await requireAuth(request);\r\n    await connectDB();\r\n    t = await getValidationTranslatorFromRequest(request);\r\n\r\n    const userDoc = await User.findById(user.userId).select('qrToken name email');\r\n    \r\n    if (!userDoc) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.userNotFound', 'User not found') },\r\n        { status: 404 }\r\n      );\r\n    }\r\n\r\n    // Generate QR token if it doesn't exist\r\n    if (!userDoc.qrToken) {\r\n      const newQrToken = crypto.randomBytes(32).toString('hex');\r\n      await User.findByIdAndUpdate(user.userId, { qrToken: newQrToken });\r\n      userDoc.qrToken = newQrToken;\r\n    }\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      data: {\r\n        qrToken: userDoc.qrToken,\r\n        name: userDoc.name,\r\n        email: userDoc.email,\r\n      },\r\n    });\r\n  } catch (error: unknown) {\r\n    console.error('Get QR code error:', error);\r\n    const errorMessage = (error as Error).message || 'Failed to get QR code';\r\n    return NextResponse.json(\r\n      { success: false, error: errorMessage },\r\n      { status: (error as Error).message === 'Unauthorized' ? 401 : 500 }\r\n    );\r\n  }\r\n}\r\n\r\n/**\r\n * POST - Generate or regenerate QR code token for current user\r\n */\r\nexport async function POST(request: NextRequest) {\r\n  let t: (key: string, fallback: string) => string;\r\n  try {\r\n    const user = await requireAuth(request);\r\n    await connectDB();\r\n    t = await getValidationTranslatorFromRequest(request);\r\n\r\n    // Generate new QR token (or create if doesn't exist)\r\n    const newQrToken = crypto.randomBytes(32).toString('hex');\r\n    \r\n    await User.findByIdAndUpdate(user.userId, { qrToken: newQrToken });\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      data: {\r\n        qrToken: newQrToken,\r\n      },\r\n    });\r\n  } catch (error: unknown) {\r\n    console.error('Generate/Regenerate QR code error:', error);\r\n    const errorMessage = (error as Error).message || 'Failed to generate QR code';\r\n    return NextResponse.json(\r\n      { success: false, error: errorMessage },\r\n      { status: (error as Error).message === 'Unauthorized' ? 401 : 500 }\r\n    );\r\n  }\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\auth\\register\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\auth\\reset-password\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":38,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":38,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1368,1371],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1368,1371],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":160,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":160,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5174,5177],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5174,5177],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":161,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":161,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5223,5226],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5223,5226],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":180,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":180,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5852,5855],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5852,5855],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":181,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":181,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5893,5896],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5893,5896],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\nimport connectDB from '@/lib/mongodb';\r\nimport User from '@/models/User';\r\nimport { validateEmail, validatePassword } from '@/lib/validation';\r\nimport { getValidationTranslatorFromRequest } from '@/lib/validation-translations';\r\nimport { createAuditLog, AuditActions } from '@/lib/audit';\r\nimport { getCurrentUser } from '@/lib/auth';\r\nimport bcrypt from 'bcryptjs';\r\n\r\n/**\r\n * POST /api/auth/reset-password\r\n *\r\n * Two modes:\r\n * 1. Authenticated user changing their password:\r\n *    Body: { currentPassword, newPassword }\r\n *    Requires: valid auth token\r\n *\r\n * 2. Unauthenticated password reset (e.g. via email token):\r\n *    Body: { email, tenantId, resetToken, newPassword }\r\n *    Requires: valid reset token\r\n */\r\nexport async function POST(request: NextRequest) {\r\n  let t: (key: string, fallback: string) => string;\r\n  try {\r\n    await connectDB();\r\n    t = await getValidationTranslatorFromRequest(request);\r\n    const body = await request.json();\r\n\r\n    const currentUser = await getCurrentUser(request);\r\n\r\n    if (currentUser) {\r\n      // Mode 1: Authenticated password change\r\n      return await handleAuthenticatedReset(request, body, currentUser, t);\r\n    } else {\r\n      // Mode 2: Token-based password reset\r\n      return await handleTokenReset(request, body, t);\r\n    }\r\n  } catch (error: any) {\r\n    return NextResponse.json(\r\n      { success: false, error: error.message || 'Password reset failed' },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n\r\nasync function handleAuthenticatedReset(\r\n  request: NextRequest,\r\n  body: { currentPassword?: string; newPassword?: string },\r\n  currentUser: { userId: string; tenantId: string; email: string; role: string },\r\n  t: (key: string, fallback: string) => string\r\n) {\r\n  const { currentPassword, newPassword } = body;\r\n\r\n  if (!currentPassword || !newPassword) {\r\n    return NextResponse.json(\r\n      { success: false, error: t('validation.passwordFieldsRequired', 'Current password and new password are required') },\r\n      { status: 400 }\r\n    );\r\n  }\r\n\r\n  const passwordValidation = validatePassword(newPassword, t);\r\n  if (!passwordValidation.valid) {\r\n    return NextResponse.json(\r\n      { success: false, error: 'Password validation failed', errors: passwordValidation.errors },\r\n      { status: 400 }\r\n    );\r\n  }\r\n\r\n  const user = await User.findById(currentUser.userId).select('+password');\r\n  if (!user) {\r\n    return NextResponse.json(\r\n      { success: false, error: t('validation.userNotFound', 'User not found') },\r\n      { status: 404 }\r\n    );\r\n  }\r\n\r\n  // Verify current password\r\n  const isCurrentPasswordValid = await bcrypt.compare(currentPassword, user.password);\r\n  if (!isCurrentPasswordValid) {\r\n    return NextResponse.json(\r\n      { success: false, error: t('validation.currentPasswordIncorrect', 'Current password is incorrect') },\r\n      { status: 401 }\r\n    );\r\n  }\r\n\r\n  // Update password (pre-save hook will hash it)\r\n  user.password = newPassword;\r\n  await user.save();\r\n\r\n  await createAuditLog(request, {\r\n    tenantId: currentUser.tenantId,\r\n    action: AuditActions.UPDATE,\r\n    entityType: 'user',\r\n    entityId: currentUser.userId,\r\n    changes: { passwordChanged: true },\r\n  });\r\n\r\n  return NextResponse.json({\r\n    success: true,\r\n    message: t('validation.passwordResetSuccess', 'Password has been reset successfully'),\r\n  });\r\n}\r\n\r\nasync function handleTokenReset(\r\n  request: NextRequest,\r\n  body: { email?: string; tenantId?: string; resetToken?: string; newPassword?: string },\r\n  t: (key: string, fallback: string) => string\r\n) {\r\n  const { email, tenantId, resetToken, newPassword } = body;\r\n\r\n  if (!email || !tenantId || !resetToken || !newPassword) {\r\n    return NextResponse.json(\r\n      { success: false, error: t('validation.resetFieldsRequired', 'Email, tenantId, resetToken, and newPassword are required') },\r\n      { status: 400 }\r\n    );\r\n  }\r\n\r\n  if (!validateEmail(email)) {\r\n    return NextResponse.json(\r\n      { success: false, error: t('validation.invalidEmailFormat', 'Invalid email format') },\r\n      { status: 400 }\r\n    );\r\n  }\r\n\r\n  const passwordValidation = validatePassword(newPassword, t);\r\n  if (!passwordValidation.valid) {\r\n    return NextResponse.json(\r\n      { success: false, error: 'Password validation failed', errors: passwordValidation.errors },\r\n      { status: 400 }\r\n    );\r\n  }\r\n\r\n  // Find tenant\r\n  const Tenant = (await import('@/models/Tenant')).default;\r\n  const tenant = await Tenant.findOne({\r\n    $or: [{ slug: tenantId }, { _id: tenantId }],\r\n    isActive: true,\r\n  });\r\n\r\n  if (!tenant) {\r\n    return NextResponse.json(\r\n      { success: false, error: t('validation.tenantNotFound', 'Tenant not found or inactive') },\r\n      { status: 404 }\r\n    );\r\n  }\r\n\r\n  const user = await User.findOne({\r\n    email: email.toLowerCase(),\r\n    tenantId: tenant._id,\r\n  }).select('+password +resetToken +resetTokenExpiry');\r\n\r\n  if (!user) {\r\n    return NextResponse.json(\r\n      { success: false, error: t('validation.invalidCredentials', 'Invalid credentials') },\r\n      { status: 400 }\r\n    );\r\n  }\r\n\r\n  // Verify reset token and expiry\r\n  const storedToken = (user as any).resetToken;\r\n  const tokenExpiry = (user as any).resetTokenExpiry;\r\n\r\n  if (!storedToken || !tokenExpiry) {\r\n    return NextResponse.json(\r\n      { success: false, error: t('validation.invalidResetToken', 'Invalid or expired reset token') },\r\n      { status: 400 }\r\n    );\r\n  }\r\n\r\n  const isTokenValid = await bcrypt.compare(resetToken, storedToken);\r\n  if (!isTokenValid || new Date() > new Date(tokenExpiry)) {\r\n    return NextResponse.json(\r\n      { success: false, error: t('validation.invalidResetToken', 'Invalid or expired reset token') },\r\n      { status: 400 }\r\n    );\r\n  }\r\n\r\n  // Update password and clear reset token\r\n  user.password = newPassword;\r\n  (user as any).resetToken = undefined;\r\n  (user as any).resetTokenExpiry = undefined;\r\n  await user.save();\r\n\r\n  await createAuditLog(request, {\r\n    tenantId: tenant._id.toString(),\r\n    action: AuditActions.UPDATE,\r\n    entityType: 'user',\r\n    entityId: user._id.toString(),\r\n    changes: { passwordReset: true, method: 'token' },\r\n  });\r\n\r\n  return NextResponse.json({\r\n    success: true,\r\n    message: t('validation.passwordResetSuccess', 'Password has been reset successfully'),\r\n  });\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\automations\\analytics\\sales-trends\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":23,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":23,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[857,860],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[857,860],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":52,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":52,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2008,2011],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2008,2011],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * API Route for Sales Trend Analysis\r\n */\r\n\r\nimport { NextRequest, NextResponse } from 'next/server';\r\nimport { analyzeSalesTrends } from '@/lib/automations';\r\n\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    const body = await request.json().catch(() => ({}));\r\n    const { tenantId, period, comparePeriods } = body;\r\n\r\n    const isVercelCron = request.headers.get('authorization') === `Bearer ${process.env.CRON_SECRET}`;\r\n    const cronSecret = process.env.CRON_SECRET;\r\n    const providedSecret = body.secret;\r\n\r\n    if (cronSecret && !isVercelCron && providedSecret !== cronSecret) {\r\n      return NextResponse.json({ success: false, error: 'Unauthorized' }, { status: 401 });\r\n    }\r\n\r\n    const result = await analyzeSalesTrends({ tenantId, period, comparePeriods });\r\n    return NextResponse.json(result);\r\n  } catch (error: any) {\r\n    console.error('Sales trend analysis error:', error);\r\n    return NextResponse.json({\r\n      success: false,\r\n      message: `Error: ${error.message}`,\r\n      processed: 0,\r\n      failed: 0,\r\n      errors: [error.message],\r\n    }, { status: 500 });\r\n  }\r\n}\r\n\r\nexport async function GET(request: NextRequest) {\r\n  try {\r\n    const searchParams = request.nextUrl.searchParams;\r\n    const tenantId = searchParams.get('tenantId') || undefined;\r\n    const period = searchParams.get('period') as 'daily' | 'weekly' | 'monthly' | undefined;\r\n    const comparePeriods = searchParams.get('comparePeriods') !== 'false';\r\n\r\n    const isVercelCron = request.headers.get('authorization') === `Bearer ${process.env.CRON_SECRET}`;\r\n    const cronSecret = process.env.CRON_SECRET;\r\n    const providedSecret = searchParams.get('secret');\r\n\r\n    if (cronSecret && !isVercelCron && providedSecret !== cronSecret) {\r\n      return NextResponse.json({ success: false, error: 'Unauthorized' }, { status: 401 });\r\n    }\r\n\r\n    const result = await analyzeSalesTrends({ tenantId, period, comparePeriods });\r\n    return NextResponse.json(result);\r\n  } catch (error: any) {\r\n    console.error('Sales trend analysis error:', error);\r\n    return NextResponse.json({\r\n      success: false,\r\n      message: `Error: ${error.message}`,\r\n      processed: 0,\r\n      failed: 0,\r\n      errors: [error.message],\r\n    }, { status: 500 });\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\automations\\attendance\\auto-clockout\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":32,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":32,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1017,1020],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1017,1020],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":73,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":73,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2286,2289],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2286,2289],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * API Route for Automatic Attendance Clock-Out\r\n * Can be called by cron jobs or manually\r\n */\r\n\r\nimport { NextRequest, NextResponse } from 'next/server';\r\nimport { autoClockOutForgottenSessions } from '@/lib/automations';\r\n\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    const body = await request.json().catch(() => ({}));\r\n    const { tenantId, gracePeriodHours } = body;\r\n\r\n    // Allow Vercel cron jobs or verify secret\r\n    const isVercelCron = request.headers.get('authorization') === `Bearer ${process.env.CRON_SECRET}`;\r\n    const cronSecret = process.env.CRON_SECRET;\r\n    const providedSecret = body.secret;\r\n\r\n    if (cronSecret && !isVercelCron && providedSecret !== cronSecret) {\r\n      return NextResponse.json(\r\n        { success: false, error: 'Unauthorized' },\r\n        { status: 401 }\r\n      );\r\n    }\r\n\r\n    const result = await autoClockOutForgottenSessions({\r\n      tenantId,\r\n      gracePeriodHours,\r\n    });\r\n\r\n    return NextResponse.json(result);\r\n  } catch (error: any) {\r\n    console.error('Auto clock-out automation error:', error);\r\n    return NextResponse.json(\r\n      {\r\n        success: false,\r\n        message: `Error: ${error.message}`,\r\n        processed: 0,\r\n        failed: 0,\r\n        errors: [error.message],\r\n      },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n\r\nexport async function GET(request: NextRequest) {\r\n  try {\r\n    const searchParams = request.nextUrl.searchParams;\r\n    const tenantId = searchParams.get('tenantId') || undefined;\r\n    const gracePeriodHours = searchParams.get('gracePeriodHours')\r\n      ? parseInt(searchParams.get('gracePeriodHours')!, 10)\r\n      : undefined;\r\n\r\n    // Allow Vercel cron jobs or verify secret\r\n    const isVercelCron = request.headers.get('authorization') === `Bearer ${process.env.CRON_SECRET}`;\r\n    const cronSecret = process.env.CRON_SECRET;\r\n    const providedSecret = searchParams.get('secret');\r\n\r\n    if (cronSecret && !isVercelCron && providedSecret !== cronSecret) {\r\n      return NextResponse.json(\r\n        { success: false, error: 'Unauthorized' },\r\n        { status: 401 }\r\n      );\r\n    }\r\n\r\n    const result = await autoClockOutForgottenSessions({\r\n      tenantId,\r\n      gracePeriodHours,\r\n    });\r\n\r\n    return NextResponse.json(result);\r\n  } catch (error: any) {\r\n    console.error('Auto clock-out automation error:', error);\r\n    return NextResponse.json(\r\n      {\r\n        success: false,\r\n        message: `Error: ${error.message}`,\r\n        processed: 0,\r\n        failed: 0,\r\n        errors: [error.message],\r\n      },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\automations\\attendance\\break-detection\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":23,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":23,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[840,843],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[840,843],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":53,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":53,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1956,1959],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1956,1959],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * API Route for Automatic Break Detection\r\n */\r\n\r\nimport { NextRequest, NextResponse } from 'next/server';\r\nimport { detectBreaks } from '@/lib/automations';\r\n\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    const body = await request.json().catch(() => ({}));\r\n    const { tenantId, inactivityMinutes } = body;\r\n\r\n    const isVercelCron = request.headers.get('authorization') === `Bearer ${process.env.CRON_SECRET}`;\r\n    const cronSecret = process.env.CRON_SECRET;\r\n    const providedSecret = body.secret;\r\n\r\n    if (cronSecret && !isVercelCron && providedSecret !== cronSecret) {\r\n      return NextResponse.json({ success: false, error: 'Unauthorized' }, { status: 401 });\r\n    }\r\n\r\n    const result = await detectBreaks({ tenantId, inactivityMinutes });\r\n    return NextResponse.json(result);\r\n  } catch (error: any) {\r\n    console.error('Break detection error:', error);\r\n    return NextResponse.json({\r\n      success: false,\r\n      message: `Error: ${error.message}`,\r\n      processed: 0,\r\n      failed: 0,\r\n      errors: [error.message],\r\n    }, { status: 500 });\r\n  }\r\n}\r\n\r\nexport async function GET(request: NextRequest) {\r\n  try {\r\n    const searchParams = request.nextUrl.searchParams;\r\n    const tenantId = searchParams.get('tenantId') || undefined;\r\n    const inactivityMinutes = searchParams.get('inactivityMinutes')\r\n      ? parseInt(searchParams.get('inactivityMinutes')!, 10)\r\n      : undefined;\r\n\r\n    const isVercelCron = request.headers.get('authorization') === `Bearer ${process.env.CRON_SECRET}`;\r\n    const cronSecret = process.env.CRON_SECRET;\r\n    const providedSecret = searchParams.get('secret');\r\n\r\n    if (cronSecret && !isVercelCron && providedSecret !== cronSecret) {\r\n      return NextResponse.json({ success: false, error: 'Unauthorized' }, { status: 401 });\r\n    }\r\n\r\n    const result = await detectBreaks({ tenantId, inactivityMinutes });\r\n    return NextResponse.json(result);\r\n  } catch (error: any) {\r\n    console.error('Break detection error:', error);\r\n    return NextResponse.json({\r\n      success: false,\r\n      message: `Error: ${error.message}`,\r\n      processed: 0,\r\n      failed: 0,\r\n      errors: [error.message],\r\n    }, { status: 500 });\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\automations\\attendance\\violations\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":23,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":23,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[876,879],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[876,879],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":53,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":53,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2024,2027],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2024,2027],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * API Route for Attendance Violation Alerts\r\n */\r\n\r\nimport { NextRequest, NextResponse } from 'next/server';\r\nimport { detectAttendanceViolations } from '@/lib/automations';\r\n\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    const body = await request.json().catch(() => ({}));\r\n    const { tenantId, lateThresholdMinutes } = body;\r\n\r\n    const isVercelCron = request.headers.get('authorization') === `Bearer ${process.env.CRON_SECRET}`;\r\n    const cronSecret = process.env.CRON_SECRET;\r\n    const providedSecret = body.secret;\r\n\r\n    if (cronSecret && !isVercelCron && providedSecret !== cronSecret) {\r\n      return NextResponse.json({ success: false, error: 'Unauthorized' }, { status: 401 });\r\n    }\r\n\r\n    const result = await detectAttendanceViolations({ tenantId, lateThresholdMinutes });\r\n    return NextResponse.json(result);\r\n  } catch (error: any) {\r\n    console.error('Attendance violations error:', error);\r\n    return NextResponse.json({\r\n      success: false,\r\n      message: `Error: ${error.message}`,\r\n      processed: 0,\r\n      failed: 0,\r\n      errors: [error.message],\r\n    }, { status: 500 });\r\n  }\r\n}\r\n\r\nexport async function GET(request: NextRequest) {\r\n  try {\r\n    const searchParams = request.nextUrl.searchParams;\r\n    const tenantId = searchParams.get('tenantId') || undefined;\r\n    const lateThresholdMinutes = searchParams.get('lateThresholdMinutes')\r\n      ? parseInt(searchParams.get('lateThresholdMinutes')!, 10)\r\n      : undefined;\r\n\r\n    const isVercelCron = request.headers.get('authorization') === `Bearer ${process.env.CRON_SECRET}`;\r\n    const cronSecret = process.env.CRON_SECRET;\r\n    const providedSecret = searchParams.get('secret');\r\n\r\n    if (cronSecret && !isVercelCron && providedSecret !== cronSecret) {\r\n      return NextResponse.json({ success: false, error: 'Unauthorized' }, { status: 401 });\r\n    }\r\n\r\n    const result = await detectAttendanceViolations({ tenantId, lateThresholdMinutes });\r\n    return NextResponse.json(result);\r\n  } catch (error: any) {\r\n    console.error('Attendance violations error:', error);\r\n    return NextResponse.json({\r\n      success: false,\r\n      message: `Error: ${error.message}`,\r\n      processed: 0,\r\n      failed: 0,\r\n      errors: [error.message],\r\n    }, { status: 500 });\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\automations\\audit-logs\\cleanup\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":23,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":23,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[852,855],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[852,855],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":54,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":54,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2032,2035],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2032,2035],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * API Route for Audit Log Cleanup\r\n */\r\n\r\nimport { NextRequest, NextResponse } from 'next/server';\r\nimport { cleanupAuditLogs } from '@/lib/automations';\r\n\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    const body = await request.json().catch(() => ({}));\r\n    const { tenantId, retentionYears, archive } = body;\r\n\r\n    const isVercelCron = request.headers.get('authorization') === `Bearer ${process.env.CRON_SECRET}`;\r\n    const cronSecret = process.env.CRON_SECRET;\r\n    const providedSecret = body.secret;\r\n\r\n    if (cronSecret && !isVercelCron && providedSecret !== cronSecret) {\r\n      return NextResponse.json({ success: false, error: 'Unauthorized' }, { status: 401 });\r\n    }\r\n\r\n    const result = await cleanupAuditLogs({ tenantId, retentionYears, archive });\r\n    return NextResponse.json(result);\r\n  } catch (error: any) {\r\n    console.error('Audit log cleanup error:', error);\r\n    return NextResponse.json({\r\n      success: false,\r\n      message: `Error: ${error.message}`,\r\n      processed: 0,\r\n      failed: 0,\r\n      errors: [error.message],\r\n    }, { status: 500 });\r\n  }\r\n}\r\n\r\nexport async function GET(request: NextRequest) {\r\n  try {\r\n    const searchParams = request.nextUrl.searchParams;\r\n    const tenantId = searchParams.get('tenantId') || undefined;\r\n    const retentionYears = searchParams.get('retentionYears')\r\n      ? parseInt(searchParams.get('retentionYears')!, 10)\r\n      : undefined;\r\n    const archive = searchParams.get('archive') === 'true';\r\n\r\n    const isVercelCron = request.headers.get('authorization') === `Bearer ${process.env.CRON_SECRET}`;\r\n    const cronSecret = process.env.CRON_SECRET;\r\n    const providedSecret = searchParams.get('secret');\r\n\r\n    if (cronSecret && !isVercelCron && providedSecret !== cronSecret) {\r\n      return NextResponse.json({ success: false, error: 'Unauthorized' }, { status: 401 });\r\n    }\r\n\r\n    const result = await cleanupAuditLogs({ tenantId, retentionYears, archive });\r\n    return NextResponse.json(result);\r\n  } catch (error: any) {\r\n    console.error('Audit log cleanup error:', error);\r\n    return NextResponse.json({\r\n      success: false,\r\n      message: `Error: ${error.message}`,\r\n      processed: 0,\r\n      failed: 0,\r\n      errors: [error.message],\r\n    }, { status: 500 });\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\automations\\backups\\create\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":23,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":23,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[863,866],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[863,866],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":50,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":50,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1817,1820],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1817,1820],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * API Route for Database Backups\r\n */\r\n\r\nimport { NextRequest, NextResponse } from 'next/server';\r\nimport { createDatabaseBackup } from '@/lib/automations';\r\n\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    const body = await request.json().catch(() => ({}));\r\n    const { tenantId, backupPath, uploadToCloud } = body;\r\n\r\n    const isVercelCron = request.headers.get('authorization') === `Bearer ${process.env.CRON_SECRET}`;\r\n    const cronSecret = process.env.CRON_SECRET;\r\n    const providedSecret = body.secret;\r\n\r\n    if (cronSecret && !isVercelCron && providedSecret !== cronSecret) {\r\n      return NextResponse.json({ success: false, error: 'Unauthorized' }, { status: 401 });\r\n    }\r\n\r\n    const result = await createDatabaseBackup({ tenantId, backupPath, uploadToCloud });\r\n    return NextResponse.json(result);\r\n  } catch (error: any) {\r\n    console.error('Database backup error:', error);\r\n    return NextResponse.json({\r\n      success: false,\r\n      message: `Error: ${error.message}`,\r\n      processed: 0,\r\n      failed: 0,\r\n      errors: [error.message],\r\n    }, { status: 500 });\r\n  }\r\n}\r\n\r\nexport async function GET(request: NextRequest) {\r\n  try {\r\n    const searchParams = request.nextUrl.searchParams;\r\n    const tenantId = searchParams.get('tenantId') || undefined;\r\n\r\n    const isVercelCron = request.headers.get('authorization') === `Bearer ${process.env.CRON_SECRET}`;\r\n    const cronSecret = process.env.CRON_SECRET;\r\n    const providedSecret = searchParams.get('secret');\r\n\r\n    if (cronSecret && !isVercelCron && providedSecret !== cronSecret) {\r\n      return NextResponse.json({ success: false, error: 'Unauthorized' }, { status: 401 });\r\n    }\r\n\r\n    const result = await createDatabaseBackup({ tenantId });\r\n    return NextResponse.json(result);\r\n  } catch (error: any) {\r\n    console.error('Database backup error:', error);\r\n    return NextResponse.json({\r\n      success: false,\r\n      message: `Error: ${error.message}`,\r\n      processed: 0,\r\n      failed: 0,\r\n      errors: [error.message],\r\n    }, { status: 500 });\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\automations\\booking-reminders\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":35,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":35,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1077,1080],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1077,1080],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":78,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":78,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2487,2490],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2487,2490],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * API Route for Automated Booking Reminders\r\n * Can be called by cron jobs or manually\r\n */\r\n\r\nimport { NextRequest, NextResponse } from 'next/server';\r\nimport { sendBookingReminders } from '@/lib/automations';\r\n\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    const body = await request.json().catch(() => ({}));\r\n    const { tenantId, hoursBefore } = body;\r\n\r\n    // Optional: Add authentication/authorization for manual triggers\r\n    // For cron jobs, you might want to use a secret token\r\n    const authHeader = request.headers.get('authorization');\r\n    const cronSecret = process.env.CRON_SECRET;\r\n\r\n    if (authHeader && cronSecret) {\r\n      const token = authHeader.replace('Bearer ', '');\r\n      if (token !== cronSecret) {\r\n        return NextResponse.json(\r\n          { success: false, error: 'Unauthorized' },\r\n          { status: 401 }\r\n        );\r\n      }\r\n    }\r\n\r\n    const result = await sendBookingReminders({\r\n      tenantId,\r\n      hoursBefore: hoursBefore || 24,\r\n    });\r\n\r\n    return NextResponse.json(result);\r\n  } catch (error: any) {\r\n    console.error('Booking reminders automation error:', error);\r\n    return NextResponse.json(\r\n      {\r\n        success: false,\r\n        message: `Error: ${error.message}`,\r\n        processed: 0,\r\n        failed: 0,\r\n        errors: [error.message],\r\n      },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n\r\n// Also support GET for easy cron job setup\r\nexport async function GET(request: NextRequest) {\r\n  try {\r\n    const searchParams = request.nextUrl.searchParams;\r\n    const tenantId = searchParams.get('tenantId') || undefined;\r\n    const hoursBefore = searchParams.get('hoursBefore')\r\n      ? parseInt(searchParams.get('hoursBefore')!, 10)\r\n      : undefined;\r\n\r\n    // Allow Vercel cron jobs (they send a special header) or verify secret\r\n    const isVercelCron = request.headers.get('authorization') === `Bearer ${process.env.CRON_SECRET}`;\r\n    const cronSecret = process.env.CRON_SECRET;\r\n    const providedSecret = searchParams.get('secret');\r\n\r\n    // Allow if: Vercel cron, or no secret configured, or secret matches\r\n    if (cronSecret && !isVercelCron && providedSecret !== cronSecret) {\r\n      return NextResponse.json(\r\n        { success: false, error: 'Unauthorized' },\r\n        { status: 401 }\r\n      );\r\n    }\r\n\r\n    const result = await sendBookingReminders({\r\n      tenantId,\r\n      hoursBefore: hoursBefore || 24,\r\n    });\r\n\r\n    return NextResponse.json(result);\r\n  } catch (error: any) {\r\n    console.error('Booking reminders automation error:', error);\r\n    return NextResponse.json(\r\n      {\r\n        success: false,\r\n        message: `Error: ${error.message}`,\r\n        processed: 0,\r\n        failed: 0,\r\n        errors: [error.message],\r\n      },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\automations\\bookings\\confirm\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":29,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":29,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[964,967],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[964,967],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":65,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":65,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2121,2124],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2121,2124],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * API Route for Automatic Booking Confirmations\r\n * Can be called by cron jobs or manually\r\n */\r\n\r\nimport { NextRequest, NextResponse } from 'next/server';\r\nimport { autoConfirmBookings } from '@/lib/automations';\r\n\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    const body = await request.json().catch(() => ({}));\r\n    const { tenantId, bookingId } = body;\r\n\r\n    // Allow Vercel cron jobs or verify secret\r\n    const isVercelCron = request.headers.get('authorization') === `Bearer ${process.env.CRON_SECRET}`;\r\n    const cronSecret = process.env.CRON_SECRET;\r\n    const providedSecret = body.secret;\r\n\r\n    if (cronSecret && !isVercelCron && providedSecret !== cronSecret) {\r\n      return NextResponse.json(\r\n        { success: false, error: 'Unauthorized' },\r\n        { status: 401 }\r\n      );\r\n    }\r\n\r\n    const result = await autoConfirmBookings({ tenantId, bookingId });\r\n\r\n    return NextResponse.json(result);\r\n  } catch (error: any) {\r\n    console.error('Booking confirmation automation error:', error);\r\n    return NextResponse.json(\r\n      {\r\n        success: false,\r\n        message: `Error: ${error.message}`,\r\n        processed: 0,\r\n        failed: 0,\r\n        errors: [error.message],\r\n      },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n\r\nexport async function GET(request: NextRequest) {\r\n  try {\r\n    const searchParams = request.nextUrl.searchParams;\r\n    const tenantId = searchParams.get('tenantId') || undefined;\r\n    const bookingId = searchParams.get('bookingId') || undefined;\r\n\r\n    // Allow Vercel cron jobs or verify secret\r\n    const isVercelCron = request.headers.get('authorization') === `Bearer ${process.env.CRON_SECRET}`;\r\n    const cronSecret = process.env.CRON_SECRET;\r\n    const providedSecret = searchParams.get('secret');\r\n\r\n    if (cronSecret && !isVercelCron && providedSecret !== cronSecret) {\r\n      return NextResponse.json(\r\n        { success: false, error: 'Unauthorized' },\r\n        { status: 401 }\r\n      );\r\n    }\r\n\r\n    const result = await autoConfirmBookings({ tenantId, bookingId });\r\n\r\n    return NextResponse.json(result);\r\n  } catch (error: any) {\r\n    console.error('Booking confirmation automation error:', error);\r\n    return NextResponse.json(\r\n      {\r\n        success: false,\r\n        message: `Error: ${error.message}`,\r\n        processed: 0,\r\n        failed: 0,\r\n        errors: [error.message],\r\n      },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\automations\\bookings\\no-show\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":32,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":32,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[986,989],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[986,989],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":73,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":73,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2250,2253],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2250,2253],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * API Route for Automatic No-Show Detection\r\n * Can be called by cron jobs or manually\r\n */\r\n\r\nimport { NextRequest, NextResponse } from 'next/server';\r\nimport { detectNoShows } from '@/lib/automations';\r\n\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    const body = await request.json().catch(() => ({}));\r\n    const { tenantId, gracePeriodMinutes } = body;\r\n\r\n    // Allow Vercel cron jobs or verify secret\r\n    const isVercelCron = request.headers.get('authorization') === `Bearer ${process.env.CRON_SECRET}`;\r\n    const cronSecret = process.env.CRON_SECRET;\r\n    const providedSecret = body.secret;\r\n\r\n    if (cronSecret && !isVercelCron && providedSecret !== cronSecret) {\r\n      return NextResponse.json(\r\n        { success: false, error: 'Unauthorized' },\r\n        { status: 401 }\r\n      );\r\n    }\r\n\r\n    const result = await detectNoShows({\r\n      tenantId,\r\n      gracePeriodMinutes,\r\n    });\r\n\r\n    return NextResponse.json(result);\r\n  } catch (error: any) {\r\n    console.error('No-show detection automation error:', error);\r\n    return NextResponse.json(\r\n      {\r\n        success: false,\r\n        message: `Error: ${error.message}`,\r\n        processed: 0,\r\n        failed: 0,\r\n        errors: [error.message],\r\n      },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n\r\nexport async function GET(request: NextRequest) {\r\n  try {\r\n    const searchParams = request.nextUrl.searchParams;\r\n    const tenantId = searchParams.get('tenantId') || undefined;\r\n    const gracePeriodMinutes = searchParams.get('gracePeriodMinutes')\r\n      ? parseInt(searchParams.get('gracePeriodMinutes')!, 10)\r\n      : undefined;\r\n\r\n    // Allow Vercel cron jobs or verify secret\r\n    const isVercelCron = request.headers.get('authorization') === `Bearer ${process.env.CRON_SECRET}`;\r\n    const cronSecret = process.env.CRON_SECRET;\r\n    const providedSecret = searchParams.get('secret');\r\n\r\n    if (cronSecret && !isVercelCron && providedSecret !== cronSecret) {\r\n      return NextResponse.json(\r\n        { success: false, error: 'Unauthorized' },\r\n        { status: 401 }\r\n      );\r\n    }\r\n\r\n    const result = await detectNoShows({\r\n      tenantId,\r\n      gracePeriodMinutes,\r\n    });\r\n\r\n    return NextResponse.json(result);\r\n  } catch (error: any) {\r\n    console.error('No-show detection automation error:', error);\r\n    return NextResponse.json(\r\n      {\r\n        success: false,\r\n        message: `Error: ${error.message}`,\r\n        processed: 0,\r\n        failed: 0,\r\n        errors: [error.message],\r\n      },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\automations\\carts\\abandoned\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":23,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":23,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[849,852],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[849,852],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":53,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":53,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1952,1955],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1952,1955],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * API Route for Abandoned Cart Reminders\r\n */\r\n\r\nimport { NextRequest, NextResponse } from 'next/server';\r\nimport { sendAbandonedCartReminders } from '@/lib/automations';\r\n\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    const body = await request.json().catch(() => ({}));\r\n    const { tenantId, hoursAgo } = body;\r\n\r\n    const isVercelCron = request.headers.get('authorization') === `Bearer ${process.env.CRON_SECRET}`;\r\n    const cronSecret = process.env.CRON_SECRET;\r\n    const providedSecret = body.secret;\r\n\r\n    if (cronSecret && !isVercelCron && providedSecret !== cronSecret) {\r\n      return NextResponse.json({ success: false, error: 'Unauthorized' }, { status: 401 });\r\n    }\r\n\r\n    const result = await sendAbandonedCartReminders({ tenantId, hoursAgo });\r\n    return NextResponse.json(result);\r\n  } catch (error: any) {\r\n    console.error('Abandoned cart reminders error:', error);\r\n    return NextResponse.json({\r\n      success: false,\r\n      message: `Error: ${error.message}`,\r\n      processed: 0,\r\n      failed: 0,\r\n      errors: [error.message],\r\n    }, { status: 500 });\r\n  }\r\n}\r\n\r\nexport async function GET(request: NextRequest) {\r\n  try {\r\n    const searchParams = request.nextUrl.searchParams;\r\n    const tenantId = searchParams.get('tenantId') || undefined;\r\n    const hoursAgo = searchParams.get('hoursAgo')\r\n      ? parseInt(searchParams.get('hoursAgo')!, 10)\r\n      : undefined;\r\n\r\n    const isVercelCron = request.headers.get('authorization') === `Bearer ${process.env.CRON_SECRET}`;\r\n    const cronSecret = process.env.CRON_SECRET;\r\n    const providedSecret = searchParams.get('secret');\r\n\r\n    if (cronSecret && !isVercelCron && providedSecret !== cronSecret) {\r\n      return NextResponse.json({ success: false, error: 'Unauthorized' }, { status: 401 });\r\n    }\r\n\r\n    const result = await sendAbandonedCartReminders({ tenantId, hoursAgo });\r\n    return NextResponse.json(result);\r\n  } catch (error: any) {\r\n    console.error('Abandoned cart reminders error:', error);\r\n    return NextResponse.json({\r\n      success: false,\r\n      message: `Error: ${error.message}`,\r\n      processed: 0,\r\n      failed: 0,\r\n      errors: [error.message],\r\n    }, { status: 500 });\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\automations\\cash-drawer\\auto-close\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":32,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":32,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[986,989],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[986,989],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":71,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":71,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2167,2170],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2167,2170],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * API Route for Automatic Cash Drawer Closure\r\n * Can be called by cron jobs or manually\r\n */\r\n\r\nimport { NextRequest, NextResponse } from 'next/server';\r\nimport { autoCloseCashDrawers } from '@/lib/automations';\r\n\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    const body = await request.json().catch(() => ({}));\r\n    const { tenantId, forceClose } = body;\r\n\r\n    // Allow Vercel cron jobs or verify secret\r\n    const isVercelCron = request.headers.get('authorization') === `Bearer ${process.env.CRON_SECRET}`;\r\n    const cronSecret = process.env.CRON_SECRET;\r\n    const providedSecret = body.secret;\r\n\r\n    if (cronSecret && !isVercelCron && providedSecret !== cronSecret) {\r\n      return NextResponse.json(\r\n        { success: false, error: 'Unauthorized' },\r\n        { status: 401 }\r\n      );\r\n    }\r\n\r\n    const result = await autoCloseCashDrawers({\r\n      tenantId,\r\n      forceClose,\r\n    });\r\n\r\n    return NextResponse.json(result);\r\n  } catch (error: any) {\r\n    console.error('Cash drawer auto-close automation error:', error);\r\n    return NextResponse.json(\r\n      {\r\n        success: false,\r\n        message: `Error: ${error.message}`,\r\n        processed: 0,\r\n        failed: 0,\r\n        errors: [error.message],\r\n      },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n\r\nexport async function GET(request: NextRequest) {\r\n  try {\r\n    const searchParams = request.nextUrl.searchParams;\r\n    const tenantId = searchParams.get('tenantId') || undefined;\r\n    const forceClose = searchParams.get('forceClose') === 'true';\r\n\r\n    // Allow Vercel cron jobs or verify secret\r\n    const isVercelCron = request.headers.get('authorization') === `Bearer ${process.env.CRON_SECRET}`;\r\n    const cronSecret = process.env.CRON_SECRET;\r\n    const providedSecret = searchParams.get('secret');\r\n\r\n    if (cronSecret && !isVercelCron && providedSecret !== cronSecret) {\r\n      return NextResponse.json(\r\n        { success: false, error: 'Unauthorized' },\r\n        { status: 401 }\r\n      );\r\n    }\r\n\r\n    const result = await autoCloseCashDrawers({\r\n      tenantId,\r\n      forceClose,\r\n    });\r\n\r\n    return NextResponse.json(result);\r\n  } catch (error: any) {\r\n    console.error('Cash drawer auto-close automation error:', error);\r\n    return NextResponse.json(\r\n      {\r\n        success: false,\r\n        message: `Error: ${error.message}`,\r\n        processed: 0,\r\n        failed: 0,\r\n        errors: [error.message],\r\n      },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\automations\\cash-drawer\\reminders\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":23,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":23,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[863,866],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[863,866],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":53,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":53,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2010,2013],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2010,2013],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * API Route for Cash Count Reminders\r\n */\r\n\r\nimport { NextRequest, NextResponse } from 'next/server';\r\nimport { sendCashCountReminders } from '@/lib/automations';\r\n\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    const body = await request.json().catch(() => ({}));\r\n    const { tenantId, reminderMinutesBefore } = body;\r\n\r\n    const isVercelCron = request.headers.get('authorization') === `Bearer ${process.env.CRON_SECRET}`;\r\n    const cronSecret = process.env.CRON_SECRET;\r\n    const providedSecret = body.secret;\r\n\r\n    if (cronSecret && !isVercelCron && providedSecret !== cronSecret) {\r\n      return NextResponse.json({ success: false, error: 'Unauthorized' }, { status: 401 });\r\n    }\r\n\r\n    const result = await sendCashCountReminders({ tenantId, reminderMinutesBefore });\r\n    return NextResponse.json(result);\r\n  } catch (error: any) {\r\n    console.error('Cash count reminders error:', error);\r\n    return NextResponse.json({\r\n      success: false,\r\n      message: `Error: ${error.message}`,\r\n      processed: 0,\r\n      failed: 0,\r\n      errors: [error.message],\r\n    }, { status: 500 });\r\n  }\r\n}\r\n\r\nexport async function GET(request: NextRequest) {\r\n  try {\r\n    const searchParams = request.nextUrl.searchParams;\r\n    const tenantId = searchParams.get('tenantId') || undefined;\r\n    const reminderMinutesBefore = searchParams.get('reminderMinutesBefore')\r\n      ? parseInt(searchParams.get('reminderMinutesBefore')!, 10)\r\n      : undefined;\r\n\r\n    const isVercelCron = request.headers.get('authorization') === `Bearer ${process.env.CRON_SECRET}`;\r\n    const cronSecret = process.env.CRON_SECRET;\r\n    const providedSecret = searchParams.get('secret');\r\n\r\n    if (cronSecret && !isVercelCron && providedSecret !== cronSecret) {\r\n      return NextResponse.json({ success: false, error: 'Unauthorized' }, { status: 401 });\r\n    }\r\n\r\n    const result = await sendCashCountReminders({ tenantId, reminderMinutesBefore });\r\n    return NextResponse.json(result);\r\n  } catch (error: any) {\r\n    console.error('Cash count reminders error:', error);\r\n    return NextResponse.json({\r\n      success: false,\r\n      message: `Error: ${error.message}`,\r\n      processed: 0,\r\n      failed: 0,\r\n      errors: [error.message],\r\n    }, { status: 500 });\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\automations\\customers\\lifetime-value\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":23,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":23,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[882,885],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[882,885],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":51,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":51,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1961,1964],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1961,1964],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * API Route for Customer Lifetime Value Calculation\r\n */\r\n\r\nimport { NextRequest, NextResponse } from 'next/server';\r\nimport { calculateCustomerLifetimeValue } from '@/lib/automations';\r\n\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    const body = await request.json().catch(() => ({}));\r\n    const { tenantId, updateCustomers } = body;\r\n\r\n    const isVercelCron = request.headers.get('authorization') === `Bearer ${process.env.CRON_SECRET}`;\r\n    const cronSecret = process.env.CRON_SECRET;\r\n    const providedSecret = body.secret;\r\n\r\n    if (cronSecret && !isVercelCron && providedSecret !== cronSecret) {\r\n      return NextResponse.json({ success: false, error: 'Unauthorized' }, { status: 401 });\r\n    }\r\n\r\n    const result = await calculateCustomerLifetimeValue({ tenantId, updateCustomers });\r\n    return NextResponse.json(result);\r\n  } catch (error: any) {\r\n    console.error('Customer lifetime value calculation error:', error);\r\n    return NextResponse.json({\r\n      success: false,\r\n      message: `Error: ${error.message}`,\r\n      processed: 0,\r\n      failed: 0,\r\n      errors: [error.message],\r\n    }, { status: 500 });\r\n  }\r\n}\r\n\r\nexport async function GET(request: NextRequest) {\r\n  try {\r\n    const searchParams = request.nextUrl.searchParams;\r\n    const tenantId = searchParams.get('tenantId') || undefined;\r\n    const updateCustomers = searchParams.get('updateCustomers') !== 'false';\r\n\r\n    const isVercelCron = request.headers.get('authorization') === `Bearer ${process.env.CRON_SECRET}`;\r\n    const cronSecret = process.env.CRON_SECRET;\r\n    const providedSecret = searchParams.get('secret');\r\n\r\n    if (cronSecret && !isVercelCron && providedSecret !== cronSecret) {\r\n      return NextResponse.json({ success: false, error: 'Unauthorized' }, { status: 401 });\r\n    }\r\n\r\n    const result = await calculateCustomerLifetimeValue({ tenantId, updateCustomers });\r\n    return NextResponse.json(result);\r\n  } catch (error: any) {\r\n    console.error('Customer lifetime value calculation error:', error);\r\n    return NextResponse.json({\r\n      success: false,\r\n      message: `Error: ${error.message}`,\r\n      processed: 0,\r\n      failed: 0,\r\n      errors: [error.message],\r\n    }, { status: 500 });\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\automations\\data\\archive\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":23,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":23,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[849,852],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[849,852],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":56,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":56,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2089,2092],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2089,2092],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * API Route for Data Archiving\r\n */\r\n\r\nimport { NextRequest, NextResponse } from 'next/server';\r\nimport { archiveOldData } from '@/lib/automations';\r\n\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    const body = await request.json().catch(() => ({}));\r\n    const { tenantId, archiveYears, collections } = body;\r\n\r\n    const isVercelCron = request.headers.get('authorization') === `Bearer ${process.env.CRON_SECRET}`;\r\n    const cronSecret = process.env.CRON_SECRET;\r\n    const providedSecret = body.secret;\r\n\r\n    if (cronSecret && !isVercelCron && providedSecret !== cronSecret) {\r\n      return NextResponse.json({ success: false, error: 'Unauthorized' }, { status: 401 });\r\n    }\r\n\r\n    const result = await archiveOldData({ tenantId, archiveYears, collections });\r\n    return NextResponse.json(result);\r\n  } catch (error: any) {\r\n    console.error('Data archiving error:', error);\r\n    return NextResponse.json({\r\n      success: false,\r\n      message: `Error: ${error.message}`,\r\n      processed: 0,\r\n      failed: 0,\r\n      errors: [error.message],\r\n    }, { status: 500 });\r\n  }\r\n}\r\n\r\nexport async function GET(request: NextRequest) {\r\n  try {\r\n    const searchParams = request.nextUrl.searchParams;\r\n    const tenantId = searchParams.get('tenantId') || undefined;\r\n    const archiveYears = searchParams.get('archiveYears')\r\n      ? parseInt(searchParams.get('archiveYears')!, 10)\r\n      : undefined;\r\n    const collections = searchParams.get('collections')\r\n      ? searchParams.get('collections')!.split(',')\r\n      : undefined;\r\n\r\n    const isVercelCron = request.headers.get('authorization') === `Bearer ${process.env.CRON_SECRET}`;\r\n    const cronSecret = process.env.CRON_SECRET;\r\n    const providedSecret = searchParams.get('secret');\r\n\r\n    if (cronSecret && !isVercelCron && providedSecret !== cronSecret) {\r\n      return NextResponse.json({ success: false, error: 'Unauthorized' }, { status: 401 });\r\n    }\r\n\r\n    const result = await archiveOldData({ tenantId, archiveYears, collections });\r\n    return NextResponse.json(result);\r\n  } catch (error: any) {\r\n    console.error('Data archiving error:', error);\r\n    return NextResponse.json({\r\n      success: false,\r\n      message: `Error: ${error.message}`,\r\n      processed: 0,\r\n      failed: 0,\r\n      errors: [error.message],\r\n    }, { status: 500 });\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\automations\\discounts\\manage\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":29,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":29,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[942,945],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[942,945],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":64,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":64,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2021,2024],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2021,2024],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * API Route for Automatic Discount Management\r\n * Can be called by cron jobs or manually\r\n */\r\n\r\nimport { NextRequest, NextResponse } from 'next/server';\r\nimport { manageDiscountStatus } from '@/lib/automations';\r\n\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    const body = await request.json().catch(() => ({}));\r\n    const { tenantId } = body;\r\n\r\n    // Allow Vercel cron jobs or verify secret\r\n    const isVercelCron = request.headers.get('authorization') === `Bearer ${process.env.CRON_SECRET}`;\r\n    const cronSecret = process.env.CRON_SECRET;\r\n    const providedSecret = body.secret;\r\n\r\n    if (cronSecret && !isVercelCron && providedSecret !== cronSecret) {\r\n      return NextResponse.json(\r\n        { success: false, error: 'Unauthorized' },\r\n        { status: 401 }\r\n      );\r\n    }\r\n\r\n    const result = await manageDiscountStatus({ tenantId });\r\n\r\n    return NextResponse.json(result);\r\n  } catch (error: any) {\r\n    console.error('Discount management automation error:', error);\r\n    return NextResponse.json(\r\n      {\r\n        success: false,\r\n        message: `Error: ${error.message}`,\r\n        processed: 0,\r\n        failed: 0,\r\n        errors: [error.message],\r\n      },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n\r\nexport async function GET(request: NextRequest) {\r\n  try {\r\n    const searchParams = request.nextUrl.searchParams;\r\n    const tenantId = searchParams.get('tenantId') || undefined;\r\n\r\n    // Allow Vercel cron jobs or verify secret\r\n    const isVercelCron = request.headers.get('authorization') === `Bearer ${process.env.CRON_SECRET}`;\r\n    const cronSecret = process.env.CRON_SECRET;\r\n    const providedSecret = searchParams.get('secret');\r\n\r\n    if (cronSecret && !isVercelCron && providedSecret !== cronSecret) {\r\n      return NextResponse.json(\r\n        { success: false, error: 'Unauthorized' },\r\n        { status: 401 }\r\n      );\r\n    }\r\n\r\n    const result = await manageDiscountStatus({ tenantId });\r\n\r\n    return NextResponse.json(result);\r\n  } catch (error: any) {\r\n    console.error('Discount management automation error:', error);\r\n    return NextResponse.json(\r\n      {\r\n        success: false,\r\n        message: `Error: ${error.message}`,\r\n        processed: 0,\r\n        failed: 0,\r\n        errors: [error.message],\r\n      },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\automations\\low-stock-alerts\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":34,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":34,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[959,962],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[959,962],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":76,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":76,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2294,2297],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2294,2297],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * API Route for Low Stock Alerts\r\n * Can be called by cron jobs or manually\r\n */\r\n\r\nimport { NextRequest, NextResponse } from 'next/server';\r\nimport { sendLowStockAlerts } from '@/lib/automations';\r\n\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    const body = await request.json().catch(() => ({}));\r\n    const { tenantId, threshold } = body;\r\n\r\n    // Optional: Add authentication/authorization\r\n    const authHeader = request.headers.get('authorization');\r\n    const cronSecret = process.env.CRON_SECRET;\r\n\r\n    if (authHeader && cronSecret) {\r\n      const token = authHeader.replace('Bearer ', '');\r\n      if (token !== cronSecret) {\r\n        return NextResponse.json(\r\n          { success: false, error: 'Unauthorized' },\r\n          { status: 401 }\r\n        );\r\n      }\r\n    }\r\n\r\n    const result = await sendLowStockAlerts({\r\n      tenantId,\r\n      threshold,\r\n    });\r\n\r\n    return NextResponse.json(result);\r\n  } catch (error: any) {\r\n    console.error('Low stock alerts automation error:', error);\r\n    return NextResponse.json(\r\n      {\r\n        success: false,\r\n        message: `Error: ${error.message}`,\r\n        processed: 0,\r\n        failed: 0,\r\n        errors: [error.message],\r\n      },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n\r\nexport async function GET(request: NextRequest) {\r\n  try {\r\n    const searchParams = request.nextUrl.searchParams;\r\n    const tenantId = searchParams.get('tenantId') || undefined;\r\n    const threshold = searchParams.get('threshold')\r\n      ? parseInt(searchParams.get('threshold')!, 10)\r\n      : undefined;\r\n\r\n    // Allow Vercel cron jobs (they send a special header) or verify secret\r\n    const isVercelCron = request.headers.get('authorization') === `Bearer ${process.env.CRON_SECRET}`;\r\n    const cronSecret = process.env.CRON_SECRET;\r\n    const providedSecret = searchParams.get('secret');\r\n\r\n    // Allow if: Vercel cron, or no secret configured, or secret matches\r\n    if (cronSecret && !isVercelCron && providedSecret !== cronSecret) {\r\n      return NextResponse.json(\r\n        { success: false, error: 'Unauthorized' },\r\n        { status: 401 }\r\n      );\r\n    }\r\n\r\n    const result = await sendLowStockAlerts({\r\n      tenantId,\r\n      threshold,\r\n    });\r\n\r\n    return NextResponse.json(result);\r\n  } catch (error: any) {\r\n    console.error('Low stock alerts automation error:', error);\r\n    return NextResponse.json(\r\n      {\r\n        success: false,\r\n        message: `Error: ${error.message}`,\r\n        processed: 0,\r\n        failed: 0,\r\n        errors: [error.message],\r\n      },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\automations\\pricing\\dynamic\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":23,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":23,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[914,917],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[914,917],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":53,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":53,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2158,2161],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2158,2161],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * API Route for Dynamic Pricing\r\n */\r\n\r\nimport { NextRequest, NextResponse } from 'next/server';\r\nimport { applyDynamicPricing } from '@/lib/automations';\r\n\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    const body = await request.json().catch(() => ({}));\r\n    const { tenantId, enableTimeBased, enableDemandBased, enableStockBased } = body;\r\n\r\n    const isVercelCron = request.headers.get('authorization') === `Bearer ${process.env.CRON_SECRET}`;\r\n    const cronSecret = process.env.CRON_SECRET;\r\n    const providedSecret = body.secret;\r\n\r\n    if (cronSecret && !isVercelCron && providedSecret !== cronSecret) {\r\n      return NextResponse.json({ success: false, error: 'Unauthorized' }, { status: 401 });\r\n    }\r\n\r\n    const result = await applyDynamicPricing({ tenantId, enableTimeBased, enableDemandBased, enableStockBased });\r\n    return NextResponse.json(result);\r\n  } catch (error: any) {\r\n    console.error('Dynamic pricing error:', error);\r\n    return NextResponse.json({\r\n      success: false,\r\n      message: `Error: ${error.message}`,\r\n      processed: 0,\r\n      failed: 0,\r\n      errors: [error.message],\r\n    }, { status: 500 });\r\n  }\r\n}\r\n\r\nexport async function GET(request: NextRequest) {\r\n  try {\r\n    const searchParams = request.nextUrl.searchParams;\r\n    const tenantId = searchParams.get('tenantId') || undefined;\r\n    const enableTimeBased = searchParams.get('enableTimeBased') === 'true';\r\n    const enableDemandBased = searchParams.get('enableDemandBased') === 'true';\r\n    const enableStockBased = searchParams.get('enableStockBased') === 'true';\r\n\r\n    const isVercelCron = request.headers.get('authorization') === `Bearer ${process.env.CRON_SECRET}`;\r\n    const cronSecret = process.env.CRON_SECRET;\r\n    const providedSecret = searchParams.get('secret');\r\n\r\n    if (cronSecret && !isVercelCron && providedSecret !== cronSecret) {\r\n      return NextResponse.json({ success: false, error: 'Unauthorized' }, { status: 401 });\r\n    }\r\n\r\n    const result = await applyDynamicPricing({ tenantId, enableTimeBased, enableDemandBased, enableStockBased });\r\n    return NextResponse.json(result);\r\n  } catch (error: any) {\r\n    console.error('Dynamic pricing error:', error);\r\n    return NextResponse.json({\r\n      success: false,\r\n      message: `Error: ${error.message}`,\r\n      processed: 0,\r\n      failed: 0,\r\n      errors: [error.message],\r\n    }, { status: 500 });\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\automations\\products\\performance\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":23,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":23,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[901,904],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[901,904],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":56,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":56,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2205,2208],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2205,2208],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * API Route for Product Performance Alerts\r\n */\r\n\r\nimport { NextRequest, NextResponse } from 'next/server';\r\nimport { analyzeProductPerformance } from '@/lib/automations';\r\n\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    const body = await request.json().catch(() => ({}));\r\n    const { tenantId, daysToAnalyze, slowMovingThreshold } = body;\r\n\r\n    const isVercelCron = request.headers.get('authorization') === `Bearer ${process.env.CRON_SECRET}`;\r\n    const cronSecret = process.env.CRON_SECRET;\r\n    const providedSecret = body.secret;\r\n\r\n    if (cronSecret && !isVercelCron && providedSecret !== cronSecret) {\r\n      return NextResponse.json({ success: false, error: 'Unauthorized' }, { status: 401 });\r\n    }\r\n\r\n    const result = await analyzeProductPerformance({ tenantId, daysToAnalyze, slowMovingThreshold });\r\n    return NextResponse.json(result);\r\n  } catch (error: any) {\r\n    console.error('Product performance analysis error:', error);\r\n    return NextResponse.json({\r\n      success: false,\r\n      message: `Error: ${error.message}`,\r\n      processed: 0,\r\n      failed: 0,\r\n      errors: [error.message],\r\n    }, { status: 500 });\r\n  }\r\n}\r\n\r\nexport async function GET(request: NextRequest) {\r\n  try {\r\n    const searchParams = request.nextUrl.searchParams;\r\n    const tenantId = searchParams.get('tenantId') || undefined;\r\n    const daysToAnalyze = searchParams.get('daysToAnalyze')\r\n      ? parseInt(searchParams.get('daysToAnalyze')!, 10)\r\n      : undefined;\r\n    const slowMovingThreshold = searchParams.get('slowMovingThreshold')\r\n      ? parseInt(searchParams.get('slowMovingThreshold')!, 10)\r\n      : undefined;\r\n\r\n    const isVercelCron = request.headers.get('authorization') === `Bearer ${process.env.CRON_SECRET}`;\r\n    const cronSecret = process.env.CRON_SECRET;\r\n    const providedSecret = searchParams.get('secret');\r\n\r\n    if (cronSecret && !isVercelCron && providedSecret !== cronSecret) {\r\n      return NextResponse.json({ success: false, error: 'Unauthorized' }, { status: 401 });\r\n    }\r\n\r\n    const result = await analyzeProductPerformance({ tenantId, daysToAnalyze, slowMovingThreshold });\r\n    return NextResponse.json(result);\r\n  } catch (error: any) {\r\n    console.error('Product performance analysis error:', error);\r\n    return NextResponse.json({\r\n      success: false,\r\n      message: `Error: ${error.message}`,\r\n      processed: 0,\r\n      failed: 0,\r\n      errors: [error.message],\r\n    }, { status: 500 });\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\automations\\purchase-orders\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":23,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":23,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[894,897],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[894,897],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":50,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":50,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1860,1863],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1860,1863],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * API Route for Purchase Order Generation\r\n */\r\n\r\nimport { NextRequest, NextResponse } from 'next/server';\r\nimport { generatePurchaseOrders } from '@/lib/automations';\r\n\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    const body = await request.json().catch(() => ({}));\r\n    const { tenantId, generateDocuments, sendToSuppliers } = body;\r\n\r\n    const isVercelCron = request.headers.get('authorization') === `Bearer ${process.env.CRON_SECRET}`;\r\n    const cronSecret = process.env.CRON_SECRET;\r\n    const providedSecret = body.secret;\r\n\r\n    if (cronSecret && !isVercelCron && providedSecret !== cronSecret) {\r\n      return NextResponse.json({ success: false, error: 'Unauthorized' }, { status: 401 });\r\n    }\r\n\r\n    const result = await generatePurchaseOrders({ tenantId, generateDocuments, sendToSuppliers });\r\n    return NextResponse.json(result);\r\n  } catch (error: any) {\r\n    console.error('Purchase order generation error:', error);\r\n    return NextResponse.json({\r\n      success: false,\r\n      message: `Error: ${error.message}`,\r\n      processed: 0,\r\n      failed: 0,\r\n      errors: [error.message],\r\n    }, { status: 500 });\r\n  }\r\n}\r\n\r\nexport async function GET(request: NextRequest) {\r\n  try {\r\n    const searchParams = request.nextUrl.searchParams;\r\n    const tenantId = searchParams.get('tenantId') || undefined;\r\n\r\n    const isVercelCron = request.headers.get('authorization') === `Bearer ${process.env.CRON_SECRET}`;\r\n    const cronSecret = process.env.CRON_SECRET;\r\n    const providedSecret = searchParams.get('secret');\r\n\r\n    if (cronSecret && !isVercelCron && providedSecret !== cronSecret) {\r\n      return NextResponse.json({ success: false, error: 'Unauthorized' }, { status: 401 });\r\n    }\r\n\r\n    const result = await generatePurchaseOrders({ tenantId });\r\n    return NextResponse.json(result);\r\n  } catch (error: any) {\r\n    console.error('Purchase order generation error:', error);\r\n    return NextResponse.json({\r\n      success: false,\r\n      message: `Error: ${error.message}`,\r\n      processed: 0,\r\n      failed: 0,\r\n      errors: [error.message],\r\n    }, { status: 500 });\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\automations\\reports\\sales\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":34,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":34,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[981,984],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[981,984],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":74,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":74,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2274,2277],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2274,2277],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * API Route for Automated Sales Report Delivery\r\n * Can be called by cron jobs or manually\r\n */\r\n\r\nimport { NextRequest, NextResponse } from 'next/server';\r\nimport { sendSalesReport } from '@/lib/automations';\r\n\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    const body = await request.json().catch(() => ({}));\r\n    const { tenantId, period } = body;\r\n\r\n    // Optional: Add authentication/authorization\r\n    const authHeader = request.headers.get('authorization');\r\n    const cronSecret = process.env.CRON_SECRET;\r\n\r\n    if (authHeader && cronSecret) {\r\n      const token = authHeader.replace('Bearer ', '');\r\n      if (token !== cronSecret) {\r\n        return NextResponse.json(\r\n          { success: false, error: 'Unauthorized' },\r\n          { status: 401 }\r\n        );\r\n      }\r\n    }\r\n\r\n    const result = await sendSalesReport({\r\n      tenantId,\r\n      period: period || 'daily',\r\n    });\r\n\r\n    return NextResponse.json(result);\r\n  } catch (error: any) {\r\n    console.error('Sales report automation error:', error);\r\n    return NextResponse.json(\r\n      {\r\n        success: false,\r\n        message: `Error: ${error.message}`,\r\n        processed: 0,\r\n        failed: 0,\r\n        errors: [error.message],\r\n      },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n\r\nexport async function GET(request: NextRequest) {\r\n  try {\r\n    const searchParams = request.nextUrl.searchParams;\r\n    const tenantId = searchParams.get('tenantId') || undefined;\r\n    const period = (searchParams.get('period') || 'daily') as 'daily' | 'weekly' | 'monthly';\r\n\r\n    // Allow Vercel cron jobs (they send a special header) or verify secret\r\n    const isVercelCron = request.headers.get('authorization') === `Bearer ${process.env.CRON_SECRET}`;\r\n    const cronSecret = process.env.CRON_SECRET;\r\n    const providedSecret = searchParams.get('secret');\r\n\r\n    // Allow if: Vercel cron, or no secret configured, or secret matches\r\n    if (cronSecret && !isVercelCron && providedSecret !== cronSecret) {\r\n      return NextResponse.json(\r\n        { success: false, error: 'Unauthorized' },\r\n        { status: 401 }\r\n      );\r\n    }\r\n\r\n    const result = await sendSalesReport({\r\n      tenantId,\r\n      period,\r\n    });\r\n\r\n    return NextResponse.json(result);\r\n  } catch (error: any) {\r\n    console.error('Sales report automation error:', error);\r\n    return NextResponse.json(\r\n      {\r\n        success: false,\r\n        message: `Error: ${error.message}`,\r\n        processed: 0,\r\n        failed: 0,\r\n        errors: [error.message],\r\n      },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\automations\\security\\suspicious-activity\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":29,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":29,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1017,1020],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1017,1020],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":74,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":74,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2696,2699],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2696,2699],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * API Route for Suspicious Activity Detection\r\n */\r\n\r\nimport { NextRequest, NextResponse } from 'next/server';\r\nimport { detectSuspiciousActivity } from '@/lib/automations';\r\n\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    const body = await request.json().catch(() => ({}));\r\n    const { tenantId, refundThreshold, voidThreshold, discountThreshold, failedLoginThreshold } = body;\r\n\r\n    const isVercelCron = request.headers.get('authorization') === `Bearer ${process.env.CRON_SECRET}`;\r\n    const cronSecret = process.env.CRON_SECRET;\r\n    const providedSecret = body.secret;\r\n\r\n    if (cronSecret && !isVercelCron && providedSecret !== cronSecret) {\r\n      return NextResponse.json({ success: false, error: 'Unauthorized' }, { status: 401 });\r\n    }\r\n\r\n    const result = await detectSuspiciousActivity({\r\n      tenantId,\r\n      refundThreshold,\r\n      voidThreshold,\r\n      discountThreshold,\r\n      failedLoginThreshold,\r\n    });\r\n    return NextResponse.json(result);\r\n  } catch (error: any) {\r\n    console.error('Suspicious activity detection error:', error);\r\n    return NextResponse.json({\r\n      success: false,\r\n      message: `Error: ${error.message}`,\r\n      processed: 0,\r\n      failed: 0,\r\n      errors: [error.message],\r\n    }, { status: 500 });\r\n  }\r\n}\r\n\r\nexport async function GET(request: NextRequest) {\r\n  try {\r\n    const searchParams = request.nextUrl.searchParams;\r\n    const tenantId = searchParams.get('tenantId') || undefined;\r\n    const refundThreshold = searchParams.get('refundThreshold')\r\n      ? parseInt(searchParams.get('refundThreshold')!, 10)\r\n      : undefined;\r\n    const voidThreshold = searchParams.get('voidThreshold')\r\n      ? parseInt(searchParams.get('voidThreshold')!, 10)\r\n      : undefined;\r\n    const discountThreshold = searchParams.get('discountThreshold')\r\n      ? parseFloat(searchParams.get('discountThreshold')!)\r\n      : undefined;\r\n    const failedLoginThreshold = searchParams.get('failedLoginThreshold')\r\n      ? parseInt(searchParams.get('failedLoginThreshold')!, 10)\r\n      : undefined;\r\n\r\n    const isVercelCron = request.headers.get('authorization') === `Bearer ${process.env.CRON_SECRET}`;\r\n    const cronSecret = process.env.CRON_SECRET;\r\n    const providedSecret = searchParams.get('secret');\r\n\r\n    if (cronSecret && !isVercelCron && providedSecret !== cronSecret) {\r\n      return NextResponse.json({ success: false, error: 'Unauthorized' }, { status: 401 });\r\n    }\r\n\r\n    const result = await detectSuspiciousActivity({\r\n      tenantId,\r\n      refundThreshold,\r\n      voidThreshold,\r\n      discountThreshold,\r\n      failedLoginThreshold,\r\n    });\r\n    return NextResponse.json(result);\r\n  } catch (error: any) {\r\n    console.error('Suspicious activity detection error:', error);\r\n    return NextResponse.json({\r\n      success: false,\r\n      message: `Error: ${error.message}`,\r\n      processed: 0,\r\n      failed: 0,\r\n      errors: [error.message],\r\n    }, { status: 500 });\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\automations\\sessions\\expire\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":23,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":23,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[849,852],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[849,852],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":53,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":53,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1970,1973],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1970,1973],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * API Route for Session Expiration\r\n */\r\n\r\nimport { NextRequest, NextResponse } from 'next/server';\r\nimport { expireInactiveSessions } from '@/lib/automations';\r\n\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    const body = await request.json().catch(() => ({}));\r\n    const { tenantId, inactivityHours } = body;\r\n\r\n    const isVercelCron = request.headers.get('authorization') === `Bearer ${process.env.CRON_SECRET}`;\r\n    const cronSecret = process.env.CRON_SECRET;\r\n    const providedSecret = body.secret;\r\n\r\n    if (cronSecret && !isVercelCron && providedSecret !== cronSecret) {\r\n      return NextResponse.json({ success: false, error: 'Unauthorized' }, { status: 401 });\r\n    }\r\n\r\n    const result = await expireInactiveSessions({ tenantId, inactivityHours });\r\n    return NextResponse.json(result);\r\n  } catch (error: any) {\r\n    console.error('Session expiration error:', error);\r\n    return NextResponse.json({\r\n      success: false,\r\n      message: `Error: ${error.message}`,\r\n      processed: 0,\r\n      failed: 0,\r\n      errors: [error.message],\r\n    }, { status: 500 });\r\n  }\r\n}\r\n\r\nexport async function GET(request: NextRequest) {\r\n  try {\r\n    const searchParams = request.nextUrl.searchParams;\r\n    const tenantId = searchParams.get('tenantId') || undefined;\r\n    const inactivityHours = searchParams.get('inactivityHours')\r\n      ? parseInt(searchParams.get('inactivityHours')!, 10)\r\n      : undefined;\r\n\r\n    const isVercelCron = request.headers.get('authorization') === `Bearer ${process.env.CRON_SECRET}`;\r\n    const cronSecret = process.env.CRON_SECRET;\r\n    const providedSecret = searchParams.get('secret');\r\n\r\n    if (cronSecret && !isVercelCron && providedSecret !== cronSecret) {\r\n      return NextResponse.json({ success: false, error: 'Unauthorized' }, { status: 401 });\r\n    }\r\n\r\n    const result = await expireInactiveSessions({ tenantId, inactivityHours });\r\n    return NextResponse.json(result);\r\n  } catch (error: any) {\r\n    console.error('Session expiration error:', error);\r\n    return NextResponse.json({\r\n      success: false,\r\n      message: `Error: ${error.message}`,\r\n      processed: 0,\r\n      failed: 0,\r\n      errors: [error.message],\r\n    }, { status: 500 });\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\automations\\status\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":169,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":169,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5409,5412],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5409,5412],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * API Route for Automation Status\r\n * Returns the status of all automations\r\n */\r\n\r\nimport { NextRequest, NextResponse } from 'next/server';\r\nimport connectDB from '@/lib/mongodb';\r\nimport Tenant from '@/models/Tenant';\r\nimport Booking from '@/models/Booking';\r\nimport Discount from '@/models/Discount';\r\nimport Attendance from '@/models/Attendance';\r\nimport CashDrawerSession from '@/models/CashDrawerSession';\r\nimport Transaction from '@/models/Transaction';\r\nimport { getLowStockProducts } from '@/lib/stock';\r\n\r\nexport async function GET(request: NextRequest) {\r\n  try {\r\n    await connectDB();\r\n\r\n    // Optional: Add authentication\r\n    // Allow if: no secret configured, or secret matches, or Vercel cron header\r\n    const cronSecret = process.env.CRON_SECRET;\r\n    const providedSecret = request.nextUrl.searchParams.get('secret');\r\n    const authHeader = request.headers.get('authorization');\r\n    const isVercelCron = authHeader === `Bearer ${cronSecret}`;\r\n\r\n    // Only require secret if it's configured AND not from Vercel cron\r\n    if (cronSecret && !isVercelCron && providedSecret !== cronSecret) {\r\n      return NextResponse.json(\r\n        { success: false, error: 'Unauthorized. Provide ?secret=your-secret or set CRON_SECRET in environment.' },\r\n        { status: 401 }\r\n      );\r\n    }\r\n\r\n    const now = new Date();\r\n    const stats = {\r\n      tenants: {\r\n        total: 0,\r\n        active: 0,\r\n      },\r\n      bookings: {\r\n        pendingReminders: 0,\r\n        upcoming24h: 0,\r\n      },\r\n      inventory: {\r\n        lowStockProducts: 0,\r\n      },\r\n      discounts: {\r\n        active: 0,\r\n        expiringSoon: 0,\r\n        needsActivation: 0,\r\n        needsDeactivation: 0,\r\n      },\r\n      attendance: {\r\n        openSessions: 0,\r\n        forgottenSessions: 0,\r\n      },\r\n      cashDrawer: {\r\n        openSessions: 0,\r\n      },\r\n      transactions: {\r\n        pendingReceipts: 0,\r\n      },\r\n      automations: {\r\n        enabled: process.env.ENABLE_CRON_JOBS === 'true',\r\n        cronSecretConfigured: !!process.env.CRON_SECRET,\r\n        emailProvider: process.env.EMAIL_PROVIDER || 'console',\r\n        smsProvider: process.env.SMS_PROVIDER || 'console',\r\n      },\r\n    };\r\n\r\n    // Get tenant stats\r\n    const tenants = await Tenant.find({ status: 'active' }).lean();\r\n    stats.tenants.total = await Tenant.countDocuments();\r\n    stats.tenants.active = tenants.length;\r\n\r\n    // Get booking stats\r\n    const reminderWindowStart = new Date(now.getTime() + 24 * 60 * 60 * 1000);\r\n    const reminderWindowEnd = new Date(reminderWindowStart.getTime() + 60 * 60 * 1000);\r\n    \r\n    stats.bookings.pendingReminders = await Booking.countDocuments({\r\n      startTime: {\r\n        $gte: reminderWindowStart,\r\n        $lte: reminderWindowEnd,\r\n      },\r\n      status: { $in: ['pending', 'confirmed'] },\r\n      reminderSent: { $ne: true },\r\n    });\r\n\r\n    stats.bookings.upcoming24h = await Booking.countDocuments({\r\n      startTime: {\r\n        $gte: now,\r\n        $lte: new Date(now.getTime() + 24 * 60 * 60 * 1000),\r\n      },\r\n      status: { $in: ['pending', 'confirmed'] },\r\n    });\r\n\r\n    // Get inventory stats (sample first tenant)\r\n    if (tenants.length > 0) {\r\n      try {\r\n        const lowStock = await getLowStockProducts(tenants[0]._id.toString());\r\n        stats.inventory.lowStockProducts = lowStock.length;\r\n      } catch (error) {\r\n        // Ignore errors\r\n      }\r\n    }\r\n\r\n    // Get discount stats\r\n    stats.discounts.active = await Discount.countDocuments({\r\n      isActive: true,\r\n      validFrom: { $lte: now },\r\n      validUntil: { $gte: now },\r\n    });\r\n\r\n    const expiringSoon = new Date(now.getTime() + 7 * 24 * 60 * 60 * 1000);\r\n    stats.discounts.expiringSoon = await Discount.countDocuments({\r\n      isActive: true,\r\n      validUntil: { $gte: now, $lte: expiringSoon },\r\n    });\r\n\r\n    stats.discounts.needsActivation = await Discount.countDocuments({\r\n      validFrom: { $lte: now },\r\n      validUntil: { $gte: now },\r\n      isActive: false,\r\n    });\r\n\r\n    stats.discounts.needsDeactivation = await Discount.countDocuments({\r\n      $or: [\r\n        { validUntil: { $lt: now } },\r\n      ],\r\n      isActive: true,\r\n    });\r\n\r\n    // Get attendance stats\r\n    stats.attendance.openSessions = await Attendance.countDocuments({\r\n      clockOut: null,\r\n    });\r\n\r\n    // Count forgotten sessions (open for more than 12 hours)\r\n    const forgottenThreshold = new Date(now.getTime() - 12 * 60 * 60 * 1000);\r\n    stats.attendance.forgottenSessions = await Attendance.countDocuments({\r\n      clockOut: null,\r\n      clockIn: { $lt: forgottenThreshold },\r\n    });\r\n\r\n    // Get cash drawer stats\r\n    stats.cashDrawer.openSessions = await CashDrawerSession.countDocuments({\r\n      status: 'open',\r\n    });\r\n\r\n    // Get transaction stats (transactions with email in notes from last 24h)\r\n    const last24h = new Date(now.getTime() - 24 * 60 * 60 * 1000);\r\n    const recentTransactions = await Transaction.find({\r\n      createdAt: { $gte: last24h },\r\n      status: 'completed',\r\n      notes: { $regex: /email/i },\r\n    }).limit(100).lean();\r\n\r\n    stats.transactions.pendingReceipts = recentTransactions.filter(t => {\r\n      const emailMatch = t.notes?.match(/email[:\\s]+([^\\s]+)/i);\r\n      return !!emailMatch;\r\n    }).length;\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      data: stats,\r\n      timestamp: now.toISOString(),\r\n    });\r\n  } catch (error: any) {\r\n    console.error('Automation status error:', error);\r\n    return NextResponse.json(\r\n      {\r\n        success: false,\r\n        error: error.message,\r\n      },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\automations\\stock\\predictive\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":23,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":23,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[877,880],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[877,880],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":56,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":56,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2137,2140],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2137,2140],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * API Route for Predictive Stock Replenishment\r\n */\r\n\r\nimport { NextRequest, NextResponse } from 'next/server';\r\nimport { predictStockNeeds } from '@/lib/automations';\r\n\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    const body = await request.json().catch(() => ({}));\r\n    const { tenantId, analysisDays, predictionDays } = body;\r\n\r\n    const isVercelCron = request.headers.get('authorization') === `Bearer ${process.env.CRON_SECRET}`;\r\n    const cronSecret = process.env.CRON_SECRET;\r\n    const providedSecret = body.secret;\r\n\r\n    if (cronSecret && !isVercelCron && providedSecret !== cronSecret) {\r\n      return NextResponse.json({ success: false, error: 'Unauthorized' }, { status: 401 });\r\n    }\r\n\r\n    const result = await predictStockNeeds({ tenantId, analysisDays, predictionDays });\r\n    return NextResponse.json(result);\r\n  } catch (error: any) {\r\n    console.error('Predictive stock error:', error);\r\n    return NextResponse.json({\r\n      success: false,\r\n      message: `Error: ${error.message}`,\r\n      processed: 0,\r\n      failed: 0,\r\n      errors: [error.message],\r\n    }, { status: 500 });\r\n  }\r\n}\r\n\r\nexport async function GET(request: NextRequest) {\r\n  try {\r\n    const searchParams = request.nextUrl.searchParams;\r\n    const tenantId = searchParams.get('tenantId') || undefined;\r\n    const analysisDays = searchParams.get('analysisDays')\r\n      ? parseInt(searchParams.get('analysisDays')!, 10)\r\n      : undefined;\r\n    const predictionDays = searchParams.get('predictionDays')\r\n      ? parseInt(searchParams.get('predictionDays')!, 10)\r\n      : undefined;\r\n\r\n    const isVercelCron = request.headers.get('authorization') === `Bearer ${process.env.CRON_SECRET}`;\r\n    const cronSecret = process.env.CRON_SECRET;\r\n    const providedSecret = searchParams.get('secret');\r\n\r\n    if (cronSecret && !isVercelCron && providedSecret !== cronSecret) {\r\n      return NextResponse.json({ success: false, error: 'Unauthorized' }, { status: 401 });\r\n    }\r\n\r\n    const result = await predictStockNeeds({ tenantId, analysisDays, predictionDays });\r\n    return NextResponse.json(result);\r\n  } catch (error: any) {\r\n    console.error('Predictive stock error:', error);\r\n    return NextResponse.json({\r\n      success: false,\r\n      message: `Error: ${error.message}`,\r\n      processed: 0,\r\n      failed: 0,\r\n      errors: [error.message],\r\n    }, { status: 500 });\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\automations\\stock\\transfer\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":23,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":23,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[873,876],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[873,876],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":54,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":54,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2079,2082],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2079,2082],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * API Route for Stock Transfer\r\n */\r\n\r\nimport { NextRequest, NextResponse } from 'next/server';\r\nimport { detectStockImbalances } from '@/lib/automations';\r\n\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    const body = await request.json().catch(() => ({}));\r\n    const { tenantId, autoApprove, minStockThreshold } = body;\r\n\r\n    const isVercelCron = request.headers.get('authorization') === `Bearer ${process.env.CRON_SECRET}`;\r\n    const cronSecret = process.env.CRON_SECRET;\r\n    const providedSecret = body.secret;\r\n\r\n    if (cronSecret && !isVercelCron && providedSecret !== cronSecret) {\r\n      return NextResponse.json({ success: false, error: 'Unauthorized' }, { status: 401 });\r\n    }\r\n\r\n    const result = await detectStockImbalances({ tenantId, autoApprove, minStockThreshold });\r\n    return NextResponse.json(result);\r\n  } catch (error: any) {\r\n    console.error('Stock transfer error:', error);\r\n    return NextResponse.json({\r\n      success: false,\r\n      message: `Error: ${error.message}`,\r\n      processed: 0,\r\n      failed: 0,\r\n      errors: [error.message],\r\n    }, { status: 500 });\r\n  }\r\n}\r\n\r\nexport async function GET(request: NextRequest) {\r\n  try {\r\n    const searchParams = request.nextUrl.searchParams;\r\n    const tenantId = searchParams.get('tenantId') || undefined;\r\n    const autoApprove = searchParams.get('autoApprove') === 'true';\r\n    const minStockThreshold = searchParams.get('minStockThreshold')\r\n      ? parseInt(searchParams.get('minStockThreshold')!, 10)\r\n      : undefined;\r\n\r\n    const isVercelCron = request.headers.get('authorization') === `Bearer ${process.env.CRON_SECRET}`;\r\n    const cronSecret = process.env.CRON_SECRET;\r\n    const providedSecret = searchParams.get('secret');\r\n\r\n    if (cronSecret && !isVercelCron && providedSecret !== cronSecret) {\r\n      return NextResponse.json({ success: false, error: 'Unauthorized' }, { status: 401 });\r\n    }\r\n\r\n    const result = await detectStockImbalances({ tenantId, autoApprove, minStockThreshold });\r\n    return NextResponse.json(result);\r\n  } catch (error: any) {\r\n    console.error('Stock transfer error:', error);\r\n    return NextResponse.json({\r\n      success: false,\r\n      message: `Error: ${error.message}`,\r\n      processed: 0,\r\n      failed: 0,\r\n      errors: [error.message],\r\n    }, { status: 500 });\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\automations\\sync\\multi-branch\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":28,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":28,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1174,1177],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1174,1177],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":64,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":64,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2727,2730],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2727,2730],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * API Route for Multi-Branch Data Sync\r\n */\r\n\r\nimport { NextRequest, NextResponse } from 'next/server';\r\nimport { syncMultiBranchData } from '@/lib/automations';\r\n\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    const body = await request.json().catch(() => ({}));\r\n    const { tenantId, syncProducts, syncCustomers, syncDiscounts, conflictResolution: conflictResolutionRaw } = body;\r\n\r\n    const isVercelCron = request.headers.get('authorization') === `Bearer ${process.env.CRON_SECRET}`;\r\n    const cronSecret = process.env.CRON_SECRET;\r\n    const providedSecret = body.secret;\r\n\r\n    if (cronSecret && !isVercelCron && providedSecret !== cronSecret) {\r\n      return NextResponse.json({ success: false, error: 'Unauthorized' }, { status: 401 });\r\n    }\r\n\r\n    // Validate conflictResolution type\r\n    const conflictResolution = (conflictResolutionRaw === 'manual' || conflictResolutionRaw === 'last-write-wins')\r\n      ? conflictResolutionRaw\r\n      : undefined;\r\n\r\n    const result = await syncMultiBranchData({ tenantId, syncProducts, syncCustomers, syncDiscounts, conflictResolution });\r\n    return NextResponse.json(result);\r\n  } catch (error: any) {\r\n    console.error('Multi-branch sync error:', error);\r\n    return NextResponse.json({\r\n      success: false,\r\n      message: `Error: ${error.message}`,\r\n      processed: 0,\r\n      failed: 0,\r\n      errors: [error.message],\r\n    }, { status: 500 });\r\n  }\r\n}\r\n\r\nexport async function GET(request: NextRequest) {\r\n  try {\r\n    const searchParams = request.nextUrl.searchParams;\r\n    const tenantId = searchParams.get('tenantId') || undefined;\r\n    const syncProducts = searchParams.get('syncProducts') !== 'false';\r\n    const syncCustomers = searchParams.get('syncCustomers') !== 'false';\r\n    const syncDiscounts = searchParams.get('syncDiscounts') !== 'false';\r\n    const conflictResolutionRaw = searchParams.get('conflictResolution') || 'last-write-wins';\r\n\r\n    const isVercelCron = request.headers.get('authorization') === `Bearer ${process.env.CRON_SECRET}`;\r\n    const cronSecret = process.env.CRON_SECRET;\r\n    const providedSecret = searchParams.get('secret');\r\n\r\n    if (cronSecret && !isVercelCron && providedSecret !== cronSecret) {\r\n      return NextResponse.json({ success: false, error: 'Unauthorized' }, { status: 401 });\r\n    }\r\n\r\n    // Validate conflictResolution type\r\n    const conflictResolution = (conflictResolutionRaw === 'manual' || conflictResolutionRaw === 'last-write-wins')\r\n      ? conflictResolutionRaw\r\n      : 'last-write-wins';\r\n\r\n    const result = await syncMultiBranchData({ tenantId, syncProducts, syncCustomers, syncDiscounts, conflictResolution });\r\n    return NextResponse.json(result);\r\n  } catch (error: any) {\r\n    console.error('Multi-branch sync error:', error);\r\n    return NextResponse.json({\r\n      success: false,\r\n      message: `Error: ${error.message}`,\r\n      processed: 0,\r\n      failed: 0,\r\n      errors: [error.message],\r\n    }, { status: 500 });\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\automations\\sync\\offline\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":23,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":23,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[847,850],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[847,850],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":53,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":53,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1943,1946],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1943,1946],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * API Route for Offline Transaction Sync\r\n */\r\n\r\nimport { NextRequest, NextResponse } from 'next/server';\r\nimport { syncOfflineTransactions } from '@/lib/automations';\r\n\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    const body = await request.json().catch(() => ({}));\r\n    const { tenantId, maxRetries } = body;\r\n\r\n    const isVercelCron = request.headers.get('authorization') === `Bearer ${process.env.CRON_SECRET}`;\r\n    const cronSecret = process.env.CRON_SECRET;\r\n    const providedSecret = body.secret;\r\n\r\n    if (cronSecret && !isVercelCron && providedSecret !== cronSecret) {\r\n      return NextResponse.json({ success: false, error: 'Unauthorized' }, { status: 401 });\r\n    }\r\n\r\n    const result = await syncOfflineTransactions({ tenantId, maxRetries });\r\n    return NextResponse.json(result);\r\n  } catch (error: any) {\r\n    console.error('Offline sync error:', error);\r\n    return NextResponse.json({\r\n      success: false,\r\n      message: `Error: ${error.message}`,\r\n      processed: 0,\r\n      failed: 0,\r\n      errors: [error.message],\r\n    }, { status: 500 });\r\n  }\r\n}\r\n\r\nexport async function GET(request: NextRequest) {\r\n  try {\r\n    const searchParams = request.nextUrl.searchParams;\r\n    const tenantId = searchParams.get('tenantId') || undefined;\r\n    const maxRetries = searchParams.get('maxRetries')\r\n      ? parseInt(searchParams.get('maxRetries')!, 10)\r\n      : undefined;\r\n\r\n    const isVercelCron = request.headers.get('authorization') === `Bearer ${process.env.CRON_SECRET}`;\r\n    const cronSecret = process.env.CRON_SECRET;\r\n    const providedSecret = searchParams.get('secret');\r\n\r\n    if (cronSecret && !isVercelCron && providedSecret !== cronSecret) {\r\n      return NextResponse.json({ success: false, error: 'Unauthorized' }, { status: 401 });\r\n    }\r\n\r\n    const result = await syncOfflineTransactions({ tenantId, maxRetries });\r\n    return NextResponse.json(result);\r\n  } catch (error: any) {\r\n    console.error('Offline sync error:', error);\r\n    return NextResponse.json({\r\n      success: false,\r\n      message: `Error: ${error.message}`,\r\n      processed: 0,\r\n      failed: 0,\r\n      errors: [error.message],\r\n    }, { status: 500 });\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\automations\\transaction-receipts\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":44,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":44,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1344,1347],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1344,1347],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":96,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":96,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3033,3036],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3033,3036],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * API Route for Transaction Receipt Auto-Email\r\n * Can be called by cron jobs or manually\r\n */\r\n\r\nimport { NextRequest, NextResponse } from 'next/server';\r\nimport { sendTransactionReceipt, sendPendingReceipts } from '@/lib/automations';\r\n\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    const body = await request.json().catch(() => ({}));\r\n    const { transactionId, customerEmail, tenantId, hoursAgo } = body;\r\n\r\n    // Optional: Add authentication/authorization\r\n    const authHeader = request.headers.get('authorization');\r\n    const cronSecret = process.env.CRON_SECRET;\r\n\r\n    if (authHeader && cronSecret) {\r\n      const token = authHeader.replace('Bearer ', '');\r\n      if (token !== cronSecret) {\r\n        return NextResponse.json(\r\n          { success: false, error: 'Unauthorized' },\r\n          { status: 401 }\r\n        );\r\n      }\r\n    }\r\n\r\n    // If transactionId is provided, send receipt for that transaction\r\n    if (transactionId) {\r\n      const result = await sendTransactionReceipt({\r\n        transactionId,\r\n        customerEmail,\r\n      });\r\n      return NextResponse.json(result);\r\n    }\r\n\r\n    // Otherwise, send pending receipts\r\n    const result = await sendPendingReceipts({\r\n      tenantId,\r\n      hoursAgo: hoursAgo || 24,\r\n    });\r\n\r\n    return NextResponse.json(result);\r\n  } catch (error: any) {\r\n    console.error('Transaction receipt automation error:', error);\r\n    return NextResponse.json(\r\n      {\r\n        success: false,\r\n        message: `Error: ${error.message}`,\r\n        processed: 0,\r\n        failed: 0,\r\n        errors: [error.message],\r\n      },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n\r\nexport async function GET(request: NextRequest) {\r\n  try {\r\n    const searchParams = request.nextUrl.searchParams;\r\n    const transactionId = searchParams.get('transactionId') || undefined;\r\n    const customerEmail = searchParams.get('customerEmail') || undefined;\r\n    const tenantId = searchParams.get('tenantId') || undefined;\r\n    const hoursAgo = searchParams.get('hoursAgo')\r\n      ? parseInt(searchParams.get('hoursAgo')!, 10)\r\n      : undefined;\r\n\r\n    // Allow Vercel cron jobs (they send a special header) or verify secret\r\n    const isVercelCron = request.headers.get('authorization') === `Bearer ${process.env.CRON_SECRET}`;\r\n    const cronSecret = process.env.CRON_SECRET;\r\n    const providedSecret = searchParams.get('secret');\r\n\r\n    // Allow if: Vercel cron, or no secret configured, or secret matches\r\n    if (cronSecret && !isVercelCron && providedSecret !== cronSecret) {\r\n      return NextResponse.json(\r\n        { success: false, error: 'Unauthorized' },\r\n        { status: 401 }\r\n      );\r\n    }\r\n\r\n    if (transactionId) {\r\n      const result = await sendTransactionReceipt({\r\n        transactionId,\r\n        customerEmail,\r\n      });\r\n      return NextResponse.json(result);\r\n    }\r\n\r\n    const result = await sendPendingReceipts({\r\n      tenantId,\r\n      hoursAgo: hoursAgo || 24,\r\n    });\r\n\r\n    return NextResponse.json(result);\r\n  } catch (error: any) {\r\n    console.error('Transaction receipt automation error:', error);\r\n    return NextResponse.json(\r\n      {\r\n        success: false,\r\n        message: `Error: ${error.message}`,\r\n        processed: 0,\r\n        failed: 0,\r\n        errors: [error.message],\r\n      },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\booking\\availability\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":70,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":70,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2594,2597],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2594,2597],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":127,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":127,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4375,4378],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4375,4378],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\nimport connectDB from '@/lib/mongodb';\r\nimport Booking from '@/models/Booking';\r\nimport Product from '@/models/Product';\r\nimport Tenant from '@/models/Tenant';\r\nimport { getValidationTranslatorFromRequest } from '@/lib/validation-translations';\r\n\r\n/**\r\n * GET /api/booking/availability?tenantId={{tenantId}}&serviceId={{serviceId}}&date={{date}}\r\n * Public endpoint to check available time slots for a service on a given date.\r\n */\r\nexport async function GET(request: NextRequest) {\r\n  let t: (key: string, fallback: string) => string;\r\n  try {\r\n    await connectDB();\r\n    t = await getValidationTranslatorFromRequest(request);\r\n\r\n    const { searchParams } = request.nextUrl;\r\n    const tenantIdParam = searchParams.get('tenantId');\r\n    const serviceId = searchParams.get('serviceId');\r\n    const dateParam = searchParams.get('date');\r\n\r\n    if (!tenantIdParam || !serviceId || !dateParam) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.missingParams', 'tenantId, serviceId, and date are required') },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    // Resolve tenant\r\n    const tenant = await Tenant.findOne({\r\n      $or: [{ slug: tenantIdParam }, ...(tenantIdParam.match(/^[0-9a-fA-F]{24}$/) ? [{ _id: tenantIdParam }] : [])],\r\n      isActive: true,\r\n    }).lean();\r\n\r\n    if (!tenant) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.tenantNotFound', 'Tenant not found or inactive') },\r\n        { status: 404 }\r\n      );\r\n    }\r\n\r\n    // Fetch service to get default duration\r\n    const service = await Product.findOne({\r\n      _id: serviceId,\r\n      tenantId: tenant._id,\r\n      productType: 'service',\r\n    }).lean();\r\n\r\n    if (!service) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.serviceNotFound', 'Service not found') },\r\n        { status: 404 }\r\n      );\r\n    }\r\n\r\n    const staffId = searchParams.get('staffId');\r\n    const duration = parseInt(searchParams.get('duration') || '60', 10);\r\n    const slotInterval = parseInt(searchParams.get('slotInterval') || '30', 10);\r\n    const startHour = parseInt(searchParams.get('startHour') || '9', 10);\r\n    const endHour = parseInt(searchParams.get('endHour') || '17', 10);\r\n\r\n    // Get the selected date boundaries\r\n    const selectedDate = new Date(dateParam);\r\n    selectedDate.setHours(0, 0, 0, 0);\r\n    const endDate = new Date(selectedDate);\r\n    endDate.setHours(23, 59, 59, 999);\r\n\r\n    // Fetch existing bookings for this date\r\n    const query: Record<string, any> = {\r\n      tenantId: tenant._id,\r\n      startTime: { $gte: selectedDate, $lte: endDate },\r\n      status: { $in: ['pending', 'confirmed'] },\r\n    };\r\n\r\n    if (staffId) {\r\n      query.staffId = staffId;\r\n    }\r\n\r\n    const existingBookings = await Booking.find(query).lean();\r\n\r\n    // Generate time slots\r\n    const slots: Array<{ time: string; available: boolean }> = [];\r\n    const slotStart = new Date(selectedDate);\r\n    slotStart.setHours(startHour, 0, 0, 0);\r\n\r\n    const dayEnd = new Date(selectedDate);\r\n    dayEnd.setHours(endHour, 0, 0, 0);\r\n\r\n    let currentSlot = new Date(slotStart);\r\n\r\n    while (currentSlot < dayEnd) {\r\n      const slotEnd = new Date(currentSlot.getTime() + duration * 60000);\r\n\r\n      // Check for conflicts with existing bookings\r\n      const hasConflict = existingBookings.some((booking) => {\r\n        const bookingStart = new Date(booking.startTime);\r\n        const bookingEnd = new Date(booking.endTime);\r\n        return (\r\n          (currentSlot >= bookingStart && currentSlot < bookingEnd) ||\r\n          (slotEnd > bookingStart && slotEnd <= bookingEnd) ||\r\n          (currentSlot <= bookingStart && slotEnd >= bookingEnd)\r\n        );\r\n      });\r\n\r\n      // Don't show past slots for today\r\n      const isPast = currentSlot < new Date();\r\n\r\n      slots.push({\r\n        time: currentSlot.toISOString(),\r\n        available: !hasConflict && !isPast,\r\n      });\r\n\r\n      currentSlot = new Date(currentSlot.getTime() + slotInterval * 60000);\r\n    }\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      data: {\r\n        service: { _id: service._id, name: service.name, price: service.price },\r\n        date: selectedDate.toISOString(),\r\n        slots,\r\n        duration,\r\n        slotInterval,\r\n      },\r\n    });\r\n  } catch (error: any) {\r\n    return NextResponse.json(\r\n      { success: false, error: error.message || 'Failed to fetch availability' },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\booking\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'validateEmail' is defined but never used. Allowed unused vars must match /^_/u.","line":6,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":23},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":82,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":82,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3034,3037],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3034,3037],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":125,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":125,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4320,4323],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4320,4323],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":190,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":190,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6556,6559],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6556,6559],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":204,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":204,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6881,6884],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6881,6884],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\nimport connectDB from '@/lib/mongodb';\r\nimport Booking from '@/models/Booking';\r\nimport Tenant from '@/models/Tenant';\r\nimport { requireAuth } from '@/lib/auth';\r\nimport { validateEmail } from '@/lib/validation';\r\nimport { createAuditLog, AuditActions } from '@/lib/audit';\r\nimport { getValidationTranslatorFromRequest } from '@/lib/validation-translations';\r\n\r\n/**\r\n * POST /api/booking\r\n * Authenticated client endpoint to create a booking.\r\n * Body: { tenantId, serviceName, serviceDescription?, startTime, duration, staffId?, notes? }\r\n */\r\nexport async function POST(request: NextRequest) {\r\n  let t: (key: string, fallback: string) => string;\r\n  try {\r\n    await connectDB();\r\n    t = await getValidationTranslatorFromRequest(request);\r\n\r\n    const currentUser = await requireAuth(request);\r\n    const body = await request.json();\r\n    const { tenantId, serviceName, serviceDescription, startTime, duration, staffId, notes } = body;\r\n\r\n    if (!tenantId || !serviceName || !startTime || !duration) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.bookingFieldsRequired', 'tenantId, serviceName, startTime, and duration are required') },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    // Resolve tenant\r\n    const tenant = await Tenant.findOne({\r\n      $or: [{ slug: tenantId }, ...(tenantId.match(/^[0-9a-fA-F]{24}$/) ? [{ _id: tenantId }] : [])],\r\n      isActive: true,\r\n    }).lean();\r\n\r\n    if (!tenant) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.tenantNotFound', 'Tenant not found or inactive') },\r\n        { status: 404 }\r\n      );\r\n    }\r\n\r\n    // Get user details for customer info\r\n    const User = (await import('@/models/User')).default;\r\n    const user = await User.findById(currentUser.userId).lean();\r\n    if (!user) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.userNotFound', 'User not found') },\r\n        { status: 404 }\r\n      );\r\n    }\r\n\r\n    const bookingStartTime = new Date(startTime);\r\n    if (isNaN(bookingStartTime.getTime())) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.invalidStartTime', 'Invalid start time') },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    // Don't allow booking in the past\r\n    if (bookingStartTime < new Date()) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.bookingInPast', 'Cannot book a time in the past') },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    const durationMinutes = parseInt(duration, 10);\r\n    if (isNaN(durationMinutes) || durationMinutes <= 0) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.invalidDuration', 'Duration must be a positive number in minutes') },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    const bookingEndTime = new Date(bookingStartTime.getTime() + durationMinutes * 60000);\r\n\r\n    // Check for time conflicts\r\n    const conflictQuery: Record<string, any> = {\r\n      tenantId: tenant._id,\r\n      status: { $in: ['pending', 'confirmed'] },\r\n      $or: [\r\n        { startTime: { $lt: bookingEndTime }, endTime: { $gt: bookingStartTime } },\r\n      ],\r\n    };\r\n\r\n    if (staffId) {\r\n      conflictQuery.staffId = staffId;\r\n    }\r\n\r\n    const conflict = await Booking.findOne(conflictQuery).lean();\r\n    if (conflict) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.timeSlotConflict', 'This time slot is not available') },\r\n        { status: 409 }\r\n      );\r\n    }\r\n\r\n    const booking = await Booking.create({\r\n      tenantId: tenant._id,\r\n      customerName: user.name,\r\n      customerEmail: user.email,\r\n      serviceName,\r\n      serviceDescription,\r\n      startTime: bookingStartTime,\r\n      endTime: bookingEndTime,\r\n      duration: durationMinutes,\r\n      staffId: staffId || undefined,\r\n      notes,\r\n      status: 'pending',\r\n    });\r\n\r\n    await createAuditLog(request, {\r\n      tenantId: tenant._id.toString(),\r\n      action: AuditActions.CREATE,\r\n      entityType: 'booking',\r\n      entityId: booking._id.toString(),\r\n      metadata: { source: 'client', userId: currentUser.userId },\r\n    });\r\n\r\n    return NextResponse.json({ success: true, data: booking }, { status: 201 });\r\n  } catch (error: any) {\r\n    if (error.message === 'Unauthorized') {\r\n      return NextResponse.json({ success: false, error: 'Unauthorized' }, { status: 401 });\r\n    }\r\n    return NextResponse.json(\r\n      { success: false, error: error.message || 'Failed to create booking' },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n\r\n/**\r\n * GET /api/booking?userId={{userId}}&tenantId={{tenantId}}\r\n * Authenticated endpoint to list a client's bookings.\r\n */\r\nexport async function GET(request: NextRequest) {\r\n  let t: (key: string, fallback: string) => string;\r\n  try {\r\n    await connectDB();\r\n    t = await getValidationTranslatorFromRequest(request);\r\n\r\n    const currentUser = await requireAuth(request);\r\n    const { searchParams } = request.nextUrl;\r\n    const tenantIdParam = searchParams.get('tenantId');\r\n    const userId = searchParams.get('userId');\r\n\r\n    if (!tenantIdParam || !userId) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.missingParams', 'tenantId and userId are required') },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    // Users can only view their own bookings (unless admin+)\r\n    if (currentUser.userId !== userId && !['admin', 'owner', 'manager'].includes(currentUser.role)) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.forbidden', 'You can only view your own bookings') },\r\n        { status: 403 }\r\n      );\r\n    }\r\n\r\n    // Resolve tenant\r\n    const tenant = await Tenant.findOne({\r\n      $or: [{ slug: tenantIdParam }, ...(tenantIdParam.match(/^[0-9a-fA-F]{24}$/) ? [{ _id: tenantIdParam }] : [])],\r\n      isActive: true,\r\n    }).lean();\r\n\r\n    if (!tenant) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.tenantNotFound', 'Tenant not found or inactive') },\r\n        { status: 404 }\r\n      );\r\n    }\r\n\r\n    // Get user email to match bookings\r\n    const User = (await import('@/models/User')).default;\r\n    const user = await User.findById(userId).lean();\r\n    if (!user) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.userNotFound', 'User not found') },\r\n        { status: 404 }\r\n      );\r\n    }\r\n\r\n    const status = searchParams.get('status');\r\n    const filter: Record<string, any> = {\r\n      tenantId: tenant._id,\r\n      customerEmail: user.email,\r\n    };\r\n\r\n    if (status) {\r\n      filter.status = status;\r\n    }\r\n\r\n    const bookings = await Booking.find(filter)\r\n      .sort({ startTime: -1 })\r\n      .lean();\r\n\r\n    return NextResponse.json({ success: true, data: bookings });\r\n  } catch (error: any) {\r\n    if (error.message === 'Unauthorized') {\r\n      return NextResponse.json({ success: false, error: 'Unauthorized' }, { status: 401 });\r\n    }\r\n    return NextResponse.json(\r\n      { success: false, error: error.message || 'Failed to fetch bookings' },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\bookings\\[id]\\reminder\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":76,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":76,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2592,2595],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2592,2595],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\nimport connectDB from '@/lib/mongodb';\r\nimport Booking from '@/models/Booking';\r\nimport { getTenantIdFromRequest } from '@/lib/api-tenant';\r\nimport { requireRole, getCurrentUser } from '@/lib/auth';\r\nimport { sendBookingReminder } from '@/lib/notifications';\r\nimport { getValidationTranslatorFromRequest } from '@/lib/validation-translations';\r\nimport { getTenantSettingsById } from '@/lib/tenant';\r\n\r\n/**\r\n * POST - Send reminder for a booking\r\n */\r\nexport async function POST(\r\n  request: NextRequest,\r\n  { params }: { params: Promise<{ id: string }> }\r\n) {\r\n  try {\r\n    await connectDB();\r\n    const user = await getCurrentUser(request);\r\n    const t = await getValidationTranslatorFromRequest(request);\r\n    if (!user) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.unauthorized', 'Unauthorized') },\r\n        { status: 401 }\r\n      );\r\n    }\r\n\r\n    await requireRole(request, ['owner', 'admin', 'manager', 'cashier']);\r\n    const tenantId = await getTenantIdFromRequest(request);\r\n    \r\n    if (!tenantId) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.tenantNotFound', 'Tenant not found') },\r\n        { status: 404 }\r\n      );\r\n    }\r\n\r\n    const { id } = await params;\r\n    const booking = await Booking.findOne({ _id: id, tenantId }).lean();\r\n\r\n    if (!booking) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.bookingNotFound', 'Booking not found') },\r\n        { status: 404 }\r\n      );\r\n    }\r\n\r\n    if (booking.status === 'cancelled' || booking.status === 'completed') {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.cannotSendReminder', 'Cannot send reminder for cancelled or completed bookings') },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    const tenantSettings = await getTenantSettingsById(tenantId);\r\n    const results = await sendBookingReminder({\r\n      customerName: booking.customerName,\r\n      customerEmail: booking.customerEmail,\r\n      customerPhone: booking.customerPhone,\r\n      serviceName: booking.serviceName,\r\n      startTime: booking.startTime,\r\n      endTime: booking.endTime,\r\n      staffName: booking.staffName,\r\n      notes: booking.notes,\r\n      bookingId: id,\r\n    }, tenantSettings || undefined);\r\n\r\n    // Update reminder sent status\r\n    await Booking.findByIdAndUpdate(id, { reminderSent: true });\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      message: 'Reminder sent successfully',\r\n      results,\r\n    });\r\n  } catch (error: any) {\r\n    console.error('Send reminder error:', error);\r\n    const t = await getValidationTranslatorFromRequest(request);\r\n    return NextResponse.json(\r\n      { success: false, error: error.message || t('validation.failedToSendReminder', 'Failed to send reminder') },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\bookings\\[id]\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'sendBookingReminder' is defined but never used. Allowed unused vars must match /^_/u.","line":8,"column":60,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":79},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":51,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":51,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1766,1769],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1766,1769],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":175,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":175,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5421,5424],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5421,5424],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":239,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":239,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8327,8330],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8327,8330],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":317,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":317,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10891,10894],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10891,10894],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\nimport connectDB from '@/lib/mongodb';\r\nimport Booking from '@/models/Booking';\r\nimport User from '@/models/User';\r\nimport { getTenantIdFromRequest } from '@/lib/api-tenant';\r\nimport { requireRole, getCurrentUser } from '@/lib/auth';\r\nimport { createAuditLog, AuditActions } from '@/lib/audit';\r\nimport { sendBookingConfirmation, sendBookingCancellation, sendBookingReminder } from '@/lib/notifications';\r\nimport { getValidationTranslatorFromRequest } from '@/lib/validation-translations';\r\nimport { getTenantSettingsById } from '@/lib/tenant';\r\n\r\n/**\r\n * GET - Get a single booking by ID\r\n */\r\nexport async function GET(\r\n  request: NextRequest,\r\n  { params }: { params: Promise<{ id: string }> }\r\n) {\r\n  try {\r\n    await connectDB();\r\n    const user = await getCurrentUser(request);\r\n    const t = await getValidationTranslatorFromRequest(request);\r\n    if (!user) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.unauthorized', 'Unauthorized') },\r\n        { status: 401 }\r\n      );\r\n    }\r\n\r\n    const tenantId = await getTenantIdFromRequest(request);\r\n    if (!tenantId) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.tenantNotFound', 'Tenant not found') },\r\n        { status: 404 }\r\n      );\r\n    }\r\n\r\n    const { id } = await params;\r\n    const booking = await Booking.findOne({ _id: id, tenantId })\r\n      .populate('staffId', 'name email')\r\n      .lean();\r\n\r\n    if (!booking) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.bookingNotFound', 'Booking not found') },\r\n        { status: 404 }\r\n      );\r\n    }\r\n\r\n    return NextResponse.json({ success: true, data: booking });\r\n  } catch (error: any) {\r\n    console.error('Get booking error:', error);\r\n    const t = await getValidationTranslatorFromRequest(request);\r\n    return NextResponse.json(\r\n      { success: false, error: error.message || t('validation.failedToFetchBooking', 'Failed to fetch booking') },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n\r\n/**\r\n * PUT - Update a booking\r\n */\r\nexport async function PUT(\r\n  request: NextRequest,\r\n  { params }: { params: Promise<{ id: string }> }\r\n) {\r\n  try {\r\n    await connectDB();\r\n    const user = await getCurrentUser(request);\r\n    const t = await getValidationTranslatorFromRequest(request);\r\n    if (!user) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.unauthorized', 'Unauthorized') },\r\n        { status: 401 }\r\n      );\r\n    }\r\n\r\n    await requireRole(request, ['owner', 'admin', 'manager', 'cashier']);\r\n    const tenantId = await getTenantIdFromRequest(request);\r\n    \r\n    if (!tenantId) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.tenantNotFound', 'Tenant not found') },\r\n        { status: 404 }\r\n      );\r\n    }\r\n\r\n    const { id } = await params;\r\n    const existingBooking = await Booking.findOne({ _id: id, tenantId });\r\n\r\n    if (!existingBooking) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.bookingNotFound', 'Booking not found') },\r\n        { status: 404 }\r\n      );\r\n    }\r\n\r\n    const body = await request.json();\r\n    const {\r\n      customerName,\r\n      customerEmail,\r\n      customerPhone,\r\n      serviceName,\r\n      serviceDescription,\r\n      startTime,\r\n      duration,\r\n      staffId,\r\n      notes,\r\n      status,\r\n    } = body;\r\n\r\n    const oldStatus = existingBooking.status;\r\n    const oldStartTime = existingBooking.startTime;\r\n\r\n    // Calculate new end time if start time or duration changed\r\n    let newStartTime = existingBooking.startTime;\r\n    let newEndTime = existingBooking.endTime;\r\n    let newDuration = existingBooking.duration;\r\n\r\n    if (startTime) {\r\n      newStartTime = new Date(startTime);\r\n    }\r\n    if (duration) {\r\n      newDuration = duration;\r\n    }\r\n    if (startTime || duration) {\r\n      newEndTime = new Date(newStartTime.getTime() + newDuration * 60000);\r\n    }\r\n\r\n    // Check for conflicts if time changed\r\n    if (startTime || duration) {\r\n      const conflictingBookings = await Booking.find({\r\n        tenantId,\r\n        _id: { $ne: id },\r\n        status: { $in: ['pending', 'confirmed'] },\r\n        $or: [\r\n          {\r\n            startTime: { $lt: newEndTime },\r\n            endTime: { $gt: newStartTime },\r\n          },\r\n        ],\r\n      });\r\n\r\n      const checkStaffId = staffId || existingBooking.staffId;\r\n      if (checkStaffId) {\r\n        const staffConflicts = conflictingBookings.filter(\r\n          (booking) => booking.staffId?.toString() === checkStaffId.toString()\r\n        );\r\n        if (staffConflicts.length > 0) {\r\n          return NextResponse.json(\r\n            {\r\n              success: false,\r\n              error: t('validation.staffBookingConflict', 'Staff member already has a booking at this time'),\r\n              conflicts: staffConflicts,\r\n            },\r\n            { status: 409 }\r\n          );\r\n        }\r\n      }\r\n    }\r\n\r\n    // Verify staff exists if provided\r\n    if (staffId) {\r\n      const staff = await User.findOne({ _id: staffId, tenantId, isActive: true });\r\n      if (!staff) {\r\n        return NextResponse.json(\r\n          { success: false, error: t('validation.staffNotFound', 'Staff member not found or inactive') },\r\n          { status: 404 }\r\n        );\r\n      }\r\n    }\r\n\r\n    // Update booking\r\n    const updateData: any = {};\r\n    if (customerName !== undefined) updateData.customerName = customerName;\r\n    if (customerEmail !== undefined) updateData.customerEmail = customerEmail;\r\n    if (customerPhone !== undefined) updateData.customerPhone = customerPhone;\r\n    if (serviceName !== undefined) updateData.serviceName = serviceName;\r\n    if (serviceDescription !== undefined) updateData.serviceDescription = serviceDescription;\r\n    if (startTime !== undefined) updateData.startTime = newStartTime;\r\n    if (duration !== undefined) updateData.duration = newDuration;\r\n    if (startTime !== undefined || duration !== undefined) updateData.endTime = newEndTime;\r\n    if (staffId !== undefined) updateData.staffId = staffId;\r\n    if (notes !== undefined) updateData.notes = notes;\r\n    if (status !== undefined) updateData.status = status;\r\n\r\n    const updatedBooking = await Booking.findByIdAndUpdate(\r\n      id,\r\n      { $set: updateData },\r\n      { new: true }\r\n    ).populate('staffId', 'name email');\r\n\r\n    // Send notifications based on status changes\r\n    if (status && status !== oldStatus) {\r\n      try {\r\n        const tenantSettings = await getTenantSettingsById(tenantId);\r\n        if (status === 'confirmed' && !existingBooking.confirmationSent) {\r\n          await sendBookingConfirmation({\r\n            customerName: updatedBooking!.customerName,\r\n            customerEmail: updatedBooking!.customerEmail,\r\n            customerPhone: updatedBooking!.customerPhone,\r\n            serviceName: updatedBooking!.serviceName,\r\n            startTime: updatedBooking!.startTime,\r\n            endTime: updatedBooking!.endTime,\r\n            staffName: updatedBooking!.staffName,\r\n            notes: updatedBooking!.notes,\r\n            bookingId: id,\r\n          }, tenantSettings || undefined);\r\n          await Booking.findByIdAndUpdate(id, { confirmationSent: true });\r\n        } else if (status === 'cancelled') {\r\n          await sendBookingCancellation({\r\n            customerName: updatedBooking!.customerName,\r\n            customerEmail: updatedBooking!.customerEmail,\r\n            customerPhone: updatedBooking!.customerPhone,\r\n            serviceName: updatedBooking!.serviceName,\r\n            startTime: oldStartTime,\r\n            endTime: existingBooking.endTime,\r\n            staffName: existingBooking.staffName,\r\n            notes: existingBooking.notes,\r\n            bookingId: id,\r\n          }, tenantSettings || undefined);\r\n        }\r\n      } catch (notificationError) {\r\n        console.error('Failed to send booking notification:', notificationError);\r\n        // Don't fail the update if notification fails\r\n      }\r\n    }\r\n\r\n    await createAuditLog(request, {\r\n      tenantId,\r\n      action: AuditActions.UPDATE,\r\n      entityType: 'booking',\r\n      entityId: id,\r\n      changes: updateData,\r\n    });\r\n\r\n    return NextResponse.json({ success: true, data: updatedBooking });\r\n  } catch (error: any) {\r\n    console.error('Update booking error:', error);\r\n    const t = await getValidationTranslatorFromRequest(request);\r\n    return NextResponse.json(\r\n      { success: false, error: error.message || t('validation.failedToUpdateBooking', 'Failed to update booking') },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n\r\n/**\r\n * DELETE - Cancel/delete a booking\r\n */\r\nexport async function DELETE(\r\n  request: NextRequest,\r\n  { params }: { params: Promise<{ id: string }> }\r\n) {\r\n  try {\r\n    await connectDB();\r\n    const user = await getCurrentUser(request);\r\n    const t = await getValidationTranslatorFromRequest(request);\r\n    if (!user) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.unauthorized', 'Unauthorized') },\r\n        { status: 401 }\r\n      );\r\n    }\r\n\r\n    await requireRole(request, ['owner', 'admin', 'manager', 'cashier']);\r\n    const tenantId = await getTenantIdFromRequest(request);\r\n    \r\n    if (!tenantId) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.tenantNotFound', 'Tenant not found') },\r\n        { status: 404 }\r\n      );\r\n    }\r\n\r\n    const { id } = await params;\r\n    const booking = await Booking.findOne({ _id: id, tenantId });\r\n\r\n    if (!booking) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.bookingNotFound', 'Booking not found') },\r\n        { status: 404 }\r\n      );\r\n    }\r\n\r\n    // Send cancellation notification if booking was confirmed\r\n    if (booking.status === 'confirmed' || booking.status === 'pending') {\r\n      try {\r\n        await sendBookingCancellation({\r\n          customerName: booking.customerName,\r\n          customerEmail: booking.customerEmail,\r\n          customerPhone: booking.customerPhone,\r\n          serviceName: booking.serviceName,\r\n          startTime: booking.startTime,\r\n          endTime: booking.endTime,\r\n          staffName: booking.staffName,\r\n          notes: booking.notes,\r\n          bookingId: id,\r\n        });\r\n      } catch (notificationError) {\r\n        console.error('Failed to send cancellation notification:', notificationError);\r\n      }\r\n    }\r\n\r\n    await Booking.findByIdAndDelete(id);\r\n\r\n    await createAuditLog(request, {\r\n      tenantId,\r\n      action: AuditActions.DELETE,\r\n      entityType: 'booking',\r\n      entityId: id,\r\n      changes: { customerName: booking.customerName, serviceName: booking.serviceName },\r\n    });\r\n\r\n    return NextResponse.json({ success: true, message: t('validation.bookingDeleted', 'Booking deleted successfully') });\r\n  } catch (error: any) {\r\n    console.error('Delete booking error:', error);\r\n    const t = await getValidationTranslatorFromRequest(request);\r\n    return NextResponse.json(\r\n      { success: false, error: error.message || t('validation.failedToDeleteBooking', 'Failed to delete booking') },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\bookings\\customer\\[customerId]\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":40,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":40,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1353,1356],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1353,1356],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":73,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":73,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2138,2141],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2138,2141],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\nimport connectDB from '@/lib/mongodb';\r\nimport Booking from '@/models/Booking';\r\nimport { requireCustomerAuth } from '@/lib/auth-customer';\r\nimport { getValidationTranslatorFromRequest } from '@/lib/validation-translations';\r\n\r\n/**\r\n * GET - Get all bookings for a customer\r\n * Query params:\r\n * - status: booking status (optional)\r\n * - startDate: ISO date string (optional)\r\n * - endDate: ISO date string (optional)\r\n */\r\nexport async function GET(\r\n  request: NextRequest,\r\n  { params }: { params: Promise<{ customerId: string }> }\r\n) {\r\n  try {\r\n    await connectDB();\r\n    const t = await getValidationTranslatorFromRequest(request);\r\n    \r\n    // Verify customer authentication\r\n    const customer = await requireCustomerAuth(request);\r\n    const { customerId } = await params;\r\n\r\n    // Ensure customer can only access their own bookings\r\n    if (customer.customerId !== customerId) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.unauthorized', 'Unauthorized') },\r\n        { status: 403 }\r\n      );\r\n    }\r\n\r\n    const { searchParams } = new URL(request.url);\r\n    const status = searchParams.get('status');\r\n    const startDate = searchParams.get('startDate');\r\n    const endDate = searchParams.get('endDate');\r\n\r\n    // Build query\r\n    const query: any = {\r\n      tenantId: customer.tenantId,\r\n      $or: [\r\n        { customerEmail: customer.email },\r\n        { customerPhone: customer.phone },\r\n      ],\r\n    };\r\n\r\n    // Add status filter\r\n    if (status) {\r\n      query.status = status;\r\n    }\r\n\r\n    // Add date range filter\r\n    if (startDate || endDate) {\r\n      query.startTime = {};\r\n      if (startDate) {\r\n        query.startTime.$gte = new Date(startDate);\r\n      }\r\n      if (endDate) {\r\n        query.startTime.$lte = new Date(endDate);\r\n      }\r\n    }\r\n\r\n    const bookings = await Booking.find(query)\r\n      .populate('staffId', 'name email')\r\n      .sort({ startTime: -1 }) // Most recent first\r\n      .lean();\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      data: bookings,\r\n    });\r\n  } catch (error: any) {\r\n    console.error('Get customer bookings error:', error);\r\n    \r\n    if (error.message === 'Unauthorized') {\r\n      return NextResponse.json(\r\n        { success: false, error: 'Unauthorized' },\r\n        { status: 401 }\r\n      );\r\n    }\r\n\r\n    return NextResponse.json(\r\n      { success: false, error: error.message || 'Failed to fetch bookings' },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\bookings\\reminders\\send\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":91,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":91,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3381,3384],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3381,3384],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":106,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":106,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3737,3740],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3737,3740],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\nimport connectDB from '@/lib/mongodb';\r\nimport Booking from '@/models/Booking';\r\nimport { getTenantIdFromRequest } from '@/lib/api-tenant';\r\nimport { requireRole, getCurrentUser } from '@/lib/auth';\r\nimport { sendBookingReminder } from '@/lib/notifications';\r\nimport { getValidationTranslatorFromRequest } from '@/lib/validation-translations';\r\nimport { getTenantSettingsById } from '@/lib/tenant';\r\n\r\n/**\r\n * POST - Send reminders for upcoming bookings\r\n * Query params:\r\n * - hoursBefore: number of hours before booking to send reminder (default: 24)\r\n * - tenant: tenant slug (required)\r\n */\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    await connectDB();\r\n    const user = await getCurrentUser(request);\r\n    const t = await getValidationTranslatorFromRequest(request);\r\n    if (!user) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.unauthorized', 'Unauthorized') },\r\n        { status: 401 }\r\n      );\r\n    }\r\n\r\n    // Only allow admins/managers to trigger reminders manually\r\n    // In production, this would be called by a cron job\r\n    await requireRole(request, ['owner', 'admin', 'manager']);\r\n    const tenantId = await getTenantIdFromRequest(request);\r\n    \r\n    if (!tenantId) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.tenantNotFound', 'Tenant not found') },\r\n        { status: 404 }\r\n      );\r\n    }\r\n\r\n    const { searchParams } = new URL(request.url);\r\n    const hoursBefore = parseInt(searchParams.get('hoursBefore') || '24', 10);\r\n\r\n    // Calculate the time window for bookings that need reminders\r\n    const now = new Date();\r\n    const reminderWindowStart = new Date(now.getTime() + hoursBefore * 60 * 60 * 1000);\r\n    const reminderWindowEnd = new Date(reminderWindowStart.getTime() + 60 * 60 * 1000); // 1 hour window\r\n\r\n    // Find bookings that:\r\n    // 1. Are in the reminder window\r\n    // 2. Are pending or confirmed\r\n    // 3. Haven't had a reminder sent yet\r\n    const bookingsToRemind = await Booking.find({\r\n      tenantId,\r\n      startTime: {\r\n        $gte: reminderWindowStart,\r\n        $lte: reminderWindowEnd,\r\n      },\r\n      status: { $in: ['pending', 'confirmed'] },\r\n      reminderSent: { $ne: true },\r\n    }).lean();\r\n\r\n    const tenantSettings = await getTenantSettingsById(tenantId);\r\n    const results = {\r\n      total: bookingsToRemind.length,\r\n      sent: 0,\r\n      failed: 0,\r\n      details: [] as Array<{ bookingId: string; success: boolean; error?: string }>,\r\n    };\r\n\r\n    for (const booking of bookingsToRemind) {\r\n      try {\r\n        await sendBookingReminder({\r\n          customerName: booking.customerName,\r\n          customerEmail: booking.customerEmail,\r\n          customerPhone: booking.customerPhone,\r\n          serviceName: booking.serviceName,\r\n          startTime: booking.startTime,\r\n          endTime: booking.endTime,\r\n          staffName: booking.staffName,\r\n          notes: booking.notes,\r\n          bookingId: booking._id.toString(),\r\n        }, tenantSettings || undefined);\r\n\r\n        // Mark reminder as sent\r\n        await Booking.findByIdAndUpdate(booking._id, { reminderSent: true });\r\n        results.sent++;\r\n        results.details.push({\r\n          bookingId: booking._id.toString(),\r\n          success: true,\r\n        });\r\n      } catch (error: any) {\r\n        results.failed++;\r\n        results.details.push({\r\n          bookingId: booking._id.toString(),\r\n          success: false,\r\n          error: error.message,\r\n        });\r\n      }\r\n    }\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      message: `Processed ${results.total} bookings`,\r\n      results,\r\n    });\r\n  } catch (error: any) {\r\n    console.error('Send reminders error:', error);\r\n    const t = await getValidationTranslatorFromRequest(request);\r\n    return NextResponse.json(\r\n      { success: false, error: error.message || t('validation.failedToSendReminders', 'Failed to send reminders') },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\bookings\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":47,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":47,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1650,1653],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1650,1653],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":73,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":73,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2254,2257],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2254,2257],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":93,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":93,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2833,2836],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2833,2836],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":124,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":124,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3929,3932],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3929,3932],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":280,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":280,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8687,8690],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8687,8690],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\nimport connectDB from '@/lib/mongodb';\r\nimport Booking from '@/models/Booking';\r\nimport User from '@/models/User';\r\nimport { getTenantIdFromRequest } from '@/lib/api-tenant';\r\nimport { requireRole, getCurrentUser } from '@/lib/auth';\r\nimport { createAuditLog, AuditActions } from '@/lib/audit';\r\nimport { sendBookingConfirmation } from '@/lib/notifications';\r\nimport { getTenantSettingsById } from '@/lib/tenant';\r\nimport { getValidationTranslatorFromRequest } from '@/lib/validation-translations';\r\nimport { checkFeatureAccess } from '@/lib/subscription';\r\n\r\n/**\r\n * GET - Get all bookings for a tenant\r\n * Query params:\r\n * - startDate: ISO date string (optional)\r\n * - endDate: ISO date string (optional)\r\n * - status: booking status (optional)\r\n * - staffId: filter by staff member (optional)\r\n */\r\nexport async function GET(request: NextRequest) {\r\n  try {\r\n    await connectDB();\r\n    const user = await getCurrentUser(request);\r\n    if (!user) {\r\n      return NextResponse.json(\r\n        { success: false, error: 'Unauthorized' },\r\n        { status: 401 }\r\n      );\r\n    }\r\n\r\n    const tenantId = await getTenantIdFromRequest(request);\r\n    if (!tenantId) {\r\n      return NextResponse.json(\r\n        { success: false, error: 'Tenant not found' },\r\n        { status: 404 }\r\n      );\r\n    }\r\n\r\n    const { searchParams } = new URL(request.url);\r\n    const startDate = searchParams.get('startDate');\r\n    const endDate = searchParams.get('endDate');\r\n    const status = searchParams.get('status');\r\n    const staffId = searchParams.get('staffId');\r\n\r\n    // Build query\r\n    const query: any = { tenantId };\r\n\r\n    if (startDate || endDate) {\r\n      query.startTime = {};\r\n      if (startDate) {\r\n        query.startTime.$gte = new Date(startDate);\r\n      }\r\n      if (endDate) {\r\n        query.startTime.$lte = new Date(endDate);\r\n      }\r\n    }\r\n\r\n    if (status) {\r\n      query.status = status;\r\n    }\r\n\r\n    if (staffId) {\r\n      query.staffId = staffId;\r\n    }\r\n\r\n    const bookings = await Booking.find(query)\r\n      .populate('staffId', 'name email')\r\n      .sort({ startTime: 1 })\r\n      .lean();\r\n\r\n    return NextResponse.json({ success: true, data: bookings });\r\n  } catch (error: any) {\r\n    console.error('Get bookings error:', error);\r\n    return NextResponse.json(\r\n      { success: false, error: error.message || 'Failed to fetch bookings' },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n\r\n/**\r\n * POST - Create a new booking\r\n */\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    await connectDB();\r\n    const t = await getValidationTranslatorFromRequest(request);\r\n    \r\n    // Allow cashiers and above OR authenticated customers to create bookings\r\n    let tenantId: string | null = null;\r\n    let isCustomer = false;\r\n    let customerAuth: any = null;\r\n    \r\n    try {\r\n      // Try customer authentication first\r\n      const { requireCustomerAuth } = await import('@/lib/auth-customer');\r\n      customerAuth = await requireCustomerAuth(request);\r\n      tenantId = customerAuth.tenantId;\r\n      isCustomer = true;\r\n    } catch {\r\n      // Fall back to staff authentication\r\n      const user = await getCurrentUser(request);\r\n      if (!user) {\r\n        return NextResponse.json(\r\n          { success: false, error: t('validation.unauthorized', 'Unauthorized') },\r\n          { status: 401 }\r\n        );\r\n      }\r\n      await requireRole(request, ['owner', 'admin', 'manager', 'cashier']);\r\n      tenantId = await getTenantIdFromRequest(request);\r\n    }\r\n    \r\n    if (!tenantId) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.tenantNotFound', 'Tenant not found') },\r\n        { status: 404 }\r\n      );\r\n    }\r\n\r\n    // Check if booking scheduling feature is enabled in subscription\r\n    try {\r\n      await checkFeatureAccess(tenantId.toString(), 'enableBookingScheduling');\r\n    } catch (featureError: any) {\r\n      return NextResponse.json(\r\n        { success: false, error: featureError.message },\r\n        { status: 403 }\r\n      );\r\n    }\r\n\r\n    const body = await request.json();\r\n    const {\r\n      serviceName,\r\n      serviceDescription,\r\n      startTime,\r\n      duration,\r\n      staffId,\r\n      notes,\r\n      status = 'pending',\r\n    } = body;\r\n    let {\r\n      customerName,\r\n      customerEmail,\r\n      customerPhone,\r\n    } = body;\r\n\r\n    // If customer is authenticated, use their information\r\n    if (isCustomer && customerAuth) {\r\n      const Customer = (await import('@/models/Customer')).default;\r\n      const customer = await Customer.findById(customerAuth.customerId).lean();\r\n      if (customer) {\r\n        customerName = customerName || `${customer.firstName} ${customer.lastName}`;\r\n        customerEmail = customerEmail || customer.email;\r\n        customerPhone = customerPhone || customer.phone;\r\n      }\r\n    }\r\n\r\n    // Validation\r\n    if (!customerName || !serviceName || !startTime || !duration) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.bookingFieldsRequired', 'Customer name, service name, start time, and duration are required') },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    const start = new Date(startTime);\r\n    const end = new Date(start.getTime() + duration * 60000);\r\n\r\n    // Check for conflicts with existing bookings\r\n    const conflictingBookings = await Booking.find({\r\n      tenantId,\r\n      status: { $in: ['pending', 'confirmed'] },\r\n      $or: [\r\n        {\r\n          startTime: { $lt: end },\r\n          endTime: { $gt: start },\r\n        },\r\n      ],\r\n    });\r\n\r\n    // If staff is assigned, check for conflicts with that staff member\r\n    if (staffId) {\r\n      const staffConflicts = conflictingBookings.filter(\r\n        (booking) => booking.staffId?.toString() === staffId\r\n      );\r\n      if (staffConflicts.length > 0) {\r\n        return NextResponse.json(\r\n          {\r\n            success: false,\r\n            error: t('validation.staffBookingConflict', 'Staff member already has a booking at this time'),\r\n            conflicts: staffConflicts,\r\n          },\r\n          { status: 409 }\r\n        );\r\n      }\r\n    } else {\r\n      // If no staff assigned, check for any conflicts\r\n      if (conflictingBookings.length > 0) {\r\n        return NextResponse.json(\r\n          {\r\n            success: false,\r\n            error: t('validation.timeSlotBooked', 'Time slot is already booked'),\r\n            conflicts: conflictingBookings,\r\n          },\r\n          { status: 409 }\r\n        );\r\n      }\r\n    }\r\n\r\n    // Verify staff exists if provided (only for staff-created bookings, not customer bookings)\r\n    if (staffId && !isCustomer) {\r\n      const staff = await User.findOne({ _id: staffId, tenantId, isActive: true });\r\n      if (!staff) {\r\n        return NextResponse.json(\r\n          { success: false, error: t('validation.staffNotFound', 'Staff member not found or inactive') },\r\n          { status: 404 }\r\n        );\r\n      }\r\n    }\r\n\r\n    // Create booking\r\n    const booking = await Booking.create({\r\n      tenantId,\r\n      customerName,\r\n      customerEmail,\r\n      customerPhone,\r\n      serviceName,\r\n      serviceDescription,\r\n      startTime: start,\r\n      endTime: end,\r\n      duration,\r\n      staffId,\r\n      notes,\r\n      status,\r\n    });\r\n\r\n    // Send confirmation if status is confirmed and contact info is provided\r\n    if (status === 'confirmed' && (customerEmail || customerPhone)) {\r\n      try {\r\n        const tenantSettings = await getTenantSettingsById(tenantId);\r\n        await sendBookingConfirmation({\r\n          customerName,\r\n          customerEmail,\r\n          customerPhone,\r\n          serviceName,\r\n          startTime: start,\r\n          endTime: end,\r\n          staffName: booking.staffName,\r\n          notes,\r\n          bookingId: booking._id.toString(),\r\n        }, tenantSettings || undefined);\r\n        await Booking.findByIdAndUpdate(booking._id, { confirmationSent: true });\r\n      } catch (notificationError) {\r\n        console.error('Failed to send booking confirmation:', notificationError);\r\n        // Don't fail the booking creation if notification fails\r\n      }\r\n    }\r\n\r\n    await createAuditLog(request, {\r\n      tenantId,\r\n      action: AuditActions.CREATE,\r\n      entityType: 'booking',\r\n      entityId: booking._id.toString(),\r\n      changes: {\r\n        customerName,\r\n        serviceName,\r\n        startTime: start.toISOString(),\r\n        status,\r\n      },\r\n    });\r\n\r\n    const bookingData = await Booking.findById(booking._id)\r\n      .populate('staffId', 'name email')\r\n      .lean();\r\n\r\n    return NextResponse.json(\r\n      { success: true, data: bookingData },\r\n      { status: 201 }\r\n    );\r\n  } catch (error: any) {\r\n    console.error('Create booking error:', error);\r\n    const t = await getValidationTranslatorFromRequest(request);\r\n    if (error.code === 11000) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.bookingExists', 'Booking already exists') },\r\n        { status: 400 }\r\n      );\r\n    }\r\n    return NextResponse.json(\r\n      { success: false, error: error.message || t('validation.failedToCreateBooking', 'Failed to create booking') },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\bookings\\time-slots\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":60,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":60,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2258,2261],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2258,2261],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":114,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":114,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3914,3917],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3914,3917],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\nimport connectDB from '@/lib/mongodb';\r\nimport Booking from '@/models/Booking';\r\nimport { getTenantIdFromRequest } from '@/lib/api-tenant';\r\nimport { getCurrentUser } from '@/lib/auth';\r\nimport { getValidationTranslatorFromRequest } from '@/lib/validation-translations';\r\n\r\n/**\r\n * GET - Get available time slots for a given date\r\n * Query params:\r\n * - date: ISO date string (required)\r\n * - staffId: filter by staff member (optional)\r\n * - duration: duration in minutes (optional, default: 60)\r\n * - slotInterval: interval between slots in minutes (optional, default: 30)\r\n * - startHour: start hour (optional, default: 9)\r\n * - endHour: end hour (optional, default: 17)\r\n */\r\nexport async function GET(request: NextRequest) {\r\n  try {\r\n    await connectDB();\r\n    const user = await getCurrentUser(request);\r\n    const t = await getValidationTranslatorFromRequest(request);\r\n    if (!user) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.unauthorized', 'Unauthorized') },\r\n        { status: 401 }\r\n      );\r\n    }\r\n\r\n    const tenantId = await getTenantIdFromRequest(request);\r\n    if (!tenantId) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.tenantNotFound', 'Tenant not found') },\r\n        { status: 404 }\r\n      );\r\n    }\r\n\r\n    const { searchParams } = new URL(request.url);\r\n    const dateParam = searchParams.get('date');\r\n    const staffId = searchParams.get('staffId');\r\n    const duration = parseInt(searchParams.get('duration') || '60', 10);\r\n    const slotInterval = parseInt(searchParams.get('slotInterval') || '30', 10);\r\n    const startHour = parseInt(searchParams.get('startHour') || '9', 10);\r\n    const endHour = parseInt(searchParams.get('endHour') || '17', 10);\r\n\r\n    if (!dateParam) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.dateParameterRequired', 'Date parameter is required') },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    const selectedDate = new Date(dateParam);\r\n    selectedDate.setHours(0, 0, 0, 0);\r\n\r\n    const endDate = new Date(selectedDate);\r\n    endDate.setHours(23, 59, 59, 999);\r\n\r\n    // Get existing bookings for the date\r\n    const query: any = {\r\n      tenantId,\r\n      startTime: { $gte: selectedDate, $lte: endDate },\r\n      status: { $in: ['pending', 'confirmed'] },\r\n    };\r\n\r\n    if (staffId) {\r\n      query.staffId = staffId;\r\n    }\r\n\r\n    const existingBookings = await Booking.find(query).lean();\r\n\r\n    // Generate time slots\r\n    const slots: Array<{ time: string; available: boolean; bookingId?: string }> = [];\r\n    const startTime = new Date(selectedDate);\r\n    startTime.setHours(startHour, 0, 0, 0);\r\n\r\n    const endTime = new Date(selectedDate);\r\n    endTime.setHours(endHour, 0, 0, 0);\r\n\r\n    let currentSlot = new Date(startTime);\r\n\r\n    while (currentSlot < endTime) {\r\n      const slotEnd = new Date(currentSlot.getTime() + duration * 60000);\r\n      \r\n      // Check if slot conflicts with existing bookings\r\n      const conflict = existingBookings.find((booking) => {\r\n        const bookingStart = new Date(booking.startTime);\r\n        const bookingEnd = new Date(booking.endTime);\r\n        return (\r\n          (currentSlot >= bookingStart && currentSlot < bookingEnd) ||\r\n          (slotEnd > bookingStart && slotEnd <= bookingEnd) ||\r\n          (currentSlot <= bookingStart && slotEnd >= bookingEnd)\r\n        );\r\n      });\r\n\r\n      slots.push({\r\n        time: currentSlot.toISOString(),\r\n        available: !conflict,\r\n        bookingId: conflict?._id.toString(),\r\n      });\r\n\r\n      currentSlot = new Date(currentSlot.getTime() + slotInterval * 60000);\r\n    }\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      data: {\r\n        date: selectedDate.toISOString(),\r\n        slots,\r\n        duration,\r\n        slotInterval,\r\n      },\r\n    });\r\n  } catch (error: any) {\r\n    console.error('Get time slots error:', error);\r\n    const t = await getValidationTranslatorFromRequest(request);\r\n    return NextResponse.json(\r\n      { success: false, error: error.message || t('validation.failedToFetchTimeSlots', 'Failed to fetch time slots') },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\branches\\[id]\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":33,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":33,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1252,1255],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1252,1255],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":82,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":82,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2882,2885],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2882,2885],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":128,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":128,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4496,4499],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4496,4499],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\nimport connectDB from '@/lib/mongodb';\r\nimport Branch from '@/models/Branch';\r\nimport { getTenantIdFromRequest } from '@/lib/api-tenant';\r\nimport { requireAuth } from '@/lib/auth';\r\nimport { createAuditLog, AuditActions } from '@/lib/audit';\r\nimport { getValidationTranslatorFromRequest } from '@/lib/validation-translations';\r\n\r\nexport async function GET(\r\n  request: NextRequest,\r\n  { params }: { params: Promise<{ id: string }> }\r\n) {\r\n  try {\r\n    await connectDB();\r\n    await requireAuth(request);\r\n    const tenantId = await getTenantIdFromRequest(request);\r\n    const { id } = await params;\r\n    const t = await getValidationTranslatorFromRequest(request);\r\n\r\n    if (!tenantId) {\r\n      return NextResponse.json({ success: false, error: t('validation.tenantNotFound', 'Tenant not found') }, { status: 404 });\r\n    }\r\n\r\n    const branch = await Branch.findOne({ _id: id, tenantId })\r\n      .populate('managerId', 'name email')\r\n      .lean();\r\n\r\n    if (!branch) {\r\n      return NextResponse.json({ success: false, error: t('validation.branchNotFound', 'Branch not found') }, { status: 404 });\r\n    }\r\n\r\n    return NextResponse.json({ success: true, data: branch });\r\n  } catch (error: any) {\r\n    console.error('Error fetching branch:', error);\r\n    return NextResponse.json({ success: false, error: error.message }, { status: 500 });\r\n  }\r\n}\r\n\r\nexport async function PUT(\r\n  request: NextRequest,\r\n  { params }: { params: Promise<{ id: string }> }\r\n) {\r\n  try {\r\n    await connectDB();\r\n    await requireAuth(request);\r\n    const tenantId = await getTenantIdFromRequest(request);\r\n    const { id } = await params;\r\n\r\n    if (!tenantId) {\r\n      return NextResponse.json({ success: false, error: 'Tenant not found' }, { status: 404 });\r\n    }\r\n\r\n    const branch = await Branch.findOne({ _id: id, tenantId });\r\n    if (!branch) {\r\n      return NextResponse.json({ success: false, error: 'Branch not found' }, { status: 404 });\r\n    }\r\n\r\n    const body = await request.json();\r\n    const { name, code, address, phone, email, managerId, isActive } = body;\r\n\r\n    const oldData = branch.toObject();\r\n\r\n    if (name) branch.name = name;\r\n    if (code !== undefined) branch.code = code;\r\n    if (address !== undefined) branch.address = address;\r\n    if (phone !== undefined) branch.phone = phone;\r\n    if (email !== undefined) branch.email = email;\r\n    if (managerId !== undefined) branch.managerId = managerId;\r\n    if (isActive !== undefined) branch.isActive = isActive;\r\n\r\n    await branch.save();\r\n\r\n    await createAuditLog(request, {\r\n      tenantId,\r\n      action: AuditActions.UPDATE,\r\n      entityType: 'branch',\r\n      entityId: branch._id.toString(),\r\n      changes: { before: oldData, after: branch.toObject() },\r\n    });\r\n\r\n    return NextResponse.json({ success: true, data: branch });\r\n  } catch (error: any) {\r\n    const t = await getValidationTranslatorFromRequest(request);\r\n    if (error.code === 11000) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.branchCodeExists', 'Branch with this code already exists') },\r\n        { status: 400 }\r\n      );\r\n    }\r\n    console.error('Error updating branch:', error);\r\n    return NextResponse.json({ success: false, error: error.message }, { status: 400 });\r\n  }\r\n}\r\n\r\nexport async function DELETE(\r\n  request: NextRequest,\r\n  { params }: { params: Promise<{ id: string }> }\r\n) {\r\n  try {\r\n    await connectDB();\r\n    await requireAuth(request);\r\n    const tenantId = await getTenantIdFromRequest(request);\r\n    const { id } = await params;\r\n    const t = await getValidationTranslatorFromRequest(request);\r\n\r\n    if (!tenantId) {\r\n      return NextResponse.json({ success: false, error: t('validation.tenantNotFound', 'Tenant not found') }, { status: 404 });\r\n    }\r\n\r\n    const branch = await Branch.findOne({ _id: id, tenantId });\r\n    if (!branch) {\r\n      return NextResponse.json({ success: false, error: t('validation.branchNotFound', 'Branch not found') }, { status: 404 });\r\n    }\r\n\r\n    // Soft delete - set isActive to false\r\n    branch.isActive = false;\r\n    await branch.save();\r\n\r\n    await createAuditLog(request, {\r\n      tenantId,\r\n      action: AuditActions.DELETE,\r\n      entityType: 'branch',\r\n      entityId: branch._id.toString(),\r\n      changes: { name: branch.name },\r\n    });\r\n\r\n    return NextResponse.json({ success: true, message: t('validation.branchDeactivated', 'Branch deactivated') });\r\n  } catch (error: any) {\r\n    console.error('Error deleting branch:', error);\r\n    return NextResponse.json({ success: false, error: error.message }, { status: 500 });\r\n  }\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\branches\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":23,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":23,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[906,909],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[906,909],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":34,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":34,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1230,1233],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1230,1233],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":62,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":62,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2331,2334],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2331,2334],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":99,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":99,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3276,3279],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3276,3279],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\nimport connectDB from '@/lib/mongodb';\r\nimport Branch from '@/models/Branch';\r\nimport { getTenantIdFromRequest } from '@/lib/api-tenant';\r\nimport { requireAuth } from '@/lib/auth';\r\nimport { createAuditLog, AuditActions } from '@/lib/audit';\r\nimport { getValidationTranslatorFromRequest } from '@/lib/validation-translations';\r\nimport { checkSubscriptionLimit, SubscriptionService } from '@/lib/subscription';\r\n\r\nexport async function GET(request: NextRequest) {\r\n  try {\r\n    await connectDB();\r\n    await requireAuth(request);\r\n    const tenantId = await getTenantIdFromRequest(request);\r\n\r\n    if (!tenantId) {\r\n      return NextResponse.json({ success: false, error: 'Tenant not found' }, { status: 404 });\r\n    }\r\n\r\n    const searchParams = request.nextUrl.searchParams;\r\n    const isActive = searchParams.get('isActive');\r\n\r\n    const query: any = { tenantId };\r\n    if (isActive !== null) {\r\n      query.isActive = isActive === 'true';\r\n    }\r\n\r\n    const branches = await Branch.find(query)\r\n      .populate('managerId', 'name email')\r\n      .sort({ name: 1 })\r\n      .lean();\r\n\r\n    return NextResponse.json({ success: true, data: branches });\r\n  } catch (error: any) {\r\n    console.error('Error fetching branches:', error);\r\n    return NextResponse.json({ success: false, error: error.message }, { status: 500 });\r\n  }\r\n}\r\n\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    await connectDB();\r\n    await requireAuth(request);\r\n    const tenantId = await getTenantIdFromRequest(request);\r\n    const t = await getValidationTranslatorFromRequest(request);\r\n\r\n    if (!tenantId) {\r\n      return NextResponse.json({ success: false, error: t('validation.tenantNotFound', 'Tenant not found') }, { status: 404 });\r\n    }\r\n\r\n    const body = await request.json();\r\n    const { name, code, address, phone, email, managerId } = body;\r\n\r\n    if (!name) {\r\n      return NextResponse.json({ success: false, error: t('validation.branchNameRequired', 'Branch name is required') }, { status: 400 });\r\n    }\r\n\r\n    // Check subscription limits\r\n    const currentBranchCount = await Branch.countDocuments({ tenantId, isActive: true });\r\n    try {\r\n      await checkSubscriptionLimit(tenantId.toString(), 'maxBranches', currentBranchCount);\r\n    } catch (limitError: any) {\r\n      return NextResponse.json(\r\n        { success: false, error: limitError.message },\r\n        { status: 403 }\r\n      );\r\n    }\r\n\r\n    const branch = await Branch.create({\r\n      tenantId,\r\n      name,\r\n      code,\r\n      address,\r\n      phone,\r\n      email,\r\n      managerId,\r\n      isActive: true,\r\n    });\r\n\r\n    await createAuditLog(request, {\r\n      tenantId,\r\n      action: AuditActions.CREATE,\r\n      entityType: 'branch',\r\n      entityId: branch._id.toString(),\r\n      changes: body,\r\n    });\r\n\r\n    // Update subscription usage\r\n    try {\r\n      await SubscriptionService.updateUsage(tenantId.toString(), {\r\n        branches: currentBranchCount + 1\r\n      });\r\n    } catch (usageError) {\r\n      console.error('Failed to update subscription usage:', usageError);\r\n      // Don't fail the request if usage update fails\r\n    }\r\n\r\n    return NextResponse.json({ success: true, data: branch }, { status: 201 });\r\n  } catch (error: any) {\r\n    const t = await getValidationTranslatorFromRequest(request);\r\n    if (error.code === 11000) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.branchCodeExists', 'Branch with this code already exists') },\r\n        { status: 400 }\r\n      );\r\n    }\r\n    console.error('Error creating branch:', error);\r\n    return NextResponse.json({ success: false, error: error.message }, { status: 400 });\r\n  }\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\bundles\\[id]\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":33,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":33,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1291,1294],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1291,1294],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":82,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":82,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3067,3070],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3067,3070],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":128,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":128,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4686,4689],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4686,4689],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\nimport connectDB from '@/lib/mongodb';\r\nimport ProductBundle from '@/models/ProductBundle';\r\nimport { getTenantIdFromRequest } from '@/lib/api-tenant';\r\nimport { requireAuth } from '@/lib/auth';\r\nimport { createAuditLog, AuditActions } from '@/lib/audit';\r\nimport { getValidationTranslatorFromRequest } from '@/lib/validation-translations';\r\n\r\nexport async function GET(\r\n  request: NextRequest,\r\n  { params }: { params: Promise<{ id: string }> }\r\n) {\r\n  try {\r\n    await connectDB();\r\n    const tenantId = await getTenantIdFromRequest(request);\r\n    const { id } = await params;\r\n    const t = await getValidationTranslatorFromRequest(request);\r\n\r\n    if (!tenantId) {\r\n      return NextResponse.json({ success: false, error: t('validation.tenantNotFound', 'Tenant not found') }, { status: 404 });\r\n    }\r\n\r\n    const bundle = await ProductBundle.findOne({ _id: id, tenantId })\r\n      .populate('items.productId', 'name price stock')\r\n      .populate('categoryId', 'name')\r\n      .lean();\r\n\r\n    if (!bundle) {\r\n      return NextResponse.json({ success: false, error: t('validation.bundleNotFound', 'Bundle not found') }, { status: 404 });\r\n    }\r\n\r\n    return NextResponse.json({ success: true, data: bundle });\r\n  } catch (error: any) {\r\n    console.error('Error fetching bundle:', error);\r\n    return NextResponse.json({ success: false, error: error.message }, { status: 500 });\r\n  }\r\n}\r\n\r\nexport async function PUT(\r\n  request: NextRequest,\r\n  { params }: { params: Promise<{ id: string }> }\r\n) {\r\n  try {\r\n    await connectDB();\r\n    await requireAuth(request);\r\n    const tenantId = await getTenantIdFromRequest(request);\r\n    const { id } = await params;\r\n\r\n    if (!tenantId) {\r\n      return NextResponse.json({ success: false, error: 'Tenant not found' }, { status: 404 });\r\n    }\r\n\r\n    const bundle = await ProductBundle.findOne({ _id: id, tenantId });\r\n    if (!bundle) {\r\n      return NextResponse.json({ success: false, error: 'Bundle not found' }, { status: 404 });\r\n    }\r\n\r\n    const body = await request.json();\r\n    const oldData = bundle.toObject();\r\n\r\n    if (body.name) bundle.name = body.name;\r\n    if (body.description !== undefined) bundle.description = body.description;\r\n    if (body.price !== undefined) bundle.price = body.price;\r\n    if (body.items) bundle.items = body.items;\r\n    if (body.sku !== undefined) bundle.sku = body.sku;\r\n    if (body.categoryId !== undefined) bundle.categoryId = body.categoryId;\r\n    if (body.image !== undefined) bundle.image = body.image;\r\n    if (body.trackInventory !== undefined) bundle.trackInventory = body.trackInventory;\r\n    if (body.isActive !== undefined) bundle.isActive = body.isActive;\r\n\r\n    await bundle.save();\r\n\r\n    await createAuditLog(request, {\r\n      tenantId,\r\n      action: AuditActions.UPDATE,\r\n      entityType: 'bundle',\r\n      entityId: bundle._id.toString(),\r\n      changes: { before: oldData, after: bundle.toObject() },\r\n    });\r\n\r\n    return NextResponse.json({ success: true, data: bundle });\r\n  } catch (error: any) {\r\n    const t = await getValidationTranslatorFromRequest(request);\r\n    if (error.code === 11000) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.bundleSkuExists', 'Bundle with this SKU already exists') },\r\n        { status: 400 }\r\n      );\r\n    }\r\n    console.error('Error updating bundle:', error);\r\n    return NextResponse.json({ success: false, error: error.message }, { status: 400 });\r\n  }\r\n}\r\n\r\nexport async function DELETE(\r\n  request: NextRequest,\r\n  { params }: { params: Promise<{ id: string }> }\r\n) {\r\n  try {\r\n    await connectDB();\r\n    await requireAuth(request);\r\n    const tenantId = await getTenantIdFromRequest(request);\r\n    const { id } = await params;\r\n    const t = await getValidationTranslatorFromRequest(request);\r\n\r\n    if (!tenantId) {\r\n      return NextResponse.json({ success: false, error: t('validation.tenantNotFound', 'Tenant not found') }, { status: 404 });\r\n    }\r\n\r\n    const bundle = await ProductBundle.findOne({ _id: id, tenantId });\r\n    if (!bundle) {\r\n      return NextResponse.json({ success: false, error: t('validation.bundleNotFound', 'Bundle not found') }, { status: 404 });\r\n    }\r\n\r\n    // Soft delete - set isActive to false\r\n    bundle.isActive = false;\r\n    await bundle.save();\r\n\r\n    await createAuditLog(request, {\r\n      tenantId,\r\n      action: AuditActions.DELETE,\r\n      entityType: 'bundle',\r\n      entityId: bundle._id.toString(),\r\n      changes: { name: bundle.name },\r\n    });\r\n\r\n    return NextResponse.json({ success: true, message: t('validation.bundleDeactivated', 'Bundle deactivated') });\r\n  } catch (error: any) {\r\n    console.error('Error deleting bundle:', error);\r\n    return NextResponse.json({ success: false, error: error.message }, { status: 500 });\r\n  }\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\bundles\\analytics\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":25,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":25,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[860,863],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[860,863],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":34,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":34,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1138,1141],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1138,1141],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":44,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":44,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1454,1457],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1454,1457],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":58,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":58,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1956,1959],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1956,1959],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":60,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":60,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2075,2078],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2075,2078],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":96,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":96,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3335,3338],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3335,3338],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":96,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":96,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3352,3355],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3352,3355],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'item' is defined but never used. Allowed unused args must match /^_/u.","line":97,"column":19,"nodeType":null,"messageId":"unusedVar","endLine":97,"endColumn":23},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":97,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":97,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3392,3395],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3392,3395],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":113,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":113,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3708,3711],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3708,3711],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":10,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\nimport connectDB from '@/lib/mongodb';\r\nimport ProductBundle from '@/models/ProductBundle';\r\nimport Transaction from '@/models/Transaction';\r\nimport { getTenantIdFromRequest } from '@/lib/api-tenant';\r\n\r\n/**\r\n * Get bundle analytics - sales performance metrics\r\n */\r\nexport async function GET(request: NextRequest) {\r\n  try {\r\n    await connectDB();\r\n    const tenantId = await getTenantIdFromRequest(request);\r\n\r\n    if (!tenantId) {\r\n      return NextResponse.json({ success: false, error: 'Tenant not found' }, { status: 404 });\r\n    }\r\n\r\n    const searchParams = request.nextUrl.searchParams;\r\n    const startDate = searchParams.get('startDate');\r\n    const endDate = searchParams.get('endDate');\r\n    const bundleId = searchParams.get('bundleId');\r\n\r\n    // Build date query\r\n    const dateQuery: any = {};\r\n    if (startDate) dateQuery.$gte = new Date(startDate);\r\n    if (endDate) {\r\n      const end = new Date(endDate);\r\n      end.setHours(23, 59, 59, 999);\r\n      dateQuery.$lte = end;\r\n    }\r\n\r\n    // Get all transactions in the date range\r\n    const transactionQuery: any = { tenantId, status: 'completed' };\r\n    if (Object.keys(dateQuery).length > 0) {\r\n      transactionQuery.createdAt = dateQuery;\r\n    }\r\n\r\n    const transactions = await Transaction.find(transactionQuery)\r\n      .select('items createdAt total')\r\n      .lean();\r\n\r\n    // Get all bundles\r\n    const bundleQuery: any = { tenantId };\r\n    if (bundleId) bundleQuery._id = bundleId;\r\n    const bundles = await ProductBundle.find(bundleQuery)\r\n      .select('_id name price')\r\n      .lean();\r\n\r\n    // Calculate analytics for each bundle\r\n    const analytics = bundles.map(bundle => {\r\n      let totalSales = 0;\r\n      let totalQuantity = 0;\r\n      let transactionCount = 0;\r\n\r\n      // Filter transactions that include this bundle\r\n      transactions.forEach(transaction => {\r\n        transaction.items.forEach((item: any) => {\r\n          // Check if item has bundleId (stored but not in schema)\r\n          const itemBundleId = (item as any).bundleId;\r\n          if (itemBundleId && itemBundleId.toString() === bundle._id.toString()) {\r\n            totalSales += item.subtotal;\r\n            totalQuantity += item.quantity;\r\n            transactionCount++;\r\n          }\r\n        });\r\n      });\r\n\r\n      const averageOrderValue = transactionCount > 0 ? totalSales / transactionCount : 0;\r\n      const averageQuantity = transactionCount > 0 ? totalQuantity / transactionCount : 0;\r\n\r\n      return {\r\n        bundleId: bundle._id,\r\n        bundleName: bundle.name,\r\n        bundlePrice: bundle.price,\r\n        totalSales,\r\n        totalQuantity,\r\n        transactionCount,\r\n        averageOrderValue,\r\n        averageQuantity,\r\n        revenuePerUnit: totalQuantity > 0 ? totalSales / totalQuantity : bundle.price,\r\n      };\r\n    });\r\n\r\n    // Sort by total sales descending\r\n    analytics.sort((a, b) => b.totalSales - a.totalSales);\r\n\r\n    // Calculate overall summary\r\n    const summary = {\r\n      totalBundles: analytics.length,\r\n      totalSales: analytics.reduce((sum, a) => sum + a.totalSales, 0),\r\n      totalQuantity: analytics.reduce((sum, a) => sum + a.totalQuantity, 0),\r\n      totalTransactions: new Set(\r\n        transactions.flatMap(t => \r\n          t.items\r\n            .filter((item: any) => (item as any).bundleId)\r\n            .map((item: any) => t._id.toString())\r\n        )\r\n      ).size,\r\n    };\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      data: {\r\n        analytics,\r\n        summary,\r\n        period: {\r\n          startDate: startDate || null,\r\n          endDate: endDate || null,\r\n        },\r\n      },\r\n    });\r\n  } catch (error: any) {\r\n    console.error('Error fetching bundle analytics:', error);\r\n    return NextResponse.json({ success: false, error: error.message }, { status: 500 });\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\bundles\\bulk\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":63,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":63,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1899,1902],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1899,1902],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\nimport connectDB from '@/lib/mongodb';\r\nimport ProductBundle from '@/models/ProductBundle';\r\nimport { getTenantIdFromRequest } from '@/lib/api-tenant';\r\nimport { requireAuth } from '@/lib/auth';\r\nimport { createAuditLog, AuditActions } from '@/lib/audit';\r\n\r\n/**\r\n * Bulk operations for bundles (activate/deactivate)\r\n */\r\nexport async function PUT(request: NextRequest) {\r\n  try {\r\n    await connectDB();\r\n    await requireAuth(request);\r\n    const tenantId = await getTenantIdFromRequest(request);\r\n\r\n    if (!tenantId) {\r\n      return NextResponse.json({ success: false, error: 'Tenant not found' }, { status: 404 });\r\n    }\r\n\r\n    const body = await request.json();\r\n    const { bundleIds, action } = body;\r\n\r\n    if (!bundleIds || !Array.isArray(bundleIds) || bundleIds.length === 0) {\r\n      return NextResponse.json(\r\n        { success: false, error: 'Bundle IDs array is required' },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    if (!['activate', 'deactivate'].includes(action)) {\r\n      return NextResponse.json(\r\n        { success: false, error: 'Action must be \"activate\" or \"deactivate\"' },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    const isActive = action === 'activate';\r\n\r\n    const result = await ProductBundle.updateMany(\r\n      { _id: { $in: bundleIds }, tenantId },\r\n      { $set: { isActive } }\r\n    );\r\n\r\n    // Create audit log for bulk operation\r\n    await createAuditLog(request, {\r\n      tenantId,\r\n      action: AuditActions.UPDATE,\r\n      entityType: 'bundle',\r\n      entityId: 'bulk',\r\n      changes: {\r\n        bundleIds,\r\n        action,\r\n        count: result.modifiedCount,\r\n      },\r\n    });\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      message: `${result.modifiedCount} bundle(s) ${action}d successfully`,\r\n      modifiedCount: result.modifiedCount,\r\n    });\r\n  } catch (error: any) {\r\n    console.error('Error in bulk bundle operation:', error);\r\n    return NextResponse.json({ success: false, error: error.message }, { status: 500 });\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\bundles\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":28,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":28,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1220,1223],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1220,1223],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\nimport connectDB from '@/lib/mongodb';\r\nimport ProductBundle from '@/models/ProductBundle';\r\nimport { getTenantIdFromRequest } from '@/lib/api-tenant';\r\nimport { requireAuth } from '@/lib/auth';\r\nimport { createAuditLog, AuditActions } from '@/lib/audit';\r\nimport { getValidationTranslatorFromRequest } from '@/lib/validation-translations';\r\n\r\nexport async function GET(request: NextRequest) {\r\n  try {\r\n    await connectDB();\r\n    const tenantId = await getTenantIdFromRequest(request);\r\n    const t = await getValidationTranslatorFromRequest(request);\r\n\r\n    if (!tenantId) {\r\n      return NextResponse.json({ success: false, error: t('validation.tenantNotFound', 'Tenant not found') }, { status: 404 });\r\n    }\r\n\r\n    const searchParams = request.nextUrl.searchParams;\r\n    const search = searchParams.get('search') || '';\r\n    const isActive = searchParams.get('isActive');\r\n    const categoryId = searchParams.get('categoryId');\r\n    const minPrice = searchParams.get('minPrice');\r\n    const maxPrice = searchParams.get('maxPrice');\r\n    const startDate = searchParams.get('startDate');\r\n    const endDate = searchParams.get('endDate');\r\n\r\n    const query: any = { tenantId };\r\n    if (search) {\r\n      const escapedSearch = search.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&');\r\n      query.$or = [\r\n        { name: { $regex: escapedSearch, $options: 'i' } },\r\n        { description: { $regex: escapedSearch, $options: 'i' } },\r\n        { sku: { $regex: escapedSearch, $options: 'i' } },\r\n      ];\r\n    }\r\n    if (isActive !== null && isActive !== '') {\r\n      query.isActive = isActive === 'true';\r\n    }\r\n    if (categoryId) {\r\n      query.categoryId = categoryId;\r\n    }\r\n    if (minPrice || maxPrice) {\r\n      query.price = {};\r\n      if (minPrice) query.price.$gte = parseFloat(minPrice);\r\n      if (maxPrice) query.price.$lte = parseFloat(maxPrice);\r\n    }\r\n    if (startDate || endDate) {\r\n      query.createdAt = {};\r\n      if (startDate) query.createdAt.$gte = new Date(startDate);\r\n      if (endDate) {\r\n        const end = new Date(endDate);\r\n        end.setHours(23, 59, 59, 999);\r\n        query.createdAt.$lte = end;\r\n      }\r\n    }\r\n\r\n    const bundles = await ProductBundle.find(query)\r\n      .populate('items.productId', 'name price stock')\r\n      .populate('categoryId', 'name')\r\n      .sort({ createdAt: -1 })\r\n      .lean();\r\n\r\n    return NextResponse.json({ success: true, data: bundles });\r\n  } catch (_error: unknown) {\r\n    console.error('Error fetching bundles:', _error);\r\n    return NextResponse.json({ success: false, error: 'Failed to fetch bundles' }, { status: 500 });\r\n  }\r\n}\r\n\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    await connectDB();\r\n    await requireAuth(request);\r\n    const tenantId = await getTenantIdFromRequest(request);\r\n    const t = await getValidationTranslatorFromRequest(request);\r\n\r\n    if (!tenantId) {\r\n      return NextResponse.json({ success: false, error: t('validation.tenantNotFound', 'Tenant not found') }, { status: 404 });\r\n    }\r\n\r\n    const body = await request.json();\r\n    const { name, description, price, items, sku, categoryId, image, trackInventory } = body;\r\n\r\n    if (!name || !price || !items || items.length === 0) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.bundleFieldsRequired', 'Name, price, and at least one item are required') },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    const bundle = await ProductBundle.create({\r\n      tenantId,\r\n      name,\r\n      description,\r\n      price,\r\n      items,\r\n      sku,\r\n      categoryId,\r\n      image,\r\n      trackInventory: trackInventory !== false,\r\n      isActive: true,\r\n    });\r\n\r\n    await createAuditLog(request, {\r\n      tenantId,\r\n      action: AuditActions.CREATE,\r\n      entityType: 'bundle',\r\n      entityId: bundle._id.toString(),\r\n      changes: body,\r\n    });\r\n\r\n    return NextResponse.json({ success: true, data: bundle }, { status: 201 });\r\n  } catch (error: unknown) {\r\n    const t = await getValidationTranslatorFromRequest(request);\r\n    if ((error as Record<string, unknown>).code === 11000) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.bundleSkuExists', 'Bundle with this SKU already exists') },\r\n        { status: 400 }\r\n      );\r\n    }\r\n    console.error('Error creating bundle:', error);\r\n    return NextResponse.json({ success: false, error: 'Failed to create bundle' }, { status: 400 });\r\n  }\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\business-types\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":34,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":34,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1050,1053],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1050,1053],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\nimport { BUSINESS_TYPE_CONFIGS, BusinessType } from '@/lib/business-types';\r\n\r\n/**\r\n * GET /api/business-types\r\n * Get all available business types and their configurations\r\n */\r\nexport async function GET(request: NextRequest) {\r\n  try {\r\n    const searchParams = request.nextUrl.searchParams;\r\n    const type = searchParams.get('type') as BusinessType | null;\r\n\r\n    if (type && BUSINESS_TYPE_CONFIGS[type]) {\r\n      // Return specific business type\r\n      return NextResponse.json({\r\n        success: true,\r\n        data: BUSINESS_TYPE_CONFIGS[type],\r\n      });\r\n    }\r\n\r\n    // Return all business types\r\n    const businessTypes = Object.values(BUSINESS_TYPE_CONFIGS).map(config => ({\r\n      type: config.type,\r\n      name: config.name,\r\n      description: config.description,\r\n      defaultFeatures: config.defaultFeatures,\r\n      productTypes: config.productTypes,\r\n    }));\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      data: businessTypes,\r\n    });\r\n  } catch (error: any) {\r\n    return NextResponse.json(\r\n      { success: false, error: error.message },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\cash-drawer\\sessions\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":25,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":25,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1029,1032],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1029,1032],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":36,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":36,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1343,1346],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1343,1346],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":160,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":160,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5503,5506],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5503,5506],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\nimport connectDB from '@/lib/mongodb';\r\nimport CashDrawerSession from '@/models/CashDrawerSession';\r\nimport { getTenantIdFromRequest } from '@/lib/api-tenant';\r\nimport { requireAuth } from '@/lib/auth';\r\nimport { createAuditLog, AuditActions } from '@/lib/audit';\r\nimport Transaction from '@/models/Transaction';\r\nimport Expense from '@/models/Expense';\r\nimport { getValidationTranslatorFromRequest } from '@/lib/validation-translations';\r\n\r\nexport async function GET(request: NextRequest) {\r\n  try {\r\n    await connectDB();\r\n    await requireAuth(request);\r\n    const tenantId = await getTenantIdFromRequest(request);\r\n    const t = await getValidationTranslatorFromRequest(request);\r\n\r\n    if (!tenantId) {\r\n      return NextResponse.json({ success: false, error: t('validation.tenantNotFound', 'Tenant not found') }, { status: 404 });\r\n    }\r\n\r\n    const searchParams = request.nextUrl.searchParams;\r\n    const status = searchParams.get('status');\r\n\r\n    const query: any = { tenantId };\r\n    if (status) {\r\n      query.status = status;\r\n    }\r\n\r\n    const sessions = await CashDrawerSession.find(query)\r\n      .populate('userId', 'name email')\r\n      .sort({ openingTime: -1 })\r\n      .lean();\r\n\r\n    return NextResponse.json({ success: true, data: sessions });\r\n  } catch (error: any) {\r\n    console.error('Error fetching cash drawer sessions:', error);\r\n    return NextResponse.json({ success: false, error: error.message }, { status: 500 });\r\n  }\r\n}\r\n\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    await connectDB();\r\n    const user = await requireAuth(request);\r\n    const tenantId = await getTenantIdFromRequest(request);\r\n    const t = await getValidationTranslatorFromRequest(request);\r\n\r\n    if (!tenantId) {\r\n      return NextResponse.json({ success: false, error: t('validation.tenantNotFound', 'Tenant not found') }, { status: 404 });\r\n    }\r\n\r\n    const body = await request.json();\r\n    const { action, openingAmount, closingAmount, notes } = body;\r\n\r\n    if (action === 'open') {\r\n      // Check if there's an open session\r\n      const openSession = await CashDrawerSession.findOne({\r\n        tenantId,\r\n        status: 'open',\r\n      });\r\n\r\n      if (openSession) {\r\n        return NextResponse.json(\r\n          { success: false, error: t('validation.cashDrawerAlreadyOpen', 'There is already an open cash drawer session') },\r\n          { status: 400 }\r\n        );\r\n      }\r\n\r\n      const session = await CashDrawerSession.create({\r\n        tenantId,\r\n        userId: user.userId,\r\n        openingAmount: parseFloat(openingAmount || 0),\r\n        openingTime: new Date(),\r\n        status: 'open',\r\n        notes,\r\n      });\r\n\r\n      await createAuditLog(request, {\r\n        tenantId,\r\n        action: AuditActions.CREATE,\r\n        entityType: 'cashDrawerSession',\r\n        entityId: session._id.toString(),\r\n        changes: { action: 'open', openingAmount },\r\n      });\r\n\r\n      return NextResponse.json({ success: true, data: session }, { status: 201 });\r\n    } else if (action === 'close') {\r\n      const openSession = await CashDrawerSession.findOne({\r\n        tenantId,\r\n        status: 'open',\r\n      });\r\n\r\n      if (!openSession) {\r\n        return NextResponse.json(\r\n          { success: false, error: t('validation.noOpenCashDrawerSession', 'No open cash drawer session found') },\r\n          { status: 404 }\r\n        );\r\n      }\r\n\r\n      // Calculate expected amount\r\n      const sessionEnd = new Date();\r\n      const cashTransactions = await Transaction.find({\r\n        tenantId,\r\n        paymentMethod: 'cash',\r\n        createdAt: { $gte: openSession.openingTime, $lte: sessionEnd },\r\n        status: 'completed',\r\n      }).lean();\r\n\r\n      const cashSales = cashTransactions.reduce((sum, t) => sum + t.total, 0);\r\n\r\n      const cashExpenses = await Expense.find({\r\n        tenantId,\r\n        paymentMethod: 'cash',\r\n        date: { $gte: openSession.openingTime, $lte: sessionEnd },\r\n      }).lean();\r\n\r\n      const cashExpensesTotal = cashExpenses.reduce((sum, e) => sum + e.amount, 0);\r\n\r\n      const expectedAmount = openSession.openingAmount + cashSales - cashExpensesTotal;\r\n      const actualClosingAmount = parseFloat(closingAmount || 0);\r\n      const difference = actualClosingAmount - expectedAmount;\r\n\r\n      const shortage = difference < 0 ? Math.abs(difference) : undefined;\r\n      const overage = difference > 0 ? difference : undefined;\r\n\r\n      openSession.closingAmount = actualClosingAmount;\r\n      openSession.expectedAmount = expectedAmount;\r\n      openSession.shortage = shortage;\r\n      openSession.overage = overage;\r\n      openSession.closingTime = sessionEnd;\r\n      openSession.status = 'closed';\r\n      if (notes) {\r\n        openSession.notes = notes;\r\n      }\r\n\r\n      await openSession.save();\r\n\r\n      await createAuditLog(request, {\r\n        tenantId,\r\n        action: AuditActions.UPDATE,\r\n        entityType: 'cashDrawerSession',\r\n        entityId: openSession._id.toString(),\r\n        changes: {\r\n          action: 'close',\r\n          closingAmount: actualClosingAmount,\r\n          expectedAmount,\r\n          shortage,\r\n          overage,\r\n        },\r\n      });\r\n\r\n      return NextResponse.json({ success: true, data: openSession });\r\n    } else {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.invalidCashDrawerAction', 'Invalid action. Use \"open\" or \"close\"') },\r\n        { status: 400 }\r\n      );\r\n    }\r\n  } catch (error: any) {\r\n    console.error('Error managing cash drawer session:', error);\r\n    return NextResponse.json({ success: false, error: error.message }, { status: 400 });\r\n  }\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\categories\\[id]\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":30,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":30,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1126,1129],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1126,1129],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":82,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":82,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3015,3018],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3015,3018],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'oldData' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":113,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":113,"endColumn":18},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":126,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":126,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4375,4378],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4375,4378],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\nimport connectDB from '@/lib/mongodb';\r\nimport Category from '@/models/Category';\r\nimport { getTenantIdFromRequest } from '@/lib/api-tenant';\r\nimport { requireAuth } from '@/lib/auth';\r\nimport { createAuditLog, AuditActions } from '@/lib/audit';\r\nimport { validateAndSanitize, validateCategory } from '@/lib/validation';\r\nimport { getValidationTranslatorFromRequest } from '@/lib/validation-translations';\r\n\r\nexport async function GET(\r\n  request: NextRequest,\r\n  { params }: { params: Promise<{ id: string }> }\r\n) {\r\n  try {\r\n    await connectDB();\r\n    const tenantId = await getTenantIdFromRequest(request);\r\n    const { id } = await params;\r\n\r\n    if (!tenantId) {\r\n      return NextResponse.json({ success: false, error: 'Tenant not found' }, { status: 404 });\r\n    }\r\n\r\n    const category = await Category.findOne({ _id: id, tenantId }).lean();\r\n\r\n    if (!category) {\r\n      return NextResponse.json({ success: false, error: 'Category not found' }, { status: 404 });\r\n    }\r\n\r\n    return NextResponse.json({ success: true, data: category });\r\n  } catch (error: any) {\r\n    return NextResponse.json({ success: false, error: error.message }, { status: 500 });\r\n  }\r\n}\r\n\r\nexport async function PUT(\r\n  request: NextRequest,\r\n  { params }: { params: Promise<{ id: string }> }\r\n) {\r\n  try {\r\n    await connectDB();\r\n    await requireAuth(request);\r\n    const tenantId = await getTenantIdFromRequest(request);\r\n    const { id } = await params;\r\n\r\n    if (!tenantId) {\r\n      return NextResponse.json({ success: false, error: 'Tenant not found' }, { status: 404 });\r\n    }\r\n\r\n    const category = await Category.findOne({ _id: id, tenantId });\r\n    if (!category) {\r\n      return NextResponse.json({ success: false, error: 'Category not found' }, { status: 404 });\r\n    }\r\n\r\n    const body = await request.json();\r\n    const t = await getValidationTranslatorFromRequest(request);\r\n    const { data, errors } = validateAndSanitize(body, validateCategory, t);\r\n\r\n    if (errors.length > 0) {\r\n      return NextResponse.json(\r\n        { success: false, errors },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    const oldData = category.toObject();\r\n\r\n    if (Object.prototype.hasOwnProperty.call(data, 'name') && typeof data.name === 'string') category.name = data.name;\r\n    if (Object.prototype.hasOwnProperty.call(data, 'description') && (typeof data.description === 'string' || typeof data.description === 'undefined')) category.description = data.description;\r\n    if (Object.prototype.hasOwnProperty.call(data, 'isActive') && typeof data.isActive === 'boolean') category.isActive = data.isActive;\r\n\r\n    await category.save();\r\n\r\n    await createAuditLog(request, {\r\n      tenantId,\r\n      action: AuditActions.UPDATE,\r\n      entityType: 'category',\r\n      entityId: category._id.toString(),\r\n      changes: { before: oldData, after: category.toObject() },\r\n    });\r\n\r\n    return NextResponse.json({ success: true, data: category });\r\n  } catch (error: any) {\r\n    if (error.code === 11000) {\r\n      return NextResponse.json(\r\n        { success: false, error: 'Category with this name already exists' },\r\n        { status: 400 }\r\n      );\r\n    }\r\n    return NextResponse.json({ success: false, error: error.message }, { status: 400 });\r\n  }\r\n}\r\n\r\nexport async function DELETE(\r\n  request: NextRequest,\r\n  { params }: { params: Promise<{ id: string }> }\r\n) {\r\n  try {\r\n    await connectDB();\r\n    await requireAuth(request);\r\n    const tenantId = await getTenantIdFromRequest(request);\r\n    const { id } = await params;\r\n\r\n    if (!tenantId) {\r\n      return NextResponse.json({ success: false, error: 'Tenant not found' }, { status: 404 });\r\n    }\r\n\r\n    const category = await Category.findOne({ _id: id, tenantId });\r\n    if (!category) {\r\n      return NextResponse.json({ success: false, error: 'Category not found' }, { status: 404 });\r\n    }\r\n\r\n    // Soft delete - set isActive to false\r\n    const oldData = category.toObject();\r\n    category.isActive = false;\r\n    await category.save();\r\n\r\n    await createAuditLog(request, {\r\n      tenantId,\r\n      action: AuditActions.DELETE,\r\n      entityType: 'category',\r\n      entityId: category._id.toString(),\r\n      changes: { name: category.name },\r\n    });\r\n\r\n    return NextResponse.json({ success: true, message: 'Category deactivated' });\r\n  } catch (error: any) {\r\n    return NextResponse.json({ success: false, error: error.message }, { status: 500 });\r\n  }\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\categories\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'requireAuth' is defined but never used. Allowed unused vars must match /^_/u.","line":5,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":21},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":24,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":24,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[972,975],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[972,975],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":37,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":37,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1400,1403],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1400,1403],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":72,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":72,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2449,2452],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2449,2452],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\nimport connectDB from '@/lib/mongodb';\r\nimport Category from '@/models/Category';\r\nimport { getTenantIdFromRequest, requireTenantAccess } from '@/lib/api-tenant';\r\nimport { requireAuth } from '@/lib/auth';\r\nimport { createAuditLog, AuditActions } from '@/lib/audit';\r\nimport { validateAndSanitize, validateCategory } from '@/lib/validation';\r\nimport { getValidationTranslatorFromRequest } from '@/lib/validation-translations';\r\n\r\nexport async function GET(request: NextRequest) {\r\n  try {\r\n    await connectDB();\r\n    const tenantId = await getTenantIdFromRequest(request);\r\n    \r\n    if (!tenantId) {\r\n      return NextResponse.json({ success: false, error: 'Tenant not found or access denied' }, { status: 403 });\r\n    }\r\n\r\n    const categories = await Category.find({ tenantId })\r\n      .sort({ name: 1 })\r\n      .lean();\r\n\r\n    return NextResponse.json({ success: true, data: categories });\r\n  } catch (error: any) {\r\n    return NextResponse.json({ success: false, error: error.message }, { status: 500 });\r\n  }\r\n}\r\n\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    await connectDB();\r\n    // SECURITY: Validate tenant access for authenticated requests\r\n    let tenantId: string;\r\n    try {\r\n      const tenantAccess = await requireTenantAccess(request);\r\n      tenantId = tenantAccess.tenantId;\r\n    } catch (authError: any) {\r\n      if (authError.message.includes('Unauthorized') || authError.message.includes('Forbidden')) {\r\n        return NextResponse.json(\r\n          { success: false, error: authError.message },\r\n          { status: authError.message.includes('Unauthorized') ? 401 : 403 }\r\n        );\r\n      }\r\n      throw authError;\r\n    }\r\n\r\n    const body = await request.json();\r\n    const t = await getValidationTranslatorFromRequest(request);\r\n    const { data, errors } = validateAndSanitize(body, validateCategory, t);\r\n\r\n    if (errors.length > 0) {\r\n      return NextResponse.json(\r\n        { success: false, errors },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    const category = await Category.create({\r\n      ...data,\r\n      tenantId,\r\n    });\r\n\r\n    await createAuditLog(request, {\r\n      tenantId,\r\n      action: AuditActions.CREATE,\r\n      entityType: 'category',\r\n      entityId: category._id.toString(),\r\n      changes: data,\r\n    });\r\n\r\n    return NextResponse.json({ success: true, data: category }, { status: 201 });\r\n  } catch (error: any) {\r\n    if (error.code === 11000) {\r\n      return NextResponse.json(\r\n        { success: false, error: 'Category with this name already exists' },\r\n        { status: 400 }\r\n      );\r\n    }\r\n    return NextResponse.json({ success: false, error: error.message }, { status: 400 });\r\n  }\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\client\\address\\[addressId]\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":45,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":45,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1589,1592],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1589,1592],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":86,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":86,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2956,2959],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2956,2959],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":151,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":151,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4997,5000],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4997,5000],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\nimport connectDB from '@/lib/mongodb';\r\nimport Address from '@/models/Address';\r\nimport { requireAuth } from '@/lib/auth';\r\nimport { createAuditLog, AuditActions } from '@/lib/audit';\r\nimport { getValidationTranslatorFromRequest } from '@/lib/validation-translations';\r\n\r\ninterface RouteParams {\r\n  params: Promise<{ addressId: string }>;\r\n}\r\n\r\n/**\r\n * PUT /api/client/address/{{addressId}}\r\n * Authenticated endpoint to update an address.\r\n * Body: { label?, street?, city?, state?, zipCode?, country?, isDefault? }\r\n */\r\nexport async function PUT(request: NextRequest, { params }: RouteParams) {\r\n  let t: (key: string, fallback: string) => string;\r\n  try {\r\n    await connectDB();\r\n    t = await getValidationTranslatorFromRequest(request);\r\n\r\n    const currentUser = await requireAuth(request);\r\n    const { addressId } = await params;\r\n    const body = await request.json();\r\n\r\n    // Find the address and verify ownership\r\n    const address = await Address.findById(addressId);\r\n    if (!address) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.addressNotFound', 'Address not found') },\r\n        { status: 404 }\r\n      );\r\n    }\r\n\r\n    if (address.userId.toString() !== currentUser.userId) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.forbidden', 'You can only update your own addresses') },\r\n        { status: 403 }\r\n      );\r\n    }\r\n\r\n    const { label, street, city, state, zipCode, country, isDefault } = body;\r\n\r\n    const updates: Record<string, any> = {};\r\n    if (label !== undefined) updates.label = label;\r\n    if (street !== undefined) updates.street = street;\r\n    if (city !== undefined) updates.city = city;\r\n    if (state !== undefined) updates.state = state;\r\n    if (zipCode !== undefined) updates.zipCode = zipCode;\r\n    if (country !== undefined) updates.country = country;\r\n\r\n    // Handle default flag\r\n    if (isDefault === true) {\r\n      await Address.updateMany(\r\n        { userId: currentUser.userId, tenantId: address.tenantId, isDefault: true, _id: { $ne: addressId } },\r\n        { $set: { isDefault: false } }\r\n      );\r\n      updates.isDefault = true;\r\n    } else if (isDefault === false) {\r\n      updates.isDefault = false;\r\n    }\r\n\r\n    if (Object.keys(updates).length === 0) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.noChanges', 'No fields to update') },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    const updatedAddress = await Address.findByIdAndUpdate(\r\n      addressId,\r\n      { $set: updates },\r\n      { new: true }\r\n    ).lean();\r\n\r\n    await createAuditLog(request, {\r\n      tenantId: address.tenantId.toString(),\r\n      action: AuditActions.UPDATE,\r\n      entityType: 'address',\r\n      entityId: addressId,\r\n      changes: updates,\r\n    });\r\n\r\n    return NextResponse.json({ success: true, data: updatedAddress });\r\n  } catch (error: any) {\r\n    if (error.message === 'Unauthorized') {\r\n      return NextResponse.json({ success: false, error: 'Unauthorized' }, { status: 401 });\r\n    }\r\n    return NextResponse.json(\r\n      { success: false, error: error.message || 'Failed to update address' },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n\r\n/**\r\n * DELETE /api/client/address/{{addressId}}\r\n * Authenticated endpoint to delete an address.\r\n */\r\nexport async function DELETE(request: NextRequest, { params }: RouteParams) {\r\n  let t: (key: string, fallback: string) => string;\r\n  try {\r\n    await connectDB();\r\n    t = await getValidationTranslatorFromRequest(request);\r\n\r\n    const currentUser = await requireAuth(request);\r\n    const { addressId } = await params;\r\n\r\n    const address = await Address.findById(addressId);\r\n    if (!address) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.addressNotFound', 'Address not found') },\r\n        { status: 404 }\r\n      );\r\n    }\r\n\r\n    if (address.userId.toString() !== currentUser.userId) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.forbidden', 'You can only delete your own addresses') },\r\n        { status: 403 }\r\n      );\r\n    }\r\n\r\n    const wasDefault = address.isDefault;\r\n    const tenantId = address.tenantId;\r\n\r\n    await Address.findByIdAndDelete(addressId);\r\n\r\n    // If we deleted the default address, promote the most recent remaining one\r\n    if (wasDefault) {\r\n      const nextDefault = await Address.findOne({\r\n        userId: currentUser.userId,\r\n        tenantId,\r\n      }).sort({ createdAt: -1 });\r\n\r\n      if (nextDefault) {\r\n        nextDefault.isDefault = true;\r\n        await nextDefault.save();\r\n      }\r\n    }\r\n\r\n    await createAuditLog(request, {\r\n      tenantId: tenantId.toString(),\r\n      action: AuditActions.DELETE,\r\n      entityType: 'address',\r\n      entityId: addressId,\r\n    });\r\n\r\n    return NextResponse.json({ success: true, message: t('validation.addressDeleted', 'Address deleted successfully') });\r\n  } catch (error: any) {\r\n    if (error.message === 'Unauthorized') {\r\n      return NextResponse.json({ success: false, error: 'Unauthorized' }, { status: 401 });\r\n    }\r\n    return NextResponse.json(\r\n      { success: false, error: error.message || 'Failed to delete address' },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\client\\address\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":76,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":76,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2681,2684],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2681,2684],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\nimport connectDB from '@/lib/mongodb';\r\nimport Address from '@/models/Address';\r\nimport { requireAuth } from '@/lib/auth';\r\nimport { createAuditLog, AuditActions } from '@/lib/audit';\r\nimport { getValidationTranslatorFromRequest } from '@/lib/validation-translations';\r\n\r\n/**\r\n * POST /api/client/address\r\n * Authenticated endpoint to add a new address for the current user.\r\n * Body: { tenantId, label?, street, city, state?, zipCode?, country, isDefault? }\r\n */\r\nexport async function POST(request: NextRequest) {\r\n  let t: (key: string, fallback: string) => string;\r\n  try {\r\n    await connectDB();\r\n    t = await getValidationTranslatorFromRequest(request);\r\n\r\n    const currentUser = await requireAuth(request);\r\n    const body = await request.json();\r\n    const { tenantId, label, street, city, state, zipCode, country, isDefault } = body;\r\n\r\n    if (!tenantId || !street || !city || !country) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.addressFieldsRequired', 'tenantId, street, city, and country are required') },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    // Resolve tenant\r\n    const Tenant = (await import('@/models/Tenant')).default;\r\n    const tenant = await Tenant.findOne({\r\n      $or: [{ slug: tenantId }, ...(tenantId.match(/^[0-9a-fA-F]{24}$/) ? [{ _id: tenantId }] : [])],\r\n      isActive: true,\r\n    }).lean();\r\n\r\n    if (!tenant) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.tenantNotFound', 'Tenant not found or inactive') },\r\n        { status: 404 }\r\n      );\r\n    }\r\n\r\n    // If this is the default address, unset previous default\r\n    if (isDefault) {\r\n      await Address.updateMany(\r\n        { userId: currentUser.userId, tenantId: tenant._id, isDefault: true },\r\n        { $set: { isDefault: false } }\r\n      );\r\n    }\r\n\r\n    // If user has no addresses, make this the default\r\n    const existingCount = await Address.countDocuments({ userId: currentUser.userId, tenantId: tenant._id });\r\n\r\n    const address = await Address.create({\r\n      userId: currentUser.userId,\r\n      tenantId: tenant._id,\r\n      label: label || 'Home',\r\n      street,\r\n      city,\r\n      state,\r\n      zipCode,\r\n      country,\r\n      isDefault: isDefault || existingCount === 0,\r\n    });\r\n\r\n    await createAuditLog(request, {\r\n      tenantId: tenant._id.toString(),\r\n      action: AuditActions.CREATE,\r\n      entityType: 'address',\r\n      entityId: address._id.toString(),\r\n      metadata: { userId: currentUser.userId },\r\n    });\r\n\r\n    return NextResponse.json({ success: true, data: address }, { status: 201 });\r\n  } catch (error: any) {\r\n    if (error.message === 'Unauthorized') {\r\n      return NextResponse.json({ success: false, error: 'Unauthorized' }, { status: 401 });\r\n    }\r\n    return NextResponse.json(\r\n      { success: false, error: error.message || 'Failed to create address' },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\client\\profile\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":65,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":65,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2361,2364],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2361,2364],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":123,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":123,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4339,4342],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4339,4342],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":189,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":189,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6353,6356],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6353,6356],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\nimport connectDB from '@/lib/mongodb';\r\nimport User from '@/models/User';\r\nimport Tenant from '@/models/Tenant';\r\nimport { requireAuth } from '@/lib/auth';\r\nimport { validateEmail } from '@/lib/validation';\r\nimport { createAuditLog, AuditActions } from '@/lib/audit';\r\nimport { getValidationTranslatorFromRequest } from '@/lib/validation-translations';\r\n\r\n/**\r\n * GET /api/client/profile?userId={{userId}}&tenantId={{tenantId}}\r\n * Authenticated endpoint to get a client's profile.\r\n */\r\nexport async function GET(request: NextRequest) {\r\n  let t: (key: string, fallback: string) => string;\r\n  try {\r\n    await connectDB();\r\n    t = await getValidationTranslatorFromRequest(request);\r\n\r\n    const currentUser = await requireAuth(request);\r\n    const { searchParams } = request.nextUrl;\r\n    const userId = searchParams.get('userId');\r\n    const tenantIdParam = searchParams.get('tenantId');\r\n\r\n    if (!userId || !tenantIdParam) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.missingParams', 'userId and tenantId are required') },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    // Users can only view their own profile (unless admin+)\r\n    if (currentUser.userId !== userId && !['admin', 'owner', 'manager'].includes(currentUser.role)) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.forbidden', 'You can only view your own profile') },\r\n        { status: 403 }\r\n      );\r\n    }\r\n\r\n    // Resolve tenant\r\n    const tenant = await Tenant.findOne({\r\n      $or: [{ slug: tenantIdParam }, ...(tenantIdParam.match(/^[0-9a-fA-F]{24}$/) ? [{ _id: tenantIdParam }] : [])],\r\n      isActive: true,\r\n    }).lean();\r\n\r\n    if (!tenant) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.tenantNotFound', 'Tenant not found or inactive') },\r\n        { status: 404 }\r\n      );\r\n    }\r\n\r\n    const user = await User.findOne({ _id: userId, tenantId: tenant._id })\r\n      .select('name email role isActive lastLogin createdAt updatedAt')\r\n      .lean();\r\n\r\n    if (!user) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.userNotFound', 'User not found') },\r\n        { status: 404 }\r\n      );\r\n    }\r\n\r\n    return NextResponse.json({ success: true, data: user });\r\n  } catch (error: any) {\r\n    if (error.message === 'Unauthorized') {\r\n      return NextResponse.json({ success: false, error: 'Unauthorized' }, { status: 401 });\r\n    }\r\n    return NextResponse.json(\r\n      { success: false, error: error.message || 'Failed to fetch profile' },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n\r\n/**\r\n * PUT /api/client/profile?userId={{userId}}&tenantId={{tenantId}}\r\n * Authenticated endpoint to update a client's profile.\r\n * Body: { name?, email?, phone? }\r\n */\r\nexport async function PUT(request: NextRequest) {\r\n  let t: (key: string, fallback: string) => string;\r\n  try {\r\n    await connectDB();\r\n    t = await getValidationTranslatorFromRequest(request);\r\n\r\n    const currentUser = await requireAuth(request);\r\n    const { searchParams } = request.nextUrl;\r\n    const userId = searchParams.get('userId');\r\n    const tenantIdParam = searchParams.get('tenantId');\r\n\r\n    if (!userId || !tenantIdParam) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.missingParams', 'userId and tenantId are required') },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    // Users can only update their own profile (unless admin+)\r\n    if (currentUser.userId !== userId && !['admin', 'owner', 'manager'].includes(currentUser.role)) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.forbidden', 'You can only update your own profile') },\r\n        { status: 403 }\r\n      );\r\n    }\r\n\r\n    // Resolve tenant\r\n    const tenant = await Tenant.findOne({\r\n      $or: [{ slug: tenantIdParam }, ...(tenantIdParam.match(/^[0-9a-fA-F]{24}$/) ? [{ _id: tenantIdParam }] : [])],\r\n      isActive: true,\r\n    }).lean();\r\n\r\n    if (!tenant) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.tenantNotFound', 'Tenant not found or inactive') },\r\n        { status: 404 }\r\n      );\r\n    }\r\n\r\n    const body = await request.json();\r\n    const { name, email } = body;\r\n\r\n    const updates: Record<string, any> = {};\r\n\r\n    if (name !== undefined) {\r\n      if (!name || typeof name !== 'string' || name.trim().length === 0) {\r\n        return NextResponse.json(\r\n          { success: false, error: t('validation.nameRequired', 'Name cannot be empty') },\r\n          { status: 400 }\r\n        );\r\n      }\r\n      updates.name = name.trim();\r\n    }\r\n\r\n    if (email !== undefined) {\r\n      if (!validateEmail(email)) {\r\n        return NextResponse.json(\r\n          { success: false, error: t('validation.invalidEmailFormat', 'Invalid email format') },\r\n          { status: 400 }\r\n        );\r\n      }\r\n\r\n      // Check if email is already taken by another user in this tenant\r\n      const existingUser = await User.findOne({\r\n        email: email.toLowerCase(),\r\n        tenantId: tenant._id,\r\n        _id: { $ne: userId },\r\n      });\r\n\r\n      if (existingUser) {\r\n        return NextResponse.json(\r\n          { success: false, error: t('validation.emailExists', 'An account with this email already exists') },\r\n          { status: 400 }\r\n        );\r\n      }\r\n\r\n      updates.email = email.toLowerCase();\r\n    }\r\n\r\n    if (Object.keys(updates).length === 0) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.noChanges', 'No fields to update') },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    const updatedUser = await User.findOneAndUpdate(\r\n      { _id: userId, tenantId: tenant._id },\r\n      { $set: updates },\r\n      { new: true }\r\n    ).select('name email role isActive lastLogin createdAt updatedAt').lean();\r\n\r\n    if (!updatedUser) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.userNotFound', 'User not found') },\r\n        { status: 404 }\r\n      );\r\n    }\r\n\r\n    await createAuditLog(request, {\r\n      tenantId: tenant._id.toString(),\r\n      action: AuditActions.UPDATE,\r\n      entityType: 'user',\r\n      entityId: userId,\r\n      changes: updates,\r\n    });\r\n\r\n    return NextResponse.json({ success: true, data: updatedUser });\r\n  } catch (error: any) {\r\n    if (error.message === 'Unauthorized') {\r\n      return NextResponse.json({ success: false, error: 'Unauthorized' }, { status: 401 });\r\n    }\r\n    return NextResponse.json(\r\n      { success: false, error: error.message || 'Failed to update profile' },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\customers\\[id]\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'requireAuth' is defined but never used. Allowed unused vars must match /^_/u.","line":5,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":21},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":29,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":29,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1105,1108],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1105,1108],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":46,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":46,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1626,1629],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1626,1629],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'t' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":47,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":47,"endColumn":14},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":100,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":100,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4068,4071],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4068,4071],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":117,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":117,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4590,4593],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4590,4593],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'t' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":118,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":118,"endColumn":14},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":148,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":148,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5739,5742],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5739,5742],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":8,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\nimport connectDB from '@/lib/mongodb';\r\nimport Customer from '@/models/Customer';\r\nimport { getTenantIdFromRequest, requireTenantAccess } from '@/lib/api-tenant';\r\nimport { requireAuth } from '@/lib/auth';\r\nimport { createAuditLog, AuditActions } from '@/lib/audit';\r\nimport { getValidationTranslatorFromRequest } from '@/lib/validation-translations';\r\n\r\nexport async function GET(\r\n  request: NextRequest,\r\n  { params }: { params: Promise<{ id: string }> }\r\n) {\r\n  try {\r\n    await connectDB();\r\n    const { id } = await params;\r\n    const tenantId = await getTenantIdFromRequest(request);\r\n    \r\n    if (!tenantId) {\r\n      return NextResponse.json({ success: false, error: 'Tenant not found or access denied' }, { status: 403 });\r\n    }\r\n    \r\n    const customer = await Customer.findOne({ _id: id, tenantId }).lean();\r\n    \r\n    if (!customer) {\r\n      return NextResponse.json({ success: false, error: 'Customer not found' }, { status: 404 });\r\n    }\r\n    \r\n    return NextResponse.json({ success: true, data: customer });\r\n  } catch (error: any) {\r\n    return NextResponse.json({ success: false, error: error.message }, { status: 500 });\r\n  }\r\n}\r\n\r\nexport async function PATCH(\r\n  request: NextRequest,\r\n  { params }: { params: Promise<{ id: string }> }\r\n) {\r\n  try {\r\n    await connectDB();\r\n    const { id } = await params;\r\n    // SECURITY: Validate tenant access for authenticated requests\r\n    let tenantId: string;\r\n    try {\r\n      const tenantAccess = await requireTenantAccess(request);\r\n      tenantId = tenantAccess.tenantId;\r\n    } catch (authError: any) {\r\n      const t = await getValidationTranslatorFromRequest(request);\r\n      if (authError.message.includes('Unauthorized') || authError.message.includes('Forbidden')) {\r\n        return NextResponse.json(\r\n          { success: false, error: authError.message },\r\n          { status: authError.message.includes('Unauthorized') ? 401 : 403 }\r\n        );\r\n      }\r\n      throw authError;\r\n    }\r\n    const t = await getValidationTranslatorFromRequest(request);\r\n    \r\n    const customer = await Customer.findOne({ _id: id, tenantId });\r\n    \r\n    if (!customer) {\r\n      return NextResponse.json({ success: false, error: t('validation.customerNotFound', 'Customer not found') }, { status: 404 });\r\n    }\r\n    \r\n    const body = await request.json();\r\n    const oldData = { firstName: customer.firstName, lastName: customer.lastName, email: customer.email };\r\n    \r\n    if (body.firstName !== undefined) customer.firstName = body.firstName.trim();\r\n    if (body.lastName !== undefined) customer.lastName = body.lastName.trim();\r\n    if (body.email !== undefined) {\r\n      const email = body.email.toLowerCase().trim();\r\n      if (email && email !== customer.email) {\r\n        const existingCustomer = await Customer.findOne({ tenantId, email, _id: { $ne: id } });\r\n        if (existingCustomer) {\r\n          return NextResponse.json(\r\n            { success: false, error: t('validation.emailAlreadyExists', 'Email already exists') },\r\n            { status: 400 }\r\n          );\r\n        }\r\n      }\r\n      customer.email = email;\r\n    }\r\n    if (body.phone !== undefined) customer.phone = body.phone?.trim();\r\n    if (body.addresses !== undefined) customer.addresses = body.addresses;\r\n    if (body.dateOfBirth !== undefined) customer.dateOfBirth = body.dateOfBirth ? new Date(body.dateOfBirth) : undefined;\r\n    if (body.notes !== undefined) customer.notes = body.notes?.trim();\r\n    if (body.tags !== undefined) customer.tags = body.tags;\r\n    if (body.isActive !== undefined) customer.isActive = body.isActive;\r\n    \r\n    await customer.save();\r\n    \r\n    await createAuditLog(request, {\r\n      tenantId,\r\n      action: AuditActions.UPDATE,\r\n      entityType: 'customer',\r\n      entityId: customer._id.toString(),\r\n      changes: { old: oldData, new: { firstName: customer.firstName, lastName: customer.lastName, email: customer.email } },\r\n    });\r\n    \r\n    return NextResponse.json({ success: true, data: customer });\r\n  } catch (error: any) {\r\n    return NextResponse.json({ success: false, error: error.message }, { status: 400 });\r\n  }\r\n}\r\n\r\nexport async function DELETE(\r\n  request: NextRequest,\r\n  { params }: { params: Promise<{ id: string }> }\r\n) {\r\n  try {\r\n    await connectDB();\r\n    const { id } = await params;\r\n    // SECURITY: Validate tenant access for authenticated requests\r\n    let tenantId: string;\r\n    try {\r\n      const tenantAccess = await requireTenantAccess(request);\r\n      tenantId = tenantAccess.tenantId;\r\n    } catch (authError: any) {\r\n      const t = await getValidationTranslatorFromRequest(request);\r\n      if (authError.message.includes('Unauthorized') || authError.message.includes('Forbidden')) {\r\n        return NextResponse.json(\r\n          { success: false, error: authError.message },\r\n          { status: authError.message.includes('Unauthorized') ? 401 : 403 }\r\n        );\r\n      }\r\n      throw authError;\r\n    }\r\n    const t = await getValidationTranslatorFromRequest(request);\r\n    \r\n    // Soft delete - set isActive to false\r\n    const customer = await Customer.findOne({ _id: id, tenantId });\r\n    \r\n    if (!customer) {\r\n      return NextResponse.json({ success: false, error: t('validation.customerNotFound', 'Customer not found') }, { status: 404 });\r\n    }\r\n    \r\n    customer.isActive = false;\r\n    await customer.save();\r\n    \r\n    await createAuditLog(request, {\r\n      tenantId,\r\n      action: AuditActions.DELETE,\r\n      entityType: 'customer',\r\n      entityId: id,\r\n      changes: { name: `${customer.firstName} ${customer.lastName}` },\r\n    });\r\n    \r\n    return NextResponse.json({ success: true, message: 'Customer deleted' });\r\n  } catch (error: any) {\r\n    return NextResponse.json({ success: false, error: error.message }, { status: 400 });\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\customers\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'requireAuth' is defined but never used. Allowed unused vars must match /^_/u.","line":5,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":21},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":25,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":25,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1055,1058],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1055,1058],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":56,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":56,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1880,1883],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1880,1883],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":69,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":69,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2308,2311],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2308,2311],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'t' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":70,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":70,"endColumn":14},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":149,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":149,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5171,5174],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5171,5174],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\nimport connectDB from '@/lib/mongodb';\r\nimport Customer from '@/models/Customer';\r\nimport { getTenantIdFromRequest, requireTenantAccess } from '@/lib/api-tenant';\r\nimport { requireAuth } from '@/lib/auth';\r\nimport { createAuditLog, AuditActions } from '@/lib/audit';\r\nimport { getValidationTranslatorFromRequest } from '@/lib/validation-translations';\r\n\r\nexport async function GET(request: NextRequest) {\r\n  try {\r\n    await connectDB();\r\n    const tenantId = await getTenantIdFromRequest(request);\r\n    \r\n    if (!tenantId) {\r\n      return NextResponse.json({ success: false, error: 'Tenant not found or access denied' }, { status: 403 });\r\n    }\r\n    \r\n    const searchParams = request.nextUrl.searchParams;\r\n    const limit = parseInt(searchParams.get('limit') || '50');\r\n    const page = parseInt(searchParams.get('page') || '1');\r\n    const skip = (page - 1) * limit;\r\n    const search = searchParams.get('search');\r\n    const isActive = searchParams.get('isActive');\r\n    \r\n    const query: any = { tenantId };\r\n    if (isActive !== null) {\r\n      query.isActive = isActive === 'true';\r\n    }\r\n    if (search) {\r\n      query.$or = [\r\n        { firstName: { $regex: search, $options: 'i' } },\r\n        { lastName: { $regex: search, $options: 'i' } },\r\n        { email: { $regex: search, $options: 'i' } },\r\n        { phone: { $regex: search, $options: 'i' } },\r\n      ];\r\n    }\r\n    \r\n    const customers = await Customer.find(query)\r\n      .sort({ createdAt: -1 })\r\n      .limit(limit)\r\n      .skip(skip)\r\n      .lean();\r\n    \r\n    const total = await Customer.countDocuments(query);\r\n    \r\n    return NextResponse.json({\r\n      success: true,\r\n      data: customers,\r\n      pagination: {\r\n        total,\r\n        page,\r\n        limit,\r\n        pages: Math.ceil(total / limit),\r\n      },\r\n    });\r\n  } catch (error: any) {\r\n    return NextResponse.json({ success: false, error: error.message }, { status: 500 });\r\n  }\r\n}\r\n\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    await connectDB();\r\n    // SECURITY: Validate tenant access for authenticated requests\r\n    let tenantId: string;\r\n    try {\r\n      const tenantAccess = await requireTenantAccess(request);\r\n      tenantId = tenantAccess.tenantId;\r\n    } catch (authError: any) {\r\n      const t = await getValidationTranslatorFromRequest(request);\r\n      if (authError.message.includes('Unauthorized') || authError.message.includes('Forbidden')) {\r\n        return NextResponse.json(\r\n          { success: false, error: authError.message },\r\n          { status: authError.message.includes('Unauthorized') ? 401 : 403 }\r\n        );\r\n      }\r\n      throw authError;\r\n    }\r\n    const t = await getValidationTranslatorFromRequest(request);\r\n    \r\n    const body = await request.json();\r\n    const { firstName, lastName, email, phone, addresses, dateOfBirth, notes, tags } = body;\r\n    \r\n    // Validate required fields\r\n    if (!firstName || !firstName.trim()) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.firstNameRequired', 'First name is required') },\r\n        { status: 400 }\r\n      );\r\n    }\r\n    \r\n    if (!lastName || !lastName.trim()) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.lastNameRequired', 'Last name is required') },\r\n        { status: 400 }\r\n      );\r\n    }\r\n    \r\n    // Check email uniqueness if provided\r\n    if (email) {\r\n      const existingCustomer = await Customer.findOne({ tenantId, email: email.toLowerCase() });\r\n      if (existingCustomer) {\r\n        return NextResponse.json(\r\n          { success: false, error: t('validation.emailAlreadyExists', 'Email already exists') },\r\n          { status: 400 }\r\n        );\r\n      }\r\n    }\r\n    \r\n    const customer = await Customer.create({\r\n      tenantId,\r\n      firstName: firstName.trim(),\r\n      lastName: lastName.trim(),\r\n      email: email?.toLowerCase().trim(),\r\n      phone: phone?.trim(),\r\n      addresses: addresses || [],\r\n      dateOfBirth: dateOfBirth ? new Date(dateOfBirth) : undefined,\r\n      notes: notes?.trim(),\r\n      tags: tags || [],\r\n      isActive: true,\r\n    });\r\n    \r\n    await createAuditLog(request, {\r\n      tenantId,\r\n      action: AuditActions.CREATE,\r\n      entityType: 'customer',\r\n      entityId: customer._id.toString(),\r\n      changes: { firstName, lastName, email },\r\n    });\r\n\r\n    // Send welcome email (#22 - New Customer Welcome Emails)\r\n    if (customer.email) {\r\n      try {\r\n        const { sendCustomerWelcomeEmail } = await import('@/lib/automations/customer-welcome');\r\n        sendCustomerWelcomeEmail({\r\n          customerId: customer._id.toString(),\r\n          tenantId,\r\n        }).catch((error) => {\r\n          // Log error but don't fail customer creation\r\n          console.error('Failed to send welcome email:', error);\r\n        });\r\n      } catch (error) {\r\n        // Silently fail - welcome email shouldn't block customer creation\r\n        console.error('Error importing welcome email automation:', error);\r\n      }\r\n    }\r\n    \r\n    return NextResponse.json({ success: true, data: customer }, { status: 201 });\r\n  } catch (error: any) {\r\n    return NextResponse.json({ success: false, error: error.message }, { status: 400 });\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\discounts\\[id]\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":27,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":27,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1199,1202],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1199,1202],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":65,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":65,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2844,2847],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2844,2847],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":98,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":98,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4009,4012],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4009,4012],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\nimport connectDB from '@/lib/mongodb';\r\nimport Discount from '@/models/Discount';\r\nimport { getTenantIdFromRequest } from '@/lib/api-tenant';\r\nimport { requireRole } from '@/lib/auth';\r\nimport { createAuditLog, AuditActions } from '@/lib/audit';\r\nimport { getValidationTranslatorFromRequest } from '@/lib/validation-translations';\r\n\r\nexport async function PUT(request: NextRequest, { params }: { params: Promise<{ id: string }> }) {\r\n  try {\r\n    await connectDB();\r\n    await requireRole(request, ['admin', 'manager']);\r\n    const tenantId = await getTenantIdFromRequest(request);\r\n    const { id } = await params;\r\n    const t = await getValidationTranslatorFromRequest(request);\r\n    \r\n    if (!tenantId) {\r\n      return NextResponse.json({ success: false, error: t('validation.tenantNotFound', 'Tenant not found') }, { status: 404 });\r\n    }\r\n\r\n    const discount = await Discount.findOne({ _id: id, tenantId });\r\n    if (!discount) {\r\n      return NextResponse.json({ success: false, error: t('validation.discountNotFound', 'Discount not found') }, { status: 404 });\r\n    }\r\n\r\n    const body = await request.json();\r\n    const updates: any = {};\r\n\r\n    if (body.name !== undefined) updates.name = body.name;\r\n    if (body.description !== undefined) updates.description = body.description;\r\n    if (body.value !== undefined) {\r\n      if (discount.type === 'percentage' && (body.value < 0 || body.value > 100)) {\r\n        return NextResponse.json(\r\n          { success: false, error: t('validation.percentageDiscountRange', 'Percentage discount must be between 0 and 100') },\r\n          { status: 400 }\r\n        );\r\n      }\r\n      if (discount.type === 'fixed' && body.value < 0) {\r\n        return NextResponse.json(\r\n          { success: false, error: t('validation.fixedDiscountPositive', 'Fixed discount must be positive') },\r\n          { status: 400 }\r\n        );\r\n      }\r\n      updates.value = body.value;\r\n    }\r\n    if (body.minPurchaseAmount !== undefined) updates.minPurchaseAmount = body.minPurchaseAmount;\r\n    if (body.maxDiscountAmount !== undefined) updates.maxDiscountAmount = body.maxDiscountAmount;\r\n    if (body.validFrom !== undefined) updates.validFrom = new Date(body.validFrom);\r\n    if (body.validUntil !== undefined) updates.validUntil = new Date(body.validUntil);\r\n    if (body.usageLimit !== undefined) updates.usageLimit = body.usageLimit;\r\n    if (body.isActive !== undefined) updates.isActive = body.isActive;\r\n\r\n    Object.assign(discount, updates);\r\n    await discount.save();\r\n\r\n    await createAuditLog(request, {\r\n      tenantId,\r\n      action: AuditActions.DISCOUNT_UPDATE,\r\n      entityType: 'discount',\r\n      entityId: id,\r\n      changes: updates,\r\n    });\r\n\r\n    return NextResponse.json({ success: true, data: discount });\r\n  } catch (error: any) {\r\n    return NextResponse.json({ success: false, error: error.message }, { status: 400 });\r\n  }\r\n}\r\n\r\nexport async function DELETE(request: NextRequest, { params }: { params: Promise<{ id: string }> }) {\r\n  try {\r\n    await connectDB();\r\n    await requireRole(request, ['admin', 'manager']);\r\n    const tenantId = await getTenantIdFromRequest(request);\r\n    const { id } = await params;\r\n    const t = await getValidationTranslatorFromRequest(request);\r\n    \r\n    if (!tenantId) {\r\n      return NextResponse.json({ success: false, error: t('validation.tenantNotFound', 'Tenant not found') }, { status: 404 });\r\n    }\r\n\r\n    const discount = await Discount.findOne({ _id: id, tenantId });\r\n    if (!discount) {\r\n      return NextResponse.json({ success: false, error: t('validation.discountNotFound', 'Discount not found') }, { status: 404 });\r\n    }\r\n\r\n    await discount.deleteOne();\r\n\r\n    await createAuditLog(request, {\r\n      tenantId,\r\n      action: AuditActions.DISCOUNT_DELETE,\r\n      entityType: 'discount',\r\n      entityId: id,\r\n      changes: { code: discount.code },\r\n    });\r\n\r\n    return NextResponse.json({ success: true });\r\n  } catch (error: any) {\r\n    return NextResponse.json({ success: false, error: error.message }, { status: 400 });\r\n  }\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\discounts\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getTenantIdFromRequest' is defined but never used. Allowed unused vars must match /^_/u.","line":4,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":32},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'requireAuth' is defined but never used. Allowed unused vars must match /^_/u.","line":5,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":21},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":18,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":18,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[803,806],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[803,806],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'t' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":19,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":19,"endColumn":14},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'t' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":28,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":28,"endColumn":12},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":34,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":34,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1459,1462],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1459,1462],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":49,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":49,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1875,1878],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1875,1878],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":64,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":64,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2386,2389],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2386,2389],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'t' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":65,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":65,"endColumn":14},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":78,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":78,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2959,2962],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2959,2962],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":159,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":159,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5290,5293],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5290,5293],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":11,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\nimport connectDB from '@/lib/mongodb';\r\nimport Discount from '@/models/Discount';\r\nimport { getTenantIdFromRequest, requireTenantAccess } from '@/lib/api-tenant';\r\nimport { requireAuth, requireRole } from '@/lib/auth';\r\nimport { createAuditLog, AuditActions } from '@/lib/audit';\r\nimport { getValidationTranslatorFromRequest } from '@/lib/validation-translations';\r\nimport { checkFeatureAccess } from '@/lib/subscription';\r\n\r\nexport async function GET(request: NextRequest) {\r\n  try {\r\n    await connectDB();\r\n    // SECURITY: Validate tenant access for authenticated requests\r\n    let tenantId: string;\r\n    try {\r\n      const tenantAccess = await requireTenantAccess(request);\r\n      tenantId = tenantAccess.tenantId;\r\n    } catch (authError: any) {\r\n      const t = await getValidationTranslatorFromRequest(request);\r\n      if (authError.message.includes('Unauthorized') || authError.message.includes('Forbidden')) {\r\n        return NextResponse.json(\r\n          { success: false, error: authError.message },\r\n          { status: authError.message.includes('Unauthorized') ? 401 : 403 }\r\n        );\r\n      }\r\n      throw authError;\r\n    }\r\n    const t = await getValidationTranslatorFromRequest(request);\r\n    \r\n    const searchParams = request.nextUrl.searchParams;\r\n    const code = searchParams.get('code');\r\n    const activeOnly = searchParams.get('activeOnly') === 'true';\r\n\r\n    const query: any = { tenantId };\r\n    \r\n    if (code) {\r\n      query.code = code.toUpperCase();\r\n    }\r\n    \r\n    if (activeOnly) {\r\n      query.isActive = true;\r\n      query.validFrom = { $lte: new Date() };\r\n      query.validUntil = { $gte: new Date() };\r\n    }\r\n\r\n    const discounts = await Discount.find(query).sort({ createdAt: -1 });\r\n\r\n    return NextResponse.json({ success: true, data: discounts });\r\n  } catch (error: any) {\r\n    return NextResponse.json({ success: false, error: error.message }, { status: 500 });\r\n  }\r\n}\r\n\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    await connectDB();\r\n    // SECURITY: Validate tenant access for authenticated requests\r\n    let tenantId: string;\r\n    try {\r\n      const tenantAccess = await requireTenantAccess(request);\r\n      tenantId = tenantAccess.tenantId;\r\n      // Also check role\r\n      await requireRole(request, ['admin', 'manager']);\r\n    } catch (authError: any) {\r\n      const t = await getValidationTranslatorFromRequest(request);\r\n      if (authError.message.includes('Unauthorized') || authError.message.includes('Forbidden')) {\r\n        return NextResponse.json(\r\n          { success: false, error: authError.message },\r\n          { status: authError.message.includes('Unauthorized') ? 401 : 403 }\r\n        );\r\n      }\r\n      throw authError;\r\n    }\r\n\r\n    // Check if discounts feature is enabled in subscription\r\n    try {\r\n      await checkFeatureAccess(tenantId.toString(), 'enableDiscounts');\r\n    } catch (featureError: any) {\r\n      return NextResponse.json(\r\n        { success: false, error: featureError.message },\r\n        { status: 403 }\r\n      );\r\n    }\r\n\r\n    const t = await getValidationTranslatorFromRequest(request);\r\n\r\n    const body = await request.json();\r\n    const {\r\n      code,\r\n      name,\r\n      description,\r\n      type,\r\n      value,\r\n      minPurchaseAmount,\r\n      maxDiscountAmount,\r\n      validFrom,\r\n      validUntil,\r\n      usageLimit,\r\n      isActive = true,\r\n    } = body;\r\n\r\n    // Validate required fields\r\n    if (!code || !type || value === undefined || !validFrom || !validUntil) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.missingRequiredFields', 'Missing required fields') },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    // Validate value based on type\r\n    if (type === 'percentage' && (value < 0 || value > 100)) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.percentageDiscountRange', 'Percentage discount must be between 0 and 100') },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    if (type === 'fixed' && value < 0) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.fixedDiscountPositive', 'Fixed discount must be positive') },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    // Check if code already exists for this tenant\r\n    const existing = await Discount.findOne({ tenantId, code: code.toUpperCase() });\r\n    if (existing) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.discountCodeExists', 'Discount code already exists') },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    const discount = await Discount.create({\r\n      tenantId,\r\n      code: code.toUpperCase(),\r\n      name,\r\n      description,\r\n      type,\r\n      value,\r\n      minPurchaseAmount,\r\n      maxDiscountAmount,\r\n      validFrom: new Date(validFrom),\r\n      validUntil: new Date(validUntil),\r\n      usageLimit,\r\n      isActive,\r\n      usageCount: 0,\r\n    });\r\n\r\n    await createAuditLog(request, {\r\n      tenantId,\r\n      action: AuditActions.DISCOUNT_CREATE,\r\n      entityType: 'discount',\r\n      entityId: discount._id.toString(),\r\n      changes: { code, type, value },\r\n    });\r\n\r\n    return NextResponse.json({ success: true, data: discount }, { status: 201 });\r\n  } catch (error: any) {\r\n    const t = await getValidationTranslatorFromRequest(request);\r\n    if (error.code === 11000) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.discountCodeExists', 'Discount code already exists') },\r\n        { status: 400 }\r\n      );\r\n    }\r\n    return NextResponse.json({ success: false, error: error.message }, { status: 400 });\r\n  }\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\discounts\\validate\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":105,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":105,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3608,3611],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3608,3611],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\nimport connectDB from '@/lib/mongodb';\r\nimport Discount from '@/models/Discount';\r\nimport { getTenantIdFromRequest } from '@/lib/api-tenant';\r\nimport { requireAuth } from '@/lib/auth';\r\nimport { getValidationTranslatorFromRequest } from '@/lib/validation-translations';\r\nimport { getTenantSettingsById } from '@/lib/tenant';\r\n\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    await connectDB();\r\n    await requireAuth(request);\r\n    const tenantId = await getTenantIdFromRequest(request);\r\n    const t = await getValidationTranslatorFromRequest(request);\r\n    \r\n    if (!tenantId) {\r\n      return NextResponse.json({ success: false, error: t('validation.tenantNotFound', 'Tenant not found') }, { status: 404 });\r\n    }\r\n    \r\n    // Get tenant settings to check feature flags\r\n    const tenantSettings = await getTenantSettingsById(tenantId);\r\n    \r\n    // Check if discounts are enabled\r\n    if (tenantSettings && tenantSettings.enableDiscounts === false) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.discountsNotEnabled', 'Discounts are not enabled for this tenant') },\r\n        { status: 400 }\r\n      );\r\n    }\r\n    \r\n    const body = await request.json();\r\n    const { code, subtotal } = body;\r\n\r\n    if (!code) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.discountCodeRequired', 'Discount code is required') },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    const discount = await Discount.findOne({\r\n      tenantId,\r\n      code: code.toUpperCase(),\r\n      isActive: true,\r\n    });\r\n\r\n    if (!discount) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.invalidDiscountCode', 'Invalid or inactive discount code') },\r\n        { status: 404 }\r\n      );\r\n    }\r\n\r\n    // Check validity dates\r\n    const now = new Date();\r\n    if (now < discount.validFrom || now > discount.validUntil) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.discountCodeNotValid', 'Discount code is not valid at this time') },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    // Check usage limit\r\n    if (discount.usageLimit && discount.usageCount >= discount.usageLimit) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.discountCodeUsageLimit', 'Discount code has reached its usage limit') },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    // Check minimum purchase amount\r\n    if (discount.minPurchaseAmount && subtotal < discount.minPurchaseAmount) {\r\n      const errorMsg = t('validation.minimumPurchaseAmount', 'Minimum purchase amount of {amount} required').replace('{amount}', discount.minPurchaseAmount.toString());\r\n      return NextResponse.json(\r\n        { \r\n          success: false, \r\n          error: errorMsg\r\n        },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    // Calculate discount amount\r\n    let discountAmount = 0;\r\n    if (discount.type === 'percentage') {\r\n      discountAmount = (subtotal * discount.value) / 100;\r\n      if (discount.maxDiscountAmount) {\r\n        discountAmount = Math.min(discountAmount, discount.maxDiscountAmount);\r\n      }\r\n    } else {\r\n      discountAmount = Math.min(discount.value, subtotal);\r\n    }\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      data: {\r\n        code: discount.code,\r\n        name: discount.name,\r\n        type: discount.type,\r\n        value: discount.value,\r\n        discountAmount,\r\n        finalTotal: Math.max(0, subtotal - discountAmount),\r\n      },\r\n    });\r\n  } catch (error: any) {\r\n    return NextResponse.json({ success: false, error: error.message }, { status: 500 });\r\n  }\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\expenses\\[id]\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'oldData' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":107,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":107,"endColumn":18}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\nimport connectDB from '@/lib/mongodb';\r\nimport Expense from '@/models/Expense';\r\nimport { getTenantIdFromRequest } from '@/lib/api-tenant';\r\nimport { requireAuth } from '@/lib/auth';\r\nimport { createAuditLog, AuditActions } from '@/lib/audit';\r\nimport { getValidationTranslatorFromRequest } from '@/lib/validation-translations';\r\n\r\nexport async function GET(\r\n  request: NextRequest,\r\n  { params }: { params: Promise<{ id: string }> }\r\n) {\r\n  try {\r\n    await connectDB();\r\n    await requireAuth(request);\r\n    const tenantId = await getTenantIdFromRequest(request);\r\n    const { id } = await params;\r\n    const t = await getValidationTranslatorFromRequest(request);\r\n\r\n    if (!tenantId) {\r\n      return NextResponse.json({ success: false, error: t('validation.tenantNotFound', 'Tenant not found') }, { status: 404 });\r\n    }\r\n\r\n    const expense = await Expense.findOne({ _id: id, tenantId })\r\n      .populate('userId', 'name email')\r\n      .lean();\r\n\r\n    if (!expense) {\r\n      return NextResponse.json({ success: false, error: t('validation.expenseNotFound', 'Expense not found') }, { status: 404 });\r\n    }\r\n\r\n    return NextResponse.json({ success: true, data: expense });\r\n  } catch (error: unknown) {\r\n    return NextResponse.json({ success: false, error: (error as Error).message }, { status: 500 });\r\n  }\r\n}\r\n\r\nexport async function PUT(\r\n  request: NextRequest,\r\n  { params }: { params: Promise<{ id: string }> }\r\n) {\r\n  try {\r\n    await connectDB();\r\n    await requireAuth(request);\r\n    const tenantId = await getTenantIdFromRequest(request);\r\n    const { id } = await params;\r\n\r\n    if (!tenantId) {\r\n      return NextResponse.json({ success: false, error: 'Tenant not found' }, { status: 404 });\r\n    }\r\n\r\n    const expense = await Expense.findOne({ _id: id, tenantId });\r\n    if (!expense) {\r\n      return NextResponse.json({ success: false, error: 'Expense not found' }, { status: 404 });\r\n    }\r\n\r\n    const body = await request.json();\r\n    const { name, description, amount, date, paymentMethod, receipt, notes } = body;\r\n\r\n    const oldData = expense.toObject();\r\n\r\n    if (name) expense.name = name;\r\n    if (description) expense.description = description;\r\n    if (amount !== undefined) expense.amount = parseFloat(amount);\r\n    if (date) expense.date = new Date(date);\r\n    if (paymentMethod) expense.paymentMethod = paymentMethod;\r\n    if (receipt !== undefined) expense.receipt = receipt;\r\n    if (notes !== undefined) expense.notes = notes;\r\n\r\n    await expense.save();\r\n\r\n    await createAuditLog(request, {\r\n      tenantId,\r\n      action: AuditActions.UPDATE,\r\n      entityType: 'expense',\r\n      entityId: expense._id.toString(),\r\n      changes: { before: oldData, after: expense.toObject() },\r\n    });\r\n\r\n    return NextResponse.json({ success: true, data: expense });\r\n  } catch (error: unknown) {\r\n    console.error('Error updating expense:', error);\r\n    return NextResponse.json({ success: false, error: (error as Error).message }, { status: 400 });\r\n  }\r\n}\r\n\r\nexport async function DELETE(\r\n  request: NextRequest,\r\n  { params }: { params: Promise<{ id: string }> }\r\n) {\r\n  try {\r\n    await connectDB();\r\n    await requireAuth(request);\r\n    const tenantId = await getTenantIdFromRequest(request);\r\n    const { id } = await params;\r\n    const t = await getValidationTranslatorFromRequest(request);\r\n\r\n    if (!tenantId) {\r\n      return NextResponse.json({ success: false, error: t('validation.tenantNotFound', 'Tenant not found') }, { status: 404 });\r\n    }\r\n\r\n    const expense = await Expense.findOne({ _id: id, tenantId });\r\n    if (!expense) {\r\n      return NextResponse.json({ success: false, error: t('validation.expenseNotFound', 'Expense not found') }, { status: 404 });\r\n    }\r\n\r\n    const oldData = expense.toObject();\r\n    await expense.deleteOne();\r\n\r\n    await createAuditLog(request, {\r\n      tenantId,\r\n      action: AuditActions.DELETE,\r\n      entityType: 'expense',\r\n      entityId: expense._id.toString(),\r\n      changes: { name: expense.name, description: expense.description, amount: expense.amount },\r\n    });\r\n\r\n    return NextResponse.json({ success: true, message: t('validation.expenseDeleted', 'Expense deleted successfully') });\r\n  } catch (error: unknown) {\r\n    console.error('Error deleting expense:', error);\r\n    return NextResponse.json({ success: false, error: (error as Error).message }, { status: 500 });\r\n  }\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\expenses\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":25,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":25,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1019,1022],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1019,1022],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\nimport connectDB from '@/lib/mongodb';\r\nimport Expense from '@/models/Expense';\r\nimport { getTenantIdFromRequest } from '@/lib/api-tenant';\r\nimport { requireAuth } from '@/lib/auth';\r\nimport { createAuditLog, AuditActions } from '@/lib/audit';\r\nimport { getValidationTranslatorFromRequest } from '@/lib/validation-translations';\r\n\r\nexport async function GET(request: NextRequest) {\r\n  try {\r\n    await connectDB();\r\n    await requireAuth(request);\r\n    const tenantId = await getTenantIdFromRequest(request);\r\n    const t = await getValidationTranslatorFromRequest(request);\r\n\r\n    if (!tenantId) {\r\n      return NextResponse.json({ success: false, error: t('validation.tenantNotFound', 'Tenant not found') }, { status: 404 });\r\n    }\r\n\r\n    const searchParams = request.nextUrl.searchParams;\r\n    const startDate = searchParams.get('startDate');\r\n    const endDate = searchParams.get('endDate');\r\n    const name = searchParams.get('name');\r\n\r\n    const query: any = { tenantId };\r\n    \r\n    if (startDate || endDate) {\r\n      query.date = {};\r\n      if (startDate) query.date.$gte = new Date(startDate);\r\n      if (endDate) query.date.$lte = new Date(endDate);\r\n    }\r\n\r\n    if (name) {\r\n      query.name = name;\r\n    }\r\n\r\n    const expenses = await Expense.find(query)\r\n      .populate('userId', 'name email')\r\n      .sort({ date: -1 })\r\n      .lean();\r\n\r\n    return NextResponse.json({ success: true, data: expenses });\r\n  } catch (error: unknown) {\r\n    console.error('Error fetching expenses:', error);\r\n    return NextResponse.json({ success: false, error: (error as Error).message }, { status: 500 });\r\n  }\r\n}\r\n\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    await connectDB();\r\n    const user = await requireAuth(request);\r\n    const tenantId = await getTenantIdFromRequest(request);\r\n    const t = await getValidationTranslatorFromRequest(request);\r\n\r\n    if (!tenantId) {\r\n      return NextResponse.json({ success: false, error: t('validation.tenantNotFound', 'Tenant not found') }, { status: 404 });\r\n    }\r\n\r\n    const body = await request.json();\r\n    const { name, description, amount, date, paymentMethod, receipt, notes } = body;\r\n\r\n    // Validate required fields\r\n    if (!name || !name.trim()) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.expenseNameRequired', 'Name of expense is required') },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    if (!description || !description.trim()) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.descriptionRequired', 'Description is required') },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    if (amount === undefined || amount === null || amount === '') {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.amountRequired', 'Amount is required') },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    const amountValue = parseFloat(amount);\r\n    if (isNaN(amountValue) || amountValue < 0) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.amountPositive', 'Amount must be a valid positive number') },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    const expense = await Expense.create({\r\n      tenantId,\r\n      name: name.trim(),\r\n      description: description.trim(),\r\n      amount: amountValue,\r\n      date: date ? new Date(date) : new Date(),\r\n      paymentMethod: paymentMethod || 'cash',\r\n      receipt: receipt?.trim() || undefined,\r\n      notes: notes?.trim() || undefined,\r\n      userId: user.userId,\r\n    });\r\n\r\n    await createAuditLog(request, {\r\n      tenantId,\r\n      action: AuditActions.CREATE,\r\n      entityType: 'expense',\r\n      entityId: expense._id.toString(),\r\n      changes: { name, description, amount },\r\n    });\r\n\r\n    return NextResponse.json({ success: true, data: expense }, { status: 201 });\r\n  } catch (error: unknown) {\r\n    console.error('Error creating expense:', error);\r\n    return NextResponse.json({ success: false, error: (error as Error).message }, { status: 400 });\r\n  }\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\inventory\\low-stock\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'user' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":12,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":15},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":37,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":37,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1547,1550],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1547,1550],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\nimport connectDB from '@/lib/mongodb';\r\nimport { getLowStockProducts } from '@/lib/stock';\r\nimport { getTenantIdFromRequest } from '@/lib/api-tenant';\r\nimport { requireAuth } from '@/lib/auth';\r\nimport Tenant from '@/models/Tenant';\r\nimport { getValidationTranslatorFromRequest } from '@/lib/validation-translations';\r\n\r\nexport async function GET(request: NextRequest) {\r\n  try {\r\n    await connectDB();\r\n    const user = await requireAuth(request);\r\n    const tenantId = await getTenantIdFromRequest(request);\r\n    const t = await getValidationTranslatorFromRequest(request);\r\n\r\n    if (!tenantId) {\r\n      return NextResponse.json({ success: false, error: t('validation.tenantNotFound', 'Tenant not found') }, { status: 404 });\r\n    }\r\n\r\n    const searchParams = request.nextUrl.searchParams;\r\n    const branchId = searchParams.get('branchId') || undefined;\r\n    const threshold = searchParams.get('threshold') ? parseInt(searchParams.get('threshold')!) : undefined;\r\n\r\n    // Get tenant settings for default threshold\r\n    const tenant = await Tenant.findById(tenantId);\r\n    const defaultThreshold = tenant?.settings?.lowStockThreshold || 10;\r\n    const finalThreshold = threshold || defaultThreshold;\r\n\r\n    const lowStockProducts = await getLowStockProducts(tenantId, branchId, finalThreshold);\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      data: lowStockProducts,\r\n      threshold: finalThreshold,\r\n      count: lowStockProducts.length,\r\n    });\r\n  } catch (error: any) {\r\n    console.error('Error fetching low stock products:', error);\r\n    return NextResponse.json({ success: false, error: error.message }, { status: 500 });\r\n  }\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\inventory\\realtime\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":34,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":34,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1291,1294],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1291,1294],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":47,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":47,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1851,1854],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1851,1854],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":113,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":113,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4090,4093],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4090,4093],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest } from 'next/server';\r\nimport connectDB from '@/lib/mongodb';\r\nimport Product from '@/models/Product';\r\nimport StockMovement from '@/models/StockMovement';\r\nimport { getTenantIdFromRequest } from '@/lib/api-tenant';\r\nimport { requireAuth } from '@/lib/auth';\r\nimport { getValidationTranslatorFromRequest } from '@/lib/validation-translations';\r\n\r\n/**\r\n * Server-Sent Events endpoint for real-time stock tracking\r\n * Clients can subscribe to stock updates for specific products or all products\r\n */\r\nexport async function GET(request: NextRequest) {\r\n  try {\r\n    await connectDB();\r\n    await requireAuth(request);\r\n    const tenantId = await getTenantIdFromRequest(request);\r\n    const t = await getValidationTranslatorFromRequest(request);\r\n\r\n    if (!tenantId) {\r\n      return new Response(t('validation.tenantNotFound', 'Tenant not found'), { status: 404 });\r\n    }\r\n\r\n    const searchParams = request.nextUrl.searchParams;\r\n    const productId = searchParams.get('productId');\r\n    const branchId = searchParams.get('branchId');\r\n\r\n    // Create a readable stream for SSE\r\n    const stream = new ReadableStream({\r\n      async start(controller) {\r\n        const encoder = new TextEncoder();\r\n\r\n        // Send initial connection message\r\n        const send = (data: any) => {\r\n          const message = `data: ${JSON.stringify(data)}\\n\\n`;\r\n          controller.enqueue(encoder.encode(message));\r\n        };\r\n\r\n        const t = await getValidationTranslatorFromRequest(request);\r\n        send({ type: 'connected', message: t('validation.realtimeStockConnected', 'Real-time stock tracking connected') });\r\n\r\n        // Poll for stock movements (more reliable than change streams)\r\n        let lastCheck = new Date();\r\n        \r\n        const pollInterval = setInterval(async () => {\r\n          try {\r\n            const query: any = {\r\n              tenantId,\r\n              createdAt: { $gt: lastCheck },\r\n            };\r\n            \r\n            if (productId) {\r\n              query.productId = productId;\r\n            }\r\n            \r\n            if (branchId) {\r\n              query.branchId = branchId;\r\n            }\r\n\r\n            const recentMovements = await StockMovement.find(query)\r\n              .sort({ createdAt: -1 })\r\n              .limit(50)\r\n              .lean();\r\n\r\n            for (const movement of recentMovements) {\r\n              const product = await Product.findById(movement.productId).lean();\r\n              if (product) {\r\n                send({\r\n                  type: 'stock_update',\r\n                  productId: movement.productId,\r\n                  branchId: movement.branchId,\r\n                  variation: movement.variation,\r\n                  movementType: movement.type,\r\n                  quantity: movement.quantity,\r\n                  newStock: movement.newStock,\r\n                  previousStock: movement.previousStock,\r\n                  timestamp: movement.createdAt,\r\n                });\r\n              }\r\n            }\r\n\r\n            if (recentMovements.length > 0) {\r\n              lastCheck = recentMovements[0].createdAt;\r\n            }\r\n          } catch (error) {\r\n            console.error('Error polling stock movements:', error);\r\n            send({ type: 'error', message: t('validation.pollingError', 'Polling error') });\r\n          }\r\n        }, 2000); // Poll every 2 seconds\r\n\r\n        // Keep connection alive with heartbeat\r\n        const heartbeat = setInterval(() => {\r\n          send({ type: 'heartbeat', timestamp: new Date().toISOString() });\r\n        }, 30000); // Every 30 seconds\r\n\r\n        // Cleanup on close\r\n        request.signal.addEventListener('abort', () => {\r\n          clearInterval(heartbeat);\r\n          clearInterval(pollInterval);\r\n          controller.close();\r\n        });\r\n      },\r\n    });\r\n\r\n    return new Response(stream, {\r\n      headers: {\r\n        'Content-Type': 'text/event-stream',\r\n        'Cache-Control': 'no-cache',\r\n        'Connection': 'keep-alive',\r\n        'X-Accel-Buffering': 'no', // Disable buffering in nginx\r\n      },\r\n    });\r\n  } catch (error: any) {\r\n    console.error('Error setting up real-time stock tracking:', error);\r\n    const t = await getValidationTranslatorFromRequest(request);\r\n    return new Response(t('validation.internalServerError', 'Internal server error'), { status: 500 });\r\n  }\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\invoices\\[id]\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":36,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":36,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1135,1138],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1135,1138],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'user' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":48,"column":23,"nodeType":null,"messageId":"unusedVar","endLine":48,"endColumn":27},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":67,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":67,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1933,1936],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1933,1936],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":109,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":109,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3303,3306],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3303,3306],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\nimport connectDB from '@/lib/mongodb';\r\nimport Invoice from '@/models/Invoice';\r\nimport { getTenantIdFromRequest, requireTenantAccess } from '@/lib/api-tenant';\r\nimport { createAuditLog, AuditActions } from '@/lib/audit';\r\n\r\nexport async function GET(\r\n  request: NextRequest,\r\n  { params }: { params: Promise<{ id: string }> }\r\n) {\r\n  try {\r\n    await connectDB();\r\n    const tenantId = await getTenantIdFromRequest(request);\r\n    const { id } = await params;\r\n    \r\n    if (!tenantId) {\r\n      return NextResponse.json({ success: false, error: 'Tenant not found or access denied' }, { status: 403 });\r\n    }\r\n\r\n    const invoice = await Invoice.findOne({\r\n      _id: id,\r\n      tenantId,\r\n    })\r\n      .populate('transactionId', 'receiptNumber total items')\r\n      .populate('customerId', 'name email phone address')\r\n      .lean();\r\n\r\n    if (!invoice) {\r\n      return NextResponse.json(\r\n        { success: false, error: 'Invoice not found' },\r\n        { status: 404 }\r\n      );\r\n    }\r\n\r\n    return NextResponse.json({ success: true, data: invoice });\r\n  } catch (error: any) {\r\n    return NextResponse.json({ success: false, error: error.message }, { status: 500 });\r\n  }\r\n}\r\n\r\nexport async function PATCH(\r\n  request: NextRequest,\r\n  { params }: { params: Promise<{ id: string }> }\r\n) {\r\n  try {\r\n    await connectDB();\r\n    const tenantAccess = await requireTenantAccess(request);\r\n    const { tenantId, user } = tenantAccess;\r\n    const { id } = await params;\r\n    \r\n    const body = await request.json();\r\n    const { status, notes, paidAmount } = body;\r\n\r\n    const invoice = await Invoice.findOne({\r\n      _id: id,\r\n      tenantId,\r\n    });\r\n\r\n    if (!invoice) {\r\n      return NextResponse.json(\r\n        { success: false, error: 'Invoice not found' },\r\n        { status: 404 }\r\n      );\r\n    }\r\n\r\n    const previousStatus = invoice.status;\r\n    const changes: any = {};\r\n\r\n    // Update status if provided\r\n    if (status && ['draft', 'sent', 'paid', 'overdue', 'cancelled'].includes(status)) {\r\n      invoice.status = status;\r\n      changes.status = status;\r\n\r\n      // If marking as paid, update paid fields\r\n      if (status === 'paid') {\r\n        invoice.paidAt = new Date();\r\n        invoice.paidAmount = paidAmount || invoice.total;\r\n        changes.paidAt = invoice.paidAt;\r\n        changes.paidAmount = invoice.paidAmount;\r\n      }\r\n    }\r\n\r\n    // Update notes if provided\r\n    if (notes !== undefined) {\r\n      invoice.notes = notes;\r\n      changes.notes = notes;\r\n    }\r\n\r\n    await invoice.save();\r\n\r\n    // Determine audit action\r\n    let auditAction: typeof AuditActions.INVOICE_UPDATE | typeof AuditActions.INVOICE_SEND | typeof AuditActions.INVOICE_MARK_PAID = AuditActions.INVOICE_UPDATE;\r\n    if (status === 'sent' && previousStatus !== 'sent') {\r\n      auditAction = AuditActions.INVOICE_SEND;\r\n    } else if (status === 'paid' && previousStatus !== 'paid') {\r\n      auditAction = AuditActions.INVOICE_MARK_PAID;\r\n    }\r\n\r\n    // Create audit log\r\n    await createAuditLog(request, {\r\n      tenantId,\r\n      action: auditAction,\r\n      entityType: 'invoice',\r\n      entityId: invoice._id.toString(),\r\n      changes,\r\n    });\r\n\r\n    return NextResponse.json({ success: true, data: invoice });\r\n  } catch (error: any) {\r\n    return NextResponse.json({ success: false, error: error.message }, { status: 400 });\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\invoices\\from-transaction\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'user' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":17,"column":23,"nodeType":null,"messageId":"unusedVar","endLine":17,"endColumn":27},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":56,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":56,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1801,1804],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1801,1804],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":63,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":63,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2012,2015],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2012,2015],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":113,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":113,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3577,3580],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3577,3580],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\nimport connectDB from '@/lib/mongodb';\r\nimport Invoice from '@/models/Invoice';\r\nimport Transaction from '@/models/Transaction';\r\nimport Customer from '@/models/Customer';\r\nimport { requireTenantAccess } from '@/lib/api-tenant';\r\nimport { createAuditLog, AuditActions } from '@/lib/audit';\r\nimport { generateInvoiceNumber } from '@/lib/receipt';\r\n\r\n/**\r\n * Create an invoice from an existing transaction (for B2B scenarios)\r\n */\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    await connectDB();\r\n    const tenantAccess = await requireTenantAccess(request);\r\n    const { tenantId, user } = tenantAccess;\r\n    \r\n    const body = await request.json();\r\n    const { transactionId, customerId, dueDate, paymentTerms, notes } = body;\r\n\r\n    if (!transactionId) {\r\n      return NextResponse.json(\r\n        { success: false, error: 'Transaction ID is required' },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    // Get transaction\r\n    const transaction = await Transaction.findOne({\r\n      _id: transactionId,\r\n      tenantId,\r\n    }).lean();\r\n\r\n    if (!transaction) {\r\n      return NextResponse.json(\r\n        { success: false, error: 'Transaction not found' },\r\n        { status: 404 }\r\n      );\r\n    }\r\n\r\n    // Get customer info if customerId provided\r\n    let customerInfo = null;\r\n    if (customerId) {\r\n      const customer = await Customer.findOne({\r\n        _id: customerId,\r\n        tenantId,\r\n      }).lean();\r\n\r\n      if (customer) {\r\n        customerInfo = {\r\n          name: `${customer.firstName} ${customer.lastName}`.trim(),\r\n          email: customer.email,\r\n          phone: customer.phone,\r\n          address: customer.addresses && customer.addresses.length > 0 \r\n            ? customer.addresses.find((addr: any) => addr.isDefault) || customer.addresses[0]\r\n            : undefined,\r\n        };\r\n      }\r\n    }\r\n\r\n    // Convert transaction items to invoice items\r\n    const invoiceItems = transaction.items.map((item: any) => ({\r\n      name: item.name,\r\n      description: item.product?.name || '',\r\n      quantity: item.quantity,\r\n      price: item.price,\r\n      subtotal: item.subtotal,\r\n    }));\r\n\r\n    // Calculate due date (default to 30 days if not provided)\r\n    const invoiceDueDate = dueDate ? new Date(dueDate) : new Date();\r\n    if (!dueDate) {\r\n      invoiceDueDate.setDate(invoiceDueDate.getDate() + 30);\r\n    }\r\n\r\n    // Generate invoice number\r\n    const invoiceNumber = await generateInvoiceNumber(tenantId);\r\n\r\n    // Create invoice\r\n    const invoice = await Invoice.create({\r\n      tenantId,\r\n      invoiceNumber,\r\n      transactionId: transaction._id,\r\n      customerId: customerId || undefined,\r\n      customerInfo,\r\n      items: invoiceItems,\r\n      subtotal: transaction.subtotal,\r\n      discountAmount: transaction.discountAmount || undefined,\r\n      taxAmount: transaction.taxAmount || 0,\r\n      total: transaction.total,\r\n      dueDate: invoiceDueDate,\r\n      paymentTerms: paymentTerms || 'Net 30',\r\n      status: 'draft',\r\n      notes: notes || undefined,\r\n    });\r\n\r\n    // Create audit log\r\n    await createAuditLog(request, {\r\n      tenantId,\r\n      action: AuditActions.INVOICE_CREATE,\r\n      entityType: 'invoice',\r\n      entityId: invoice._id.toString(),\r\n      changes: {\r\n        invoiceNumber,\r\n        transactionId: transactionId.toString(),\r\n        customerId: customerId?.toString(),\r\n        total: transaction.total,\r\n      },\r\n    });\r\n\r\n    return NextResponse.json({ success: true, data: invoice }, { status: 201 });\r\n  } catch (error: any) {\r\n    return NextResponse.json({ success: false, error: error.message }, { status: 400 });\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\invoices\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":27,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":27,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1134,1137],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1134,1137],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":62,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":62,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1954,1957],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1954,1957],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'user' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":71,"column":23,"nodeType":null,"messageId":"unusedVar","endLine":71,"endColumn":27},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":132,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":132,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3966,3969],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3966,3969],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":174,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":174,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5155,5158],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5155,5158],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\nimport connectDB from '@/lib/mongodb';\r\nimport Invoice from '@/models/Invoice';\r\nimport Transaction from '@/models/Transaction';\r\nimport Customer from '@/models/Customer';\r\nimport { getTenantIdFromRequest, requireTenantAccess } from '@/lib/api-tenant';\r\nimport { createAuditLog, AuditActions } from '@/lib/audit';\r\nimport { generateInvoiceNumber } from '@/lib/receipt';\r\n\r\nexport async function GET(request: NextRequest) {\r\n  try {\r\n    await connectDB();\r\n    const tenantId = await getTenantIdFromRequest(request);\r\n    \r\n    if (!tenantId) {\r\n      return NextResponse.json({ success: false, error: 'Tenant not found or access denied' }, { status: 403 });\r\n    }\r\n    \r\n    const searchParams = request.nextUrl.searchParams;\r\n    const limit = parseInt(searchParams.get('limit') || '50');\r\n    const page = parseInt(searchParams.get('page') || '1');\r\n    const skip = (page - 1) * limit;\r\n    const status = searchParams.get('status');\r\n    const customerId = searchParams.get('customerId');\r\n    const overdue = searchParams.get('overdue') === 'true';\r\n\r\n    const query: any = { tenantId };\r\n    \r\n    if (status) {\r\n      query.status = status;\r\n    }\r\n    \r\n    if (customerId) {\r\n      query.customerId = customerId;\r\n    }\r\n    \r\n    if (overdue) {\r\n      query.status = { $in: ['sent', 'draft'] };\r\n      query.dueDate = { $lt: new Date() };\r\n    }\r\n\r\n    const invoices = await Invoice.find(query)\r\n      .sort({ createdAt: -1 })\r\n      .limit(limit)\r\n      .skip(skip)\r\n      .populate('transactionId', 'receiptNumber total')\r\n      .populate('customerId', 'name email phone')\r\n      .lean();\r\n\r\n    const total = await Invoice.countDocuments(query);\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      data: invoices || [],\r\n      pagination: {\r\n        total,\r\n        page,\r\n        limit,\r\n        pages: Math.ceil(total / limit),\r\n      },\r\n    });\r\n  } catch (error: any) {\r\n    return NextResponse.json({ success: false, error: error.message }, { status: 500 });\r\n  }\r\n}\r\n\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    await connectDB();\r\n    const tenantAccess = await requireTenantAccess(request);\r\n    const { tenantId, user } = tenantAccess;\r\n    \r\n    const body = await request.json();\r\n    const { \r\n      transactionId, \r\n      customerId, \r\n      items, \r\n      subtotal, \r\n      discountAmount, \r\n      taxAmount, \r\n      total, \r\n      dueDate, \r\n      paymentTerms, \r\n      notes,\r\n      customerInfo \r\n    } = body;\r\n\r\n    // Validate required fields\r\n    if (!items || !Array.isArray(items) || items.length === 0) {\r\n      return NextResponse.json(\r\n        { success: false, error: 'Invoice items are required' },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    if (!subtotal || !taxAmount || !total || !dueDate) {\r\n      return NextResponse.json(\r\n        { success: false, error: 'Subtotal, tax amount, total, and due date are required' },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    // If transactionId provided, verify it exists and belongs to tenant\r\n    if (transactionId) {\r\n      const transaction = await Transaction.findOne({\r\n        _id: transactionId,\r\n        tenantId,\r\n      });\r\n\r\n      if (!transaction) {\r\n        return NextResponse.json(\r\n          { success: false, error: 'Transaction not found' },\r\n          { status: 404 }\r\n        );\r\n      }\r\n    }\r\n\r\n    // If customerId provided, get customer info\r\n    let finalCustomerInfo = customerInfo;\r\n    if (customerId && !customerInfo) {\r\n      const customer = await Customer.findOne({\r\n        _id: customerId,\r\n        tenantId,\r\n      }).lean();\r\n\r\n      if (customer) {\r\n        finalCustomerInfo = {\r\n          name: `${customer.firstName} ${customer.lastName}`.trim(),\r\n          email: customer.email,\r\n          phone: customer.phone,\r\n          address: customer.addresses && customer.addresses.length > 0 \r\n            ? customer.addresses.find((addr: any) => addr.isDefault) || customer.addresses[0]\r\n            : undefined,\r\n        };\r\n      }\r\n    }\r\n\r\n    // Generate invoice number\r\n    const invoiceNumber = await generateInvoiceNumber(tenantId);\r\n\r\n    // Create invoice\r\n    const invoice = await Invoice.create({\r\n      tenantId,\r\n      invoiceNumber,\r\n      transactionId: transactionId || undefined,\r\n      customerId: customerId || undefined,\r\n      customerInfo: finalCustomerInfo,\r\n      items,\r\n      subtotal,\r\n      discountAmount: discountAmount || undefined,\r\n      taxAmount,\r\n      total,\r\n      dueDate: new Date(dueDate),\r\n      paymentTerms: paymentTerms || 'Due on receipt',\r\n      status: 'draft',\r\n      notes: notes || undefined,\r\n    });\r\n\r\n    // Create audit log\r\n    await createAuditLog(request, {\r\n      tenantId,\r\n      action: AuditActions.INVOICE_CREATE,\r\n      entityType: 'invoice',\r\n      entityId: invoice._id.toString(),\r\n      changes: {\r\n        invoiceNumber,\r\n        customerId: customerId?.toString(),\r\n        transactionId: transactionId?.toString(),\r\n        total,\r\n      },\r\n    });\r\n\r\n    return NextResponse.json({ success: true, data: invoice }, { status: 201 });\r\n  } catch (error: any) {\r\n    return NextResponse.json({ success: false, error: error.message }, { status: 400 });\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\payments\\[id]\\refund\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'user' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":14,"column":23,"nodeType":null,"messageId":"unusedVar","endLine":14,"endColumn":27},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":61,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":61,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1679,1682],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1679,1682],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\nimport connectDB from '@/lib/mongodb';\r\nimport Payment from '@/models/Payment';\r\nimport { requireTenantAccess } from '@/lib/api-tenant';\r\nimport { createAuditLog, AuditActions } from '@/lib/audit';\r\n\r\nexport async function POST(\r\n  request: NextRequest,\r\n  { params }: { params: Promise<{ id: string }> }\r\n) {\r\n  try {\r\n    await connectDB();\r\n    const tenantAccess = await requireTenantAccess(request);\r\n    const { tenantId, user } = tenantAccess;\r\n    const { id: paymentId } = await params;\r\n    \r\n    const { refundReason } = await request.json();\r\n\r\n    // Find payment\r\n    const payment = await Payment.findOne({\r\n      _id: paymentId,\r\n      tenantId,\r\n    });\r\n\r\n    if (!payment) {\r\n      return NextResponse.json(\r\n        { success: false, error: 'Payment not found' },\r\n        { status: 404 }\r\n      );\r\n    }\r\n\r\n    // Check if already refunded\r\n    if (payment.status === 'refunded') {\r\n      return NextResponse.json(\r\n        { success: false, error: 'Payment already refunded' },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    // Update payment status\r\n    payment.status = 'refunded';\r\n    payment.refundedAt = new Date();\r\n    if (refundReason) {\r\n      payment.refundReason = refundReason;\r\n    }\r\n    await payment.save();\r\n\r\n    // Create audit log\r\n    await createAuditLog(request, {\r\n      tenantId,\r\n      action: AuditActions.PAYMENT_REFUND,\r\n      entityType: 'payment',\r\n      entityId: payment._id.toString(),\r\n      changes: {\r\n        status: 'refunded',\r\n        refundReason,\r\n      },\r\n    });\r\n\r\n    return NextResponse.json({ success: true, data: payment });\r\n  } catch (error: any) {\r\n    return NextResponse.json({ success: false, error: error.message }, { status: 400 });\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\payments\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":25,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":25,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1028,1031],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1028,1031],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":59,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":59,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1787,1790],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1787,1790],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":129,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":129,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3746,3749],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3746,3749],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\nimport connectDB from '@/lib/mongodb';\r\nimport Payment from '@/models/Payment';\r\nimport Transaction from '@/models/Transaction';\r\nimport { getTenantIdFromRequest, requireTenantAccess } from '@/lib/api-tenant';\r\nimport { createAuditLog, AuditActions } from '@/lib/audit';\r\n\r\nexport async function GET(request: NextRequest) {\r\n  try {\r\n    await connectDB();\r\n    const tenantId = await getTenantIdFromRequest(request);\r\n    \r\n    if (!tenantId) {\r\n      return NextResponse.json({ success: false, error: 'Tenant not found or access denied' }, { status: 403 });\r\n    }\r\n    \r\n    const searchParams = request.nextUrl.searchParams;\r\n    const limit = parseInt(searchParams.get('limit') || '50');\r\n    const page = parseInt(searchParams.get('page') || '1');\r\n    const skip = (page - 1) * limit;\r\n    const status = searchParams.get('status');\r\n    const method = searchParams.get('method');\r\n    const transactionId = searchParams.get('transactionId');\r\n\r\n    const query: any = { tenantId };\r\n    \r\n    if (status) {\r\n      query.status = status;\r\n    }\r\n    \r\n    if (method) {\r\n      query.method = method;\r\n    }\r\n    \r\n    if (transactionId) {\r\n      query.transactionId = transactionId;\r\n    }\r\n\r\n    const payments = await Payment.find(query)\r\n      .sort({ createdAt: -1 })\r\n      .limit(limit)\r\n      .skip(skip)\r\n      .populate('transactionId', 'receiptNumber total')\r\n      .populate('processedBy', 'name email')\r\n      .lean();\r\n\r\n    const total = await Payment.countDocuments(query);\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      data: payments || [],\r\n      pagination: {\r\n        total,\r\n        page,\r\n        limit,\r\n        pages: Math.ceil(total / limit),\r\n      },\r\n    });\r\n  } catch (error: any) {\r\n    return NextResponse.json({ success: false, error: error.message }, { status: 500 });\r\n  }\r\n}\r\n\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    await connectDB();\r\n    const tenantAccess = await requireTenantAccess(request);\r\n    const { tenantId, user } = tenantAccess;\r\n    \r\n    const body = await request.json();\r\n    const { transactionId, method, amount, details } = body;\r\n\r\n    // Validate required fields\r\n    if (!transactionId || !method || !amount) {\r\n      return NextResponse.json(\r\n        { success: false, error: 'Transaction ID, payment method, and amount are required' },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    // Validate payment method\r\n    const validMethods = ['cash', 'card', 'digital', 'check', 'other'];\r\n    if (!validMethods.includes(method)) {\r\n      return NextResponse.json(\r\n        { success: false, error: 'Invalid payment method' },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    // Verify transaction exists and belongs to tenant\r\n    const transaction = await Transaction.findOne({\r\n      _id: transactionId,\r\n      tenantId,\r\n    });\r\n\r\n    if (!transaction) {\r\n      return NextResponse.json(\r\n        { success: false, error: 'Transaction not found' },\r\n        { status: 404 }\r\n      );\r\n    }\r\n\r\n    // Create payment record\r\n    const payment = await Payment.create({\r\n      tenantId,\r\n      transactionId,\r\n      method,\r\n      amount,\r\n      details,\r\n      status: 'completed',\r\n      processedBy: user.userId,\r\n      processedAt: new Date(),\r\n    });\r\n\r\n    // Create audit log\r\n    await createAuditLog(request, {\r\n      tenantId,\r\n      action: AuditActions.PAYMENT_CREATE,\r\n      entityType: 'payment',\r\n      entityId: payment._id.toString(),\r\n      changes: {\r\n        transactionId: transactionId.toString(),\r\n        method,\r\n        amount,\r\n      },\r\n    });\r\n\r\n    return NextResponse.json({ success: true, data: payment }, { status: 201 });\r\n  } catch (error: any) {\r\n    return NextResponse.json({ success: false, error: error.message }, { status: 400 });\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\paypal\\cancel\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\paypal\\create-payment\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'user' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":14,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":14,"endColumn":15}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\nimport connectDB from '@/lib/mongodb';\r\nimport SubscriptionPlan from '@/models/SubscriptionPlan';\r\nimport { requireAuth } from '@/lib/auth';\r\nimport { getTenantIdFromRequest } from '@/lib/api-tenant';\r\nimport { getTenantSlugFromRequest } from '@/lib/api-tenant';\r\nimport { createSubscriptionPayment } from '@/lib/paypal';\r\n\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    await connectDB();\r\n\r\n    // Require authentication\r\n    const user = await requireAuth(request);\r\n    const tenantId = await getTenantIdFromRequest(request);\r\n    const tenantSlug = await getTenantSlugFromRequest(request);\r\n\r\n    if (!tenantId) {\r\n      return NextResponse.json(\r\n        { success: false, error: 'Tenant not found' },\r\n        { status: 404 }\r\n      );\r\n    }\r\n\r\n    const body = await request.json();\r\n    const { planId, billingCycle = 'monthly' } = body;\r\n\r\n    if (!planId) {\r\n      return NextResponse.json(\r\n        { success: false, error: 'Plan ID is required' },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    // Get the subscription plan\r\n    const plan = await SubscriptionPlan.findOne({ _id: planId, isActive: true });\r\n    if (!plan) {\r\n      return NextResponse.json(\r\n        { success: false, error: 'Subscription plan not found' },\r\n        { status: 404 }\r\n      );\r\n    }\r\n\r\n    // Calculate amount based on billing cycle\r\n    const amount = billingCycle === 'yearly'\r\n      ? plan.price.monthly * 12 * 0.9 // 10% discount for yearly\r\n      : plan.price.monthly;\r\n\r\n    // Create PayPal payment order\r\n    const paypalOrder = await createSubscriptionPayment(planId, amount, plan.price.currency, tenantSlug, 'en', billingCycle);\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      data: {\r\n        orderId: paypalOrder.id,\r\n        paypalOrder,\r\n        planId,\r\n        amount,\r\n        currency: plan.price.currency,\r\n        billingCycle,\r\n      },\r\n    });\r\n\r\n  } catch (error: unknown) {\r\n    console.error('Error creating PayPal payment:', error);\r\n    return NextResponse.json(\r\n      { success: false, error: (error as Error).message || 'Failed to create payment' },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\paypal\\success\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":27,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":27,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[951,954],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[951,954],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\nimport { capturePayment } from '@/lib/paypal';\r\n\r\nexport async function GET(request: NextRequest) {\r\n  try {\r\n    const { searchParams } = new URL(request.url);\r\n    const token = searchParams.get('token'); // PayPal order ID\r\n\r\n    if (!token) {\r\n      return NextResponse.redirect(new URL('/?payment=cancelled', request.url));\r\n    }\r\n\r\n    // Capture the payment\r\n    const captureResult = await capturePayment(token);\r\n\r\n    // Check if payment was successful\r\n    const isSuccessful = captureResult.status === 'COMPLETED';\r\n\r\n    if (isSuccessful) {\r\n      // Redirect to subscription activation page with success\r\n      return NextResponse.redirect(new URL(`/subscription/payment-success?orderId=${token}`, request.url));\r\n    } else {\r\n      // Redirect with failure\r\n      return NextResponse.redirect(new URL('/subscription/payment-failed', request.url));\r\n    }\r\n\r\n  } catch (error: any) {\r\n    console.error('Error processing PayPal success:', error);\r\n    return NextResponse.redirect(new URL('/subscription/payment-failed', request.url));\r\n  }\r\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\products\\[id]\\pin\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":46,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":46,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1519,1522],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1519,1522],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\nimport connectDB from '@/lib/mongodb';\r\nimport Product from '@/models/Product';\r\nimport { getTenantIdFromRequest } from '@/lib/api-tenant';\r\nimport { requireAuth } from '@/lib/auth';\r\nimport { createAuditLog, AuditActions } from '@/lib/audit';\r\n\r\nexport async function POST(request: NextRequest, { params }: { params: Promise<{ id: string }> }) {\r\n  try {\r\n    await connectDB();\r\n    await requireAuth(request);\r\n    const tenantId = await getTenantIdFromRequest(request);\r\n    const { id } = await params;\r\n    \r\n    if (!tenantId) {\r\n      return NextResponse.json({ success: false, error: 'Tenant not found' }, { status: 404 });\r\n    }\r\n    \r\n    const product = await Product.findOne({ _id: id, tenantId });\r\n    if (!product) {\r\n      return NextResponse.json({ success: false, error: 'Product not found' }, { status: 404 });\r\n    }\r\n\r\n    // Toggle pinned status\r\n    const newPinnedStatus = !product.pinned;\r\n    const updatedProduct = await Product.findOneAndUpdate(\r\n      { _id: id, tenantId },\r\n      { pinned: newPinnedStatus },\r\n      { new: true, runValidators: true }\r\n    );\r\n\r\n    await createAuditLog(request, {\r\n      tenantId,\r\n      action: AuditActions.UPDATE,\r\n      entityType: 'product',\r\n      entityId: id,\r\n      changes: {\r\n        pinned: {\r\n          old: product.pinned,\r\n          new: newPinnedStatus,\r\n        },\r\n      },\r\n    });\r\n\r\n    return NextResponse.json({ success: true, data: updatedProduct });\r\n  } catch (error: any) {\r\n    console.error('Error toggling product pin:', error);\r\n    return NextResponse.json({ success: false, error: error.message }, { status: 500 });\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\products\\[id]\\refill\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":85,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":85,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2805,2808],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2805,2808],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\nimport connectDB from '@/lib/mongodb';\r\nimport { getTenantIdFromRequest } from '@/lib/api-tenant';\r\nimport { requireAuth } from '@/lib/auth';\r\nimport { updateStock } from '@/lib/stock';\r\nimport { createAuditLog, AuditActions } from '@/lib/audit';\r\nimport { handleApiError } from '@/lib/error-handler';\r\nimport { getValidationTranslatorFromRequest } from '@/lib/validation-translations';\r\n\r\nexport async function POST(request: NextRequest, { params }: { params: Promise<{ id: string }> }) {\r\n  try {\r\n    await connectDB();\r\n    const user = await requireAuth(request);\r\n    const tenantId = await getTenantIdFromRequest(request);\r\n    const { id } = await params;\r\n    const t = await getValidationTranslatorFromRequest(request);\r\n    \r\n    if (!tenantId) {\r\n      return NextResponse.json({ success: false, error: t('validation.tenantNotFound', 'Tenant not found') }, { status: 404 });\r\n    }\r\n    \r\n    const body = await request.json();\r\n    const { quantity, notes } = body;\r\n    \r\n    if (!quantity || quantity <= 0) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.quantityGreaterThanZero', 'Quantity must be greater than 0') },\r\n        { status: 400 }\r\n      );\r\n    }\r\n    \r\n    // Get product before update to track previous stock\r\n    const Product = (await import('@/models/Product')).default;\r\n    const productBefore = await Product.findOne({ _id: id, tenantId });\r\n    \r\n    if (!productBefore) {\r\n      return NextResponse.json({ success: false, error: t('validation.productNotFound', 'Product not found') }, { status: 404 });\r\n    }\r\n    \r\n    const previousStock = productBefore.stock;\r\n    \r\n    // Update stock using the stock utility function\r\n    await updateStock(\r\n      id,\r\n      tenantId,\r\n      quantity, // Positive quantity for refill\r\n      'purchase',\r\n      {\r\n        userId: user.userId,\r\n        reason: 'Stock refill',\r\n        notes: notes || undefined,\r\n      }\r\n    );\r\n    \r\n    // Get updated product\r\n    const product = await Product.findOne({ _id: id, tenantId });\r\n    \r\n    if (!product) {\r\n      return NextResponse.json({ success: false, error: t('validation.productNotFound', 'Product not found') }, { status: 404 });\r\n    }\r\n    \r\n    // Create audit log\r\n    await createAuditLog(request, {\r\n      tenantId,\r\n      action: AuditActions.UPDATE,\r\n      entityType: 'product',\r\n      entityId: id,\r\n      changes: {\r\n        stock: {\r\n          old: previousStock,\r\n          new: product.stock,\r\n        },\r\n        refillQuantity: quantity,\r\n      },\r\n    });\r\n    \r\n    return NextResponse.json({\r\n      success: true,\r\n      data: {\r\n        product,\r\n        refilledQuantity: quantity,\r\n        newStock: product.stock,\r\n      },\r\n    });\r\n  } catch (error: any) {\r\n    if (error.message === 'Product not found') {\r\n      return NextResponse.json({ success: false, error: error.message }, { status: 404 });\r\n    }\r\n    return handleApiError(error);\r\n  }\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\products\\[id]\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'requireAuth' is defined but never used. Allowed unused vars must match /^_/u.","line":5,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":21},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":37,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":37,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1682,1685],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1682,1685],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":50,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":50,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2158,2161],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2158,2161],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":91,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":91,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3535,3538],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3535,3538],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":124,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":124,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4597,4600],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4597,4600],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":143,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":143,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5120,5123],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5120,5123],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":156,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":156,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5544,5547],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5544,5547],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":182,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":182,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6398,6401],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6398,6401],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":8,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\nimport connectDB from '@/lib/mongodb';\r\nimport Product from '@/models/Product';\r\nimport { getTenantIdFromRequest, requireTenantAccess } from '@/lib/api-tenant';\r\nimport { requireAuth } from '@/lib/auth';\r\nimport { createAuditLog, AuditActions } from '@/lib/audit';\r\nimport { validateAndSanitize, validateProduct } from '@/lib/validation';\r\nimport { getValidationTranslatorFromRequest } from '@/lib/validation-translations';\r\nimport { handleApiError } from '@/lib/error-handler';\r\nimport { getTenantSettingsById } from '@/lib/tenant';\r\nimport { validateProductForBusiness } from '@/lib/business-type-helpers';\r\n\r\nexport async function GET(request: NextRequest, { params }: { params: Promise<{ id: string }> }) {\r\n  try {\r\n    await connectDB();\r\n    const tenantId = await getTenantIdFromRequest(request);\r\n    const { id } = await params;\r\n    \r\n    if (!tenantId) {\r\n      return NextResponse.json({ success: false, error: 'Tenant not found or access denied' }, { status: 403 });\r\n    }\r\n    \r\n    const product = await Product.findOne({ _id: id, tenantId }).lean();\r\n    \r\n    if (!product) {\r\n      return NextResponse.json({ success: false, error: 'Product not found' }, { status: 404 });\r\n    }\r\n    \r\n    // Ensure boolean fields are properly set\r\n    const productData = {\r\n      ...product,\r\n      trackInventory: product.trackInventory !== undefined ? Boolean(product.trackInventory) : true,\r\n      allowOutOfStockSales: product.allowOutOfStockSales !== undefined ? Boolean(product.allowOutOfStockSales) : false,\r\n    };\r\n    \r\n    return NextResponse.json({ success: true, data: productData });\r\n  } catch (error: any) {\r\n    return NextResponse.json({ success: false, error: error.message }, { status: 500 });\r\n  }\r\n}\r\n\r\nexport async function PUT(request: NextRequest, { params }: { params: Promise<{ id: string }> }) {\r\n  try {\r\n    await connectDB();\r\n    // SECURITY: Validate tenant access for authenticated requests\r\n    let tenantId: string;\r\n    try {\r\n      const tenantAccess = await requireTenantAccess(request);\r\n      tenantId = tenantAccess.tenantId;\r\n    } catch (authError: any) {\r\n      if (authError.message.includes('Unauthorized') || authError.message.includes('Forbidden')) {\r\n        return NextResponse.json(\r\n          { success: false, error: authError.message },\r\n          { status: authError.message.includes('Unauthorized') ? 401 : 403 }\r\n        );\r\n      }\r\n      throw authError;\r\n    }\r\n    const { id } = await params;\r\n    \r\n    const body = await request.json();\r\n    const t = await getValidationTranslatorFromRequest(request);\r\n    const { data, errors } = validateAndSanitize(body, validateProduct, t);\r\n\r\n    if (errors.length > 0) {\r\n      return NextResponse.json(\r\n        { success: false, errors },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    // Get tenant settings for business type validation\r\n    const tenantSettings = await getTenantSettingsById(tenantId);\r\n    if (tenantSettings) {\r\n      // Merge with existing product data for validation\r\n      const oldProduct = await Product.findOne({ _id: id, tenantId }).lean();\r\n      if (oldProduct) {\r\n        const mergedData = { ...oldProduct, ...data };\r\n        // Remove Mongoose internals before validation\r\n        const {\r\n          _id,\r\n          tenantId,\r\n          __v,\r\n          createdAt,\r\n          updatedAt,\r\n          collection,\r\n          db,\r\n          isNew,\r\n          errors: docErrors,\r\n          ...plainProduct\r\n        } = mergedData as any;\r\n        const businessValidation = validateProductForBusiness(plainProduct, tenantSettings);\r\n        if (!businessValidation.valid) {\r\n          return NextResponse.json(\r\n            {\r\n              success: false,\r\n              errors: businessValidation.errors.map(error => ({\r\n                field: 'businessType',\r\n                message: error,\r\n                code: 'businessTypeValidation',\r\n              })),\r\n            },\r\n            { status: 400 }\r\n          );\r\n        }\r\n      }\r\n    }\r\n\r\n    const oldProduct = await Product.findOne({ _id: id, tenantId }).lean();\r\n    if (!oldProduct) {\r\n      return NextResponse.json({ success: false, error: 'Product not found' }, { status: 404 });\r\n    }\r\n    const product = await Product.findOneAndUpdate(\r\n      { _id: id, tenantId },\r\n      data,\r\n      { new: true, runValidators: true }\r\n    );\r\n    \r\n    if (!product) {\r\n      return NextResponse.json({ success: false, error: 'Product not found' }, { status: 404 });\r\n    }\r\n\r\n    // Track changes\r\n    const changes: Record<string, any> = {};\r\n    Object.keys(data).forEach(key => {\r\n      if (oldProduct[key as keyof typeof oldProduct] !== data[key]) {\r\n        changes[key] = {\r\n          old: oldProduct[key as keyof typeof oldProduct],\r\n          new: data[key],\r\n        };\r\n      }\r\n    });\r\n\r\n    await createAuditLog(request, {\r\n      tenantId,\r\n      action: AuditActions.UPDATE,\r\n      entityType: 'product',\r\n      entityId: id,\r\n      changes,\r\n    });\r\n    \r\n    return NextResponse.json({ success: true, data: product });\r\n  } catch (error: any) {\r\n    return handleApiError(error);\r\n  }\r\n}\r\n\r\nexport async function DELETE(request: NextRequest, { params }: { params: Promise<{ id: string }> }) {\r\n  try {\r\n    await connectDB();\r\n    // SECURITY: Validate tenant access for authenticated requests\r\n    let tenantId: string;\r\n    try {\r\n      const tenantAccess = await requireTenantAccess(request);\r\n      tenantId = tenantAccess.tenantId;\r\n    } catch (authError: any) {\r\n      if (authError.message.includes('Unauthorized') || authError.message.includes('Forbidden')) {\r\n        return NextResponse.json(\r\n          { success: false, error: authError.message },\r\n          { status: authError.message.includes('Unauthorized') ? 401 : 403 }\r\n        );\r\n      }\r\n      throw authError;\r\n    }\r\n    const { id } = await params;\r\n    \r\n    const product = await Product.findOneAndDelete({ _id: id, tenantId });\r\n    \r\n    if (!product) {\r\n      return NextResponse.json({ success: false, error: 'Product not found' }, { status: 404 });\r\n    }\r\n\r\n    await createAuditLog(request, {\r\n      tenantId,\r\n      action: AuditActions.DELETE,\r\n      entityType: 'product',\r\n      entityId: id,\r\n      changes: { name: product.name },\r\n    });\r\n    \r\n    return NextResponse.json({ success: true, data: {} });\r\n  } catch (error: any) {\r\n    return handleApiError(error);\r\n  }\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\products\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'requireAuth' is defined but never used. Allowed unused vars must match /^_/u.","line":5,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":21},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":25,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":25,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1117,1120],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1117,1120],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":61,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":61,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2379,2382],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2379,2382],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\nimport connectDB from '@/lib/mongodb';\r\nimport Product from '@/models/Product';\r\nimport { getTenantIdFromRequest, requireTenantAccess } from '@/lib/api-tenant';\r\nimport { requireAuth } from '@/lib/auth';\r\nimport { createAuditLog, AuditActions } from '@/lib/audit';\r\nimport { validateAndSanitize, validateProduct } from '@/lib/validation';\r\nimport { getValidationTranslatorFromRequest } from '@/lib/validation-translations';\r\nimport { checkSubscriptionLimit, SubscriptionService } from '@/lib/subscription';\r\n\r\nexport async function GET(request: NextRequest) {\r\n  try {\r\n    await connectDB();\r\n    const tenantId = await getTenantIdFromRequest(request);\r\n    \r\n    if (!tenantId) {\r\n      return NextResponse.json({ success: false, error: 'Tenant not found or access denied' }, { status: 403 });\r\n    }\r\n    \r\n    const searchParams = request.nextUrl.searchParams;\r\n    const search = searchParams.get('search') || '';\r\n    const category = searchParams.get('category') || '';\r\n    const categoryId = searchParams.get('categoryId') || '';\r\n\r\n    const query: any = { tenantId };\r\n    if (search) {\r\n      const escapedSearch = search.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&');\r\n      query.$or = [\r\n        { name: { $regex: escapedSearch, $options: 'i' } },\r\n        { description: { $regex: escapedSearch, $options: 'i' } },\r\n        { sku: { $regex: escapedSearch, $options: 'i' } },\r\n      ];\r\n    }\r\n    if (category) {\r\n      query.category = category;\r\n    }\r\n    if (categoryId) {\r\n      query.categoryId = categoryId;\r\n    }\r\n\r\n    const products = await Product.find(query)\r\n      .populate('categoryId', 'name')\r\n      .sort({ pinned: -1, createdAt: -1 }) // Pinned products first, then by creation date\r\n      .lean();\r\n    \r\n    return NextResponse.json({ success: true, data: products });\r\n  } catch (_error: unknown) {\r\n    console.error('Error fetching products:', _error);\r\n    return NextResponse.json({ success: false, error: 'Failed to fetch products' }, { status: 500 });\r\n  }\r\n}\r\n\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    await connectDB();\r\n    // SECURITY: Validate tenant access for authenticated requests\r\n    let tenantId: string;\r\n    try {\r\n      const tenantAccess = await requireTenantAccess(request);\r\n      tenantId = tenantAccess.tenantId;\r\n    } catch (authError: any) {\r\n      if (authError.message.includes('Unauthorized') || authError.message.includes('Forbidden')) {\r\n        return NextResponse.json(\r\n          { success: false, error: authError.message },\r\n          { status: authError.message.includes('Unauthorized') ? 401 : 403 }\r\n        );\r\n      }\r\n      throw authError;\r\n    }\r\n    \r\n    const body = await request.json();\r\n    const t = await getValidationTranslatorFromRequest(request);\r\n    const { data, errors } = validateAndSanitize(body, validateProduct, t);\r\n\r\n    if (errors.length > 0) {\r\n      return NextResponse.json(\r\n        { success: false, errors },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    // Check subscription limits\r\n    const currentProductCount = await Product.countDocuments({ tenantId, isActive: true });\r\n    try {\r\n      await checkSubscriptionLimit(tenantId.toString(), 'maxProducts', currentProductCount);\r\n    } catch (limitError: unknown) {\r\n      return NextResponse.json(\r\n        { success: false, error: (limitError as Error).message },\r\n        { status: 403 }\r\n      );\r\n    }\r\n\r\n    const product = await Product.create({ ...data, tenantId });\r\n\r\n    await createAuditLog(request, {\r\n      tenantId,\r\n      action: AuditActions.CREATE,\r\n      entityType: 'product',\r\n      entityId: product._id.toString(),\r\n      changes: data,\r\n    });\r\n\r\n    // Update subscription usage\r\n    try {\r\n      await SubscriptionService.updateUsage(tenantId.toString(), {\r\n        products: currentProductCount + 1\r\n      });\r\n    } catch (usageError) {\r\n      console.error('Failed to update subscription usage:', usageError);\r\n      // Don't fail the request if usage update fails\r\n    }\r\n\r\n    return NextResponse.json({ success: true, data: product }, { status: 201 });\r\n  } catch (error: unknown) {\r\n    if ((error as Record<string, unknown>).code === 11000) {\r\n      return NextResponse.json(\r\n        { success: false, error: 'Product with this SKU already exists' },\r\n        { status: 400 }\r\n      );\r\n    }\r\n    console.error('Error creating product:', error);\r\n    return NextResponse.json({ success: false, error: 'Failed to create product' }, { status: 400 });\r\n  }\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\reports\\cash-drawer\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":30,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":30,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1264,1267],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1264,1267],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\nimport connectDB from '@/lib/mongodb';\r\nimport { getTenantIdFromRequest } from '@/lib/api-tenant';\r\nimport { requireAuth } from '@/lib/auth';\r\nimport { getCashDrawerReports } from '@/lib/analytics';\r\nimport { getValidationTranslatorFromRequest } from '@/lib/validation-translations';\r\n\r\nexport async function GET(request: NextRequest) {\r\n  try {\r\n    await connectDB();\r\n    await requireAuth(request);\r\n    const tenantId = await getTenantIdFromRequest(request);\r\n    const t = await getValidationTranslatorFromRequest(request);\r\n\r\n    if (!tenantId) {\r\n      return NextResponse.json({ success: false, error: t('validation.tenantNotFound', 'Tenant not found') }, { status: 404 });\r\n    }\r\n\r\n    const searchParams = request.nextUrl.searchParams;\r\n    const startDate = searchParams.get('startDate') \r\n      ? new Date(searchParams.get('startDate')!) \r\n      : new Date(new Date().setDate(new Date().getDate() - 30));\r\n    const endDate = searchParams.get('endDate') \r\n      ? new Date(searchParams.get('endDate')!) \r\n      : new Date();\r\n\r\n    const reports = await getCashDrawerReports(tenantId, startDate, endDate);\r\n\r\n    return NextResponse.json({ success: true, data: reports });\r\n  } catch (error: any) {\r\n    console.error('Error fetching cash drawer reports:', error);\r\n    return NextResponse.json({ success: false, error: error.message }, { status: 500 });\r\n  }\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\reports\\products\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":47,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":47,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2195,2198],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2195,2198],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\nimport connectDB from '@/lib/mongodb';\r\nimport { getTenantIdFromRequest } from '@/lib/api-tenant';\r\nimport { requireAuth } from '@/lib/auth';\r\nimport { getProductPerformance } from '@/lib/analytics';\r\nimport Product from '@/models/Product'; // Ensure Product model is registered\r\nimport Transaction from '@/models/Transaction'; // Ensure Transaction model is registered\r\nimport mongoose from 'mongoose';\r\nimport { getValidationTranslatorFromRequest } from '@/lib/validation-translations';\r\n\r\nexport async function GET(request: NextRequest) {\r\n  try {\r\n    await connectDB();\r\n    await requireAuth(request);\r\n    const tenantId = await getTenantIdFromRequest(request);\r\n    const t = await getValidationTranslatorFromRequest(request);\r\n\r\n    if (!tenantId) {\r\n      return NextResponse.json({ success: false, error: t('validation.tenantNotFound', 'Tenant not found') }, { status: 404 });\r\n    }\r\n\r\n    // Ensure models are registered by checking mongoose.models\r\n    // This is necessary for populate to work in Next.js serverless functions\r\n    // Accessing the models ensures their registration code has executed\r\n    if (!mongoose.models.Product) {\r\n      // Force model registration by accessing the model's modelName property\r\n      // This ensures the Product module's registration code has run\r\n      const _productName = Product.modelName;\r\n    }\r\n    if (!mongoose.models.Transaction) {\r\n      // Force model registration by accessing the model's modelName property\r\n      const _transactionName = Transaction.modelName;\r\n    }\r\n\r\n    const searchParams = request.nextUrl.searchParams;\r\n    const startDate = searchParams.get('startDate') \r\n      ? new Date(searchParams.get('startDate')!) \r\n      : new Date(new Date().setDate(new Date().getDate() - 30));\r\n    const endDate = searchParams.get('endDate') \r\n      ? new Date(searchParams.get('endDate')!) \r\n      : new Date();\r\n    const limit = parseInt(searchParams.get('limit') || '10', 10);\r\n\r\n    const performance = await getProductPerformance(tenantId, startDate, endDate, limit);\r\n\r\n    return NextResponse.json({ success: true, data: performance });\r\n  } catch (error: any) {\r\n    console.error('Error fetching product performance:', error);\r\n    return NextResponse.json({ success: false, error: error.message }, { status: 500 });\r\n  }\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\reports\\profit-loss\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":30,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":30,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1264,1267],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1264,1267],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\nimport connectDB from '@/lib/mongodb';\r\nimport { getTenantIdFromRequest } from '@/lib/api-tenant';\r\nimport { requireAuth } from '@/lib/auth';\r\nimport { getProfitLossSummary } from '@/lib/analytics';\r\nimport { getValidationTranslatorFromRequest } from '@/lib/validation-translations';\r\n\r\nexport async function GET(request: NextRequest) {\r\n  try {\r\n    await connectDB();\r\n    await requireAuth(request);\r\n    const tenantId = await getTenantIdFromRequest(request);\r\n    const t = await getValidationTranslatorFromRequest(request);\r\n\r\n    if (!tenantId) {\r\n      return NextResponse.json({ success: false, error: t('validation.tenantNotFound', 'Tenant not found') }, { status: 404 });\r\n    }\r\n\r\n    const searchParams = request.nextUrl.searchParams;\r\n    const startDate = searchParams.get('startDate') \r\n      ? new Date(searchParams.get('startDate')!) \r\n      : new Date(new Date().setDate(new Date().getDate() - 30));\r\n    const endDate = searchParams.get('endDate') \r\n      ? new Date(searchParams.get('endDate')!) \r\n      : new Date();\r\n\r\n    const summary = await getProfitLossSummary(tenantId, startDate, endDate);\r\n\r\n    return NextResponse.json({ success: true, data: summary });\r\n  } catch (error: any) {\r\n    console.error('Error fetching profit & loss summary:', error);\r\n    return NextResponse.json({ success: false, error: error.message }, { status: 500 });\r\n  }\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\reports\\sales\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":27,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":27,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1274,1277],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1274,1277],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\nimport connectDB from '@/lib/mongodb';\r\nimport { getTenantIdFromRequest } from '@/lib/api-tenant';\r\nimport { requireAuth } from '@/lib/auth';\r\nimport { getSalesReport } from '@/lib/analytics';\r\nimport { getValidationTranslatorFromRequest } from '@/lib/validation-translations';\r\n\r\nexport async function GET(request: NextRequest) {\r\n  try {\r\n    await connectDB();\r\n    await requireAuth(request);\r\n    const tenantId = await getTenantIdFromRequest(request);\r\n    const t = await getValidationTranslatorFromRequest(request);\r\n\r\n    if (!tenantId) {\r\n      return NextResponse.json({ success: false, error: t('validation.tenantNotFound', 'Tenant not found') }, { status: 404 });\r\n    }\r\n\r\n    const searchParams = request.nextUrl.searchParams;\r\n    const period = (searchParams.get('period') || 'daily') as 'daily' | 'weekly' | 'monthly';\r\n    const startDate = searchParams.get('startDate') ? new Date(searchParams.get('startDate')!) : undefined;\r\n    const endDate = searchParams.get('endDate') ? new Date(searchParams.get('endDate')!) : undefined;\r\n\r\n    const report = await getSalesReport(tenantId, period, startDate, endDate);\r\n\r\n    return NextResponse.json({ success: true, data: report });\r\n  } catch (error: any) {\r\n    console.error('Error fetching sales report:', error);\r\n    return NextResponse.json({ success: false, error: error.message }, { status: 500 });\r\n  }\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\reports\\vat\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":36,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":36,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1520,1523],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1520,1523],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\nimport connectDB from '@/lib/mongodb';\r\nimport { getTenantIdFromRequest } from '@/lib/api-tenant';\r\nimport { requireAuth } from '@/lib/auth';\r\nimport { getVATReport } from '@/lib/analytics';\r\nimport Tenant from '@/models/Tenant';\r\nimport { getValidationTranslatorFromRequest } from '@/lib/validation-translations';\r\n\r\nexport async function GET(request: NextRequest) {\r\n  try {\r\n    await connectDB();\r\n    await requireAuth(request);\r\n    const tenantId = await getTenantIdFromRequest(request);\r\n    const t = await getValidationTranslatorFromRequest(request);\r\n\r\n    if (!tenantId) {\r\n      return NextResponse.json({ success: false, error: t('validation.tenantNotFound', 'Tenant not found') }, { status: 404 });\r\n    }\r\n\r\n    const tenant = await Tenant.findById(tenantId).lean();\r\n    if (!tenant) {\r\n      return NextResponse.json({ success: false, error: t('validation.tenantNotFound', 'Tenant not found') }, { status: 404 });\r\n    }\r\n\r\n    const searchParams = request.nextUrl.searchParams;\r\n    const startDate = searchParams.get('startDate') \r\n      ? new Date(searchParams.get('startDate')!) \r\n      : new Date(new Date().setDate(new Date().getDate() - 30));\r\n    const endDate = searchParams.get('endDate') \r\n      ? new Date(searchParams.get('endDate')!) \r\n      : new Date();\r\n\r\n    const report = await getVATReport(tenantId, startDate, endDate, tenant.settings);\r\n\r\n    return NextResponse.json({ success: true, data: report });\r\n  } catch (error: any) {\r\n    console.error('Error fetching VAT report:', error);\r\n    return NextResponse.json({ success: false, error: error.message }, { status: 500 });\r\n  }\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\saved-carts\\[id]\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":37,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":37,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1344,1347],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1344,1347],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":71,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":71,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2552,2555],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2552,2555],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\nimport connectDB from '@/lib/mongodb';\r\nimport SavedCart from '@/models/SavedCart';\r\nimport { getTenantIdFromRequest } from '@/lib/api-tenant';\r\nimport { requireAuth } from '@/lib/auth';\r\nimport mongoose from 'mongoose';\r\nimport { getValidationTranslatorFromRequest } from '@/lib/validation-translations';\r\n\r\nexport async function GET(\r\n  request: NextRequest,\r\n  { params }: { params: Promise<{ id: string }> }\r\n) {\r\n  try {\r\n    await connectDB();\r\n    const user = await requireAuth(request);\r\n    const tenantId = await getTenantIdFromRequest(request);\r\n    const { id } = await params;\r\n    const t = await getValidationTranslatorFromRequest(request);\r\n\r\n    if (!tenantId) {\r\n      return NextResponse.json({ success: false, error: t('validation.tenantNotFound', 'Tenant not found') }, { status: 404 });\r\n    }\r\n\r\n    const tenantObjectId = new mongoose.Types.ObjectId(tenantId);\r\n\r\n    const savedCart = await SavedCart.findOne({\r\n      _id: id,\r\n      tenantId: tenantObjectId,\r\n      userId: user.userId,\r\n    }).lean();\r\n\r\n    if (!savedCart) {\r\n      return NextResponse.json({ success: false, error: t('validation.savedCartNotFound', 'Saved cart not found') }, { status: 404 });\r\n    }\r\n\r\n    return NextResponse.json({ success: true, data: savedCart });\r\n  } catch (error: any) {\r\n    console.error('Error fetching saved cart:', error);\r\n    return NextResponse.json({ success: false, error: error.message }, { status: 500 });\r\n  }\r\n}\r\n\r\nexport async function DELETE(\r\n  request: NextRequest,\r\n  { params }: { params: Promise<{ id: string }> }\r\n) {\r\n  try {\r\n    await connectDB();\r\n    const user = await requireAuth(request);\r\n    const tenantId = await getTenantIdFromRequest(request);\r\n    const { id } = await params;\r\n    const t = await getValidationTranslatorFromRequest(request);\r\n\r\n    if (!tenantId) {\r\n      return NextResponse.json({ success: false, error: t('validation.tenantNotFound', 'Tenant not found') }, { status: 404 });\r\n    }\r\n\r\n    const tenantObjectId = new mongoose.Types.ObjectId(tenantId);\r\n\r\n    const savedCart = await SavedCart.findOneAndDelete({\r\n      _id: id,\r\n      tenantId: tenantObjectId,\r\n      userId: user.userId,\r\n    });\r\n\r\n    if (!savedCart) {\r\n      return NextResponse.json({ success: false, error: t('validation.savedCartNotFound', 'Saved cart not found') }, { status: 404 });\r\n    }\r\n\r\n    return NextResponse.json({ success: true, message: t('validation.savedCartDeleted', 'Saved cart deleted successfully') });\r\n  } catch (error: any) {\r\n    console.error('Error deleting saved cart:', error);\r\n    return NextResponse.json({ success: false, error: error.message }, { status: 500 });\r\n  }\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\saved-carts\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":29,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":29,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1013,1016],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1013,1016],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":79,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":79,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2784,2787],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2784,2787],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":94,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":94,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3394,3397],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3394,3397],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\nimport connectDB from '@/lib/mongodb';\r\nimport SavedCart from '@/models/SavedCart';\r\nimport { getTenantIdFromRequest } from '@/lib/api-tenant';\r\nimport { requireAuth } from '@/lib/auth';\r\nimport mongoose from 'mongoose';\r\nimport { getValidationTranslatorFromRequest } from '@/lib/validation-translations';\r\n\r\nexport async function GET(request: NextRequest) {\r\n  try {\r\n    await connectDB();\r\n    const user = await requireAuth(request);\r\n    const tenantId = await getTenantIdFromRequest(request);\r\n\r\n    if (!tenantId) {\r\n      return NextResponse.json({ success: false, error: 'Tenant not found' }, { status: 404 });\r\n    }\r\n\r\n    const tenantObjectId = new mongoose.Types.ObjectId(tenantId);\r\n    \r\n    const savedCarts = await SavedCart.find({\r\n      tenantId: tenantObjectId,\r\n      userId: user.userId,\r\n    })\r\n      .sort({ createdAt: -1 })\r\n      .lean();\r\n\r\n    return NextResponse.json({ success: true, data: savedCarts });\r\n  } catch (error: any) {\r\n    console.error('Error fetching saved carts:', error);\r\n    return NextResponse.json({ success: false, error: error.message }, { status: 500 });\r\n  }\r\n}\r\n\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    await connectDB();\r\n    const user = await requireAuth(request);\r\n    const tenantId = await getTenantIdFromRequest(request);\r\n    const t = await getValidationTranslatorFromRequest(request);\r\n\r\n    if (!tenantId) {\r\n      return NextResponse.json({ success: false, error: t('validation.tenantNotFound', 'Tenant not found') }, { status: 404 });\r\n    }\r\n\r\n    const body = await request.json();\r\n    const { name, items, subtotal, discountCode, discountAmount, total } = body;\r\n\r\n    // Validate required fields\r\n    if (!name || !name.trim()) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.cartNameRequired', 'Cart name is required') },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    if (!items || !Array.isArray(items) || items.length === 0) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.cartItemsRequired', 'Cart must contain at least one item') },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    // Validate items\r\n    for (const item of items) {\r\n      if (!item.productId || !item.name || item.price === undefined || !item.quantity || item.stock === undefined) {\r\n        return NextResponse.json(\r\n          { success: false, error: t('validation.invalidCartItem', 'Invalid cart item data') },\r\n          { status: 400 }\r\n        );\r\n      }\r\n    }\r\n\r\n    const tenantObjectId = new mongoose.Types.ObjectId(tenantId);\r\n\r\n    const savedCart = await SavedCart.create({\r\n      tenantId: tenantObjectId,\r\n      name: name.trim(),\r\n      items: items.map((item: any) => ({\r\n        productId: new mongoose.Types.ObjectId(item.productId),\r\n        name: item.name,\r\n        price: parseFloat(item.price),\r\n        quantity: parseInt(item.quantity),\r\n        stock: parseInt(item.stock),\r\n      })),\r\n      subtotal: parseFloat(subtotal) || 0,\r\n      discountCode: discountCode?.trim().toUpperCase() || undefined,\r\n      discountAmount: discountAmount ? parseFloat(discountAmount) : undefined,\r\n      total: parseFloat(total) || 0,\r\n      userId: user.userId,\r\n    });\r\n\r\n    return NextResponse.json({ success: true, data: savedCart }, { status: 201 });\r\n  } catch (error: any) {\r\n    console.error('Error saving cart:', error);\r\n    return NextResponse.json({ success: false, error: error.message }, { status: 500 });\r\n  }\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\services\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":41,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":41,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1472,1475],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1472,1475],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":63,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":63,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2042,2045],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2042,2045],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\nimport connectDB from '@/lib/mongodb';\r\nimport Product from '@/models/Product';\r\nimport Tenant from '@/models/Tenant';\r\nimport { getValidationTranslatorFromRequest } from '@/lib/validation-translations';\r\n\r\n/**\r\n * GET /api/services?tenantId={{tenantId}}\r\n * Public endpoint to list services (products with productType='service') for a tenant.\r\n */\r\nexport async function GET(request: NextRequest) {\r\n  let t: (key: string, fallback: string) => string;\r\n  try {\r\n    await connectDB();\r\n    t = await getValidationTranslatorFromRequest(request);\r\n\r\n    const tenantId = request.nextUrl.searchParams.get('tenantId');\r\n    if (!tenantId) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.tenantIdRequired', 'tenantId is required') },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    // Resolve tenant (accept slug or ObjectId)\r\n    const tenant = await Tenant.findOne({\r\n      $or: [{ slug: tenantId }, ...(tenantId.match(/^[0-9a-fA-F]{24}$/) ? [{ _id: tenantId }] : [])],\r\n      isActive: true,\r\n    }).lean();\r\n\r\n    if (!tenant) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.tenantNotFound', 'Tenant not found or inactive') },\r\n        { status: 404 }\r\n      );\r\n    }\r\n\r\n    const categoryId = request.nextUrl.searchParams.get('categoryId');\r\n    const search = request.nextUrl.searchParams.get('search');\r\n\r\n    const filter: Record<string, any> = {\r\n      tenantId: tenant._id,\r\n      productType: 'service',\r\n    };\r\n\r\n    if (categoryId) {\r\n      filter.categoryId = categoryId;\r\n    }\r\n\r\n    if (search) {\r\n      filter.$or = [\r\n        { name: { $regex: search, $options: 'i' } },\r\n        { description: { $regex: search, $options: 'i' } },\r\n      ];\r\n    }\r\n\r\n    const services = await Product.find(filter)\r\n      .select('name description price image category categoryId')\r\n      .sort({ name: 1 })\r\n      .lean();\r\n\r\n    return NextResponse.json({ success: true, data: services });\r\n  } catch (error: any) {\r\n    return NextResponse.json(\r\n      { success: false, error: error.message || 'Failed to fetch services' },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\stock-movements\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":26,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":26,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1087,1090],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1087,1090],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":55,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":55,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1793,1796],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1793,1796],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\nimport connectDB from '@/lib/mongodb';\r\nimport StockMovement from '@/models/StockMovement';\r\nimport { getTenantIdFromRequest } from '@/lib/api-tenant';\r\nimport { requireAuth } from '@/lib/auth';\r\nimport { getValidationTranslatorFromRequest } from '@/lib/validation-translations';\r\n\r\nexport async function GET(request: NextRequest) {\r\n  try {\r\n    await connectDB();\r\n    await requireAuth(request);\r\n    const tenantId = await getTenantIdFromRequest(request);\r\n    const t = await getValidationTranslatorFromRequest(request);\r\n    \r\n    if (!tenantId) {\r\n      return NextResponse.json({ success: false, error: t('validation.tenantNotFound', 'Tenant not found') }, { status: 404 });\r\n    }\r\n\r\n    const searchParams = request.nextUrl.searchParams;\r\n    const productId = searchParams.get('productId');\r\n    const type = searchParams.get('type');\r\n    const limit = parseInt(searchParams.get('limit') || '50');\r\n    const page = parseInt(searchParams.get('page') || '1');\r\n    const skip = (page - 1) * limit;\r\n\r\n    const query: any = { tenantId };\r\n    if (productId) {\r\n      query.productId = productId;\r\n    }\r\n    if (type) {\r\n      query.type = type;\r\n    }\r\n\r\n    const movements = await StockMovement.find(query)\r\n      .sort({ createdAt: -1 })\r\n      .limit(limit)\r\n      .skip(skip)\r\n      .populate('productId', 'name sku')\r\n      .populate('userId', 'name email')\r\n      .populate('transactionId', 'receiptNumber')\r\n      .lean();\r\n\r\n    const total = await StockMovement.countDocuments(query);\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      data: movements,\r\n      pagination: {\r\n        total,\r\n        page,\r\n        limit,\r\n        pages: Math.ceil(total / limit),\r\n      },\r\n    });\r\n  } catch (error: any) {\r\n    return NextResponse.json({ success: false, error: error.message }, { status: 500 });\r\n  }\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\subscription-plans\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'request' is defined but never used. Allowed unused args must match /^_/u.","line":6,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":34}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\nimport connectDB from '@/lib/mongodb';\r\nimport SubscriptionPlan from '@/models/SubscriptionPlan';\r\nimport { requireRole } from '@/lib/auth';\r\n\r\nexport async function GET(request: NextRequest) {\r\n  try {\r\n    await connectDB();\r\n\r\n    const plans = await SubscriptionPlan.find({ isActive: true })\r\n      .sort({ 'price.monthly': 1 })\r\n      .lean();\r\n\r\n    return NextResponse.json({ success: true, data: plans });\r\n  } catch (_error: unknown) {\r\n    return NextResponse.json({ success: false, error: 'Failed to fetch plans' }, { status: 500 });\r\n  }\r\n}\r\n\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    await connectDB();\r\n    await requireRole(request, ['admin']);\r\n\r\n    const body = await request.json();\r\n    const { name, tier, description, price, features, isCustom = false } = body;\r\n\r\n    if (!name || !tier || !price?.monthly) {\r\n      return NextResponse.json(\r\n        { success: false, error: 'Name, tier, and monthly price are required' },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    // Check if tier already exists\r\n    const existingPlan = await SubscriptionPlan.findOne({ tier });\r\n    if (existingPlan) {\r\n      return NextResponse.json(\r\n        { success: false, error: 'A plan with this tier already exists' },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    const planData = {\r\n      name,\r\n      tier,\r\n      description,\r\n      price: {\r\n        monthly: price.monthly,\r\n        currency: price.currency || 'PHP',\r\n      },\r\n      features: {\r\n        maxUsers: features?.maxUsers || 1,\r\n        maxBranches: features?.maxBranches || 1,\r\n        maxProducts: features?.maxProducts || 0,\r\n        maxTransactions: features?.maxTransactions || 0,\r\n        enableInventory: features?.enableInventory ?? true,\r\n        enableCategories: features?.enableCategories ?? true,\r\n        enableDiscounts: features?.enableDiscounts ?? false,\r\n        enableLoyaltyProgram: features?.enableLoyaltyProgram ?? false,\r\n        enableCustomerManagement: features?.enableCustomerManagement ?? false,\r\n        enableBookingScheduling: features?.enableBookingScheduling ?? false,\r\n        enableReports: features?.enableReports ?? true,\r\n        enableMultiBranch: features?.enableMultiBranch ?? false,\r\n        enableHardwareIntegration: features?.enableHardwareIntegration ?? false,\r\n        prioritySupport: features?.prioritySupport ?? false,\r\n        customIntegrations: features?.customIntegrations ?? false,\r\n        dedicatedAccountManager: features?.dedicatedAccountManager ?? false,\r\n      },\r\n      isActive: true,\r\n      isCustom,\r\n    };\r\n\r\n    const plan = await SubscriptionPlan.create(planData);\r\n\r\n    return NextResponse.json({ success: true, data: plan }, { status: 201 });\r\n  } catch (error: unknown) {\r\n    if ((error as Record<string, unknown>).code === 11000) {\r\n      return NextResponse.json(\r\n        { success: false, error: 'Plan tier already exists' },\r\n        { status: 400 }\r\n      );\r\n    }\r\n    return NextResponse.json({ success: false, error: 'Failed to create plan' }, { status: 400 });\r\n  }\r\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\subscription\\status\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\subscriptions\\[id]\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":29,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":29,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[907,910],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[907,910],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":54,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":54,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1585,1588],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1585,1588],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":107,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":107,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3279,3282],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3279,3282],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":145,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":145,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4398,4401],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4398,4401],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\nimport connectDB from '@/lib/mongodb';\r\nimport Subscription from '@/models/Subscription';\r\nimport Tenant from '@/models/Tenant';\r\nimport { requireRole } from '@/lib/auth';\r\nimport { createAuditLog, AuditActions } from '@/lib/audit';\r\n\r\nexport async function GET(\r\n  request: NextRequest,\r\n  { params }: { params: Promise<{ id: string }> }\r\n) {\r\n  try {\r\n    await connectDB();\r\n    const { id } = await params;\r\n\r\n    const subscription = await Subscription.findById(id)\r\n      .populate('tenantId', 'slug name settings')\r\n      .populate('planId', 'name tier price features')\r\n      .lean();\r\n\r\n    if (!subscription) {\r\n      return NextResponse.json(\r\n        { success: false, error: 'Subscription not found' },\r\n        { status: 404 }\r\n      );\r\n    }\r\n\r\n    return NextResponse.json({ success: true, data: subscription });\r\n  } catch (error: any) {\r\n    return NextResponse.json({ success: false, error: error.message }, { status: 500 });\r\n  }\r\n}\r\n\r\nexport async function PUT(\r\n  request: NextRequest,\r\n  { params }: { params: Promise<{ id: string }> }\r\n) {\r\n  try {\r\n    await connectDB();\r\n    await requireRole(request, ['admin']);\r\n    const { id } = await params;\r\n\r\n    const body = await request.json();\r\n    const { status, billingCycle, autoRenew, planId } = body;\r\n\r\n    const subscription = await Subscription.findById(id);\r\n    if (!subscription) {\r\n      return NextResponse.json(\r\n        { success: false, error: 'Subscription not found' },\r\n        { status: 404 }\r\n      );\r\n    }\r\n\r\n    const changes: any = {};\r\n\r\n    // Update status if provided\r\n    if (status && ['active', 'inactive', 'cancelled', 'suspended', 'trial'].includes(status)) {\r\n      changes.status = status;\r\n      if (status === 'cancelled') {\r\n        changes.cancelledAt = new Date();\r\n        changes.autoRenew = false;\r\n      } else if (status === 'suspended') {\r\n        changes.suspendedAt = new Date();\r\n      }\r\n    }\r\n\r\n    // Update billing cycle if provided\r\n    if (billingCycle && ['monthly', 'yearly'].includes(billingCycle)) {\r\n      changes.billingCycle = billingCycle;\r\n    }\r\n\r\n    // Update auto-renew if provided\r\n    if (typeof autoRenew === 'boolean') {\r\n      changes.autoRenew = autoRenew;\r\n    }\r\n\r\n    // Update plan if provided\r\n    if (planId) {\r\n      // Verify plan exists\r\n      const SubscriptionPlan = (await import('@/models/SubscriptionPlan')).default;\r\n      const plan = await SubscriptionPlan.findById(planId);\r\n      if (!plan || !plan.isActive) {\r\n        return NextResponse.json(\r\n          { success: false, error: 'Subscription plan not found or inactive' },\r\n          { status: 404 }\r\n        );\r\n      }\r\n      changes.planId = planId;\r\n    }\r\n\r\n    const updatedSubscription = await Subscription.findByIdAndUpdate(\r\n      id,\r\n      changes,\r\n      { new: true }\r\n    ).populate('tenantId', 'slug name')\r\n     .populate('planId', 'name tier price features');\r\n\r\n    await createAuditLog(request, {\r\n      tenantId: subscription.tenantId,\r\n      action: AuditActions.UPDATE,\r\n      entityType: 'subscription',\r\n      entityId: subscription._id.toString(),\r\n      changes,\r\n    });\r\n\r\n    return NextResponse.json({ success: true, data: updatedSubscription });\r\n  } catch (error: any) {\r\n    return NextResponse.json({ success: false, error: error.message }, { status: 400 });\r\n  }\r\n}\r\n\r\nexport async function DELETE(\r\n  request: NextRequest,\r\n  { params }: { params: Promise<{ id: string }> }\r\n) {\r\n  try {\r\n    await connectDB();\r\n    await requireRole(request, ['admin']);\r\n    const { id } = await params;\r\n\r\n    const subscription = await Subscription.findById(id);\r\n    if (!subscription) {\r\n      return NextResponse.json(\r\n        { success: false, error: 'Subscription not found' },\r\n        { status: 404 }\r\n      );\r\n    }\r\n\r\n    // Remove subscription reference from tenant\r\n    await Tenant.findByIdAndUpdate(subscription.tenantId, {\r\n      $unset: { subscriptionId: 1 }\r\n    });\r\n\r\n    await Subscription.findByIdAndDelete(id);\r\n\r\n    await createAuditLog(request, {\r\n      tenantId: subscription.tenantId,\r\n      action: AuditActions.DELETE,\r\n      entityType: 'subscription',\r\n      entityId: subscription._id.toString(),\r\n      changes: { deleted: true },\r\n    });\r\n\r\n    return NextResponse.json({ success: true, message: 'Subscription deleted successfully' });\r\n  } catch (error: any) {\r\n    return NextResponse.json({ success: false, error: error.message }, { status: 400 });\r\n  }\r\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\subscriptions\\activate\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'user' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":14,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":14,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'paypalOrderId' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":25,"column":47,"nodeType":null,"messageId":"unusedVar","endLine":25,"endColumn":60},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":50,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":50,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1531,1534],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1531,1534],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":131,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":131,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4080,4083],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4080,4083],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\nimport connectDB from '@/lib/mongodb';\r\nimport Subscription from '@/models/Subscription';\r\nimport SubscriptionPlan from '@/models/SubscriptionPlan';\r\nimport Tenant from '@/models/Tenant';\r\nimport { requireAuth } from '@/lib/auth';\r\nimport { getTenantIdFromRequest } from '@/lib/api-tenant';\r\n\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    await connectDB();\r\n\r\n    // Require authentication\r\n    const user = await requireAuth(request);\r\n    const tenantId = await getTenantIdFromRequest(request);\r\n\r\n    if (!tenantId) {\r\n      return NextResponse.json(\r\n        { success: false, error: 'Tenant not found' },\r\n        { status: 404 }\r\n      );\r\n    }\r\n\r\n    const body = await request.json();\r\n    const { planId, billingCycle = 'monthly', paypalOrderId } = body;\r\n\r\n    if (!planId) {\r\n      return NextResponse.json(\r\n        { success: false, error: 'Plan ID is required' },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    // Get the subscription plan\r\n    const plan = await SubscriptionPlan.findOne({ _id: planId, isActive: true });\r\n    if (!plan) {\r\n      return NextResponse.json(\r\n        { success: false, error: 'Subscription plan not found' },\r\n        { status: 404 }\r\n      );\r\n    }\r\n\r\n    // Check if tenant already has an active subscription\r\n    const existingSubscription = await Subscription.findOne({\r\n      tenantId,\r\n      status: { $in: ['active', 'trial'] }\r\n    });\r\n\r\n    const now = new Date();\r\n    let subscriptionData: any;\r\n\r\n    if (existingSubscription) {\r\n      // Update existing subscription\r\n      const endDate = billingCycle === 'yearly'\r\n        ? new Date(now.getTime() + 365 * 24 * 60 * 60 * 1000)\r\n        : new Date(now.getTime() + 30 * 24 * 60 * 60 * 1000);\r\n\r\n      subscriptionData = {\r\n        planId: plan._id,\r\n        status: 'active',\r\n        billingCycle,\r\n        endDate,\r\n        isTrial: false,\r\n        autoRenew: true,\r\n        updatedAt: now,\r\n      };\r\n\r\n      // Add billing history entry\r\n      subscriptionData.$push = {\r\n        billingHistory: {\r\n          amount: billingCycle === 'yearly' ? plan.price.monthly * 12 * 0.9 : plan.price.monthly,\r\n          currency: plan.price.currency,\r\n          status: 'paid',\r\n          billingCycle,\r\n          periodStart: now,\r\n          periodEnd: endDate,\r\n          createdAt: now,\r\n          description: `Subscription ${billingCycle === 'yearly' ? 'yearly' : 'monthly'} payment`,\r\n        }\r\n      };\r\n\r\n      await Subscription.findByIdAndUpdate(existingSubscription._id, subscriptionData);\r\n    } else {\r\n      // Create new subscription\r\n      const endDate = billingCycle === 'yearly'\r\n        ? new Date(now.getTime() + 365 * 24 * 60 * 60 * 1000)\r\n        : new Date(now.getTime() + 30 * 24 * 60 * 60 * 1000);\r\n\r\n      subscriptionData = {\r\n        tenantId,\r\n        planId: plan._id,\r\n        status: 'active',\r\n        billingCycle,\r\n        startDate: now,\r\n        endDate,\r\n        isTrial: false,\r\n        autoRenew: true,\r\n        usage: {\r\n          currentUsers: 1, // Admin user\r\n          currentBranches: 1,\r\n          currentProducts: 0,\r\n          currentTransactions: 0,\r\n          lastResetDate: now,\r\n        },\r\n        billingHistory: [{\r\n          amount: billingCycle === 'yearly' ? plan.price.monthly * 12 * 0.9 : plan.price.monthly,\r\n          currency: plan.price.currency,\r\n          status: 'paid',\r\n          billingCycle,\r\n          periodStart: now,\r\n          periodEnd: endDate,\r\n          createdAt: now,\r\n          description: `Initial subscription ${billingCycle === 'yearly' ? 'yearly' : 'monthly'} payment`,\r\n        }],\r\n      };\r\n\r\n      const subscription = await Subscription.create(subscriptionData);\r\n\r\n      // Update tenant with subscription reference\r\n      await Tenant.findByIdAndUpdate(tenantId, {\r\n        subscriptionId: subscription._id\r\n      });\r\n    }\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      message: 'Subscription activated successfully',\r\n      data: subscriptionData,\r\n    });\r\n\r\n  } catch (error: any) {\r\n    console.error('Error activating subscription:', error);\r\n    return NextResponse.json(\r\n      { success: false, error: error.message },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\subscriptions\\billing-history\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'user' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":12,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":15},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":37,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":37,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1240,1243],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1240,1243],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":54,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":54,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1763,1766],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1763,1766],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\nimport connectDB from '@/lib/mongodb';\r\nimport Subscription from '@/models/Subscription';\r\nimport { requireAuth } from '@/lib/auth';\r\nimport { getTenantIdFromRequest } from '@/lib/api-tenant';\r\n\r\nexport async function GET(request: NextRequest) {\r\n  try {\r\n    await connectDB();\r\n\r\n    // Require authentication\r\n    const user = await requireAuth(request);\r\n    const tenantId = await getTenantIdFromRequest(request);\r\n\r\n    if (!tenantId) {\r\n      return NextResponse.json(\r\n        { success: false, error: 'Tenant not found' },\r\n        { status: 404 }\r\n      );\r\n    }\r\n\r\n    // Get the current subscription for this tenant\r\n    const subscription = await Subscription.findOne({ tenantId }).lean();\r\n\r\n    if (!subscription) {\r\n      return NextResponse.json({\r\n        success: true,\r\n        data: [],\r\n      });\r\n    }\r\n\r\n    // For now, we'll return the billing history from the subscription\r\n    // In a real implementation, this would be a separate BillingHistory collection\r\n    const billingHistory = subscription.billingHistory || [];\r\n\r\n    // Transform the billing history to include proper date formatting\r\n    const formattedHistory = billingHistory.map((billing: any) => ({\r\n      _id: billing._id,\r\n      amount: billing.amount,\r\n      currency: billing.currency || 'PHP',\r\n      status: billing.status || 'paid',\r\n      billingCycle: billing.billingCycle || subscription.billingCycle,\r\n      periodStart: billing.periodStart,\r\n      periodEnd: billing.periodEnd,\r\n      createdAt: billing.createdAt || billing.date,\r\n      description: billing.description,\r\n    }));\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      data: formattedHistory,\r\n    });\r\n\r\n  } catch (error: any) {\r\n    console.error('Error fetching billing history:', error);\r\n    return NextResponse.json(\r\n      { success: false, error: error.message },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\subscriptions\\create-trial\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\subscriptions\\current\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'user' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":12,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":15},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":32,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":32,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[938,941],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[938,941],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\nimport connectDB from '@/lib/mongodb';\r\nimport Subscription from '@/models/Subscription';\r\nimport { requireAuth } from '@/lib/auth';\r\nimport { getTenantIdFromRequest } from '@/lib/api-tenant';\r\n\r\nexport async function GET(request: NextRequest) {\r\n  try {\r\n    await connectDB();\r\n\r\n    // Require authentication\r\n    const user = await requireAuth(request);\r\n    const tenantId = await getTenantIdFromRequest(request);\r\n\r\n    if (!tenantId) {\r\n      return NextResponse.json(\r\n        { success: false, error: 'Tenant not found' },\r\n        { status: 404 }\r\n      );\r\n    }\r\n\r\n    // Get the current subscription for this tenant\r\n    const subscription = await Subscription.findOne({ tenantId })\r\n      .populate('planId', 'name tier price features')\r\n      .lean();\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      data: subscription,\r\n    });\r\n\r\n  } catch (error: any) {\r\n    console.error('Error fetching current subscription:', error);\r\n    return NextResponse.json(\r\n      { success: false, error: error.message },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\subscriptions\\request-upgrade\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Tenant' is defined but never used. Allowed unused vars must match /^_/u.","line":5,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":14},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":90,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":90,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2789,2792],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2789,2792],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\nimport connectDB from '@/lib/mongodb';\r\nimport Subscription from '@/models/Subscription';\r\nimport SubscriptionPlan from '@/models/SubscriptionPlan';\r\nimport Tenant from '@/models/Tenant';\r\nimport { requireAuth } from '@/lib/auth';\r\nimport { getTenantIdFromRequest } from '@/lib/api-tenant';\r\n\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    await connectDB();\r\n\r\n    // Require authentication for upgrade requests\r\n    const user = await requireAuth(request);\r\n    const tenantId = await getTenantIdFromRequest(request);\r\n\r\n    if (!tenantId) {\r\n      return NextResponse.json(\r\n        { success: false, error: 'Tenant not found' },\r\n        { status: 404 }\r\n      );\r\n    }\r\n\r\n    const body = await request.json();\r\n    const { currentPlan, requestedPlan, planId } = body;\r\n\r\n    if (!planId) {\r\n      return NextResponse.json(\r\n        { success: false, error: 'Plan ID is required' },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    // Verify the requested plan exists and is active\r\n    const requestedPlanDoc = await SubscriptionPlan.findOne({ _id: planId, isActive: true });\r\n    if (!requestedPlanDoc) {\r\n      return NextResponse.json(\r\n        { success: false, error: 'Requested plan not found or not available' },\r\n        { status: 404 }\r\n      );\r\n    }\r\n\r\n    // Get current subscription\r\n    const currentSubscription = await Subscription.findOne({ tenantId })\r\n      .populate('planId', 'name tier')\r\n      .lean();\r\n\r\n    if (!currentSubscription) {\r\n      return NextResponse.json(\r\n        { success: false, error: 'No active subscription found' },\r\n        { status: 404 }\r\n      );\r\n    }\r\n\r\n    // Check if already on this plan\r\n    if (currentSubscription.planId._id.toString() === planId) {\r\n      return NextResponse.json(\r\n        { success: false, error: 'You are already on this plan' },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    // Create upgrade request (in a real app, this might send an email or create a ticket)\r\n    // For now, we'll just log it and return success\r\n    console.log('Upgrade Request:', {\r\n      tenantId,\r\n      userId: user.userId,\r\n      currentPlan: currentPlan,\r\n      requestedPlan: requestedPlan,\r\n      planId: planId,\r\n      requestedAt: new Date(),\r\n    });\r\n\r\n    // In a production system, you might want to:\r\n    // 1. Send an email to admins\r\n    // 2. Create an upgrade request record in the database\r\n    // 3. Send confirmation email to user\r\n    // 4. Trigger payment flow if applicable\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      message: 'Upgrade request submitted successfully',\r\n      data: {\r\n        currentPlan,\r\n        requestedPlan,\r\n        requestedAt: new Date(),\r\n      },\r\n    });\r\n\r\n  } catch (error: any) {\r\n    console.error('Error requesting upgrade:', error);\r\n    return NextResponse.json(\r\n      { success: false, error: error.message },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\subscriptions\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\tax-rules\\[id]\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":29,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":29,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1061,1064],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1061,1064],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'user' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":41,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":41,"endColumn":15},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":87,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":87,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3405,3408],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3405,3408],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'user' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":99,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":99,"endColumn":15},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":122,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":122,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4576,4579],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4576,4579],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\nimport connectDB from '@/lib/mongodb';\r\nimport TaxRule from '@/models/TaxRule';\r\nimport { getTenantIdFromRequest } from '@/lib/api-tenant';\r\nimport { requireAuth } from '@/lib/auth';\r\nimport { createAuditLog, AuditActions } from '@/lib/audit';\r\nimport { getValidationTranslatorFromRequest } from '@/lib/validation-translations';\r\n\r\nexport async function GET(\r\n  request: NextRequest,\r\n  { params }: { params: Promise<{ id: string }> }\r\n) {\r\n  try {\r\n    await connectDB();\r\n    const { id } = await params;\r\n    const tenantId = await getTenantIdFromRequest(request);\r\n    \r\n    if (!tenantId) {\r\n      return NextResponse.json({ success: false, error: 'Tenant not found' }, { status: 404 });\r\n    }\r\n    \r\n    const taxRule = await TaxRule.findOne({ _id: id, tenantId }).lean();\r\n    \r\n    if (!taxRule) {\r\n      return NextResponse.json({ success: false, error: 'Tax rule not found' }, { status: 404 });\r\n    }\r\n    \r\n    return NextResponse.json({ success: true, data: taxRule });\r\n  } catch (error: any) {\r\n    return NextResponse.json({ success: false, error: error.message }, { status: 500 });\r\n  }\r\n}\r\n\r\nexport async function PATCH(\r\n  request: NextRequest,\r\n  { params }: { params: Promise<{ id: string }> }\r\n) {\r\n  try {\r\n    await connectDB();\r\n    const { id } = await params;\r\n    const user = await requireAuth(request);\r\n    const tenantId = await getTenantIdFromRequest(request);\r\n    const t = await getValidationTranslatorFromRequest(request);\r\n    \r\n    if (!tenantId) {\r\n      return NextResponse.json({ success: false, error: t('validation.tenantNotFound', 'Tenant not found') }, { status: 404 });\r\n    }\r\n    \r\n    const taxRule = await TaxRule.findOne({ _id: id, tenantId });\r\n    \r\n    if (!taxRule) {\r\n      return NextResponse.json({ success: false, error: t('validation.taxRuleNotFound', 'Tax rule not found') }, { status: 404 });\r\n    }\r\n    \r\n    const body = await request.json();\r\n    const oldData = { name: taxRule.name, rate: taxRule.rate, isActive: taxRule.isActive };\r\n    \r\n    if (body.name !== undefined) taxRule.name = body.name.trim();\r\n    if (body.rate !== undefined) {\r\n      if (isNaN(body.rate) || body.rate < 0 || body.rate > 100) {\r\n        return NextResponse.json(\r\n          { success: false, error: t('validation.taxRateRequired', 'Tax rate must be between 0 and 100') },\r\n          { status: 400 }\r\n        );\r\n      }\r\n      taxRule.rate = parseFloat(body.rate);\r\n    }\r\n    if (body.label !== undefined) taxRule.label = body.label.trim();\r\n    if (body.appliesTo !== undefined) taxRule.appliesTo = body.appliesTo;\r\n    if (body.categoryIds !== undefined) taxRule.categoryIds = body.categoryIds;\r\n    if (body.productIds !== undefined) taxRule.productIds = body.productIds;\r\n    if (body.region !== undefined) taxRule.region = body.region;\r\n    if (body.priority !== undefined) taxRule.priority = body.priority;\r\n    if (body.isActive !== undefined) taxRule.isActive = body.isActive;\r\n    \r\n    await taxRule.save();\r\n    \r\n    await createAuditLog(request, {\r\n      tenantId,\r\n      action: AuditActions.UPDATE,\r\n      entityType: 'taxRule',\r\n      entityId: taxRule._id.toString(),\r\n      changes: { old: oldData, new: { name: taxRule.name, rate: taxRule.rate, isActive: taxRule.isActive } },\r\n    });\r\n    \r\n    return NextResponse.json({ success: true, data: taxRule });\r\n  } catch (error: any) {\r\n    return NextResponse.json({ success: false, error: error.message }, { status: 400 });\r\n  }\r\n}\r\n\r\nexport async function DELETE(\r\n  request: NextRequest,\r\n  { params }: { params: Promise<{ id: string }> }\r\n) {\r\n  try {\r\n    await connectDB();\r\n    const { id } = await params;\r\n    const user = await requireAuth(request);\r\n    const tenantId = await getTenantIdFromRequest(request);\r\n    const t = await getValidationTranslatorFromRequest(request);\r\n    \r\n    if (!tenantId) {\r\n      return NextResponse.json({ success: false, error: t('validation.tenantNotFound', 'Tenant not found') }, { status: 404 });\r\n    }\r\n    \r\n    const taxRule = await TaxRule.findOneAndDelete({ _id: id, tenantId });\r\n    \r\n    if (!taxRule) {\r\n      return NextResponse.json({ success: false, error: t('validation.taxRuleNotFound', 'Tax rule not found') }, { status: 404 });\r\n    }\r\n    \r\n    await createAuditLog(request, {\r\n      tenantId,\r\n      action: AuditActions.DELETE,\r\n      entityType: 'taxRule',\r\n      entityId: id,\r\n      changes: { name: taxRule.name },\r\n    });\r\n    \r\n    return NextResponse.json({ success: true, message: 'Tax rule deleted' });\r\n  } catch (error: any) {\r\n    return NextResponse.json({ success: false, error: error.message }, { status: 400 });\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\tax-rules\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":21,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":21,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[804,807],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[804,807],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":31,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":31,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1113,1116],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1113,1116],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'user' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":39,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":39,"endColumn":15},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":87,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":87,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3047,3050],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3047,3050],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\nimport connectDB from '@/lib/mongodb';\r\nimport TaxRule from '@/models/TaxRule';\r\nimport { getTenantIdFromRequest } from '@/lib/api-tenant';\r\nimport { requireAuth } from '@/lib/auth';\r\nimport { createAuditLog, AuditActions } from '@/lib/audit';\r\nimport { getValidationTranslatorFromRequest } from '@/lib/validation-translations';\r\n\r\nexport async function GET(request: NextRequest) {\r\n  try {\r\n    await connectDB();\r\n    const tenantId = await getTenantIdFromRequest(request);\r\n    \r\n    if (!tenantId) {\r\n      return NextResponse.json({ success: false, error: 'Tenant not found' }, { status: 404 });\r\n    }\r\n    \r\n    const searchParams = request.nextUrl.searchParams;\r\n    const isActive = searchParams.get('isActive');\r\n    \r\n    const query: any = { tenantId };\r\n    if (isActive !== null) {\r\n      query.isActive = isActive === 'true';\r\n    }\r\n    \r\n    const taxRules = await TaxRule.find(query)\r\n      .sort({ priority: -1, createdAt: -1 })\r\n      .lean();\r\n    \r\n    return NextResponse.json({ success: true, data: taxRules });\r\n  } catch (error: any) {\r\n    return NextResponse.json({ success: false, error: error.message }, { status: 500 });\r\n  }\r\n}\r\n\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    await connectDB();\r\n    const user = await requireAuth(request);\r\n    const tenantId = await getTenantIdFromRequest(request);\r\n    const t = await getValidationTranslatorFromRequest(request);\r\n    \r\n    if (!tenantId) {\r\n      return NextResponse.json({ success: false, error: t('validation.tenantNotFound', 'Tenant not found') }, { status: 404 });\r\n    }\r\n    \r\n    const body = await request.json();\r\n    const { name, rate, label, appliesTo, categoryIds, productIds, region, priority, isActive } = body;\r\n    \r\n    // Validate required fields\r\n    if (!name || !name.trim()) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.taxRuleNameRequired', 'Tax rule name is required') },\r\n        { status: 400 }\r\n      );\r\n    }\r\n    \r\n    if (rate === undefined || rate === null || isNaN(rate) || rate < 0 || rate > 100) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.taxRateRequired', 'Tax rate must be between 0 and 100') },\r\n        { status: 400 }\r\n      );\r\n    }\r\n    \r\n    const taxRule = await TaxRule.create({\r\n      tenantId,\r\n      name: name.trim(),\r\n      rate: parseFloat(rate),\r\n      label: label?.trim() || 'Tax',\r\n      appliesTo: appliesTo || 'all',\r\n      categoryIds: categoryIds || [],\r\n      productIds: productIds || [],\r\n      region: region || {},\r\n      priority: priority || 0,\r\n      isActive: isActive !== undefined ? isActive : true,\r\n    });\r\n    \r\n    await createAuditLog(request, {\r\n      tenantId,\r\n      action: AuditActions.CREATE,\r\n      entityType: 'taxRule',\r\n      entityId: taxRule._id.toString(),\r\n      changes: { name, rate, label },\r\n    });\r\n    \r\n    return NextResponse.json({ success: true, data: taxRule }, { status: 201 });\r\n  } catch (error: any) {\r\n    return NextResponse.json({ success: false, error: error.message }, { status: 400 });\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\tenants\\[slug]\\business-hours\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":33,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":33,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[945,948],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[945,948],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":78,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":78,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2360,2363],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2360,2363],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Business Hours API\r\n * Handles CRUD operations for business hours and special hours\r\n */\r\n\r\nimport { NextRequest, NextResponse } from 'next/server';\r\nimport connectDB from '@/lib/mongodb';\r\nimport Tenant from '@/models/Tenant';\r\nimport { getCurrentUser } from '@/lib/auth';\r\n\r\nexport async function GET(\r\n  request: NextRequest,\r\n  { params }: { params: Promise<{ slug: string }> }\r\n) {\r\n  try {\r\n    const user = await getCurrentUser(request);\r\n    if (!user) {\r\n      return NextResponse.json({ success: false, error: 'Unauthorized' }, { status: 401 });\r\n    }\r\n\r\n    const { slug } = await params;\r\n    await connectDB();\r\n\r\n    const tenant = await Tenant.findOne({ slug });\r\n    if (!tenant) {\r\n      return NextResponse.json({ success: false, error: 'Tenant not found' }, { status: 404 });\r\n    }\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      data: tenant.settings.businessHours || {},\r\n    });\r\n  } catch (error: any) {\r\n    console.error('Error fetching business hours:', error);\r\n    return NextResponse.json({ success: false, error: error.message }, { status: 500 });\r\n  }\r\n}\r\n\r\nexport async function PUT(\r\n  request: NextRequest,\r\n  { params }: { params: Promise<{ slug: string }> }\r\n) {\r\n  try {\r\n    const user = await getCurrentUser(request);\r\n    if (!user) {\r\n      return NextResponse.json({ success: false, error: 'Unauthorized' }, { status: 401 });\r\n    }\r\n\r\n    if (user.role !== 'admin' && user.role !== 'manager') {\r\n      return NextResponse.json({ success: false, error: 'Forbidden' }, { status: 403 });\r\n    }\r\n\r\n    const { slug } = await params;\r\n    const body = await request.json();\r\n    const { schedule, specialHours, timezone } = body;\r\n\r\n    await connectDB();\r\n\r\n    const tenant = await Tenant.findOne({ slug });\r\n    if (!tenant) {\r\n      return NextResponse.json({ success: false, error: 'Tenant not found' }, { status: 404 });\r\n    }\r\n\r\n    tenant.settings.businessHours = {\r\n      ...tenant.settings.businessHours,\r\n      ...(timezone !== undefined && { timezone }),\r\n      ...(schedule !== undefined && { schedule }),\r\n      ...(specialHours !== undefined && { specialHours }),\r\n    };\r\n\r\n    tenant.markModified('settings.businessHours');\r\n    await tenant.save();\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      data: tenant.settings.businessHours,\r\n    });\r\n  } catch (error: any) {\r\n    console.error('Error updating business hours:', error);\r\n    return NextResponse.json({ success: false, error: error.message }, { status: 500 });\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\tenants\\[slug]\\exchange-rates\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":42,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":42,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1309,1312],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1309,1312],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":95,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":95,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3105,3108],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3105,3108],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":119,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":119,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3890,3893],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3890,3893],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":136,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":136,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4306,4309],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4306,4309],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Exchange Rates API\r\n * Handles fetching and updating exchange rates for multi-currency support\r\n */\r\n\r\nimport { NextRequest, NextResponse } from 'next/server';\r\nimport connectDB from '@/lib/mongodb';\r\nimport Tenant from '@/models/Tenant';\r\nimport { fetchExchangeRates } from '@/lib/multi-currency';\r\nimport { getCurrentUser } from '@/lib/auth';\r\n\r\nexport async function GET(\r\n  request: NextRequest,\r\n  { params }: { params: Promise<{ slug: string }> }\r\n) {\r\n  try {\r\n    const user = await getCurrentUser(request);\r\n    if (!user) {\r\n      return NextResponse.json({ success: false, error: 'Unauthorized' }, { status: 401 });\r\n    }\r\n\r\n    const { slug } = await params;\r\n    await connectDB();\r\n\r\n    const tenant = await Tenant.findOne({ slug });\r\n    if (!tenant) {\r\n      return NextResponse.json({ success: false, error: 'Tenant not found' }, { status: 404 });\r\n    }\r\n\r\n    const multiCurrency = tenant.settings.multiCurrency;\r\n    if (!multiCurrency?.enabled) {\r\n      return NextResponse.json({ success: false, error: 'Multi-currency not enabled' }, { status: 400 });\r\n    }\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      data: {\r\n        exchangeRates: multiCurrency.exchangeRates || {},\r\n        lastUpdated: multiCurrency.lastUpdated,\r\n      },\r\n    });\r\n  } catch (error: any) {\r\n    console.error('Error fetching exchange rates:', error);\r\n    return NextResponse.json({ success: false, error: error.message }, { status: 500 });\r\n  }\r\n}\r\n\r\nexport async function POST(\r\n  request: NextRequest,\r\n  { params }: { params: Promise<{ slug: string }> }\r\n) {\r\n  try {\r\n    const user = await getCurrentUser(request);\r\n    if (!user) {\r\n      return NextResponse.json({ success: false, error: 'Unauthorized' }, { status: 401 });\r\n    }\r\n\r\n    // Check if user is admin or manager\r\n    if (user.role !== 'admin' && user.role !== 'manager') {\r\n      return NextResponse.json({ success: false, error: 'Forbidden' }, { status: 403 });\r\n    }\r\n\r\n    const { slug } = await params;\r\n    const body = await request.json();\r\n    const { action } = body;\r\n\r\n    await connectDB();\r\n\r\n    const tenant = await Tenant.findOne({ slug });\r\n    if (!tenant) {\r\n      return NextResponse.json({ success: false, error: 'Tenant not found' }, { status: 404 });\r\n    }\r\n\r\n    if (action === 'fetch') {\r\n      // Fetch fresh rates from API\r\n      const multiCurrency = tenant.settings.multiCurrency;\r\n      if (!multiCurrency?.enabled || !multiCurrency.displayCurrencies) {\r\n        return NextResponse.json({ success: false, error: 'Multi-currency not configured' }, { status: 400 });\r\n      }\r\n\r\n      const baseCurrency = tenant.settings.currency;\r\n      const rates = await fetchExchangeRates(\r\n        baseCurrency,\r\n        multiCurrency.displayCurrencies,\r\n        multiCurrency.exchangeRateApiKey\r\n      );\r\n\r\n      if (!rates) {\r\n        return NextResponse.json({ success: false, error: 'Failed to fetch exchange rates' }, { status: 500 });\r\n      }\r\n\r\n      // Update tenant settings\r\n      tenant.settings.multiCurrency = {\r\n        ...multiCurrency,\r\n        exchangeRates: rates as any,\r\n        lastUpdated: new Date(),\r\n      };\r\n\r\n      tenant.markModified('settings.multiCurrency');\r\n      await tenant.save();\r\n\r\n      return NextResponse.json({\r\n        success: true,\r\n        data: {\r\n          exchangeRates: rates,\r\n          lastUpdated: new Date(),\r\n        },\r\n      });\r\n    } else if (action === 'update') {\r\n      // Manually update rates\r\n      const { exchangeRates } = body;\r\n      if (!exchangeRates || typeof exchangeRates !== 'object') {\r\n        return NextResponse.json({ success: false, error: 'Invalid exchange rates' }, { status: 400 });\r\n      }\r\n\r\n      const multiCurrency = tenant.settings.multiCurrency || { enabled: false };\r\n      tenant.settings.multiCurrency = {\r\n        ...multiCurrency,\r\n        exchangeRates: exchangeRates as any,\r\n        lastUpdated: new Date(),\r\n      };\r\n\r\n      tenant.markModified('settings.multiCurrency');\r\n      await tenant.save();\r\n\r\n      return NextResponse.json({\r\n        success: true,\r\n        data: {\r\n          exchangeRates,\r\n          lastUpdated: new Date(),\r\n        },\r\n      });\r\n    }\r\n\r\n    return NextResponse.json({ success: false, error: 'Invalid action' }, { status: 400 });\r\n  } catch (error: any) {\r\n    console.error('Error updating exchange rates:', error);\r\n    return NextResponse.json({ success: false, error: error.message }, { status: 500 });\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\tenants\\[slug]\\holidays\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":33,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":33,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[918,921],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[918,921],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":91,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":91,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3362,3365],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3362,3365],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":118,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":118,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4347,4350],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4347,4350],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":130,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":130,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4713,4716],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4713,4716],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":166,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":166,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5874,5877],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5874,5877],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":180,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":180,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6348,6351],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6348,6351],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":192,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":192,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6735,6738],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6735,6738],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":228,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":228,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7906,7909],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7906,7909],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":240,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":240,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8296,8299],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8296,8299],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":249,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":249,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8635,8638],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8635,8638],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":10,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Holidays API\r\n * Handles CRUD operations for holiday calendar\r\n */\r\n\r\nimport { NextRequest, NextResponse } from 'next/server';\r\nimport connectDB from '@/lib/mongodb';\r\nimport Tenant from '@/models/Tenant';\r\nimport { getCurrentUser } from '@/lib/auth';\r\n\r\nexport async function GET(\r\n  request: NextRequest,\r\n  { params }: { params: Promise<{ slug: string }> }\r\n) {\r\n  try {\r\n    const user = await getCurrentUser(request);\r\n    if (!user) {\r\n      return NextResponse.json({ success: false, error: 'Unauthorized' }, { status: 401 });\r\n    }\r\n\r\n    const { slug } = await params;\r\n    await connectDB();\r\n\r\n    const tenant = await Tenant.findOne({ slug });\r\n    if (!tenant) {\r\n      return NextResponse.json({ success: false, error: 'Tenant not found' }, { status: 404 });\r\n    }\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      data: tenant.settings.holidays || [],\r\n    });\r\n  } catch (error: any) {\r\n    console.error('Error fetching holidays:', error);\r\n    return NextResponse.json({ success: false, error: error.message }, { status: 500 });\r\n  }\r\n}\r\n\r\nexport async function POST(\r\n  request: NextRequest,\r\n  { params }: { params: Promise<{ slug: string }> }\r\n) {\r\n  try {\r\n    const user = await getCurrentUser(request);\r\n    if (!user) {\r\n      return NextResponse.json({ success: false, error: 'Unauthorized' }, { status: 401 });\r\n    }\r\n\r\n    if (user.role !== 'admin' && user.role !== 'manager') {\r\n      return NextResponse.json({ success: false, error: 'Forbidden' }, { status: 403 });\r\n    }\r\n\r\n    const { slug } = await params;\r\n    const body = await request.json();\r\n    const { name, date, type, recurring, isBusinessClosed } = body;\r\n\r\n    if (!name || !type) {\r\n      return NextResponse.json({ success: false, error: 'Name and type are required' }, { status: 400 });\r\n    }\r\n\r\n    // For single date holidays, date is required\r\n    if (type === 'single' && !date) {\r\n      return NextResponse.json({ success: false, error: 'Date is required for single date holidays' }, { status: 400 });\r\n    }\r\n\r\n    // For recurring holidays, recurring pattern is required\r\n    if (type === 'recurring') {\r\n      if (!recurring || !recurring.pattern) {\r\n        return NextResponse.json({ success: false, error: 'Recurring pattern is required for recurring holidays' }, { status: 400 });\r\n      }\r\n      // Validate recurring pattern based on type\r\n      if (recurring.pattern === 'yearly' && (!recurring.month || !recurring.dayOfMonth)) {\r\n        return NextResponse.json({ success: false, error: 'Month and day of month are required for yearly recurring holidays' }, { status: 400 });\r\n      }\r\n      if (recurring.pattern === 'monthly' && !recurring.dayOfMonth) {\r\n        return NextResponse.json({ success: false, error: 'Day of month is required for monthly recurring holidays' }, { status: 400 });\r\n      }\r\n      if (recurring.pattern === 'weekly' && recurring.dayOfWeek === undefined) {\r\n        return NextResponse.json({ success: false, error: 'Day of week is required for weekly recurring holidays' }, { status: 400 });\r\n      }\r\n    }\r\n\r\n    await connectDB();\r\n\r\n    const tenant = await Tenant.findOne({ slug });\r\n    if (!tenant) {\r\n      return NextResponse.json({ success: false, error: 'Tenant not found' }, { status: 404 });\r\n    }\r\n\r\n    const holidays = tenant.settings.holidays || [];\r\n    const newHoliday: any = {\r\n      id: `holiday_${Date.now()}`,\r\n      name,\r\n      type,\r\n      isBusinessClosed: isBusinessClosed !== undefined ? isBusinessClosed : true,\r\n      createdAt: new Date(),\r\n    };\r\n\r\n    // Add date for single holidays, or recurring pattern for recurring holidays\r\n    if (type === 'single') {\r\n      newHoliday.date = date;\r\n    } else if (type === 'recurring') {\r\n      newHoliday.recurring = recurring;\r\n      // For recurring holidays, we can use a placeholder date or pattern-based date\r\n      newHoliday.date = recurring?.month && recurring?.dayOfMonth \r\n        ? `${new Date().getFullYear()}-${String(recurring.month).padStart(2, '0')}-${String(recurring.dayOfMonth).padStart(2, '0')}`\r\n        : '';\r\n    }\r\n\r\n    holidays.push(newHoliday);\r\n\r\n    tenant.settings.holidays = holidays;\r\n    tenant.markModified('settings.holidays');\r\n    \r\n    try {\r\n      await tenant.save();\r\n      console.log('Holiday saved successfully:', newHoliday);\r\n    } catch (saveError: any) {\r\n      console.error('Error saving holiday to database:', saveError);\r\n      return NextResponse.json({ \r\n        success: false, \r\n        error: `Failed to save holiday: ${saveError.message || 'Database error'}` \r\n      }, { status: 500 });\r\n    }\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      data: newHoliday,\r\n    });\r\n  } catch (error: any) {\r\n    console.error('Error creating holiday:', error);\r\n    return NextResponse.json({ success: false, error: error.message }, { status: 500 });\r\n  }\r\n}\r\n\r\nexport async function PUT(\r\n  request: NextRequest,\r\n  { params }: { params: Promise<{ slug: string }> }\r\n) {\r\n  try {\r\n    const user = await getCurrentUser(request);\r\n    if (!user) {\r\n      return NextResponse.json({ success: false, error: 'Unauthorized' }, { status: 401 });\r\n    }\r\n\r\n    if (user.role !== 'admin' && user.role !== 'manager') {\r\n      return NextResponse.json({ success: false, error: 'Forbidden' }, { status: 403 });\r\n    }\r\n\r\n    const { slug } = await params;\r\n    const body = await request.json();\r\n    const { id, ...updates } = body;\r\n\r\n    if (!id) {\r\n      return NextResponse.json({ success: false, error: 'Holiday ID is required' }, { status: 400 });\r\n    }\r\n\r\n    await connectDB();\r\n\r\n    const tenant = await Tenant.findOne({ slug });\r\n    if (!tenant) {\r\n      return NextResponse.json({ success: false, error: 'Tenant not found' }, { status: 404 });\r\n    }\r\n\r\n    const holidays = tenant.settings.holidays || [];\r\n    const holidayIndex = holidays.findIndex((h: any) => h.id === id);\r\n\r\n    if (holidayIndex === -1) {\r\n      return NextResponse.json({ success: false, error: 'Holiday not found' }, { status: 404 });\r\n    }\r\n\r\n    holidays[holidayIndex] = { ...holidays[holidayIndex], ...updates };\r\n\r\n    tenant.settings.holidays = holidays;\r\n    tenant.markModified('settings.holidays');\r\n    \r\n    try {\r\n      await tenant.save();\r\n      console.log('Holiday updated successfully:', holidays[holidayIndex]);\r\n    } catch (saveError: any) {\r\n      console.error('Error saving holiday update to database:', saveError);\r\n      return NextResponse.json({ \r\n        success: false, \r\n        error: `Failed to update holiday: ${saveError.message || 'Database error'}` \r\n      }, { status: 500 });\r\n    }\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      data: holidays[holidayIndex],\r\n    });\r\n  } catch (error: any) {\r\n    console.error('Error updating holiday:', error);\r\n    return NextResponse.json({ success: false, error: error.message }, { status: 500 });\r\n  }\r\n}\r\n\r\nexport async function DELETE(\r\n  request: NextRequest,\r\n  { params }: { params: Promise<{ slug: string }> }\r\n) {\r\n  try {\r\n    const user = await getCurrentUser(request);\r\n    if (!user) {\r\n      return NextResponse.json({ success: false, error: 'Unauthorized' }, { status: 401 });\r\n    }\r\n\r\n    if (user.role !== 'admin' && user.role !== 'manager') {\r\n      return NextResponse.json({ success: false, error: 'Forbidden' }, { status: 403 });\r\n    }\r\n\r\n    const { slug } = await params;\r\n    const { searchParams } = new URL(request.url);\r\n    const id = searchParams.get('id');\r\n\r\n    if (!id) {\r\n      return NextResponse.json({ success: false, error: 'Holiday ID is required' }, { status: 400 });\r\n    }\r\n\r\n    await connectDB();\r\n\r\n    const tenant = await Tenant.findOne({ slug });\r\n    if (!tenant) {\r\n      return NextResponse.json({ success: false, error: 'Tenant not found' }, { status: 404 });\r\n    }\r\n\r\n    const holidays = tenant.settings.holidays || [];\r\n    const filtered = holidays.filter((h: any) => h.id !== id);\r\n\r\n    if (filtered.length === holidays.length) {\r\n      return NextResponse.json({ success: false, error: 'Holiday not found' }, { status: 404 });\r\n    }\r\n\r\n    tenant.settings.holidays = filtered;\r\n    tenant.markModified('settings.holidays');\r\n    \r\n    try {\r\n      await tenant.save();\r\n      console.log('Holiday deleted successfully');\r\n    } catch (saveError: any) {\r\n      console.error('Error saving holiday deletion to database:', saveError);\r\n      return NextResponse.json({ \r\n        success: false, \r\n        error: `Failed to delete holiday: ${saveError.message || 'Database error'}` \r\n      }, { status: 500 });\r\n    }\r\n\r\n    return NextResponse.json({ success: true });\r\n  } catch (error: any) {\r\n    console.error('Error deleting holiday:', error);\r\n    return NextResponse.json({ success: false, error: error.message }, { status: 500 });\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\tenants\\[slug]\\notification-templates\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":34,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":34,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1043,1046],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1043,1046],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":99,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":99,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3294,3297],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3294,3297],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Notification Templates API\r\n * Handles CRUD operations for email and SMS notification templates\r\n */\r\n\r\nimport { NextRequest, NextResponse } from 'next/server';\r\nimport connectDB from '@/lib/mongodb';\r\nimport Tenant from '@/models/Tenant';\r\nimport { validateNotificationTemplate } from '@/lib/notification-templates';\r\nimport { getCurrentUser } from '@/lib/auth';\r\n\r\nexport async function GET(\r\n  request: NextRequest,\r\n  { params }: { params: Promise<{ slug: string }> }\r\n) {\r\n  try {\r\n    const user = await getCurrentUser(request);\r\n    if (!user) {\r\n      return NextResponse.json({ success: false, error: 'Unauthorized' }, { status: 401 });\r\n    }\r\n\r\n    const { slug } = await params;\r\n    await connectDB();\r\n\r\n    const tenant = await Tenant.findOne({ slug });\r\n    if (!tenant) {\r\n      return NextResponse.json({ success: false, error: 'Tenant not found' }, { status: 404 });\r\n    }\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      data: tenant.settings.notificationTemplates || {},\r\n    });\r\n  } catch (error: any) {\r\n    console.error('Error fetching notification templates:', error);\r\n    return NextResponse.json({ success: false, error: error.message }, { status: 500 });\r\n  }\r\n}\r\n\r\nexport async function PUT(\r\n  request: NextRequest,\r\n  { params }: { params: Promise<{ slug: string }> }\r\n) {\r\n  try {\r\n    const user = await getCurrentUser(request);\r\n    if (!user) {\r\n      return NextResponse.json({ success: false, error: 'Unauthorized' }, { status: 401 });\r\n    }\r\n\r\n    if (user.role !== 'admin' && user.role !== 'manager') {\r\n      return NextResponse.json({ success: false, error: 'Forbidden' }, { status: 403 });\r\n    }\r\n\r\n    const { slug } = await params;\r\n    const body = await request.json();\r\n    const { type, category, subcategory, subject, body: templateBody } = body;\r\n\r\n    if (!type || !category || !templateBody) {\r\n      return NextResponse.json({ success: false, error: 'Type, category, and body are required' }, { status: 400 });\r\n    }\r\n\r\n    // Validate template\r\n    const validation = validateNotificationTemplate(templateBody);\r\n    if (!validation.valid) {\r\n      return NextResponse.json({ success: false, error: validation.error }, { status: 400 });\r\n    }\r\n\r\n    await connectDB();\r\n\r\n    const tenant = await Tenant.findOne({ slug });\r\n    if (!tenant) {\r\n      return NextResponse.json({ success: false, error: 'Tenant not found' }, { status: 404 });\r\n    }\r\n\r\n    const templates = tenant.settings.notificationTemplates || {};\r\n    const key = subcategory || category;\r\n\r\n    if (type === 'email') {\r\n      templates.email = templates.email || {};\r\n      if (subject) {\r\n        // Store subject and body together\r\n        templates.email[key as keyof typeof templates.email] = `${subject}|${templateBody}`;\r\n      } else {\r\n        templates.email[key as keyof typeof templates.email] = templateBody;\r\n      }\r\n    } else if (type === 'sms') {\r\n      templates.sms = templates.sms || {};\r\n      templates.sms[key as keyof typeof templates.sms] = templateBody;\r\n    }\r\n\r\n    tenant.settings.notificationTemplates = templates;\r\n    tenant.markModified('settings.notificationTemplates');\r\n    await tenant.save();\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      data: templates,\r\n    });\r\n  } catch (error: any) {\r\n    console.error('Error updating notification template:', error);\r\n    return NextResponse.json({ success: false, error: error.message }, { status: 500 });\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\tenants\\[slug]\\receipt-templates\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":40,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":40,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1176,1179],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1176,1179],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":116,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":116,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3376,3379],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3376,3379],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":203,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":203,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6098,6101],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6098,6101],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":259,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":259,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7938,7941],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7938,7941],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Receipt Templates API\r\n * Handles CRUD operations for receipt templates\r\n */\r\n\r\nimport { NextRequest, NextResponse } from 'next/server';\r\nimport connectDB from '@/lib/mongodb';\r\nimport Tenant from '@/models/Tenant';\r\nimport { validateTemplate } from '@/lib/receipt-templates';\r\nimport { getCurrentUser } from '@/lib/auth';\r\n\r\nexport async function GET(\r\n  request: NextRequest,\r\n  { params }: { params: Promise<{ slug: string }> }\r\n) {\r\n  try {\r\n    const user = await getCurrentUser(request);\r\n    if (!user) {\r\n      return NextResponse.json({ success: false, error: 'Unauthorized' }, { status: 401 });\r\n    }\r\n\r\n    const { slug } = await params;\r\n    await connectDB();\r\n\r\n    const tenant = await Tenant.findOne({ slug });\r\n    if (!tenant) {\r\n      return NextResponse.json({ success: false, error: 'Tenant not found' }, { status: 404 });\r\n    }\r\n\r\n    const templates = tenant.settings.receiptTemplates?.templates || [];\r\n    const defaultTemplateId = tenant.settings.receiptTemplates?.default;\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      data: {\r\n        templates,\r\n        default: defaultTemplateId,\r\n      },\r\n    });\r\n  } catch (error: any) {\r\n    console.error('Error fetching receipt templates:', error);\r\n    return NextResponse.json({ success: false, error: error.message }, { status: 500 });\r\n  }\r\n}\r\n\r\nexport async function POST(\r\n  request: NextRequest,\r\n  { params }: { params: Promise<{ slug: string }> }\r\n) {\r\n  try {\r\n    const user = await getCurrentUser(request);\r\n    if (!user) {\r\n      return NextResponse.json({ success: false, error: 'Unauthorized' }, { status: 401 });\r\n    }\r\n\r\n    if (user.role !== 'admin' && user.role !== 'manager') {\r\n      return NextResponse.json({ success: false, error: 'Forbidden' }, { status: 403 });\r\n    }\r\n\r\n    const { slug } = await params;\r\n    const body = await request.json();\r\n    const { name, html, isDefault } = body;\r\n\r\n    if (!name || !html) {\r\n      return NextResponse.json({ success: false, error: 'Name and HTML are required' }, { status: 400 });\r\n    }\r\n\r\n    // Validate template\r\n    const validation = validateTemplate(html);\r\n    if (!validation.valid) {\r\n      return NextResponse.json({ success: false, error: validation.error }, { status: 400 });\r\n    }\r\n\r\n    await connectDB();\r\n\r\n    const tenant = await Tenant.findOne({ slug });\r\n    if (!tenant) {\r\n      return NextResponse.json({ success: false, error: 'Tenant not found' }, { status: 404 });\r\n    }\r\n\r\n    const templates = tenant.settings.receiptTemplates?.templates || [];\r\n    const newTemplate = {\r\n      id: `template_${Date.now()}`,\r\n      name,\r\n      html,\r\n      isDefault: isDefault || false,\r\n      createdAt: new Date(),\r\n      updatedAt: new Date(),\r\n    };\r\n\r\n    // If this is set as default, unset others\r\n    if (isDefault) {\r\n      templates.forEach((t) => {\r\n        t.isDefault = false;\r\n      });\r\n      tenant.settings.receiptTemplates = {\r\n        ...tenant.settings.receiptTemplates,\r\n        default: newTemplate.id,\r\n      };\r\n    }\r\n\r\n    templates.push(newTemplate);\r\n\r\n    tenant.settings.receiptTemplates = {\r\n      ...tenant.settings.receiptTemplates,\r\n      templates,\r\n    };\r\n\r\n    tenant.markModified('settings.receiptTemplates');\r\n    await tenant.save();\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      data: newTemplate,\r\n    });\r\n  } catch (error: any) {\r\n    console.error('Error creating receipt template:', error);\r\n    return NextResponse.json({ success: false, error: error.message }, { status: 500 });\r\n  }\r\n}\r\n\r\nexport async function PUT(\r\n  request: NextRequest,\r\n  { params }: { params: Promise<{ slug: string }> }\r\n) {\r\n  try {\r\n    const user = await getCurrentUser(request);\r\n    if (!user) {\r\n      return NextResponse.json({ success: false, error: 'Unauthorized' }, { status: 401 });\r\n    }\r\n\r\n    if (user.role !== 'admin' && user.role !== 'manager') {\r\n      return NextResponse.json({ success: false, error: 'Forbidden' }, { status: 403 });\r\n    }\r\n\r\n    const { slug } = await params;\r\n    const body = await request.json();\r\n    const { id, name, html, isDefault } = body;\r\n\r\n    if (!id) {\r\n      return NextResponse.json({ success: false, error: 'Template ID is required' }, { status: 400 });\r\n    }\r\n\r\n    if (html) {\r\n      const validation = validateTemplate(html);\r\n      if (!validation.valid) {\r\n        return NextResponse.json({ success: false, error: validation.error }, { status: 400 });\r\n      }\r\n    }\r\n\r\n    await connectDB();\r\n\r\n    const tenant = await Tenant.findOne({ slug });\r\n    if (!tenant) {\r\n      return NextResponse.json({ success: false, error: 'Tenant not found' }, { status: 404 });\r\n    }\r\n\r\n    const templates = tenant.settings.receiptTemplates?.templates || [];\r\n    const templateIndex = templates.findIndex((t) => t.id === id);\r\n\r\n    if (templateIndex === -1) {\r\n      return NextResponse.json({ success: false, error: 'Template not found' }, { status: 404 });\r\n    }\r\n\r\n    // Update template\r\n    if (name) templates[templateIndex].name = name;\r\n    if (html) templates[templateIndex].html = html;\r\n    templates[templateIndex].updatedAt = new Date();\r\n\r\n    // Handle default\r\n    if (isDefault !== undefined) {\r\n      if (isDefault) {\r\n        templates.forEach((t) => {\r\n          t.isDefault = false;\r\n        });\r\n        templates[templateIndex].isDefault = true;\r\n        tenant.settings.receiptTemplates = {\r\n          ...tenant.settings.receiptTemplates,\r\n          default: id,\r\n        };\r\n      } else {\r\n        templates[templateIndex].isDefault = false;\r\n        if (tenant.settings.receiptTemplates?.default === id) {\r\n          if (tenant.settings.receiptTemplates) {\r\n            tenant.settings.receiptTemplates.default = undefined;\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    tenant.settings.receiptTemplates = {\r\n      ...tenant.settings.receiptTemplates,\r\n      templates,\r\n    };\r\n\r\n    tenant.markModified('settings.receiptTemplates');\r\n    await tenant.save();\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      data: templates[templateIndex],\r\n    });\r\n  } catch (error: any) {\r\n    console.error('Error updating receipt template:', error);\r\n    return NextResponse.json({ success: false, error: error.message }, { status: 500 });\r\n  }\r\n}\r\n\r\nexport async function DELETE(\r\n  request: NextRequest,\r\n  { params }: { params: Promise<{ slug: string }> }\r\n) {\r\n  try {\r\n    const user = await getCurrentUser(request);\r\n    if (!user) {\r\n      return NextResponse.json({ success: false, error: 'Unauthorized' }, { status: 401 });\r\n    }\r\n\r\n    if (user.role !== 'admin' && user.role !== 'manager') {\r\n      return NextResponse.json({ success: false, error: 'Forbidden' }, { status: 403 });\r\n    }\r\n\r\n    const { slug } = await params;\r\n    const { searchParams } = new URL(request.url);\r\n    const id = searchParams.get('id');\r\n\r\n    if (!id) {\r\n      return NextResponse.json({ success: false, error: 'Template ID is required' }, { status: 400 });\r\n    }\r\n\r\n    await connectDB();\r\n\r\n    const tenant = await Tenant.findOne({ slug });\r\n    if (!tenant) {\r\n      return NextResponse.json({ success: false, error: 'Tenant not found' }, { status: 404 });\r\n    }\r\n\r\n    const templates = tenant.settings.receiptTemplates?.templates || [];\r\n    const filtered = templates.filter((t) => t.id !== id);\r\n\r\n    if (filtered.length === templates.length) {\r\n      return NextResponse.json({ success: false, error: 'Template not found' }, { status: 404 });\r\n    }\r\n\r\n    // If deleted template was default, clear default\r\n    if (tenant.settings.receiptTemplates?.default === id) {\r\n      tenant.settings.receiptTemplates.default = undefined;\r\n    }\r\n\r\n    tenant.settings.receiptTemplates = {\r\n      ...tenant.settings.receiptTemplates,\r\n      templates: filtered,\r\n    };\r\n\r\n    tenant.markModified('settings.receiptTemplates');\r\n    await tenant.save();\r\n\r\n    return NextResponse.json({ success: true });\r\n  } catch (error: any) {\r\n    console.error('Error deleting receipt template:', error);\r\n    return NextResponse.json({ success: false, error: error.message }, { status: 500 });\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\tenants\\[slug]\\reset-collections\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":23,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":23,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1042,1045],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1042,1045],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":73,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":73,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2600,2603],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2600,2603],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":113,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":113,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3829,3832],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3829,3832],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":196,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":196,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6487,6490],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6487,6490],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":261,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":261,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8818,8821],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8818,8821],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":275,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":275,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9604,9607],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9604,9607],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":312,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":312,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10742,10745],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10742,10745],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\nimport connectDB from '@/lib/mongodb';\r\nimport Tenant from '@/models/Tenant';\r\nimport { requireRole } from '@/lib/auth';\r\nimport { createAuditLog, AuditActions } from '@/lib/audit';\r\nimport Product from '@/models/Product';\r\nimport Transaction from '@/models/Transaction';\r\nimport Category from '@/models/Category';\r\nimport StockMovement from '@/models/StockMovement';\r\nimport Expense from '@/models/Expense';\r\nimport Discount from '@/models/Discount';\r\nimport Branch from '@/models/Branch';\r\nimport CashDrawerSession from '@/models/CashDrawerSession';\r\nimport ProductBundle from '@/models/ProductBundle';\r\nimport Attendance from '@/models/Attendance';\r\nimport Booking from '@/models/Booking';\r\nimport SavedCart from '@/models/SavedCart';\r\nimport AuditLog from '@/models/AuditLog';\r\nimport mongoose from 'mongoose';\r\nimport { getValidationTranslatorFromRequest } from '@/lib/validation-translations';\r\n\r\n// Map collection names to their models\r\nconst COLLECTION_MODELS: Record<string, any> = {\r\n  products: Product,\r\n  transactions: Transaction,\r\n  categories: Category,\r\n  stockMovements: StockMovement,\r\n  expenses: Expense,\r\n  discounts: Discount,\r\n  branches: Branch,\r\n  cashDrawerSessions: CashDrawerSession,\r\n  productBundles: ProductBundle,\r\n  attendance: Attendance,\r\n  bookings: Booking,\r\n  savedCarts: SavedCart,\r\n  auditLogs: AuditLog,\r\n};\r\n\r\n// Backup endpoint - GET\r\nexport async function GET(\r\n  request: NextRequest,\r\n  { params }: { params: Promise<{ slug: string }> }\r\n) {\r\n  try {\r\n    await connectDB();\r\n    await requireRole(request, ['admin']);\r\n    const { slug } = await params;\r\n    const t = await getValidationTranslatorFromRequest(request);\r\n    \r\n    const tenant = await Tenant.findOne({ slug, isActive: true });\r\n    if (!tenant) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.tenantNotFound', 'Tenant not found') },\r\n        { status: 404 }\r\n      );\r\n    }\r\n\r\n    const searchParams = request.nextUrl.searchParams;\r\n    const collectionsParam = searchParams.get('collections');\r\n    const collections = collectionsParam ? collectionsParam.split(',') : Object.keys(COLLECTION_MODELS);\r\n\r\n    // Validate collection names\r\n    const invalidCollections = collections.filter(\r\n      (col: string) => !COLLECTION_MODELS[col]\r\n    );\r\n    if (invalidCollections.length > 0) {\r\n      return NextResponse.json(\r\n        { success: false, error: `Invalid collections: ${invalidCollections.join(', ')}` },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    const backup: Record<string, any[]> = {};\r\n    const counts: Record<string, number> = {};\r\n\r\n    // Export data from each collection\r\n    for (const collectionName of collections) {\r\n      const Model = COLLECTION_MODELS[collectionName];\r\n      const documents = await Model.find({ tenantId: tenant._id }).lean();\r\n      backup[collectionName] = documents;\r\n      counts[collectionName] = documents.length;\r\n    }\r\n\r\n    const backupData = {\r\n      version: '1.0',\r\n      tenantSlug: slug,\r\n      tenantName: tenant.name,\r\n      createdAt: new Date().toISOString(),\r\n      collections: backup,\r\n      counts,\r\n    };\r\n\r\n    // Create audit log\r\n    await createAuditLog(request, {\r\n      tenantId: tenant._id,\r\n      action: AuditActions.VIEW,\r\n      entityType: 'collections',\r\n      entityId: 'backup',\r\n      changes: {\r\n        collections: collections,\r\n        counts: counts,\r\n      },\r\n    });\r\n\r\n    // Return as JSON with download headers\r\n    return new NextResponse(JSON.stringify(backupData, null, 2), {\r\n      status: 200,\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n        'Content-Disposition': `attachment; filename=\"backup-${slug}-${new Date().toISOString().split('T')[0]}.json\"`,\r\n      },\r\n    });\r\n  } catch (error: any) {\r\n    if (error.message === 'Unauthorized' || error.message.includes('Forbidden')) {\r\n      return NextResponse.json(\r\n        { success: false, error: error.message },\r\n        { status: error.message === 'Unauthorized' ? 401 : 403 }\r\n      );\r\n    }\r\n    console.error('Error creating backup:', error);\r\n    const t = await getValidationTranslatorFromRequest(request);\r\n    return NextResponse.json(\r\n      { success: false, error: error.message || t('validation.failedToCreateBackup', 'Failed to create backup') },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n\r\nexport async function POST(\r\n  request: NextRequest,\r\n  { params }: { params: Promise<{ slug: string }> }\r\n) {\r\n  try {\r\n    await connectDB();\r\n    await requireRole(request, ['admin']);\r\n    const { slug } = await params;\r\n    \r\n    const tenant = await Tenant.findOne({ slug, isActive: true });\r\n    const t = await getValidationTranslatorFromRequest(request);\r\n    if (!tenant) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.tenantNotFound', 'Tenant not found') },\r\n        { status: 404 }\r\n      );\r\n    }\r\n\r\n    const body = await request.json();\r\n    const { collections } = body;\r\n\r\n    if (!Array.isArray(collections) || collections.length === 0) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.collectionsArrayRequired', 'Collections array is required') },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    // Validate collection names\r\n    const invalidCollections = collections.filter(\r\n      (col: string) => !COLLECTION_MODELS[col]\r\n    );\r\n    if (invalidCollections.length > 0) {\r\n      return NextResponse.json(\r\n        { success: false, error: `Invalid collections: ${invalidCollections.join(', ')}` },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    const results: Record<string, { deleted: number }> = {};\r\n\r\n    // Delete documents for each collection\r\n    for (const collectionName of collections) {\r\n      const Model = COLLECTION_MODELS[collectionName];\r\n      const result = await Model.deleteMany({ tenantId: tenant._id });\r\n      results[collectionName] = { deleted: result.deletedCount || 0 };\r\n    }\r\n\r\n    // Create audit log\r\n    await createAuditLog(request, {\r\n      tenantId: tenant._id,\r\n      action: AuditActions.DELETE,\r\n      entityType: 'collections',\r\n      entityId: 'reset',\r\n      changes: {\r\n        collections: collections,\r\n        results: results,\r\n      },\r\n    });\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      data: {\r\n        message: `Successfully reset ${collections.length} collection(s)`,\r\n        results,\r\n      },\r\n    });\r\n  } catch (error: any) {\r\n    if (error.message === 'Unauthorized' || error.message.includes('Forbidden')) {\r\n      return NextResponse.json(\r\n        { success: false, error: error.message },\r\n        { status: error.message === 'Unauthorized' ? 401 : 403 }\r\n      );\r\n    }\r\n    console.error('Error resetting collections:', error);\r\n    const t = await getValidationTranslatorFromRequest(request);\r\n    return NextResponse.json(\r\n      { success: false, error: error.message || t('validation.failedToResetCollections', 'Failed to reset collections') },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n\r\n// Restore endpoint - PUT\r\nexport async function PUT(\r\n  request: NextRequest,\r\n  { params }: { params: Promise<{ slug: string }> }\r\n) {\r\n  try {\r\n    await connectDB();\r\n    await requireRole(request, ['admin']);\r\n    const { slug } = await params;\r\n    \r\n    const tenant = await Tenant.findOne({ slug, isActive: true });\r\n    const t = await getValidationTranslatorFromRequest(request);\r\n    if (!tenant) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.tenantNotFound', 'Tenant not found') },\r\n        { status: 404 }\r\n      );\r\n    }\r\n\r\n    const body = await request.json();\r\n    const { backupData, clearExisting = false } = body;\r\n\r\n    if (!backupData || !backupData.collections) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.invalidBackupDataFormat', 'Invalid backup data format') },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    const results: Record<string, { restored: number; cleared: number }> = {};\r\n\r\n    // Restore each collection\r\n    for (const [collectionName, documents] of Object.entries(backupData.collections)) {\r\n      if (!COLLECTION_MODELS[collectionName]) {\r\n        continue; // Skip invalid collections\r\n      }\r\n\r\n      const Model = COLLECTION_MODELS[collectionName];\r\n      let cleared = 0;\r\n\r\n      // Clear existing data if requested\r\n      if (clearExisting) {\r\n        const deleteResult = await Model.deleteMany({ tenantId: tenant._id });\r\n        cleared = deleteResult.deletedCount || 0;\r\n      }\r\n\r\n      // Restore documents\r\n      if (Array.isArray(documents) && documents.length > 0) {\r\n        // Replace tenantId with current tenant's ID and convert _id strings to ObjectIds\r\n        const documentsToInsert = documents.map((doc: any) => {\r\n          const newDoc = { ...doc };\r\n          // Remove _id to let MongoDB create new ones (or keep if you want to preserve IDs)\r\n          delete newDoc._id;\r\n          // Ensure tenantId is set correctly\r\n          newDoc.tenantId = tenant._id;\r\n          // Convert any ObjectId strings to ObjectIds\r\n          Object.keys(newDoc).forEach(key => {\r\n            if (typeof newDoc[key] === 'string' && mongoose.Types.ObjectId.isValid(newDoc[key]) && key.endsWith('Id')) {\r\n              newDoc[key] = new mongoose.Types.ObjectId(newDoc[key]);\r\n            }\r\n          });\r\n          // Handle nested ObjectIds in arrays (like items.product in transactions)\r\n          if (newDoc.items && Array.isArray(newDoc.items)) {\r\n            newDoc.items = newDoc.items.map((item: any) => {\r\n              if (item.product && typeof item.product === 'string' && mongoose.Types.ObjectId.isValid(item.product)) {\r\n                item.product = new mongoose.Types.ObjectId(item.product);\r\n              }\r\n              return item;\r\n            });\r\n          }\r\n          return newDoc;\r\n        });\r\n\r\n        await Model.insertMany(documentsToInsert, { ordered: false });\r\n        results[collectionName] = { restored: documentsToInsert.length, cleared };\r\n      } else {\r\n        results[collectionName] = { restored: 0, cleared };\r\n      }\r\n    }\r\n\r\n    // Create audit log\r\n    await createAuditLog(request, {\r\n      tenantId: tenant._id,\r\n      action: AuditActions.UPDATE,\r\n      entityType: 'collections',\r\n      entityId: 'restore',\r\n      changes: {\r\n        collections: Object.keys(backupData.collections),\r\n        results: results,\r\n        clearExisting,\r\n      },\r\n    });\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      data: {\r\n        message: `Successfully restored ${Object.keys(backupData.collections).length} collection(s)`,\r\n        results,\r\n      },\r\n    });\r\n  } catch (error: any) {\r\n    if (error.message === 'Unauthorized' || error.message.includes('Forbidden')) {\r\n      return NextResponse.json(\r\n        { success: false, error: error.message },\r\n        { status: error.message === 'Unauthorized' ? 401 : 403 }\r\n      );\r\n    }\r\n    console.error('Error restoring backup:', error);\r\n    const t = await getValidationTranslatorFromRequest(request);\r\n    return NextResponse.json(\r\n      { success: false, error: error.message || t('validation.failedToRestoreBackup', 'Failed to restore backup') },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\tenants\\[slug]\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":22,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":22,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[996,999],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[996,999],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":42,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":42,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1745,1748],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1745,1748],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":93,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":93,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3302,3305],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3302,3305],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":115,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":115,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3963,3966],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3963,3966],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":159,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":159,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5596,5599],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5596,5599],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\nimport connectDB from '@/lib/mongodb';\r\nimport Tenant from '@/models/Tenant';\r\nimport { requireRole } from '@/lib/auth';\r\nimport { createAuditLog, AuditActions } from '@/lib/audit';\r\nimport { handleApiError } from '@/lib/error-handler';\r\nimport { getValidationTranslatorFromRequest } from '@/lib/validation-translations';\r\nimport { applyBusinessTypeDefaults } from '@/lib/business-types';\r\n\r\nexport async function GET(request: NextRequest, { params }: { params: Promise<{ slug: string }> }) {\r\n  try {\r\n    await connectDB();\r\n    const { slug } = await params;\r\n    const t = await getValidationTranslatorFromRequest(request);\r\n    const tenant = await Tenant.findOne({ slug }).lean();\r\n    \r\n    if (!tenant) {\r\n      return NextResponse.json({ success: false, error: t('validation.tenantNotFound', 'Tenant not found') }, { status: 404 });\r\n    }\r\n    \r\n    return NextResponse.json({ success: true, data: tenant });\r\n  } catch (error: any) {\r\n    return NextResponse.json({ success: false, error: error.message }, { status: 500 });\r\n  }\r\n}\r\n\r\nexport async function PUT(request: NextRequest, { params }: { params: Promise<{ slug: string }> }) {\r\n  try {\r\n    await connectDB();\r\n    await requireRole(request, ['admin']);\r\n    const { slug } = await params;\r\n    const t = await getValidationTranslatorFromRequest(request);\r\n    \r\n    const body = await request.json();\r\n    const { name, domain, subdomain, isActive, settings } = body;\r\n\r\n    const oldTenant = await Tenant.findOne({ slug }).lean();\r\n    if (!oldTenant) {\r\n      return NextResponse.json({ success: false, error: t('validation.tenantNotFound', 'Tenant not found') }, { status: 404 });\r\n    }\r\n\r\n    const updateData: any = {};\r\n    \r\n    if (name !== undefined) {\r\n      if (!name.trim()) {\r\n        return NextResponse.json(\r\n          { success: false, error: t('validation.nameRequired', 'Name is required') },\r\n          { status: 400 }\r\n        );\r\n      }\r\n      updateData.name = name.trim();\r\n    }\r\n    \r\n    if (domain !== undefined) {\r\n      updateData.domain = domain.trim() || null;\r\n    }\r\n    \r\n    if (subdomain !== undefined) {\r\n      updateData.subdomain = subdomain.trim().toLowerCase() || null;\r\n    }\r\n    \r\n    if (isActive !== undefined) {\r\n      updateData.isActive = isActive;\r\n    }\r\n    \r\n    if (settings !== undefined) {\r\n      // Check if business type is being changed\r\n      const currentBusinessType = oldTenant.settings?.businessType;\r\n      const newBusinessType = settings.businessType;\r\n      \r\n      // Merge settings first\r\n      let mergedSettings = { ...oldTenant.settings, ...settings };\r\n      \r\n      // Apply business type defaults if business type is being set or changed\r\n      if (newBusinessType && newBusinessType !== currentBusinessType) {\r\n        mergedSettings = applyBusinessTypeDefaults(mergedSettings, newBusinessType);\r\n      }\r\n      \r\n      updateData.settings = mergedSettings;\r\n    }\r\n\r\n    const tenant = await Tenant.findOneAndUpdate(\r\n      { slug },\r\n      updateData,\r\n      { new: true, runValidators: true }\r\n    );\r\n    \r\n    if (!tenant) {\r\n      return NextResponse.json({ success: false, error: 'Tenant not found' }, { status: 404 });\r\n    }\r\n\r\n    // Track changes\r\n    const changes: Record<string, any> = {};\r\n    Object.keys(updateData).forEach(key => {\r\n      if (key !== 'settings' && oldTenant[key as keyof typeof oldTenant] !== updateData[key]) {\r\n        changes[key] = {\r\n          old: oldTenant[key as keyof typeof oldTenant],\r\n          new: updateData[key],\r\n        };\r\n      }\r\n    });\r\n    if (settings) {\r\n      changes.settings = { updated: true };\r\n    }\r\n\r\n    await createAuditLog(request, {\r\n      tenantId: tenant._id,\r\n      action: AuditActions.UPDATE,\r\n      entityType: 'tenant',\r\n      entityId: tenant._id.toString(),\r\n      changes,\r\n    });\r\n    \r\n    return NextResponse.json({ success: true, data: tenant });\r\n  } catch (error: any) {\r\n    const t = await getValidationTranslatorFromRequest(request);\r\n    if (error.code === 11000) {\r\n      const field = Object.keys(error.keyPattern)[0];\r\n      const errorMsg = t('validation.fieldAlreadyExists', '{field} already exists').replace('{field}', field);\r\n      return NextResponse.json(\r\n        { success: false, error: errorMsg },\r\n        { status: 400 }\r\n      );\r\n    }\r\n    if (error.message === 'Unauthorized' || error.message.includes('Forbidden')) {\r\n      return NextResponse.json(\r\n        { success: false, error: error.message },\r\n        { status: error.message === 'Unauthorized' ? 401 : 403 }\r\n      );\r\n    }\r\n    return handleApiError(error);\r\n  }\r\n}\r\n\r\nexport async function DELETE(request: NextRequest, { params }: { params: Promise<{ slug: string }> }) {\r\n  try {\r\n    await connectDB();\r\n    await requireRole(request, ['admin']);\r\n    const { slug } = await params;\r\n    const t = await getValidationTranslatorFromRequest(request);\r\n    \r\n    const tenant = await Tenant.findOne({ slug }).lean();\r\n    if (!tenant) {\r\n      return NextResponse.json({ success: false, error: t('validation.tenantNotFound', 'Tenant not found') }, { status: 404 });\r\n    }\r\n\r\n    // Soft delete - set isActive to false\r\n    await Tenant.findOneAndUpdate({ slug }, { isActive: false });\r\n\r\n    await createAuditLog(request, {\r\n      tenantId: tenant._id,\r\n      action: AuditActions.DELETE,\r\n      entityType: 'tenant',\r\n      entityId: tenant._id.toString(),\r\n      changes: { slug: tenant.slug, name: tenant.name },\r\n    });\r\n    \r\n    return NextResponse.json({ success: true, data: {} });\r\n  } catch (error: any) {\r\n    if (error.message === 'Unauthorized' || error.message.includes('Forbidden')) {\r\n      return NextResponse.json(\r\n        { success: false, error: error.message },\r\n        { status: error.message === 'Unauthorized' ? 401 : 403 }\r\n      );\r\n    }\r\n    return handleApiError(error);\r\n  }\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\tenants\\[slug]\\settings\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":29,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":29,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1138,1141],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1138,1141],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'user' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":47,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":47,"endColumn":17},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":49,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":49,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1943,1946],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1943,1946],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":131,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":131,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5081,5084],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5081,5084],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\nimport connectDB from '@/lib/mongodb';\r\nimport Tenant from '@/models/Tenant';\r\nimport { requireAuth, requireRole } from '@/lib/auth';\r\nimport { createAuditLog, AuditActions } from '@/lib/audit';\r\nimport { getDefaultTenantSettings } from '@/lib/currency';\r\nimport { getValidationTranslatorFromRequest } from '@/lib/validation-translations';\r\nimport { applyBusinessTypeDefaults } from '@/lib/business-types';\r\n\r\nexport async function GET(\r\n  request: NextRequest,\r\n  { params }: { params: Promise<{ slug: string }> }\r\n) {\r\n  try {\r\n    await connectDB();\r\n    // Settings are public per tenant (no sensitive data exposed)\r\n    const { slug } = await params;\r\n    const t = await getValidationTranslatorFromRequest(request);\r\n    \r\n    const tenant = await Tenant.findOne({ slug, isActive: true }).lean();\r\n    if (!tenant) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.tenantNotFound', 'Tenant not found') },\r\n        { status: 404 }\r\n      );\r\n    }\r\n\r\n    return NextResponse.json({ success: true, data: tenant.settings });\r\n  } catch (error: any) {\r\n    console.error('Error fetching tenant settings:', error);\r\n    const t = await getValidationTranslatorFromRequest(request);\r\n    return NextResponse.json({ success: false, error: error.message || t('validation.failedToFetchSettings', 'Failed to fetch settings') }, { status: 500 });\r\n  }\r\n}\r\n\r\nexport async function PUT(\r\n  request: NextRequest,\r\n  { params }: { params: Promise<{ slug: string }> }\r\n) {\r\n  try {\r\n    await connectDB();\r\n    const { slug } = await params;\r\n    \r\n    // Try to get current user, but don't require auth (settings are tenant-scoped)\r\n    // If user is authenticated, verify they have proper role\r\n    try {\r\n      const user = await requireRole(request, ['admin', 'manager']);\r\n      // User is authenticated and has proper role, proceed\r\n    } catch (authError: any) {\r\n      // If auth fails, still allow update but log it (tenant-scoped security)\r\n      // In production, you might want to require auth here\r\n      console.log('Settings update without authentication for tenant:', slug);\r\n    }\r\n    \r\n    const body = await request.json();\r\n    const settings = body.settings || body;\r\n    const t = await getValidationTranslatorFromRequest(request);\r\n\r\n    // Validate settings structure\r\n    const defaultSettings = getDefaultTenantSettings();\r\n    const mergedSettings = { ...defaultSettings, ...settings };\r\n    \r\n    // Auto-configure features based on business type if business type is being set/changed\r\n    const existingTenant = await Tenant.findOne({ slug }).lean();\r\n    const currentBusinessType = existingTenant?.settings?.businessType;\r\n    const newBusinessType = settings.businessType;\r\n    \r\n    // Apply business type defaults if business type is being set or changed\r\n    let updatedSettings = mergedSettings;\r\n    if (newBusinessType && newBusinessType !== currentBusinessType) {\r\n      updatedSettings = applyBusinessTypeDefaults(mergedSettings, newBusinessType);\r\n    }\r\n\r\n    // Validate currency code (basic check)\r\n    if (updatedSettings.currency && updatedSettings.currency.length !== 3) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.invalidCurrencyCode', 'Invalid currency code') },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    // Validate tax rate\r\n    if (updatedSettings.taxRate !== undefined) {\r\n      if (updatedSettings.taxRate < 0 || updatedSettings.taxRate > 100) {\r\n        return NextResponse.json(\r\n          { success: false, error: t('validation.taxRateRange', 'Tax rate must be between 0 and 100') },\r\n          { status: 400 }\r\n        );\r\n      }\r\n    }\r\n\r\n    // Validate color format (hex)\r\n    const colorFields = ['primaryColor', 'secondaryColor', 'accentColor', 'backgroundColor', 'textColor'];\r\n    for (const field of colorFields) {\r\n      if (updatedSettings[field] && !/^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/.test(updatedSettings[field])) {\r\n        return NextResponse.json(\r\n          { success: false, error: `Invalid color format for ${field}. Use hex format (e.g., #FF5733)` },\r\n          { status: 400 }\r\n        );\r\n      }\r\n    }\r\n\r\n    const tenant = await Tenant.findOneAndUpdate(\r\n      { slug },\r\n      { $set: { settings: updatedSettings } },\r\n      { new: true, runValidators: true }\r\n    );\r\n\r\n    if (!tenant) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.tenantNotFound', 'Tenant not found') },\r\n        { status: 404 }\r\n      );\r\n    }\r\n\r\n    // Try to create audit log if user is authenticated\r\n    try {\r\n      await requireAuth(request);\r\n      await createAuditLog(request, {\r\n        tenantId: tenant._id,\r\n        action: AuditActions.UPDATE,\r\n        entityType: 'tenant',\r\n        entityId: tenant._id.toString(),\r\n        changes: { settings: updatedSettings },\r\n      });\r\n    } catch {\r\n      // Audit log is optional if not authenticated\r\n    }\r\n\r\n    return NextResponse.json({ success: true, data: tenant.settings });\r\n  } catch (error: any) {\r\n    console.error('Error updating tenant settings:', error);\r\n    const t = await getValidationTranslatorFromRequest(request);\r\n    return NextResponse.json({ success: false, error: error.message || t('validation.failedToUpdateSettings', 'Failed to update settings') }, { status: 400 });\r\n  }\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\tenants\\[slug]\\tax-rules\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":33,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":33,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[921,924],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[921,924],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":96,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":96,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2900,2903],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2900,2903],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":136,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":136,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4263,4266],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4263,4266],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":152,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":152,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4726,4729],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4726,4729],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":188,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":188,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5899,5902],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5899,5902],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":199,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":199,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6265,6268],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6265,6268],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Tax Rules API\r\n * Handles CRUD operations for regional tax rules\r\n */\r\n\r\nimport { NextRequest, NextResponse } from 'next/server';\r\nimport connectDB from '@/lib/mongodb';\r\nimport Tenant from '@/models/Tenant';\r\nimport { getCurrentUser } from '@/lib/auth';\r\n\r\nexport async function GET(\r\n  request: NextRequest,\r\n  { params }: { params: Promise<{ slug: string }> }\r\n) {\r\n  try {\r\n    const user = await getCurrentUser(request);\r\n    if (!user) {\r\n      return NextResponse.json({ success: false, error: 'Unauthorized' }, { status: 401 });\r\n    }\r\n\r\n    const { slug } = await params;\r\n    await connectDB();\r\n\r\n    const tenant = await Tenant.findOne({ slug });\r\n    if (!tenant) {\r\n      return NextResponse.json({ success: false, error: 'Tenant not found' }, { status: 404 });\r\n    }\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      data: tenant.settings.taxRules || [],\r\n    });\r\n  } catch (error: any) {\r\n    console.error('Error fetching tax rules:', error);\r\n    return NextResponse.json({ success: false, error: error.message }, { status: 500 });\r\n  }\r\n}\r\n\r\nexport async function POST(\r\n  request: NextRequest,\r\n  { params }: { params: Promise<{ slug: string }> }\r\n) {\r\n  try {\r\n    const user = await getCurrentUser(request);\r\n    if (!user) {\r\n      return NextResponse.json({ success: false, error: 'Unauthorized' }, { status: 401 });\r\n    }\r\n\r\n    if (user.role !== 'admin' && user.role !== 'manager') {\r\n      return NextResponse.json({ success: false, error: 'Forbidden' }, { status: 403 });\r\n    }\r\n\r\n    const { slug } = await params;\r\n    const body = await request.json();\r\n    const { name, rate, label, appliesTo, categoryIds, productIds, region, priority, isActive } = body;\r\n\r\n    if (!name || rate === undefined || !label) {\r\n      return NextResponse.json({ success: false, error: 'Name, rate, and label are required' }, { status: 400 });\r\n    }\r\n\r\n    if (rate < 0 || rate > 100) {\r\n      return NextResponse.json({ success: false, error: 'Rate must be between 0 and 100' }, { status: 400 });\r\n    }\r\n\r\n    await connectDB();\r\n\r\n    const tenant = await Tenant.findOne({ slug });\r\n    if (!tenant) {\r\n      return NextResponse.json({ success: false, error: 'Tenant not found' }, { status: 404 });\r\n    }\r\n\r\n    const taxRules = tenant.settings.taxRules || [];\r\n    const newRule = {\r\n      id: `tax_rule_${Date.now()}`,\r\n      name,\r\n      rate,\r\n      label,\r\n      appliesTo: appliesTo || 'all',\r\n      categoryIds: categoryIds || [],\r\n      productIds: productIds || [],\r\n      region: region || {},\r\n      priority: priority || 0,\r\n      isActive: isActive !== undefined ? isActive : true,\r\n    };\r\n\r\n    taxRules.push(newRule);\r\n\r\n    tenant.settings.taxRules = taxRules;\r\n    tenant.markModified('settings.taxRules');\r\n    await tenant.save();\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      data: newRule,\r\n    });\r\n  } catch (error: any) {\r\n    console.error('Error creating tax rule:', error);\r\n    return NextResponse.json({ success: false, error: error.message }, { status: 500 });\r\n  }\r\n}\r\n\r\nexport async function PUT(\r\n  request: NextRequest,\r\n  { params }: { params: Promise<{ slug: string }> }\r\n) {\r\n  try {\r\n    const user = await getCurrentUser(request);\r\n    if (!user) {\r\n      return NextResponse.json({ success: false, error: 'Unauthorized' }, { status: 401 });\r\n    }\r\n\r\n    if (user.role !== 'admin' && user.role !== 'manager') {\r\n      return NextResponse.json({ success: false, error: 'Forbidden' }, { status: 403 });\r\n    }\r\n\r\n    const { slug } = await params;\r\n    const body = await request.json();\r\n    const { id, ...updates } = body;\r\n\r\n    if (!id) {\r\n      return NextResponse.json({ success: false, error: 'Tax rule ID is required' }, { status: 400 });\r\n    }\r\n\r\n    if (updates.rate !== undefined && (updates.rate < 0 || updates.rate > 100)) {\r\n      return NextResponse.json({ success: false, error: 'Rate must be between 0 and 100' }, { status: 400 });\r\n    }\r\n\r\n    await connectDB();\r\n\r\n    const tenant = await Tenant.findOne({ slug });\r\n    if (!tenant) {\r\n      return NextResponse.json({ success: false, error: 'Tenant not found' }, { status: 404 });\r\n    }\r\n\r\n    const taxRules = tenant.settings.taxRules || [];\r\n    const ruleIndex = taxRules.findIndex((r: any) => r.id === id);\r\n\r\n    if (ruleIndex === -1) {\r\n      return NextResponse.json({ success: false, error: 'Tax rule not found' }, { status: 404 });\r\n    }\r\n\r\n    taxRules[ruleIndex] = { ...taxRules[ruleIndex], ...updates };\r\n\r\n    tenant.settings.taxRules = taxRules;\r\n    tenant.markModified('settings.taxRules');\r\n    await tenant.save();\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      data: taxRules[ruleIndex],\r\n    });\r\n  } catch (error: any) {\r\n    console.error('Error updating tax rule:', error);\r\n    return NextResponse.json({ success: false, error: error.message }, { status: 500 });\r\n  }\r\n}\r\n\r\nexport async function DELETE(\r\n  request: NextRequest,\r\n  { params }: { params: Promise<{ slug: string }> }\r\n) {\r\n  try {\r\n    const user = await getCurrentUser(request);\r\n    if (!user) {\r\n      return NextResponse.json({ success: false, error: 'Unauthorized' }, { status: 401 });\r\n    }\r\n\r\n    if (user.role !== 'admin' && user.role !== 'manager') {\r\n      return NextResponse.json({ success: false, error: 'Forbidden' }, { status: 403 });\r\n    }\r\n\r\n    const { slug } = await params;\r\n    const { searchParams } = new URL(request.url);\r\n    const id = searchParams.get('id');\r\n\r\n    if (!id) {\r\n      return NextResponse.json({ success: false, error: 'Tax rule ID is required' }, { status: 400 });\r\n    }\r\n\r\n    await connectDB();\r\n\r\n    const tenant = await Tenant.findOne({ slug });\r\n    if (!tenant) {\r\n      return NextResponse.json({ success: false, error: 'Tenant not found' }, { status: 404 });\r\n    }\r\n\r\n    const taxRules = tenant.settings.taxRules || [];\r\n    const filtered = taxRules.filter((r: any) => r.id !== id);\r\n\r\n    if (filtered.length === taxRules.length) {\r\n      return NextResponse.json({ success: false, error: 'Tax rule not found' }, { status: 404 });\r\n    }\r\n\r\n    tenant.settings.taxRules = filtered;\r\n    tenant.markModified('settings.taxRules');\r\n    await tenant.save();\r\n\r\n    return NextResponse.json({ success: true });\r\n  } catch (error: any) {\r\n    console.error('Error deleting tax rule:', error);\r\n    return NextResponse.json({ success: false, error: error.message }, { status: 500 });\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\tenants\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\tenants\\signup\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":122,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":122,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4102,4105],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4102,4105],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":155,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":155,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4976,4979],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4976,4979],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\nimport connectDB from '@/lib/mongodb';\r\nimport Tenant from '@/models/Tenant';\r\nimport User from '@/models/User';\r\nimport { getDefaultTenantSettings } from '@/lib/currency';\r\nimport { validateEmail, validatePassword, validateTenant } from '@/lib/validation';\r\nimport { getValidationTranslator } from '@/lib/validation-translations';\r\nimport { applyBusinessTypeDefaults } from '@/lib/business-types';\r\n\r\n/**\r\n * Public endpoint for tenant signup\r\n * Creates a new tenant and admin user without requiring authentication\r\n */\r\nexport async function POST(request: NextRequest) {\r\n  let t: (key: string, fallback: string) => string;\r\n  try {\r\n    await connectDB();\r\n    \r\n    const body = await request.json();\r\n    const { \r\n      // Tenant info\r\n      slug, \r\n      name, \r\n      companyName,\r\n      businessType,\r\n      // Admin user info\r\n      adminEmail,\r\n      adminPassword,\r\n      adminName,\r\n      // Optional settings\r\n      currency,\r\n      language,\r\n      phone,\r\n      email: contactEmail,\r\n    } = body;\r\n\r\n    // Get translation function based on selected language\r\n    const lang = (language === 'es' ? 'es' : 'en') as 'en' | 'es';\r\n    t = await getValidationTranslator(lang);\r\n\r\n    // Validate tenant data\r\n    const tenantErrors = validateTenant({ slug, name }, t);\r\n    if (tenantErrors.length > 0) {\r\n      return NextResponse.json(\r\n        { success: false, error: tenantErrors[0].message },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    // Validate admin user data\r\n    if (!adminEmail || !adminPassword || !adminName) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.adminFieldsRequired', 'Admin email, password, and name are required') },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    if (!validateEmail(adminEmail)) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.invalidEmailFormat', 'Invalid admin email format') },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    const passwordValidation = validatePassword(adminPassword, t);\r\n    if (!passwordValidation.valid) {\r\n      return NextResponse.json(\r\n        { success: false, error: 'Password validation failed', errors: passwordValidation.errors },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    // Validate slug format (already validated in validateTenant, but keeping for consistency)\r\n    if (!/^[a-z0-9-]+$/.test(slug)) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.slugFormat', 'Slug can only contain lowercase letters, numbers, and hyphens') },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    // Check if tenant already exists\r\n    const existingTenant = await Tenant.findOne({\r\n      $or: [\r\n        { slug: slug.toLowerCase() },\r\n      ]\r\n    });\r\n\r\n    if (existingTenant) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.storeIdentifierExists', 'A store with this identifier already exists. Please choose a different one.') },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    // Check if admin email already exists\r\n    const existingUser = await User.findOne({ email: adminEmail.toLowerCase() });\r\n    if (existingUser) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.emailExists', 'An account with this email already exists') },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    // Get default settings and customize\r\n    const defaultSettings = getDefaultTenantSettings();\r\n    const baseSettings = {\r\n      ...defaultSettings,\r\n      currency: currency || defaultSettings.currency,\r\n      language: (language === 'es' ? 'es' : 'en') as 'en' | 'es',\r\n      ...(contactEmail && { email: contactEmail }),\r\n      ...(phone && { phone }),\r\n      ...(companyName && { companyName }),\r\n      ...(businessType && { businessType }),\r\n    };\r\n\r\n    // Apply business type defaults if business type is provided\r\n    const settings = businessType \r\n      ? applyBusinessTypeDefaults(baseSettings, businessType)\r\n      : baseSettings;\r\n\r\n    // Create tenant\r\n    const tenantData: any = {\r\n      slug: slug.toLowerCase(),\r\n      name,\r\n      settings,\r\n      isActive: true,\r\n    };\r\n\r\n    const tenant = await Tenant.create(tenantData);\r\n\r\n    // Create admin user for the tenant\r\n    const adminUser = await User.create({\r\n      email: adminEmail.toLowerCase(),\r\n      password: adminPassword,\r\n      name: adminName,\r\n      role: 'admin',\r\n      tenantId: tenant._id,\r\n      isActive: true,\r\n    });\r\n\r\n    return NextResponse.json({ \r\n      success: true, \r\n      data: {\r\n        tenant: {\r\n          slug: tenant.slug,\r\n          name: tenant.name,\r\n        },\r\n        adminUser: {\r\n          email: adminUser.email,\r\n          name: adminUser.name,\r\n        },\r\n        message: t('validation.storeCreatedSuccess', 'Store created successfully! You can now login with your admin credentials.')\r\n      }\r\n    }, { status: 201 });\r\n  } catch (error: any) {\r\n    if (error.code === 11000) {\r\n      const field = Object.keys(error.keyPattern)[0];\r\n      return NextResponse.json(\r\n        { success: false, error: `${field} already exists` },\r\n        { status: 400 }\r\n      );\r\n    }\r\n    console.error('Signup error:', error);\r\n    const errorMessage = error.message || 'Failed to create store. Please try again.';\r\n    return NextResponse.json({ \r\n      success: false, \r\n      error: errorMessage\r\n    }, { status: 400 });\r\n  }\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\transactions\\[id]\\refund\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":47,"column":65,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":47,"endColumn":68,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2008,2011],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2008,2011],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":58,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":58,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2312,2315],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2312,2315],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":96,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":96,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3735,3738],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3735,3738],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":98,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":98,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3822,3825],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3822,3825],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":131,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":131,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5071,5074],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5071,5074],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":132,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":132,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5134,5137],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5134,5137],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":200,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":200,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7335,7338],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7335,7338],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\nimport connectDB from '@/lib/mongodb';\r\nimport Transaction from '@/models/Transaction';\r\nimport Payment from '@/models/Payment';\r\nimport Product from '@/models/Product';\r\nimport { getTenantIdFromRequest } from '@/lib/api-tenant';\r\nimport { requireRole, getCurrentUser } from '@/lib/auth';\r\nimport { createAuditLog, AuditActions } from '@/lib/audit';\r\nimport { updateStock } from '@/lib/stock';\r\nimport { getValidationTranslatorFromRequest } from '@/lib/validation-translations';\r\n\r\nexport async function POST(request: NextRequest, { params }: { params: Promise<{ id: string }> }) {\r\n  try {\r\n    await connectDB();\r\n    await requireRole(request, ['admin', 'manager']);\r\n    const tenantId = await getTenantIdFromRequest(request);\r\n    const { id } = await params;\r\n    const body = await request.json();\r\n    const t = await getValidationTranslatorFromRequest(request);\r\n    \r\n    if (!tenantId) {\r\n      return NextResponse.json({ success: false, error: t('validation.tenantNotFound', 'Tenant not found') }, { status: 404 });\r\n    }\r\n\r\n    const transaction = await Transaction.findOne({ _id: id, tenantId });\r\n    if (!transaction) {\r\n      return NextResponse.json({ success: false, error: t('validation.transactionNotFound', 'Transaction not found') }, { status: 404 });\r\n    }\r\n\r\n    if (transaction.status === 'refunded') {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.transactionAlreadyRefunded', 'Transaction has already been refunded') },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    if (transaction.status !== 'completed') {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.onlyCompletedRefundable', 'Only completed transactions can be refunded') },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    const { items, reason, notes } = body;\r\n\r\n    // If no items specified, refund all items (full refund)\r\n    const itemsToRefund = items || transaction.items.map((item: any) => ({\r\n      productId: item.product.toString(),\r\n      quantity: item.quantity,\r\n    }));\r\n\r\n    // Validate items to refund\r\n    const refundItems = [];\r\n    let refundAmount = 0;\r\n\r\n    for (const refundItem of itemsToRefund) {\r\n      const originalItem = transaction.items.find(\r\n        (item: any) => item.product.toString() === refundItem.productId\r\n      );\r\n\r\n      if (!originalItem) {\r\n        const errorMsg = t('validation.itemNotFoundInTransaction', 'Item {productId} not found in transaction').replace('{productId}', refundItem.productId);\r\n        return NextResponse.json(\r\n          { success: false, error: errorMsg },\r\n          { status: 400 }\r\n        );\r\n      }\r\n\r\n      if (refundItem.quantity > originalItem.quantity) {\r\n        return NextResponse.json(\r\n          { success: false, error: t('validation.cannotRefundMoreThanPurchased', 'Cannot refund more than purchased quantity') },\r\n          { status: 400 }\r\n        );\r\n      }\r\n\r\n      refundItems.push({\r\n        productId: refundItem.productId,\r\n        quantity: refundItem.quantity,\r\n        price: originalItem.price,\r\n        subtotal: originalItem.price * refundItem.quantity,\r\n      });\r\n\r\n      refundAmount += originalItem.price * refundItem.quantity;\r\n    }\r\n\r\n    // Calculate proportional discount refund if applicable\r\n    if (transaction.discountAmount && transaction.discountAmount > 0) {\r\n      const discountRatio = refundAmount / transaction.subtotal;\r\n      const refundDiscount = transaction.discountAmount * discountRatio;\r\n      refundAmount -= refundDiscount;\r\n    }\r\n\r\n    // Create refund transaction\r\n    const refundTransaction = await Transaction.create({\r\n      tenantId,\r\n      items: refundItems.map((item: any) => ({\r\n        product: item.productId,\r\n        name: transaction.items.find((i: any) => i.product.toString() === item.productId)?.name || '',\r\n        price: item.price,\r\n        quantity: item.quantity,\r\n        subtotal: item.subtotal,\r\n      })),\r\n      subtotal: refundAmount,\r\n      total: refundAmount,\r\n      paymentMethod: transaction.paymentMethod,\r\n      status: 'refunded',\r\n      receiptNumber: `REF-${transaction.receiptNumber || transaction._id.toString().slice(-8)}`,\r\n      notes: notes || reason || 'Refund',\r\n    });\r\n\r\n    // Restore stock for refunded items (only if product tracks inventory)\r\n    for (const refundItem of refundItems) {\r\n      const product = await Product.findOne({ _id: refundItem.productId, tenantId });\r\n      if (product && product.trackInventory !== false) {\r\n        await updateStock(\r\n          refundItem.productId,\r\n          tenantId,\r\n          refundItem.quantity, // Positive to restore\r\n          'return',\r\n          {\r\n            transactionId: refundTransaction._id.toString(),\r\n            reason: reason || 'Transaction refund',\r\n            notes: notes,\r\n          }\r\n        );\r\n      }\r\n    }\r\n\r\n    // Mark original transaction as refunded if full refund\r\n    const isFullRefund = refundItems.length === transaction.items.length &&\r\n      refundItems.every((item: any) => {\r\n        const original = transaction.items.find((i: any) => i.product.toString() === item.productId);\r\n        return original && item.quantity === original.quantity;\r\n      });\r\n\r\n    if (isFullRefund) {\r\n      transaction.status = 'refunded';\r\n      await transaction.save();\r\n    }\r\n\r\n    // Create Payment refund record if original payment exists\r\n    let refundPayment = null;\r\n    try {\r\n      const originalPayment = await Payment.findOne({\r\n        tenantId,\r\n        transactionId: transaction._id,\r\n        status: 'completed',\r\n      });\r\n\r\n      if (originalPayment) {\r\n        const user = await getCurrentUser(request);\r\n        refundPayment = await Payment.create({\r\n          tenantId,\r\n          transactionId: refundTransaction._id,\r\n          method: originalPayment.method,\r\n          amount: refundAmount,\r\n          status: 'refunded',\r\n          details: originalPayment.details,\r\n          processedBy: user?.userId,\r\n          processedAt: new Date(),\r\n          refundedAt: new Date(),\r\n          refundReason: body.reason || body.notes || 'Transaction refund',\r\n        });\r\n\r\n        // Mark original payment as refunded\r\n        originalPayment.status = 'refunded';\r\n        originalPayment.refundedAt = new Date();\r\n        originalPayment.refundReason = body.reason || body.notes || 'Transaction refund';\r\n        await originalPayment.save();\r\n      }\r\n    } catch (paymentError) {\r\n      // Log error but don't fail refund - payment record refund is optional\r\n      console.error('Failed to create payment refund record:', paymentError);\r\n    }\r\n\r\n    await createAuditLog(request, {\r\n      tenantId,\r\n      action: AuditActions.TRANSACTION_REFUND,\r\n      entityType: 'transaction',\r\n      entityId: id,\r\n      changes: {\r\n        refundTransactionId: refundTransaction._id.toString(),\r\n        refundAmount,\r\n        itemsRefunded: refundItems.length,\r\n        isFullRefund,\r\n        refundPaymentId: refundPayment?._id.toString(),\r\n      },\r\n    });\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      data: {\r\n        refundTransaction,\r\n        originalTransaction: transaction,\r\n        refundAmount,\r\n        isFullRefund,\r\n        refundPayment,\r\n      },\r\n    }, { status: 201 });\r\n  } catch (error: any) {\r\n    if (error.message === 'Unauthorized' || error.message.includes('Forbidden')) {\r\n      return NextResponse.json(\r\n        { success: false, error: error.message },\r\n        { status: error.message === 'Unauthorized' ? 401 : 403 }\r\n      );\r\n    }\r\n    return NextResponse.json({ success: false, error: error.message }, { status: 400 });\r\n  }\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\transactions\\[id]\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getTenantIdFromRequest' is defined but never used. Allowed unused vars must match /^_/u.","line":5,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":32},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'requireAuth' is defined but never used. Allowed unused vars must match /^_/u.","line":6,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":21},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":19,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":19,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[885,888],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[885,888],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'t' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":20,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":20,"endColumn":14},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":42,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":42,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1836,1839],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1836,1839],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":61,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":61,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2636,2639],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2636,2639],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'t' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":62,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":62,"endColumn":14},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":120,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":120,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4892,4895],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4892,4895],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":8,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\nimport connectDB from '@/lib/mongodb';\r\nimport Transaction from '@/models/Transaction';\r\nimport Product from '@/models/Product';\r\nimport { getTenantIdFromRequest, requireTenantAccess } from '@/lib/api-tenant';\r\nimport { requireAuth, requireRole } from '@/lib/auth';\r\nimport { createAuditLog, AuditActions } from '@/lib/audit';\r\nimport { updateStock } from '@/lib/stock';\r\nimport { getValidationTranslatorFromRequest } from '@/lib/validation-translations';\r\n\r\nexport async function GET(request: NextRequest, { params }: { params: Promise<{ id: string }> }) {\r\n  try {\r\n    await connectDB();\r\n    // SECURITY: Validate tenant access for authenticated requests\r\n    let tenantId: string;\r\n    try {\r\n      const tenantAccess = await requireTenantAccess(request);\r\n      tenantId = tenantAccess.tenantId;\r\n    } catch (authError: any) {\r\n      const t = await getValidationTranslatorFromRequest(request);\r\n      if (authError.message.includes('Unauthorized') || authError.message.includes('Forbidden')) {\r\n        return NextResponse.json(\r\n          { success: false, error: authError.message },\r\n          { status: authError.message.includes('Unauthorized') ? 401 : 403 }\r\n        );\r\n      }\r\n      throw authError;\r\n    }\r\n    const { id } = await params;\r\n    const t = await getValidationTranslatorFromRequest(request);\r\n    \r\n    const transaction = await Transaction.findOne({ _id: id, tenantId })\r\n      .populate('items.product', 'name sku')\r\n      .populate('userId', 'name email')\r\n      .lean();\r\n    \r\n    if (!transaction) {\r\n      return NextResponse.json({ success: false, error: t('validation.transactionNotFound', 'Transaction not found') }, { status: 404 });\r\n    }\r\n    \r\n    return NextResponse.json({ success: true, data: transaction });\r\n  } catch (error: any) {\r\n    const t = await getValidationTranslatorFromRequest(request);\r\n    if (error.message === 'Unauthorized') {\r\n      return NextResponse.json({ success: false, error: t('validation.unauthorized', 'Unauthorized') }, { status: 401 });\r\n    }\r\n    return NextResponse.json({ success: false, error: error.message }, { status: 500 });\r\n  }\r\n}\r\n\r\nexport async function PUT(request: NextRequest, { params }: { params: Promise<{ id: string }> }) {\r\n  try {\r\n    await connectDB();\r\n    // SECURITY: Validate tenant access for authenticated requests\r\n    let tenantId: string;\r\n    try {\r\n      const tenantAccess = await requireTenantAccess(request);\r\n      tenantId = tenantAccess.tenantId;\r\n      // Also check role\r\n      await requireRole(request, ['admin', 'manager']);\r\n    } catch (authError: any) {\r\n      const t = await getValidationTranslatorFromRequest(request);\r\n      if (authError.message.includes('Unauthorized') || authError.message.includes('Forbidden')) {\r\n        return NextResponse.json(\r\n          { success: false, error: authError.message },\r\n          { status: authError.message.includes('Unauthorized') ? 401 : 403 }\r\n        );\r\n      }\r\n      throw authError;\r\n    }\r\n    const { id } = await params;\r\n    const body = await request.json();\r\n    const t = await getValidationTranslatorFromRequest(request);\r\n\r\n    const transaction = await Transaction.findOne({ _id: id, tenantId });\r\n    if (!transaction) {\r\n      return NextResponse.json({ success: false, error: t('validation.transactionNotFound', 'Transaction not found') }, { status: 404 });\r\n    }\r\n\r\n    // Only allow status updates\r\n    if (body.status && ['cancelled', 'refunded'].includes(body.status)) {\r\n      const oldStatus = transaction.status;\r\n      transaction.status = body.status;\r\n      await transaction.save();\r\n\r\n      // If refunding, restore stock (only if product tracks inventory)\r\n      if (body.status === 'refunded' && oldStatus === 'completed') {\r\n        for (const item of transaction.items) {\r\n          const product = await Product.findOne({ _id: item.product.toString(), tenantId });\r\n          if (product && product.trackInventory !== false) {\r\n            await updateStock(\r\n              item.product.toString(),\r\n              tenantId,\r\n              item.quantity, // Positive to restore\r\n              'return',\r\n              {\r\n                transactionId: transaction._id.toString(),\r\n                reason: 'Transaction refund',\r\n              }\r\n            );\r\n          }\r\n        }\r\n      }\r\n\r\n      await createAuditLog(request, {\r\n        tenantId,\r\n        action: body.status === 'refunded' ? AuditActions.TRANSACTION_REFUND : AuditActions.TRANSACTION_CANCEL,\r\n        entityType: 'transaction',\r\n        entityId: id,\r\n        changes: { status: { old: oldStatus, new: body.status } },\r\n      });\r\n    }\r\n\r\n    if (body.notes !== undefined) {\r\n      transaction.notes = body.notes;\r\n      await transaction.save();\r\n    }\r\n\r\n    return NextResponse.json({ success: true, data: transaction });\r\n  } catch (error: any) {\r\n    if (error.message === 'Unauthorized' || error.message.includes('Forbidden')) {\r\n      return NextResponse.json(\r\n        { success: false, error: error.message },\r\n        { status: error.message === 'Unauthorized' ? 401 : 403 }\r\n      );\r\n    }\r\n    return NextResponse.json({ success: false, error: error.message }, { status: 400 });\r\n  }\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\transactions\\customer\\[customerId]\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":44,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":44,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1601,1604],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1601,1604],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":88,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":88,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2672,2675],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2672,2675],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\nimport connectDB from '@/lib/mongodb';\r\nimport Transaction from '@/models/Transaction';\r\nimport { requireCustomerAuth } from '@/lib/auth-customer';\r\nimport { getValidationTranslatorFromRequest } from '@/lib/validation-translations';\r\n\r\n/**\r\n * GET - Get all transactions/orders for a customer\r\n * Query params:\r\n * - status: transaction status (optional)\r\n * - startDate: ISO date string (optional)\r\n * - endDate: ISO date string (optional)\r\n * - page: page number (default: 1)\r\n * - limit: items per page (default: 20)\r\n */\r\nexport async function GET(\r\n  request: NextRequest,\r\n  { params }: { params: Promise<{ customerId: string }> }\r\n) {\r\n  try {\r\n    await connectDB();\r\n    const t = await getValidationTranslatorFromRequest(request);\r\n    \r\n    // Verify customer authentication\r\n    const customer = await requireCustomerAuth(request);\r\n    const { customerId } = await params;\r\n\r\n    // Ensure customer can only access their own orders\r\n    if (customer.customerId !== customerId) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.unauthorized', 'Unauthorized') },\r\n        { status: 403 }\r\n      );\r\n    }\r\n\r\n    const { searchParams } = new URL(request.url);\r\n    const status = searchParams.get('status');\r\n    const startDate = searchParams.get('startDate');\r\n    const endDate = searchParams.get('endDate');\r\n    const page = parseInt(searchParams.get('page') || '1', 10);\r\n    const limit = Math.min(parseInt(searchParams.get('limit') || '20', 10), 100);\r\n\r\n    // Build query\r\n    const query: any = {\r\n      tenantId: customer.tenantId,\r\n      $or: [\r\n        { customerEmail: customer.email },\r\n        { customerPhone: customer.phone },\r\n      ],\r\n    };\r\n\r\n    // Add status filter\r\n    if (status) {\r\n      query.status = status;\r\n    }\r\n\r\n    // Add date range filter\r\n    if (startDate || endDate) {\r\n      query.createdAt = {};\r\n      if (startDate) {\r\n        query.createdAt.$gte = new Date(startDate);\r\n      }\r\n      if (endDate) {\r\n        query.createdAt.$lte = new Date(endDate);\r\n      }\r\n    }\r\n\r\n    // Get total count for pagination\r\n    const total = await Transaction.countDocuments(query);\r\n\r\n    // Get transactions with pagination\r\n    const transactions = await Transaction.find(query)\r\n      .sort({ createdAt: -1 }) // Most recent first\r\n      .skip((page - 1) * limit)\r\n      .limit(limit)\r\n      .lean();\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      data: transactions,\r\n      pagination: {\r\n        page,\r\n        limit,\r\n        total,\r\n        pages: Math.ceil(total / limit),\r\n      },\r\n    });\r\n  } catch (error: any) {\r\n    console.error('Get customer transactions error:', error);\r\n    \r\n    if (error.message === 'Unauthorized') {\r\n      return NextResponse.json(\r\n        { success: false, error: 'Unauthorized' },\r\n        { status: 401 }\r\n      );\r\n    }\r\n\r\n    return NextResponse.json(\r\n      { success: false, error: error.message || 'Failed to fetch transactions' },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\transactions\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\transactions\\stats\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":43,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":43,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1428,1431],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1428,1431],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":73,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":73,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2179,2182],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2179,2182],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":132,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":132,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4065,4068],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4065,4068],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":159,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":159,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4882,4885],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4882,4885],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\nimport connectDB from '@/lib/mongodb';\r\nimport Transaction from '@/models/Transaction';\r\nimport Expense from '@/models/Expense';\r\nimport { getTenantIdFromRequest, TenantAccessViolationError, handleTenantAccessViolation } from '@/lib/api-tenant';\r\nimport mongoose from 'mongoose';\r\n\r\nexport async function GET(request: NextRequest) {\r\n  try {\r\n    await connectDB();\r\n    const tenantId = await getTenantIdFromRequest(request);\r\n    \r\n    if (!tenantId) {\r\n      return NextResponse.json({ success: false, error: 'Tenant not found' }, { status: 404 });\r\n    }\r\n    \r\n    // Convert tenantId string to ObjectId for proper querying\r\n    const tenantObjectId = new mongoose.Types.ObjectId(tenantId);\r\n    \r\n    const searchParams = request.nextUrl.searchParams;\r\n    const period = searchParams.get('period') || 'today'; // today, week, month, all\r\n\r\n    let startDate: Date;\r\n    const endDate = new Date();\r\n\r\n    switch (period) {\r\n      case 'today':\r\n        startDate = new Date();\r\n        startDate.setHours(0, 0, 0, 0);\r\n        break;\r\n      case 'week':\r\n        startDate = new Date();\r\n        startDate.setDate(startDate.getDate() - 7);\r\n        break;\r\n      case 'month':\r\n        startDate = new Date();\r\n        startDate.setMonth(startDate.getMonth() - 1);\r\n        break;\r\n      default:\r\n        startDate = new Date(0);\r\n    }\r\n\r\n    const matchQuery: any = {\r\n      tenantId: tenantObjectId,\r\n      status: 'completed',\r\n      createdAt: { $gte: startDate, $lte: endDate },\r\n    };\r\n\r\n    const stats = await Transaction.aggregate([\r\n      { $match: matchQuery },\r\n      {\r\n        $group: {\r\n          _id: null,\r\n          totalSales: { $sum: '$total' },\r\n          totalTransactions: { $sum: 1 },\r\n          averageTransaction: { $avg: '$total' },\r\n        },\r\n      },\r\n    ]);\r\n\r\n    const paymentMethodStats = await Transaction.aggregate([\r\n      { $match: matchQuery },\r\n      {\r\n        $group: {\r\n          _id: '$paymentMethod',\r\n          total: { $sum: '$total' },\r\n          count: { $sum: 1 },\r\n        },\r\n      },\r\n    ]);\r\n\r\n    // Time-series data for chart\r\n    let timeSeriesGroup: any;\r\n    let dateFormat: string;\r\n    \r\n    if (period === 'today') {\r\n      // Group by hour for today\r\n      timeSeriesGroup = {\r\n        $hour: '$createdAt'\r\n      };\r\n      dateFormat = 'hour';\r\n    } else if (period === 'week' || period === 'month') {\r\n      // Group by day for week/month\r\n      timeSeriesGroup = {\r\n        year: { $year: '$createdAt' },\r\n        month: { $month: '$createdAt' },\r\n        day: { $dayOfMonth: '$createdAt' }\r\n      };\r\n      dateFormat = 'day';\r\n    } else {\r\n      // Group by day for all time\r\n      timeSeriesGroup = {\r\n        year: { $year: '$createdAt' },\r\n        month: { $month: '$createdAt' },\r\n        day: { $dayOfMonth: '$createdAt' }\r\n      };\r\n      dateFormat = 'day';\r\n    }\r\n\r\n    const timeSeriesData = await Transaction.aggregate([\r\n      { $match: matchQuery },\r\n      {\r\n        $group: {\r\n          _id: timeSeriesGroup,\r\n          sales: { $sum: '$total' },\r\n          transactions: { $sum: 1 },\r\n        },\r\n      },\r\n      { $sort: { _id: 1 } },\r\n    ]);\r\n\r\n    // Format time-series data for chart\r\n    const chartData = timeSeriesData.map((item) => {\r\n      let label: string;\r\n      if (dateFormat === 'hour') {\r\n        const hour = item._id;\r\n        label = `${String(hour).padStart(2, '0')}:00`;\r\n      } else {\r\n        const { year, month, day } = item._id;\r\n        label = `${year}-${String(month).padStart(2, '0')}-${String(day).padStart(2, '0')}`;\r\n      }\r\n      const salesValue = typeof item.sales === 'number' ? item.sales : parseFloat(String(item.sales)) || 0;\r\n      const transactionsValue = typeof item.transactions === 'number' ? item.transactions : parseInt(String(item.transactions)) || 0;\r\n      return {\r\n        date: label,\r\n        sales: salesValue,\r\n        transactions: transactionsValue,\r\n      };\r\n    });\r\n\r\n    // Get expense statistics for the same period\r\n    const expenseQuery: any = {\r\n      tenantId: tenantObjectId,\r\n      date: { $gte: startDate, $lte: endDate },\r\n    };\r\n    \r\n    const expenseStats = await Expense.aggregate([\r\n      { $match: expenseQuery },\r\n      {\r\n        $group: {\r\n          _id: null,\r\n          totalExpenses: { $sum: '$amount' },\r\n          expenseCount: { $sum: 1 },\r\n        },\r\n      },\r\n    ]);\r\n\r\n    const result = {\r\n      totalSales: stats[0]?.totalSales || 0,\r\n      totalTransactions: stats[0]?.totalTransactions || 0,\r\n      averageTransaction: stats[0]?.averageTransaction || 0,\r\n      totalExpenses: expenseStats[0]?.totalExpenses || 0,\r\n      expenseCount: expenseStats[0]?.expenseCount || 0,\r\n      paymentMethods: paymentMethodStats,\r\n      chartData,\r\n    };\r\n\r\n    return NextResponse.json({ success: true, data: result });\r\n  } catch (error: any) {\r\n    // Handle tenant access violations with redirect\r\n    if (error instanceof TenantAccessViolationError) {\r\n      return handleTenantAccessViolation(error, request);\r\n    }\r\n    return NextResponse.json({ success: false, error: error.message }, { status: 500 });\r\n  }\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\users\\[id]\\pin\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":84,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":84,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2767,2770],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2767,2770],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":142,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":142,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4572,4575],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4572,4575],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\nimport connectDB from '@/lib/mongodb';\r\nimport User from '@/models/User';\r\nimport { requireRole, getCurrentUser } from '@/lib/auth';\r\nimport { getTenantIdFromRequest } from '@/lib/api-tenant';\r\nimport { createAuditLog, AuditActions } from '@/lib/audit';\r\nimport { isPinDuplicate } from '@/lib/pin-validation';\r\nimport { getValidationTranslatorFromRequest } from '@/lib/validation-translations';\r\n\r\n/**\r\n * PUT - Set or update PIN for a user (admin/manager only)\r\n */\r\nexport async function PUT(\r\n  request: NextRequest,\r\n  { params }: { params: Promise<{ id: string }> }\r\n) {\r\n  let t: (key: string, fallback: string) => string;\r\n  try {\r\n    await connectDB();\r\n    await requireRole(request, ['owner', 'admin', 'manager']);\r\n    const tenantId = await getTenantIdFromRequest(request);\r\n    const { id } = await params;\r\n    const currentUser = await getCurrentUser(request);\r\n    t = await getValidationTranslatorFromRequest(request);\r\n\r\n    if (!tenantId) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.tenantNotFound', 'Tenant not found') },\r\n        { status: 404 }\r\n      );\r\n    }\r\n\r\n    const body = await request.json();\r\n    const { pin } = body;\r\n\r\n    if (!pin) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.pinRequired', 'PIN is required') },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    if (!/^\\d{4,8}$/.test(pin)) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.pinFormat', 'PIN must be 4-8 digits') },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    // Verify user exists and belongs to same tenant\r\n    const user = await User.findOne({ _id: id, tenantId });\r\n    if (!user) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.userNotFound', 'User not found') },\r\n        { status: 404 }\r\n      );\r\n    }\r\n\r\n    // Check if PIN is already in use by another user in the same tenant\r\n    const pinExists = await isPinDuplicate(tenantId, pin, id);\r\n    if (pinExists) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.pinInUse', 'This PIN is already in use by another user in your organization') },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    // Update PIN (will be hashed by pre-save hook)\r\n    await User.findByIdAndUpdate(id, { pin });\r\n\r\n    await createAuditLog(request, {\r\n      tenantId,\r\n      action: AuditActions.UPDATE,\r\n      entityType: 'user',\r\n      entityId: id,\r\n      changes: { pin: { changed: true } },\r\n      metadata: { updatedBy: currentUser?.userId },\r\n    });\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      message: 'PIN updated successfully',\r\n    });\r\n  } catch (error: any) {\r\n    console.error('Update user PIN error:', error);\r\n    const errorMessage = error.message || 'Failed to update PIN';\r\n    return NextResponse.json(\r\n      { success: false, error: errorMessage },\r\n      { status: error.message === 'Unauthorized' || error.message.includes('Forbidden') ? 403 : 500 }\r\n    );\r\n  }\r\n}\r\n\r\n/**\r\n * DELETE - Remove PIN for a user (admin/manager only)\r\n */\r\nexport async function DELETE(\r\n  request: NextRequest,\r\n  { params }: { params: Promise<{ id: string }> }\r\n) {\r\n  let t: (key: string, fallback: string) => string;\r\n  try {\r\n    await connectDB();\r\n    await requireRole(request, ['owner', 'admin', 'manager']);\r\n    const tenantId = await getTenantIdFromRequest(request);\r\n    const { id } = await params;\r\n    const currentUser = await getCurrentUser(request);\r\n    t = await getValidationTranslatorFromRequest(request);\r\n\r\n    if (!tenantId) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.tenantNotFound', 'Tenant not found') },\r\n        { status: 404 }\r\n      );\r\n    }\r\n\r\n    // Verify user exists and belongs to same tenant\r\n    const user = await User.findOne({ _id: id, tenantId });\r\n    if (!user) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.userNotFound', 'User not found') },\r\n        { status: 404 }\r\n      );\r\n    }\r\n\r\n    // Remove PIN\r\n    await User.findByIdAndUpdate(id, { $unset: { pin: 1 } });\r\n\r\n    await createAuditLog(request, {\r\n      tenantId,\r\n      action: AuditActions.UPDATE,\r\n      entityType: 'user',\r\n      entityId: id,\r\n      changes: { pin: { removed: true } },\r\n      metadata: { updatedBy: currentUser?.userId },\r\n    });\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      message: 'PIN removed successfully',\r\n    });\r\n  } catch (error: any) {\r\n    console.error('Delete user PIN error:', error);\r\n    const errorMessage = error.message || 'Failed to remove PIN';\r\n    return NextResponse.json(\r\n      { success: false, error: errorMessage },\r\n      { status: error.message === 'Unauthorized' || error.message.includes('Forbidden') ? 403 : 500 }\r\n    );\r\n  }\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\users\\[id]\\qr-code\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":62,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":62,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2008,2011],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2008,2011],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":124,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":124,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3991,3994],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3991,3994],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\nimport connectDB from '@/lib/mongodb';\r\nimport User from '@/models/User';\r\nimport { requireRole, getCurrentUser } from '@/lib/auth';\r\nimport { getTenantIdFromRequest } from '@/lib/api-tenant';\r\nimport { createAuditLog, AuditActions } from '@/lib/audit';\r\nimport { getValidationTranslatorFromRequest } from '@/lib/validation-translations';\r\n\r\n/**\r\n * GET - Get QR code token for a user (admin/manager only)\r\n */\r\nexport async function GET(\r\n  request: NextRequest,\r\n  { params }: { params: Promise<{ id: string }> }\r\n) {\r\n  let t: (key: string, fallback: string) => string;\r\n  try {\r\n    await connectDB();\r\n    await requireRole(request, ['owner', 'admin', 'manager']);\r\n    const tenantId = await getTenantIdFromRequest(request);\r\n    const { id } = await params;\r\n    t = await getValidationTranslatorFromRequest(request);\r\n\r\n    if (!tenantId) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.tenantNotFound', 'Tenant not found') },\r\n        { status: 404 }\r\n      );\r\n    }\r\n\r\n    const user = await User.findOne({ _id: id, tenantId }).select('qrToken name email');\r\n    \r\n    if (!user) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.userNotFound', 'User not found') },\r\n        { status: 404 }\r\n      );\r\n    }\r\n\r\n    if (!user.qrToken) {\r\n      // Generate QR token if it doesn't exist\r\n      const newQrToken = user._id.toString() + '-' + Date.now().toString(36) + '-' + Math.random().toString(36).substring(2, 15);\r\n      await User.findByIdAndUpdate(id, { qrToken: newQrToken });\r\n      return NextResponse.json({\r\n        success: true,\r\n        data: {\r\n          qrToken: newQrToken,\r\n          name: user.name,\r\n          email: user.email,\r\n        },\r\n      });\r\n    }\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      data: {\r\n        qrToken: user.qrToken,\r\n        name: user.name,\r\n        email: user.email,\r\n      },\r\n    });\r\n  } catch (error: any) {\r\n    console.error('Get user QR code error:', error);\r\n    const errorMessage = error.message || 'Failed to get QR code';\r\n    return NextResponse.json(\r\n      { success: false, error: errorMessage },\r\n      { status: error.message === 'Unauthorized' || error.message.includes('Forbidden') ? 403 : 500 }\r\n    );\r\n  }\r\n}\r\n\r\n/**\r\n * POST - Regenerate QR code token for a user (admin/manager only)\r\n */\r\nexport async function POST(\r\n  request: NextRequest,\r\n  { params }: { params: Promise<{ id: string }> }\r\n) {\r\n  let t: (key: string, fallback: string) => string;\r\n  try {\r\n    await connectDB();\r\n    await requireRole(request, ['owner', 'admin', 'manager']);\r\n    const tenantId = await getTenantIdFromRequest(request);\r\n    const { id } = await params;\r\n    const currentUser = await getCurrentUser(request);\r\n    t = await getValidationTranslatorFromRequest(request);\r\n\r\n    if (!tenantId) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.tenantNotFound', 'Tenant not found') },\r\n        { status: 404 }\r\n      );\r\n    }\r\n\r\n    // Verify user exists and belongs to same tenant\r\n    const user = await User.findOne({ _id: id, tenantId });\r\n    if (!user) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.userNotFound', 'User not found') },\r\n        { status: 404 }\r\n      );\r\n    }\r\n\r\n    // Generate new QR token\r\n    const newQrToken = user._id.toString() + '-' + Date.now().toString(36) + '-' + Math.random().toString(36).substring(2, 15);\r\n    \r\n    await User.findByIdAndUpdate(id, { qrToken: newQrToken });\r\n\r\n    await createAuditLog(request, {\r\n      tenantId,\r\n      action: AuditActions.UPDATE,\r\n      entityType: 'user',\r\n      entityId: id,\r\n      changes: { qrToken: { regenerated: true } },\r\n      metadata: { updatedBy: currentUser?.userId },\r\n    });\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      data: {\r\n        qrToken: newQrToken,\r\n      },\r\n    });\r\n  } catch (error: any) {\r\n    console.error('Regenerate user QR code error:', error);\r\n    const errorMessage = error.message || 'Failed to regenerate QR code';\r\n    return NextResponse.json(\r\n      { success: false, error: errorMessage },\r\n      { status: error.message === 'Unauthorized' || error.message.includes('Forbidden') ? 403 : 500 }\r\n    );\r\n  }\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\users\\[id]\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":32,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":32,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1373,1376],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1373,1376],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":65,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":65,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2677,2680],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2677,2680],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":123,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":123,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4470,4473],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4470,4473],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":145,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":145,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5088,5091],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5088,5091],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":190,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":190,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6589,6592],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6589,6592],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\nimport connectDB from '@/lib/mongodb';\r\nimport User from '@/models/User';\r\nimport { getTenantIdFromRequest } from '@/lib/api-tenant';\r\nimport { requireRole } from '@/lib/auth';\r\nimport { createAuditLog, AuditActions } from '@/lib/audit';\r\nimport { validateEmail, validatePassword } from '@/lib/validation';\r\nimport { handleApiError } from '@/lib/error-handler';\r\nimport { getValidationTranslatorFromRequest } from '@/lib/validation-translations';\r\n\r\nexport async function GET(request: NextRequest, { params }: { params: Promise<{ id: string }> }) {\r\n  try {\r\n    await connectDB();\r\n    await requireRole(request, ['admin', 'manager']);\r\n    const tenantId = await getTenantIdFromRequest(request);\r\n    const { id } = await params;\r\n    const t = await getValidationTranslatorFromRequest(request);\r\n    \r\n    if (!tenantId) {\r\n      return NextResponse.json({ success: false, error: t('validation.tenantNotFound', 'Tenant not found') }, { status: 404 });\r\n    }\r\n    \r\n    const user = await User.findOne({ _id: id, tenantId })\r\n      .select('-password')\r\n      .lean();\r\n    \r\n    if (!user) {\r\n      return NextResponse.json({ success: false, error: t('validation.userNotFound', 'User not found') }, { status: 404 });\r\n    }\r\n    \r\n    return NextResponse.json({ success: true, data: user });\r\n  } catch (error: any) {\r\n    if (error.message === 'Unauthorized' || error.message.includes('Forbidden')) {\r\n      return NextResponse.json(\r\n        { success: false, error: error.message },\r\n        { status: error.message === 'Unauthorized' ? 401 : 403 }\r\n      );\r\n    }\r\n    return NextResponse.json({ success: false, error: error.message }, { status: 500 });\r\n  }\r\n}\r\n\r\nexport async function PUT(request: NextRequest, { params }: { params: Promise<{ id: string }> }) {\r\n  let t: (key: string, fallback: string) => string;\r\n  try {\r\n    await connectDB();\r\n    await requireRole(request, ['admin', 'manager']);\r\n    const tenantId = await getTenantIdFromRequest(request);\r\n    const { id } = await params;\r\n    t = await getValidationTranslatorFromRequest(request);\r\n    \r\n    if (!tenantId) {\r\n      return NextResponse.json({ success: false, error: t('validation.tenantNotFound', 'Tenant not found') }, { status: 404 });\r\n    }\r\n    \r\n    const body = await request.json();\r\n    const { email, password, name, role, isActive } = body;\r\n\r\n    const oldUser = await User.findOne({ _id: id, tenantId }).lean();\r\n    if (!oldUser) {\r\n      return NextResponse.json({ success: false, error: t('validation.userNotFound', 'User not found') }, { status: 404 });\r\n    }\r\n\r\n    // Build update object\r\n    const updateData: any = {};\r\n    \r\n    if (email !== undefined) {\r\n      if (!validateEmail(email)) {\r\n        return NextResponse.json(\r\n          { success: false, error: t('validation.invalidEmailFormat', 'Invalid email format') },\r\n          { status: 400 }\r\n        );\r\n      }\r\n      updateData.email = email.toLowerCase();\r\n    }\r\n    \r\n    if (name !== undefined) {\r\n      if (!name.trim()) {\r\n        return NextResponse.json(\r\n          { success: false, error: t('validation.nameRequired', 'Name is required') },\r\n          { status: 400 }\r\n        );\r\n      }\r\n      updateData.name = name.trim();\r\n    }\r\n    \r\n    if (role !== undefined) {\r\n      if (!['owner', 'admin', 'manager', 'cashier', 'viewer'].includes(role)) {\r\n        return NextResponse.json(\r\n          { success: false, error: t('validation.invalidRole', 'Invalid role') },\r\n          { status: 400 }\r\n        );\r\n      }\r\n      updateData.role = role;\r\n    }\r\n    \r\n    if (isActive !== undefined) {\r\n      updateData.isActive = isActive;\r\n    }\r\n    \r\n    if (password !== undefined && password) {\r\n      const passwordValidation = validatePassword(password, t);\r\n      if (!passwordValidation.valid) {\r\n        return NextResponse.json(\r\n          { success: false, error: t('validation.passwordValidationFailed', 'Password validation failed'), errors: passwordValidation.errors },\r\n          { status: 400 }\r\n        );\r\n      }\r\n      updateData.password = password;\r\n    }\r\n\r\n    const user = await User.findOneAndUpdate(\r\n      { _id: id, tenantId },\r\n      updateData,\r\n      { new: true, runValidators: true }\r\n    ).select('-password');\r\n    \r\n    if (!user) {\r\n      return NextResponse.json({ success: false, error: 'User not found' }, { status: 404 });\r\n    }\r\n\r\n    // Track changes\r\n    const changes: Record<string, any> = {};\r\n    Object.keys(updateData).forEach(key => {\r\n      if (key !== 'password' && oldUser[key as keyof typeof oldUser] !== updateData[key]) {\r\n        changes[key] = {\r\n          old: oldUser[key as keyof typeof oldUser],\r\n          new: updateData[key],\r\n        };\r\n      }\r\n    });\r\n    if (password) {\r\n      changes.password = { changed: true };\r\n    }\r\n\r\n    await createAuditLog(request, {\r\n      tenantId,\r\n      action: AuditActions.UPDATE,\r\n      entityType: 'user',\r\n      entityId: id,\r\n      changes,\r\n    });\r\n    \r\n    return NextResponse.json({ success: true, data: user });\r\n  } catch (error: any) {\r\n    if (error.code === 11000) {\r\n      return NextResponse.json(\r\n        { success: false, error: 'User with this email already exists' },\r\n        { status: 400 }\r\n      );\r\n    }\r\n    if (error.message === 'Unauthorized' || error.message.includes('Forbidden')) {\r\n      return NextResponse.json(\r\n        { success: false, error: error.message },\r\n        { status: error.message === 'Unauthorized' ? 401 : 403 }\r\n      );\r\n    }\r\n    return handleApiError(error);\r\n  }\r\n}\r\n\r\nexport async function DELETE(request: NextRequest, { params }: { params: Promise<{ id: string }> }) {\r\n  try {\r\n    await connectDB();\r\n    await requireRole(request, ['admin']);\r\n    const tenantId = await getTenantIdFromRequest(request);\r\n    const { id } = await params;\r\n    \r\n    if (!tenantId) {\r\n      return NextResponse.json({ success: false, error: 'Tenant not found' }, { status: 404 });\r\n    }\r\n    \r\n    const user = await User.findOne({ _id: id, tenantId }).lean();\r\n    if (!user) {\r\n      return NextResponse.json({ success: false, error: 'User not found' }, { status: 404 });\r\n    }\r\n\r\n    // Hard delete - actually remove the user from the database\r\n    await User.findOneAndDelete({ _id: id, tenantId });\r\n\r\n    await createAuditLog(request, {\r\n      tenantId,\r\n      action: AuditActions.DELETE,\r\n      entityType: 'user',\r\n      entityId: id,\r\n      changes: { email: user.email, name: user.name },\r\n    });\r\n    \r\n    return NextResponse.json({ success: true, data: {} });\r\n  } catch (error: any) {\r\n    if (error.message === 'Unauthorized' || error.message.includes('Forbidden')) {\r\n      return NextResponse.json(\r\n        { success: false, error: error.message },\r\n        { status: error.message === 'Unauthorized' ? 401 : 403 }\r\n      );\r\n    }\r\n    return handleApiError(error);\r\n  }\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\users\\pin\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":61,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":61,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2103,2106],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2103,2106],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":85,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":85,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2770,2773],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2770,2773],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\nimport connectDB from '@/lib/mongodb';\r\nimport User from '@/models/User';\r\nimport { requireAuth } from '@/lib/auth';\r\nimport { isPinDuplicate } from '@/lib/pin-validation';\r\nimport { getValidationTranslatorFromRequest } from '@/lib/validation-translations';\r\n\r\n/**\r\n * PUT - Update current user's PIN\r\n */\r\nexport async function PUT(request: NextRequest) {\r\n  let t: (key: string, fallback: string) => string;\r\n  try {\r\n    const user = await requireAuth(request);\r\n    await connectDB();\r\n    t = await getValidationTranslatorFromRequest(request);\r\n\r\n    const body = await request.json();\r\n    const { pin } = body;\r\n\r\n    if (!pin) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.pinRequired', 'PIN is required') },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    if (!/^\\d{4,8}$/.test(pin)) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.pinFormat', 'PIN must be 4-8 digits') },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    // Get user's tenant ID\r\n    const userDoc = await User.findById(user.userId).select('tenantId').lean();\r\n    if (!userDoc) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.userNotFound', 'User not found') },\r\n        { status: 404 }\r\n      );\r\n    }\r\n\r\n    // Check if PIN is already in use by another user in the same tenant\r\n    const pinExists = await isPinDuplicate(userDoc.tenantId, pin, user.userId);\r\n    if (pinExists) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.pinInUse', 'This PIN is already in use by another user in your organization') },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    // Hash the PIN before saving (the pre-save hook will handle it, but we can also do it here)\r\n    // Actually, the pre-save hook will handle hashing, so we can just set it directly\r\n    await User.findByIdAndUpdate(user.userId, { pin });\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      message: 'PIN updated successfully',\r\n    });\r\n  } catch (error: any) {\r\n    console.error('Update PIN error:', error);\r\n    const errorMessage = error.message || 'Failed to update PIN';\r\n    return NextResponse.json(\r\n      { success: false, error: errorMessage },\r\n      { status: error.message === 'Unauthorized' ? 401 : 500 }\r\n    );\r\n  }\r\n}\r\n\r\n/**\r\n * DELETE - Remove current user's PIN\r\n */\r\nexport async function DELETE(request: NextRequest) {\r\n  try {\r\n    const user = await requireAuth(request);\r\n    await connectDB();\r\n\r\n    await User.findByIdAndUpdate(user.userId, { $unset: { pin: 1 } });\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      message: 'PIN removed successfully',\r\n    });\r\n  } catch (error: any) {\r\n    console.error('Delete PIN error:', error);\r\n    const errorMessage = error.message || 'Failed to remove PIN';\r\n    return NextResponse.json(\r\n      { success: false, error: errorMessage },\r\n      { status: error.message === 'Unauthorized' ? 401 : 500 }\r\n    );\r\n  }\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\api\\users\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getTenantIdFromRequest' is defined but never used. Allowed unused vars must match /^_/u.","line":4,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":32},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":21,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":21,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[959,962],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[959,962],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":37,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":37,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1499,1502],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1499,1502],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":59,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":59,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2314,2317],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2314,2317],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":110,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":110,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4123,4126],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4123,4126],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":147,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":147,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5194,5197],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5194,5197],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\nimport connectDB from '@/lib/mongodb';\r\nimport User from '@/models/User';\r\nimport { getTenantIdFromRequest, requireTenantAccess } from '@/lib/api-tenant';\r\nimport { requireRole } from '@/lib/auth';\r\nimport { createAuditLog, AuditActions } from '@/lib/audit';\r\nimport { validateEmail, validatePassword } from '@/lib/validation';\r\nimport { getValidationTranslatorFromRequest } from '@/lib/validation-translations';\r\nimport { checkSubscriptionLimit, SubscriptionService } from '@/lib/subscription';\r\n\r\nexport async function GET(request: NextRequest) {\r\n  try {\r\n    await connectDB();\r\n    // SECURITY: Validate tenant access for authenticated requests\r\n    let tenantId: string;\r\n    try {\r\n      const tenantAccess = await requireTenantAccess(request);\r\n      tenantId = tenantAccess.tenantId;\r\n      // Also check role\r\n      await requireRole(request, ['admin', 'manager']);\r\n    } catch (authError: any) {\r\n      if (authError.message.includes('Unauthorized') || authError.message.includes('Forbidden')) {\r\n        return NextResponse.json(\r\n          { success: false, error: authError.message },\r\n          { status: authError.message.includes('Unauthorized') ? 401 : 403 }\r\n        );\r\n      }\r\n      throw authError;\r\n    }\r\n\r\n    const users = await User.find({ tenantId })\r\n      .select('-password')\r\n      .sort({ createdAt: -1 })\r\n      .lean();\r\n\r\n    return NextResponse.json({ success: true, data: users });\r\n  } catch (error: any) {\r\n    if (error.message === 'Unauthorized' || error.message.includes('Forbidden')) {\r\n      return NextResponse.json(\r\n        { success: false, error: error.message },\r\n        { status: error.message === 'Unauthorized' ? 401 : 403 }\r\n      );\r\n    }\r\n    return NextResponse.json({ success: false, error: error.message }, { status: 500 });\r\n  }\r\n}\r\n\r\nexport async function POST(request: NextRequest) {\r\n  let t: (key: string, fallback: string) => string;\r\n  try {\r\n    await connectDB();\r\n    // SECURITY: Validate tenant access for authenticated requests\r\n    let tenantId: string;\r\n    try {\r\n      const tenantAccess = await requireTenantAccess(request);\r\n      tenantId = tenantAccess.tenantId;\r\n      // Also check role\r\n      await requireRole(request, ['admin', 'manager']);\r\n    } catch (authError: any) {\r\n      t = await getValidationTranslatorFromRequest(request);\r\n      if (authError.message.includes('Unauthorized') || authError.message.includes('Forbidden')) {\r\n        return NextResponse.json(\r\n          { success: false, error: authError.message },\r\n          { status: authError.message.includes('Unauthorized') ? 401 : 403 }\r\n        );\r\n      }\r\n      throw authError;\r\n    }\r\n\r\n    const body = await request.json();\r\n    const { email, password, name, role } = body;\r\n\r\n    // Get translation function\r\n    t = await getValidationTranslatorFromRequest(request);\r\n\r\n    // Validation\r\n    if (!email || !password || !name) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.userFieldsRequired', 'Email, password, and name are required') },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    if (!validateEmail(email)) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.invalidEmailFormat', 'Invalid email format') },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    const passwordValidation = validatePassword(password, t);\r\n    if (!passwordValidation.valid) {\r\n      return NextResponse.json(\r\n        { success: false, error: 'Password validation failed', errors: passwordValidation.errors },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    if (role && !['owner', 'admin', 'manager', 'cashier', 'viewer'].includes(role)) {\r\n      return NextResponse.json(\r\n        { success: false, error: t('validation.invalidRole', 'Invalid role') },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    // Check subscription limits\r\n    const currentUserCount = await User.countDocuments({ tenantId, isActive: true });\r\n    try {\r\n      await checkSubscriptionLimit(tenantId.toString(), 'maxUsers', currentUserCount);\r\n    } catch (limitError: any) {\r\n      return NextResponse.json(\r\n        { success: false, error: limitError.message },\r\n        { status: 403 }\r\n      );\r\n    }\r\n\r\n    const user = await User.create({\r\n      email: email.toLowerCase(),\r\n      password,\r\n      name,\r\n      role: role || 'cashier',\r\n      tenantId,\r\n    });\r\n\r\n    await createAuditLog(request, {\r\n      tenantId,\r\n      action: AuditActions.CREATE,\r\n      entityType: 'user',\r\n      entityId: user._id.toString(),\r\n      changes: { email, name, role: user.role },\r\n    });\r\n\r\n    // Update subscription usage\r\n    try {\r\n      await SubscriptionService.updateUsage(tenantId.toString(), {\r\n        users: currentUserCount + 1\r\n      });\r\n    } catch (usageError) {\r\n      console.error('Failed to update subscription usage:', usageError);\r\n      // Don't fail the request if usage update fails\r\n    }\r\n\r\n    const userResponse = user.toObject();\r\n    const { password: _, ...userWithoutPassword } = userResponse;\r\n\r\n    return NextResponse.json({ success: true, data: userWithoutPassword }, { status: 201 });\r\n  } catch (error: any) {\r\n    if (error.code === 11000) {\r\n      return NextResponse.json(\r\n        { success: false, error: 'User with this email already exists' },\r\n        { status: 400 }\r\n      );\r\n    }\r\n    if (error.message === 'Unauthorized' || error.message.includes('Forbidden')) {\r\n      return NextResponse.json(\r\n        { success: false, error: error.message },\r\n        { status: error.message === 'Unauthorized' ? 401 : 403 }\r\n      );\r\n    }\r\n    return NextResponse.json({ success: false, error: error.message }, { status: 400 });\r\n  }\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\marketing\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'scrollY' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":8,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":17}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport Link from 'next/link';\r\nimport { useState, useEffect } from 'react';\r\n\r\nexport default function MarketingPage() {\r\n  const [activeSection, setActiveSection] = useState<string | null>(null);\r\n  const [scrollY, setScrollY] = useState(0);\r\n\r\n  useEffect(() => {\r\n    const handleScroll = () => setScrollY(window.scrollY);\r\n    window.addEventListener('scroll', handleScroll);\r\n    return () => window.removeEventListener('scroll', handleScroll);\r\n  }, []);\r\n\r\n  const features = [\r\n    {\r\n      id: 'core-pos',\r\n      title: 'Core POS Features',\r\n      icon: '',\r\n      description: 'Complete point of sale interface with shopping cart, payments, and receipts',\r\n      details: [\r\n        'Shopping cart system with real-time calculations',\r\n        'Product search & filtering by name, SKU, or barcode',\r\n        'Real-time stock validation',\r\n        'Multiple payment methods (Cash, Card, Digital Wallet)',\r\n        'Customizable receipt generation (PDF, Print, Email)',\r\n        'Transaction management with full history',\r\n        'Refund processing with stock restoration'\r\n      ]\r\n    },\r\n    {\r\n      id: 'product-management',\r\n      title: 'Product Management',\r\n      icon: '',\r\n      description: 'Comprehensive product management with variations, bundles, and barcode support',\r\n      details: [\r\n        'Full CRUD operations for products',\r\n        'Product categories and organization',\r\n        'SKU tracking and management',\r\n        'Product variations (size, color, type)',\r\n        'Product bundles with automatic stock deduction',\r\n        'Barcode & QR code scanning and generation',\r\n        'Product images and descriptions'\r\n      ]\r\n    },\r\n    {\r\n      id: 'inventory',\r\n      title: 'Inventory Management',\r\n      icon: '',\r\n      description: 'Real-time inventory tracking with multi-branch support and low stock alerts',\r\n      details: [\r\n        'Real-time stock updates via Server-Sent Events',\r\n        'Complete stock movement history',\r\n        'Multi-branch inventory with transfers',\r\n        'Low stock alerts and notifications',\r\n        'Stock movement types: Sale, Purchase, Adjustment, Return, Damage, Transfer',\r\n        'Automated stock deduction on sales'\r\n      ]\r\n    },\r\n    {\r\n      id: 'multi-tenant',\r\n      title: 'Multi-Tenant Architecture',\r\n      icon: '',\r\n      description: 'Complete data isolation with tenant-specific branding and configuration',\r\n      details: [\r\n        'Complete data isolation per tenant',\r\n        'Path-based and subdomain routing',\r\n        'Tenant-specific branding (logo, colors, favicon)',\r\n        'Custom currency and localization per tenant',\r\n        'Business type configuration',\r\n        'Tenant-specific settings and features'\r\n      ]\r\n    },\r\n    {\r\n      id: 'business-types',\r\n      title: 'Multi-Business Type Support',\r\n      icon: '',\r\n      description: 'Industry-specific configurations for Retail, Restaurant, Laundry, Service, and more',\r\n      details: [\r\n        'Retail: Product-focused with inventory management',\r\n        'Restaurant: Menu items with modifiers and allergens',\r\n        'Laundry: Service-based with weight-based pricing',\r\n        'Service: Time-based services with staff assignment',\r\n        'General: Flexible configuration for any business',\r\n        'Automatic feature configuration based on type'\r\n      ]\r\n    },\r\n    {\r\n      id: 'user-management',\r\n      title: 'User Management & Authentication',\r\n      icon: '',\r\n      description: 'Flexible authentication with role-based access control',\r\n      details: [\r\n        'Email/Password authentication',\r\n        'PIN-based login (4-6 digits)',\r\n        'QR code-based login',\r\n        'Role-based access control (Owner, Admin, Manager, Cashier, Viewer)',\r\n        'User profiles with activity tracking',\r\n        'Session management with JWT tokens'\r\n      ]\r\n    },\r\n    {\r\n      id: 'customers',\r\n      title: 'Customer Management',\r\n      icon: '',\r\n      description: 'Comprehensive customer profiles with analytics and lifetime value tracking',\r\n      details: [\r\n        'Customer information and contact details',\r\n        'Multiple addresses per customer',\r\n        'Customer tags and categorization',\r\n        'Purchase history and analytics',\r\n        'Customer lifetime value calculation',\r\n        'Customer notes and preferences'\r\n      ]\r\n    },\r\n    {\r\n      id: 'discounts',\r\n      title: 'Discount & Promo System',\r\n      icon: '',\r\n      description: 'Flexible discount codes with usage limits and validity periods',\r\n      details: [\r\n        'Percentage and fixed amount discounts',\r\n        'Product, category, or store-wide discounts',\r\n        'Minimum purchase requirements',\r\n        'Usage limits per code and per customer',\r\n        'Validity periods with start/end dates',\r\n        'Real-time discount validation'\r\n      ]\r\n    },\r\n    {\r\n      id: 'tax',\r\n      title: 'Tax Rules Management',\r\n      icon: '',\r\n      description: 'Flexible tax configuration with multiple tax rules support',\r\n      details: [\r\n        'Flat rate and percentage-based taxes',\r\n        'Product, category, and region-specific taxes',\r\n        'Custom tax labels (VAT, GST, Sales Tax)',\r\n        'Multiple tax rules with priority ordering',\r\n        'Automatic tax calculation',\r\n        'Tax reporting and breakdown'\r\n      ]\r\n    },\r\n    {\r\n      id: 'reports',\r\n      title: 'Reports & Analytics',\r\n      icon: '',\r\n      description: 'Comprehensive reporting with sales, product, financial, and attendance analytics',\r\n      details: [\r\n        'Sales reports (Daily, Weekly, Monthly, Custom)',\r\n        'Product performance and analytics',\r\n        'Financial reports (Profit & Loss)',\r\n        'VAT/Tax reports',\r\n        'Cash drawer session reports',\r\n        'Bundle performance reports',\r\n        'Attendance reports',\r\n        'Export capabilities (CSV, Excel, PDF)'\r\n      ]\r\n    },\r\n    {\r\n      id: 'attendance',\r\n      title: 'Attendance Management',\r\n      icon: '',\r\n      description: 'Time tracking with clock in/out, breaks, and location tracking',\r\n      details: [\r\n        'Clock in/out functionality',\r\n        'Break tracking (start/end)',\r\n        'Automatic hours calculation',\r\n        'Attendance history and records',\r\n        'GPS location capture (optional)',\r\n        'Auto clock-out for forgotten sessions'\r\n      ]\r\n    },\r\n    {\r\n      id: 'cash-drawer',\r\n      title: 'Cash Drawer Management',\r\n      icon: '',\r\n      description: 'Cash drawer sessions with opening/closing amounts and reconciliation',\r\n      details: [\r\n        'Opening cash drawer with starting amount',\r\n        'Closing cash drawer with count',\r\n        'Shortage/overage detection',\r\n        'Cash sales and expenses tracking',\r\n        'Session history and reports',\r\n        'Auto-close at end of day'\r\n      ]\r\n    },\r\n    {\r\n      id: 'expenses',\r\n      title: 'Expense Management',\r\n      icon: '',\r\n      description: 'Track expenses with categories, receipts, and integration with P&L reports',\r\n      details: [\r\n        'Expense categories and organization',\r\n        'Receipt attachments',\r\n        'Payment method tracking',\r\n        'Date-based filtering',\r\n        'Integration with profit/loss reports',\r\n        'Category-wise expense breakdown'\r\n      ]\r\n    },\r\n    {\r\n      id: 'booking',\r\n      title: 'Booking & Scheduling',\r\n      icon: '',\r\n      description: 'Calendar-based booking system with reminders and status management',\r\n      details: [\r\n        'Calendar views (Month, Week, Day)',\r\n        'Create, edit, cancel, and delete bookings',\r\n        'Customer and service information',\r\n        'Staff assignment',\r\n        'Booking status management',\r\n        'Automated reminders (24h before)',\r\n        'Conflict detection'\r\n      ]\r\n    },\r\n    {\r\n      id: 'currency',\r\n      title: 'Multi-Currency Support',\r\n      icon: '',\r\n      description: 'Support for multiple currencies with automatic exchange rates',\r\n      details: [\r\n        'Base currency per tenant',\r\n        'Display currencies',\r\n        'Automatic exchange rate fetching',\r\n        'Multiple exchange rate providers',\r\n        'Real-time currency conversion',\r\n        'Multi-currency reporting'\r\n      ]\r\n    },\r\n    {\r\n      id: 'branches',\r\n      title: 'Branch Management',\r\n      icon: '',\r\n      description: 'Multi-branch support with branch-specific inventory and reporting',\r\n      details: [\r\n        'Create and manage multiple branches',\r\n        'Branch-specific stock levels',\r\n        'Stock transfers between branches',\r\n        'Branch-specific reports',\r\n        'Cross-branch comparisons',\r\n        'Consolidated reporting'\r\n      ]\r\n    },\r\n    {\r\n      id: 'bundles',\r\n      title: 'Bundles Management',\r\n      icon: '',\r\n      description: 'Product bundles with automatic stock management and analytics',\r\n      details: [\r\n        'Create and manage product bundles',\r\n        'Bundle-specific pricing',\r\n        'Automatic stock deduction for all bundle items',\r\n        'Bundle performance tracking',\r\n        'Component product analysis',\r\n        'Bulk bundle operations'\r\n      ]\r\n    },\r\n    {\r\n      id: 'hardware',\r\n      title: 'Hardware Integration',\r\n      icon: '',\r\n      description: 'Support for barcode scanners, QR code scanners, and receipt printers',\r\n      details: [\r\n        'USB and wireless barcode scanners',\r\n        'Camera-based QR code scanning',\r\n        'ESC/POS compatible receipt printers',\r\n        'Per-tenant hardware configuration',\r\n        'Hardware status monitoring',\r\n        'Connection error handling'\r\n      ]\r\n    },\r\n    {\r\n      id: 'settings',\r\n      title: 'Settings & Configuration',\r\n      icon: '',\r\n      description: 'Comprehensive settings for branding, receipts, taxes, and feature flags',\r\n      details: [\r\n        'Company information and branding',\r\n        'Currency and localization settings',\r\n        'Receipt template customization',\r\n        'Tax configuration',\r\n        'Feature flags (enable/disable features)',\r\n        'Business hours and holidays management',\r\n        'Notification templates'\r\n      ]\r\n    },\r\n    {\r\n      id: 'security',\r\n      title: 'Security & Audit',\r\n      icon: '',\r\n      description: 'Enterprise-grade security with complete audit logging',\r\n      details: [\r\n        'JWT token-based authentication',\r\n        'Secure password hashing (bcrypt)',\r\n        'Role-based access control',\r\n        'Tenant data isolation',\r\n        'Complete audit trail',\r\n        'Before/after value tracking',\r\n        'IP address and user agent logging'\r\n      ]\r\n    },\r\n    {\r\n      id: 'automations',\r\n      title: 'Automations',\r\n      icon: '',\r\n      description: '30+ automated workflows to reduce manual work',\r\n      details: [\r\n        'Automated booking reminders',\r\n        'Low stock alerts',\r\n        'Transaction receipt auto-email',\r\n        'Scheduled reports',\r\n        'Auto clock-out for attendance',\r\n        'Cash drawer auto-close',\r\n        'Customer welcome emails',\r\n        'And 23+ more automations'\r\n      ]\r\n    },\r\n    {\r\n      id: 'offline',\r\n      title: 'Offline Support',\r\n      icon: '',\r\n      description: 'Work offline with automatic sync when connection is restored',\r\n      details: [\r\n        'Automatic offline mode detection',\r\n        'Local storage for offline transactions',\r\n        'Offline product browsing',\r\n        'Offline cart management',\r\n        'Automatic sync when online',\r\n        'Conflict resolution'\r\n      ]\r\n    },\r\n    {\r\n      id: 'i18n',\r\n      title: 'Internationalization',\r\n      icon: '',\r\n      description: 'Multi-language support with localized formatting',\r\n      details: [\r\n        'English and Spanish support',\r\n        'Extensible for additional languages',\r\n        'Localized date/time formatting',\r\n        'Localized number formatting',\r\n        'Localized currency formatting',\r\n        'Timezone support'\r\n      ]\r\n    }\r\n  ];\r\n\r\n  const stats = [\r\n    { label: 'Features', value: '100+' },\r\n    { label: 'Automations', value: '30+' },\r\n    { label: 'Business Types', value: '5' },\r\n    { label: 'Languages', value: '2+' }\r\n  ];\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-white overflow-x-hidden\">\r\n      {/* Hero Section */}\r\n      <section className=\"relative bg-gradient-to-br from-blue-600 via-indigo-700 to-purple-800 text-white py-24 md:py-32 px-4 overflow-hidden\">\r\n        {/* Animated Background Elements */}\r\n        <div className=\"absolute inset-0 overflow-hidden\">\r\n          <div \r\n            className=\"absolute top-20 left-10 w-72 h-72 bg-blue-400/20 rounded-full blur-3xl animate-pulse\"\r\n            style={{ animationDelay: '0s', animationDuration: '4s' }}\r\n          />\r\n          <div \r\n            className=\"absolute bottom-20 right-10 w-96 h-96 bg-purple-400/20 rounded-full blur-3xl animate-pulse\"\r\n            style={{ animationDelay: '2s', animationDuration: '5s' }}\r\n          />\r\n          <div \r\n            className=\"absolute top-1/2 left-1/2 w-80 h-80 bg-indigo-400/10 rounded-full blur-3xl animate-pulse\"\r\n            style={{ animationDelay: '1s', animationDuration: '6s' }}\r\n          />\r\n        </div>\r\n\r\n        <div className=\"relative max-w-7xl mx-auto text-center z-10\">\r\n          {/* Badge */}\r\n          <div className=\"inline-flex items-center gap-2 bg-white/20 backdrop-blur-md border border-white/30 px-4 py-2 rounded-full mb-6 animate-fade-in\">\r\n            <span className=\"text-sm font-semibold\"> Enterprise-Grade POS System</span>\r\n          </div>\r\n\r\n          <h1 className=\"text-6xl md:text-7xl lg:text-8xl font-bold mb-6 animate-fade-in bg-gradient-to-r from-white via-blue-100 to-white bg-clip-text text-transparent\">\r\n            LocalPro POS\r\n          </h1>\r\n          <p className=\"text-2xl md:text-3xl mb-6 text-blue-50 max-w-3xl mx-auto font-light\">\r\n            Transform Your Business Operations\r\n          </p>\r\n          <p className=\"text-lg md:text-xl mb-12 text-blue-100 max-w-2xl mx-auto leading-relaxed\">\r\n            The most comprehensive POS solution with <span className=\"font-bold text-white\">100+ features</span>, \r\n            multi-tenant architecture, real-time inventory, and <span className=\"font-bold text-white\">30+ automated workflows</span>.\r\n          </p>\r\n          \r\n          {/* Enhanced Stats */}\r\n          <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4 md:gap-6 max-w-5xl mx-auto mb-12\">\r\n            {stats.map((stat, index) => (\r\n              <div \r\n                key={index} \r\n                className=\"group bg-white/15 backdrop-blur-md border border-white/30 p-6 md:p-8 hover:bg-white/20 transition-all duration-300 hover:scale-105 hover:shadow-2xl\"\r\n                style={{ animationDelay: `${index * 0.1}s` }}\r\n              >\r\n                <div className=\"text-4xl md:text-5xl font-bold mb-2 bg-gradient-to-br from-white to-blue-200 bg-clip-text text-transparent\">\r\n                  {stat.value}\r\n                </div>\r\n                <div className=\"text-blue-100 text-sm md:text-base font-medium\">{stat.label}</div>\r\n              </div>\r\n            ))}\r\n          </div>\r\n\r\n          <div className=\"flex flex-col sm:flex-row gap-4 justify-center items-center\">\r\n            <Link\r\n              href=\"/signup\"\r\n              className=\"group relative bg-white text-blue-600 px-10 py-5 font-bold text-lg hover:bg-blue-50 transition-all duration-300 hover:scale-105 hover:shadow-2xl overflow-hidden\"\r\n            >\r\n              <span className=\"relative z-10\">Get Started Free</span>\r\n              <div className=\"absolute inset-0 bg-gradient-to-r from-blue-50 to-indigo-50 opacity-0 group-hover:opacity-100 transition-opacity duration-300\" />\r\n            </Link>\r\n            <a\r\n              href=\"#features\"\r\n              className=\"group bg-transparent text-white px-10 py-5 font-bold text-lg border-2 border-white/50 hover:border-white hover:bg-white/10 transition-all duration-300 hover:scale-105\"\r\n            >\r\n              Explore Features \r\n            </a>\r\n          </div>\r\n\r\n          {/* Scroll Indicator */}\r\n          <div className=\"mt-16 animate-bounce\">\r\n            <div className=\"w-6 h-10 border-2 border-white/50 rounded-full mx-auto flex items-start justify-center p-2\">\r\n              <div className=\"w-1.5 h-1.5 bg-white rounded-full animate-pulse\" />\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </section>\r\n\r\n      {/* Features Grid */}\r\n      <section id=\"features\" className=\"py-24 px-4 bg-gradient-to-b from-gray-50 to-white relative\">\r\n        <div className=\"max-w-7xl mx-auto\">\r\n          <div className=\"text-center mb-20\">\r\n            <div className=\"inline-block bg-blue-100 text-blue-700 px-4 py-2 rounded-full text-sm font-semibold mb-4\">\r\n              POWERFUL FEATURES\r\n            </div>\r\n            <h2 className=\"text-5xl md:text-6xl font-bold mb-6 text-gray-900\">\r\n              Everything You Need\r\n            </h2>\r\n            <p className=\"text-xl text-gray-600 max-w-2xl mx-auto leading-relaxed\">\r\n              A comprehensive suite of features designed to streamline your business operations\r\n            </p>\r\n          </div>\r\n\r\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 md:gap-8\">\r\n            {features.map((feature, index) => (\r\n              <div\r\n                key={feature.id}\r\n                className=\"group relative bg-white border-2 border-gray-200 p-6 md:p-8 cursor-pointer transition-all duration-300 hover:border-blue-400 hover:shadow-2xl hover:-translate-y-2 overflow-hidden\"\r\n                onClick={() => setActiveSection(activeSection === feature.id ? null : feature.id)}\r\n                style={{ animationDelay: `${index * 0.05}s` }}\r\n              >\r\n                {/* Gradient Overlay on Hover */}\r\n                <div className=\"absolute inset-0 bg-gradient-to-br from-blue-50/0 to-indigo-50/0 group-hover:from-blue-50/50 group-hover:to-indigo-50/50 transition-all duration-300\" />\r\n                \r\n                <div className=\"relative z-10\">\r\n                  <div className=\"flex items-start gap-4 mb-4\">\r\n                    <div className=\"text-5xl transform group-hover:scale-110 transition-transform duration-300\">\r\n                      {feature.icon}\r\n                    </div>\r\n                    <div className=\"flex-1\">\r\n                      <h3 className=\"text-xl font-bold mb-2 text-gray-900 group-hover:text-blue-600 transition-colors\">\r\n                        {feature.title}\r\n                      </h3>\r\n                      <p className=\"text-gray-600 text-sm mb-4 leading-relaxed\">\r\n                        {feature.description}\r\n                      </p>\r\n                    </div>\r\n                  </div>\r\n\r\n                  {activeSection === feature.id && (\r\n                    <div className=\"mt-4 pt-4 border-t-2 border-blue-200 animate-fade-in\">\r\n                      <ul className=\"space-y-3\">\r\n                        {feature.details.map((detail, idx) => (\r\n                          <li key={idx} className=\"flex items-start gap-3 text-sm text-gray-700\">\r\n                            <span className=\"flex-shrink-0 w-5 h-5 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center text-xs font-bold mt-0.5\">\r\n                              \r\n                            </span>\r\n                            <span className=\"leading-relaxed\">{detail}</span>\r\n                          </li>\r\n                        ))}\r\n                      </ul>\r\n                    </div>\r\n                  )}\r\n\r\n                  {activeSection !== feature.id && (\r\n                    <div className=\"flex items-center gap-2 text-blue-600 text-sm font-semibold mt-4 group-hover:gap-3 transition-all\">\r\n                      <span>View Details</span>\r\n                      <span className=\"transform group-hover:translate-x-1 transition-transform\"></span>\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              </div>\r\n            ))}\r\n          </div>\r\n        </div>\r\n      </section>\r\n\r\n      {/* Key Highlights */}\r\n      <section className=\"py-24 px-4 bg-gradient-to-b from-white via-blue-50/30 to-white\">\r\n        <div className=\"max-w-7xl mx-auto\">\r\n          <div className=\"text-center mb-20\">\r\n            <div className=\"inline-block bg-indigo-100 text-indigo-700 px-4 py-2 rounded-full text-sm font-semibold mb-4\">\r\n              WHY CHOOSE US\r\n            </div>\r\n            <h2 className=\"text-5xl md:text-6xl font-bold mb-6 text-gray-900\">\r\n              Built for Modern Businesses\r\n            </h2>\r\n            <p className=\"text-xl text-gray-600 max-w-2xl mx-auto\">\r\n              Enterprise-grade features that scale with your business\r\n            </p>\r\n          </div>\r\n\r\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-8 md:gap-10\">\r\n            <div className=\"group relative text-center p-10 bg-gradient-to-br from-blue-50 to-blue-100 border-2 border-blue-200 hover:border-blue-400 transition-all duration-300 hover:shadow-2xl hover:-translate-y-2\">\r\n              <div className=\"absolute top-0 right-0 w-32 h-32 bg-blue-200/30 rounded-full blur-2xl -z-10\" />\r\n              <div className=\"text-6xl mb-6 transform group-hover:scale-110 group-hover:rotate-6 transition-transform duration-300\"></div>\r\n              <h3 className=\"text-2xl font-bold mb-4 text-gray-900\">Multi-Tenant</h3>\r\n              <p className=\"text-gray-700 leading-relaxed\">\r\n                Complete data isolation with tenant-specific branding, settings, and configurations. \r\n                Perfect for SaaS deployments and enterprise solutions.\r\n              </p>\r\n            </div>\r\n\r\n            <div className=\"group relative text-center p-10 bg-gradient-to-br from-emerald-50 to-emerald-100 border-2 border-emerald-200 hover:border-emerald-400 transition-all duration-300 hover:shadow-2xl hover:-translate-y-2\">\r\n              <div className=\"absolute top-0 right-0 w-32 h-32 bg-emerald-200/30 rounded-full blur-2xl -z-10\" />\r\n              <div className=\"text-6xl mb-6 transform group-hover:scale-110 group-hover:rotate-6 transition-transform duration-300\"></div>\r\n              <h3 className=\"text-2xl font-bold mb-4 text-gray-900\">Real-Time</h3>\r\n              <p className=\"text-gray-700 leading-relaxed\">\r\n                Real-time inventory updates, stock validation, and Server-Sent Events for \r\n                instant synchronization across all devices and locations.\r\n              </p>\r\n            </div>\r\n\r\n            <div className=\"group relative text-center p-10 bg-gradient-to-br from-purple-50 to-purple-100 border-2 border-purple-200 hover:border-purple-400 transition-all duration-300 hover:shadow-2xl hover:-translate-y-2\">\r\n              <div className=\"absolute top-0 right-0 w-32 h-32 bg-purple-200/30 rounded-full blur-2xl -z-10\" />\r\n              <div className=\"text-6xl mb-6 transform group-hover:scale-110 group-hover:rotate-6 transition-transform duration-300\"></div>\r\n              <h3 className=\"text-2xl font-bold mb-4 text-gray-900\">Automated</h3>\r\n              <p className=\"text-gray-700 leading-relaxed\">\r\n                30+ automated workflows including booking reminders, low stock alerts, \r\n                scheduled reports, and intelligent business automation.\r\n              </p>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </section>\r\n\r\n      {/* Business Types */}\r\n      <section className=\"py-24 px-4 bg-gradient-to-b from-gray-50 to-white\">\r\n        <div className=\"max-w-7xl mx-auto\">\r\n          <div className=\"text-center mb-20\">\r\n            <div className=\"inline-block bg-purple-100 text-purple-700 px-4 py-2 rounded-full text-sm font-semibold mb-4\">\r\n              VERSATILE SOLUTION\r\n            </div>\r\n            <h2 className=\"text-5xl md:text-6xl font-bold mb-6 text-gray-900\">\r\n              Built for Every Business\r\n            </h2>\r\n            <p className=\"text-xl text-gray-600 max-w-2xl mx-auto\">\r\n              Industry-specific configurations tailored to your business model\r\n            </p>\r\n          </div>\r\n\r\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6\">\r\n            {[\r\n              { icon: '', name: 'Retail', desc: 'Product-focused with inventory', color: 'from-blue-500 to-blue-600' },\r\n              { icon: '', name: 'Restaurant', desc: 'Menu items with modifiers', color: 'from-orange-500 to-red-500' },\r\n              { icon: '', name: 'Laundry', desc: 'Service-based operations', color: 'from-cyan-500 to-blue-500' },\r\n              { icon: '', name: 'Service', desc: 'Time-based services', color: 'from-indigo-500 to-purple-500' },\r\n              { icon: '', name: 'General', desc: 'Flexible configuration', color: 'from-gray-500 to-gray-600' }\r\n            ].map((type, index) => (\r\n              <div \r\n                key={index} \r\n                className=\"group relative bg-white border-2 border-gray-200 p-8 text-center transition-all duration-300 hover:border-blue-400 hover:shadow-xl hover:-translate-y-2 overflow-hidden\"\r\n              >\r\n                <div className={`absolute inset-0 bg-gradient-to-br ${type.color} opacity-0 group-hover:opacity-5 transition-opacity duration-300`} />\r\n                <div className=\"relative z-10\">\r\n                  <div className=\"text-6xl mb-4 transform group-hover:scale-125 group-hover:rotate-12 transition-transform duration-300\">\r\n                    {type.icon}\r\n                  </div>\r\n                  <h3 className=\"text-xl font-bold mb-2 text-gray-900 group-hover:text-blue-600 transition-colors\">\r\n                    {type.name}\r\n                  </h3>\r\n                  <p className=\"text-sm text-gray-600\">{type.desc}</p>\r\n                </div>\r\n              </div>\r\n            ))}\r\n          </div>\r\n        </div>\r\n      </section>\r\n\r\n      {/* Benefits Section */}\r\n      <section className=\"py-24 px-4 bg-gradient-to-b from-white to-gray-50\">\r\n        <div className=\"max-w-7xl mx-auto\">\r\n          <div className=\"grid md:grid-cols-2 gap-12 items-center\">\r\n            <div>\r\n              <div className=\"inline-block bg-green-100 text-green-700 px-4 py-2 rounded-full text-sm font-semibold mb-4\">\r\n                KEY BENEFITS\r\n              </div>\r\n              <h2 className=\"text-4xl md:text-5xl font-bold mb-6 text-gray-900\">\r\n                Streamline Your Operations\r\n              </h2>\r\n              <div className=\"space-y-6\">\r\n                {[\r\n                  { title: 'Save Time', desc: '30+ automations reduce manual work by up to 80%' },\r\n                  { title: 'Increase Revenue', desc: 'Advanced analytics help identify growth opportunities' },\r\n                  { title: 'Reduce Errors', desc: 'Real-time validation prevents costly mistakes' },\r\n                  { title: 'Scale Easily', desc: 'Multi-tenant architecture grows with your business' }\r\n                ].map((benefit, index) => (\r\n                  <div key={index} className=\"flex gap-4\">\r\n                    <div className=\"flex-shrink-0 w-12 h-12 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-lg flex items-center justify-center text-white font-bold text-xl\">\r\n                      \r\n                    </div>\r\n                    <div>\r\n                      <h3 className=\"text-xl font-bold mb-1 text-gray-900\">{benefit.title}</h3>\r\n                      <p className=\"text-gray-600\">{benefit.desc}</p>\r\n                    </div>\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            </div>\r\n            <div className=\"relative\">\r\n              <div className=\"bg-gradient-to-br from-blue-500 via-indigo-600 to-purple-700 rounded-2xl p-12 text-white shadow-2xl\">\r\n                <div className=\"space-y-8\">\r\n                  <div className=\"text-center\">\r\n                    <div className=\"text-6xl font-bold mb-2\">100+</div>\r\n                    <div className=\"text-xl opacity-90\">Features</div>\r\n                  </div>\r\n                  <div className=\"grid grid-cols-2 gap-6\">\r\n                    <div className=\"text-center p-4 bg-white/10 rounded-lg backdrop-blur-sm\">\r\n                      <div className=\"text-3xl font-bold mb-1\">30+</div>\r\n                      <div className=\"text-sm opacity-80\">Automations</div>\r\n                    </div>\r\n                    <div className=\"text-center p-4 bg-white/10 rounded-lg backdrop-blur-sm\">\r\n                      <div className=\"text-3xl font-bold mb-1\">5</div>\r\n                      <div className=\"text-sm opacity-80\">Business Types</div>\r\n                    </div>\r\n                    <div className=\"text-center p-4 bg-white/10 rounded-lg backdrop-blur-sm\">\r\n                      <div className=\"text-3xl font-bold mb-1\">24/7</div>\r\n                      <div className=\"text-sm opacity-80\">Support</div>\r\n                    </div>\r\n                    <div className=\"text-center p-4 bg-white/10 rounded-lg backdrop-blur-sm\">\r\n                      <div className=\"text-3xl font-bold mb-1\">99.9%</div>\r\n                      <div className=\"text-sm opacity-80\">Uptime</div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </section>\r\n\r\n      {/* CTA Section */}\r\n      <section className=\"relative py-24 px-4 bg-gradient-to-br from-blue-600 via-indigo-700 to-purple-800 text-white overflow-hidden\">\r\n        {/* Animated Background */}\r\n        <div className=\"absolute inset-0\">\r\n          <div className=\"absolute top-0 left-0 w-96 h-96 bg-blue-400/20 rounded-full blur-3xl animate-pulse\" />\r\n          <div className=\"absolute bottom-0 right-0 w-96 h-96 bg-purple-400/20 rounded-full blur-3xl animate-pulse\" style={{ animationDelay: '1s' }} />\r\n        </div>\r\n\r\n        <div className=\"relative max-w-4xl mx-auto text-center z-10\">\r\n          <div className=\"inline-block bg-white/20 backdrop-blur-md border border-white/30 px-4 py-2 rounded-full text-sm font-semibold mb-6\">\r\n             START YOUR JOURNEY TODAY\r\n          </div>\r\n          <h2 className=\"text-5xl md:text-6xl font-bold mb-6\">\r\n            Ready to Transform Your Business?\r\n          </h2>\r\n          <p className=\"text-xl md:text-2xl mb-10 text-blue-100 max-w-2xl mx-auto leading-relaxed\">\r\n            Join thousands of businesses using LocalPro POS to streamline operations, \r\n            increase revenue, and scale effortlessly.\r\n          </p>\r\n          <div className=\"flex flex-col sm:flex-row gap-4 justify-center items-center\">\r\n            <Link\r\n              href=\"/signup\"\r\n              className=\"group relative bg-white text-blue-600 px-10 py-5 font-bold text-lg hover:bg-blue-50 transition-all duration-300 hover:scale-105 hover:shadow-2xl overflow-hidden\"\r\n            >\r\n              <span className=\"relative z-10\">Start Free Trial </span>\r\n              <div className=\"absolute inset-0 bg-gradient-to-r from-blue-50 to-indigo-50 opacity-0 group-hover:opacity-100 transition-opacity duration-300\" />\r\n            </Link>\r\n            <a\r\n              href=\"#features\"\r\n              className=\"group bg-transparent text-white px-10 py-5 font-bold text-lg border-2 border-white/50 hover:border-white hover:bg-white/10 transition-all duration-300 hover:scale-105\"\r\n            >\r\n              Learn More\r\n            </a>\r\n          </div>\r\n          <p className=\"mt-8 text-blue-200 text-sm\">\r\n            No credit card required  14-day free trial  Cancel anytime\r\n          </p>\r\n        </div>\r\n      </section>\r\n\r\n      {/* Footer */}\r\n      <footer className=\"bg-gray-900 text-gray-300 py-16 px-4\">\r\n        <div className=\"max-w-7xl mx-auto\">\r\n          <div className=\"grid grid-cols-1 md:grid-cols-4 gap-8 mb-12\">\r\n            <div>\r\n              <h3 className=\"text-white font-bold text-xl mb-4\">LocalPro POS</h3>\r\n              <p className=\"text-gray-400 text-sm leading-relaxed\">\r\n                Enterprise-grade Point of Sale System with 100+ features designed for modern businesses.\r\n              </p>\r\n            </div>\r\n            <div>\r\n              <h4 className=\"text-white font-semibold mb-4\">Product</h4>\r\n              <ul className=\"space-y-2 text-sm text-gray-400\">\r\n                <li><a href=\"#features\" className=\"hover:text-white transition-colors\">Features</a></li>\r\n                <li><a href=\"#\" className=\"hover:text-white transition-colors\">Pricing</a></li>\r\n                <li><a href=\"#\" className=\"hover:text-white transition-colors\">Integrations</a></li>\r\n              </ul>\r\n            </div>\r\n            <div>\r\n              <h4 className=\"text-white font-semibold mb-4\">Company</h4>\r\n              <ul className=\"space-y-2 text-sm text-gray-400\">\r\n                <li><a href=\"#\" className=\"hover:text-white transition-colors\">About</a></li>\r\n                <li><a href=\"#\" className=\"hover:text-white transition-colors\">Blog</a></li>\r\n                <li><a href=\"#\" className=\"hover:text-white transition-colors\">Contact</a></li>\r\n              </ul>\r\n            </div>\r\n            <div>\r\n              <h4 className=\"text-white font-semibold mb-4\">Resources</h4>\r\n              <ul className=\"space-y-2 text-sm text-gray-400\">\r\n                <li><a href=\"#\" className=\"hover:text-white transition-colors\">Documentation</a></li>\r\n                <li><a href=\"#\" className=\"hover:text-white transition-colors\">Support</a></li>\r\n                <li><a href=\"#\" className=\"hover:text-white transition-colors\">API</a></li>\r\n              </ul>\r\n            </div>\r\n          </div>\r\n          <div className=\"border-t border-gray-800 pt-8 text-center\">\r\n            <p className=\"mb-2 text-gray-400\"> 2024 LocalPro POS. All rights reserved.</p>\r\n            <p className=\"text-sm text-gray-500\">\r\n              Enterprise-grade Point of Sale System with 100+ features\r\n            </p>\r\n          </div>\r\n        </div>\r\n      </footer>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\not-found.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":16,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":16,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[363,366],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[363,366],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport Link from 'next/link';\r\nimport { useEffect, useState } from 'react';\r\nimport { getDictionaryClient } from '@/app/[tenant]/[lang]/dictionaries-client';\r\n\r\ninterface Tenant {\r\n  slug: string;\r\n  name: string;\r\n  settings?: {\r\n    companyName?: string;\r\n  };\r\n}\r\n\r\nexport default function RootNotFound() {\r\n  const [dict, setDict] = useState<any>(null);\r\n  const [tenants, setTenants] = useState<Tenant[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  useEffect(() => {\r\n    getDictionaryClient('en').then(setDict);\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    async function fetchTenants() {\r\n      try {\r\n        const res = await fetch('/api/tenants');\r\n        const data = await res.json();\r\n        if (data.success && data.data) {\r\n          setTenants(data.data);\r\n        }\r\n      } catch (error) {\r\n        console.error('Error fetching tenants:', error);\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    }\r\n    fetchTenants();\r\n  }, []);\r\n\r\n  return (\r\n    <div className=\"min-h-screen flex items-center justify-center px-4 py-12\">\r\n      <div className=\"max-w-2xl w-full bg-white border border-gray-300 p-8\">\r\n        <div className=\"text-center mb-8\">\r\n          <div className=\"mb-6\">\r\n            <svg\r\n              className=\"mx-auto h-16 w-16 text-gray-400\"\r\n              fill=\"none\"\r\n              viewBox=\"0 0 24 24\"\r\n              stroke=\"currentColor\"\r\n            >\r\n              <path\r\n                strokeLinecap=\"round\"\r\n                strokeLinejoin=\"round\"\r\n                strokeWidth={2}\r\n                d=\"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4\"\r\n              />\r\n            </svg>\r\n          </div>\r\n          <h1 className=\"text-3xl font-bold text-gray-900 mb-3\">{dict?.common?.selectStore || 'Select a Store'}</h1>\r\n          <p className=\"text-gray-600 text-lg\">\r\n            {dict?.common?.selectStoreMessage || 'Please select a store to continue. Choose from the available stores below or use the default store.'}\r\n          </p>\r\n        </div>\r\n\r\n        {loading ? (\r\n          <div className=\"text-center py-8\">\r\n            <div className=\"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600\"></div>\r\n            <p className=\"mt-4 text-gray-600\">{dict?.common?.loadingStores || 'Loading stores...'}</p>\r\n          </div>\r\n        ) : (\r\n          <div className=\"space-y-3\">\r\n            {tenants.length > 0 ? (\r\n              tenants.map((tenant) => (\r\n                <Link\r\n                  key={tenant.slug}\r\n                  href={`/${tenant.slug}/en`}\r\n                  className=\"block w-full bg-gray-50 hover:bg-gray-100 p-4 transition-colors\"\r\n                >\r\n                  <div className=\"flex items-center justify-between\">\r\n                    <div>\r\n                      <h3 className=\"font-semibold text-gray-900 text-lg\">\r\n                        {tenant.settings?.companyName || tenant.name}\r\n                      </h3>\r\n                      <p className=\"text-sm text-gray-500 mt-1\">\r\n                        {tenant.settings?.companyName ? tenant.name : `${dict?.common?.store || 'Store'}: ${tenant.slug}`}\r\n                      </p>\r\n                    </div>\r\n                    <svg\r\n                      className=\"h-5 w-5 text-gray-400\"\r\n                      fill=\"none\"\r\n                      viewBox=\"0 0 24 24\"\r\n                      stroke=\"currentColor\"\r\n                    >\r\n                      <path\r\n                        strokeLinecap=\"round\"\r\n                        strokeLinejoin=\"round\"\r\n                        strokeWidth={2}\r\n                        d=\"M9 5l7 7-7 7\"\r\n                      />\r\n                    </svg>\r\n                  </div>\r\n                </Link>\r\n              ))\r\n            ) : (\r\n              <div className=\"text-center py-6\">\r\n                <p className=\"text-gray-600 mb-4\">{dict?.common?.noStoresAvailable || 'No stores available. Please contact your administrator.'}</p>\r\n                <Link\r\n                  href=\"/default/en\"\r\n                  className=\"inline-block bg-blue-600 text-white px-6 py-2 hover:bg-blue-700 font-medium transition-colors\"\r\n                >\r\n                  {dict?.common?.goToDefaultStore || 'Go to Default Store'}\r\n                </Link>\r\n              </div>\r\n            )}\r\n          </div>\r\n        )}\r\n\r\n        {!loading && tenants.length > 0 && (\r\n          <div className=\"mt-6 pt-6 space-y-3\">\r\n            <Link\r\n              href=\"/default/en\"\r\n              className=\"block w-full bg-blue-600 text-white px-4 py-3 hover:bg-blue-700 font-medium transition-colors text-center\"\r\n            >\r\n              {dict?.common?.goToDefaultStore || 'Go to Default Store'}\r\n            </Link>\r\n            <Link\r\n              href=\"/signup\"\r\n              className=\"block w-full bg-gray-100 text-gray-700 px-4 py-3 hover:bg-gray-200 font-medium transition-colors text-center\"\r\n            >\r\n              {dict?.common?.createNewStore || 'Create a New Store'}\r\n            </Link>\r\n          </div>\r\n        )}\r\n\r\n        {!loading && tenants.length === 0 && (\r\n          <div className=\"mt-6 pt-6\">\r\n            <Link\r\n              href=\"/signup\"\r\n              className=\"block w-full bg-blue-600 text-white px-4 py-3 hover:bg-blue-700 font-medium transition-colors text-center\"\r\n            >\r\n              {dict?.common?.createYourFirstStore || 'Create Your First Store'}\r\n            </Link>\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\proxy.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'firstPart' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":32,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":32,"endColumn":20}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\nimport { match } from '@formatjs/intl-localematcher';\r\nimport Negotiator from 'negotiator';\r\n\r\nconst locales = ['en', 'es'];\r\nconst defaultLocale = 'en';\r\nconst defaultTenant = 'default'; // Default tenant slug\r\n\r\nfunction getLocale(request: NextRequest): string {\r\n  const headers = {\r\n    'accept-language': request.headers.get('accept-language') || 'en',\r\n  };\r\n  const languages = new Negotiator({ headers }).languages();\r\n  return match(languages, locales, defaultLocale);\r\n}\r\n\r\nexport function proxy(request: NextRequest) {\r\n  const { pathname } = request.nextUrl;\r\n  const host = request.headers.get('host') || '';\r\n  \r\n  // Allow login page, forbidden page, error pages, and API routes to pass through\r\n  // IMPORTANT: Check for forbidden BEFORE checking tenant/lang structure\r\n  if (pathname === '/login' || pathname.includes('/forbidden') || pathname.includes('/error') || pathname.includes('/not-found') || pathname.startsWith('/api/')) {\r\n    return NextResponse.next();\r\n  }\r\n  \r\n  // Check if path already has tenant and locale structure: /tenant/lang/...\r\n  const pathParts = pathname.split('/').filter(Boolean);\r\n  \r\n  // If path starts with a tenant slug pattern (not a locale or known path)\r\n  if (pathParts.length >= 2) {\r\n    const firstPart = pathParts[0];\r\n    const secondPart = pathParts[1];\r\n    \r\n    // Check if it's already in tenant/lang format\r\n    if (locales.includes(secondPart)) {\r\n      // Assume tenant exists if format is correct (will be validated in layout)\r\n      return NextResponse.next(); // Already correctly formatted\r\n    }\r\n    \r\n    // Check if second part is a special route (forbidden, error, not-found) that should pass through\r\n    // This handles routes like /tenant/forbidden, /tenant/error, /tenant/not-found\r\n    if (secondPart === 'forbidden' || secondPart === 'error' || secondPart === 'not-found') {\r\n      return NextResponse.next(); // Let these routes pass through without adding locale\r\n    }\r\n  }\r\n  \r\n  // Try to get tenant from subdomain\r\n  let tenantSlug = defaultTenant;\r\n  const subdomain = host.split('.')[0];\r\n  if (subdomain && subdomain !== 'www' && subdomain !== 'localhost' && subdomain !== '127.0.0.1') {\r\n    // Use subdomain as tenant slug (will be validated in layout)\r\n    tenantSlug = subdomain;\r\n  }\r\n  \r\n  // Get locale\r\n  const locale = getLocale(request);\r\n  \r\n  // Redirect to tenant/lang/pathname\r\n  request.nextUrl.pathname = `/${tenantSlug}/${locale}${pathname === '/' ? '' : pathname}`;\r\n  return NextResponse.redirect(request.nextUrl);\r\n}\r\n\r\nexport const config = {\r\n  matcher: [\r\n    // Skip all internal paths (_next)\r\n    '/((?!_next|api|favicon.ico|.*\\\\..*).*)',\r\n  ],\r\n};\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\app\\signup\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":12,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":12,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[467,470],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[467,470],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":29,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":29,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[931,934],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[931,934],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":91,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":91,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2935,2938],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2935,2938],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":140,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":140,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4396,4399],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4396,4399],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":265,"column":95,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":265,"endColumn":98,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11493,11496],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11493,11496],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport { useRouter } from 'next/navigation';\r\nimport Link from 'next/link';\r\nimport { detectLocation } from '@/lib/location-detection';\r\nimport { getDictionaryClient } from '@/app/[tenant]/[lang]/dictionaries-client';\r\nimport { validatePassword as validatePasswordLib } from '@/lib/validation';\r\n\r\nexport default function SignupPage() {\r\n  const router = useRouter();\r\n  const [dict, setDict] = useState<any>(null);\r\n  const [formData, setFormData] = useState({\r\n    // Store info\r\n    slug: '',\r\n    name: '',\r\n    companyName: '',\r\n    businessType: 'general' as 'retail' | 'restaurant' | 'laundry' | 'service' | 'general',\r\n    // Admin user info\r\n    adminEmail: '',\r\n    adminPassword: '',\r\n    adminName: '',\r\n    // Optional\r\n    currency: 'USD',\r\n    language: 'en',\r\n    phone: '',\r\n    email: '',\r\n  });\r\n  const [businessTypes, setBusinessTypes] = useState<any[]>([]);\r\n  const [loadingBusinessTypes, setLoadingBusinessTypes] = useState(true);\r\n  const [error, setError] = useState('');\r\n  const [success, setSuccess] = useState(false);\r\n  const [loading, setLoading] = useState(false);\r\n  const [passwordErrors, setPasswordErrors] = useState<string[]>([]);\r\n  const [phonePlaceholder, setPhonePlaceholder] = useState('+1 (555) 123-4567');\r\n  const [detectingLocation, setDetectingLocation] = useState(true);\r\n\r\n  // Load dictionary\r\n  useEffect(() => {\r\n    getDictionaryClient(formData.language as 'en' | 'es' || 'en').then(setDict);\r\n  }, [formData.language]);\r\n\r\n  // Load business types\r\n  useEffect(() => {\r\n    const loadBusinessTypes = async () => {\r\n      try {\r\n        const res = await fetch('/api/business-types');\r\n        const data = await res.json();\r\n        if (data.success) {\r\n          setBusinessTypes(data.data);\r\n        }\r\n      } catch (err) {\r\n        console.error('Failed to load business types:', err);\r\n      } finally {\r\n        setLoadingBusinessTypes(false);\r\n      }\r\n    };\r\n    loadBusinessTypes();\r\n  }, []);\r\n\r\n  // Detect location on component mount\r\n  useEffect(() => {\r\n    const detectUserLocation = async () => {\r\n      try {\r\n        const detected = await detectLocation();\r\n        if (detected) {\r\n          setFormData(prev => ({\r\n            ...prev,\r\n            currency: detected.currency,\r\n            language: detected.language,\r\n          }));\r\n          if (detected.phoneFormat) {\r\n            setPhonePlaceholder(detected.phoneFormat.placeholder);\r\n          }\r\n        }\r\n      } catch (err) {\r\n        console.error('Failed to detect location:', err);\r\n        // Keep defaults if detection fails\r\n      } finally {\r\n        setDetectingLocation(false);\r\n      }\r\n    };\r\n\r\n    detectUserLocation();\r\n  }, []);\r\n\r\n  const validatePassword = (password: string) => {\r\n    if (!dict) return [];\r\n    const t = (key: string, fallback: string) => {\r\n      const keys = key.split('.');\r\n      let value: any = dict;\r\n      for (const k of keys) {\r\n        value = value?.[k];\r\n        if (value === undefined) break;\r\n      }\r\n      return value || fallback;\r\n    };\r\n    const result = validatePasswordLib(password, t);\r\n    return result.errors;\r\n  };\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    setError('');\r\n    setPasswordErrors([]);\r\n\r\n    // Validate password\r\n    const pwdErrors = validatePassword(formData.adminPassword);\r\n    if (pwdErrors.length > 0) {\r\n      setPasswordErrors(pwdErrors);\r\n      return;\r\n    }\r\n\r\n    // Validate slug format\r\n    if (!/^[a-z0-9-]+$/.test(formData.slug)) {\r\n      setError(dict?.signup?.storeIdentifierFormatError || 'Store identifier can only contain lowercase letters, numbers, and hyphens');\r\n      return;\r\n    }\r\n\r\n    setLoading(true);\r\n\r\n    try {\r\n      const res = await fetch('/api/tenants/signup', {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify(formData),\r\n      });\r\n\r\n      const data = await res.json();\r\n\r\n      if (data.success) {\r\n        setSuccess(true);\r\n        // Redirect to login after 3 seconds\r\n        setTimeout(() => {\r\n          router.push(`/${data.data.tenant.slug}/${formData.language}/login`);\r\n        }, 3000);\r\n      } else {\r\n        setError(data.error || dict?.signup?.failedToCreateStore || 'Failed to create store. Please try again.');\r\n      }\r\n    } catch (err: any) {\r\n      setError(err.message || dict?.signup?.errorOccurred || 'An error occurred. Please try again.');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  if (success) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 flex items-center justify-center px-4 py-12\">\r\n        <div className=\"max-w-md w-full bg-white border border-gray-300 p-8 text-center\">\r\n          <div className=\"mb-6\">\r\n            <div className=\"inline-flex items-center justify-center w-16 h-16 bg-green-500 border border-green-600 mb-4\">\r\n              <svg className=\"w-8 h-8 text-white\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M5 13l4 4L19 7\" />\r\n              </svg>\r\n            </div>\r\n          </div>\r\n          <h1 className=\"text-3xl font-bold text-gray-900 mb-3\">{dict?.signup?.storeCreatedSuccessfully || 'Store Created Successfully!'}</h1>\r\n          <p className=\"text-gray-600 mb-6\">\r\n            {dict?.signup?.storeCreatedMessage || 'Your store has been created. You will be redirected to the login page shortly.'}\r\n          </p>\r\n          <p className=\"text-sm text-gray-500 mb-6\">\r\n            {dict?.signup?.useAdminToLogin || 'Please use your admin email and password to login.'}\r\n          </p>\r\n          <Link\r\n            href={`/${formData.slug}/${formData.language}/login`}\r\n            className=\"inline-block w-full bg-blue-600 text-white px-4 py-3 hover:bg-blue-700 font-medium transition-colors border border-blue-700\"\r\n          >\r\n            {dict?.signup?.goToLogin || 'Go to Login'}\r\n          </Link>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 flex items-center justify-center px-4 py-12\">\r\n      <div className=\"max-w-2xl w-full bg-white border border-gray-300 p-6 sm:p-8\">\r\n        <div className=\"text-center mb-8\">\r\n          <div className=\"inline-flex items-center justify-center w-16 h-16 bg-blue-600 border border-blue-700 mb-4\">\r\n            <svg className=\"w-8 h-8 text-white\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4\" />\r\n            </svg>\r\n          </div>\r\n          <h1 className=\"text-3xl sm:text-4xl font-bold text-gray-900 mb-2\">{dict?.signup?.createYourStore || 'Create Your Store'}</h1>\r\n          <p className=\"text-gray-600 text-sm sm:text-base\">{dict?.signup?.signupSubtitle || 'Sign up to get started with your POS system'}</p>\r\n        </div>\r\n\r\n        {error && (\r\n          <div className=\"mb-6 p-4 bg-red-50 border-2 border-red-300 text-red-700 text-sm flex items-start gap-2\">\r\n            <svg className=\"w-5 h-5 flex-shrink-0 mt-0.5\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n            </svg>\r\n            <span>{error}</span>\r\n          </div>\r\n        )}\r\n\r\n        <form onSubmit={handleSubmit} className=\"space-y-6\">\r\n          {/* Store Information */}\r\n          <div className=\"border-b border-gray-200 pb-6\">\r\n            <h2 className=\"text-xl font-semibold text-gray-900 mb-4\">{dict?.signup?.storeInformation || 'Store Information'}</h2>\r\n            \r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n              <div>\r\n                <label htmlFor=\"slug\" className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                  {dict?.signup?.storeIdentifier || 'Store Identifier'} <span className=\"text-red-500\">*</span>\r\n                </label>\r\n                <input\r\n                  type=\"text\"\r\n                  id=\"slug\"\r\n                  required\r\n                  value={formData.slug}\r\n                  onChange={(e) => setFormData({ ...formData, slug: e.target.value.toLowerCase().replace(/[^a-z0-9-]/g, '') })}\r\n                  className=\"w-full px-4 py-3 border-2 border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white transition-all\"\r\n                  placeholder={dict?.signup?.storeIdentifierPlaceholder || 'my-store'}\r\n                  pattern=\"[a-z0-9-]+\"\r\n                />\r\n                <p className=\"mt-1 text-xs text-gray-500\">{dict?.signup?.lowercaseLettersOnly || 'Lowercase letters, numbers, and hyphens only'}</p>\r\n              </div>\r\n\r\n              <div>\r\n                <label htmlFor=\"name\" className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                  {dict?.signup?.storeName || 'Store Name'} <span className=\"text-red-500\">*</span>\r\n                </label>\r\n                <input\r\n                  type=\"text\"\r\n                  id=\"name\"\r\n                  required\r\n                  value={formData.name}\r\n                  onChange={(e) => setFormData({ ...formData, name: e.target.value })}\r\n                  className=\"w-full px-4 py-3 border-2 border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white transition-all\"\r\n                  placeholder={dict?.signup?.storeNamePlaceholder || 'My Store'}\r\n                />\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"mt-4\">\r\n              <label htmlFor=\"companyName\" className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                {dict?.signup?.companyNameOptional || 'Company Name (Optional)'}\r\n              </label>\r\n              <input\r\n                type=\"text\"\r\n                id=\"companyName\"\r\n                value={formData.companyName}\r\n                onChange={(e) => setFormData({ ...formData, companyName: e.target.value })}\r\n                className=\"w-full px-4 py-3 border-2 border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white transition-all\"\r\n                placeholder={dict?.signup?.companyNamePlaceholder || 'My Company Inc.'}\r\n              />\r\n            </div>\r\n\r\n            <div className=\"mt-4\">\r\n              <label htmlFor=\"businessType\" className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                {dict?.signup?.businessType || 'Business Type'} <span className=\"text-red-500\">*</span>\r\n              </label>\r\n              {loadingBusinessTypes ? (\r\n                <div className=\"w-full px-4 py-3 border-2 border-gray-300 bg-gray-50 flex items-center gap-2\">\r\n                  <div className=\"w-5 h-5 border-2 border-gray-400 border-t-transparent animate-spin\"></div>\r\n                  <span className=\"text-sm text-gray-600\">Loading business types...</span>\r\n                </div>\r\n              ) : (\r\n                <select\r\n                  id=\"businessType\"\r\n                  required\r\n                  value={formData.businessType}\r\n                  onChange={(e) => setFormData({ ...formData, businessType: e.target.value as any })}\r\n                  className=\"w-full px-4 py-3 border-2 border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white transition-all\"\r\n                >\r\n                  {businessTypes.map((type) => (\r\n                    <option key={type.type} value={type.type}>\r\n                      {type.name}\r\n                    </option>\r\n                  ))}\r\n                </select>\r\n              )}\r\n              {formData.businessType && !loadingBusinessTypes && (\r\n                <p className=\"mt-1 text-xs text-gray-600\">\r\n                  {businessTypes.find((t) => t.type === formData.businessType)?.description || ''}\r\n                </p>\r\n              )}\r\n            </div>\r\n          </div>\r\n\r\n          {/* Admin Account */}\r\n          <div className=\"border-b border-gray-200 pb-6\">\r\n            <h2 className=\"text-xl font-semibold text-gray-900 mb-4\">{dict?.signup?.adminAccount || 'Admin Account'}</h2>\r\n            \r\n            <div className=\"space-y-4\">\r\n              <div>\r\n                <label htmlFor=\"adminName\" className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                  {dict?.signup?.yourName || 'Your Name'} <span className=\"text-red-500\">*</span>\r\n                </label>\r\n                <input\r\n                  type=\"text\"\r\n                  id=\"adminName\"\r\n                  required\r\n                  value={formData.adminName}\r\n                  onChange={(e) => setFormData({ ...formData, adminName: e.target.value })}\r\n                  className=\"w-full px-4 py-3 border-2 border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white transition-all\"\r\n                  placeholder={dict?.signup?.namePlaceholder || 'John Doe'}\r\n                />\r\n              </div>\r\n\r\n              <div>\r\n                <label htmlFor=\"adminEmail\" className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                  {dict?.signup?.adminEmail || 'Admin Email'} <span className=\"text-red-500\">*</span>\r\n                </label>\r\n                <input\r\n                  type=\"email\"\r\n                  id=\"adminEmail\"\r\n                  required\r\n                  value={formData.adminEmail}\r\n                  onChange={(e) => setFormData({ ...formData, adminEmail: e.target.value })}\r\n                  className=\"w-full px-4 py-3 border-2 border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white transition-all\"\r\n                  placeholder={dict?.signup?.adminEmailPlaceholder || 'admin@example.com'}\r\n                />\r\n              </div>\r\n\r\n              <div>\r\n                <label htmlFor=\"adminPassword\" className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                  {dict?.signup?.adminPassword || 'Admin Password'} <span className=\"text-red-500\">*</span>\r\n                </label>\r\n                <input\r\n                  type=\"password\"\r\n                  id=\"adminPassword\"\r\n                  required\r\n                  value={formData.adminPassword}\r\n                  onChange={(e) => {\r\n                    setFormData({ ...formData, adminPassword: e.target.value });\r\n                    if (e.target.value) {\r\n                      setPasswordErrors(validatePassword(e.target.value));\r\n                    } else {\r\n                      setPasswordErrors([]);\r\n                    }\r\n                  }}\r\n                  className=\"w-full px-4 py-3 border-2 border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white transition-all\"\r\n                  placeholder={dict?.signup?.createStrongPassword || 'Create a strong password'}\r\n                />\r\n                {passwordErrors.length > 0 && (\r\n                  <ul className=\"mt-2 text-xs text-red-600 space-y-1\">\r\n                    {passwordErrors.map((err, idx) => (\r\n                      <li key={idx}> {err}</li>\r\n                    ))}\r\n                  </ul>\r\n                )}\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Optional Settings */}\r\n          <div>\r\n            <h2 className=\"text-xl font-semibold text-gray-900 mb-4\">{dict?.signup?.optionalSettings || 'Optional Settings'}</h2>\r\n            \r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n              <div>\r\n                <label htmlFor=\"currency\" className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                  {dict?.signup?.currency || 'Currency'}\r\n                </label>\r\n                <select\r\n                  id=\"currency\"\r\n                  value={formData.currency}\r\n                  onChange={(e) => setFormData({ ...formData, currency: e.target.value })}\r\n                  className=\"w-full px-4 py-3 border-2 border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white transition-all\"\r\n                  disabled={detectingLocation}\r\n                >\r\n                  <option value=\"USD\">USD - US Dollar</option>\r\n                  <option value=\"EUR\">EUR - Euro</option>\r\n                  <option value=\"GBP\">GBP - British Pound</option>\r\n                  <option value=\"CAD\">CAD - Canadian Dollar</option>\r\n                  <option value=\"AUD\">AUD - Australian Dollar</option>\r\n                  <option value=\"MXN\">MXN - Mexican Peso</option>\r\n                  <option value=\"PHP\">PHP - Philippine Peso</option>\r\n                  <option value=\"JPY\">JPY - Japanese Yen</option>\r\n                  <option value=\"CNY\">CNY - Chinese Yuan</option>\r\n                  <option value=\"INR\">INR - Indian Rupee</option>\r\n                  <option value=\"SGD\">SGD - Singapore Dollar</option>\r\n                  <option value=\"HKD\">HKD - Hong Kong Dollar</option>\r\n                  <option value=\"THB\">THB - Thai Baht</option>\r\n                  <option value=\"IDR\">IDR - Indonesian Rupiah</option>\r\n                  <option value=\"MYR\">MYR - Malaysian Ringgit</option>\r\n                  <option value=\"BRL\">BRL - Brazilian Real</option>\r\n                  <option value=\"ZAR\">ZAR - South African Rand</option>\r\n                </select>\r\n                {detectingLocation && (\r\n                  <p className=\"mt-1 text-xs text-gray-500\">{dict?.signup?.detectingLocation || 'Detecting your location...'}</p>\r\n                )}\r\n              </div>\r\n\r\n              <div>\r\n                <label htmlFor=\"language\" className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                  {dict?.signup?.language || 'Language'}\r\n                </label>\r\n                <select\r\n                  id=\"language\"\r\n                  value={formData.language}\r\n                  onChange={(e) => setFormData({ ...formData, language: e.target.value })}\r\n                  className=\"w-full px-4 py-3 border-2 border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white transition-all\"\r\n                >\r\n                  <option value=\"en\">English</option>\r\n                  <option value=\"es\">Espaol</option>\r\n                </select>\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4\">\r\n              <div>\r\n                <label htmlFor=\"phone\" className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                  {dict?.signup?.phoneNumber || 'Phone Number'}\r\n                </label>\r\n                <input\r\n                  type=\"tel\"\r\n                  id=\"phone\"\r\n                  value={formData.phone}\r\n                  onChange={(e) => setFormData({ ...formData, phone: e.target.value })}\r\n                  className=\"w-full px-4 py-3 border-2 border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white transition-all\"\r\n                  placeholder={phonePlaceholder}\r\n                />\r\n              </div>\r\n\r\n              <div>\r\n                <label htmlFor=\"email\" className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                  {dict?.signup?.contactEmail || 'Contact Email'}\r\n                </label>\r\n                <input\r\n                  type=\"email\"\r\n                  id=\"email\"\r\n                  value={formData.email}\r\n                  onChange={(e) => setFormData({ ...formData, email: e.target.value })}\r\n                  className=\"w-full px-4 py-3 border-2 border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white transition-all\"\r\n                  placeholder={dict?.signup?.contactEmailPlaceholder || 'contact@example.com'}\r\n                />\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          <button\r\n            type=\"submit\"\r\n            disabled={loading}\r\n            className=\"w-full bg-blue-600 text-white px-4 py-4 hover:bg-blue-700 font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed text-lg border border-blue-700 flex items-center justify-center gap-2\"\r\n          >\r\n            {loading ? (\r\n              <>\r\n                <div className=\"w-5 h-5 border-2 border-white border-t-transparent animate-spin\"></div>\r\n                <span>{dict?.signup?.creatingStore || 'Creating Store...'}</span>\r\n              </>\r\n            ) : (\r\n              dict?.signup?.createStore || 'Create Store'\r\n            )}\r\n          </button>\r\n\r\n          <p className=\"text-center text-sm text-gray-600\">\r\n            {dict?.signup?.alreadyHaveStore || 'Already have a store?'}{' '}\r\n            <Link href=\"/\" className=\"text-blue-600 hover:text-blue-700 font-medium\">\r\n              {dict?.signup?.selectStoreToLogin || 'Select a store to login'}\r\n            </Link>\r\n          </p>\r\n        </form>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\components\\AttendanceClock.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":19,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":19,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[549,552],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[549,552],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchCurrentSession'. Either include it or remove the dependency array.","line":70,"column":6,"nodeType":"ArrayExpression","endLine":70,"endColumn":23,"suggestions":[{"desc":"Update the dependencies array to be: [fetchCurrentSession, isAuthenticated]","fix":{"range":[2059,2076],"text":"[fetchCurrentSession, isAuthenticated]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":96,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":96,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2775,2778],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2775,2778],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":127,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":127,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3625,3628],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3625,3628],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport { useParams } from 'next/navigation';\r\nimport { useAuth } from '@/contexts/AuthContext';\r\nimport { getDictionaryClient } from '@/app/[tenant]/[lang]/dictionaries-client';\r\n\r\ninterface AttendanceSession {\r\n  _id: string;\r\n  clockIn: string;\r\n  clockOut?: string;\r\n  currentHours?: number;\r\n  notes?: string;\r\n}\r\n\r\nexport default function AttendanceClock() {\r\n  const params = useParams();\r\n  const lang = (params?.lang as 'en' | 'es') || 'en';\r\n  const [dict, setDict] = useState<any>(null);\r\n  const { user, isAuthenticated } = useAuth();\r\n  const [session, setSession] = useState<AttendanceSession | null>(null);\r\n  const [loading, setLoading] = useState(false);\r\n  const [error, setError] = useState('');\r\n  const [notes, setNotes] = useState('');\r\n  const [currentHours, setCurrentHours] = useState(0);\r\n\r\n  useEffect(() => {\r\n    getDictionaryClient(lang).then(setDict);\r\n  }, [lang]);\r\n\r\n  // Fetch current session\r\n  const fetchCurrentSession = async () => {\r\n    if (!isAuthenticated) return;\r\n\r\n    try {\r\n      const res = await fetch('/api/attendance/current', {\r\n        credentials: 'include',\r\n      });\r\n      const data = await res.json();\r\n      \r\n      if (data.success) {\r\n        setSession(data.data);\r\n        if (data.data) {\r\n          setCurrentHours(data.data.currentHours || 0);\r\n        }\r\n      }\r\n    } catch (err) {\r\n      console.error('Error fetching attendance:', err);\r\n    }\r\n  };\r\n\r\n  // Update current hours every minute\r\n  useEffect(() => {\r\n    if (!session || session.clockOut) return;\r\n\r\n    const interval = setInterval(() => {\r\n      if (session.clockIn) {\r\n        const now = new Date();\r\n        const clockIn = new Date(session.clockIn);\r\n        const hours = (now.getTime() - clockIn.getTime()) / (1000 * 60 * 60);\r\n        setCurrentHours(Math.round(hours * 100) / 100);\r\n      }\r\n    }, 60000); // Update every minute\r\n\r\n    return () => clearInterval(interval);\r\n  }, [session]);\r\n\r\n  useEffect(() => {\r\n    fetchCurrentSession();\r\n  }, [isAuthenticated]);\r\n\r\n  const handleClockIn = async () => {\r\n    setLoading(true);\r\n    setError('');\r\n\r\n    try {\r\n      const res = await fetch('/api/attendance', {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        credentials: 'include',\r\n        body: JSON.stringify({\r\n          action: 'clock-in',\r\n          notes: notes.trim() || undefined,\r\n        }),\r\n      });\r\n\r\n      const data = await res.json();\r\n      \r\n      if (data.success) {\r\n        setSession(data.data);\r\n        setNotes('');\r\n        await fetchCurrentSession();\r\n      } else {\r\n        setError(data.error || dict?.common?.failedToClockIn || 'Failed to clock in');\r\n      }\r\n    } catch (err: any) {\r\n      setError(err.message || dict?.common?.failedToClockIn || 'Failed to clock in');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleClockOut = async () => {\r\n    setLoading(true);\r\n    setError('');\r\n\r\n    try {\r\n      const res = await fetch('/api/attendance', {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        credentials: 'include',\r\n        body: JSON.stringify({\r\n          action: 'clock-out',\r\n          notes: notes.trim() || undefined,\r\n        }),\r\n      });\r\n\r\n      const data = await res.json();\r\n      \r\n      if (data.success) {\r\n        setSession(data.data);\r\n        setNotes('');\r\n        await fetchCurrentSession();\r\n      } else {\r\n        setError(data.error || dict?.common?.failedToClockOut || 'Failed to clock out');\r\n      }\r\n    } catch (err: any) {\r\n      setError(err.message || dict?.common?.failedToClockOut || 'Failed to clock out');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  if (!isAuthenticated) {\r\n    return null;\r\n  }\r\n\r\n  const isClockedIn = session && !session.clockOut;\r\n  const clockInTime = session?.clockIn ? new Date(session.clockIn) : null;\r\n\r\n  return (\r\n    <div className=\"bg-white border-2 border-gray-300 p-6\">\r\n      <div className=\"flex items-center justify-between mb-4\">\r\n        <h2 className=\"text-xl font-bold text-gray-900\">{dict?.components?.attendance?.title || 'Attendance'}</h2>\r\n        {isClockedIn && (\r\n          <span className=\"px-3 py-1 bg-green-100 text-green-800 text-sm font-semibold border border-green-300\">\r\n            {dict?.components?.attendance?.clockedIn || 'Clocked In'}\r\n          </span>\r\n        )}\r\n      </div>\r\n\r\n      {error && (\r\n        <div className=\"mb-4 p-3 bg-red-50 border-2 border-red-300 text-red-700 text-sm\">\r\n          {error}\r\n        </div>\r\n      )}\r\n\r\n      {isClockedIn && clockInTime && (\r\n        <div className=\"mb-4 p-4 bg-blue-50 border border-blue-300\">\r\n          <div className=\"flex items-center justify-between mb-2\">\r\n            <span className=\"text-sm font-medium text-gray-700\">{dict?.components?.attendance?.clockedInAt || 'Clocked in at:'}</span>\r\n            <span className=\"text-sm font-semibold text-gray-900\">\r\n              {clockInTime.toLocaleTimeString()}\r\n            </span>\r\n          </div>\r\n          <div className=\"flex items-center justify-between\">\r\n            <span className=\"text-sm font-medium text-gray-700\">{dict?.components?.attendance?.hoursWorked || 'Hours worked:'}</span>\r\n            <span className=\"text-lg font-bold text-blue-600\">\r\n              {currentHours.toFixed(2)} hrs\r\n            </span>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      <div className=\"space-y-4\">\r\n        <div>\r\n          <label htmlFor=\"notes\" className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n            {dict?.components?.attendance?.notesOptional || 'Notes (optional)'}\r\n          </label>\r\n          <textarea\r\n            id=\"notes\"\r\n            value={notes}\r\n            onChange={(e) => setNotes(e.target.value)}\r\n            placeholder={dict?.common?.addShiftNotes || 'Add any notes about your shift...'}\r\n            className=\"w-full px-3 py-2 border-2 border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 resize-none bg-white\"\r\n            rows={2}\r\n            disabled={loading}\r\n          />\r\n        </div>\r\n\r\n        {!isClockedIn ? (\r\n          <button\r\n            onClick={handleClockIn}\r\n            disabled={loading}\r\n            className=\"w-full bg-green-600 text-white py-3 font-semibold hover:bg-green-700 active:bg-green-800 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2 border border-green-700\"\r\n          >\r\n            {loading ? (\r\n              <>\r\n                <div className=\"animate-spin h-5 w-5 border-b-2 border-white\"></div>\r\n                <span>{dict?.components?.attendance?.clockingIn || 'Clocking in...'}</span>\r\n              </>\r\n            ) : (\r\n              <>\r\n                <svg className=\"w-5 h-5\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 4v16m8-8H4\" />\r\n                </svg>\r\n                <span>{dict?.components?.attendance?.clockIn || 'Clock In'}</span>\r\n              </>\r\n            )}\r\n          </button>\r\n        ) : (\r\n          <button\r\n            onClick={handleClockOut}\r\n            disabled={loading}\r\n            className=\"w-full bg-red-600 text-white py-3 font-semibold hover:bg-red-700 active:bg-red-800 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2 border border-red-700\"\r\n          >\r\n            {loading ? (\r\n              <>\r\n                <div className=\"animate-spin h-5 w-5 border-b-2 border-white\"></div>\r\n                <span>{dict?.components?.attendance?.clockingOut || 'Clocking out...'}</span>\r\n              </>\r\n            ) : (\r\n              <>\r\n                <svg className=\"w-5 h-5\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M20 12H4\" />\r\n                </svg>\r\n                <span>{dict?.components?.attendance?.clockOut || 'Clock Out'}</span>\r\n              </>\r\n            )}\r\n          </button>\r\n        )}\r\n      </div>\r\n\r\n      {user && (\r\n        <p className=\"mt-4 text-xs text-gray-500 text-center\">\r\n          {(dict?.components?.attendance?.loggedInAs || 'Logged in as: {name} ({role})').replace('{name}', user.name).replace('{role}', user.role)}\r\n        </p>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\components\\AttendanceTrendsCharts.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":43,"column":9,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":43,"endColumn":12,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1533,1536],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1533,1536],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { LineChart, Line, BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer } from 'recharts';\r\nimport { useTenantSettings } from '@/contexts/TenantSettingsContext';\r\nimport { getDefaultTenantSettings } from '@/lib/currency';\r\nimport { formatDate } from '@/lib/formatting';\r\n\r\nconst formatHours = (value: number) => {\r\n  const h = Math.floor(value);\r\n  const m = Math.round((value - h) * 60);\r\n  return `${h}h ${m}m`;\r\n};\r\n\r\nconst CustomTooltip = ({ active, payload, label }: { active?: boolean; payload?: Array<{ color: string; name: string; value: number; payload: { fullName: string } }>; label?: string }) => {\r\n  if (active && payload && payload.length) {\r\n    return (\r\n      <div className=\"bg-white border border-gray-300 rounded-lg p-3 shadow-lg\">\r\n        <p className=\"font-semibold text-gray-900 mb-2\">{label || payload[0].payload.fullName}</p>\r\n        {payload.map((entry, index: number) => (\r\n          <p key={index} className=\"text-sm\" style={{ color: entry.color }}>\r\n            {entry.name}: {entry.name.toLowerCase().includes('hours')\r\n              ? formatHours(entry.value)\r\n              : entry.value}\r\n          </p>\r\n        ))}\r\n      </div>\r\n    );\r\n  }\r\n  return null;\r\n};\r\n\r\ninterface Attendance {\r\n  _id: string;\r\n  userId: string | { _id: string; name: string; email: string };\r\n  clockIn: string;\r\n  clockOut?: string;\r\n  totalHours?: number;\r\n  createdAt: string;\r\n}\r\n\r\ninterface AttendanceTrendsChartsProps {\r\n  attendances: Attendance[];\r\n  dict: any;\r\n}\r\n\r\nexport default function AttendanceTrendsCharts({ attendances, dict }: AttendanceTrendsChartsProps) {\r\n  const { settings } = useTenantSettings();\r\n  const tenantSettings = settings || getDefaultTenantSettings();\r\n  const primaryColor = tenantSettings.primaryColor || '#3b82f6';\r\n\r\n  // Process data for daily hours chart\r\n  const dailyHoursMap = new Map<string, number>();\r\n  const dailyCountMap = new Map<string, number>();\r\n\r\n  attendances.forEach(attendance => {\r\n    if (attendance.totalHours) {\r\n      const date = formatDate(new Date(attendance.clockIn), tenantSettings);\r\n      const currentHours = dailyHoursMap.get(date) || 0;\r\n      dailyHoursMap.set(date, currentHours + attendance.totalHours);\r\n      \r\n      const currentCount = dailyCountMap.get(date) || 0;\r\n      dailyCountMap.set(date, currentCount + 1);\r\n    }\r\n  });\r\n\r\n  // Convert to array and sort by date\r\n  const dailyHoursData = Array.from(dailyHoursMap.entries())\r\n    .map(([date, hours]) => ({\r\n      date,\r\n      hours: Math.round(hours * 10) / 10, // Round to 1 decimal\r\n    }))\r\n    .sort((a, b) => new Date(a.date).getTime() - new Date(b.date).getTime());\r\n\r\n  const dailyCountData = Array.from(dailyCountMap.entries())\r\n    .map(([date, count]) => ({\r\n      date,\r\n      count,\r\n    }))\r\n    .sort((a, b) => new Date(a.date).getTime() - new Date(b.date).getTime());\r\n\r\n  // Process data for hours by employee\r\n  const employeeHoursMap = new Map<string, { name: string; hours: number }>();\r\n\r\n  attendances.forEach(attendance => {\r\n    if (attendance.totalHours) {\r\n      const userName = typeof attendance.userId === 'object' \r\n        ? attendance.userId.name \r\n        : 'Unknown';\r\n      const userId = typeof attendance.userId === 'object' \r\n        ? attendance.userId._id \r\n        : attendance.userId;\r\n      \r\n      const existing = employeeHoursMap.get(userId);\r\n      if (existing) {\r\n        existing.hours += attendance.totalHours;\r\n      } else {\r\n        employeeHoursMap.set(userId, { name: userName, hours: attendance.totalHours });\r\n      }\r\n    }\r\n  });\r\n\r\n  const employeeHoursData = Array.from(employeeHoursMap.values())\r\n    .map(emp => ({\r\n      name: emp.name.length > 15 ? emp.name.substring(0, 15) + '...' : emp.name,\r\n      fullName: emp.name,\r\n      hours: Math.round(emp.hours * 10) / 10,\r\n    }))\r\n    .sort((a, b) => b.hours - a.hours)\r\n    .slice(0, 10); // Top 10 employees\r\n\r\n  if (attendances.length === 0) {\r\n    return null;\r\n  }\r\n\r\n  return (\r\n    <div className=\"space-y-6 mb-6\">\r\n      {/* Daily Hours Worked - Line Chart */}\r\n      {dailyHoursData.length > 0 && (\r\n        <div className=\"bg-gray-50 border border-gray-200 p-4 rounded-lg\">\r\n          <h3 className=\"text-lg font-semibold text-gray-900 mb-4\">\r\n            {dict.admin?.dailyHoursWorked || 'Daily Hours Worked'}\r\n          </h3>\r\n          <ResponsiveContainer width=\"100%\" height={350}>\r\n            <LineChart data={dailyHoursData} margin={{ top: 20, right: 30, left: 20, bottom: 60 }}>\r\n              <CartesianGrid strokeDasharray=\"3 3\" stroke=\"#e5e7eb\" />\r\n              <XAxis\r\n                dataKey=\"date\"\r\n                angle={-45}\r\n                textAnchor=\"end\"\r\n                height={80}\r\n                stroke=\"#6b7280\"\r\n                style={{ fontSize: '12px' }}\r\n              />\r\n              <YAxis\r\n                stroke=\"#6b7280\"\r\n                style={{ fontSize: '12px' }}\r\n                tickFormatter={(value) => `${value}h`}\r\n              />\r\n              <Tooltip content={<CustomTooltip />} />\r\n              <Legend />\r\n              <Line\r\n                type=\"monotone\"\r\n                dataKey=\"hours\"\r\n                stroke={primaryColor}\r\n                strokeWidth={2}\r\n                dot={{ fill: primaryColor, r: 4 }}\r\n                activeDot={{ r: 6 }}\r\n                name={dict.admin?.totalHours || 'Total Hours'}\r\n              />\r\n            </LineChart>\r\n          </ResponsiveContainer>\r\n        </div>\r\n      )}\r\n\r\n      {/* Daily Attendance Count - Bar Chart */}\r\n      {dailyCountData.length > 0 && (\r\n        <div className=\"bg-gray-50 border border-gray-200 p-4 rounded-lg\">\r\n          <h3 className=\"text-lg font-semibold text-gray-900 mb-4\">\r\n            {dict.admin?.dailyAttendanceCount || 'Daily Attendance Count'}\r\n          </h3>\r\n          <ResponsiveContainer width=\"100%\" height={350}>\r\n            <BarChart data={dailyCountData} margin={{ top: 20, right: 30, left: 20, bottom: 60 }}>\r\n              <CartesianGrid strokeDasharray=\"3 3\" stroke=\"#e5e7eb\" />\r\n              <XAxis\r\n                dataKey=\"date\"\r\n                angle={-45}\r\n                textAnchor=\"end\"\r\n                height={80}\r\n                stroke=\"#6b7280\"\r\n                style={{ fontSize: '12px' }}\r\n              />\r\n              <YAxis\r\n                stroke=\"#6b7280\"\r\n                style={{ fontSize: '12px' }}\r\n              />\r\n              <Tooltip\r\n                contentStyle={{\r\n                  backgroundColor: '#fff',\r\n                  border: '1px solid #e5e7eb',\r\n                  borderRadius: '8px',\r\n                  boxShadow: '0 4px 6px -1px rgba(0, 0, 0, 0.1)',\r\n                }}\r\n              />\r\n              <Legend />\r\n              <Bar dataKey=\"count\" fill=\"#10b981\" name={dict.admin?.attendanceCount || 'Attendance Count'} />\r\n            </BarChart>\r\n          </ResponsiveContainer>\r\n        </div>\r\n      )}\r\n\r\n      {/* Hours by Employee - Bar Chart */}\r\n      {employeeHoursData.length > 0 && (\r\n        <div className=\"bg-gray-50 border border-gray-200 p-4 rounded-lg\">\r\n          <h3 className=\"text-lg font-semibold text-gray-900 mb-4\">\r\n            {dict.admin?.hoursByEmployee || 'Hours by Employee'}\r\n          </h3>\r\n          <ResponsiveContainer width=\"100%\" height={350}>\r\n            <BarChart data={employeeHoursData} margin={{ top: 20, right: 30, left: 20, bottom: 60 }}>\r\n              <CartesianGrid strokeDasharray=\"3 3\" stroke=\"#e5e7eb\" />\r\n              <XAxis\r\n                dataKey=\"name\"\r\n                angle={-45}\r\n                textAnchor=\"end\"\r\n                height={80}\r\n                stroke=\"#6b7280\"\r\n                style={{ fontSize: '12px' }}\r\n              />\r\n              <YAxis\r\n                stroke=\"#6b7280\"\r\n                style={{ fontSize: '12px' }}\r\n                tickFormatter={(value) => `${value}h`}\r\n              />\r\n              <Tooltip content={<CustomTooltip />} />\r\n              <Legend />\r\n              <Bar dataKey=\"hours\" fill=\"#8b5cf6\" name={dict.admin?.totalHours || 'Total Hours'} />\r\n            </BarChart>\r\n          </ResponsiveContainer>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\components\\BarcodeScanner.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useRef' is defined but never used. Allowed unused vars must match /^_/u.","line":3,"column":21,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":27},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setIsActive' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":12,"column":20,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":31}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useEffect, useRef, useState } from 'react';\r\nimport { hardwareService } from '@/lib/hardware';\r\n\r\ninterface BarcodeScannerProps {\r\n  onScan: (barcode: string) => void;\r\n  enabled?: boolean;\r\n}\r\n\r\nexport default function BarcodeScanner({ onScan, enabled = true }: BarcodeScannerProps) {\r\n  const [isActive, setIsActive] = useState(enabled);\r\n\r\n  useEffect(() => {\r\n    if (!isActive) return;\r\n\r\n    const unsubscribe = hardwareService.onBarcodeScan((barcode) => {\r\n      onScan(barcode);\r\n    });\r\n\r\n    return unsubscribe;\r\n  }, [isActive, onScan]);\r\n\r\n  return null; // This component doesn't render anything visible\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\components\\BookingCalendar.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":49,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":49,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1363,1366],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1363,1366],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport { useParams } from 'next/navigation';\r\nimport { getDictionaryClient } from '@/app/[tenant]/[lang]/dictionaries-client';\r\nimport { useTenantSettings } from '@/contexts/TenantSettingsContext';\r\nimport { formatTime as formatTimeUtil } from '@/lib/formatting';\r\nimport { getDefaultTenantSettings } from '@/lib/currency';\r\n\r\ninterface Booking {\r\n  _id: string;\r\n  customerName: string;\r\n  customerEmail?: string;\r\n  customerPhone?: string;\r\n  serviceName: string;\r\n  serviceDescription?: string;\r\n  startTime: string;\r\n  endTime: string;\r\n  duration: number;\r\n  status: 'pending' | 'confirmed' | 'completed' | 'cancelled' | 'no-show';\r\n  staffId?: {\r\n    _id: string;\r\n    name: string;\r\n    email: string;\r\n  };\r\n  staffName?: string;\r\n  notes?: string;\r\n  reminderSent?: boolean;\r\n  confirmationSent?: boolean;\r\n  createdAt: string;\r\n  updatedAt: string;\r\n}\r\n\r\ninterface BookingCalendarProps {\r\n  bookings: Booking[];\r\n  onDateSelect?: (date: Date) => void;\r\n  onBookingSelect?: (booking: Booking) => void;\r\n  selectedDate?: Date;\r\n}\r\n\r\nexport default function BookingCalendar({\r\n  bookings,\r\n  onDateSelect,\r\n  onBookingSelect,\r\n  selectedDate,\r\n}: BookingCalendarProps) {\r\n  const params = useParams();\r\n  const lang = (params?.lang as 'en' | 'es') || 'en';\r\n  const [dict, setDict] = useState<any>(null);\r\n  const [currentDate, setCurrentDate] = useState(selectedDate || new Date());\r\n  const [view, setView] = useState<'month' | 'week' | 'day'>('month');\r\n  const { settings } = useTenantSettings();\r\n  const tenantSettings = settings || getDefaultTenantSettings();\r\n\r\n  useEffect(() => {\r\n    getDictionaryClient(lang).then(setDict);\r\n  }, [lang]);\r\n\r\n  const today = new Date();\r\n  today.setHours(0, 0, 0, 0);\r\n\r\n  const getDaysInMonth = (date: Date) => {\r\n    const year = date.getFullYear();\r\n    const month = date.getMonth();\r\n    const firstDay = new Date(year, month, 1);\r\n    const lastDay = new Date(year, month + 1, 0);\r\n    const daysInMonth = lastDay.getDate();\r\n    const startingDayOfWeek = firstDay.getDay();\r\n\r\n    const days: (Date | null)[] = [];\r\n    \r\n    // Add empty cells for days before the first day of the month\r\n    for (let i = 0; i < startingDayOfWeek; i++) {\r\n      days.push(null);\r\n    }\r\n    \r\n    // Add all days of the month\r\n    for (let i = 1; i <= daysInMonth; i++) {\r\n      days.push(new Date(year, month, i));\r\n    }\r\n    \r\n    return days;\r\n  };\r\n\r\n  const getBookingsForDate = (date: Date | null): Booking[] => {\r\n    if (!date) return [];\r\n    const dateStr = date.toISOString().split('T')[0];\r\n    return bookings.filter((booking) => {\r\n      const bookingDate = new Date(booking.startTime).toISOString().split('T')[0];\r\n      return bookingDate === dateStr;\r\n    });\r\n  };\r\n\r\n  const getStatusColor = (status: Booking['status']) => {\r\n    switch (status) {\r\n      case 'confirmed':\r\n        return 'bg-green-100 text-green-800 border-green-300';\r\n      case 'pending':\r\n        return 'bg-yellow-100 text-yellow-800 border-yellow-300';\r\n      case 'completed':\r\n        return 'bg-blue-100 text-blue-800 border-blue-300';\r\n      case 'cancelled':\r\n        return 'bg-red-100 text-red-800 border-red-300';\r\n      case 'no-show':\r\n        return 'bg-gray-100 text-gray-800 border-gray-300';\r\n      default:\r\n        return 'bg-gray-100 text-gray-800 border-gray-300';\r\n    }\r\n  };\r\n\r\n  const formatTime = (dateString: string) => {\r\n    return formatTimeUtil(dateString, tenantSettings);\r\n  };\r\n\r\n  const navigateMonth = (direction: 'prev' | 'next') => {\r\n    const newDate = new Date(currentDate);\r\n    if (direction === 'prev') {\r\n      newDate.setMonth(newDate.getMonth() - 1);\r\n    } else {\r\n      newDate.setMonth(newDate.getMonth() + 1);\r\n    }\r\n    setCurrentDate(newDate);\r\n  };\r\n\r\n  const days = getDaysInMonth(currentDate);\r\n  const monthNames = [\r\n    'January', 'February', 'March', 'April', 'May', 'June',\r\n    'July', 'August', 'September', 'October', 'November', 'December'\r\n  ];\r\n  const dayNames = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];\r\n\r\n  return (\r\n    <div className=\"bg-white border border-gray-300 p-6\">\r\n      <div className=\"flex items-center justify-between mb-6\">\r\n        <div className=\"flex items-center gap-4\">\r\n          <button\r\n            onClick={() => navigateMonth('prev')}\r\n            className=\"p-2 hover:bg-gray-100 transition-colors border border-gray-300 bg-white\"\r\n          >\r\n            <svg className=\"w-5 h-5\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15 19l-7-7 7-7\" />\r\n            </svg>\r\n          </button>\r\n          <h2 className=\"text-xl font-bold text-gray-900\">\r\n            {monthNames[currentDate.getMonth()]} {currentDate.getFullYear()}\r\n          </h2>\r\n          <button\r\n            onClick={() => navigateMonth('next')}\r\n            className=\"p-2 hover:bg-gray-100 transition-colors border border-gray-300 bg-white\"\r\n          >\r\n            <svg className=\"w-5 h-5\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 5l7 7-7 7\" />\r\n            </svg>\r\n          </button>\r\n          <button\r\n            onClick={() => setCurrentDate(new Date())}\r\n            className=\"ml-4 px-4 py-2 text-sm bg-blue-600 text-white hover:bg-blue-700 transition-colors border border-blue-700\"\r\n          >\r\n            {dict?.components?.bookingCalendar?.today || 'Today'}\r\n          </button>\r\n        </div>\r\n        <div className=\"flex gap-2\">\r\n          <button\r\n            onClick={() => setView('month')}\r\n            className={`px-4 py-2 text-sm border border-gray-300 transition-colors ${\r\n              view === 'month' ? 'bg-blue-600 text-white border-blue-700' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'\r\n            }`}\r\n          >\r\n            {dict?.components?.bookingCalendar?.month || 'Month'}\r\n          </button>\r\n          <button\r\n            onClick={() => setView('week')}\r\n            className={`px-4 py-2 text-sm border border-gray-300 transition-colors ${\r\n              view === 'week' ? 'bg-blue-600 text-white border-blue-700' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'\r\n            }`}\r\n          >\r\n            {dict?.components?.bookingCalendar?.week || 'Week'}\r\n          </button>\r\n          <button\r\n            onClick={() => setView('day')}\r\n            className={`px-4 py-2 text-sm border border-gray-300 transition-colors ${\r\n              view === 'day' ? 'bg-blue-600 text-white border-blue-700' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'\r\n            }`}\r\n          >\r\n            {dict?.components?.bookingCalendar?.day || 'Day'}\r\n          </button>\r\n        </div>\r\n      </div>\r\n\r\n      {view === 'month' && (\r\n        <div className=\"grid grid-cols-7 gap-2\">\r\n          {/* Day headers */}\r\n          {dayNames.map((day) => (\r\n            <div key={day} className=\"text-center font-semibold text-gray-700 py-2\">\r\n              {day}\r\n            </div>\r\n          ))}\r\n\r\n          {/* Calendar days */}\r\n          {days.map((date, index) => {\r\n            const dayBookings = getBookingsForDate(date);\r\n            const isToday = date && date.toDateString() === today.toDateString();\r\n            const isSelected = date && selectedDate && date.toDateString() === selectedDate.toDateString();\r\n\r\n            return (\r\n              <div\r\n                key={index}\r\n                onClick={() => {\r\n                  if (date && onDateSelect) {\r\n                    onDateSelect(date);\r\n                  }\r\n                }}\r\n                className={`min-h-[100px] p-2 border border-gray-300 cursor-pointer transition-colors ${\r\n                  !date ? 'bg-gray-50' :\r\n                  isToday ? 'bg-blue-50 border-blue-300' :\r\n                  isSelected ? 'bg-blue-100 border-blue-400' :\r\n                  'bg-white border-gray-200 hover:bg-gray-50'\r\n                }`}\r\n              >\r\n                {date && (\r\n                  <>\r\n                    <div className={`text-sm font-semibold mb-1 ${\r\n                      isToday ? 'text-blue-600' : 'text-gray-900'\r\n                    }`}>\r\n                      {date.getDate()}\r\n                    </div>\r\n                    <div className=\"space-y-1\">\r\n                      {dayBookings.slice(0, 3).map((booking) => (\r\n                        <div\r\n                          key={booking._id}\r\n                          onClick={(e) => {\r\n                            e.stopPropagation();\r\n                            if (onBookingSelect) {\r\n                              onBookingSelect(booking);\r\n                            }\r\n                          }}\r\n                          className={`text-xs p-1 border ${getStatusColor(booking.status)} truncate`}\r\n                          title={`${formatTime(booking.startTime)} - ${booking.customerName}: ${booking.serviceName}`}\r\n                        >\r\n                          {formatTime(booking.startTime)} {booking.customerName}\r\n                        </div>\r\n                      ))}\r\n                      {dayBookings.length > 3 && (\r\n                        <div className=\"text-xs text-gray-500 font-medium\">\r\n                          {(dict?.components?.bookingCalendar?.more || '+{count} more').replace('{count}', (dayBookings.length - 3).toString())}\r\n                        </div>\r\n                      )}\r\n                    </div>\r\n                  </>\r\n                )}\r\n              </div>\r\n            );\r\n          })}\r\n        </div>\r\n      )}\r\n\r\n      {view === 'week' && (\r\n        <div className=\"space-y-4\">\r\n          <p className=\"text-gray-600\">{dict?.components?.bookingCalendar?.weekViewComingSoon || 'Week view coming soon...'}</p>\r\n        </div>\r\n      )}\r\n\r\n      {view === 'day' && (\r\n        <div className=\"space-y-4\">\r\n          <p className=\"text-gray-600\">{dict?.components?.bookingCalendar?.dayViewComingSoon || 'Day view coming soon...'}</p>\r\n        </div>\r\n      )}\r\n\r\n      {/* Legend */}\r\n      <div className=\"mt-6 pt-6 border-t border-gray-200\">\r\n        <div className=\"flex flex-wrap gap-4 text-sm\">\r\n          <div className=\"flex items-center gap-2\">\r\n            <div className=\"w-4 h-4 bg-green-100 border border-green-300\"></div>\r\n            <span>{dict?.components?.bookingCalendar?.confirmed || 'Confirmed'}</span>\r\n          </div>\r\n          <div className=\"flex items-center gap-2\">\r\n            <div className=\"w-4 h-4 bg-yellow-100 border border-yellow-300\"></div>\r\n            <span>{dict?.components?.bookingCalendar?.pending || 'Pending'}</span>\r\n          </div>\r\n          <div className=\"flex items-center gap-2\">\r\n            <div className=\"w-4 h-4 bg-blue-100 border border-blue-300\"></div>\r\n            <span>{dict?.components?.bookingCalendar?.completed || 'Completed'}</span>\r\n          </div>\r\n          <div className=\"flex items-center gap-2\">\r\n            <div className=\"w-4 h-4 bg-red-100 border border-red-300\"></div>\r\n            <span>{dict?.components?.bookingCalendar?.cancelled || 'Cancelled'}</span>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\components\\BundlePerformanceCharts.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'formatCurrency' is defined but never used. Allowed unused vars must match /^_/u.","line":5,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":24},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":22,"column":9,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":22,"endColumn":12,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[725,728],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[725,728],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":191,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":191,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7348,7351],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7348,7351],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { BarChart, Bar, PieChart, Pie, Cell, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer } from 'recharts';\r\nimport { useTenantSettings } from '@/contexts/TenantSettingsContext';\r\nimport { formatCurrency, formatNumber, getCurrencySymbol, getDefaultTenantSettings } from '@/lib/currency';\r\nimport Currency from '@/components/Currency';\r\n\r\ninterface BundleAnalytics {\r\n  bundleId: string;\r\n  bundleName: string;\r\n  bundlePrice: number;\r\n  totalSales: number;\r\n  totalQuantity: number;\r\n  transactionCount: number;\r\n  averageOrderValue: number;\r\n  averageQuantity: number;\r\n  revenuePerUnit: number;\r\n}\r\n\r\ninterface BundlePerformanceChartsProps {\r\n  analytics: BundleAnalytics[];\r\n  dict: any;\r\n}\r\n\r\nconst DEFAULT_COLORS = ['#3b82f6', '#10b981', '#f59e0b', '#ef4444', '#8b5cf6', '#ec4899', '#06b6d4', '#84cc16'];\r\n\r\nconst CustomTooltip = ({ active, payload, label }: { active?: boolean; payload?: Array<{ color: string; name: string; value: number; payload: { fullName: string } }>; label?: string }) => {\r\n  if (active && payload && payload.length) {\r\n    return (\r\n      <div className=\"bg-white border border-gray-300 rounded-lg p-3 shadow-lg\">\r\n        <p className=\"font-semibold text-gray-900 mb-2\">{label || payload[0].payload.fullName}</p>\r\n        {payload.map((entry, index: number) => (\r\n          <p key={index} className=\"text-sm\" style={{ color: entry.color }}>\r\n            {entry.name}: <Currency amount={entry.value} />\r\n          </p>\r\n        ))}\r\n      </div>\r\n    );\r\n  }\r\n  return null;\r\n};\r\n\r\nexport default function BundlePerformanceCharts({ analytics, dict }: BundlePerformanceChartsProps) {\r\n  const { settings } = useTenantSettings();\r\n  const tenantSettings = settings || getDefaultTenantSettings();\r\n  const primaryColor = tenantSettings.primaryColor || '#3b82f6';\r\n  const COLORS = [primaryColor, ...DEFAULT_COLORS.filter(c => c !== primaryColor)].slice(0, 8);\r\n\r\n  // Prepare data for charts - limit to top 10 for readability\r\n  const topBundles = analytics.slice(0, 10);\r\n\r\n  // Bar chart data for sales by bundle\r\n  const salesData = topBundles.map(bundle => ({\r\n    name: bundle.bundleName.length > 15 ? bundle.bundleName.substring(0, 15) + '...' : bundle.bundleName,\r\n    fullName: bundle.bundleName,\r\n    sales: bundle.totalSales,\r\n    quantity: bundle.totalQuantity,\r\n    transactions: bundle.transactionCount,\r\n  }));\r\n\r\n  // Pie chart data for sales distribution (top 8 + others)\r\n  const pieData = analytics.slice(0, 8).map(bundle => ({\r\n    name: bundle.bundleName.length > 20 ? bundle.bundleName.substring(0, 20) + '...' : bundle.bundleName,\r\n    fullName: bundle.bundleName,\r\n    value: bundle.totalSales,\r\n  }));\r\n\r\n  // Add \"Others\" if there are more than 8 bundles\r\n  if (analytics.length > 8) {\r\n    const othersSales = analytics.slice(8).reduce((sum, bundle) => sum + bundle.totalSales, 0);\r\n    pieData.push({\r\n      name: dict.admin?.others || 'Others',\r\n      fullName: dict.admin?.others || 'Others',\r\n      value: othersSales,\r\n    });\r\n  }\r\n\r\n  // Format currency for Y-axis\r\n  const formatYAxisValue = (value: number) => {\r\n    const rounded = Math.round(value);\r\n    const numberFormat = {\r\n      ...tenantSettings.numberFormat,\r\n      decimalPlaces: 0,\r\n    };\r\n    const formatted = formatNumber(rounded, numberFormat);\r\n    const symbol = tenantSettings.currencySymbol || getCurrencySymbol(tenantSettings.currency);\r\n    if (tenantSettings.currencyPosition === 'after') {\r\n      return `${formatted} ${symbol}`;\r\n    }\r\n    return `${symbol}${formatted}`;\r\n  };\r\n\r\n\r\n  if (!analytics || analytics.length === 0) {\r\n    return null;\r\n  }\r\n\r\n  return (\r\n    <div className=\"space-y-6 mb-6\">\r\n      {/* Sales by Bundle - Bar Chart */}\r\n      <div className=\"bg-gray-50 border border-gray-200 p-4 rounded-lg\">\r\n        <h3 className=\"text-lg font-semibold text-gray-900 mb-4\">\r\n          {dict.admin?.salesByBundle || 'Sales by Bundle'}\r\n        </h3>\r\n        <ResponsiveContainer width=\"100%\" height={350}>\r\n          <BarChart data={salesData} margin={{ top: 20, right: 30, left: 20, bottom: 80 }}>\r\n            <CartesianGrid strokeDasharray=\"3 3\" stroke=\"#e5e7eb\" />\r\n            <XAxis\r\n              dataKey=\"name\"\r\n              angle={-45}\r\n              textAnchor=\"end\"\r\n              height={100}\r\n              stroke=\"#6b7280\"\r\n              style={{ fontSize: '12px' }}\r\n            />\r\n            <YAxis\r\n              stroke=\"#6b7280\"\r\n              style={{ fontSize: '12px' }}\r\n              tickFormatter={formatYAxisValue}\r\n            />\r\n            <Tooltip content={<CustomTooltip />} />\r\n            <Legend />\r\n            <Bar dataKey=\"sales\" fill={primaryColor} name={dict.admin?.totalSales || 'Total Sales'} />\r\n          </BarChart>\r\n        </ResponsiveContainer>\r\n      </div>\r\n\r\n      {/* Quantity Sold by Bundle - Bar Chart */}\r\n      <div className=\"bg-gray-50 border border-gray-200 p-4 rounded-lg\">\r\n        <h3 className=\"text-lg font-semibold text-gray-900 mb-4\">\r\n          {dict.admin?.quantityByBundle || 'Quantity Sold by Bundle'}\r\n        </h3>\r\n        <ResponsiveContainer width=\"100%\" height={350}>\r\n          <BarChart data={salesData} margin={{ top: 20, right: 30, left: 20, bottom: 80 }}>\r\n            <CartesianGrid strokeDasharray=\"3 3\" stroke=\"#e5e7eb\" />\r\n            <XAxis\r\n              dataKey=\"name\"\r\n              angle={-45}\r\n              textAnchor=\"end\"\r\n              height={100}\r\n              stroke=\"#6b7280\"\r\n              style={{ fontSize: '12px' }}\r\n            />\r\n            <YAxis\r\n              stroke=\"#6b7280\"\r\n              style={{ fontSize: '12px' }}\r\n            />\r\n            <Tooltip\r\n              contentStyle={{\r\n                backgroundColor: '#fff',\r\n                border: '1px solid #e5e7eb',\r\n                borderRadius: '8px',\r\n                boxShadow: '0 4px 6px -1px rgba(0, 0, 0, 0.1)',\r\n              }}\r\n            />\r\n            <Legend />\r\n            <Bar dataKey=\"quantity\" fill=\"#10b981\" name={dict.admin?.quantity || 'Quantity'} />\r\n          </BarChart>\r\n        </ResponsiveContainer>\r\n      </div>\r\n\r\n      {/* Sales Distribution - Pie Chart */}\r\n      {pieData.length > 0 && (\r\n        <div className=\"bg-gray-50 border border-gray-200 p-4 rounded-lg\">\r\n          <h3 className=\"text-lg font-semibold text-gray-900 mb-4\">\r\n            {dict.admin?.salesDistribution || 'Sales Distribution'}\r\n          </h3>\r\n          <ResponsiveContainer width=\"100%\" height={400}>\r\n            <PieChart>\r\n              <Pie\r\n                data={pieData}\r\n                cx=\"50%\"\r\n                cy=\"50%\"\r\n                labelLine={false}\r\n                label={({ name, percent }) => `${name} ${((percent || 0) * 100).toFixed(0)}%`}\r\n                outerRadius={120}\r\n                fill=\"#8884d8\"\r\n                dataKey=\"value\"\r\n              >\r\n                {pieData.map((entry, index) => (\r\n                  <Cell key={`cell-${index}`} fill={COLORS[index % COLORS.length]} />\r\n                ))}\r\n              </Pie>\r\n              <Tooltip\r\n                contentStyle={{\r\n                  backgroundColor: '#fff',\r\n                  border: '1px solid #e5e7eb',\r\n                  borderRadius: '8px',\r\n                  boxShadow: '0 4px 6px -1px rgba(0, 0, 0, 0.1)',\r\n                }}\r\n                formatter={(value: any) => <Currency amount={value} />}\r\n              />\r\n              <Legend />\r\n            </PieChart>\r\n          </ResponsiveContainer>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\components\\ConfirmDialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\components\\Currency.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\components\\ErrorBoundary.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useParams' is defined but never used. Allowed unused vars must match /^_/u.","line":4,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":19},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":15,"column":9,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":15,"endColumn":12,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[358,361],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[358,361],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React, { Component, ErrorInfo, ReactNode } from 'react';\r\nimport { useParams } from 'next/navigation';\r\nimport { getDictionaryClient } from '@/app/[tenant]/[lang]/dictionaries-client';\r\n\r\ninterface Props {\r\n  children: ReactNode;\r\n  fallback?: ReactNode;\r\n}\r\n\r\ninterface State {\r\n  hasError: boolean;\r\n  error: Error | null;\r\n  dict: any;\r\n}\r\n\r\nexport default class ErrorBoundary extends Component<Props, State> {\r\n  constructor(props: Props) {\r\n    super(props);\r\n    this.state = { hasError: false, error: null, dict: null };\r\n  }\r\n\r\n  async componentDidMount() {\r\n    try {\r\n      const params = new URLSearchParams(window.location.search);\r\n      const lang = params.get('lang') || 'en';\r\n      const dict = await getDictionaryClient(lang as 'en' | 'es');\r\n      this.setState({ dict });\r\n    } catch (error) {\r\n      console.error('Failed to load dictionary:', error);\r\n    }\r\n  }\r\n\r\n  static getDerivedStateFromError(error: Error): Partial<State> {\r\n    return { hasError: true, error };\r\n  }\r\n\r\n  componentDidCatch(error: Error, errorInfo: ErrorInfo) {\r\n    // Log error to console in development\r\n    if (process.env.NODE_ENV === 'development') {\r\n      console.error('ErrorBoundary caught an error:', error, errorInfo);\r\n    }\r\n    // In production, you could send this to an error reporting service\r\n  }\r\n\r\n  handleReset = () => {\r\n    this.setState({ hasError: false, error: null });\r\n  };\r\n\r\n  render() {\r\n    if (this.state.hasError) {\r\n      if (this.props.fallback) {\r\n        return this.props.fallback;\r\n      }\r\n\r\n      return (\r\n        <div className=\"min-h-screen flex items-center justify-center px-4 py-12\">\r\n          <div className=\"max-w-md w-full bg-white border-2 border-red-300 p-6 sm:p-8 text-center\">\r\n            <div className=\"mb-6\">\r\n              <svg\r\n                className=\"mx-auto h-16 w-16 text-red-400\"\r\n                fill=\"none\"\r\n                viewBox=\"0 0 24 24\"\r\n                stroke=\"currentColor\"\r\n              >\r\n                <path\r\n                  strokeLinecap=\"round\"\r\n                  strokeLinejoin=\"round\"\r\n                  strokeWidth={2}\r\n                  d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z\"\r\n                />\r\n              </svg>\r\n            </div>\r\n            <h1 className=\"text-xl sm:text-2xl font-bold text-gray-900 mb-2\">\r\n              {this.state.dict?.components?.errorBoundary?.somethingWentWrong || this.state.dict?.common?.somethingWentWrong || 'Something went wrong'}\r\n            </h1>\r\n            <p className=\"text-gray-600 mb-6 text-sm sm:text-base\">\r\n              {this.state.error?.message || (this.state.dict?.components?.errorBoundary?.unexpectedError || this.state.dict?.common?.unexpectedError || 'An unexpected error occurred. Please try again.')}\r\n            </p>\r\n            <div className=\"space-y-3\">\r\n              <button\r\n                onClick={this.handleReset}\r\n                className=\"w-full bg-blue-600 text-white px-4 py-2.5 sm:py-3 rounded-md hover:bg-blue-700 font-medium transition-colors text-sm sm:text-base\"\r\n              >\r\n                {this.state.dict?.components?.errorBoundary?.tryAgain || this.state.dict?.common?.tryAgain || 'Try Again'}\r\n              </button>\r\n              <button\r\n                onClick={() => window.location.reload()}\r\n                className=\"w-full bg-gray-100 text-gray-700 px-4 py-2.5 sm:py-3 rounded-md hover:bg-gray-200 font-medium transition-colors text-sm sm:text-base\"\r\n              >\r\n                {this.state.dict?.components?.errorBoundary?.reloadPage || this.state.dict?.common?.reloadPage || 'Reload Page'}\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      );\r\n    }\r\n\r\n    return this.props.children;\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\components\\FormattedDate.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'formatTime' is defined but never used. Allowed unused vars must match /^_/u.","line":4,"column":22,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":32}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useTenantSettings } from '@/contexts/TenantSettingsContext';\r\nimport { formatDate, formatTime, formatDateTime } from '@/lib/formatting';\r\nimport { getDefaultTenantSettings } from '@/lib/currency';\r\n\r\ninterface FormattedDateProps {\r\n  date: Date | string;\r\n  includeTime?: boolean;\r\n  className?: string;\r\n}\r\n\r\n/**\r\n * Component to display date/time formatted according to tenant settings\r\n */\r\nexport default function FormattedDate({ date, includeTime = false, className = '' }: FormattedDateProps) {\r\n  const { settings } = useTenantSettings();\r\n  const tenantSettings = settings || getDefaultTenantSettings();\r\n  \r\n  const formatted = includeTime \r\n    ? formatDateTime(date, tenantSettings)\r\n    : formatDate(date, tenantSettings);\r\n\r\n  return <span className={className}>{formatted}</span>;\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\components\\HardwareSettings.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":25,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":25,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[804,807],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[804,807],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'externalConfig' and 'loadConfig'. Either include them or remove the dependency array.","line":48,"column":6,"nodeType":"ArrayExpression","endLine":48,"endColumn":14,"suggestions":[{"desc":"Update the dependencies array to be: [externalConfig, loadConfig, tenant]","fix":{"range":[1675,1683],"text":"[externalConfig, loadConfig, tenant]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":180,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":180,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6561,6564],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6561,6564],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport { hardwareService, HardwareConfig, PrinterConfig } from '@/lib/hardware';\r\nimport { useParams } from 'next/navigation';\r\nimport { getDictionaryClient } from '@/app/[tenant]/[lang]/dictionaries-client';\r\nimport { showToast } from '@/lib/toast';\r\n\r\ninterface HardwareSettingsProps {\r\n  onClose?: () => void;\r\n  hideSaveButton?: boolean;\r\n  config?: HardwareConfig;\r\n  onChange?: (config: HardwareConfig) => void;\r\n}\r\n\r\nexport default function HardwareSettings({ \r\n  onClose, \r\n  hideSaveButton = false,\r\n  config: externalConfig,\r\n  onChange\r\n}: HardwareSettingsProps) {\r\n  const params = useParams();\r\n  const tenant = params.tenant as string;\r\n  const lang = (params?.lang as 'en' | 'es') || 'en';\r\n  const [dict, setDict] = useState<any>(null);\r\n  const [internalConfig, setInternalConfig] = useState<HardwareConfig>({});\r\n  const [loading, setLoading] = useState(false);\r\n  const [devices, setDevices] = useState<{\r\n    printers: Array<{ name: string; type: string }>;\r\n    cameras: Array<{ deviceId: string; label: string }>;\r\n  }>({ printers: [], cameras: [] });\r\n  const [testing, setTesting] = useState<string | null>(null);\r\n\r\n  useEffect(() => {\r\n    getDictionaryClient(lang).then(setDict);\r\n  }, [lang]);\r\n\r\n  // Use external config if provided, otherwise use internal state\r\n  const config = externalConfig !== undefined ? externalConfig : internalConfig;\r\n  const setConfig = onChange || setInternalConfig;\r\n\r\n  useEffect(() => {\r\n    if (externalConfig === undefined) {\r\n      // Only load from localStorage if not controlled by parent\r\n      loadConfig();\r\n    }\r\n    detectDevices();\r\n  }, [tenant]);\r\n\r\n  const loadConfig = () => {\r\n    const hardwareConfigKey = `hardware_config_${tenant}`;\r\n    const savedConfig = localStorage.getItem(hardwareConfigKey);\r\n    if (savedConfig) {\r\n      try {\r\n        const parsed = JSON.parse(savedConfig);\r\n        setInternalConfig(parsed);\r\n        hardwareService.setConfig(parsed);\r\n      } catch (error) {\r\n        console.error('Failed to load hardware config:', error);\r\n      }\r\n    }\r\n  };\r\n\r\n  const saveConfig = async () => {\r\n    setLoading(true);\r\n    try {\r\n      const hardwareConfigKey = `hardware_config_${tenant}`;\r\n      localStorage.setItem(hardwareConfigKey, JSON.stringify(config));\r\n      await hardwareService.setConfig(config);\r\n      showToast.success(dict?.common?.hardwareSettingsSaved || 'Hardware settings saved successfully!');\r\n      if (onClose) onClose();\r\n    } catch (error) {\r\n      console.error('Failed to save hardware config:', error);\r\n      showToast.error(dict?.common?.failedToSaveHardwareSettings || 'Failed to save hardware settings');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const updateConfig = (updates: Partial<HardwareConfig>) => {\r\n    const newConfig = { ...config, ...updates };\r\n    setConfig(newConfig);\r\n    // Also update hardware service immediately for testing\r\n    hardwareService.setConfig(newConfig);\r\n  };\r\n\r\n  const detectDevices = async () => {\r\n    try {\r\n      const detected = await hardwareService.detectDevices();\r\n      setDevices(detected);\r\n    } catch (error) {\r\n      console.error('Failed to detect devices:', error);\r\n    }\r\n  };\r\n\r\n  const testPrinter = async () => {\r\n    if (!config.printer) {\r\n      showToast.error(dict?.common?.configurePrinterFirst || 'Please configure a printer first');\r\n      return;\r\n    }\r\n\r\n    setTesting('printer');\r\n    try {\r\n      const testReceipt = {\r\n        storeName: 'Test Store',\r\n        receiptNumber: 'TEST-001',\r\n        date: new Date().toLocaleString(),\r\n        items: [\r\n          { name: 'Test Item', quantity: 1, price: 10.00, subtotal: 10.00 },\r\n        ],\r\n        subtotal: 10.00,\r\n        total: 10.00,\r\n        paymentMethod: 'cash',\r\n        cashReceived: 20.00,\r\n        change: 10.00,\r\n        footer: 'This is a test receipt',\r\n      };\r\n\r\n      const success = await hardwareService.printReceipt(testReceipt);\r\n      if (success) {\r\n        showToast.success(dict?.common?.testReceiptSent || 'Test receipt sent successfully!');\r\n      } else {\r\n        showToast.error(dict?.common?.failedToPrintTestReceipt || 'Failed to print test receipt');\r\n      }\r\n    } catch (error) {\r\n      console.error('Print test error:', error);\r\n      showToast.error(dict?.common?.failedToPrintTestReceipt || 'Failed to print test receipt');\r\n    } finally {\r\n      setTesting(null);\r\n    }\r\n  };\r\n\r\n  const testCashDrawer = async () => {\r\n    setTesting('drawer');\r\n    try {\r\n      const success = await hardwareService.openCashDrawer();\r\n      if (success) {\r\n        showToast.success(dict?.common?.cashDrawerOpened || 'Cash drawer opened!');\r\n      } else {\r\n        showToast.error(dict?.common?.failedToOpenCashDrawer || 'Failed to open cash drawer. Make sure it is connected to the printer.');\r\n      }\r\n    } catch (error) {\r\n      console.error('Cash drawer test error:', error);\r\n      showToast.error(dict?.common?.failedToOpenCashDrawerShort || 'Failed to open cash drawer');\r\n    } finally {\r\n      setTesting(null);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"bg-white border border-gray-300 p-6\">\r\n      <div className=\"flex justify-between items-center mb-6\">\r\n        <h2 className=\"text-2xl font-bold text-gray-900\">{dict?.components?.hardwareSettings?.title || 'Hardware Settings'}</h2>\r\n        {onClose && (\r\n          <button\r\n            onClick={onClose}\r\n            className=\"text-gray-500 hover:text-gray-700\"\r\n          >\r\n            <svg className=\"w-6 h-6\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\r\n            </svg>\r\n          </button>\r\n        )}\r\n      </div>\r\n\r\n      <div className=\"space-y-6\">\r\n        {/* Receipt Printer */}\r\n        <div className=\"border-b border-gray-200 pb-6\">\r\n          <h3 className=\"text-lg font-semibold text-gray-900 mb-4\">{dict?.components?.hardwareSettings?.receiptPrinter || 'Receipt Printer'}</h3>\r\n          <div className=\"space-y-4\">\r\n            <div>\r\n              <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                {dict?.components?.hardwareSettings?.printerType || 'Printer Type'}\r\n              </label>\r\n              <select\r\n                value={config.printer?.type || 'browser'}\r\n                onChange={(e) => updateConfig({\r\n                  printer: {\r\n                    ...config.printer,\r\n                    type: e.target.value as any,\r\n                  } as PrinterConfig,\r\n                })}\r\n                className=\"w-full px-4 py-2 border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white\"\r\n              >\r\n                <option value=\"browser\">{dict?.components?.hardwareSettings?.browserPrint || 'Browser Print'}</option>\r\n                <option value=\"usb\">{dict?.components?.hardwareSettings?.usbPrinter || 'USB Printer'}</option>\r\n                <option value=\"serial\">{dict?.components?.hardwareSettings?.serialPrinter || 'Serial Printer'}</option>\r\n                <option value=\"network\">{dict?.components?.hardwareSettings?.networkPrinter || 'Network Printer'}</option>\r\n              </select>\r\n            </div>\r\n\r\n            {config.printer?.type === 'network' && (\r\n              <>\r\n                <div>\r\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                    {dict?.components?.hardwareSettings?.ipAddress || 'IP Address'}\r\n                  </label>\r\n                  <input\r\n                    type=\"text\"\r\n                    value={config.printer?.ipAddress || ''}\r\n                    onChange={(e) => updateConfig({\r\n                      printer: {\r\n                        ...config.printer,\r\n                        ipAddress: e.target.value,\r\n                      } as PrinterConfig,\r\n                    })}\r\n                    placeholder=\"192.168.1.100\"\r\n                    className=\"w-full px-4 py-2 border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white\"\r\n                  />\r\n                </div>\r\n                <div>\r\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                    {dict?.components?.hardwareSettings?.port || 'Port'}\r\n                  </label>\r\n                  <input\r\n                    type=\"number\"\r\n                    value={config.printer?.portNumber || 9100}\r\n                    onChange={(e) => updateConfig({\r\n                      printer: {\r\n                        ...config.printer,\r\n                        portNumber: parseInt(e.target.value),\r\n                      } as PrinterConfig,\r\n                    })}\r\n                    className=\"w-full px-4 py-2 border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white\"\r\n                  />\r\n                </div>\r\n              </>\r\n            )}\r\n\r\n            <button\r\n              onClick={testPrinter}\r\n              disabled={testing === 'printer'}\r\n              className=\"px-4 py-2 bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-50 border border-blue-700\"\r\n            >\r\n              {testing === 'printer' ? (dict?.components?.hardwareSettings?.testing || 'Testing...') : (dict?.components?.hardwareSettings?.testPrint || 'Test Print')}\r\n            </button>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Cash Drawer */}\r\n        <div className=\"border-b border-gray-200 pb-6\">\r\n          <h3 className=\"text-lg font-semibold text-gray-900 mb-4\">{dict?.components?.hardwareSettings?.cashDrawer || 'Cash Drawer'}</h3>\r\n          <div className=\"space-y-4\">\r\n            <label className=\"flex items-center\">\r\n              <input\r\n                type=\"checkbox\"\r\n                checked={config.cashDrawer?.enabled || false}\r\n                onChange={(e) => updateConfig({\r\n                  cashDrawer: {\r\n                    enabled: e.target.checked,\r\n                    connectedToPrinter: config.cashDrawer?.connectedToPrinter || false,\r\n                  },\r\n                })}\r\n                className=\"mr-2\"\r\n              />\r\n              <span className=\"text-sm text-gray-700\">{dict?.components?.hardwareSettings?.enableCashDrawer || 'Enable Cash Drawer'}</span>\r\n            </label>\r\n            {config.cashDrawer?.enabled && (\r\n              <label className=\"flex items-center\">\r\n                <input\r\n                  type=\"checkbox\"\r\n                  checked={config.cashDrawer?.connectedToPrinter || false}\r\n                  onChange={(e) => updateConfig({\r\n                    cashDrawer: {\r\n                      enabled: config.cashDrawer?.enabled ?? false,\r\n                      connectedToPrinter: e.target.checked,\r\n                    },\r\n                  })}\r\n                  className=\"mr-2\"\r\n                />\r\n                <span className=\"text-sm text-gray-700\">{dict?.components?.hardwareSettings?.connectedToPrinter || 'Connected to Printer'}</span>\r\n              </label>\r\n            )}\r\n            {config.cashDrawer?.enabled && (\r\n              <button\r\n                onClick={testCashDrawer}\r\n                disabled={testing === 'drawer'}\r\n                className=\"px-4 py-2 bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-50 border border-blue-700\"\r\n              >\r\n                {testing === 'drawer' ? (dict?.components?.hardwareSettings?.testing || 'Testing...') : (dict?.components?.hardwareSettings?.testCashDrawer || 'Test Cash Drawer')}\r\n              </button>\r\n            )}\r\n          </div>\r\n        </div>\r\n\r\n        {/* Barcode Scanner */}\r\n        <div className=\"border-b border-gray-200 pb-6\">\r\n          <h3 className=\"text-lg font-semibold text-gray-900 mb-4\">{dict?.components?.hardwareSettings?.barcodeScanner || 'Barcode Scanner'}</h3>\r\n          <div className=\"space-y-4\">\r\n            <label className=\"flex items-center\">\r\n              <input\r\n                type=\"checkbox\"\r\n                checked={config.barcodeScanner?.enabled || false}\r\n                onChange={(e) => updateConfig({\r\n                  barcodeScanner: {\r\n                    type: 'keyboard',\r\n                    enabled: e.target.checked,\r\n                  },\r\n                })}\r\n                className=\"mr-2\"\r\n              />\r\n              <span className=\"text-sm text-gray-700\">{dict?.components?.hardwareSettings?.enableBarcodeScanner || 'Enable Barcode Scanner (Keyboard Input)'}</span>\r\n            </label>\r\n            <p className=\"text-xs text-gray-500\">\r\n              {dict?.components?.hardwareSettings?.barcodeScannerHint || 'Most USB barcode scanners work as keyboard input. Just scan a barcode to add products to cart.'}\r\n            </p>\r\n          </div>\r\n        </div>\r\n\r\n        {/* QR Code Reader */}\r\n        <div className=\"border-b border-gray-200 pb-6\">\r\n          <h3 className=\"text-lg font-semibold text-gray-900 mb-4\">{dict?.components?.hardwareSettings?.qrCodeReader || 'QR Code Reader'}</h3>\r\n          <div className=\"space-y-4\">\r\n            <label className=\"flex items-center\">\r\n              <input\r\n                type=\"checkbox\"\r\n                checked={config.qrReader?.enabled || false}\r\n                onChange={(e) => updateConfig({\r\n                  qrReader: {\r\n                    enabled: e.target.checked,\r\n                    cameraId: config.qrReader?.cameraId,\r\n                  },\r\n                })}\r\n                className=\"mr-2\"\r\n              />\r\n              <span className=\"text-sm text-gray-700\">{dict?.components?.hardwareSettings?.enableQRCodeReader || 'Enable QR Code Reader'}</span>\r\n            </label>\r\n            {config.qrReader?.enabled && devices.cameras.length > 0 && (\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                  {dict?.components?.hardwareSettings?.camera || 'Camera'}\r\n                </label>\r\n                <select\r\n                  value={config.qrReader?.cameraId || ''}\r\n                  onChange={(e) => updateConfig({\r\n                    qrReader: {\r\n                      enabled: config.qrReader?.enabled ?? false,\r\n                      cameraId: e.target.value,\r\n                    },\r\n                  })}\r\n                  className=\"w-full px-4 py-2 border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white\"\r\n                >\r\n                  <option value=\"\">{dict?.components?.hardwareSettings?.defaultCamera || 'Default Camera'}</option>\r\n                  {devices.cameras.map((camera) => (\r\n                    <option key={camera.deviceId} value={camera.deviceId}>\r\n                      {camera.label}\r\n                    </option>\r\n                  ))}\r\n                </select>\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n\r\n        {/* Touchscreen */}\r\n        <div>\r\n          <h3 className=\"text-lg font-semibold text-gray-900 mb-4\">{dict?.components?.hardwareSettings?.touchscreenDisplay || 'Touchscreen Display'}</h3>\r\n          <div className=\"space-y-4\">\r\n            <label className=\"flex items-center\">\r\n              <input\r\n                type=\"checkbox\"\r\n                checked={config.touchscreen?.enabled || false}\r\n                onChange={(e) => updateConfig({\r\n                  touchscreen: {\r\n                    enabled: e.target.checked,\r\n                  },\r\n                })}\r\n                className=\"mr-2\"\r\n              />\r\n              <span className=\"text-sm text-gray-700\">{dict?.components?.hardwareSettings?.enableTouchscreenOptimizations || 'Enable Touchscreen Optimizations'}</span>\r\n            </label>\r\n            <p className=\"text-xs text-gray-500\">\r\n              {hardwareService.isTouchscreen() \r\n                ? (dict?.components?.hardwareSettings?.touchscreenDetected || 'Touchscreen detected. Optimizations will be applied.')\r\n                : (dict?.components?.hardwareSettings?.noTouchscreenDetected || 'No touchscreen detected. This device may not support touch input.')}\r\n            </p>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {!hideSaveButton && (\r\n        <div className=\"flex justify-end gap-4 mt-6\">\r\n          {onClose && (\r\n            <button\r\n              onClick={onClose}\r\n              className=\"px-4 py-2 border border-gray-300 text-gray-700 hover:bg-gray-50 bg-white\"\r\n            >\r\n              {dict?.common?.cancel || 'Cancel'}\r\n            </button>\r\n          )}\r\n          <button\r\n            onClick={saveConfig}\r\n            disabled={loading}\r\n            className=\"px-4 py-2 bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-50 border border-blue-700\"\r\n          >\r\n            {loading ? (dict?.components?.hardwareSettings?.saving || 'Saving...') : (dict?.components?.hardwareSettings?.saveSettings || 'Save Settings')}\r\n          </button>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\components\\HardwareStatus.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'tenant' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":25,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":25,"endColumn":15},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":27,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":27,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[881,884],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[881,884],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":68,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":68,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2162,2165],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2162,2165],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useEffect, useCallback } from 'react';\r\nimport { hardwareStatusChecker, DeviceStatus, HardwareStatus } from '@/lib/hardware/status-checker';\r\nimport { useParams } from 'next/navigation';\r\nimport { getDictionaryClient } from '@/app/[tenant]/[lang]/dictionaries-client';\r\nimport { showToast } from '@/lib/toast';\r\n\r\ninterface HardwareStatusProps {\r\n  compact?: boolean;\r\n  showActions?: boolean;\r\n  autoRefresh?: boolean;\r\n  refreshInterval?: number;\r\n  sidebar?: boolean;\r\n}\r\n\r\nexport default function HardwareStatusChecker({\r\n  compact = false,\r\n  showActions = true,\r\n  autoRefresh = true,\r\n  refreshInterval = 10000, // 10 seconds\r\n  sidebar = false,\r\n}: HardwareStatusProps) {\r\n  const params = useParams();\r\n  const tenant = params.tenant as string;\r\n  const lang = (params?.lang as 'en' | 'es') || 'en';\r\n  const [dict, setDict] = useState<any>(null);\r\n  const [status, setStatus] = useState<HardwareStatus | null>(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [testing, setTesting] = useState<string | null>(null);\r\n\r\n  useEffect(() => {\r\n    getDictionaryClient(lang).then(setDict);\r\n  }, [lang]);\r\n\r\n  const checkStatus = useCallback(async () => {\r\n    try {\r\n      setLoading(true);\r\n      const currentStatus = await hardwareStatusChecker.checkAllDevices();\r\n      setStatus(currentStatus);\r\n    } catch (error) {\r\n      console.error('Failed to check hardware status:', error);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    checkStatus();\r\n\r\n    if (autoRefresh) {\r\n      const interval = setInterval(checkStatus, refreshInterval);\r\n      return () => clearInterval(interval);\r\n    }\r\n  }, [checkStatus, autoRefresh, refreshInterval]);\r\n\r\n  const testDevice = useCallback(async (deviceType: string) => {\r\n    setTesting(deviceType);\r\n    try {\r\n      const result = await hardwareStatusChecker.testDevice(deviceType);\r\n      if (result.success) {\r\n        showToast.success(result.message);\r\n      } else {\r\n        showToast.error(result.message);\r\n      }\r\n      // Refresh status after test\r\n      setTimeout(checkStatus, 1000);\r\n    } catch (error: any) {\r\n      showToast.error(error.message || dict?.common?.testFailed || 'Test failed');\r\n    } finally {\r\n      setTesting(null);\r\n    }\r\n  }, [checkStatus, dict]);\r\n\r\n  const getStatusColor = (deviceStatus: DeviceStatus) => {\r\n    switch (deviceStatus.status) {\r\n      case 'connected':\r\n      case 'available':\r\n        return 'text-green-600 bg-green-50 border-green-200';\r\n      case 'disconnected':\r\n        return 'text-yellow-600 bg-yellow-50 border-yellow-200';\r\n      case 'error':\r\n        return 'text-red-600 bg-red-50 border-red-200';\r\n      case 'not-configured':\r\n        return 'text-gray-600 bg-gray-50 border-gray-200';\r\n      default:\r\n        return 'text-gray-600 bg-gray-50 border-gray-200';\r\n    }\r\n  };\r\n\r\n  const getStatusIcon = (deviceStatus: DeviceStatus) => {\r\n    switch (deviceStatus.status) {\r\n      case 'connected':\r\n      case 'available':\r\n        return (\r\n          <svg className=\"w-5 h-5 text-green-600\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n          </svg>\r\n        );\r\n      case 'disconnected':\r\n        return (\r\n          <svg className=\"w-5 h-5 text-yellow-600\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z\" />\r\n          </svg>\r\n        );\r\n      case 'error':\r\n        return (\r\n          <svg className=\"w-5 h-5 text-red-600\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n          </svg>\r\n        );\r\n      case 'not-configured':\r\n        return (\r\n          <svg className=\"w-5 h-5 text-gray-600\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636\" />\r\n          </svg>\r\n        );\r\n      default:\r\n        return null;\r\n    }\r\n  };\r\n\r\n  const getOverallStatusColor = () => {\r\n    if (!status) return 'bg-gray-100';\r\n    switch (status.overallStatus) {\r\n      case 'all-connected':\r\n        return 'bg-green-100 text-green-800';\r\n      case 'partial':\r\n        return 'bg-yellow-100 text-yellow-800';\r\n      case 'none':\r\n        return 'bg-red-100 text-red-800';\r\n      default:\r\n        return 'bg-gray-100 text-gray-800';\r\n    }\r\n  };\r\n\r\n  if (compact) {\r\n    return (\r\n      <div className=\"flex items-center gap-2\">\r\n        {loading ? (\r\n          <div className=\"animate-spin h-4 w-4 border-b-2 border-blue-600\"></div>\r\n        ) : status ? (\r\n          <>\r\n            <div className={`px-2 py-1 border border-gray-300 text-xs font-medium ${getOverallStatusColor()}`}>\r\n              {status.overallStatus === 'all-connected' ? (dict?.components?.hardwareStatus?.allConnected || dict?.common?.allConnected || 'All Connected') :\r\n               status.overallStatus === 'partial' ? (dict?.components?.hardwareStatus?.partial || dict?.common?.partial || 'Partial') : (dict?.components?.hardwareStatus?.notConfigured || dict?.common?.notConfigured || 'Not Configured')}\r\n            </div>\r\n            <button\r\n              onClick={checkStatus}\r\n              className=\"text-gray-500 hover:text-gray-700\"\r\n              title={dict?.common?.refreshStatus || 'Refresh status'}\r\n            >\r\n              <svg className=\"w-4 h-4\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15\" />\r\n              </svg>\r\n            </button>\r\n          </>\r\n        ) : null}\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (loading && !status) {\r\n    return (\r\n      <div className={`bg-white border border-gray-300 ${sidebar ? 'p-4' : 'p-6'}`}>\r\n        <div className={`flex items-center justify-center ${sidebar ? 'py-4' : 'py-8'}`}>\r\n          <div className={`animate-spin border-b-2 border-blue-600 ${sidebar ? 'h-6 w-6' : 'h-8 w-8'}`}></div>\r\n          {!sidebar && <span className=\"ml-3 text-gray-600\">{dict?.components?.hardwareStatus?.checkingHardwareStatus || 'Checking hardware status...'}</span>}\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (!status) {\r\n    return (\r\n      <div className={`bg-white border border-gray-300 ${sidebar ? 'p-4' : 'p-6'}`}>\r\n        <p className={`text-gray-600 ${sidebar ? 'text-sm' : ''}`}>\r\n          {sidebar ? (dict?.common?.unableToCheckStatus || 'Unable to check status') : (dict?.common?.unableToCheckHardwareStatus || 'Unable to check hardware status')}\r\n        </p>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (sidebar) {\r\n    return (\r\n      <div className=\"bg-white border border-gray-300 p-4\">\r\n        <div className=\"flex justify-between items-center mb-4\">\r\n          <h3 className=\"text-lg font-bold text-gray-900\">Status</h3>\r\n          <button\r\n            onClick={checkStatus}\r\n            disabled={loading}\r\n            className=\"p-1.5 text-gray-500 hover:text-gray-700 disabled:opacity-50\"\r\n            title={dict?.common?.refreshStatus || 'Refresh status'}\r\n          >\r\n            <svg className={`w-4 h-4 ${loading ? 'animate-spin' : ''}`} fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15\" />\r\n            </svg>\r\n          </button>\r\n        </div>\r\n\r\n        <div className=\"mb-3\">\r\n          <div className={`px-2 py-1 border border-gray-300 text-xs font-medium text-center ${getOverallStatusColor()}`}>\r\n            {status.overallStatus === 'all-connected' ? (dict?.common?.allConnected || 'All Connected') :\r\n             status.overallStatus === 'partial' ? (dict?.common?.partialConnection || 'Partial Connection') : (dict?.common?.notConfigured || 'Not Configured')}\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"space-y-2\">\r\n          {status.devices.map((device, index) => (\r\n            <div\r\n              key={index}\r\n              className={`border border-gray-300 p-2.5 ${getStatusColor(device)}`}\r\n            >\r\n              <div className=\"flex items-center gap-2\">\r\n                <div className=\"flex-shrink-0\">\r\n                  {getStatusIcon(device)}\r\n                </div>\r\n                <div className=\"flex-1 min-w-0\">\r\n                  <div className=\"flex items-center gap-1.5 mb-0.5\">\r\n                    <h4 className=\"text-sm font-semibold text-gray-900 truncate\">{device.name}</h4>\r\n                  </div>\r\n                  <span className={`px-1.5 py-0.5 border border-gray-300 text-xs font-medium ${\r\n                    device.status === 'connected' || device.status === 'available'\r\n                      ? 'bg-green-100 text-green-800'\r\n                      : device.status === 'disconnected'\r\n                      ? 'bg-yellow-100 text-yellow-800'\r\n                      : device.status === 'error'\r\n                      ? 'bg-red-100 text-red-800'\r\n                      : 'bg-gray-100 text-gray-800'\r\n                  }`}>\r\n                    {device.status.replace('-', ' ')}\r\n                  </span>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          ))}\r\n        </div>\r\n\r\n        {status.devices.length === 0 && (\r\n          <div className=\"text-center py-4 text-gray-500 text-sm\">\r\n            <p>{dict?.components?.hardwareStatus?.noDevices || 'No devices'}</p>\r\n          </div>\r\n        )}\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"bg-white border border-gray-300 p-6\">\r\n      <div className=\"flex justify-between items-center mb-6\">\r\n        <div>\r\n          <h2 className=\"text-2xl font-bold text-gray-900\">{dict?.components?.hardwareStatus?.title || 'Hardware Status'}</h2>\r\n          <p className=\"text-sm text-gray-500 mt-1\">\r\n            {(dict?.components?.hardwareStatus?.lastChecked || 'Last checked: {time}').replace('{time}', status.lastCheck.toLocaleTimeString())}\r\n          </p>\r\n        </div>\r\n        <div className=\"flex items-center gap-2\">\r\n          <div className={`px-3 py-1 border border-gray-300 text-sm font-medium ${getOverallStatusColor()}`}>\r\n            {status.overallStatus === 'all-connected' ? (dict?.components?.hardwareStatus?.allConnected || dict?.common?.allConnected || 'All Connected') :\r\n             status.overallStatus === 'partial' ? (dict?.components?.hardwareStatus?.partialConnection || dict?.common?.partialConnection || 'Partial Connection') : (dict?.components?.hardwareStatus?.notConfigured || dict?.common?.notConfigured || 'Not Configured')}\r\n          </div>\r\n          <button\r\n            onClick={checkStatus}\r\n            disabled={loading}\r\n            className=\"p-2 text-gray-500 hover:text-gray-700 disabled:opacity-50\"\r\n            title={dict?.common?.refreshStatus || 'Refresh status'}\r\n          >\r\n            <svg className={`w-5 h-5 ${loading ? 'animate-spin' : ''}`} fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15\" />\r\n            </svg>\r\n          </button>\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"space-y-3\">\r\n        {status.devices.map((device, index) => (\r\n          <div\r\n            key={index}\r\n            className={`border border-gray-300 p-4 ${getStatusColor(device)}`}\r\n          >\r\n            <div className=\"flex items-start justify-between\">\r\n              <div className=\"flex items-start gap-3 flex-1\">\r\n                {getStatusIcon(device)}\r\n                <div className=\"flex-1 min-w-0\">\r\n                  <div className=\"flex items-center gap-2 mb-1\">\r\n                    <h3 className=\"font-semibold text-gray-900\">{device.name}</h3>\r\n                    <span className={`px-2 py-0.5 border border-gray-300 text-xs font-medium ${\r\n                      device.status === 'connected' || device.status === 'available'\r\n                        ? 'bg-green-100 text-green-800'\r\n                        : device.status === 'disconnected'\r\n                        ? 'bg-yellow-100 text-yellow-800'\r\n                        : device.status === 'error'\r\n                        ? 'bg-red-100 text-red-800'\r\n                        : 'bg-gray-100 text-gray-800'\r\n                    }`}>\r\n                      {device.status.replace('-', ' ')}\r\n                    </span>\r\n                  </div>\r\n                  {device.message && (\r\n                    <p className=\"text-sm text-gray-600 mt-1\">{device.message}</p>\r\n                  )}\r\n                </div>\r\n              </div>\r\n              {showActions && (\r\n                <div className=\"flex items-center gap-2 ml-4\">\r\n                  {(device.type === 'printer' || device.type === 'cash-drawer') && (\r\n                    <button\r\n                      onClick={() => testDevice(device.type)}\r\n                      disabled={testing === device.type || device.status === 'not-configured'}\r\n                      className=\"px-3 py-1.5 text-sm bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed border border-blue-700\"\r\n                    >\r\n                      {testing === device.type ? (dict?.components?.hardwareStatus?.testing || 'Testing...') : (dict?.components?.hardwareStatus?.test || 'Test')}\r\n                    </button>\r\n                  )}\r\n                </div>\r\n              )}\r\n            </div>\r\n          </div>\r\n        ))}\r\n      </div>\r\n\r\n      {status.devices.length === 0 && (\r\n        <div className=\"text-center py-8 text-gray-500\">\r\n          <p>{dict?.components?.hardwareStatus?.noHardwareDevicesConfigured || 'No hardware devices configured'}</p>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\components\\LangSetter.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\components\\LowStockAlerts.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Currency' is defined but never used. Allowed unused vars must match /^_/u.","line":6,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":16},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":30,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":30,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[819,822],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[819,822],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":51,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":51,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1513,1516],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1513,1516],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchAlerts'. Either include it or remove the dependency array.","line":65,"column":6,"nodeType":"ArrayExpression","endLine":65,"endColumn":44,"suggestions":[{"desc":"Update the dependencies array to be: [tenant, autoRefresh, refreshInterval, fetchAlerts]","fix":{"range":[1864,1902],"text":"[tenant, autoRefresh, refreshInterval, fetchAlerts]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useEffect, useState } from 'react';\r\nimport { useParams } from 'next/navigation';\r\nimport { getDictionaryClient } from '@/app/[tenant]/[lang]/dictionaries-client';\r\nimport Currency from './Currency';\r\n\r\ninterface LowStockProduct {\r\n  _id: string;\r\n  name: string;\r\n  currentStock: number;\r\n  threshold: number;\r\n  sku?: string;\r\n}\r\n\r\ninterface LowStockAlertsProps {\r\n  autoRefresh?: boolean;\r\n  refreshInterval?: number;\r\n  onProductClick?: (productId: string) => void;\r\n}\r\n\r\nexport default function LowStockAlerts({\r\n  autoRefresh = true,\r\n  refreshInterval = 30000, // 30 seconds\r\n  onProductClick,\r\n}: LowStockAlertsProps) {\r\n  const params = useParams();\r\n  const tenant = params.tenant as string;\r\n  const lang = (params?.lang as 'en' | 'es') || 'en';\r\n  const [dict, setDict] = useState<any>(null);\r\n  const [alerts, setAlerts] = useState<LowStockProduct[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  useEffect(() => {\r\n    getDictionaryClient(lang).then(setDict);\r\n  }, [lang]);\r\n\r\n  const fetchAlerts = async () => {\r\n    try {\r\n      setLoading(true);\r\n      setError(null);\r\n      const res = await fetch(`/api/inventory/low-stock?tenant=${tenant}`);\r\n      const data = await res.json();\r\n      \r\n      if (data.success) {\r\n        setAlerts(data.data || []);\r\n      } else {\r\n        setError(data.error || dict?.common?.failedToFetchAlerts || 'Failed to fetch alerts');\r\n      }\r\n    } catch (err: any) {\r\n      setError(err.message || dict?.common?.errorFetchingAlerts || 'Error fetching alerts');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    fetchAlerts();\r\n\r\n    if (autoRefresh) {\r\n      const interval = setInterval(fetchAlerts, refreshInterval);\r\n      return () => clearInterval(interval);\r\n    }\r\n  }, [tenant, autoRefresh, refreshInterval]);\r\n\r\n  if (loading && alerts.length === 0) {\r\n    return (\r\n      <div className=\"bg-white border border-gray-300 p-4\">\r\n        <div className=\"animate-pulse\">\r\n          <div className=\"h-4 bg-gray-200 w-1/4 mb-4\"></div>\r\n          <div className=\"space-y-2\">\r\n            <div className=\"h-3 bg-gray-200\"></div>\r\n            <div className=\"h-3 bg-gray-200\"></div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (error) {\r\n    return (\r\n      <div className=\"bg-red-50 border border-red-300 p-4\">\r\n        <p className=\"text-red-800 text-sm\">{error}</p>\r\n        <button\r\n          onClick={fetchAlerts}\r\n          className=\"mt-2 text-sm text-red-600 hover:text-red-800 underline\"\r\n        >\r\n          {dict?.components?.lowStockAlerts?.retry || dict?.common?.retry || 'Retry'}\r\n        </button>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (alerts.length === 0) {\r\n    return (\r\n      <div className=\"bg-green-50 border border-green-300 p-4\">\r\n        <p className=\"text-green-800 text-sm font-medium\">\r\n          {dict?.components?.lowStockAlerts?.allProductsWellStocked || ' All products are well stocked'}\r\n        </p>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"bg-white border border-gray-300\">\r\n      <div className=\"p-4 border-b border-gray-200\">\r\n        <div className=\"flex items-center justify-between\">\r\n          <h3 className=\"text-lg font-semibold text-gray-900\">\r\n            {dict?.components?.lowStockAlerts?.title || 'Low Stock Alerts'}\r\n          </h3>\r\n          <span className=\"bg-red-100 text-red-800 text-xs font-semibold px-2.5 py-0.5 border border-red-300\">\r\n            {alerts.length}\r\n          </span>\r\n        </div>\r\n      </div>\r\n      <div className=\"divide-y divide-gray-200 max-h-96 overflow-y-auto\">\r\n        {alerts.map((alert) => (\r\n          <div\r\n            key={alert._id}\r\n            className={`p-4 hover:bg-gray-50 transition-colors ${\r\n              onProductClick ? 'cursor-pointer' : ''\r\n            }`}\r\n            onClick={() => onProductClick?.(alert._id)}\r\n          >\r\n            <div className=\"flex items-start justify-between\">\r\n              <div className=\"flex-1 min-w-0\">\r\n                <p className=\"text-sm font-medium text-gray-900 truncate\">\r\n                  {alert.name}\r\n                </p>\r\n                {alert.sku && (\r\n                  <p className=\"text-xs text-gray-500 mt-1\">SKU: {alert.sku}</p>\r\n                )}\r\n              </div>\r\n              <div className=\"ml-4 flex-shrink-0 text-right\">\r\n                <div\r\n                  className={`inline-flex items-center px-2.5 py-0.5 border border-gray-300 text-xs font-semibold ${\r\n                    alert.currentStock === 0\r\n                      ? 'bg-red-100 text-red-800'\r\n                      : 'bg-yellow-100 text-yellow-800'\r\n                  }`}\r\n                >\r\n                  {alert.currentStock} / {alert.threshold}\r\n                </div>\r\n                <p className=\"text-xs text-gray-500 mt-1\">\r\n                  {alert.currentStock === 0 ? (dict?.common?.outOfStock || 'Out of stock') : (dict?.common?.lowStock || 'Low stock')}\r\n                </p>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        ))}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\components\\Navbar.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":19,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":19,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[833,836],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[833,836],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":93,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":93,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3543,3546],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3543,3546],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport Link from 'next/link';\r\nimport { usePathname, useParams, useRouter } from 'next/navigation';\r\nimport { useState, useEffect } from 'react';\r\nimport { getDictionaryClient } from '@/app/[tenant]/[lang]/dictionaries-client';\r\nimport { useAuth } from '@/contexts/AuthContext';\r\nimport { useTenantSettings } from '@/contexts/TenantSettingsContext';\r\nimport { useSubscription } from '@/contexts/SubscriptionContext';\r\n\r\nexport default function Navbar() {\r\n  const pathname = usePathname();\r\n  const params = useParams();\r\n  const router = useRouter();\r\n  const tenant = (params?.tenant as string) || 'default';\r\n  const lang = params?.lang as 'en' | 'es' || 'en';\r\n  const [drawerOpen, setDrawerOpen] = useState(false);\r\n  const [userMenuOpen, setUserMenuOpen] = useState(false);\r\n  const [dict, setDict] = useState<any>(null);\r\n  const { user, logout, isAuthenticated, hasRole } = useAuth();\r\n  const { settings } = useTenantSettings();\r\n\r\n  // Subscription context may not be available outside admin areas\r\n  let subscriptionStatus = null;\r\n  try {\r\n    const subscriptionContext = useSubscription();\r\n    subscriptionStatus = subscriptionContext.subscriptionStatus;\r\n  } catch (error) {\r\n    // SubscriptionProvider not available, subscriptionStatus remains null\r\n  }\r\n\r\n  const primaryColor = settings?.primaryColor || '#2563eb';\r\n  const isAdmin = user && (user.role === 'admin' || hasRole(['admin']));\r\n\r\n  useEffect(() => {\r\n    getDictionaryClient(lang).then(setDict);\r\n  }, [lang]);\r\n\r\n  // Close drawer when route changes\r\n  useEffect(() => {\r\n    setDrawerOpen(false);\r\n    setUserMenuOpen(false);\r\n  }, [pathname]);\r\n\r\n  // Prevent body scroll when drawer is open\r\n  useEffect(() => {\r\n    if (drawerOpen) {\r\n      document.body.style.overflow = 'hidden';\r\n    } else {\r\n      document.body.style.overflow = '';\r\n    }\r\n    return () => {\r\n      document.body.style.overflow = '';\r\n    };\r\n  }, [drawerOpen]);\r\n\r\n  // Close user menu when clicking outside\r\n  useEffect(() => {\r\n    const handleClickOutside = (event: MouseEvent) => {\r\n      const target = event.target as HTMLElement;\r\n      if (!target.closest('[data-user-menu]')) {\r\n        setUserMenuOpen(false);\r\n      }\r\n    };\r\n\r\n    if (userMenuOpen) {\r\n      document.addEventListener('mousedown', handleClickOutside);\r\n      return () => document.removeEventListener('mousedown', handleClickOutside);\r\n    }\r\n  }, [userMenuOpen]);\r\n\r\n  // Base navigation items available to all authenticated users\r\n  const baseNavItems: Array<{ href: string; key: string; featureFlag?: string }> = [\r\n    { href: `/${tenant}/${lang}`, key: 'dashboard' },\r\n    { href: `/${tenant}/${lang}/pos`, key: 'pos' },\r\n    { href: `/${tenant}/${lang}/products`, key: 'products' },\r\n    { href: `/${tenant}/${lang}/transactions`, key: 'transactions' },\r\n    { href: `/${tenant}/${lang}/reports`, key: 'reports' },\r\n  ];\r\n\r\n  // Conditional navigation items based on feature flags\r\n  const conditionalNavItems: Array<{ href: string; key: string; featureFlag?: string }> = [\r\n    { href: `/${tenant}/${lang}/inventory`, key: 'inventory', featureFlag: 'enableInventory' },\r\n    { href: `/${tenant}/${lang}/admin/bookings`, key: 'bookings', featureFlag: 'enableBookingScheduling' },\r\n  ];\r\n\r\n  // Filter navigation items based on feature flags\r\n  const navItems = [\r\n    ...baseNavItems,\r\n    ...conditionalNavItems.filter(item => {\r\n      if (!item.featureFlag) return true;\r\n      if (!settings) return true; // Show by default if settings not loaded yet\r\n      return (settings as any)[item.featureFlag] !== false; // Show if enabled or undefined (default enabled)\r\n    }),\r\n  ];\r\n\r\n  const handleLogout = async () => {\r\n    await logout();\r\n    router.push(`/${tenant}/${lang}/login`);\r\n  };\r\n\r\n  if (!dict) {\r\n    return (\r\n      <nav className=\"bg-white border-b border-gray-200 sticky top-0 z-50\">\r\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\r\n          <div className=\"flex justify-between items-center h-16\">\r\n            <div className=\"text-2xl font-bold text-blue-600\">POS</div>\r\n          </div>\r\n        </div>\r\n      </nav>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <>\r\n      <nav className=\"bg-white border-b border-gray-300 sticky top-0 z-50\">\r\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\r\n          {/* Main Header */}\r\n          <div className=\"flex justify-between items-center h-16\">\r\n            {/* Left: Menu Button + Logo */}\r\n            <div className=\"flex items-center space-x-4\">\r\n              {/* Drawer Menu Button */}\r\n              <button\r\n                onClick={() => setDrawerOpen(true)}\r\n                className=\"inline-flex items-center justify-center p-2 border border-gray-300 text-gray-700 hover:bg-gray-100 hover:text-gray-900 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-blue-500 transition-colors bg-white\"\r\n                aria-expanded={drawerOpen}\r\n                aria-label={dict?.common?.openMenu || 'Open menu'}\r\n              >\r\n                <svg\r\n                  className=\"h-6 w-6\"\r\n                  fill=\"none\"\r\n                  viewBox=\"0 0 24 24\"\r\n                  stroke=\"currentColor\"\r\n                  strokeWidth={2}\r\n                >\r\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M4 6h16M4 12h16M4 18h16\" />\r\n                </svg>\r\n              </button>\r\n\r\n              {/* Logo Section */}\r\n              <div className=\"flex-shrink-0 flex items-center\">\r\n                <Link \r\n                  href={`/${tenant}/${lang}`} \r\n                  className=\"flex items-center space-x-2 group\"\r\n                  aria-label=\"Home\"\r\n                >\r\n                  <div \r\n                    className=\"text-2xl sm:text-3xl font-bold transition-colors\"\r\n                    style={{ color: primaryColor }}\r\n                  >\r\n                    {settings?.companyName || 'POS'}\r\n                  </div>\r\n                </Link>\r\n              </div>\r\n            </div>\r\n          \r\n          {/* Right Side Actions */}\r\n          <div className=\"flex items-center space-x-4\">\r\n            {/* User Section with Dropdown */}\r\n            {isAuthenticated && user ? (\r\n              <div className=\"relative\" data-user-menu>\r\n                <button\r\n                  onClick={() => setUserMenuOpen(!userMenuOpen)}\r\n                  className=\"flex items-center space-x-2 px-3 py-2 hover:bg-gray-50 transition-colors bg-white\"\r\n                  aria-expanded={userMenuOpen}\r\n                  aria-haspopup=\"true\"\r\n                >\r\n                  <div className=\"text-right hidden sm:block\">\r\n                    <div className=\"text-sm font-semibold text-gray-900 leading-tight\">\r\n                      {user.name}\r\n                    </div>\r\n                    <div className=\"text-xs text-gray-500 capitalize leading-tight\">\r\n                      {user.role}\r\n                    </div>\r\n                  </div>\r\n                  <div \r\n                    className=\"w-10 h-10 flex items-center justify-center text-white text-sm font-bold flex-shrink-0\"\r\n                    style={{ \r\n                      background: `linear-gradient(to bottom right, ${primaryColor}, ${primaryColor}dd)`,\r\n                      boxShadow: `0 0 0 2px ${primaryColor}33`\r\n                    }}\r\n                  >\r\n                    {user.name.charAt(0).toUpperCase()}\r\n                  </div>\r\n                  <svg\r\n                    className={`w-4 h-4 text-gray-500 transition-transform ${userMenuOpen ? 'rotate-180' : ''}`}\r\n                    fill=\"none\"\r\n                    viewBox=\"0 0 24 24\"\r\n                    stroke=\"currentColor\"\r\n                  >\r\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 9l-7 7-7-7\" />\r\n                  </svg>\r\n                </button>\r\n\r\n                {/* User Dropdown Menu */}\r\n                {userMenuOpen && (\r\n                  <div className=\"absolute right-0 mt-2 w-56 border border-gray-300 bg-white z-50\">\r\n                    <div className=\"py-1\">\r\n                      {/* User Info Header */}\r\n                      <div className=\"px-4 py-3 border-b border-gray-100\">\r\n                        <div className=\"text-sm font-semibold text-gray-900\">{user.name}</div>\r\n                        <div className=\"text-xs text-gray-500 capitalize mt-0.5\">{user.role}</div>\r\n                      </div>\r\n\r\n                      {/* Profile */}\r\n                      <Link\r\n                        href={`/${tenant}/${lang}/profile`}\r\n                        onClick={() => setUserMenuOpen(false)}\r\n                        className={`flex items-center px-4 py-2.5 text-sm text-gray-700 hover:bg-gray-50 transition-colors ${\r\n                          pathname.includes('/profile') ? 'bg-blue-50 text-blue-700' : ''\r\n                        }`}\r\n                      >\r\n                        <svg className=\"w-5 h-5 mr-3 text-gray-400\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z\" />\r\n                        </svg>\r\n                        {dict?.nav?.profile || 'Profile'}\r\n                      </Link>\r\n\r\n                      {/* Admin - Only show for admin users */}\r\n                      {isAdmin && (\r\n                        <Link\r\n                          href={`/${tenant}/${lang}/admin`}\r\n                          onClick={() => setUserMenuOpen(false)}\r\n                          className={`flex items-center px-4 py-2.5 text-sm text-gray-700 hover:bg-gray-50 transition-colors ${\r\n                            pathname.includes('/admin') ? 'bg-blue-50 text-blue-700' : ''\r\n                          }`}\r\n                        >\r\n                          <svg className=\"w-5 h-5 mr-3 text-gray-400\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z\" />\r\n                          </svg>\r\n                          {dict?.nav?.admin || 'Admin'}\r\n                        </Link>\r\n                      )}\r\n\r\n                      {/* Settings */}\r\n                      <Link\r\n                        href={`/${tenant}/${lang}/settings`}\r\n                        onClick={() => setUserMenuOpen(false)}\r\n                        className={`flex items-center px-4 py-2.5 text-sm text-gray-700 hover:bg-gray-50 transition-colors ${\r\n                          pathname.includes('/settings') ? 'bg-blue-50 text-blue-700' : ''\r\n                        }`}\r\n                      >\r\n                        <svg className=\"w-5 h-5 mr-3 text-gray-400\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z\" />\r\n                          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15 12a3 3 0 11-6 0 3 3 0 016 0z\" />\r\n                        </svg>\r\n                        {dict?.nav?.settings || 'Settings'}\r\n                      </Link>\r\n\r\n                      {/* Switch Store */}\r\n                      <Link\r\n                        href=\"/login\"\r\n                        onClick={() => setUserMenuOpen(false)}\r\n                        className=\"flex items-center px-4 py-2.5 text-sm text-gray-700 hover:bg-gray-50 transition-colors\"\r\n                      >\r\n                        <svg className=\"w-5 h-5 mr-3 text-gray-400\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4\" />\r\n                        </svg>\r\n                        {dict?.common?.switchStore || 'Switch Store'}\r\n                      </Link>\r\n\r\n                      {/* Divider */}\r\n                      <div className=\"border-t border-gray-100 my-1\" />\r\n\r\n                      {/* Logout */}\r\n                      <button\r\n                        onClick={() => {\r\n                          setUserMenuOpen(false);\r\n                          handleLogout();\r\n                        }}\r\n                        className=\"w-full flex items-center px-4 py-2.5 text-sm text-red-700 hover:bg-red-50 transition-colors\"\r\n                      >\r\n                        <svg className=\"w-5 h-5 mr-3 text-red-500\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1\" />\r\n                        </svg>\r\n                        {dict?.common?.logout || 'Logout'}\r\n                      </button>\r\n                    </div>\r\n                  </div>\r\n                )}\r\n              </div>\r\n            ) : (\r\n              <div className=\"flex items-center space-x-3\">\r\n                <Link\r\n                  href={`/${tenant}/${lang}/login`}\r\n                  className=\"text-sm font-medium text-gray-700 hover:text-gray-900 transition-colors px-3 py-2 border border-gray-300 hover:bg-gray-50 bg-white\"\r\n                >\r\n                  {dict?.common?.login || 'Login'}\r\n                </Link>\r\n                <Link\r\n                  href=\"/login\"\r\n                  className=\"text-sm font-medium text-gray-700 hover:text-gray-900 transition-colors px-3 py-2 border border-gray-300 hover:bg-gray-50 bg-white\"\r\n                >\r\n                  {dict?.common?.switchStore || 'Switch Store'}\r\n                </Link>\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n      </div>\r\n      </nav>\r\n\r\n      {/* Drawer Overlay */}\r\n      {drawerOpen && (\r\n        <div\r\n          className=\"fixed inset-0 bg-white/30 backdrop-blur-sm z-50 transition-opacity\"\r\n          onClick={() => setDrawerOpen(false)}\r\n          aria-hidden=\"true\"\r\n        />\r\n      )}\r\n\r\n      {/* Drawer */}\r\n      <div\r\n        className={`fixed top-0 left-0 h-full w-80 max-w-[85vw] bg-white border-r border-gray-300 z-50 transform transition-transform duration-300 ease-in-out ${\r\n          drawerOpen ? 'translate-x-0' : '-translate-x-full'\r\n        }`}\r\n      >\r\n        <div className=\"flex flex-col h-full\">\r\n          {/* Drawer Header */}\r\n          <div className=\"flex items-center justify-between p-4 border-b border-gray-200\">\r\n            <div \r\n              className=\"text-xl font-bold\"\r\n              style={{ color: primaryColor }}\r\n            >\r\n              {settings?.companyName || 'POS'}\r\n            </div>\r\n            <button\r\n              onClick={() => setDrawerOpen(false)}\r\n              className=\"p-2 border border-gray-300 text-gray-500 hover:bg-gray-100 hover:text-gray-900 transition-colors bg-white\"\r\n              aria-label={dict?.common?.closeMenu || 'Close menu'}\r\n            >\r\n              <svg\r\n                className=\"h-6 w-6\"\r\n                fill=\"none\"\r\n                viewBox=\"0 0 24 24\"\r\n                stroke=\"currentColor\"\r\n                strokeWidth={2}\r\n              >\r\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M6 18L18 6M6 6l12 12\" />\r\n              </svg>\r\n            </button>\r\n          </div>\r\n\r\n          {/* Drawer Content */}\r\n          <div className=\"flex-1 overflow-y-auto\">\r\n            {/* User Section */}\r\n            {isAuthenticated && user && (\r\n              <div className=\"p-4 border-b border-gray-200 bg-gray-50\">\r\n                <div className=\"flex items-center space-x-3\">\r\n                  <div \r\n                    className=\"w-12 h-12 border border-gray-300 flex items-center justify-center text-white font-bold\"\r\n                    style={{ \r\n                      background: `linear-gradient(to bottom right, ${primaryColor}, ${primaryColor}dd)`\r\n                    }}\r\n                  >\r\n                    {user.name.charAt(0).toUpperCase()}\r\n                  </div>\r\n                  <div>\r\n                    <div className=\"text-sm font-semibold text-gray-900\">{user.name}</div>\r\n                    <div className=\"text-xs text-gray-500 capitalize\">{user.role}</div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            )}\r\n\r\n            {/* Navigation Items */}\r\n            <div className=\"p-2\">\r\n              {navItems.map((item) => {\r\n                const isActive = pathname === item.href || (item.href !== `/${tenant}/${lang}` && pathname.startsWith(item.href));\r\n                return (\r\n                  <Link\r\n                    key={item.href}\r\n                    href={item.href}\r\n                    onClick={() => setDrawerOpen(false)}\r\n                    className={`flex items-center px-4 py-3 border border-gray-300 text-base font-medium transition-all mb-1 ${\r\n                      isActive\r\n                        ? 'text-white border-gray-300'\r\n                        : 'text-gray-700 hover:bg-gray-100 bg-white'\r\n                    }`}\r\n                    style={isActive ? { backgroundColor: primaryColor } : {}}\r\n                  >\r\n                    {dict?.nav?.[item.key] || item.key.charAt(0).toUpperCase() + item.key.slice(1)}\r\n                  </Link>\r\n                );\r\n              })}\r\n            </div>\r\n\r\n            {/* User Menu Items */}\r\n            {isAuthenticated && user && (\r\n              <>\r\n                <div className=\"border-t border-gray-200 my-2\" />\r\n                <div className=\"p-2 space-y-1\">\r\n                  <Link\r\n                    href={`/${tenant}/${lang}/profile`}\r\n                    onClick={() => setDrawerOpen(false)}\r\n                    className={`flex items-center px-4 py-3 border border-gray-300 text-base font-medium transition-colors ${\r\n                      pathname.includes('/profile')\r\n                        ? 'bg-blue-50 text-blue-700 border-blue-300'\r\n                        : 'text-gray-700 hover:bg-gray-100 bg-white'\r\n                    }`}\r\n                  >\r\n                    <svg className=\"w-5 h-5 mr-3\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z\" />\r\n                    </svg>\r\n                    {dict?.nav?.profile || 'Profile'}\r\n                  </Link>\r\n                  {isAdmin && (\r\n                    <Link\r\n                      href={`/${tenant}/${lang}/admin`}\r\n                      onClick={() => setDrawerOpen(false)}\r\n                      className={`flex items-center px-4 py-3 border border-gray-300 text-base font-medium transition-colors ${\r\n                        pathname.includes('/admin')\r\n                          ? 'bg-blue-50 text-blue-700 border-blue-300'\r\n                          : 'text-gray-700 hover:bg-gray-100 bg-white'\r\n                      }`}\r\n                    >\r\n                      <svg className=\"w-5 h-5 mr-3\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z\" />\r\n                      </svg>\r\n                      {dict?.nav?.admin || 'Admin'}\r\n                    </Link>\r\n                  )}\r\n                  <Link\r\n                    href={`/${tenant}/${lang}/settings`}\r\n                    onClick={() => setDrawerOpen(false)}\r\n                    className={`flex items-center px-4 py-3 border border-gray-300 text-base font-medium transition-colors ${\r\n                      pathname.includes('/settings')\r\n                        ? 'bg-blue-50 text-blue-700 border-blue-300'\r\n                        : 'text-gray-700 hover:bg-gray-100 bg-white'\r\n                    }`}\r\n                  >\r\n                    <svg className=\"w-5 h-5 mr-3\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z\" />\r\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15 12a3 3 0 11-6 0 3 3 0 016 0z\" />\r\n                    </svg>\r\n                    {dict?.nav?.settings || 'Settings'}\r\n                  </Link>\r\n                  <Link\r\n                    href=\"/login\"\r\n                    onClick={() => setDrawerOpen(false)}\r\n                    className=\"flex items-center px-4 py-3 border border-gray-300 text-base font-medium text-gray-700 hover:bg-gray-100 transition-colors bg-white\"\r\n                  >\r\n                    <svg className=\"w-5 h-5 mr-3\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4\" />\r\n                    </svg>\r\n                    {dict?.common?.switchStore || 'Switch Store'}\r\n                  </Link>\r\n                </div>\r\n\r\n                {/* Subscription Details - Only show if subscription context is available */}\r\n                {subscriptionStatus && (\r\n                  <>\r\n                    <div className=\"border-t border-gray-200 my-2\" />\r\n                    <div className=\"p-2\">\r\n                      <div className=\"bg-gray-50 border border-gray-200 rounded-lg p-3\">\r\n                        <div className=\"flex items-center justify-between mb-2\">\r\n                          <span className=\"text-sm font-medium text-gray-900\">\r\n                            {dict?.common?.subscription || 'Subscription'}\r\n                          </span>\r\n                          <span className={`inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium ${\r\n                            subscriptionStatus.isActive\r\n                              ? 'bg-green-100 text-green-800'\r\n                              : subscriptionStatus.isTrial && !subscriptionStatus.isTrialExpired\r\n                              ? 'bg-blue-100 text-blue-800'\r\n                              : 'bg-red-100 text-red-800'\r\n                          }`}>\r\n                            {subscriptionStatus.isActive\r\n                              ? dict?.common?.active || 'Active'\r\n                              : subscriptionStatus.isTrial && !subscriptionStatus.isTrialExpired\r\n                              ? dict?.common?.trial || 'Trial'\r\n                              : dict?.common?.expired || 'Expired'\r\n                            }\r\n                          </span>\r\n                        </div>\r\n                        <div className=\"text-sm text-gray-600\">\r\n                          <div className=\"font-medium\">{subscriptionStatus.planName}</div>\r\n                          {subscriptionStatus.isTrial && subscriptionStatus.trialEndDate && (\r\n                            <div className=\"text-xs mt-1\">\r\n                              {subscriptionStatus.isTrialExpired\r\n                                ? (dict?.common?.trialExpired || 'Trial expired')\r\n                                : `${Math.ceil((new Date(subscriptionStatus.trialEndDate).getTime() - new Date().getTime()) / (1000 * 60 * 60 * 24))} ${dict?.common?.daysLeft || 'days left'}`\r\n                              }\r\n                            </div>\r\n                          )}\r\n                          {subscriptionStatus.nextBillingDate && !subscriptionStatus.isTrial && (\r\n                            <div className=\"text-xs mt-1\">\r\n                              {dict?.common?.nextBilling || 'Next billing'}: {new Date(subscriptionStatus.nextBillingDate).toLocaleDateString()}\r\n                            </div>\r\n                          )}\r\n                        </div>\r\n                        {isAdmin && (\r\n                          <Link\r\n                            href={`/${tenant}/${lang}/admin/subscriptions`}\r\n                            onClick={() => setDrawerOpen(false)}\r\n                            className=\"mt-2 block w-full text-center px-3 py-1.5 text-xs font-medium text-blue-600 hover:text-blue-500 bg-blue-50 hover:bg-blue-100 border border-blue-200 rounded transition-colors\"\r\n                          >\r\n                            {dict?.common?.manageSubscription || 'Manage Subscription'}\r\n                          </Link>\r\n                        )}\r\n                      </div>\r\n                    </div>\r\n                  </>\r\n                )}\r\n\r\n                <div className=\"border-t border-gray-200 my-2\" />\r\n                <div className=\"p-2\">\r\n                  <button\r\n                    onClick={() => {\r\n                      setDrawerOpen(false);\r\n                      handleLogout();\r\n                    }}\r\n                    className=\"flex items-center w-full px-4 py-3 border border-red-300 text-base font-medium text-red-700 bg-red-50 hover:bg-red-100 transition-colors\"\r\n                  >\r\n                    <svg className=\"w-5 h-5 mr-3\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1\" />\r\n                    </svg>\r\n                    {dict?.common?.logout || 'Logout'}\r\n                  </button>\r\n                </div>\r\n              </>\r\n            )}\r\n\r\n            {/* Login/Switch Store for non-authenticated users */}\r\n            {!isAuthenticated && (\r\n              <>\r\n                <div className=\"border-t border-gray-200 my-2\" />\r\n                <div className=\"p-2 space-y-2\">\r\n                  <Link\r\n                    href={`/${tenant}/${lang}/login`}\r\n                    onClick={() => setDrawerOpen(false)}\r\n                    className=\"block w-full px-4 py-3 text-center text-base font-medium text-white border border-gray-300 transition-colors\"\r\n                    style={{ backgroundColor: primaryColor }}\r\n                  >\r\n                    {dict?.common?.login || 'Login'}\r\n                  </Link>\r\n                  <Link\r\n                    href=\"/login\"\r\n                    onClick={() => setDrawerOpen(false)}\r\n                    className=\"block w-full px-4 py-3 text-center text-base font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 border border-gray-300 transition-colors\"\r\n                  >\r\n                    {dict?.common?.switchStore || 'Switch Store'}\r\n                  </Link>\r\n                </div>\r\n              </>\r\n            )}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\components\\OfflineIndicator.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":12,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":12,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[478,481],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[478,481],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\corew\\localpro-pos\\components\\OfflineIndicator.tsx:27:7\n  25 |     if (lastSyncResult && lastSyncResult.synced > 0) {\n  26 |       // eslint-disable-next-line react-hooks/set-state-in-effect\n> 27 |       setShowSyncResult(true);\n     |       ^^^^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  28 |       const timer = setTimeout(() => setShowSyncResult(false), 5000);\n  29 |       return () => clearTimeout(timer);\n  30 |     }","line":27,"column":7,"nodeType":null,"endLine":27,"endColumn":24,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useNetworkStatus } from '@/hooks/useNetworkStatus';\r\nimport { useParams } from 'next/navigation';\r\nimport { useEffect, useState, useCallback } from 'react';\r\nimport { getDictionaryClient } from '@/app/[tenant]/[lang]/dictionaries-client';\r\n\r\nexport default function OfflineIndicator() {\r\n  const params = useParams();\r\n  const tenant = params.tenant as string;\r\n  const lang = (params?.lang as 'en' | 'es') || 'en';\r\n  const [dict, setDict] = useState<any>(null);\r\n  const { isOnline, isSyncing, lastSyncResult, sync } = useNetworkStatus(tenant);\r\n\r\n  useEffect(() => {\r\n    getDictionaryClient(lang).then(setDict);\r\n  }, [lang]);\r\n\r\n  const handleSync = useCallback(() => {\r\n    sync(tenant);\r\n  }, [sync, tenant]);\r\n  const [showSyncResult, setShowSyncResult] = useState(false);\r\n\r\n  useEffect(() => {\r\n    if (lastSyncResult && lastSyncResult.synced > 0) {\r\n      // eslint-disable-next-line react-hooks/set-state-in-effect\r\n      setShowSyncResult(true);\r\n      const timer = setTimeout(() => setShowSyncResult(false), 5000);\r\n      return () => clearTimeout(timer);\r\n    }\r\n  }, [lastSyncResult]);\r\n\r\n  if (isOnline && !isSyncing && !showSyncResult) {\r\n    return null;\r\n  }\r\n\r\n  return (\r\n    <div className=\"fixed top-0 left-0 right-0 z-50\">\r\n      {!isOnline && (\r\n        <div className=\"bg-yellow-500 text-white px-4 py-2 text-center text-sm font-medium\">\r\n          <div className=\"flex items-center justify-center gap-2\">\r\n            <svg className=\"w-5 h-5\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M18.364 5.636a9 9 0 010 12.728m0 0l-2.829-2.829m2.829 2.829L21 21M15.536 8.464a5 5 0 010 7.072m0 0l-2.829-2.829m-4.243 2.829a4.978 4.978 0 01-1.414-2.83m-1.414 5.658a9 9 0 01-2.167-9.238m7.824 2.167a1 1 0 111.414 1.414m-1.414-1.414L3 3m8.293 8.293l1.414 1.414\" />\r\n            </svg>\r\n            <span>{dict?.components?.offlineIndicator?.offlineMode || dict?.common?.offlineMode || 'Offline Mode - Transactions will sync when connection is restored'}</span>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {isOnline && isSyncing && (\r\n        <div className=\"bg-blue-500 text-white px-4 py-2 text-center text-sm font-medium\">\r\n          <div className=\"flex items-center justify-center gap-2\">\r\n            <div className=\"animate-spin h-4 w-4 border-b-2 border-white\"></div>\r\n            <span>{dict?.components?.offlineIndicator?.syncingOfflineTransactions || dict?.common?.syncingOfflineTransactions || 'Syncing offline transactions...'}</span>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {isOnline && showSyncResult && lastSyncResult && (\r\n        <div\r\n          className={`px-4 py-2 text-center text-sm font-medium ${\r\n            lastSyncResult.success\r\n              ? 'bg-green-500 text-white'\r\n              : 'bg-orange-500 text-white'\r\n          }`}\r\n        >\r\n          <div className=\"flex items-center justify-center gap-2\">\r\n            {lastSyncResult.success ? (\r\n              <>\r\n                <svg className=\"w-5 h-5\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M5 13l4 4L19 7\" />\r\n                </svg>\r\n                <span>\r\n                  {(dict?.components?.offlineIndicator?.syncedTransactions || dict?.common?.syncedTransactions || 'Synced {count} transaction{s}').replace('{count}', lastSyncResult.synced.toString()).replace('{s}', lastSyncResult.synced !== 1 ? 's' : '')}\r\n                </span>\r\n              </>\r\n            ) : (\r\n              <>\r\n                <svg className=\"w-5 h-5\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n                </svg>\r\n                <span>\r\n                  {(dict?.components?.offlineIndicator?.syncedWithFailures || dict?.common?.syncedWithFailures || 'Synced {synced}, {failed} failed').replace('{synced}', lastSyncResult.synced.toString()).replace('{failed}', lastSyncResult.failed.toString())}\r\n                </span>\r\n                <button\r\n                  onClick={handleSync}\r\n                  className=\"ml-2 underline hover:no-underline\"\r\n                >\r\n                  {dict?.components?.offlineIndicator?.retry || dict?.common?.retry || 'Retry'}\r\n                </button>\r\n              </>\r\n            )}\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\components\\PINInput.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\components\\PageTitle.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":15,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":15,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[536,539],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[536,539],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useEffect, useState } from 'react';\r\nimport { useTenantSettings } from '@/contexts/TenantSettingsContext';\r\nimport { useParams } from 'next/navigation';\r\nimport { getDictionaryClient } from '@/app/[tenant]/[lang]/dictionaries-client';\r\n\r\n/**\r\n * Component to set page title based on tenant settings\r\n */\r\nexport default function PageTitle() {\r\n  const { settings } = useTenantSettings();\r\n  const params = useParams();\r\n  const lang = (params?.lang as 'en' | 'es') || 'en';\r\n  const [dict, setDict] = useState<any>(null);\r\n\r\n  useEffect(() => {\r\n    getDictionaryClient(lang).then(setDict);\r\n  }, [lang]);\r\n  \r\n  useEffect(() => {\r\n    if (settings?.companyName) {\r\n      document.title = `${settings.companyName} - POS System`;\r\n    } else {\r\n      document.title = dict?.components?.pageTitle?.posSystem || 'POS System - Point of Sale';\r\n    }\r\n  }, [settings?.companyName, dict]);\r\n\r\n  return null;\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\components\\ProductModal.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":45,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":45,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1446,1449],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1446,1449],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'product'. Either include it or remove the dependency array.","line":128,"column":6,"nodeType":"ArrayExpression","endLine":128,"endColumn":76,"suggestions":[{"desc":"Update the dependencies array to be: [product._id, product.trackInventory, product.allowOutOfStockSales, product]","fix":{"range":[4268,4338],"text":"[product._id, product.trackInventory, product.allowOutOfStockSales, product]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":229,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":229,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7979,7982],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7979,7982],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":253,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":253,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8867,8870],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8867,8870],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useEffect, useRef } from 'react';\r\nimport { useParams } from 'next/navigation';\r\nimport { getDictionaryClient } from '@/app/[tenant]/[lang]/dictionaries-client';\r\nimport { useTenantSettings } from '@/contexts/TenantSettingsContext';\r\nimport { getBusinessTypeConfig } from '@/lib/business-types';\r\nimport { getBusinessType } from '@/lib/business-type-helpers';\r\n\r\ninterface Product {\r\n  _id?: string;\r\n  name: string;\r\n  description?: string;\r\n  price: number;\r\n  stock: number;\r\n  sku?: string;\r\n  category?: string;\r\n  trackInventory?: boolean;\r\n  allowOutOfStockSales?: boolean;\r\n}\r\n\r\ninterface ProductModalProps {\r\n  product: Product | null;\r\n  onClose: () => void;\r\n  lang?: 'en' | 'es';\r\n}\r\n\r\nconst generateSKU = (name: string): string => {\r\n  if (!name || name.trim().length === 0) return '';\r\n  \r\n  // Get first 3 letters (uppercase), remove spaces and special chars\r\n  const cleanName = name.replace(/[^a-zA-Z0-9]/g, '').toUpperCase();\r\n  const prefix = cleanName.substring(0, 3).padEnd(3, 'X');\r\n  \r\n  // Add timestamp suffix (last 6 digits)\r\n  const suffix = Date.now().toString().slice(-6);\r\n  \r\n  return `${prefix}-${suffix}`;\r\n};\r\n\r\nexport default function ProductModal({ product, onClose, lang = 'en' }: ProductModalProps) {\r\n  const params = useParams();\r\n  const tenant = (params?.tenant as string) || 'default';\r\n  const { settings } = useTenantSettings();\r\n  const [dict, setDict] = useState<any>(null);\r\n  const [categories, setCategories] = useState<string[]>([]);\r\n  const [showCategorySuggestions, setShowCategorySuggestions] = useState(false);\r\n  const [filteredCategories, setFilteredCategories] = useState<string[]>([]);\r\n  const categoryInputRef = useRef<HTMLInputElement>(null);\r\n  const categoryListRef = useRef<HTMLDivElement>(null);\r\n  const businessTypeConfig = settings ? getBusinessTypeConfig(getBusinessType(settings)) : null;\r\n\r\n  useEffect(() => {\r\n    getDictionaryClient(lang).then(setDict);\r\n  }, [lang]);\r\n\r\n  useEffect(() => {\r\n    // Fetch existing categories from products\r\n    const fetchCategories = async () => {\r\n      try {\r\n        const res = await fetch(`/api/products?tenant=${tenant}`);\r\n        const data = await res.json();\r\n        if (data.success && data.data) {\r\n          // Extract unique categories\r\n          const uniqueCategories = Array.from(\r\n            new Set(\r\n              data.data\r\n                .map((p: Product) => p.category)\r\n                .filter((cat: string | undefined) => cat && cat.trim() !== '')\r\n            )\r\n          ) as string[];\r\n          setCategories(uniqueCategories.sort());\r\n        }\r\n      } catch (error) {\r\n        console.error('Error fetching categories:', error);\r\n      }\r\n    };\r\n    fetchCategories();\r\n  }, [tenant]);\r\n\r\n  const [formData, setFormData] = useState({\r\n    name: '',\r\n    description: '',\r\n    price: '',\r\n    stock: '',\r\n    sku: '',\r\n    category: '',\r\n    trackInventory: true,\r\n    allowOutOfStockSales: false,\r\n  });\r\n  const [loading, setLoading] = useState(false);\r\n  const [skuAutoGenerated, setSkuAutoGenerated] = useState(false);\r\n  const [errors, setErrors] = useState<Record<string, string>>({});\r\n\r\n  useEffect(() => {\r\n    if (product) {\r\n      // Ensure boolean values are properly set\r\n      const trackInventory = product.trackInventory === false ? false : true;\r\n      const allowOutOfStockSales = product.allowOutOfStockSales === true ? true : false;\r\n      \r\n      setFormData({\r\n        name: product.name || '',\r\n        description: product.description || '',\r\n        price: product.price?.toString() || '',\r\n        stock: product.stock?.toString() || '',\r\n        sku: product.sku || '',\r\n        category: product.category || '',\r\n        trackInventory,\r\n        allowOutOfStockSales,\r\n      });\r\n      setSkuAutoGenerated(false);\r\n      setErrors({}); // Clear errors when loading product\r\n    } else {\r\n      // Reset form for new product\r\n      setFormData({\r\n        name: '',\r\n        description: '',\r\n        price: '',\r\n        stock: '',\r\n        sku: '',\r\n        category: '',\r\n        trackInventory: true,\r\n        allowOutOfStockSales: false,\r\n      });\r\n      setSkuAutoGenerated(false);\r\n      setErrors({}); // Clear errors when resetting form\r\n    }\r\n  }, [product?._id, product?.trackInventory, product?.allowOutOfStockSales]);\r\n\r\n  // Auto-generate SKU when name changes (only for new products, only once)\r\n  useEffect(() => {\r\n    if (!product && formData.name && !formData.sku && !skuAutoGenerated) {\r\n      const generatedSKU = generateSKU(formData.name);\r\n      setFormData(prev => ({ ...prev, sku: generatedSKU }));\r\n      setSkuAutoGenerated(true);\r\n    }\r\n  }, [formData.name, formData.sku, product, skuAutoGenerated]);\r\n\r\n  // Filter categories based on input\r\n  useEffect(() => {\r\n    if (formData.category.trim() === '') {\r\n      setFilteredCategories(categories);\r\n    } else {\r\n      const filtered = categories.filter(cat =>\r\n        cat.toLowerCase().includes(formData.category.toLowerCase())\r\n      );\r\n      setFilteredCategories(filtered);\r\n    }\r\n  }, [formData.category, categories]);\r\n\r\n  const handleCategorySelect = (category: string) => {\r\n    setFormData(prev => ({ ...prev, category }));\r\n    setShowCategorySuggestions(false);\r\n    categoryInputRef.current?.blur();\r\n  };\r\n\r\n  // Handle click outside to close suggestions\r\n  useEffect(() => {\r\n    const handleClickOutside = (event: MouseEvent) => {\r\n      if (\r\n        categoryInputRef.current &&\r\n        categoryListRef.current &&\r\n        !categoryInputRef.current.contains(event.target as Node) &&\r\n        !categoryListRef.current.contains(event.target as Node)\r\n      ) {\r\n        setShowCategorySuggestions(false);\r\n      }\r\n    };\r\n\r\n    document.addEventListener('mousedown', handleClickOutside);\r\n    return () => {\r\n      document.removeEventListener('mousedown', handleClickOutside);\r\n    };\r\n  }, []);\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    setLoading(true);\r\n    setErrors({});\r\n\r\n    try {\r\n      const url = product?._id \r\n        ? `/api/products/${product._id}?tenant=${tenant}` \r\n        : `/api/products?tenant=${tenant}`;\r\n      const method = product?._id ? 'PUT' : 'POST';\r\n      \r\n      // Client-side validation\r\n      const validationErrors: Record<string, string> = {};\r\n      \r\n      if (!formData.name.trim()) {\r\n        validationErrors.name = dict?.products?.nameRequired || 'Product name is required';\r\n      } else if (formData.name.length > 200) {\r\n        validationErrors.name = dict?.products?.nameTooLong || 'Product name must be less than 200 characters';\r\n      }\r\n      \r\n      const priceInput = formData.price.trim();\r\n      if (!priceInput) {\r\n        validationErrors.price = dict?.products?.invalidPrice || 'Price is required';\r\n      } else {\r\n        const price = parseFloat(priceInput);\r\n        if (isNaN(price) || price < 0) {\r\n          validationErrors.price = dict?.products?.invalidPrice || 'Please enter a valid price';\r\n        }\r\n      }\r\n      \r\n      const stockInput = formData.stock.trim();\r\n      let stockNum = 0;\r\n      if (!stockInput) {\r\n        validationErrors.stock = dict?.products?.invalidStock || 'Stock quantity is required';\r\n      } else {\r\n        stockNum = parseInt(stockInput, 10);\r\n        if (isNaN(stockNum) || stockNum < 0 || stockNum.toString() !== stockInput) {\r\n          validationErrors.stock = dict?.products?.invalidStock || 'Please enter a valid stock quantity (must be a whole number)';\r\n        }\r\n      }\r\n      \r\n      if (formData.sku && formData.sku.trim().length > 50) {\r\n        validationErrors.sku = dict?.products?.skuTooLong || 'SKU must be less than 50 characters';\r\n      }\r\n      \r\n      if (Object.keys(validationErrors).length > 0) {\r\n        setErrors(validationErrors);\r\n        setLoading(false);\r\n        return;\r\n      }\r\n      \r\n      const priceValue = parseFloat(formData.price.trim());\r\n      \r\n      const submitData: any = {\r\n        name: formData.name.trim(),\r\n        description: formData.description?.trim() || undefined,\r\n        price: priceValue,\r\n        stock: stockNum,\r\n        sku: formData.sku?.trim() || undefined,\r\n        category: formData.category?.trim() || undefined,\r\n        trackInventory: Boolean(formData.trackInventory),\r\n        allowOutOfStockSales: Boolean(formData.allowOutOfStockSales),\r\n      };\r\n      \r\n      const res = await fetch(url, {\r\n        method,\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify(submitData),\r\n      });\r\n\r\n      const data = await res.json();\r\n      if (data.success) {\r\n        onClose();\r\n      } else {\r\n        // Handle validation errors from API\r\n        if (data.errors && Array.isArray(data.errors)) {\r\n          const apiErrors: Record<string, string> = {};\r\n          data.errors.forEach((err: any) => {\r\n            if (err.field) {\r\n              apiErrors[err.field] = err.message;\r\n            }\r\n          });\r\n          setErrors(apiErrors);\r\n        } else {\r\n          // Check if error is related to SKU duplicate\r\n          const errorMessage = data.error || (dict?.products.saveError || 'Failed to save product');\r\n          if (errorMessage.toLowerCase().includes('sku') || errorMessage.toLowerCase().includes('already exists')) {\r\n            setErrors({ sku: errorMessage, general: errorMessage });\r\n          } else {\r\n            setErrors({ general: errorMessage });\r\n          }\r\n        }\r\n      }\r\n    } catch (error) {\r\n      console.error('Error saving product:', error);\r\n      setErrors({ general: dict?.products.saveError || 'Failed to save product' });\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  if (!dict) {\r\n    return null;\r\n  }\r\n\r\n  return (\r\n    <div \r\n      className=\"fixed inset-0 bg-gray-900/30 backdrop-blur-md z-50\"\r\n      onClick={onClose}\r\n    >\r\n      <div \r\n        className=\"absolute inset-y-0 right-0 w-full max-w-md bg-white border-l border-gray-300 flex flex-col animate-slide-in-right\"\r\n        onClick={(e) => e.stopPropagation()}\r\n      >\r\n        <div className=\"flex items-center justify-between p-5 sm:p-6 border-b border-gray-200\">\r\n          <h2 className=\"text-xl sm:text-2xl font-bold text-gray-900\">\r\n            {product ? dict.products.editProduct : dict.products.addProduct}\r\n          </h2>\r\n          <button\r\n            onClick={onClose}\r\n            className=\"text-gray-400 hover:text-gray-600 transition-colors\"\r\n          >\r\n            <svg className=\"w-6 h-6\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\r\n            </svg>\r\n          </button>\r\n        </div>\r\n        <div className=\"flex-1 overflow-y-auto p-5 sm:p-6\">\r\n        <form onSubmit={handleSubmit} className=\"space-y-4\">\r\n          {errors.general && (\r\n            <div className=\"p-3 bg-red-50 border border-red-300\">\r\n              <p className=\"text-sm text-red-600\">{errors.general}</p>\r\n            </div>\r\n          )}\r\n          \r\n          <div>\r\n            <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n              {dict.products.name} *\r\n            </label>\r\n            <input\r\n              type=\"text\"\r\n              required\r\n              value={formData.name}\r\n              onChange={(e) => {\r\n                setFormData(prev => ({ ...prev, name: e.target.value }));\r\n                if (errors.name) setErrors(prev => ({ ...prev, name: '' }));\r\n              }}\r\n              className={`w-full px-3 py-2.5 text-base border focus:ring-2 focus:ring-blue-500 bg-white ${\r\n                errors.name ? 'border-red-300 focus:ring-red-500' : 'border-gray-300'\r\n              }`}\r\n            />\r\n            {errors.name && (\r\n              <p className=\"mt-1 text-sm text-red-600\">{errors.name}</p>\r\n            )}\r\n          </div>\r\n          <div>\r\n            <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n              {dict.products.description}\r\n            </label>\r\n            <textarea\r\n              value={formData.description}\r\n              onChange={(e) => setFormData(prev => ({ ...prev, description: e.target.value }))}\r\n              className=\"w-full px-3 py-2.5 text-base border border-gray-300 focus:ring-2 focus:ring-blue-500 bg-white\"\r\n              rows={3}\r\n            />\r\n          </div>\r\n          <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4\">\r\n            <div>\r\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                {dict.products.price} *\r\n              </label>\r\n              <input\r\n                type=\"number\"\r\n                step=\"0.01\"\r\n                min=\"0\"\r\n                required\r\n                value={formData.price}\r\n                onChange={(e) => {\r\n                  const value = e.target.value;\r\n                  // Allow empty string, or valid numbers (including decimals)\r\n                  if (value === '' || /^\\d*\\.?\\d*$/.test(value)) {\r\n                    setFormData(prev => ({ ...prev, price: value }));\r\n                    if (errors.price) setErrors(prev => ({ ...prev, price: '' }));\r\n                  }\r\n                }}\r\n                className={`w-full px-3 py-2.5 text-base border focus:ring-2 focus:ring-blue-500 bg-white ${\r\n                  errors.price ? 'border-red-300 focus:ring-red-500' : 'border-gray-300'\r\n                }`}\r\n              />\r\n              {errors.price && (\r\n                <p className=\"mt-1 text-sm text-red-600\">{errors.price}</p>\r\n              )}\r\n            </div>\r\n            <div>\r\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                {dict.products.stock} *\r\n              </label>\r\n              <input\r\n                type=\"number\"\r\n                min=\"0\"\r\n                required\r\n                value={formData.stock}\r\n                onChange={(e) => {\r\n                  const value = e.target.value;\r\n                  // Allow empty string, or valid non-negative integers\r\n                  if (value === '' || /^\\d+$/.test(value)) {\r\n                    setFormData(prev => ({ ...prev, stock: value }));\r\n                    if (errors.stock) setErrors(prev => ({ ...prev, stock: '' }));\r\n                  }\r\n                }}\r\n                className={`w-full px-3 py-2.5 text-base border focus:ring-2 focus:ring-blue-500 bg-white ${\r\n                  errors.stock ? 'border-red-300 focus:ring-red-500' : 'border-gray-300'\r\n                }`}\r\n              />\r\n              {errors.stock && (\r\n                <p className=\"mt-1 text-sm text-red-600\">{errors.stock}</p>\r\n              )}\r\n            </div>\r\n          </div>\r\n          <div>\r\n            <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n              {dict.products.sku} {businessTypeConfig?.requiredFields?.includes('sku') && <span className=\"text-red-500\">*</span>}\r\n            </label>\r\n            <div className=\"flex gap-2\">\r\n              <input\r\n                type=\"text\"\r\n                required={businessTypeConfig?.requiredFields?.includes('sku')}\r\n                value={formData.sku}\r\n                onChange={(e) => {\r\n                  setFormData(prev => ({ ...prev, sku: e.target.value }));\r\n                  setSkuAutoGenerated(false);\r\n                  if (errors.sku) setErrors(prev => ({ ...prev, sku: '' }));\r\n                }}\r\n                className={`flex-1 px-3 py-2.5 text-base border focus:ring-2 focus:ring-blue-500 bg-white ${\r\n                  errors.sku ? 'border-red-300 focus:ring-red-500' : 'border-gray-300'\r\n                }`}\r\n                placeholder={!product ? (dict?.products?.autoGenerated || 'Auto-generated') : ''}\r\n              />\r\n              {!product && (\r\n                <button\r\n                  type=\"button\"\r\n                  onClick={() => {\r\n                    const generatedSKU = generateSKU(formData.name || 'PRO');\r\n                    setFormData(prev => ({ ...prev, sku: generatedSKU }));\r\n                    setSkuAutoGenerated(true);\r\n                  }}\r\n                  className=\"px-3 py-2.5 bg-gray-100 text-gray-700 hover:bg-gray-200 transition-colors text-sm font-medium border border-gray-300\"\r\n                  title={dict?.products?.regenerateSKU || 'Regenerate SKU'}\r\n                >\r\n                  <svg className=\"w-5 h-5\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15\" />\r\n                  </svg>\r\n                </button>\r\n              )}\r\n            </div>\r\n            {errors.sku && (\r\n              <p className=\"mt-1 text-sm text-red-600\">{errors.sku}</p>\r\n            )}\r\n          </div>\r\n          <div className=\"relative\">\r\n            <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n              {dict.products.category}\r\n            </label>\r\n            <div ref={categoryInputRef} className=\"relative\">\r\n              <input\r\n                type=\"text\"\r\n                value={formData.category}\r\n                onChange={(e) => {\r\n                  setFormData(prev => ({ ...prev, category: e.target.value }));\r\n                  setShowCategorySuggestions(true);\r\n                  if (errors.category) setErrors(prev => ({ ...prev, category: '' }));\r\n                }}\r\n                onFocus={() => setShowCategorySuggestions(true)}\r\n                className={`w-full px-3 py-2.5 text-base border focus:ring-2 focus:ring-blue-500 bg-white ${\r\n                  errors.category ? 'border-red-300 focus:ring-red-500' : 'border-gray-300'\r\n                }`}\r\n                placeholder={dict?.products?.typeToSearchOrSelect || 'Type to search or select...'}\r\n              />\r\n              {errors.category && (\r\n                <p className=\"mt-1 text-sm text-red-600\">{errors.category}</p>\r\n              )}\r\n              {showCategorySuggestions && filteredCategories.length > 0 && (\r\n                <div\r\n                  ref={categoryListRef}\r\n                  className=\"absolute z-10 w-full mt-1 bg-white border border-gray-300 max-h-60 overflow-y-auto\"\r\n                >\r\n                  {filteredCategories.map((cat, index) => (\r\n                    <button\r\n                      key={index}\r\n                      type=\"button\"\r\n                      onClick={() => handleCategorySelect(cat)}\r\n                      className=\"w-full text-left px-4 py-2 hover:bg-blue-50 focus:bg-blue-50 focus:outline-none transition-colors\"\r\n                    >\r\n                      {cat}\r\n                    </button>\r\n                  ))}\r\n                </div>\r\n              )}\r\n            </div>\r\n          </div>\r\n          \r\n          {/* Inventory Settings - Only show if inventory is enabled for business type */}\r\n          {businessTypeConfig?.defaultFeatures?.enableInventory !== false && (\r\n            <div className=\"border-t border-gray-200 pt-4 space-y-4\">\r\n              <h3 className=\"text-sm font-semibold text-gray-700 mb-3\">\r\n                {dict?.products?.inventorySettings || 'Inventory Settings'}\r\n              </h3>\r\n            \r\n            <div className=\"flex items-start gap-3\">\r\n              <input\r\n                type=\"checkbox\"\r\n                id=\"trackInventory\"\r\n                checked={formData.trackInventory === true}\r\n                onChange={(e) => {\r\n                  setFormData(prev => ({ ...prev, trackInventory: e.target.checked }));\r\n                }}\r\n                className=\"mt-1 h-4 w-4 border-gray-300 text-blue-600 focus:ring-2 focus:ring-blue-500\"\r\n              />\r\n              <div className=\"flex-1\">\r\n                <label \r\n                  htmlFor=\"trackInventory\"\r\n                  className=\"block text-sm font-medium text-gray-700 mb-1 cursor-pointer\"\r\n                >\r\n                  {dict?.products?.trackInventory || 'Track Inventory'}\r\n                </label>\r\n                <p className=\"text-xs text-gray-500\">\r\n                  {dict?.products?.trackInventoryDesc || 'Enable stock tracking for this product'}\r\n                </p>\r\n              </div>\r\n            </div>\r\n            \r\n            <div className=\"flex items-start gap-3\">\r\n              <input\r\n                type=\"checkbox\"\r\n                id=\"allowOutOfStockSales\"\r\n                checked={formData.allowOutOfStockSales === true}\r\n                onChange={(e) => {\r\n                  setFormData(prev => ({ ...prev, allowOutOfStockSales: e.target.checked }));\r\n                }}\r\n                className=\"mt-1 h-4 w-4 border-gray-300 text-blue-600 focus:ring-2 focus:ring-blue-500\"\r\n              />\r\n              <div className=\"flex-1\">\r\n                <label \r\n                  htmlFor=\"allowOutOfStockSales\"\r\n                  className=\"block text-sm font-medium text-gray-700 mb-1 cursor-pointer\"\r\n                >\r\n                  {dict?.products?.allowOutOfStockSales || 'Allow Sales When Out of Stock'}\r\n                </label>\r\n                <p className=\"text-xs text-gray-500\">\r\n                  {dict?.products?.allowOutOfStockSalesDesc || 'Allow customers to purchase this product even when stock is 0'}\r\n                </p>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          )}\r\n          \r\n          <div className=\"flex flex-col sm:flex-row justify-end gap-2 pt-4\">\r\n            <button\r\n              type=\"button\"\r\n              onClick={onClose}\r\n              className=\"w-full sm:w-auto px-4 py-2.5 border border-gray-300 text-gray-700 hover:bg-gray-50 active:bg-gray-100 font-medium bg-white\"\r\n            >\r\n              {dict.common.cancel}\r\n            </button>\r\n            <button\r\n              type=\"submit\"\r\n              disabled={loading}\r\n              className=\"w-full sm:w-auto px-4 py-2.5 bg-blue-600 text-white hover:bg-blue-700 active:bg-blue-800 disabled:opacity-50 disabled:cursor-not-allowed font-medium border border-blue-700\"\r\n            >\r\n              {loading ? dict.common.loading : dict.common.save}\r\n            </button>\r\n          </div>\r\n        </form>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\components\\ProtectedRoute.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":24,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":24,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[775,778],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[775,778],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useEffect, useState } from 'react';\r\nimport { useRouter, useParams } from 'next/navigation';\r\nimport { useAuth } from '@/contexts/AuthContext';\r\nimport { getDictionaryClient } from '@/app/[tenant]/[lang]/dictionaries-client';\r\n\r\ninterface ProtectedRouteProps {\r\n  children: React.ReactNode;\r\n  requiredRoles?: string[];\r\n  redirectTo?: string;\r\n}\r\n\r\nexport default function ProtectedRoute({ \r\n  children, \r\n  requiredRoles = [],\r\n  redirectTo \r\n}: ProtectedRouteProps) {\r\n  const { isAuthenticated, user, loading, hasRole } = useAuth();\r\n  const router = useRouter();\r\n  const params = useParams();\r\n  const tenant = (params?.tenant as string) || 'default';\r\n  const lang = (params?.lang as 'en' | 'es') || 'en';\r\n  const [dict, setDict] = useState<any>(null);\r\n\r\n  useEffect(() => {\r\n    getDictionaryClient(lang).then(setDict);\r\n  }, [lang]);\r\n\r\n  useEffect(() => {\r\n    if (!loading) {\r\n      if (!isAuthenticated) {\r\n        // Don't redirect if already on login page\r\n        const currentPath = window.location.pathname;\r\n        if (!currentPath.includes('/login')) {\r\n          router.push(redirectTo || `/${tenant}/${lang}/login`);\r\n        }\r\n      } else if (requiredRoles.length > 0 && !hasRole(requiredRoles)) {\r\n        router.push(`/${tenant}/${lang}`);\r\n      }\r\n    }\r\n  }, [isAuthenticated, loading, user, requiredRoles, hasRole, router, tenant, lang, redirectTo]);\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"min-h-screen flex items-center justify-center\">\r\n        <div className=\"text-center\">\r\n          <div className=\"inline-block animate-spin h-8 w-8 border-b-2 border-blue-600\"></div>\r\n          <p className=\"mt-4 text-gray-600\">{dict?.components?.protectedRoute?.loading || dict?.common?.loading || 'Loading...'}</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (!isAuthenticated) {\r\n    return null; // Will redirect\r\n  }\r\n\r\n  if (requiredRoles.length > 0 && !hasRole(requiredRoles)) {\r\n    return (\r\n      <div className=\"min-h-screen flex items-center justify-center\">\r\n        <div className=\"text-center max-w-md\">\r\n          <div className=\"text-6xl mb-4\"></div>\r\n          <h1 className=\"text-2xl font-bold text-gray-900 mb-2\">{dict?.components?.protectedRoute?.accessDenied || 'Access Denied'}</h1>\r\n          <p className=\"text-gray-600 mb-4\">\r\n            {(dict?.components?.protectedRoute?.noPermission || 'You don\\'t have permission to access this page. Required role: {roles}').replace('{roles}', requiredRoles.join(' or '))}\r\n          </p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return <>{children}</>;\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\components\\QRCodeDisplay.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":17,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":17,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[556,559],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[556,559],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useEffect, useState } from 'react';\r\nimport { QRCodeSVG } from 'qrcode.react';\r\nimport { useParams } from 'next/navigation';\r\nimport { getDictionaryClient } from '@/app/[tenant]/[lang]/dictionaries-client';\r\n\r\ninterface QRCodeDisplayProps {\r\n  qrToken: string;\r\n  name?: string;\r\n  onRegenerate?: () => void;\r\n}\r\n\r\nexport default function QRCodeDisplay({ qrToken, name, onRegenerate }: QRCodeDisplayProps) {\r\n  const params = useParams();\r\n  const lang = (params?.lang as 'en' | 'es') || 'en';\r\n  const [dict, setDict] = useState<any>(null);\r\n  const [copied, setCopied] = useState(false);\r\n\r\n  useEffect(() => {\r\n    getDictionaryClient(lang).then(setDict);\r\n  }, [lang]);\r\n\r\n  const copyToClipboard = () => {\r\n    navigator.clipboard.writeText(qrToken);\r\n    setCopied(true);\r\n    setTimeout(() => setCopied(false), 2000);\r\n  };\r\n\r\n  return (\r\n    <div className=\"flex flex-col items-center space-y-4 p-6 bg-white border-2 border-gray-300\">\r\n      {name && (\r\n        <div className=\"text-center\">\r\n          <h3 className=\"text-lg font-semibold text-gray-900\">{name}</h3>\r\n          <p className=\"text-sm text-gray-600\">{dict?.components?.qrCodeDisplay?.scanQRCodeToLogin || 'Scan this QR code to log in'}</p>\r\n        </div>\r\n      )}\r\n      \r\n      <div className=\"p-4 bg-white border-2 border-gray-300\">\r\n        <QRCodeSVG\r\n          value={qrToken}\r\n          size={200}\r\n          level=\"M\"\r\n          includeMargin={true}\r\n        />\r\n      </div>\r\n\r\n      <div className=\"w-full space-y-2\">\r\n        <button\r\n          onClick={copyToClipboard}\r\n          className=\"w-full px-4 py-2 text-sm font-medium text-blue-600 bg-blue-50 hover:bg-blue-100 transition-colors border border-blue-300\"\r\n        >\r\n          {copied ? (dict?.components?.qrCodeDisplay?.copied || ' Copied!') : (dict?.components?.qrCodeDisplay?.copyToken || 'Copy Token')}\r\n        </button>\r\n        \r\n        {onRegenerate && (\r\n          <button\r\n            onClick={onRegenerate}\r\n            className=\"w-full px-4 py-2 text-sm font-medium text-gray-600 bg-gray-50 hover:bg-gray-100 transition-colors border border-gray-300\"\r\n          >\r\n            {dict?.components?.qrCodeDisplay?.regenerateQRCode || 'Regenerate QR Code'}\r\n          </button>\r\n        )}\r\n      </div>\r\n\r\n      <p className=\"text-xs text-gray-500 text-center max-w-xs\">\r\n        {dict?.components?.qrCodeDisplay?.keepSecure || 'Keep this QR code secure. Anyone with access to it can log in as you.'}\r\n      </p>\r\n    </div>\r\n  );\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\components\\QRCodeScanner.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":17,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":17,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[590,593],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[590,593],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'isScanning' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":19,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":19,"endColumn":20},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":34,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":34,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1128,1131],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1128,1131],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'dict?.common?.failedToStartQRScanner'. Either include it or remove the dependency array. You can also replace multiple useState variables with useReducer if 'setError' needs the current value of 'dict.common.failedToStartQRScanner'.","line":46,"column":6,"nodeType":"ArrayExpression","endLine":46,"endColumn":23,"suggestions":[{"desc":"Update the dependencies array to be: [dict?.common?.failedToStartQRScanner, enabled, onScan]","fix":{"range":[1413,1430],"text":"[dict?.common?.failedToStartQRScanner, enabled, onScan]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useEffect, useRef, useState } from 'react';\r\nimport { useParams } from 'next/navigation';\r\nimport { hardwareService } from '@/lib/hardware';\r\nimport { getDictionaryClient } from '@/app/[tenant]/[lang]/dictionaries-client';\r\n\r\ninterface QRCodeScannerProps {\r\n  onScan: (data: string) => void;\r\n  onClose?: () => void;\r\n  enabled?: boolean;\r\n}\r\n\r\nexport default function QRCodeScanner({ onScan, onClose, enabled = true }: QRCodeScannerProps) {\r\n  const params = useParams();\r\n  const lang = (params?.lang as 'en' | 'es') || 'en';\r\n  const [dict, setDict] = useState<any>(null);\r\n  const videoRef = useRef<HTMLVideoElement>(null);\r\n  const [isScanning, setIsScanning] = useState(false);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  useEffect(() => {\r\n    getDictionaryClient(lang).then(setDict);\r\n  }, [lang]);\r\n\r\n  useEffect(() => {\r\n    if (!enabled || !videoRef.current) return;\r\n\r\n    const startScan = async () => {\r\n      try {\r\n        setIsScanning(true);\r\n        setError(null);\r\n        await hardwareService.startQRScanning(videoRef.current!, onScan);\r\n      } catch (err: any) {\r\n        setError(err.message || dict?.common?.failedToStartQRScanner || 'Failed to start QR scanner');\r\n        setIsScanning(false);\r\n      }\r\n    };\r\n\r\n    startScan();\r\n\r\n    return () => {\r\n      hardwareService.stopQRScanning();\r\n      setIsScanning(false);\r\n    };\r\n  }, [enabled, onScan]);\r\n\r\n  if (!enabled) return null;\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50\">\r\n      <div className=\"bg-white border border-gray-300 p-6 max-w-md w-full mx-4\">\r\n        <div className=\"flex justify-between items-center mb-4\">\r\n          <h2 className=\"text-xl font-bold\">{dict?.common?.scanQRCode || dict?.login?.scanQRCode || 'Scan QR Code'}</h2>\r\n          {onClose && (\r\n            <button\r\n              onClick={onClose}\r\n              className=\"text-gray-500 hover:text-gray-700\"\r\n            >\r\n              <svg className=\"w-6 h-6\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\r\n              </svg>\r\n            </button>\r\n          )}\r\n        </div>\r\n\r\n        {error ? (\r\n          <div className=\"text-red-600 mb-4\">{error}</div>\r\n        ) : (\r\n          <div className=\"relative\">\r\n            <video\r\n              ref={videoRef}\r\n              className=\"w-full border border-gray-300\"\r\n              autoPlay\r\n              playsInline\r\n              muted\r\n            />\r\n            <div className=\"absolute inset-0 border-4 border-blue-500 pointer-events-none\">\r\n              <div className=\"absolute top-2 left-2 w-8 h-8 border-t-4 border-l-4 border-blue-500\"></div>\r\n              <div className=\"absolute top-2 right-2 w-8 h-8 border-t-4 border-r-4 border-blue-500\"></div>\r\n              <div className=\"absolute bottom-2 left-2 w-8 h-8 border-b-4 border-l-4 border-blue-500\"></div>\r\n              <div className=\"absolute bottom-2 right-2 w-8 h-8 border-b-4 border-r-4 border-blue-500\"></div>\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        <p className=\"text-sm text-gray-600 mt-4 text-center\">\r\n          {dict?.common?.positionQRCode || 'Position the QR code within the frame'}\r\n        </p>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\components\\RealTimeStockTracker.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":40,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":40,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1000,1003],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1000,1003],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useEffect, useState, useRef } from 'react';\r\nimport { useParams } from 'next/navigation';\r\nimport { getDictionaryClient } from '@/app/[tenant]/[lang]/dictionaries-client';\r\n\r\ninterface StockUpdate {\r\n  type: string;\r\n  productId?: string;\r\n  branchId?: string;\r\n  variation?: {\r\n    size?: string;\r\n    color?: string;\r\n    type?: string;\r\n  };\r\n  movementType?: string;\r\n  quantity?: number;\r\n  newStock?: number;\r\n  previousStock?: number;\r\n  timestamp?: string;\r\n  message?: string;\r\n}\r\n\r\ninterface RealTimeStockTrackerProps {\r\n  productId?: string;\r\n  branchId?: string;\r\n  onStockUpdate?: (update: StockUpdate) => void;\r\n  showIndicator?: boolean;\r\n}\r\n\r\nexport default function RealTimeStockTracker({\r\n  productId,\r\n  branchId,\r\n  onStockUpdate,\r\n  showIndicator = true,\r\n}: RealTimeStockTrackerProps) {\r\n  const params = useParams();\r\n  const tenant = params.tenant as string;\r\n  const lang = (params?.lang as 'en' | 'es') || 'en';\r\n  const [dict, setDict] = useState<any>(null);\r\n  const [connected, setConnected] = useState(false);\r\n  const [lastUpdate, setLastUpdate] = useState<Date | null>(null);\r\n  const eventSourceRef = useRef<EventSource | null>(null);\r\n\r\n  useEffect(() => {\r\n    getDictionaryClient(lang).then(setDict);\r\n  }, [lang]);\r\n\r\n  useEffect(() => {\r\n    if (!tenant) return;\r\n\r\n    // Build SSE URL\r\n    let url = `/api/inventory/realtime?tenant=${tenant}`;\r\n    if (productId) url += `&productId=${productId}`;\r\n    if (branchId) url += `&branchId=${branchId}`;\r\n\r\n    // Create EventSource connection\r\n    const eventSource = new EventSource(url);\r\n    eventSourceRef.current = eventSource;\r\n\r\n    eventSource.onopen = () => {\r\n      setConnected(true);\r\n    };\r\n\r\n    eventSource.onmessage = (event) => {\r\n      try {\r\n        const data: StockUpdate = JSON.parse(event.data);\r\n        \r\n        if (data.type === 'connected') {\r\n          setConnected(true);\r\n        } else if (data.type === 'stock_update') {\r\n          setLastUpdate(new Date());\r\n          onStockUpdate?.(data);\r\n        } else if (data.type === 'heartbeat') {\r\n          // Keep connection alive\r\n        } else if (data.type === 'error') {\r\n          console.error('SSE Error:', data.message);\r\n          setConnected(false);\r\n        }\r\n      } catch (error) {\r\n        console.error('Error parsing SSE message:', error);\r\n      }\r\n    };\r\n\r\n    eventSource.onerror = (error) => {\r\n      console.error('SSE connection error:', error);\r\n      setConnected(false);\r\n      \r\n      // Attempt to reconnect after 5 seconds\r\n      setTimeout(() => {\r\n        if (eventSourceRef.current?.readyState === EventSource.CLOSED) {\r\n          eventSource.close();\r\n          // Reconnect will happen via useEffect\r\n        }\r\n      }, 5000);\r\n    };\r\n\r\n    return () => {\r\n      eventSource.close();\r\n      eventSourceRef.current = null;\r\n    };\r\n  }, [tenant, productId, branchId, onStockUpdate]);\r\n\r\n  if (!showIndicator) {\r\n    return null;\r\n  }\r\n\r\n  return (\r\n    <div className=\"flex items-center gap-2 text-xs\">\r\n      <div\r\n        className={`w-2 h-2 border border-gray-300 ${\r\n          connected ? 'bg-green-500 animate-pulse' : 'bg-red-500'\r\n        }`}\r\n        title={connected ? (dict?.components?.realtimeStockTracker?.connected || 'Connected') : (dict?.components?.realtimeStockTracker?.disconnected || 'Disconnected')}\r\n      />\r\n      <span className=\"text-gray-500\">\r\n        {connected ? (dict?.components?.realtimeStockTracker?.live || 'Live') : (dict?.components?.realtimeStockTracker?.offline || 'Offline')}\r\n      </span>\r\n      {lastUpdate && (\r\n        <span className=\"text-gray-400\">\r\n           {(dict?.components?.realtimeStockTracker?.updated || 'Updated {time}').replace('{time}', lastUpdate.toLocaleTimeString())}\r\n        </span>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\components\\SalesChart.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":15,"column":9,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":15,"endColumn":12,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[468,471],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[468,471],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":100,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":100,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3852,3855],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3852,3855],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer } from 'recharts';\r\nimport { useTenantSettings } from '@/contexts/TenantSettingsContext';\r\nimport { formatCurrency, formatNumber, getCurrencySymbol, getDefaultTenantSettings } from '@/lib/currency';\r\n\r\ninterface ChartDataPoint {\r\n  date: string;\r\n  sales: number;\r\n  transactions: number;\r\n}\r\n\r\ninterface SalesChartProps {\r\n  data: ChartDataPoint[];\r\n  dict: any;\r\n}\r\n\r\nexport default function SalesChart({ data, dict }: SalesChartProps) {\r\n  const { settings } = useTenantSettings();\r\n  const tenantSettings = settings || getDefaultTenantSettings();\r\n  \r\n  console.log('[SalesChart] Received data:', data);\r\n  \r\n  // Validate and ensure data is properly formatted\r\n  const chartData = (data || []).map((item) => {\r\n    const salesValue = typeof item.sales === 'number' ? item.sales : parseFloat(String(item.sales)) || 0;\r\n    const transactionsValue = typeof item.transactions === 'number' ? item.transactions : parseInt(String(item.transactions)) || 0;\r\n    return {\r\n      date: String(item.date || ''),\r\n      sales: salesValue,\r\n      transactions: transactionsValue,\r\n    };\r\n  }).filter((item) => item.sales >= 0 && item.transactions >= 0); // Ensure valid numeric values\r\n\r\n  console.log('[SalesChart] Processed chart data:', chartData);\r\n\r\n  // Helper function to format currency for Y-axis (shorter format without decimals for readability)\r\n  const formatYAxisValue = (value: number) => {\r\n    // Round to whole number for Y-axis readability\r\n    const rounded = Math.round(value);\r\n    // Format number with no decimals for Y-axis\r\n    const numberFormat = {\r\n      ...tenantSettings.numberFormat,\r\n      decimalPlaces: 0,\r\n    };\r\n    const formatted = formatNumber(rounded, numberFormat);\r\n    const symbol = tenantSettings.currencySymbol || getCurrencySymbol(tenantSettings.currency);\r\n    if (tenantSettings.currencyPosition === 'after') {\r\n      return `${formatted} ${symbol}`;\r\n    }\r\n    return `${symbol}${formatted}`;\r\n  };\r\n\r\n  if (!chartData || chartData.length === 0) {\r\n    return (\r\n      <div className=\"w-full h-64 sm:h-80 lg:h-96 flex items-center justify-center\">\r\n        <div className=\"text-center\">\r\n          <svg className=\"mx-auto h-16 w-16 text-gray-300 mb-4\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z\" />\r\n          </svg>\r\n          <p className=\"text-gray-500 text-lg\">{dict?.components?.salesChart?.noChartDataAvailable || 'No chart data available'}</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"w-full h-64 sm:h-80 lg:h-96\">\r\n      <ResponsiveContainer width=\"100%\" height=\"100%\">\r\n        <LineChart\r\n          data={chartData}\r\n          margin={{\r\n            top: 5,\r\n            right: 30,\r\n            left: 20,\r\n            bottom: 5,\r\n          }}\r\n        >\r\n          <CartesianGrid strokeDasharray=\"3 3\" stroke=\"#e5e7eb\" />\r\n          <XAxis \r\n            dataKey=\"date\" \r\n            stroke=\"#6b7280\"\r\n            style={{ fontSize: '12px' }}\r\n            angle={-45}\r\n            textAnchor=\"end\"\r\n            height={60}\r\n          />\r\n          <YAxis \r\n            stroke=\"#6b7280\"\r\n            style={{ fontSize: '12px' }}\r\n            tickFormatter={(value) => formatYAxisValue(value)}\r\n          />\r\n          <Tooltip \r\n            contentStyle={{ \r\n              backgroundColor: '#fff', \r\n              border: '1px solid #d1d5db',\r\n              borderRadius: '0px',\r\n              boxShadow: 'none'\r\n            }}\r\n            formatter={(value: any) => {\r\n              const numValue = typeof value === 'number' ? value : parseFloat(String(value));\r\n              return formatCurrency(numValue, tenantSettings);\r\n            }}\r\n            labelFormatter={(label) => `${dict.dashboard?.date || 'Date'}: ${label}`}\r\n          />\r\n          <Legend />\r\n          <Line\r\n            type=\"monotone\"\r\n            dataKey=\"sales\"\r\n            stroke={tenantSettings.primaryColor || '#2563eb'}\r\n            strokeWidth={2}\r\n            dot={{ fill: tenantSettings.primaryColor || '#2563eb', r: 4 }}\r\n            activeDot={{ r: 6 }}\r\n            name={dict.dashboard?.totalSales || 'Total Sales'}\r\n          />\r\n        </LineChart>\r\n      </ResponsiveContainer>\r\n    </div>\r\n  );\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\components\\StockRefillModal.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":24,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":24,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[666,669],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[666,669],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport { useParams } from 'next/navigation';\r\nimport { getDictionaryClient } from '@/app/[tenant]/[lang]/dictionaries-client';\r\n\r\ninterface Product {\r\n  _id: string;\r\n  name: string;\r\n  stock: number;\r\n  sku?: string;\r\n}\r\n\r\ninterface StockRefillModalProps {\r\n  product: Product | null;\r\n  onClose: () => void;\r\n  onSuccess: () => void;\r\n  lang?: 'en' | 'es';\r\n}\r\n\r\nexport default function StockRefillModal({ product, onClose, onSuccess, lang = 'en' }: StockRefillModalProps) {\r\n  const params = useParams();\r\n  const tenant = (params?.tenant as string) || 'default';\r\n  const [dict, setDict] = useState<any>(null);\r\n  const [quantity, setQuantity] = useState('');\r\n  const [notes, setNotes] = useState('');\r\n  const [loading, setLoading] = useState(false);\r\n  const [error, setError] = useState('');\r\n\r\n  useEffect(() => {\r\n    getDictionaryClient(lang).then(setDict);\r\n  }, [lang]);\r\n\r\n  useEffect(() => {\r\n    if (product) {\r\n      setQuantity('');\r\n      setNotes('');\r\n      setError('');\r\n    }\r\n  }, [product]);\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    setError('');\r\n    \r\n    const qty = parseInt(quantity);\r\n    if (!qty || qty <= 0) {\r\n      setError(dict?.products.refill?.invalidQuantity || 'Please enter a valid quantity');\r\n      return;\r\n    }\r\n\r\n    if (!product) {\r\n      setError(dict?.products.refill?.productNotFound || 'Product not found');\r\n      return;\r\n    }\r\n\r\n    setLoading(true);\r\n\r\n    try {\r\n      const res = await fetch(`/api/products/${product._id}/refill?tenant=${tenant}`, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({\r\n          quantity: qty,\r\n          notes: notes.trim() || undefined,\r\n        }),\r\n      });\r\n\r\n      const data = await res.json();\r\n      if (data.success) {\r\n        onSuccess();\r\n        onClose();\r\n      } else {\r\n        setError(data.error || (dict?.products.refill?.error || 'Failed to refill stock'));\r\n      }\r\n    } catch (error) {\r\n      console.error('Error refilling stock:', error);\r\n      setError(dict?.products.refill?.error || 'Failed to refill stock');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  if (!dict || !product) {\r\n    return null;\r\n  }\r\n\r\n  return (\r\n    <div \r\n      className=\"fixed inset-0 bg-gray-900/30 backdrop-blur-md z-50\"\r\n      onClick={onClose}\r\n    >\r\n      <div \r\n        className=\"absolute inset-y-0 right-0 w-full max-w-md bg-white border-l border-gray-300 flex flex-col animate-slide-in-right\"\r\n        onClick={(e) => e.stopPropagation()}\r\n      >\r\n        <div className=\"flex items-center justify-between p-5 sm:p-6 border-b border-gray-200\">\r\n          <h2 className=\"text-xl sm:text-2xl font-bold text-gray-900\">\r\n            {dict.products.refill?.title || 'Refill Stock'}\r\n          </h2>\r\n          <button\r\n            onClick={onClose}\r\n            className=\"text-gray-400 hover:text-gray-600 transition-colors\"\r\n          >\r\n            <svg className=\"w-6 h-6\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\r\n            </svg>\r\n          </button>\r\n        </div>\r\n        <div className=\"flex-1 overflow-y-auto p-5 sm:p-6\">\r\n        <div className=\"mb-4 p-3 bg-gray-50 border border-gray-300\">\r\n          <div className=\"text-sm text-gray-600 mb-1\">\r\n            {dict?.products?.name || 'Product'}\r\n          </div>\r\n          <div className=\"font-semibold text-gray-900\">{product.name}</div>\r\n          {product.sku && (\r\n            <div className=\"text-xs text-gray-500 mt-1\">SKU: {product.sku}</div>\r\n          )}\r\n          <div className=\"text-sm text-gray-600 mt-2\">\r\n            {dict?.products?.currentStock || dict?.products?.stock || 'Current Stock'}: <span className=\"font-semibold\">{product.stock}</span>\r\n          </div>\r\n        </div>\r\n\r\n        <form onSubmit={handleSubmit} className=\"space-y-4\">\r\n          <div>\r\n            <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n              {dict.products.refill?.quantity || 'Quantity to Add'} *\r\n            </label>\r\n            <input\r\n              type=\"number\"\r\n              min=\"1\"\r\n              step=\"1\"\r\n              required\r\n              value={quantity}\r\n              onChange={(e) => setQuantity(e.target.value)}\r\n              className=\"w-full px-3 py-2.5 text-base border border-gray-300 focus:ring-2 focus:ring-blue-500 bg-white\"\r\n              placeholder=\"0\"\r\n              autoFocus\r\n            />\r\n            {quantity && parseInt(quantity) > 0 && (\r\n              <div className=\"mt-2 text-sm text-gray-600\">\r\n                {dict.products.refill?.newStock || 'New Stock'}: <span className=\"font-semibold text-blue-600\">\r\n                  {product.stock + parseInt(quantity)}\r\n                </span>\r\n              </div>\r\n            )}\r\n          </div>\r\n\r\n          <div>\r\n            <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n              {dict.products.refill?.notes || 'Notes'} (optional)\r\n            </label>\r\n            <textarea\r\n              value={notes}\r\n              onChange={(e) => setNotes(e.target.value)}\r\n              className=\"w-full px-3 py-2.5 text-base border border-gray-300 focus:ring-2 focus:ring-blue-500 bg-white\"\r\n              rows={3}\r\n              placeholder={dict.products.refill?.notesPlaceholder || 'Add any notes about this refill...'}\r\n            />\r\n          </div>\r\n\r\n          {error && (\r\n            <div className=\"p-3 bg-red-50 border border-red-300 text-red-700 text-sm\">\r\n              {error}\r\n            </div>\r\n          )}\r\n\r\n          <div className=\"flex flex-col sm:flex-row justify-end gap-2 pt-4\">\r\n            <button\r\n              type=\"button\"\r\n              onClick={onClose}\r\n              disabled={loading}\r\n              className=\"w-full sm:w-auto px-4 py-2.5 border border-gray-300 text-gray-700 hover:bg-gray-50 active:bg-gray-100 font-medium disabled:opacity-50 bg-white\"\r\n            >\r\n              {dict.common.cancel}\r\n            </button>\r\n            <button\r\n              type=\"submit\"\r\n              disabled={loading}\r\n              className=\"w-full sm:w-auto px-4 py-2.5 bg-blue-600 text-white hover:bg-blue-700 active:bg-blue-800 disabled:opacity-50 disabled:cursor-not-allowed font-medium border border-blue-700\"\r\n            >\r\n              {loading ? (dict.common.loading || 'Loading...') : (dict.products.refill?.submit || 'Refill Stock')}\r\n            </button>\r\n          </div>\r\n        </form>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\components\\SubscriptionGuard.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'SubscriptionService' is defined but never used. Allowed unused vars must match /^_/u.","line":6,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":29},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'createTrialSubscription'. Either include it or remove the dependency array.","line":58,"column":6,"nodeType":"ArrayExpression","endLine":58,"endColumn":78,"suggestions":[{"desc":"Update the dependencies array to be: [subscriptionStatus, loading, tenant, lang, router, refreshSubscription, createTrialSubscription]","fix":{"range":[1981,2053],"text":"[subscriptionStatus, loading, tenant, lang, router, refreshSubscription, createTrialSubscription]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { ReactNode, useEffect, useState } from 'react';\r\nimport { useRouter, useParams } from 'next/navigation';\r\nimport { useSubscription } from '@/contexts/SubscriptionContext';\r\nimport { SubscriptionService } from '@/lib/subscription';\r\nimport { Loader2 } from 'lucide-react';\r\n\r\ninterface SubscriptionGuardProps {\r\n  children: ReactNode;\r\n}\r\n\r\nexport function SubscriptionGuard({ children }: SubscriptionGuardProps) {\r\n  const { subscriptionStatus, loading, refreshSubscription } = useSubscription();\r\n  const router = useRouter();\r\n  const params = useParams();\r\n  const tenant = params.tenant as string;\r\n  const lang = params.lang as string;\r\n  const [isCreatingTrial, setIsCreatingTrial] = useState(false);\r\n\r\n  useEffect(() => {\r\n    const handleSubscriptionCheck = async () => {\r\n      // If still loading, wait\r\n      if (loading) return;\r\n\r\n      // If no subscription exists, create a trial\r\n      if (!subscriptionStatus) {\r\n        setIsCreatingTrial(true);\r\n        try {\r\n          await createTrialSubscription();\r\n          await refreshSubscription();\r\n        } catch (error) {\r\n          console.error('Failed to create trial subscription:', error);\r\n          // Redirect to subscription page if trial creation fails\r\n          router.push(`/${tenant}/${lang}/subscription`);\r\n        } finally {\r\n          setIsCreatingTrial(false);\r\n        }\r\n        return;\r\n      }\r\n\r\n      // If trial has expired, redirect to subscription page\r\n      if (subscriptionStatus.isTrial && subscriptionStatus.isTrialExpired) {\r\n        router.push(`/${tenant}/${lang}/subscription`);\r\n        return;\r\n      }\r\n\r\n      // If subscription is not active and not in trial, redirect\r\n      if (!subscriptionStatus.isActive && !subscriptionStatus.isTrial) {\r\n        router.push(`/${tenant}/${lang}/subscription`);\r\n        return;\r\n      }\r\n\r\n      // Allow access if subscription is active or trial is active\r\n    };\r\n\r\n    handleSubscriptionCheck();\r\n  }, [subscriptionStatus, loading, tenant, lang, router, refreshSubscription]);\r\n\r\n  const createTrialSubscription = async () => {\r\n    try {\r\n      // Get the tenant ID from the params (this is the tenant slug)\r\n      const tenantSlug = tenant;\r\n\r\n      // We need to get the actual tenant ID from the database\r\n      // Since we can't directly query mongoose in client components,\r\n      // we'll use the API to create the trial subscription\r\n      const response = await fetch('/api/subscriptions/create-trial', {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ tenantSlug }),\r\n      });\r\n\r\n      const result = await response.json();\r\n\r\n      if (!result.success) {\r\n        throw new Error(result.error || 'Failed to create trial subscription');\r\n      }\r\n\r\n    } catch (error) {\r\n      console.error('Error creating trial subscription:', error);\r\n      throw error;\r\n    }\r\n  };\r\n\r\n  // Show loading while checking/creating subscription\r\n  if (loading || isCreatingTrial) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gray-50 flex items-center justify-center\">\r\n        <div className=\"text-center\">\r\n          <Loader2 className=\"h-8 w-8 animate-spin mx-auto mb-4\" />\r\n          <p className=\"text-gray-600\">\r\n            {isCreatingTrial ? 'Setting up your trial...' : 'Checking subscription...'}\r\n          </p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // If no subscription and not creating trial, show loading\r\n  if (!subscriptionStatus && !isCreatingTrial) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gray-50 flex items-center justify-center\">\r\n        <div className=\"text-center\">\r\n          <Loader2 className=\"h-8 w-8 animate-spin mx-auto mb-4\" />\r\n          <p className=\"text-gray-600\">Preparing your account...</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // Allow access if we have a valid subscription\r\n  return <>{children}</>;\r\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\components\\SubscriptionStatusBar.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Crown' is defined but never used. Allowed unused vars must match /^_/u.","line":4,"column":54,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":59}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useSubscription } from '@/contexts/SubscriptionContext';\r\nimport { AlertTriangle, CheckCircle, Clock, XCircle, Crown } from 'lucide-react';\r\nimport { useParams } from 'next/navigation';\r\nimport Link from 'next/link';\r\n\r\nexport function SubscriptionStatusBar() {\r\n  const { subscriptionStatus, loading } = useSubscription();\r\n  const params = useParams();\r\n  const tenant = params.tenant as string;\r\n  const lang = params.lang as string;\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"bg-blue-50 border-b border-blue-200 px-4 py-3\">\r\n        <div className=\"max-w-7xl mx-auto flex items-center justify-between\">\r\n          <div className=\"animate-pulse flex items-center space-x-3\">\r\n            <div className=\"w-5 h-5 bg-blue-300 rounded\"></div>\r\n            <div className=\"h-4 bg-blue-300 rounded w-48\"></div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (!subscriptionStatus) {\r\n    return (\r\n      <div className=\"bg-amber-50 border-b border-amber-200 px-4 py-3\">\r\n        <div className=\"max-w-7xl mx-auto flex items-center justify-between\">\r\n          <div className=\"flex items-center space-x-3\">\r\n            <AlertTriangle className=\"w-5 h-5 text-amber-600\" />\r\n            <div>\r\n              <p className=\"text-sm font-medium text-amber-800\">No Active Subscription</p>\r\n              <p className=\"text-xs text-amber-700\">Some features may be limited</p>\r\n            </div>\r\n          </div>\r\n          <Link href={`/${tenant}/${lang}/admin/subscriptions`}>\r\n            <button className=\"px-3 py-1 text-sm font-medium border border-amber-300 text-amber-700 rounded hover:bg-amber-50\">\r\n              View Plans\r\n            </button>\r\n          </Link>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  const getStatusConfig = () => {\r\n    if (subscriptionStatus.isTrial && subscriptionStatus.isTrialExpired) {\r\n      return {\r\n        bgColor: 'bg-red-50',\r\n        borderColor: 'border-red-200',\r\n        icon: <XCircle className=\"w-5 h-5 text-red-600\" />,\r\n        title: 'Trial Expired',\r\n        description: 'Your trial has ended. Upgrade to continue using all features.',\r\n        badge: <span className=\"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800\">Expired</span>,\r\n        action: 'Upgrade Now',\r\n        actionVariant: 'default' as const,\r\n      };\r\n    }\r\n\r\n    if (subscriptionStatus.isExpired) {\r\n      return {\r\n        bgColor: 'bg-red-50',\r\n        borderColor: 'border-red-200',\r\n        icon: <XCircle className=\"w-5 h-5 text-red-600\" />,\r\n        title: 'Subscription Expired',\r\n        description: 'Your subscription has expired. Renew to continue using all features.',\r\n        badge: <span className=\"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800\">Expired</span>,\r\n        action: 'Renew Now',\r\n        actionVariant: 'default' as const,\r\n      };\r\n    }\r\n\r\n    if (subscriptionStatus.isTrial && !subscriptionStatus.isTrialExpired) {\r\n      const trialEndDate = subscriptionStatus.trialEndDate ? new Date(subscriptionStatus.trialEndDate) : null;\r\n      const daysLeft = trialEndDate\r\n        ? Math.ceil((trialEndDate.getTime() - new Date().getTime()) / (1000 * 60 * 60 * 24))\r\n        : 0;\r\n\r\n      return {\r\n        bgColor: 'bg-blue-50',\r\n        borderColor: 'border-blue-200',\r\n        icon: <Clock className=\"w-5 h-5 text-blue-600\" />,\r\n        title: 'Trial Period',\r\n        description: `${Math.max(0, daysLeft)} days remaining in your trial.`,\r\n        badge: <span className=\"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800\">Trial</span>,\r\n        action: 'Upgrade Now',\r\n        actionVariant: 'outline' as const,\r\n      };\r\n    }\r\n\r\n    if (!subscriptionStatus.isActive) {\r\n      return {\r\n        bgColor: 'bg-amber-50',\r\n        borderColor: 'border-amber-200',\r\n        icon: <AlertTriangle className=\"w-5 h-5 text-amber-600\" />,\r\n        title: 'Subscription Inactive',\r\n        description: 'Your subscription is currently inactive.',\r\n        badge: <span className=\"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800 border border-gray-300\">Inactive</span>,\r\n        action: 'Reactivate',\r\n        actionVariant: 'outline' as const,\r\n      };\r\n    }\r\n\r\n    // Active subscription\r\n    return {\r\n      bgColor: 'bg-green-50',\r\n      borderColor: 'border-green-200',\r\n      icon: <CheckCircle className=\"w-5 h-5 text-green-600\" />,\r\n      title: `Active: ${subscriptionStatus.planName} Plan`,\r\n      description: subscriptionStatus.nextBillingDate\r\n        ? `Next billing: ${new Date(subscriptionStatus.nextBillingDate).toLocaleDateString()}`\r\n        : 'Subscription active',\r\n      badge: <span className=\"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800\">Active</span>,\r\n      action: 'Manage',\r\n      actionVariant: 'outline' as const,\r\n    };\r\n  };\r\n\r\n  const config = getStatusConfig();\r\n\r\n  return (\r\n    <div className={`${config.bgColor} border-b ${config.borderColor} px-4 py-3`}>\r\n      <div className=\"max-w-7xl mx-auto flex items-center justify-between\">\r\n        <div className=\"flex items-center space-x-3\">\r\n          {config.icon}\r\n          <div>\r\n            <div className=\"flex items-center space-x-2\">\r\n              <p className=\"text-sm font-medium text-gray-800\">{config.title}</p>\r\n              {config.badge}\r\n            </div>\r\n            <p className=\"text-xs text-gray-600\">{config.description}</p>\r\n          </div>\r\n        </div>\r\n        <Link href={`/${tenant}/${lang}/admin/subscriptions`}>\r\n          <button className={`px-3 py-1 rounded text-sm font-medium ${\r\n            config.actionVariant === 'default'\r\n              ? 'bg-blue-600 text-white hover:bg-blue-700'\r\n              : 'bg-gray-100 text-gray-700 hover:bg-gray-200'\r\n          }`}>\r\n            {config.action}\r\n          </button>\r\n        </Link>\r\n      </div>\r\n    </div>\r\n  );\r\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\components\\TenantAccessGuard.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useEffect' is defined but never used. Allowed unused vars must match /^_/u.","line":3,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'router' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":16,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":16,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'params' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":17,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":17,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'userTenantSlug' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":18,"column":29,"nodeType":null,"messageId":"unusedVar","endLine":18,"endColumn":43},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'requestedTenantSlug' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":18,"column":45,"nodeType":null,"messageId":"unusedVar","endLine":18,"endColumn":64}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useEffect } from 'react';\r\nimport { useRouter, useParams } from 'next/navigation';\r\nimport { useTenantAccess } from '@/hooks/useTenantAccess';\r\n\r\ninterface TenantAccessGuardProps {\r\n  children: React.ReactNode;\r\n}\r\n\r\n/**\r\n * Client-side component that guards against tenant access violations\r\n * This runs before the page renders to catch unauthorized tenant access\r\n */\r\nexport default function TenantAccessGuard({ children }: TenantAccessGuardProps) {\r\n  const router = useRouter();\r\n  const params = useParams();\r\n  const { isValid, loading, userTenantSlug, requestedTenantSlug } = useTenantAccess();\r\n\r\n  // If tenant access is invalid, the hook will redirect to forbidden page\r\n  // We just need to show loading state while checking\r\n  if (loading) {\r\n    return (\r\n      <div className=\"min-h-screen flex items-center justify-center\">\r\n        <div className=\"text-center\">\r\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4\"></div>\r\n          <p className=\"text-gray-600\">Verifying access...</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // If access is invalid, don't render children (redirect is happening)\r\n  if (!isValid) {\r\n    return null;\r\n  }\r\n\r\n  return <>{children}</>;\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\components\\ToastProvider.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\components\\settings\\BusinessHoursManager.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":18,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":18,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[727,730],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[727,730],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":19,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":19,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[796,799],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[796,799],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchBusinessHours'. Either include it or remove the dependency array.","line":24,"column":6,"nodeType":"ArrayExpression","endLine":24,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [fetchBusinessHours]","fix":{"range":[912,914],"text":"[fetchBusinessHours]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":37,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":37,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1399,1402],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1399,1402],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":62,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":62,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2263,2266],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2263,2266],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":69,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":69,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2473,2476],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2473,2476],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":92,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":92,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2903,2906],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2903,2906],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport { ITenantSettings } from '@/models/Tenant';\r\n\r\ninterface BusinessHoursManagerProps {\r\n  settings: ITenantSettings;\r\n  tenant: string;\r\n  onUpdate: (updates: Partial<ITenantSettings>) => void;\r\n}\r\n\r\nconst DAYS = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday'];\r\n\r\nexport default function BusinessHoursManager({ settings, tenant, onUpdate }: BusinessHoursManagerProps) {\r\n  const [loading, setLoading] = useState(true);\r\n  const [saving, setSaving] = useState(false);\r\n  const [message, setMessage] = useState<{ type: 'success' | 'error'; text: string } | null>(null);\r\n  const [schedule, setSchedule] = useState<Record<string, any>>({});\r\n  const [specialHours, setSpecialHours] = useState<Array<any>>([]);\r\n  const [timezone, setTimezone] = useState('');\r\n\r\n  useEffect(() => {\r\n    fetchBusinessHours();\r\n  }, []);\r\n\r\n  const fetchBusinessHours = async () => {\r\n    try {\r\n      setLoading(true);\r\n      const res = await fetch(`/api/tenants/${tenant}/business-hours`, { credentials: 'include' });\r\n      const data = await res.json();\r\n      if (data.success) {\r\n        const hours = data.data || {};\r\n        setSchedule(hours.schedule || {});\r\n        setSpecialHours(hours.specialHours || []);\r\n        setTimezone(hours.timezone || settings.timezone || 'UTC');\r\n      }\r\n    } catch (error: any) {\r\n      setMessage({ type: 'error', text: error.message || 'Failed to load business hours' });\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleSave = async () => {\r\n    try {\r\n      setSaving(true);\r\n      setMessage(null);\r\n      const res = await fetch(`/api/tenants/${tenant}/business-hours`, {\r\n        method: 'PUT',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        credentials: 'include',\r\n        body: JSON.stringify({ schedule, specialHours, timezone }),\r\n      });\r\n\r\n      const data = await res.json();\r\n      if (data.success) {\r\n        setMessage({ type: 'success', text: 'Business hours saved successfully' });\r\n        onUpdate({ businessHours: data.data });\r\n      } else {\r\n        setMessage({ type: 'error', text: data.error || 'Failed to save business hours' });\r\n      }\r\n    } catch (error: any) {\r\n      setMessage({ type: 'error', text: error.message || 'Failed to save business hours' });\r\n    } finally {\r\n      setSaving(false);\r\n    }\r\n  };\r\n\r\n  const updateDaySchedule = (day: string, updates: any) => {\r\n    setSchedule({\r\n      ...schedule,\r\n      [day]: {\r\n        ...schedule[day],\r\n        ...updates,\r\n      },\r\n    });\r\n  };\r\n\r\n  const addSpecialHour = () => {\r\n    setSpecialHours([\r\n      ...specialHours,\r\n      {\r\n        date: '',\r\n        enabled: true,\r\n        openTime: '09:00',\r\n        closeTime: '17:00',\r\n        note: '',\r\n      },\r\n    ]);\r\n  };\r\n\r\n  const updateSpecialHour = (index: number, updates: any) => {\r\n    const updated = [...specialHours];\r\n    updated[index] = { ...updated[index], ...updates };\r\n    setSpecialHours(updated);\r\n  };\r\n\r\n  const removeSpecialHour = (index: number) => {\r\n    setSpecialHours(specialHours.filter((_, i) => i !== index));\r\n  };\r\n\r\n  if (loading) {\r\n    return <div className=\"text-center py-8\">Loading business hours...</div>;\r\n  }\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      {message && (\r\n        <div\r\n          className={`p-3 rounded ${\r\n            message.type === 'success' ? 'bg-green-50 text-green-800' : 'bg-red-50 text-red-800'\r\n          }`}\r\n        >\r\n          {message.text}\r\n        </div>\r\n      )}\r\n\r\n      <div>\r\n        <label className=\"block text-sm font-medium text-gray-700 mb-2\">Timezone</label>\r\n        <input\r\n          type=\"text\"\r\n          value={timezone}\r\n          onChange={(e) => setTimezone(e.target.value)}\r\n          className=\"w-full px-4 py-2 border-2 border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\r\n          placeholder=\"America/New_York\"\r\n        />\r\n      </div>\r\n\r\n      <div>\r\n        <h3 className=\"text-lg font-semibold text-gray-900 mb-4\">Weekly Schedule</h3>\r\n        <div className=\"space-y-3\">\r\n          {DAYS.map((day) => {\r\n            const daySchedule = schedule[day] || { enabled: false, openTime: '09:00', closeTime: '17:00', breaks: [] };\r\n            return (\r\n              <div key={day} className=\"p-4 border-2 border-gray-300 rounded\">\r\n                <div className=\"flex items-center justify-between mb-3\">\r\n                  <label className=\"flex items-center space-x-2\">\r\n                    <input\r\n                      type=\"checkbox\"\r\n                      checked={daySchedule.enabled || false}\r\n                      onChange={(e) => updateDaySchedule(day, { enabled: e.target.checked })}\r\n                      className=\"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500\"\r\n                    />\r\n                    <span className=\"text-sm font-medium text-gray-700 capitalize\">{day}</span>\r\n                  </label>\r\n                </div>\r\n                {daySchedule.enabled && (\r\n                  <div className=\"grid grid-cols-2 gap-3 mt-3\">\r\n                    <div>\r\n                      <label className=\"block text-xs text-gray-600 mb-1\">Open Time</label>\r\n                      <input\r\n                        type=\"time\"\r\n                        value={daySchedule.openTime || '09:00'}\r\n                        onChange={(e) => updateDaySchedule(day, { openTime: e.target.value })}\r\n                        className=\"w-full px-3 py-2 border border-gray-300 rounded\"\r\n                      />\r\n                    </div>\r\n                    <div>\r\n                      <label className=\"block text-xs text-gray-600 mb-1\">Close Time</label>\r\n                      <input\r\n                        type=\"time\"\r\n                        value={daySchedule.closeTime || '17:00'}\r\n                        onChange={(e) => updateDaySchedule(day, { closeTime: e.target.value })}\r\n                        className=\"w-full px-3 py-2 border border-gray-300 rounded\"\r\n                      />\r\n                    </div>\r\n                  </div>\r\n                )}\r\n              </div>\r\n            );\r\n          })}\r\n        </div>\r\n      </div>\r\n\r\n      <div>\r\n        <div className=\"flex items-center justify-between mb-4\">\r\n          <h3 className=\"text-lg font-semibold text-gray-900\">Special Hours</h3>\r\n          <button\r\n            onClick={addSpecialHour}\r\n            className=\"px-3 py-1 text-sm bg-blue-600 text-white font-medium hover:bg-blue-700\"\r\n          >\r\n            Add Special Hours\r\n          </button>\r\n        </div>\r\n        <div className=\"space-y-3\">\r\n          {specialHours.map((special, index) => (\r\n            <div key={index} className=\"p-4 border-2 border-gray-300 rounded\">\r\n              <div className=\"grid grid-cols-1 md:grid-cols-4 gap-3\">\r\n                <div>\r\n                  <label className=\"block text-xs text-gray-600 mb-1\">Date</label>\r\n                  <input\r\n                    type=\"date\"\r\n                    value={special.date || ''}\r\n                    onChange={(e) => updateSpecialHour(index, { date: e.target.value })}\r\n                    className=\"w-full px-3 py-2 border border-gray-300 rounded\"\r\n                  />\r\n                </div>\r\n                <div className=\"flex items-center pt-6\">\r\n                  <input\r\n                    type=\"checkbox\"\r\n                    checked={special.enabled !== false}\r\n                    onChange={(e) => updateSpecialHour(index, { enabled: e.target.checked })}\r\n                    className=\"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500\"\r\n                  />\r\n                  <label className=\"ml-2 text-xs text-gray-700\">Open</label>\r\n                </div>\r\n                {special.enabled && (\r\n                  <>\r\n                    <div>\r\n                      <label className=\"block text-xs text-gray-600 mb-1\">Open Time</label>\r\n                      <input\r\n                        type=\"time\"\r\n                        value={special.openTime || '09:00'}\r\n                        onChange={(e) => updateSpecialHour(index, { openTime: e.target.value })}\r\n                        className=\"w-full px-3 py-2 border border-gray-300 rounded\"\r\n                      />\r\n                    </div>\r\n                    <div>\r\n                      <label className=\"block text-xs text-gray-600 mb-1\">Close Time</label>\r\n                      <input\r\n                        type=\"time\"\r\n                        value={special.closeTime || '17:00'}\r\n                        onChange={(e) => updateSpecialHour(index, { closeTime: e.target.value })}\r\n                        className=\"w-full px-3 py-2 border border-gray-300 rounded\"\r\n                      />\r\n                    </div>\r\n                  </>\r\n                )}\r\n                <div className=\"md:col-span-4\">\r\n                  <label className=\"block text-xs text-gray-600 mb-1\">Note (Optional)</label>\r\n                  <input\r\n                    type=\"text\"\r\n                    value={special.note || ''}\r\n                    onChange={(e) => updateSpecialHour(index, { note: e.target.value })}\r\n                    className=\"w-full px-3 py-2 border border-gray-300 rounded\"\r\n                    placeholder=\"e.g., Holiday hours\"\r\n                  />\r\n                </div>\r\n              </div>\r\n              <button\r\n                onClick={() => removeSpecialHour(index)}\r\n                className=\"mt-2 px-3 py-1 text-xs text-red-600 hover:text-red-700 font-medium\"\r\n              >\r\n                Remove\r\n              </button>\r\n            </div>\r\n          ))}\r\n          {specialHours.length === 0 && (\r\n            <div className=\"text-center py-4 text-gray-500 text-sm\">\r\n              No special hours configured. Add special hours for holidays or special events.\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"flex items-center space-x-3\">\r\n        <button\r\n          onClick={handleSave}\r\n          disabled={saving}\r\n          className=\"px-6 py-2 bg-blue-600 text-white font-medium hover:bg-blue-700 disabled:bg-gray-400\"\r\n        >\r\n          {saving ? 'Saving...' : 'Save Business Hours'}\r\n        </button>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\components\\settings\\HolidaysManager.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'settings' is defined but never used. Allowed unused args must match /^_/u.","line":27,"column":43,"nodeType":null,"messageId":"unusedVar","endLine":27,"endColumn":51},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'onUpdate' is defined but never used. Allowed unused args must match /^_/u.","line":27,"column":61,"nodeType":null,"messageId":"unusedVar","endLine":27,"endColumn":69},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchHolidays'. Either include it or remove the dependency array.","line":36,"column":6,"nodeType":"ArrayExpression","endLine":36,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [fetchHolidays]","fix":{"range":[1038,1040],"text":"[fetchHolidays]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":46,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":46,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1349,1352],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1349,1352],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":80,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":80,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2484,2487],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2484,2487],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":102,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":102,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3239,3242],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3239,3242],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":268,"column":72,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":268,"endColumn":75,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9458,9461],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9458,9461],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport { ITenantSettings } from '@/models/Tenant';\r\n\r\ninterface Holiday {\r\n  id: string;\r\n  name: string;\r\n  date: string;\r\n  type: 'single' | 'recurring';\r\n  recurring?: {\r\n    pattern: 'yearly' | 'monthly' | 'weekly';\r\n    dayOfMonth?: number;\r\n    dayOfWeek?: number;\r\n    month?: number;\r\n  };\r\n  isBusinessClosed: boolean;\r\n  createdAt?: Date;\r\n}\r\n\r\ninterface HolidaysManagerProps {\r\n  settings: ITenantSettings;\r\n  tenant: string;\r\n  onUpdate: (updates: Partial<ITenantSettings>) => void;\r\n}\r\n\r\nexport default function HolidaysManager({ settings, tenant, onUpdate }: HolidaysManagerProps) {\r\n  const [holidays, setHolidays] = useState<Holiday[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [editing, setEditing] = useState<Holiday | null>(null);\r\n  const [showForm, setShowForm] = useState(false);\r\n  const [message, setMessage] = useState<{ type: 'success' | 'error'; text: string } | null>(null);\r\n\r\n  useEffect(() => {\r\n    fetchHolidays();\r\n  }, []);\r\n\r\n  const fetchHolidays = async () => {\r\n    try {\r\n      setLoading(true);\r\n      const res = await fetch(`/api/tenants/${tenant}/holidays`, { credentials: 'include' });\r\n      const data = await res.json();\r\n      if (data.success) {\r\n        setHolidays(data.data || []);\r\n      }\r\n    } catch (error: any) {\r\n      setMessage({ type: 'error', text: error.message || 'Failed to load holidays' });\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleSave = async (holiday: Partial<Holiday>) => {\r\n    try {\r\n      setMessage(null);\r\n      const url = `/api/tenants/${tenant}/holidays`;\r\n      const method = editing ? 'PUT' : 'POST';\r\n      const body = editing ? { id: editing.id, ...holiday } : holiday;\r\n\r\n      console.log('Saving holiday:', body); // Debug log\r\n\r\n      const res = await fetch(url, {\r\n        method,\r\n        headers: { 'Content-Type': 'application/json' },\r\n        credentials: 'include',\r\n        body: JSON.stringify(body),\r\n      });\r\n\r\n      const data = await res.json();\r\n      console.log('Holiday save response:', data); // Debug log\r\n\r\n      if (data.success) {\r\n        setMessage({ type: 'success', text: `Holiday ${editing ? 'updated' : 'created'} successfully` });\r\n        setShowForm(false);\r\n        setEditing(null);\r\n        fetchHolidays();\r\n      } else {\r\n        setMessage({ type: 'error', text: data.error || 'Failed to save holiday' });\r\n      }\r\n    } catch (error: any) {\r\n      console.error('Error saving holiday:', error);\r\n      setMessage({ type: 'error', text: error.message || 'Failed to save holiday' });\r\n    }\r\n  };\r\n\r\n  const handleDelete = async (id: string) => {\r\n    if (!confirm('Are you sure you want to delete this holiday?')) return;\r\n\r\n    try {\r\n      const res = await fetch(`/api/tenants/${tenant}/holidays?id=${id}`, {\r\n        method: 'DELETE',\r\n        credentials: 'include',\r\n      });\r\n\r\n      const data = await res.json();\r\n      if (data.success) {\r\n        setMessage({ type: 'success', text: 'Holiday deleted successfully' });\r\n        fetchHolidays();\r\n      } else {\r\n        setMessage({ type: 'error', text: data.error || 'Failed to delete holiday' });\r\n      }\r\n    } catch (error: any) {\r\n      setMessage({ type: 'error', text: error.message || 'Failed to delete holiday' });\r\n    }\r\n  };\r\n\r\n  if (loading) {\r\n    return <div className=\"text-center py-8\">Loading holidays...</div>;\r\n  }\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      <div className=\"flex items-center justify-between\">\r\n        <h3 className=\"text-lg font-semibold text-gray-900\">Holiday Calendar</h3>\r\n        <button\r\n          onClick={() => {\r\n            setEditing(null);\r\n            setShowForm(true);\r\n          }}\r\n          className=\"px-4 py-2 bg-blue-600 text-white text-sm font-medium hover:bg-blue-700\"\r\n        >\r\n          Add Holiday\r\n        </button>\r\n      </div>\r\n\r\n      {message && (\r\n        <div\r\n          className={`p-3 rounded ${\r\n            message.type === 'success' ? 'bg-green-50 text-green-800' : 'bg-red-50 text-red-800'\r\n          }`}\r\n        >\r\n          {message.text}\r\n        </div>\r\n      )}\r\n\r\n      {showForm && (\r\n        <HolidayForm\r\n          holiday={editing}\r\n          onSave={handleSave}\r\n          onCancel={() => {\r\n            setShowForm(false);\r\n            setEditing(null);\r\n          }}\r\n        />\r\n      )}\r\n\r\n      <div className=\"space-y-3\">\r\n        {holidays.length === 0 ? (\r\n          <div className=\"text-center py-8 text-gray-500\">\r\n            No holidays configured. Add holidays to mark days when your business is closed.\r\n          </div>\r\n        ) : (\r\n          holidays.map((holiday) => (\r\n            <div\r\n              key={holiday.id}\r\n              className=\"p-4 border-2 border-gray-300 rounded hover:bg-gray-50\"\r\n            >\r\n              <div className=\"flex items-center justify-between\">\r\n                <div>\r\n                  <h4 className=\"font-medium text-gray-900\">{holiday.name}</h4>\r\n                  <div className=\"text-sm text-gray-600 mt-1\">\r\n                    {holiday.type === 'single' ? (\r\n                      <span>Date: {holiday.date}</span>\r\n                    ) : (\r\n                      <span>\r\n                        Recurring: {holiday.recurring?.pattern}\r\n                        {holiday.recurring?.month && ` (Month ${holiday.recurring.month})`}\r\n                        {holiday.recurring?.dayOfMonth && ` (Day ${holiday.recurring.dayOfMonth})`}\r\n                      </span>\r\n                    )}\r\n                    {holiday.isBusinessClosed && (\r\n                      <span className=\"ml-2 text-red-600 font-medium\"> Business Closed</span>\r\n                    )}\r\n                  </div>\r\n                </div>\r\n                <div className=\"flex items-center space-x-2\">\r\n                  <button\r\n                    onClick={() => {\r\n                      setEditing(holiday);\r\n                      setShowForm(true);\r\n                    }}\r\n                    className=\"px-3 py-1 text-xs text-gray-600 hover:text-gray-800 font-medium\"\r\n                  >\r\n                    Edit\r\n                  </button>\r\n                  <button\r\n                    onClick={() => handleDelete(holiday.id)}\r\n                    className=\"px-3 py-1 text-xs text-red-600 hover:text-red-700 font-medium\"\r\n                  >\r\n                    Delete\r\n                  </button>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          ))\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction HolidayForm({\r\n  holiday,\r\n  onSave,\r\n  onCancel,\r\n}: {\r\n  holiday: Holiday | null;\r\n  onSave: (holiday: Partial<Holiday>) => void;\r\n  onCancel: () => void;\r\n}) {\r\n  const [name, setName] = useState(holiday?.name || '');\r\n  const [type, setType] = useState<'single' | 'recurring'>(holiday?.type || 'single');\r\n  const [date, setDate] = useState(holiday?.date || '');\r\n  const [isBusinessClosed, setIsBusinessClosed] = useState(holiday?.isBusinessClosed !== false);\r\n  const [recurringPattern, setRecurringPattern] = useState<'yearly' | 'monthly' | 'weekly'>(\r\n    holiday?.recurring?.pattern || 'yearly'\r\n  );\r\n  const [month, setMonth] = useState(holiday?.recurring?.month?.toString() || '');\r\n  const [dayOfMonth, setDayOfMonth] = useState(holiday?.recurring?.dayOfMonth?.toString() || '');\r\n  const [dayOfWeek, setDayOfWeek] = useState(holiday?.recurring?.dayOfWeek?.toString() || '0');\r\n\r\n  return (\r\n    <div className=\"border-2 border-gray-300 rounded p-6 bg-white\">\r\n      <h4 className=\"text-lg font-semibold mb-4\">{holiday ? 'Edit Holiday' : 'Add Holiday'}</h4>\r\n\r\n      <div className=\"space-y-4\">\r\n        <div>\r\n          <label className=\"block text-sm font-medium text-gray-700 mb-2\">Holiday Name *</label>\r\n          <input\r\n            type=\"text\"\r\n            value={name}\r\n            onChange={(e) => setName(e.target.value)}\r\n            className=\"w-full px-4 py-2 border-2 border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\r\n            placeholder=\"e.g., New Year's Day\"\r\n            required\r\n          />\r\n        </div>\r\n\r\n        <div>\r\n          <label className=\"block text-sm font-medium text-gray-700 mb-2\">Type *</label>\r\n          <select\r\n            value={type}\r\n            onChange={(e) => setType(e.target.value as 'single' | 'recurring')}\r\n            className=\"w-full px-4 py-2 border-2 border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\r\n          >\r\n            <option value=\"single\">Single Date</option>\r\n            <option value=\"recurring\">Recurring</option>\r\n          </select>\r\n        </div>\r\n\r\n        {type === 'single' ? (\r\n          <div>\r\n            <label className=\"block text-sm font-medium text-gray-700 mb-2\">Date *</label>\r\n            <input\r\n              type=\"date\"\r\n              value={date}\r\n              onChange={(e) => setDate(e.target.value)}\r\n              className=\"w-full px-4 py-2 border-2 border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\r\n              required\r\n            />\r\n          </div>\r\n        ) : (\r\n          <div className=\"space-y-3\">\r\n            <div>\r\n              <label className=\"block text-sm font-medium text-gray-700 mb-2\">Recurring Pattern *</label>\r\n              <select\r\n                value={recurringPattern}\r\n                onChange={(e) => setRecurringPattern(e.target.value as any)}\r\n                className=\"w-full px-4 py-2 border-2 border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\r\n              >\r\n                <option value=\"yearly\">Yearly</option>\r\n                <option value=\"monthly\">Monthly</option>\r\n                <option value=\"weekly\">Weekly</option>\r\n              </select>\r\n            </div>\r\n            {recurringPattern === 'yearly' && (\r\n              <div className=\"grid grid-cols-2 gap-3\">\r\n                <div>\r\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">Month (1-12)</label>\r\n                  <input\r\n                    type=\"number\"\r\n                    min=\"1\"\r\n                    max=\"12\"\r\n                    value={month}\r\n                    onChange={(e) => setMonth(e.target.value)}\r\n                    className=\"w-full px-4 py-2 border-2 border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\r\n                  />\r\n                </div>\r\n                <div>\r\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">Day of Month (1-31)</label>\r\n                  <input\r\n                    type=\"number\"\r\n                    min=\"1\"\r\n                    max=\"31\"\r\n                    value={dayOfMonth}\r\n                    onChange={(e) => setDayOfMonth(e.target.value)}\r\n                    className=\"w-full px-4 py-2 border-2 border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\r\n                  />\r\n                </div>\r\n              </div>\r\n            )}\r\n            {recurringPattern === 'weekly' && (\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">Day of Week</label>\r\n                <select\r\n                  value={dayOfWeek}\r\n                  onChange={(e) => setDayOfWeek(e.target.value)}\r\n                  className=\"w-full px-4 py-2 border-2 border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\r\n                >\r\n                  <option value=\"0\">Sunday</option>\r\n                  <option value=\"1\">Monday</option>\r\n                  <option value=\"2\">Tuesday</option>\r\n                  <option value=\"3\">Wednesday</option>\r\n                  <option value=\"4\">Thursday</option>\r\n                  <option value=\"5\">Friday</option>\r\n                  <option value=\"6\">Saturday</option>\r\n                </select>\r\n              </div>\r\n            )}\r\n            {recurringPattern === 'monthly' && (\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">Day of Month (1-31)</label>\r\n                <input\r\n                  type=\"number\"\r\n                  min=\"1\"\r\n                  max=\"31\"\r\n                  value={dayOfMonth}\r\n                  onChange={(e) => setDayOfMonth(e.target.value)}\r\n                  className=\"w-full px-4 py-2 border-2 border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\r\n                />\r\n              </div>\r\n            )}\r\n          </div>\r\n        )}\r\n\r\n        <div className=\"flex items-center space-x-2\">\r\n          <input\r\n            type=\"checkbox\"\r\n            id=\"isBusinessClosed\"\r\n            checked={isBusinessClosed}\r\n            onChange={(e) => setIsBusinessClosed(e.target.checked)}\r\n            className=\"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500\"\r\n          />\r\n          <label htmlFor=\"isBusinessClosed\" className=\"text-sm text-gray-700\">\r\n            Business is closed on this holiday\r\n          </label>\r\n        </div>\r\n\r\n        <div className=\"flex items-center space-x-3\">\r\n          <button\r\n            onClick={() =>\r\n              onSave({\r\n                name,\r\n                type,\r\n                date: type === 'single' ? date : '',\r\n                isBusinessClosed,\r\n                recurring:\r\n                  type === 'recurring'\r\n                    ? {\r\n                        pattern: recurringPattern,\r\n                        month: month ? parseInt(month) : undefined,\r\n                        dayOfMonth: dayOfMonth ? parseInt(dayOfMonth) : undefined,\r\n                        dayOfWeek: dayOfWeek ? parseInt(dayOfWeek) : undefined,\r\n                      }\r\n                    : undefined,\r\n              })\r\n            }\r\n            className=\"px-4 py-2 bg-blue-600 text-white font-medium hover:bg-blue-700\"\r\n          >\r\n            Save Holiday\r\n          </button>\r\n          <button\r\n            onClick={onCancel}\r\n            className=\"px-4 py-2 bg-gray-200 text-gray-700 font-medium hover:bg-gray-300\"\r\n          >\r\n            Cancel\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\components\\settings\\MultiCurrencyDisplaySettings.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useState' is defined but never used. Allowed unused vars must match /^_/u.","line":3,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":18}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState } from 'react';\r\nimport { ITenantSettings } from '@/models/Tenant';\r\nimport Link from 'next/link';\r\n\r\ninterface MultiCurrencyDisplaySettingsProps {\r\n  settings: ITenantSettings;\r\n  tenant: string;\r\n  lang: 'en' | 'es';\r\n  onUpdate: (updates: Partial<ITenantSettings>) => void;\r\n}\r\n\r\nconst COMMON_CURRENCIES = ['USD', 'EUR', 'GBP', 'JPY', 'CAD', 'AUD', 'CHF', 'CNY', 'INR', 'MXN', 'BRL', 'ZAR'];\r\n\r\nexport default function MultiCurrencyDisplaySettings({ settings, tenant, lang, onUpdate }: MultiCurrencyDisplaySettingsProps) {\r\n  const multiCurrency = settings.multiCurrency || { enabled: false, displayCurrencies: [], exchangeRates: {}, exchangeRateSource: 'manual' };\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      <div className=\"p-4 bg-blue-50 border border-blue-200 rounded\">\r\n        <p className=\"text-sm text-blue-800 mb-2\">\r\n          <strong>Note:</strong> Exchange rate management has been moved to Admin  Multi-Currency for better access control.\r\n        </p>\r\n        <Link\r\n          href={`/${tenant}/${lang}/admin/multi-currency`}\r\n          className=\"text-sm text-blue-600 hover:text-blue-700 font-medium underline\"\r\n        >\r\n          Manage Exchange Rates \r\n        </Link>\r\n      </div>\r\n\r\n      <div>\r\n        <label className=\"flex items-center space-x-2\">\r\n          <input\r\n            type=\"checkbox\"\r\n            checked={multiCurrency.enabled || false}\r\n            onChange={(e) => {\r\n              onUpdate({\r\n                multiCurrency: {\r\n                  ...multiCurrency,\r\n                  enabled: e.target.checked,\r\n                },\r\n              });\r\n            }}\r\n            className=\"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500\"\r\n          />\r\n          <span className=\"text-sm font-medium text-gray-700\">Enable Multi-Currency Display</span>\r\n        </label>\r\n        <p className=\"mt-1 text-xs text-gray-500\">Display prices in multiple currencies</p>\r\n      </div>\r\n\r\n      {multiCurrency.enabled && (\r\n        <div>\r\n          <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n            Display Currencies\r\n          </label>\r\n          <div className=\"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-2\">\r\n            {COMMON_CURRENCIES.map((currency) => (\r\n              <label key={currency} className=\"flex items-center space-x-2\">\r\n                <input\r\n                  type=\"checkbox\"\r\n                  checked={multiCurrency.displayCurrencies?.includes(currency) || false}\r\n                  onChange={(e) => {\r\n                    const current = multiCurrency.displayCurrencies || [];\r\n                    const updated = e.target.checked\r\n                      ? [...current, currency]\r\n                      : current.filter((c) => c !== currency);\r\n                    onUpdate({\r\n                      multiCurrency: {\r\n                        ...multiCurrency,\r\n                        displayCurrencies: updated,\r\n                      },\r\n                    });\r\n                  }}\r\n                  className=\"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500\"\r\n                />\r\n                <span className=\"text-sm text-gray-700\">{currency}</span>\r\n              </label>\r\n            ))}\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\components\\settings\\MultiCurrencySettings.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useEffect' is defined but never used. Allowed unused vars must match /^_/u.","line":3,"column":20,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":29},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":42,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":42,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1652,1655],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1652,1655],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport { ITenantSettings } from '@/models/Tenant';\r\n\r\ninterface MultiCurrencySettingsProps {\r\n  settings: ITenantSettings;\r\n  tenant: string;\r\n  onUpdate: (updates: Partial<ITenantSettings>) => void;\r\n}\r\n\r\nconst COMMON_CURRENCIES = ['USD', 'EUR', 'GBP', 'JPY', 'CAD', 'AUD', 'CHF', 'CNY', 'INR', 'MXN', 'BRL', 'ZAR'];\r\n\r\nexport default function MultiCurrencySettings({ settings, tenant, onUpdate }: MultiCurrencySettingsProps) {\r\n  const [loading, setLoading] = useState(false);\r\n  const [message, setMessage] = useState<{ type: 'success' | 'error'; text: string } | null>(null);\r\n  const multiCurrency = settings.multiCurrency || { enabled: false, displayCurrencies: [], exchangeRates: {}, exchangeRateSource: 'manual' };\r\n\r\n  const fetchExchangeRates = async () => {\r\n    setLoading(true);\r\n    setMessage(null);\r\n    try {\r\n      const res = await fetch(`/api/tenants/${tenant}/exchange-rates`, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        credentials: 'include',\r\n        body: JSON.stringify({ action: 'fetch' }),\r\n      });\r\n      const data = await res.json();\r\n      if (data.success) {\r\n        setMessage({ type: 'success', text: 'Exchange rates updated successfully' });\r\n        onUpdate({\r\n          multiCurrency: {\r\n            ...multiCurrency,\r\n            exchangeRates: data.data.exchangeRates,\r\n            lastUpdated: new Date(data.data.lastUpdated),\r\n          },\r\n        });\r\n      } else {\r\n        setMessage({ type: 'error', text: data.error || 'Failed to fetch exchange rates' });\r\n      }\r\n    } catch (error: any) {\r\n      setMessage({ type: 'error', text: error.message || 'Failed to fetch exchange rates' });\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      <div>\r\n        <label className=\"flex items-center space-x-2\">\r\n          <input\r\n            type=\"checkbox\"\r\n            checked={multiCurrency.enabled || false}\r\n            onChange={(e) => {\r\n              onUpdate({\r\n                multiCurrency: {\r\n                  ...multiCurrency,\r\n                  enabled: e.target.checked,\r\n                },\r\n              });\r\n            }}\r\n            className=\"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500\"\r\n          />\r\n          <span className=\"text-sm font-medium text-gray-700\">Enable Multi-Currency Display</span>\r\n        </label>\r\n        <p className=\"mt-1 text-xs text-gray-500\">Display prices in multiple currencies</p>\r\n      </div>\r\n\r\n      {multiCurrency.enabled && (\r\n        <>\r\n          <div>\r\n            <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n              Display Currencies\r\n            </label>\r\n            <div className=\"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-2\">\r\n              {COMMON_CURRENCIES.map((currency) => (\r\n                <label key={currency} className=\"flex items-center space-x-2\">\r\n                  <input\r\n                    type=\"checkbox\"\r\n                    checked={multiCurrency.displayCurrencies?.includes(currency) || false}\r\n                    onChange={(e) => {\r\n                      const current = multiCurrency.displayCurrencies || [];\r\n                      const updated = e.target.checked\r\n                        ? [...current, currency]\r\n                        : current.filter((c) => c !== currency);\r\n                      onUpdate({\r\n                        multiCurrency: {\r\n                          ...multiCurrency,\r\n                          displayCurrencies: updated,\r\n                        },\r\n                      });\r\n                    }}\r\n                    className=\"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500\"\r\n                  />\r\n                  <span className=\"text-sm text-gray-700\">{currency}</span>\r\n                </label>\r\n              ))}\r\n            </div>\r\n          </div>\r\n\r\n          <div>\r\n            <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n              Exchange Rate Source\r\n            </label>\r\n            <select\r\n              value={multiCurrency.exchangeRateSource || 'manual'}\r\n              onChange={(e) => {\r\n                onUpdate({\r\n                  multiCurrency: {\r\n                    ...multiCurrency,\r\n                    exchangeRateSource: e.target.value as 'manual' | 'api',\r\n                  },\r\n                });\r\n              }}\r\n              className=\"w-full px-4 py-2 border-2 border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\r\n            >\r\n              <option value=\"manual\">Manual Entry</option>\r\n              <option value=\"api\">Automatic (API)</option>\r\n            </select>\r\n          </div>\r\n\r\n          {multiCurrency.exchangeRateSource === 'api' && (\r\n            <div>\r\n              <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                Exchange Rate API Key (Optional)\r\n              </label>\r\n              <input\r\n                type=\"text\"\r\n                value={multiCurrency.exchangeRateApiKey || ''}\r\n                onChange={(e) => {\r\n                  onUpdate({\r\n                    multiCurrency: {\r\n                      ...multiCurrency,\r\n                      exchangeRateApiKey: e.target.value,\r\n                    },\r\n                  });\r\n                }}\r\n                className=\"w-full px-4 py-2 border-2 border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\r\n                placeholder=\"API key for exchange rate service\"\r\n              />\r\n              <p className=\"mt-1 text-xs text-gray-500\">\r\n                Leave empty to use free tier (exchangerate-api.com)\r\n              </p>\r\n            </div>\r\n          )}\r\n\r\n          {multiCurrency.displayCurrencies && multiCurrency.displayCurrencies.length > 0 && (\r\n            <div>\r\n              <div className=\"flex items-center justify-between mb-2\">\r\n                <label className=\"block text-sm font-medium text-gray-700\">\r\n                  Exchange Rates\r\n                </label>\r\n                <button\r\n                  type=\"button\"\r\n                  onClick={fetchExchangeRates}\r\n                  disabled={loading}\r\n                  className=\"px-4 py-2 bg-blue-600 text-white text-sm font-medium hover:bg-blue-700 disabled:bg-gray-400\"\r\n                >\r\n                  {loading ? 'Fetching...' : 'Fetch Latest Rates'}\r\n                </button>\r\n              </div>\r\n              {multiCurrency.lastUpdated && (\r\n                <p className=\"text-xs text-gray-500 mb-2\">\r\n                  Last updated: {new Date(multiCurrency.lastUpdated).toLocaleString()}\r\n                </p>\r\n              )}\r\n              <div className=\"space-y-2\">\r\n                {multiCurrency.displayCurrencies.map((currency) => {\r\n                  const rate = multiCurrency.exchangeRates?.[currency];\r\n                  return (\r\n                    <div key={currency} className=\"flex items-center justify-between p-2 bg-gray-50 rounded\">\r\n                      <span className=\"text-sm font-medium\">{currency}</span>\r\n                      <input\r\n                        type=\"number\"\r\n                        step=\"0.0001\"\r\n                        value={rate || ''}\r\n                        onChange={(e) => {\r\n                          const newRates = {\r\n                            ...(multiCurrency.exchangeRates || {}),\r\n                            [currency]: parseFloat(e.target.value) || 0,\r\n                          };\r\n                          onUpdate({\r\n                            multiCurrency: {\r\n                              ...multiCurrency,\r\n                              exchangeRates: newRates,\r\n                            },\r\n                          });\r\n                        }}\r\n                        className=\"w-24 px-2 py-1 border border-gray-300 rounded text-sm\"\r\n                        placeholder=\"Rate\"\r\n                      />\r\n                    </div>\r\n                  );\r\n                })}\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          {message && (\r\n            <div\r\n              className={`p-3 rounded ${\r\n                message.type === 'success' ? 'bg-green-50 text-green-800' : 'bg-red-50 text-red-800'\r\n              }`}\r\n            >\r\n              {message.text}\r\n            </div>\r\n          )}\r\n        </>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\components\\settings\\NotificationTemplatesManager.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Template' is defined but never used. Allowed unused vars must match /^_/u.","line":15,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":15,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'settings' is defined but never used. Allowed unused args must match /^_/u.","line":38,"column":56,"nodeType":null,"messageId":"unusedVar","endLine":38,"endColumn":64},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'onUpdate' is defined but never used. Allowed unused args must match /^_/u.","line":38,"column":74,"nodeType":null,"messageId":"unusedVar","endLine":38,"endColumn":82},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":39,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":39,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1622,1625],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1622,1625],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchTemplates'. Either include it or remove the dependency array.","line":47,"column":6,"nodeType":"ArrayExpression","endLine":47,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [fetchTemplates]","fix":{"range":[2015,2017],"text":"[fetchTemplates]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":57,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":57,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2342,2345],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2342,2345],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":110,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":110,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4094,4097],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4094,4097],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport { ITenantSettings } from '@/models/Tenant';\r\n\r\ninterface NotificationTemplatesManagerProps {\r\n  settings: ITenantSettings;\r\n  tenant: string;\r\n  onUpdate: (updates: Partial<ITenantSettings>) => void;\r\n}\r\n\r\ntype TemplateType = 'email' | 'sms';\r\ntype TemplateCategory = 'bookingConfirmation' | 'bookingReminder' | 'bookingCancellation' | 'lowStockAlert' | 'attendanceAlert';\r\n\r\ninterface Template {\r\n  type: TemplateType;\r\n  category: TemplateCategory;\r\n  subject?: string;\r\n  body: string;\r\n}\r\n\r\nconst CATEGORY_LABELS: Record<TemplateCategory, string> = {\r\n  bookingConfirmation: 'Booking Confirmation',\r\n  bookingReminder: 'Booking Reminder',\r\n  bookingCancellation: 'Booking Cancellation',\r\n  lowStockAlert: 'Low Stock Alert',\r\n  attendanceAlert: 'Attendance Alert',\r\n};\r\n\r\nconst CATEGORY_VARIABLES: Record<TemplateCategory, string[]> = {\r\n  bookingConfirmation: ['{{customerName}}', '{{serviceName}}', '{{startTime}}', '{{endTime}}', '{{date}}', '{{staffName}}'],\r\n  bookingReminder: ['{{customerName}}', '{{serviceName}}', '{{startTime}}', '{{date}}', '{{staffName}}'],\r\n  bookingCancellation: ['{{customerName}}', '{{serviceName}}', '{{startTime}}', '{{date}}', '{{reason}}'],\r\n  lowStockAlert: ['{{productName}}', '{{currentStock}}', '{{threshold}}', '{{sku}}'],\r\n  attendanceAlert: ['{{employeeName}}', '{{clockInTime}}', '{{expectedTime}}', '{{hours}}'],\r\n};\r\n\r\nexport default function NotificationTemplatesManager({ settings, tenant, onUpdate }: NotificationTemplatesManagerProps) {\r\n  const [templates, setTemplates] = useState<Record<string, any>>({});\r\n  const [loading, setLoading] = useState(true);\r\n  const [editing, setEditing] = useState<{ type: TemplateType; category: TemplateCategory } | null>(null);\r\n  const [message, setMessage] = useState<{ type: 'success' | 'error'; text: string } | null>(null);\r\n  const [activeType, setActiveType] = useState<TemplateType>('email');\r\n\r\n  useEffect(() => {\r\n    fetchTemplates();\r\n  }, []);\r\n\r\n  const fetchTemplates = async () => {\r\n    try {\r\n      setLoading(true);\r\n      const res = await fetch(`/api/tenants/${tenant}/notification-templates`, { credentials: 'include' });\r\n      const data = await res.json();\r\n      if (data.success) {\r\n        setTemplates(data.data || {});\r\n      }\r\n    } catch (error: any) {\r\n      setMessage({ type: 'error', text: error.message || 'Failed to load templates' });\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const getTemplate = (type: TemplateType, category: TemplateCategory): string => {\r\n    const templateKey = type === 'email' \r\n      ? templates.email?.[category] \r\n      : templates.sms?.[category];\r\n    \r\n    if (typeof templateKey === 'string') {\r\n      // Handle format: \"subject|body\" for email\r\n      if (type === 'email' && templateKey.includes('|')) {\r\n        return templateKey.split('|')[1] || '';\r\n      }\r\n      return templateKey;\r\n    }\r\n    return '';\r\n  };\r\n\r\n  const getSubject = (category: TemplateCategory): string => {\r\n    const templateKey = templates.email?.[category];\r\n    if (typeof templateKey === 'string' && templateKey.includes('|')) {\r\n      return templateKey.split('|')[0] || '';\r\n    }\r\n    return '';\r\n  };\r\n\r\n  const handleSave = async (type: TemplateType, category: TemplateCategory, subject: string, body: string) => {\r\n    try {\r\n      setMessage(null);\r\n      const res = await fetch(`/api/tenants/${tenant}/notification-templates`, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        credentials: 'include',\r\n        body: JSON.stringify({\r\n          type,\r\n          category,\r\n          subject: type === 'email' ? subject : undefined,\r\n          body,\r\n        }),\r\n      });\r\n\r\n      const data = await res.json();\r\n      if (data.success) {\r\n        setMessage({ type: 'success', text: 'Template saved successfully' });\r\n        setEditing(null);\r\n        fetchTemplates();\r\n      } else {\r\n        setMessage({ type: 'error', text: data.error || 'Failed to save template' });\r\n      }\r\n    } catch (error: any) {\r\n      setMessage({ type: 'error', text: error.message || 'Failed to save template' });\r\n    }\r\n  };\r\n\r\n  if (loading) {\r\n    return <div className=\"text-center py-8\">Loading templates...</div>;\r\n  }\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      <div className=\"flex items-center justify-between\">\r\n        <h3 className=\"text-lg font-semibold text-gray-900\">Notification Templates</h3>\r\n        <div className=\"flex gap-2\">\r\n          <button\r\n            onClick={() => setActiveType('email')}\r\n            className={`px-4 py-2 text-sm font-medium ${\r\n              activeType === 'email'\r\n                ? 'bg-blue-600 text-white'\r\n                : 'bg-gray-200 text-gray-700 hover:bg-gray-300'\r\n            }`}\r\n          >\r\n            Email\r\n          </button>\r\n          <button\r\n            onClick={() => setActiveType('sms')}\r\n            className={`px-4 py-2 text-sm font-medium ${\r\n              activeType === 'sms'\r\n                ? 'bg-blue-600 text-white'\r\n                : 'bg-gray-200 text-gray-700 hover:bg-gray-300'\r\n            }`}\r\n          >\r\n            SMS\r\n          </button>\r\n        </div>\r\n      </div>\r\n\r\n      {message && (\r\n        <div\r\n          className={`p-3 rounded ${\r\n            message.type === 'success' ? 'bg-green-50 text-green-800' : 'bg-red-50 text-red-800'\r\n          }`}\r\n        >\r\n          {message.text}\r\n        </div>\r\n      )}\r\n\r\n      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n        {(Object.keys(CATEGORY_LABELS) as TemplateCategory[]).map((category) => (\r\n          <div\r\n            key={category}\r\n            className=\"p-4 border-2 border-gray-300 rounded hover:bg-gray-50\"\r\n          >\r\n            <div className=\"flex items-center justify-between mb-2\">\r\n              <h4 className=\"font-medium text-gray-900\">{CATEGORY_LABELS[category]}</h4>\r\n              <button\r\n                onClick={() => setEditing({ type: activeType, category })}\r\n                className=\"px-3 py-1 text-xs text-blue-600 hover:text-blue-700 font-medium\"\r\n              >\r\n                {editing?.type === activeType && editing?.category === category ? 'Cancel' : 'Edit'}\r\n              </button>\r\n            </div>\r\n            \r\n            {editing?.type === activeType && editing?.category === category ? (\r\n              <TemplateEditor\r\n                type={activeType}\r\n                category={category}\r\n                initialSubject={getSubject(category)}\r\n                initialBody={getTemplate(activeType, category)}\r\n                onSave={(subject, body) => {\r\n                  handleSave(activeType, category, subject, body);\r\n                }}\r\n                onCancel={() => setEditing(null)}\r\n              />\r\n            ) : (\r\n              <div className=\"text-sm text-gray-600\">\r\n                {getTemplate(activeType, category) || (\r\n                  <span className=\"italic text-gray-400\">No template set</span>\r\n                )}\r\n              </div>\r\n            )}\r\n          </div>\r\n        ))}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction TemplateEditor({\r\n  type,\r\n  category,\r\n  initialSubject,\r\n  initialBody,\r\n  onSave,\r\n  onCancel,\r\n}: {\r\n  type: TemplateType;\r\n  category: TemplateCategory;\r\n  initialSubject: string;\r\n  initialBody: string;\r\n  onSave: (subject: string, body: string) => void;\r\n  onCancel: () => void;\r\n}) {\r\n  const [subject, setSubject] = useState(initialSubject);\r\n  const [body, setBody] = useState(initialBody);\r\n\r\n  return (\r\n    <div className=\"space-y-3 mt-3\">\r\n      {type === 'email' && (\r\n        <div>\r\n          <label className=\"block text-xs font-medium text-gray-700 mb-1\">Subject</label>\r\n          <input\r\n            type=\"text\"\r\n            value={subject}\r\n            onChange={(e) => setSubject(e.target.value)}\r\n            className=\"w-full px-3 py-2 text-sm border-2 border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\r\n            placeholder=\"Email subject\"\r\n          />\r\n        </div>\r\n      )}\r\n      <div>\r\n        <label className=\"block text-xs font-medium text-gray-700 mb-1\">\r\n          {type === 'email' ? 'Body' : 'Message'}\r\n        </label>\r\n        <textarea\r\n          value={body}\r\n          onChange={(e) => setBody(e.target.value)}\r\n          rows={4}\r\n          className=\"w-full px-3 py-2 text-sm border-2 border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\r\n          placeholder={`${type === 'email' ? 'Email' : 'SMS'} message body`}\r\n        />\r\n        <div className=\"mt-2 text-xs text-gray-500\">\r\n          <div className=\"font-medium mb-1\">Available variables:</div>\r\n          <div className=\"flex flex-wrap gap-1\">\r\n            {CATEGORY_VARIABLES[category].map((variable) => (\r\n              <code key={variable} className=\"px-1 py-0.5 bg-gray-100 rounded text-xs\">\r\n                {variable}\r\n              </code>\r\n            ))}\r\n          </div>\r\n        </div>\r\n      </div>\r\n      <div className=\"flex gap-2\">\r\n        <button\r\n          onClick={() => onSave(subject, body)}\r\n          className=\"px-3 py-1.5 text-xs bg-blue-600 text-white hover:bg-blue-700 font-medium\"\r\n        >\r\n          Save\r\n        </button>\r\n        <button\r\n          onClick={onCancel}\r\n          className=\"px-3 py-1.5 text-xs bg-gray-200 text-gray-700 hover:bg-gray-300 font-medium\"\r\n        >\r\n          Cancel\r\n        </button>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\components\\settings\\ReceiptTemplatesManager.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'settings' is defined but never used. Allowed unused args must match /^_/u.","line":21,"column":51,"nodeType":null,"messageId":"unusedVar","endLine":21,"endColumn":59},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'onUpdate' is defined but never used. Allowed unused args must match /^_/u.","line":21,"column":69,"nodeType":null,"messageId":"unusedVar","endLine":21,"endColumn":77},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchTemplates'. Either include it or remove the dependency array.","line":30,"column":6,"nodeType":"ArrayExpression","endLine":30,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [fetchTemplates]","fix":{"range":[933,935],"text":"[fetchTemplates]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":40,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":40,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1265,1268],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1265,1268],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":72,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":72,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2344,2347],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2344,2347],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":93,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":93,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3059,3062],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3059,3062],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":112,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":112,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3693,3696],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3693,3696],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":356,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":356,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11374,11377],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11374,11377],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'defaultTemplate', 'html', and 'template'. Either include them or remove the dependency array.","line":314,"column":6,"nodeType":"ArrayExpression","endLine":314,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [defaultTemplate, html, template]","fix":{"range":[9871,9873],"text":"[defaultTemplate, html, template]"}}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":8,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport { ITenantSettings } from '@/models/Tenant';\r\n\r\ninterface ReceiptTemplate {\r\n  id: string;\r\n  name: string;\r\n  html: string;\r\n  isDefault?: boolean;\r\n  createdAt?: Date;\r\n  updatedAt?: Date;\r\n}\r\n\r\ninterface ReceiptTemplatesManagerProps {\r\n  settings: ITenantSettings;\r\n  tenant: string;\r\n  onUpdate: (updates: Partial<ITenantSettings>) => void;\r\n}\r\n\r\nexport default function ReceiptTemplatesManager({ settings, tenant, onUpdate }: ReceiptTemplatesManagerProps) {\r\n  const [templates, setTemplates] = useState<ReceiptTemplate[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [editing, setEditing] = useState<ReceiptTemplate | null>(null);\r\n  const [showEditor, setShowEditor] = useState(false);\r\n  const [message, setMessage] = useState<{ type: 'success' | 'error'; text: string } | null>(null);\r\n\r\n  useEffect(() => {\r\n    fetchTemplates();\r\n  }, []);\r\n\r\n  const fetchTemplates = async () => {\r\n    try {\r\n      setLoading(true);\r\n      const res = await fetch(`/api/tenants/${tenant}/receipt-templates`, { credentials: 'include' });\r\n      const data = await res.json();\r\n      if (data.success) {\r\n        setTemplates(data.data.templates || []);\r\n      }\r\n    } catch (error: any) {\r\n      setMessage({ type: 'error', text: error.message || 'Failed to load templates' });\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleSave = async (template: { name: string; html: string; isDefault?: boolean }) => {\r\n    try {\r\n      setMessage(null);\r\n      const url = `/api/tenants/${tenant}/receipt-templates`;\r\n      const method = editing ? 'PUT' : 'POST';\r\n      const body = editing\r\n        ? { id: editing.id, ...template }\r\n        : template;\r\n\r\n      const res = await fetch(url, {\r\n        method,\r\n        headers: { 'Content-Type': 'application/json' },\r\n        credentials: 'include',\r\n        body: JSON.stringify(body),\r\n      });\r\n\r\n      const data = await res.json();\r\n      if (data.success) {\r\n        setMessage({ type: 'success', text: `Template ${editing ? 'updated' : 'created'} successfully` });\r\n        setShowEditor(false);\r\n        setEditing(null);\r\n        fetchTemplates();\r\n      } else {\r\n        setMessage({ type: 'error', text: data.error || 'Failed to save template' });\r\n      }\r\n    } catch (error: any) {\r\n      setMessage({ type: 'error', text: error.message || 'Failed to save template' });\r\n    }\r\n  };\r\n\r\n  const handleDelete = async (id: string) => {\r\n    if (!confirm('Are you sure you want to delete this template?')) return;\r\n\r\n    try {\r\n      const res = await fetch(`/api/tenants/${tenant}/receipt-templates?id=${id}`, {\r\n        method: 'DELETE',\r\n        credentials: 'include',\r\n      });\r\n\r\n      const data = await res.json();\r\n      if (data.success) {\r\n        setMessage({ type: 'success', text: 'Template deleted successfully' });\r\n        fetchTemplates();\r\n      } else {\r\n        setMessage({ type: 'error', text: data.error || 'Failed to delete template' });\r\n      }\r\n    } catch (error: any) {\r\n      setMessage({ type: 'error', text: error.message || 'Failed to delete template' });\r\n    }\r\n  };\r\n\r\n  const handleSetDefault = async (id: string) => {\r\n    try {\r\n      const res = await fetch(`/api/tenants/${tenant}/receipt-templates`, {\r\n        method: 'PUT',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        credentials: 'include',\r\n        body: JSON.stringify({ id, isDefault: true }),\r\n      });\r\n\r\n      const data = await res.json();\r\n      if (data.success) {\r\n        setMessage({ type: 'success', text: 'Default template updated' });\r\n        fetchTemplates();\r\n      }\r\n    } catch (error: any) {\r\n      setMessage({ type: 'error', text: error.message || 'Failed to set default template' });\r\n    }\r\n  };\r\n\r\n  if (loading) {\r\n    return <div className=\"text-center py-8\">Loading templates...</div>;\r\n  }\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      <div className=\"flex items-center justify-between\">\r\n        <h3 className=\"text-lg font-semibold text-gray-900\">Receipt Templates</h3>\r\n        <button\r\n          onClick={() => {\r\n            setEditing(null);\r\n            setShowEditor(true);\r\n          }}\r\n          className=\"px-4 py-2 bg-blue-600 text-white text-sm font-medium hover:bg-blue-700\"\r\n        >\r\n          Create New Template\r\n        </button>\r\n      </div>\r\n\r\n      {message && (\r\n        <div\r\n          className={`p-3 rounded ${\r\n            message.type === 'success' ? 'bg-green-50 text-green-800' : 'bg-red-50 text-red-800'\r\n          }`}\r\n        >\r\n          {message.text}\r\n        </div>\r\n      )}\r\n\r\n      {showEditor && (\r\n        <TemplateEditor\r\n          template={editing}\r\n          onSave={handleSave}\r\n          onCancel={() => {\r\n            setShowEditor(false);\r\n            setEditing(null);\r\n          }}\r\n        />\r\n      )}\r\n\r\n      <div className=\"space-y-3\">\r\n        {templates.length === 0 ? (\r\n          <div className=\"text-center py-8 text-gray-500\">\r\n            No templates yet. Create your first template to get started.\r\n          </div>\r\n        ) : (\r\n          templates.map((template) => (\r\n            <div\r\n              key={template.id}\r\n              className=\"p-4 border-2 border-gray-300 rounded hover:bg-gray-50\"\r\n            >\r\n              <div className=\"flex items-center justify-between\">\r\n                <div className=\"flex items-center space-x-3\">\r\n                  <div>\r\n                    <h4 className=\"font-medium text-gray-900\">{template.name}</h4>\r\n                    {template.isDefault && (\r\n                      <span className=\"text-xs text-blue-600 font-medium\">Default</span>\r\n                    )}\r\n                  </div>\r\n                </div>\r\n                <div className=\"flex items-center space-x-2\">\r\n                  {!template.isDefault && (\r\n                    <button\r\n                      onClick={() => handleSetDefault(template.id)}\r\n                      className=\"px-3 py-1 text-xs text-blue-600 hover:text-blue-700 font-medium\"\r\n                    >\r\n                      Set Default\r\n                    </button>\r\n                  )}\r\n                  <button\r\n                    onClick={() => {\r\n                      setEditing(template);\r\n                      setShowEditor(true);\r\n                    }}\r\n                    className=\"px-3 py-1 text-xs text-gray-600 hover:text-gray-800 font-medium\"\r\n                  >\r\n                    Edit\r\n                  </button>\r\n                  <button\r\n                    onClick={() => handleDelete(template.id)}\r\n                    className=\"px-3 py-1 text-xs text-red-600 hover:text-red-700 font-medium\"\r\n                  >\r\n                    Delete\r\n                  </button>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          ))\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction TemplateEditor({\r\n  template,\r\n  onSave,\r\n  onCancel,\r\n}: {\r\n  template: ReceiptTemplate | null;\r\n  onSave: (template: { name: string; html: string; isDefault?: boolean }) => void;\r\n  onCancel: () => void;\r\n}) {\r\n  const [name, setName] = useState(template?.name || '');\r\n  const [html, setHtml] = useState(template?.html || '');\r\n  const [isDefault, setIsDefault] = useState(template?.isDefault || false);\r\n  const [preview, setPreview] = useState(false);\r\n\r\n  const defaultTemplate = `<!DOCTYPE html>\r\n<html>\r\n<head>\r\n  <title>Receipt</title>\r\n  <style>\r\n    @media print {\r\n      @page { margin: 0; size: 80mm auto; }\r\n      body { margin: 0; padding: 10px; }\r\n    }\r\n    body {\r\n      font-family: 'Courier New', monospace;\r\n      font-size: 12px;\r\n      width: 80mm;\r\n      margin: 0 auto;\r\n      padding: 10px;\r\n    }\r\n    .header { text-align: center; border-bottom: 2px dashed #000; padding-bottom: 10px; margin-bottom: 10px; }\r\n    .item { display: flex; justify-content: space-between; margin-bottom: 5px; }\r\n    .total { border-top: 2px dashed #000; padding-top: 10px; margin-top: 10px; font-weight: bold; }\r\n    .footer { text-align: center; margin-top: 20px; font-size: 10px; }\r\n  </style>\r\n</head>\r\n<body>\r\n  <div class=\"header\">\r\n    {{#if storeName}}<h2>{{storeName}}</h2>{{/if}}\r\n    {{#if logo}}<img src=\"{{logo}}\" alt=\"Logo\" style=\"max-width: 100px; max-height: 60px;\" />{{/if}}\r\n    <p>Receipt #{{receiptNumber}}</p>\r\n    <p>{{date}} {{time}}</p>\r\n    {{#if address}}<p>{{address}}</p>{{/if}}\r\n    {{#if phone}}<p>{{phone}}</p>{{/if}}\r\n    {{#if email}}<p>{{email}}</p>{{/if}}\r\n    {{#if header}}<p>{{header}}</p>{{/if}}\r\n  </div>\r\n  {{#each items}}\r\n  <div class=\"item\">\r\n    <div>\r\n      <div>{{name}} x{{quantity}}</div>\r\n      <div style=\"font-size: 10px;\">@ {{price}}</div>\r\n    </div>\r\n    <div>{{subtotal}}</div>\r\n  </div>\r\n  {{/each}}\r\n  <div class=\"total\">\r\n    <div class=\"item\">\r\n      <div>Subtotal:</div>\r\n      <div>{{subtotal}}</div>\r\n    </div>\r\n    {{#if discount}}\r\n    <div class=\"item\">\r\n      <div>Discount:</div>\r\n      <div>-{{discount}}</div>\r\n    </div>\r\n    {{/if}}\r\n    {{#if tax}}\r\n    <div class=\"item\">\r\n      <div>{{taxLabel}}:</div>\r\n      <div>{{tax}}</div>\r\n    </div>\r\n    {{/if}}\r\n    <div class=\"item\">\r\n      <div>TOTAL:</div>\r\n      <div>{{total}}</div>\r\n    </div>\r\n    <div class=\"item\">\r\n      <div>Payment:</div>\r\n      <div>{{paymentMethod}}</div>\r\n    </div>\r\n    {{#if cashReceived}}\r\n    <div class=\"item\">\r\n      <div>Cash:</div>\r\n      <div>{{cashReceived}}</div>\r\n    </div>\r\n    {{/if}}\r\n    {{#if change}}\r\n    <div class=\"item\">\r\n      <div>Change:</div>\r\n      <div>{{change}}</div>\r\n    </div>\r\n    {{/if}}\r\n  </div>\r\n  {{#if footer}}<div class=\"footer\">{{footer}}</div>{{/if}}\r\n</body>\r\n</html>`;\r\n\r\n  useEffect(() => {\r\n    if (!template && html === '') {\r\n      setHtml(defaultTemplate);\r\n    }\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, []);\r\n\r\n  const sampleData = {\r\n    storeName: 'Sample Store',\r\n    logo: '',\r\n    address: '123 Main St, City, State 12345',\r\n    phone: '+1 (555) 123-4567',\r\n    email: 'info@samplestore.com',\r\n    receiptNumber: 'REC-20240101-00001',\r\n    date: '2024-01-01',\r\n    time: '10:30 AM',\r\n    items: [\r\n      { name: 'Product 1', quantity: 2, price: '$10.00', subtotal: '$20.00' },\r\n      { name: 'Product 2', quantity: 1, price: '$15.00', subtotal: '$15.00' },\r\n    ],\r\n    subtotal: '$35.00',\r\n    discount: '$5.00',\r\n    tax: '$2.40',\r\n    taxLabel: 'Tax',\r\n    total: '$32.40',\r\n    paymentMethod: 'Cash',\r\n    cashReceived: '$50.00',\r\n    change: '$17.60',\r\n    footer: 'Thank you for your business!',\r\n    header: '',\r\n  };\r\n\r\n  const renderPreview = () => {\r\n    let previewHtml = html;\r\n    // Simple variable replacement for preview\r\n    Object.entries(sampleData).forEach(([key, value]) => {\r\n      if (typeof value === 'string') {\r\n        previewHtml = previewHtml.replace(new RegExp(`\\\\{\\\\{${key}\\\\}\\\\}`, 'g'), value);\r\n      }\r\n    });\r\n    // Handle if blocks\r\n    previewHtml = previewHtml.replace(/\\{\\{#if\\s+(\\w+)\\}\\}([\\s\\S]*?)\\{\\{\\/if\\}\\}/g, (match, condition, content) => {\r\n      const key = condition as keyof typeof sampleData;\r\n      return key in sampleData && sampleData[key] ? content : '';\r\n    });\r\n    // Handle each blocks\r\n    previewHtml = previewHtml.replace(/\\{\\{#each\\s+items\\}\\}([\\s\\S]*?)\\{\\{\\/each\\}\\}/g, (match, content) => {\r\n      return sampleData.items.map((item: any) => {\r\n        let itemHtml = content;\r\n        Object.entries(item).forEach(([key, value]) => {\r\n          itemHtml = itemHtml.replace(new RegExp(`\\\\{\\\\{${key}\\\\}\\\\}`, 'g'), String(value));\r\n        });\r\n        return itemHtml;\r\n      }).join('');\r\n    });\r\n    return previewHtml;\r\n  };\r\n\r\n  return (\r\n    <div className=\"border-2 border-gray-300 rounded p-6 bg-white\">\r\n      <h4 className=\"text-lg font-semibold mb-4\">\r\n        {template ? 'Edit Template' : 'Create New Template'}\r\n      </h4>\r\n\r\n      <div className=\"space-y-4\">\r\n        <div>\r\n          <label className=\"block text-sm font-medium text-gray-700 mb-2\">Template Name</label>\r\n          <input\r\n            type=\"text\"\r\n            value={name}\r\n            onChange={(e) => setName(e.target.value)}\r\n            className=\"w-full px-4 py-2 border-2 border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\r\n            placeholder=\"My Custom Receipt\"\r\n          />\r\n        </div>\r\n\r\n        <div className=\"flex items-center space-x-2\">\r\n          <input\r\n            type=\"checkbox\"\r\n            id=\"isDefault\"\r\n            checked={isDefault}\r\n            onChange={(e) => setIsDefault(e.target.checked)}\r\n            className=\"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500\"\r\n          />\r\n          <label htmlFor=\"isDefault\" className=\"text-sm text-gray-700\">\r\n            Set as default template\r\n          </label>\r\n        </div>\r\n\r\n        <div>\r\n          <div className=\"flex items-center justify-between mb-2\">\r\n            <label className=\"block text-sm font-medium text-gray-700\">Template HTML</label>\r\n            <button\r\n              type=\"button\"\r\n              onClick={() => setPreview(!preview)}\r\n              className=\"px-3 py-1 text-xs text-blue-600 hover:text-blue-700 font-medium\"\r\n            >\r\n              {preview ? 'Edit' : 'Preview'}\r\n            </button>\r\n          </div>\r\n          {preview ? (\r\n            <div className=\"border-2 border-gray-300 rounded p-4 bg-white\">\r\n              <div dangerouslySetInnerHTML={{ __html: renderPreview() }} />\r\n            </div>\r\n          ) : (\r\n            <textarea\r\n              value={html}\r\n              onChange={(e) => setHtml(e.target.value)}\r\n              rows={20}\r\n              className=\"w-full px-4 py-2 border-2 border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 font-mono text-sm\"\r\n              placeholder=\"Enter HTML template...\"\r\n            />\r\n          )}\r\n        </div>\r\n\r\n        <div className=\"bg-blue-50 border border-blue-200 rounded p-3\">\r\n          <p className=\"text-xs font-medium text-blue-900 mb-2\">Available Variables:</p>\r\n          <div className=\"text-xs text-blue-800 space-y-1\">\r\n            <div><code className=\"bg-blue-100 px-1 rounded\">{'{{storeName}}'}</code>, <code className=\"bg-blue-100 px-1 rounded\">{'{{logo}}'}</code>, <code className=\"bg-blue-100 px-1 rounded\">{'{{address}}'}</code>, <code className=\"bg-blue-100 px-1 rounded\">{'{{phone}}'}</code>, <code className=\"bg-blue-100 px-1 rounded\">{'{{email}}'}</code></div>\r\n            <div><code className=\"bg-blue-100 px-1 rounded\">{'{{receiptNumber}}'}</code>, <code className=\"bg-blue-100 px-1 rounded\">{'{{date}}'}</code>, <code className=\"bg-blue-100 px-1 rounded\">{'{{time}}'}</code></div>\r\n            <div><code className=\"bg-blue-100 px-1 rounded\">{'{{#each items}}'}</code> - Loop through items</div>\r\n            <div><code className=\"bg-blue-100 px-1 rounded\">{'{{#if condition}}'}</code> - Conditional blocks</div>\r\n            <div><code className=\"bg-blue-100 px-1 rounded\">{'{{subtotal}}'}</code>, <code className=\"bg-blue-100 px-1 rounded\">{'{{tax}}'}</code>, <code className=\"bg-blue-100 px-1 rounded\">{'{{total}}'}</code></div>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"flex items-center space-x-3\">\r\n          <button\r\n            onClick={() => onSave({ name, html, isDefault })}\r\n            className=\"px-4 py-2 bg-blue-600 text-white font-medium hover:bg-blue-700\"\r\n          >\r\n            Save Template\r\n          </button>\r\n          <button\r\n            onClick={onCancel}\r\n            className=\"px-4 py-2 bg-gray-200 text-gray-700 font-medium hover:bg-gray-300\"\r\n          >\r\n            Cancel\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\components\\settings\\TaxRulesManager.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'settings' is defined but never used. Allowed unused args must match /^_/u.","line":30,"column":43,"nodeType":null,"messageId":"unusedVar","endLine":30,"endColumn":51},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'onUpdate' is defined but never used. Allowed unused args must match /^_/u.","line":30,"column":61,"nodeType":null,"messageId":"unusedVar","endLine":30,"endColumn":69},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchRules'. Either include it or remove the dependency array.","line":39,"column":6,"nodeType":"ArrayExpression","endLine":39,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [fetchRules]","fix":{"range":[1090,1092],"text":"[fetchRules]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":49,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":49,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1396,1399],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1396,1399],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":79,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":79,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2396,2399],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2396,2399],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":100,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":100,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3099,3102],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3099,3102],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":274,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":274,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9621,9624],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9621,9624],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport { ITenantSettings } from '@/models/Tenant';\r\n\r\ninterface TaxRule {\r\n  id: string;\r\n  name: string;\r\n  rate: number;\r\n  label: string;\r\n  appliesTo?: 'all' | 'products' | 'services' | 'categories';\r\n  categoryIds?: string[];\r\n  productIds?: string[];\r\n  region?: {\r\n    country?: string;\r\n    state?: string;\r\n    city?: string;\r\n    zipCodes?: string[];\r\n  };\r\n  priority: number;\r\n  isActive: boolean;\r\n}\r\n\r\ninterface TaxRulesManagerProps {\r\n  settings: ITenantSettings;\r\n  tenant: string;\r\n  onUpdate: (updates: Partial<ITenantSettings>) => void;\r\n}\r\n\r\nexport default function TaxRulesManager({ settings, tenant, onUpdate }: TaxRulesManagerProps) {\r\n  const [rules, setRules] = useState<TaxRule[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [editing, setEditing] = useState<TaxRule | null>(null);\r\n  const [showForm, setShowForm] = useState(false);\r\n  const [message, setMessage] = useState<{ type: 'success' | 'error'; text: string } | null>(null);\r\n\r\n  useEffect(() => {\r\n    fetchRules();\r\n  }, []);\r\n\r\n  const fetchRules = async () => {\r\n    try {\r\n      setLoading(true);\r\n      const res = await fetch(`/api/tenants/${tenant}/tax-rules`, { credentials: 'include' });\r\n      const data = await res.json();\r\n      if (data.success) {\r\n        setRules(data.data || []);\r\n      }\r\n    } catch (error: any) {\r\n      setMessage({ type: 'error', text: error.message || 'Failed to load tax rules' });\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleSave = async (rule: Partial<TaxRule>) => {\r\n    try {\r\n      setMessage(null);\r\n      const url = `/api/tenants/${tenant}/tax-rules`;\r\n      const method = editing ? 'PUT' : 'POST';\r\n      const body = editing ? { id: editing.id, ...rule } : rule;\r\n\r\n      const res = await fetch(url, {\r\n        method,\r\n        headers: { 'Content-Type': 'application/json' },\r\n        credentials: 'include',\r\n        body: JSON.stringify(body),\r\n      });\r\n\r\n      const data = await res.json();\r\n      if (data.success) {\r\n        setMessage({ type: 'success', text: `Tax rule ${editing ? 'updated' : 'created'} successfully` });\r\n        setShowForm(false);\r\n        setEditing(null);\r\n        fetchRules();\r\n      } else {\r\n        setMessage({ type: 'error', text: data.error || 'Failed to save tax rule' });\r\n      }\r\n    } catch (error: any) {\r\n      setMessage({ type: 'error', text: error.message || 'Failed to save tax rule' });\r\n    }\r\n  };\r\n\r\n  const handleDelete = async (id: string) => {\r\n    if (!confirm('Are you sure you want to delete this tax rule?')) return;\r\n\r\n    try {\r\n      const res = await fetch(`/api/tenants/${tenant}/tax-rules?id=${id}`, {\r\n        method: 'DELETE',\r\n        credentials: 'include',\r\n      });\r\n\r\n      const data = await res.json();\r\n      if (data.success) {\r\n        setMessage({ type: 'success', text: 'Tax rule deleted successfully' });\r\n        fetchRules();\r\n      } else {\r\n        setMessage({ type: 'error', text: data.error || 'Failed to delete tax rule' });\r\n      }\r\n    } catch (error: any) {\r\n      setMessage({ type: 'error', text: error.message || 'Failed to delete tax rule' });\r\n    }\r\n  };\r\n\r\n  if (loading) {\r\n    return <div className=\"text-center py-8\">Loading tax rules...</div>;\r\n  }\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      <div className=\"flex items-center justify-between\">\r\n        <h3 className=\"text-lg font-semibold text-gray-900\">Tax Rules</h3>\r\n        <button\r\n          onClick={() => {\r\n            setEditing(null);\r\n            setShowForm(true);\r\n          }}\r\n          className=\"px-4 py-2 bg-blue-600 text-white text-sm font-medium hover:bg-blue-700\"\r\n        >\r\n          Add Tax Rule\r\n        </button>\r\n      </div>\r\n\r\n      {message && (\r\n        <div\r\n          className={`p-3 rounded ${\r\n            message.type === 'success' ? 'bg-green-50 text-green-800' : 'bg-red-50 text-red-800'\r\n          }`}\r\n        >\r\n          {message.text}\r\n        </div>\r\n      )}\r\n\r\n      {showForm && (\r\n        <TaxRuleForm\r\n          rule={editing}\r\n          onSave={handleSave}\r\n          onCancel={() => {\r\n            setShowForm(false);\r\n            setEditing(null);\r\n          }}\r\n        />\r\n      )}\r\n\r\n      <div className=\"space-y-3\">\r\n        {rules.length === 0 ? (\r\n          <div className=\"text-center py-8 text-gray-500\">\r\n            No tax rules yet. Add your first tax rule to get started.\r\n          </div>\r\n        ) : (\r\n          rules\r\n            .sort((a, b) => b.priority - a.priority)\r\n            .map((rule) => (\r\n              <div\r\n                key={rule.id}\r\n                className={`p-4 border-2 rounded ${\r\n                  rule.isActive ? 'border-gray-300 bg-white' : 'border-gray-200 bg-gray-50 opacity-60'\r\n                }`}\r\n              >\r\n                <div className=\"flex items-center justify-between\">\r\n                  <div>\r\n                    <h4 className=\"font-medium text-gray-900\">{rule.name}</h4>\r\n                    <div className=\"text-sm text-gray-600 mt-1\">\r\n                      <span className=\"font-medium\">{rule.rate}%</span> - {rule.label}\r\n                      {rule.appliesTo !== 'all' && (\r\n                        <span className=\"ml-2\"> Applies to: {rule.appliesTo}</span>\r\n                      )}\r\n                      {rule.region && (\r\n                        <span className=\"ml-2\">\r\n                           Region: {rule.region.country || 'Any'}\r\n                          {rule.region.state && `, ${rule.region.state}`}\r\n                        </span>\r\n                      )}\r\n                      <span className=\"ml-2\"> Priority: {rule.priority}</span>\r\n                    </div>\r\n                    {!rule.isActive && (\r\n                      <span className=\"text-xs text-gray-500 mt-1 block\">Inactive</span>\r\n                    )}\r\n                  </div>\r\n                  <div className=\"flex items-center space-x-2\">\r\n                    <button\r\n                      onClick={() => {\r\n                        setEditing(rule);\r\n                        setShowForm(true);\r\n                      }}\r\n                      className=\"px-3 py-1 text-xs text-gray-600 hover:text-gray-800 font-medium\"\r\n                    >\r\n                      Edit\r\n                    </button>\r\n                    <button\r\n                      onClick={() => handleDelete(rule.id)}\r\n                      className=\"px-3 py-1 text-xs text-red-600 hover:text-red-700 font-medium\"\r\n                    >\r\n                      Delete\r\n                    </button>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            ))\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction TaxRuleForm({\r\n  rule,\r\n  onSave,\r\n  onCancel,\r\n}: {\r\n  rule: TaxRule | null;\r\n  onSave: (rule: Partial<TaxRule>) => void;\r\n  onCancel: () => void;\r\n}) {\r\n  const [name, setName] = useState(rule?.name || '');\r\n  const [rate, setRate] = useState(rule?.rate?.toString() || '0');\r\n  const [label, setLabel] = useState(rule?.label || 'Tax');\r\n  const [appliesTo, setAppliesTo] = useState<'all' | 'products' | 'services' | 'categories'>(rule?.appliesTo || 'all');\r\n  const [priority, setPriority] = useState(rule?.priority?.toString() || '0');\r\n  const [isActive, setIsActive] = useState(rule?.isActive !== false);\r\n  const [country, setCountry] = useState(rule?.region?.country || '');\r\n  const [state, setState] = useState(rule?.region?.state || '');\r\n  const [city, setCity] = useState(rule?.region?.city || '');\r\n  const [zipCodes, setZipCodes] = useState(rule?.region?.zipCodes?.join(', ') || '');\r\n\r\n  return (\r\n    <div className=\"border-2 border-gray-300 rounded p-6 bg-white\">\r\n      <h4 className=\"text-lg font-semibold mb-4\">{rule ? 'Edit Tax Rule' : 'Add Tax Rule'}</h4>\r\n\r\n      <div className=\"space-y-4\">\r\n        <div>\r\n          <label className=\"block text-sm font-medium text-gray-700 mb-2\">Rule Name *</label>\r\n          <input\r\n            type=\"text\"\r\n            value={name}\r\n            onChange={(e) => setName(e.target.value)}\r\n            className=\"w-full px-4 py-2 border-2 border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\r\n            placeholder=\"e.g., California Sales Tax\"\r\n            required\r\n          />\r\n        </div>\r\n\r\n        <div className=\"grid grid-cols-2 gap-4\">\r\n          <div>\r\n            <label className=\"block text-sm font-medium text-gray-700 mb-2\">Tax Rate (%) *</label>\r\n            <input\r\n              type=\"number\"\r\n              min=\"0\"\r\n              max=\"100\"\r\n              step=\"0.01\"\r\n              value={rate}\r\n              onChange={(e) => setRate(e.target.value)}\r\n              className=\"w-full px-4 py-2 border-2 border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\r\n              required\r\n            />\r\n          </div>\r\n          <div>\r\n            <label className=\"block text-sm font-medium text-gray-700 mb-2\">Tax Label *</label>\r\n            <input\r\n              type=\"text\"\r\n              value={label}\r\n              onChange={(e) => setLabel(e.target.value)}\r\n              className=\"w-full px-4 py-2 border-2 border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\r\n              placeholder=\"e.g., VAT, GST, Sales Tax\"\r\n              required\r\n            />\r\n          </div>\r\n        </div>\r\n\r\n        <div>\r\n          <label className=\"block text-sm font-medium text-gray-700 mb-2\">Applies To</label>\r\n          <select\r\n            value={appliesTo}\r\n            onChange={(e) => setAppliesTo(e.target.value as any)}\r\n            className=\"w-full px-4 py-2 border-2 border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\r\n          >\r\n            <option value=\"all\">All Products & Services</option>\r\n            <option value=\"products\">Products Only</option>\r\n            <option value=\"services\">Services Only</option>\r\n            <option value=\"categories\">Specific Categories</option>\r\n          </select>\r\n        </div>\r\n\r\n        <div>\r\n          <label className=\"block text-sm font-medium text-gray-700 mb-2\">Region (Optional)</label>\r\n          <div className=\"grid grid-cols-3 gap-3\">\r\n            <input\r\n              type=\"text\"\r\n              value={country}\r\n              onChange={(e) => setCountry(e.target.value)}\r\n              className=\"px-4 py-2 border-2 border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\r\n              placeholder=\"Country\"\r\n            />\r\n            <input\r\n              type=\"text\"\r\n              value={state}\r\n              onChange={(e) => setState(e.target.value)}\r\n              className=\"px-4 py-2 border-2 border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\r\n              placeholder=\"State/Province\"\r\n            />\r\n            <input\r\n              type=\"text\"\r\n              value={city}\r\n              onChange={(e) => setCity(e.target.value)}\r\n              className=\"px-4 py-2 border-2 border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\r\n              placeholder=\"City\"\r\n            />\r\n          </div>\r\n          <input\r\n            type=\"text\"\r\n            value={zipCodes}\r\n            onChange={(e) => setZipCodes(e.target.value)}\r\n            className=\"mt-2 w-full px-4 py-2 border-2 border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\r\n            placeholder=\"Zip Codes (comma-separated)\"\r\n          />\r\n        </div>\r\n\r\n        <div className=\"grid grid-cols-2 gap-4\">\r\n          <div>\r\n            <label className=\"block text-sm font-medium text-gray-700 mb-2\">Priority</label>\r\n            <input\r\n              type=\"number\"\r\n              value={priority}\r\n              onChange={(e) => setPriority(e.target.value)}\r\n              className=\"w-full px-4 py-2 border-2 border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\r\n              placeholder=\"0\"\r\n            />\r\n            <p className=\"text-xs text-gray-500 mt-1\">Higher priority rules are applied first</p>\r\n          </div>\r\n          <div className=\"flex items-center pt-8\">\r\n            <input\r\n              type=\"checkbox\"\r\n              id=\"isActive\"\r\n              checked={isActive}\r\n              onChange={(e) => setIsActive(e.target.checked)}\r\n              className=\"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500\"\r\n            />\r\n            <label htmlFor=\"isActive\" className=\"ml-2 text-sm text-gray-700\">\r\n              Active\r\n            </label>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"flex items-center space-x-3\">\r\n          <button\r\n            onClick={() =>\r\n              onSave({\r\n                name,\r\n                rate: parseFloat(rate),\r\n                label,\r\n                appliesTo,\r\n                priority: parseInt(priority) || 0,\r\n                isActive,\r\n                region: country || state || city || zipCodes ? {\r\n                  country: country || undefined,\r\n                  state: state || undefined,\r\n                  city: city || undefined,\r\n                  zipCodes: zipCodes ? zipCodes.split(',').map((z) => z.trim()).filter(Boolean) : undefined,\r\n                } : undefined,\r\n              })\r\n            }\r\n            className=\"px-4 py-2 bg-blue-600 text-white font-medium hover:bg-blue-700\"\r\n          >\r\n            Save Rule\r\n          </button>\r\n          <button\r\n            onClick={onCancel}\r\n            className=\"px-4 py-2 bg-gray-200 text-gray-700 font-medium hover:bg-gray-300\"\r\n          >\r\n            Cancel\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\contexts\\AuthContext.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":75,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":75,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2405,2408],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2405,2408],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":110,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":110,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3392,3395],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3392,3395],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":131,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":131,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4079,4082],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4079,4082],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { createContext, useContext, useEffect, useState, ReactNode } from 'react';\r\nimport { useRouter, usePathname } from 'next/navigation';\r\n\r\ninterface User {\r\n  _id: string;\r\n  email: string;\r\n  name: string;\r\n  role: 'owner' | 'admin' | 'manager' | 'cashier' | 'viewer';\r\n}\r\n\r\ninterface AuthContextType {\r\n  user: User | null;\r\n  loading: boolean;\r\n  login: (email: string, password: string, tenantSlug: string) => Promise<{ success: boolean; error?: string }>;\r\n  loginPIN: (pin: string, tenantSlug: string) => Promise<{ success: boolean; error?: string }>;\r\n  loginQR: (qrToken: string, tenantSlug: string) => Promise<{ success: boolean; error?: string }>;\r\n  logout: () => Promise<void>;\r\n  isAuthenticated: boolean;\r\n  hasRole: (roles: string[]) => boolean;\r\n}\r\n\r\nconst AuthContext = createContext<AuthContextType | undefined>(undefined);\r\n\r\nexport function AuthProvider({ children }: { children: ReactNode }) {\r\n  const [user, setUser] = useState<User | null>(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const router = useRouter();\r\n  const pathname = usePathname();\r\n\r\n  // Check if user is authenticated on mount and route changes\r\n  useEffect(() => {\r\n    checkAuth();\r\n  }, [pathname]);\r\n\r\n  const checkAuth = async () => {\r\n    try {\r\n      // Check if we have a token in cookies\r\n      const res = await fetch('/api/auth/me', { credentials: 'include' });\r\n      if (res.ok) {\r\n        const data = await res.json();\r\n        if (data.success && data.user) {\r\n          setUser(data.user);\r\n        } else {\r\n          setUser(null);\r\n        }\r\n      } else {\r\n        setUser(null);\r\n      }\r\n    } catch (error) {\r\n      console.error('Auth check failed:', error);\r\n      setUser(null);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const login = async (email: string, password: string, tenantSlug: string) => {\r\n    try {\r\n      const res = await fetch('/api/auth/login', {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        credentials: 'include',\r\n        body: JSON.stringify({ email, password, tenantSlug }),\r\n      });\r\n\r\n      const data = await res.json();\r\n      if (data.success && data.data?.user) {\r\n        setUser(data.data.user);\r\n        return { success: true };\r\n      } else {\r\n        return { success: false, error: data.error || 'Login failed' };\r\n      }\r\n    } catch (error: any) {\r\n      return { success: false, error: error.message || 'Login failed' };\r\n    }\r\n  };\r\n\r\n  const logout = async () => {\r\n    try {\r\n      await fetch('/api/auth/logout', {\r\n        method: 'POST',\r\n        credentials: 'include',\r\n      });\r\n    } catch (error) {\r\n      console.error('Logout error:', error);\r\n    } finally {\r\n      setUser(null);\r\n      router.push('/login');\r\n    }\r\n  };\r\n\r\n  const loginPIN = async (pin: string, tenantSlug: string) => {\r\n    try {\r\n      const res = await fetch('/api/auth/login-pin', {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        credentials: 'include',\r\n        body: JSON.stringify({ pin, tenantSlug }),\r\n      });\r\n\r\n      const data = await res.json();\r\n      if (data.success && data.data?.user) {\r\n        setUser(data.data.user);\r\n        return { success: true };\r\n      } else {\r\n        return { success: false, error: data.error || 'Login failed' };\r\n      }\r\n    } catch (error: any) {\r\n      return { success: false, error: error.message || 'Login failed' };\r\n    }\r\n  };\r\n\r\n  const loginQR = async (qrToken: string, tenantSlug: string) => {\r\n    try {\r\n      const res = await fetch('/api/auth/login-qr', {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        credentials: 'include',\r\n        body: JSON.stringify({ qrToken, tenantSlug }),\r\n      });\r\n\r\n      const data = await res.json();\r\n      if (data.success && data.data?.user) {\r\n        setUser(data.data.user);\r\n        return { success: true };\r\n      } else {\r\n        return { success: false, error: data.error || 'Login failed' };\r\n      }\r\n    } catch (error: any) {\r\n      return { success: false, error: error.message || 'Login failed' };\r\n    }\r\n  };\r\n\r\n  const hasRole = (roles: string[]): boolean => {\r\n    if (!user) return false;\r\n    const roleHierarchy: Record<string, number> = {\r\n      viewer: 1,\r\n      cashier: 2,\r\n      manager: 3,\r\n      admin: 4,\r\n      owner: 5,\r\n    };\r\n    const userLevel = roleHierarchy[user.role] || 0;\r\n    return roles.some(role => roleHierarchy[role] <= userLevel);\r\n  };\r\n\r\n  return (\r\n    <AuthContext.Provider\r\n      value={{\r\n        user,\r\n        loading,\r\n        login,\r\n        loginPIN,\r\n        loginQR,\r\n        logout,\r\n        isAuthenticated: !!user,\r\n        hasRole,\r\n      }}\r\n    >\r\n      {children}\r\n    </AuthContext.Provider>\r\n  );\r\n}\r\n\r\nexport function useAuth() {\r\n  const context = useContext(AuthContext);\r\n  if (context === undefined) {\r\n    throw new Error('useAuth must be used within an AuthProvider');\r\n  }\r\n  return context;\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\contexts\\SubscriptionContext.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'refreshSubscription'. Either include it or remove the dependency array.","line":98,"column":6,"nodeType":"ArrayExpression","endLine":98,"endColumn":16,"suggestions":[{"desc":"Update the dependencies array to be: [refreshSubscription, tenantId]","fix":{"range":[2779,2789],"text":"[refreshSubscription, tenantId]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'refreshSubscription'. Either include it or remove the dependency array.","line":104,"column":6,"nodeType":"ArrayExpression","endLine":104,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [refreshSubscription]","fix":{"range":[2985,2987],"text":"[refreshSubscription]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React, { createContext, useContext, useEffect, useState, ReactNode } from 'react';\r\nimport { useParams } from 'next/navigation';\r\n\r\n// Define types locally to avoid importing mongoose models in client code\r\ninterface SubscriptionLimits {\r\n  maxUsers: number;\r\n  maxBranches: number;\r\n  maxProducts: number;\r\n  maxTransactions: number;\r\n}\r\n\r\ninterface SubscriptionFeatures {\r\n  enableInventory: boolean;\r\n  enableCategories: boolean;\r\n  enableDiscounts: boolean;\r\n  enableLoyaltyProgram: boolean;\r\n  enableCustomerManagement: boolean;\r\n  enableBookingScheduling: boolean;\r\n  enableReports: boolean;\r\n  enableMultiBranch: boolean;\r\n  enableHardwareIntegration: boolean;\r\n  prioritySupport: boolean;\r\n  customIntegrations: boolean;\r\n  dedicatedAccountManager: boolean;\r\n}\r\n\r\ninterface SubscriptionStatus {\r\n  isActive: boolean;\r\n  isTrial: boolean;\r\n  isExpired: boolean;\r\n  isTrialExpired: boolean;\r\n  planName: string;\r\n  limits: SubscriptionLimits;\r\n  features: SubscriptionFeatures;\r\n  usage: {\r\n    currentUsers: number;\r\n    currentBranches: number;\r\n    currentProducts: number;\r\n    currentTransactions: number;\r\n  };\r\n  billingCycle: 'monthly' | 'yearly';\r\n  trialEndDate?: Date;\r\n  nextBillingDate?: Date;\r\n}\r\n\r\ninterface SubscriptionContextType {\r\n  subscriptionStatus: SubscriptionStatus | null;\r\n  loading: boolean;\r\n  refreshSubscription: () => Promise<void>;\r\n}\r\n\r\nconst SubscriptionContext = createContext<SubscriptionContextType | undefined>(undefined);\r\n\r\nexport function useSubscription() {\r\n  const context = useContext(SubscriptionContext);\r\n  if (context === undefined) {\r\n    throw new Error('useSubscription must be used within a SubscriptionProvider');\r\n  }\r\n  return context;\r\n}\r\n\r\ninterface SubscriptionProviderProps {\r\n  children: ReactNode;\r\n}\r\n\r\nexport function SubscriptionProvider({ children }: SubscriptionProviderProps) {\r\n  const params = useParams();\r\n  const tenantId = params.tenant as string;\r\n  const [subscriptionStatus, setSubscriptionStatus] = useState<SubscriptionStatus | null>(null);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  const refreshSubscription = async () => {\r\n    if (!tenantId) return;\r\n\r\n    try {\r\n      setLoading(true);\r\n      const response = await fetch('/api/subscription/status');\r\n      const result = await response.json();\r\n\r\n      if (result.success) {\r\n        setSubscriptionStatus(result.data);\r\n      } else {\r\n        console.error('Error fetching subscription status:', result.error);\r\n        setSubscriptionStatus(null);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error fetching subscription status:', error);\r\n      setSubscriptionStatus(null);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    refreshSubscription();\r\n  }, [tenantId]);\r\n\r\n  // Refresh subscription status every 5 minutes\r\n  useEffect(() => {\r\n    const interval = setInterval(refreshSubscription, 5 * 60 * 1000);\r\n    return () => clearInterval(interval);\r\n  }, []);\r\n\r\n  const value: SubscriptionContextType = {\r\n    subscriptionStatus,\r\n    loading,\r\n    refreshSubscription,\r\n  };\r\n\r\n  return (\r\n    <SubscriptionContext.Provider value={value}>\r\n      {children}\r\n    </SubscriptionContext.Provider>\r\n  );\r\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\contexts\\TenantSettingsContext.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchSettings'. Either include it or remove the dependency array.","line":47,"column":6,"nodeType":"ArrayExpression","endLine":47,"endColumn":14,"suggestions":[{"desc":"Update the dependencies array to be: [fetchSettings, tenant]","fix":{"range":[1582,1590],"text":"[fetchSettings, tenant]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { createContext, useContext, useEffect, useState, ReactNode } from 'react';\r\nimport { useParams } from 'next/navigation';\r\nimport { ITenantSettings } from '@/models/Tenant';\r\nimport { getDefaultTenantSettings } from '@/lib/currency';\r\n\r\ninterface TenantSettingsContextType {\r\n  settings: ITenantSettings | null;\r\n  loading: boolean;\r\n  refreshSettings: () => Promise<void>;\r\n}\r\n\r\nconst TenantSettingsContext = createContext<TenantSettingsContextType | undefined>(undefined);\r\n\r\nexport function TenantSettingsProvider({ children }: { children: ReactNode }) {\r\n  const params = useParams();\r\n  const tenant = (params?.tenant as string) || 'default';\r\n  const [settings, setSettings] = useState<ITenantSettings | null>(null);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  const fetchSettings = async () => {\r\n    try {\r\n      setLoading(true);\r\n      const res = await fetch(`/api/tenants/${tenant}/settings`);\r\n      const data = await res.json();\r\n      \r\n      if (data.success) {\r\n        // Merge with defaults to ensure all fields exist\r\n        const defaultSettings = getDefaultTenantSettings();\r\n        setSettings({ ...defaultSettings, ...data.data });\r\n      } else {\r\n        // Use defaults if fetch fails\r\n        setSettings(getDefaultTenantSettings());\r\n      }\r\n    } catch (error) {\r\n      console.error('Error fetching tenant settings:', error);\r\n      // Use defaults on error\r\n      setSettings(getDefaultTenantSettings());\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    fetchSettings();\r\n  }, [tenant]);\r\n\r\n  // Apply primary color to CSS variables\r\n  useEffect(() => {\r\n    if (settings?.primaryColor) {\r\n      document.documentElement.style.setProperty('--primary-color', settings.primaryColor);\r\n      \r\n      // Generate lighter/darker variants\r\n      const hex = settings.primaryColor.replace('#', '');\r\n      const r = parseInt(hex.substr(0, 2), 16);\r\n      const g = parseInt(hex.substr(2, 2), 16);\r\n      const b = parseInt(hex.substr(4, 2), 16);\r\n      \r\n      // Light variant (for hover states)\r\n      const lightR = Math.min(255, r + 20);\r\n      const lightG = Math.min(255, g + 20);\r\n      const lightB = Math.min(255, b + 20);\r\n      document.documentElement.style.setProperty(\r\n        '--primary-color-light',\r\n        `rgb(${lightR}, ${lightG}, ${lightB})`\r\n      );\r\n      \r\n      // Dark variant\r\n      const darkR = Math.max(0, r - 20);\r\n      const darkG = Math.max(0, g - 20);\r\n      const darkB = Math.max(0, b - 20);\r\n      document.documentElement.style.setProperty(\r\n        '--primary-color-dark',\r\n        `rgb(${darkR}, ${darkG}, ${darkB})`\r\n      );\r\n    }\r\n  }, [settings?.primaryColor]);\r\n\r\n  return (\r\n    <TenantSettingsContext.Provider value={{ settings, loading, refreshSettings: fetchSettings }}>\r\n      {children}\r\n    </TenantSettingsContext.Provider>\r\n  );\r\n}\r\n\r\nexport function useTenantSettings() {\r\n  const context = useContext(TenantSettingsContext);\r\n  if (context === undefined) {\r\n    throw new Error('useTenantSettings must be used within a TenantSettingsProvider');\r\n  }\r\n  return context;\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\eslint.config.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\hooks\\useDeviceType.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\hooks\\useNetworkStatus.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\hooks\\useTenantAccess.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":66,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":66,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2139,2142],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2139,2142],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useEffect, useState } from 'react';\r\nimport { useParams, useRouter } from 'next/navigation';\r\n\r\ninterface TenantAccessCheck {\r\n  isValid: boolean;\r\n  loading: boolean;\r\n  error: string | null;\r\n  userTenantSlug: string | null;\r\n  requestedTenantSlug: string | null;\r\n}\r\n\r\n/**\r\n * Hook to check if the current user has access to the requested tenant\r\n * This runs on the client side to catch tenant access violations\r\n */\r\nexport function useTenantAccess(): TenantAccessCheck {\r\n  const params = useParams();\r\n  const router = useRouter();\r\n  const requestedTenant = params?.tenant as string;\r\n  \r\n  const [isValid, setIsValid] = useState(true);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [userTenantSlug, setUserTenantSlug] = useState<string | null>(null);\r\n\r\n  useEffect(() => {\r\n    async function checkTenantAccess() {\r\n      if (!requestedTenant) {\r\n        setLoading(false);\r\n        return;\r\n      }\r\n\r\n      try {\r\n        setLoading(true);\r\n        \r\n        // Get user's profile to check their tenant\r\n        const res = await fetch('/api/auth/profile', { credentials: 'include' });\r\n        const data = await res.json();\r\n        \r\n        if (res.status === 401) {\r\n          // User not authenticated - let ProtectedRoute handle it\r\n          setIsValid(true);\r\n          setLoading(false);\r\n          return;\r\n        }\r\n        \r\n        if (data.success && data.user) {\r\n          const userTenant = data.user.tenantSlug;\r\n          setUserTenantSlug(userTenant);\r\n          \r\n          // Check if user's tenant matches requested tenant\r\n          if (userTenant && userTenant !== requestedTenant) {\r\n            // Tenant mismatch - redirect to forbidden page\r\n            setIsValid(false);\r\n            setError('You do not have access to this store');\r\n            router.push(`/${requestedTenant}/forbidden`);\r\n          } else {\r\n            setIsValid(true);\r\n          }\r\n        } else {\r\n          // Couldn't get user info - assume valid for now\r\n          setIsValid(true);\r\n        }\r\n      } catch (err: any) {\r\n        console.error('Error checking tenant access:', err);\r\n        // On error, assume valid to avoid blocking legitimate access\r\n        setIsValid(true);\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    }\r\n\r\n    checkTenantAccess();\r\n  }, [requestedTenant, router]);\r\n\r\n  return {\r\n    isValid,\r\n    loading,\r\n    error,\r\n    userTenantSlug,\r\n    requestedTenantSlug: requestedTenant || null,\r\n  };\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\lib\\analytics.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":197,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":197,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5387,5390],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5387,5390],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'nonVatSales' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":253,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":253,"endColumn":20},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'vatSales' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":257,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":257,"endColumn":13},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":378,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":378,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10978,10981],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10978,10981],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Analytics and Reporting Utilities\r\n */\r\n\r\nimport mongoose from 'mongoose';\r\nimport Transaction from '@/models/Transaction';\r\nimport Expense from '@/models/Expense';\r\nimport CashDrawerSession from '@/models/CashDrawerSession';\r\nimport Product from '@/models/Product';\r\nimport { ITenantSettings } from '@/models/Tenant';\r\n\r\nexport interface SalesReport {\r\n  period: string;\r\n  startDate: Date;\r\n  endDate: Date;\r\n  totalSales: number;\r\n  totalTransactions: number;\r\n  averageTransaction: number;\r\n  salesByPaymentMethod: {\r\n    cash: number;\r\n    card: number;\r\n    digital: number;\r\n  };\r\n  salesByDay?: Array<{\r\n    date: string;\r\n    sales: number;\r\n    transactions: number;\r\n  }>;\r\n}\r\n\r\nexport interface ProductPerformance {\r\n  productId: string;\r\n  productName: string;\r\n  totalSold: number;\r\n  totalRevenue: number;\r\n  averagePrice: number;\r\n  quantitySold: number;\r\n  rank: number;\r\n}\r\n\r\nexport interface VATReport {\r\n  vatSales: number;\r\n  nonVatSales: number;\r\n  vatAmount: number;\r\n  totalSales: number;\r\n  vatRate: number;\r\n}\r\n\r\nexport interface ProfitLossSummary {\r\n  period: string;\r\n  startDate: Date;\r\n  endDate: Date;\r\n  revenue: {\r\n    total: number;\r\n    cash: number;\r\n    card: number;\r\n    digital: number;\r\n  };\r\n  expenses: {\r\n    total: number;\r\n    byCategory: Array<{\r\n      category: string;\r\n      amount: number;\r\n    }>;\r\n  };\r\n  grossProfit: number;\r\n  netProfit: number;\r\n  profitMargin: number;\r\n}\r\n\r\nexport interface CashDrawerReport {\r\n  sessionId: string;\r\n  userId: string;\r\n  userName?: string;\r\n  openingTime: Date;\r\n  closingTime?: Date;\r\n  openingAmount: number;\r\n  closingAmount?: number;\r\n  expectedAmount?: number;\r\n  shortage?: number;\r\n  overage?: number;\r\n  status: string;\r\n  cashSales: number;\r\n  cashExpenses: number;\r\n  netCash: number;\r\n}\r\n\r\nexport async function getSalesReport(\r\n  tenantId: string,\r\n  period: 'daily' | 'weekly' | 'monthly',\r\n  startDate?: Date,\r\n  endDate?: Date\r\n): Promise<SalesReport> {\r\n  const now = new Date();\r\n  let start: Date;\r\n  let end: Date = now;\r\n\r\n  if (startDate && endDate) {\r\n    start = startDate;\r\n    end = endDate;\r\n  } else {\r\n    switch (period) {\r\n      case 'daily':\r\n        start = new Date(now.getFullYear(), now.getMonth(), now.getDate());\r\n        break;\r\n      case 'weekly':\r\n        const dayOfWeek = now.getDay();\r\n        start = new Date(now);\r\n        start.setDate(now.getDate() - dayOfWeek);\r\n        start.setHours(0, 0, 0, 0);\r\n        break;\r\n      case 'monthly':\r\n        start = new Date(now.getFullYear(), now.getMonth(), 1);\r\n        break;\r\n    }\r\n  }\r\n\r\n  const transactions = await Transaction.find({\r\n    tenantId,\r\n    createdAt: { $gte: start, $lte: end },\r\n    status: 'completed',\r\n  }).lean();\r\n\r\n  const totalSales = transactions.reduce((sum, t) => sum + t.total, 0);\r\n  const totalTransactions = transactions.length;\r\n  const averageTransaction = totalTransactions > 0 ? totalSales / totalTransactions : 0;\r\n\r\n  const salesByPaymentMethod = {\r\n    cash: transactions.filter(t => t.paymentMethod === 'cash').reduce((sum, t) => sum + t.total, 0),\r\n    card: transactions.filter(t => t.paymentMethod === 'card').reduce((sum, t) => sum + t.total, 0),\r\n    digital: transactions.filter(t => t.paymentMethod === 'digital').reduce((sum, t) => sum + t.total, 0),\r\n  };\r\n\r\n  // Sales by day for detailed reports\r\n  const salesByDay: Array<{ date: string; sales: number; transactions: number }> = [];\r\n  if (period === 'daily' || period === 'weekly') {\r\n    const dayMap = new Map<string, { sales: number; transactions: number }>();\r\n    \r\n    transactions.forEach(t => {\r\n      const dateStr = new Date(t.createdAt).toISOString().split('T')[0];\r\n      const existing = dayMap.get(dateStr) || { sales: 0, transactions: 0 };\r\n      dayMap.set(dateStr, {\r\n        sales: existing.sales + t.total,\r\n        transactions: existing.transactions + 1,\r\n      });\r\n    });\r\n\r\n    dayMap.forEach((value, date) => {\r\n      salesByDay.push({ date, ...value });\r\n    });\r\n\r\n    salesByDay.sort((a, b) => a.date.localeCompare(b.date));\r\n  }\r\n\r\n  return {\r\n    period,\r\n    startDate: start,\r\n    endDate: end,\r\n    totalSales,\r\n    totalTransactions,\r\n    averageTransaction,\r\n    salesByPaymentMethod,\r\n    salesByDay: salesByDay.length > 0 ? salesByDay : undefined,\r\n  };\r\n}\r\n\r\nexport async function getProductPerformance(\r\n  tenantId: string,\r\n  startDate: Date,\r\n  endDate: Date,\r\n  limit: number = 10\r\n): Promise<ProductPerformance[]> {\r\n  // Ensure Product model is registered before using populate\r\n  // This is necessary in Next.js serverless functions where models might not be registered yet\r\n  // Accessing the model ensures its registration code has executed\r\n  if (!mongoose.models.Product) {\r\n    // The Product model should be registered when imported, but if it's not,\r\n    // we need to ensure it's registered. Accessing Product.modelName forces evaluation.\r\n    const _ = Product.modelName;\r\n  }\r\n  \r\n  const transactions = await Transaction.find({\r\n    tenantId,\r\n    createdAt: { $gte: startDate, $lte: endDate },\r\n    status: 'completed',\r\n  }).populate('items.product', 'name').lean();\r\n\r\n  const productMap = new Map<string, {\r\n    productId: string;\r\n    productName: string;\r\n    totalRevenue: number;\r\n    quantitySold: number;\r\n    transactions: number;\r\n  }>();\r\n\r\n  transactions.forEach(transaction => {\r\n    transaction.items.forEach((item: any) => {\r\n      const productId = item.product?._id?.toString() || item.product?.toString();\r\n      const productName = item.product?.name || item.name || 'Unknown';\r\n      \r\n      const existing = productMap.get(productId) || {\r\n        productId,\r\n        productName,\r\n        totalRevenue: 0,\r\n        quantitySold: 0,\r\n        transactions: 0,\r\n      };\r\n\r\n      existing.totalRevenue += item.subtotal;\r\n      existing.quantitySold += item.quantity;\r\n      existing.transactions += 1;\r\n\r\n      productMap.set(productId, existing);\r\n    });\r\n  });\r\n\r\n  const performances: ProductPerformance[] = Array.from(productMap.values())\r\n    .map(p => ({\r\n      productId: p.productId,\r\n      productName: p.productName,\r\n      totalSold: p.quantitySold,\r\n      totalRevenue: p.totalRevenue,\r\n      averagePrice: p.quantitySold > 0 ? p.totalRevenue / p.quantitySold : 0,\r\n      quantitySold: p.quantitySold,\r\n      rank: 0, // Will be set after sorting\r\n    }))\r\n    .sort((a, b) => b.totalRevenue - a.totalRevenue)\r\n    .slice(0, limit)\r\n    .map((p, index) => ({ ...p, rank: index + 1 }));\r\n\r\n  return performances;\r\n}\r\n\r\nexport async function getVATReport(\r\n  tenantId: string,\r\n  startDate: Date,\r\n  endDate: Date,\r\n  settings: ITenantSettings\r\n): Promise<VATReport> {\r\n  const transactions = await Transaction.find({\r\n    tenantId,\r\n    createdAt: { $gte: startDate, $lte: endDate },\r\n    status: 'completed',\r\n  }).lean();\r\n\r\n  const vatRate = settings.taxEnabled && settings.taxRate ? settings.taxRate / 100 : 0;\r\n  \r\n  // For simplicity, we'll assume all sales are VAT sales if tax is enabled\r\n  // In a real system, you'd have a flag on products/transactions\r\n  const totalSales = transactions.reduce((sum, t) => sum + t.total, 0);\r\n  \r\n  let vatSales = 0;\r\n  const nonVatSales = 0;\r\n  \r\n  if (vatRate > 0) {\r\n    // Calculate VAT sales (total includes VAT)\r\n    vatSales = totalSales;\r\n    // Calculate base amount (without VAT)\r\n    const baseAmount = totalSales / (1 + vatRate);\r\n    const vatAmount = totalSales - baseAmount;\r\n    \r\n    return {\r\n      vatSales: baseAmount,\r\n      nonVatSales: 0,\r\n      vatAmount,\r\n      totalSales,\r\n      vatRate: vatRate * 100,\r\n    };\r\n  } else {\r\n    return {\r\n      vatSales: 0,\r\n      nonVatSales: totalSales,\r\n      vatAmount: 0,\r\n      totalSales,\r\n      vatRate: 0,\r\n    };\r\n  }\r\n}\r\n\r\nexport async function getProfitLossSummary(\r\n  tenantId: string,\r\n  startDate: Date,\r\n  endDate: Date\r\n): Promise<ProfitLossSummary> {\r\n  const transactions = await Transaction.find({\r\n    tenantId,\r\n    createdAt: { $gte: startDate, $lte: endDate },\r\n    status: 'completed',\r\n  }).lean();\r\n\r\n  const expenses = await Expense.find({\r\n    tenantId,\r\n    date: { $gte: startDate, $lte: endDate },\r\n  }).lean();\r\n\r\n  const revenue = {\r\n    total: transactions.reduce((sum, t) => sum + t.total, 0),\r\n    cash: transactions.filter(t => t.paymentMethod === 'cash').reduce((sum, t) => sum + t.total, 0),\r\n    card: transactions.filter(t => t.paymentMethod === 'card').reduce((sum, t) => sum + t.total, 0),\r\n    digital: transactions.filter(t => t.paymentMethod === 'digital').reduce((sum, t) => sum + t.total, 0),\r\n  };\r\n\r\n  const expenseTotal = expenses.reduce((sum, e) => sum + e.amount, 0);\r\n  \r\n  const expenseByCategory = new Map<string, number>();\r\n  expenses.forEach(expense => {\r\n    // Use expense name as category since Expense model doesn't have a category field\r\n    const category = expense.name || 'Other';\r\n    const existing = expenseByCategory.get(category) || 0;\r\n    expenseByCategory.set(category, existing + expense.amount);\r\n  });\r\n\r\n  const expensesData = {\r\n    total: expenseTotal,\r\n    byCategory: Array.from(expenseByCategory.entries()).map(([category, amount]) => ({\r\n      category,\r\n      amount,\r\n    })),\r\n  };\r\n\r\n  const grossProfit = revenue.total;\r\n  const netProfit = revenue.total - expenseTotal;\r\n  const profitMargin = revenue.total > 0 ? (netProfit / revenue.total) * 100 : 0;\r\n\r\n  return {\r\n    period: `${startDate.toISOString().split('T')[0]} to ${endDate.toISOString().split('T')[0]}`,\r\n    startDate,\r\n    endDate,\r\n    revenue,\r\n    expenses: expensesData,\r\n    grossProfit,\r\n    netProfit,\r\n    profitMargin,\r\n  };\r\n}\r\n\r\nexport async function getCashDrawerReports(\r\n  tenantId: string,\r\n  startDate: Date,\r\n  endDate: Date\r\n): Promise<CashDrawerReport[]> {\r\n  const sessions = await CashDrawerSession.find({\r\n    tenantId,\r\n    openingTime: { $gte: startDate, $lte: endDate },\r\n  })\r\n    .populate('userId', 'name email')\r\n    .sort({ openingTime: -1 })\r\n    .lean();\r\n\r\n  const reports: CashDrawerReport[] = [];\r\n\r\n  for (const session of sessions) {\r\n    // Get cash sales for this session period\r\n    const sessionEnd = session.closingTime || new Date();\r\n    const cashTransactions = await Transaction.find({\r\n      tenantId,\r\n      paymentMethod: 'cash',\r\n      createdAt: { $gte: session.openingTime, $lte: sessionEnd },\r\n      status: 'completed',\r\n    }).lean();\r\n\r\n    const cashSales = cashTransactions.reduce((sum, t) => sum + t.total, 0);\r\n\r\n    // Get cash expenses for this session period\r\n    const cashExpenses = await Expense.find({\r\n      tenantId,\r\n      paymentMethod: 'cash',\r\n      date: { $gte: session.openingTime, $lte: sessionEnd },\r\n    }).lean();\r\n\r\n    const cashExpensesTotal = cashExpenses.reduce((sum, e) => sum + e.amount, 0);\r\n\r\n    const netCash = session.openingAmount + cashSales - cashExpensesTotal - (session.closingAmount || 0);\r\n\r\n    reports.push({\r\n      sessionId: session._id.toString(),\r\n      userId: session.userId.toString(),\r\n      userName: (session.userId as any)?.name || 'Unknown',\r\n      openingTime: session.openingTime,\r\n      closingTime: session.closingTime,\r\n      openingAmount: session.openingAmount,\r\n      closingAmount: session.closingAmount,\r\n      expectedAmount: session.expectedAmount,\r\n      shortage: session.shortage,\r\n      overage: session.overage,\r\n      status: session.status,\r\n      cashSales,\r\n      cashExpenses: cashExpensesTotal,\r\n      netCash,\r\n    });\r\n  }\r\n\r\n  return reports;\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\lib\\api-client.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":9,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":9,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[413,416],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[413,416],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":58,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":58,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2369,2372],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2369,2372],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// Track if we're already redirecting to prevent multiple redirects\r\nlet isRedirecting = false;\r\n\r\n/**\r\n * Utility function to handle API responses, especially 403 Forbidden (tenant access violations)\r\n * Automatically redirects to forbidden page if tenant access is denied\r\n * IMPORTANT: Skips redirect if already on the forbidden page to prevent infinite loops\r\n */\r\nexport async function handleApiResponse<T = any>(\r\n  response: Response,\r\n  options?: {\r\n    redirectOn403?: boolean;\r\n    defaultRedirect?: string;\r\n  }\r\n): Promise<T> {\r\n  const { redirectOn403 = true, defaultRedirect } = options || {};\r\n  \r\n  // Check if we're already on the forbidden page or already redirecting to prevent redirect loops\r\n  const isOnForbiddenPage = typeof window !== 'undefined' && window.location.pathname.includes('/forbidden');\r\n  \r\n  // Check for 403 Forbidden response (tenant access violation)\r\n  if (response.status === 403 && redirectOn403 && !isOnForbiddenPage && !isRedirecting) {\r\n    try {\r\n      const data = await response.json();\r\n      \r\n      // Redirect to forbidden page if redirect URL is provided\r\n      const redirectUrl = data.redirect || defaultRedirect;\r\n      if (redirectUrl && typeof window !== 'undefined') {\r\n        isRedirecting = true;\r\n        window.location.href = redirectUrl;\r\n        // Return a promise that never resolves to prevent further execution\r\n        return new Promise(() => {}) as T;\r\n      }\r\n    } catch (error) {\r\n      // If JSON parsing fails, still try to redirect with default (only if not on forbidden page)\r\n      if (defaultRedirect && typeof window !== 'undefined' && !isOnForbiddenPage && !isRedirecting) {\r\n        isRedirecting = true;\r\n        window.location.href = defaultRedirect;\r\n        return new Promise(() => {}) as T;\r\n      }\r\n    }\r\n    // If no redirect URL available or already on forbidden page, throw error\r\n    throw new Error('Forbidden: Access denied to this tenant');\r\n  }\r\n  \r\n  // For non-403 responses, return the JSON data\r\n  if (!response.ok) {\r\n    const errorData = await response.json().catch(() => ({ error: 'Request failed' }));\r\n    throw new Error(errorData.error || `Request failed with status ${response.status}`);\r\n  }\r\n  \r\n  return await response.json();\r\n}\r\n\r\n/**\r\n * Enhanced fetch wrapper that automatically handles 403 responses\r\n */\r\nexport async function apiFetch<T = any>(\r\n  url: string,\r\n  options?: RequestInit & {\r\n    redirectOn403?: boolean;\r\n    defaultRedirect?: string;\r\n  }\r\n): Promise<T> {\r\n  const { redirectOn403, defaultRedirect, ...fetchOptions } = options || {};\r\n  \r\n  const response = await fetch(url, fetchOptions);\r\n  return handleApiResponse<T>(response, { redirectOn403, defaultRedirect });\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\lib\\api-tenant.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'request' is defined but never used. Allowed unused args must match /^_/u.","line":261,"column":61,"nodeType":null,"messageId":"unusedVar","endLine":261,"endColumn":68}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\nimport { getTenantBySlug, getTenantFromHost, getTenantId } from './tenant';\r\nimport { getCurrentUser } from './auth';\r\nimport connectDB from './mongodb';\r\n\r\n/**\r\n * Custom error class for tenant access violations\r\n * Includes the tenant slug for redirect purposes\r\n */\r\nexport class TenantAccessViolationError extends Error {\r\n  tenantSlug: string;\r\n  \r\n  constructor(tenantSlug: string, message: string = 'Access denied to this tenant') {\r\n    super(message);\r\n    this.name = 'TenantAccessViolationError';\r\n    this.tenantSlug = tenantSlug;\r\n  }\r\n}\r\n\r\n/**\r\n * Get tenant ID from request\r\n * SECURITY: For authenticated requests, prioritizes the authenticated user's tenantId\r\n * to prevent cross-tenant data access. Only falls back to request parameters for unauthenticated requests.\r\n * \r\n * Checks in order:\r\n * 1. Authenticated user's tenantId (if authenticated) - SECURITY: Prevents cross-tenant access\r\n * 2. Host header (subdomain/domain) - Most reliable for unauthenticated requests\r\n * 3. Referer header (for API calls from tenant pages)\r\n * 4. Query parameter or custom header (less secure, only for unauthenticated)\r\n * 5. Default tenant\r\n */\r\nexport async function getTenantIdFromRequest(request: NextRequest): Promise<string | null> {\r\n  // SECURITY: For authenticated requests, use the user's tenantId first\r\n  // This prevents users from accessing other tenants' data by manipulating request parameters\r\n  try {\r\n    const user = await getCurrentUser(request);\r\n    if (user && user.tenantId) {\r\n      // User is authenticated - use their tenantId and validate it matches request\r\n      const requestTenantId = await getTenantIdFromRequestParams(request);\r\n      \r\n      // If request specifies a different tenant, reject it for security\r\n      if (requestTenantId && requestTenantId !== user.tenantId) {\r\n        console.warn(`Security: User ${user.userId} from tenant ${user.tenantId} attempted to access tenant ${requestTenantId}`);\r\n        \r\n        // Get the tenant slug for redirect - try to get it from the request first\r\n        let tenantSlug = 'default';\r\n        try {\r\n          const requestedTenantSlug = await getTenantSlugFromRequest(request);\r\n          if (requestedTenantSlug && requestedTenantSlug !== 'default') {\r\n            tenantSlug = requestedTenantSlug;\r\n          } else {\r\n            // If we can't get the slug from request, get it from the tenant ID\r\n            const Tenant = (await import('@/models/Tenant')).default;\r\n            await connectDB();\r\n            const tenant = await Tenant.findById(requestTenantId).select('slug').lean();\r\n            if (tenant && tenant.slug) {\r\n              tenantSlug = tenant.slug;\r\n            }\r\n          }\r\n        } catch (e) {\r\n          // If we can't get the slug, try to get it from the tenant ID\r\n          try {\r\n            const Tenant = (await import('@/models/Tenant')).default;\r\n            await connectDB();\r\n            const tenant = await Tenant.findById(requestTenantId).select('slug').lean();\r\n            if (tenant && tenant.slug) {\r\n              tenantSlug = tenant.slug;\r\n            }\r\n          } catch (err) {\r\n            // Fallback to default - will redirect to /default/forbidden\r\n          }\r\n        }\r\n        \r\n        // Throw error that includes tenant slug for redirect\r\n        throw new TenantAccessViolationError(\r\n          tenantSlug,\r\n          `Forbidden: Access denied to tenant ${tenantSlug}`\r\n        );\r\n      }\r\n      \r\n      // Return the authenticated user's tenantId (most secure)\r\n      return user.tenantId;\r\n    }\r\n  } catch (error) {\r\n    // Re-throw TenantAccessViolationError so it can be handled by the caller\r\n    if (error instanceof TenantAccessViolationError) {\r\n      throw error;\r\n    }\r\n    // If auth check fails for other reasons, continue to fallback methods\r\n    console.debug('Auth check failed, using fallback tenant detection:', error);\r\n  }\r\n  \r\n  // For unauthenticated requests, use fallback methods\r\n  return await getTenantIdFromRequestParams(request);\r\n}\r\n\r\n/**\r\n * Get tenant ID from request parameters (query, headers, referer, host)\r\n * This is used as a fallback for unauthenticated requests or to validate against authenticated user's tenant\r\n */\r\nasync function getTenantIdFromRequestParams(request: NextRequest): Promise<string | null> {\r\n  // Try from host header first (most reliable for subdomain routing)\r\n  const host = request.headers.get('host') || '';\r\n  const tenantFromHost = await getTenantFromHost(host);\r\n  if (tenantFromHost) {\r\n    return tenantFromHost._id;\r\n  }\r\n  \r\n  // Try from referer header (for API calls from tenant pages)\r\n  const referer = request.headers.get('referer');\r\n  if (referer) {\r\n    try {\r\n      const refererUrl = new URL(referer);\r\n      const refererPathParts = refererUrl.pathname.split('/').filter(Boolean);\r\n      if (refererPathParts.length > 0) {\r\n        const refererTenantSlug = refererPathParts[0];\r\n        // Skip common paths that aren't tenant slugs\r\n        if (refererTenantSlug !== 'api' && \r\n            refererTenantSlug !== 'admin' && \r\n            refererTenantSlug !== 'login' &&\r\n            refererTenantSlug !== 'signup' &&\r\n            !refererTenantSlug.startsWith('_')) {\r\n          const tenantId = await getTenantId(refererTenantSlug);\r\n          if (tenantId) {\r\n            return tenantId;\r\n          }\r\n        }\r\n      }\r\n    } catch (e) {\r\n      // Invalid referer URL, continue\r\n    }\r\n  }\r\n  \r\n  // Try query parameter (less secure, but needed for some unauthenticated endpoints)\r\n  const tenantSlug = request.nextUrl.searchParams.get('tenant');\r\n  if (tenantSlug) {\r\n    return await getTenantId(tenantSlug);\r\n  }\r\n  \r\n  // Try custom header (if client sends it)\r\n  const tenantHeader = request.headers.get('x-tenant-slug') || request.headers.get('x-tenant-id');\r\n  if (tenantHeader) {\r\n    // If it's already an ID (ObjectId format), return it\r\n    if (/^[0-9a-fA-F]{24}$/.test(tenantHeader)) {\r\n      return tenantHeader;\r\n    }\r\n    // Otherwise treat it as a slug\r\n    const tenantId = await getTenantId(tenantHeader);\r\n    if (tenantId) {\r\n      return tenantId;\r\n    }\r\n  }\r\n  \r\n  // Default tenant\r\n  return await getTenantId('default');\r\n}\r\n\r\n/**\r\n * Get tenant slug from request\r\n */\r\nexport async function getTenantSlugFromRequest(request: NextRequest): Promise<string> {\r\n  // Try query parameter first\r\n  const tenantSlug = request.nextUrl.searchParams.get('tenant');\r\n  if (tenantSlug) {\r\n    const tenant = await getTenantBySlug(tenantSlug);\r\n    if (tenant) return tenant.slug;\r\n  }\r\n  \r\n  // Try from referer header (for API calls from tenant pages)\r\n  const referer = request.headers.get('referer');\r\n  if (referer) {\r\n    try {\r\n      const refererUrl = new URL(referer);\r\n      const refererPathParts = refererUrl.pathname.split('/').filter(Boolean);\r\n      if (refererPathParts.length > 0) {\r\n        const refererTenantSlug = refererPathParts[0];\r\n        // Skip common paths that aren't tenant slugs\r\n        if (refererTenantSlug !== 'api' && \r\n            refererTenantSlug !== 'admin' && \r\n            refererTenantSlug !== 'login' &&\r\n            refererTenantSlug !== 'signup' &&\r\n            !refererTenantSlug.startsWith('_')) {\r\n          const tenant = await getTenantBySlug(refererTenantSlug);\r\n          if (tenant) return tenant.slug;\r\n        }\r\n      }\r\n    } catch (e) {\r\n      // Invalid referer URL, continue\r\n    }\r\n  }\r\n  \r\n  // Try from host header (subdomain/domain)\r\n  const host = request.headers.get('host') || '';\r\n  const tenantFromHost = await getTenantFromHost(host);\r\n  if (tenantFromHost) {\r\n    return tenantFromHost.slug;\r\n  }\r\n  \r\n  return 'default';\r\n}\r\n\r\n/**\r\n * SECURITY: Get and validate tenant ID for authenticated requests\r\n * Ensures the authenticated user's tenant matches the request tenant\r\n * Throws TenantAccessViolationError if there's a tenant mismatch (which includes redirect info)\r\n * \r\n * @param request - The Next.js request object\r\n * @returns Object with tenantId and user info, or throws error if unauthorized\r\n */\r\nexport async function requireTenantAccess(request: NextRequest): Promise<{\r\n  tenantId: string;\r\n  user: {\r\n    userId: string;\r\n    tenantId: string;\r\n    email: string;\r\n    role: string;\r\n  };\r\n}> {\r\n  const user = await getCurrentUser(request);\r\n  \r\n  if (!user) {\r\n    throw new Error('Unauthorized: Authentication required');\r\n  }\r\n  \r\n  const requestTenantId = await getTenantIdFromRequestParams(request);\r\n  \r\n  // If request specifies a tenant, it must match the user's tenant\r\n  if (requestTenantId && requestTenantId !== user.tenantId) {\r\n    console.warn(`Security violation: User ${user.userId} from tenant ${user.tenantId} attempted to access tenant ${requestTenantId}`);\r\n    \r\n    // Get the tenant slug for redirect\r\n    let tenantSlug = 'default';\r\n    try {\r\n      const Tenant = (await import('@/models/Tenant')).default;\r\n      await connectDB();\r\n      const tenant = await Tenant.findById(requestTenantId).select('slug').lean();\r\n      if (tenant && tenant.slug) {\r\n        tenantSlug = tenant.slug;\r\n      }\r\n    } catch (err) {\r\n      // Fallback to default\r\n    }\r\n    \r\n    throw new TenantAccessViolationError(\r\n      tenantSlug,\r\n      `Forbidden: Access denied to tenant ${tenantSlug}`\r\n    );\r\n  }\r\n  \r\n  // Return the authenticated user's tenantId (most secure)\r\n  return {\r\n    tenantId: user.tenantId,\r\n    user,\r\n  };\r\n}\r\n\r\n/**\r\n * Helper function to handle TenantAccessViolationError in API routes\r\n * Returns a NextResponse with 403 status and redirect information\r\n */\r\nexport function handleTenantAccessViolation(error: unknown, request: NextRequest): NextResponse {\r\n  if (error instanceof TenantAccessViolationError) {\r\n    const redirectUrl = `/${error.tenantSlug}/forbidden`;\r\n    return NextResponse.json(\r\n      { \r\n        success: false, \r\n        error: error.message,\r\n        redirect: redirectUrl \r\n      },\r\n      { \r\n        status: 403,\r\n        headers: {\r\n          'Location': redirectUrl\r\n        }\r\n      }\r\n    );\r\n  }\r\n  throw error; // Re-throw if it's not a TenantAccessViolationError\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\lib\\audit.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":13,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":13,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[392,395],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[392,395],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":14,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":14,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[427,430],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[427,430],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest } from 'next/server';\r\nimport mongoose from 'mongoose';\r\nimport connectDB from './mongodb';\r\nimport AuditLog from '@/models/AuditLog';\r\nimport { getCurrentUser } from './auth';\r\n\r\nexport interface AuditLogData {\r\n  tenantId: string | mongoose.Types.ObjectId;\r\n  userId?: string;\r\n  action: string;\r\n  entityType: string;\r\n  entityId?: string;\r\n  changes?: Record<string, any>;\r\n  metadata?: Record<string, any>;\r\n}\r\n\r\n/**\r\n * Create audit log entry\r\n */\r\nexport async function createAuditLog(\r\n  request: NextRequest,\r\n  data: Omit<AuditLogData, 'userId'> & { tenantId?: string | mongoose.Types.ObjectId }\r\n): Promise<void> {\r\n  try {\r\n    await connectDB();\r\n    \r\n    const user = await getCurrentUser(request);\r\n    const ipAddress = request.headers.get('x-forwarded-for') || \r\n                     request.headers.get('x-real-ip') || \r\n                     'unknown';\r\n    const userAgent = request.headers.get('user-agent') || 'unknown';\r\n\r\n    // Get tenantId from parameter, user, or request\r\n    let tenantId: string | mongoose.Types.ObjectId;\r\n    \r\n    if (data.tenantId) {\r\n      // Use provided tenantId (could be ObjectId or string)\r\n      tenantId = data.tenantId;\r\n    } else if (user) {\r\n      // Get from authenticated user\r\n      tenantId = user.tenantId;\r\n    } else {\r\n      // Try to get from URL (only for non-API routes)\r\n      const url = new URL(request.url);\r\n      const pathname = url.pathname;\r\n      \r\n      // Skip API routes - they don't have tenant slugs in the path\r\n      if (pathname.startsWith('/api/')) {\r\n        // For API routes without tenant info, try to find default tenant\r\n        const Tenant = (await import('@/models/Tenant')).default;\r\n        const defaultTenant = await Tenant.findOne({ slug: 'default' }).lean();\r\n        if (defaultTenant) {\r\n          tenantId = defaultTenant._id;\r\n        } else {\r\n          // Can't create audit log without tenant\r\n          console.warn('Cannot create audit log: no tenant available for API route:', pathname);\r\n          return;\r\n        }\r\n      } else {\r\n        // For non-API routes, extract tenant slug and convert to ObjectId\r\n        const tenantMatch = pathname.match(/\\/([^/]+)\\//);\r\n        const tenantSlug = tenantMatch ? tenantMatch[1] : 'default';\r\n        \r\n        // Convert slug to ObjectId\r\n        const Tenant = (await import('@/models/Tenant')).default;\r\n        const tenant = await Tenant.findOne({ slug: tenantSlug }).lean();\r\n        if (tenant) {\r\n          tenantId = tenant._id;\r\n        } else {\r\n          console.warn('Cannot create audit log: tenant not found for slug:', tenantSlug);\r\n          return;\r\n        }\r\n      }\r\n    }\r\n\r\n    // Ensure tenantId is an ObjectId\r\n    if (typeof tenantId === 'string') {\r\n      // Check if it's already a valid ObjectId string\r\n      if (mongoose.Types.ObjectId.isValid(tenantId)) {\r\n        tenantId = new mongoose.Types.ObjectId(tenantId);\r\n      } else {\r\n        // It's a slug, need to look up the tenant\r\n        const Tenant = (await import('@/models/Tenant')).default;\r\n        const tenant = await Tenant.findOne({ slug: tenantId }).lean();\r\n        if (tenant) {\r\n          tenantId = tenant._id;\r\n        } else {\r\n          console.warn('Cannot create audit log: tenant not found for slug:', tenantId);\r\n          return;\r\n        }\r\n      }\r\n    }\r\n\r\n    await AuditLog.create({\r\n      tenantId,\r\n      userId: user?.userId,\r\n      action: data.action,\r\n      entityType: data.entityType,\r\n      entityId: data.entityId,\r\n      changes: data.changes,\r\n      metadata: data.metadata,\r\n      ipAddress,\r\n      userAgent,\r\n    });\r\n  } catch (error) {\r\n    // Don't throw - audit logging should not break the application\r\n    console.error('Error creating audit log:', error);\r\n  }\r\n}\r\n\r\n/**\r\n * Common audit actions\r\n */\r\nexport const AuditActions = {\r\n  CREATE: 'create',\r\n  UPDATE: 'update',\r\n  DELETE: 'delete',\r\n  VIEW: 'view',\r\n  LOGIN: 'login',\r\n  LOGOUT: 'logout',\r\n  TRANSACTION_CREATE: 'transaction.create',\r\n  TRANSACTION_CANCEL: 'transaction.cancel',\r\n  TRANSACTION_REFUND: 'transaction.refund',\r\n  STOCK_ADJUST: 'stock.adjust',\r\n  STOCK_PURCHASE: 'stock.purchase',\r\n  DISCOUNT_CREATE: 'discount.create',\r\n  DISCOUNT_UPDATE: 'discount.update',\r\n  DISCOUNT_DELETE: 'discount.delete',\r\n  ATTENDANCE_CLOCK_IN: 'attendance.clock_in',\r\n  ATTENDANCE_CLOCK_OUT: 'attendance.clock_out',\r\n  PAYMENT_CREATE: 'payment.create',\r\n  PAYMENT_REFUND: 'payment.refund',\r\n  INVOICE_CREATE: 'invoice.create',\r\n  INVOICE_UPDATE: 'invoice.update',\r\n  INVOICE_SEND: 'invoice.send',\r\n  INVOICE_MARK_PAID: 'invoice.mark_paid',\r\n} as const;\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\lib\\auth-customer.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\lib\\auth.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\lib\\automations\\abandoned-carts.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'User' is defined but never used. Allowed unused vars must match /^_/u.","line":10,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":12},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":80,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":80,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2346,2349],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2346,2349],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":165,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":165,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5712,5715],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5712,5715],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":170,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":170,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5867,5870],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5867,5870],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":181,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":181,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6233,6236],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6233,6236],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Abandoned Cart Reminders\r\n * Remind customers about saved/abandoned carts\r\n */\r\n\r\nimport connectDB from '@/lib/mongodb';\r\nimport SavedCart from '@/models/SavedCart';\r\nimport Transaction from '@/models/Transaction';\r\nimport Tenant from '@/models/Tenant';\r\nimport User from '@/models/User';\r\nimport { sendEmail } from '@/lib/notifications';\r\nimport { getTenantSettingsById } from '@/lib/tenant';\r\nimport { AutomationResult } from './types';\r\n\r\nexport interface AbandonedCartOptions {\r\n  tenantId?: string;\r\n  hoursAgo?: number; // Hours since cart was saved to consider abandoned (default: 24)\r\n}\r\n\r\n/**\r\n * Send reminders for abandoned carts\r\n */\r\nexport async function sendAbandonedCartReminders(\r\n  options: AbandonedCartOptions = {}\r\n): Promise<AutomationResult> {\r\n  await connectDB();\r\n\r\n  const results: AutomationResult = {\r\n    success: true,\r\n    message: '',\r\n    processed: 0,\r\n    failed: 0,\r\n    errors: [],\r\n  };\r\n\r\n  try {\r\n    const hoursAgo = options.hoursAgo || 24;\r\n    const cutoffTime = new Date(Date.now() - hoursAgo * 60 * 60 * 1000);\r\n\r\n    // Get tenants to process\r\n    let tenants;\r\n    if (options.tenantId) {\r\n      const tenant = await Tenant.findById(options.tenantId).lean();\r\n      tenants = tenant ? [tenant] : [];\r\n    } else {\r\n      tenants = await Tenant.find({ status: 'active' }).lean();\r\n    }\r\n\r\n    if (tenants.length === 0) {\r\n      results.message = 'No tenants found to process';\r\n      return results;\r\n    }\r\n\r\n    let totalReminders = 0;\r\n    let totalFailed = 0;\r\n\r\n    for (const tenant of tenants) {\r\n      try {\r\n        const tenantId = tenant._id.toString();\r\n        const tenantSettings = await getTenantSettingsById(tenantId);\r\n\r\n        // Skip if email notifications disabled\r\n        if (!tenantSettings?.emailNotifications) {\r\n          continue;\r\n        }\r\n\r\n        // Find saved carts that haven't been converted to transactions\r\n        // Carts saved more than X hours ago\r\n        const abandonedCarts = await SavedCart.find({\r\n          tenantId,\r\n          updatedAt: { $lte: cutoffTime },\r\n        })\r\n          .populate('userId', 'name email')\r\n          .sort({ updatedAt: -1 })\r\n          .limit(100) // Limit to prevent too many emails\r\n          .lean();\r\n\r\n        for (const cart of abandonedCarts) {\r\n          try {\r\n            const user = cart.userId as any;\r\n            if (!user || !user.email) {\r\n              continue; // Skip if no user or email\r\n            }\r\n\r\n            // Check if cart was already converted to transaction\r\n            // (This is a simple check - in production, you might want to track this better)\r\n            const recentTransactions = await Transaction.find({\r\n              tenantId,\r\n              userId: user._id,\r\n              createdAt: { $gte: cart.updatedAt },\r\n            }).limit(1).lean();\r\n\r\n            if (recentTransactions.length > 0) {\r\n              continue; // Cart was likely completed\r\n            }\r\n\r\n            const companyName = tenantSettings?.companyName || tenant.name || 'Business';\r\n            const hoursSinceSaved = Math.round((Date.now() - cart.updatedAt.getTime()) / (1000 * 60 * 60));\r\n\r\n            // Build cart items list\r\n            const itemsList = cart.items\r\n              .slice(0, 10) // Limit to 10 items in email\r\n              .map(item => `  - ${item.name} x${item.quantity} - $${(item.price * item.quantity).toFixed(2)}`)\r\n              .join('\\n');\r\n\r\n            const moreItems = cart.items.length > 10 ? `\\n  ... and ${cart.items.length - 10} more items` : '';\r\n\r\n            const reminderHtml = `\r\n<!DOCTYPE html>\r\n<html>\r\n<head>\r\n  <meta charset=\"UTF-8\">\r\n  <style>\r\n    body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }\r\n    .container { max-width: 600px; margin: 0 auto; padding: 20px; }\r\n    .header { text-align: center; border-bottom: 2px solid #000; padding-bottom: 10px; margin-bottom: 20px; }\r\n    .cart-items { background-color: #f4f4f4; padding: 15px; border-radius: 5px; margin: 20px 0; }\r\n    .total { font-size: 1.2em; font-weight: bold; margin-top: 15px; }\r\n    .button { display: inline-block; padding: 12px 24px; background-color: #2563eb; color: white; text-decoration: none; border-radius: 5px; margin-top: 20px; }\r\n    .footer { text-align: center; margin-top: 20px; font-size: 12px; color: #666; }\r\n  </style>\r\n</head>\r\n<body>\r\n  <div class=\"container\">\r\n    <div class=\"header\">\r\n      <h2>Complete Your Purchase</h2>\r\n      <p>${companyName}</p>\r\n    </div>\r\n\r\n    <p>Hello ${user.name || 'Valued Customer'},</p>\r\n    \r\n    <p>We noticed you saved a cart ${hoursSinceSaved} hour${hoursSinceSaved > 1 ? 's' : ''} ago but haven't completed your purchase yet.</p>\r\n    \r\n    <div class=\"cart-items\">\r\n      <h3>Your Saved Cart:</h3>\r\n      <pre style=\"font-family: Arial, sans-serif;\">${itemsList}${moreItems}</pre>\r\n      <div class=\"total\">Total: $${cart.total.toFixed(2)}</div>\r\n    </div>\r\n    \r\n    <p>Don't miss out! Complete your purchase now.</p>\r\n    \r\n    <p style=\"text-align: center;\">\r\n      <a href=\"${tenantSettings?.website || '#'}\" class=\"button\">Complete Purchase</a>\r\n    </p>\r\n    \r\n    <p>If you have any questions, please contact us.</p>\r\n    \r\n    <div class=\"footer\">\r\n      <p>This is an automated reminder from ${companyName}.</p>\r\n      <p>If you've already completed this purchase, please ignore this email.</p>\r\n    </div>\r\n  </div>\r\n</body>\r\n</html>\r\n            `.trim();\r\n\r\n            await sendEmail({\r\n              to: user.email,\r\n              subject: `Complete Your Purchase - ${companyName}`,\r\n              message: reminderHtml,\r\n              type: 'email',\r\n            });\r\n\r\n            totalReminders++;\r\n          } catch (error: any) {\r\n            totalFailed++;\r\n            results.errors?.push(`Cart ${cart._id}: ${error.message}`);\r\n          }\r\n        }\r\n      } catch (error: any) {\r\n        totalFailed++;\r\n        results.errors?.push(`Tenant ${tenant.name}: ${error.message}`);\r\n      }\r\n    }\r\n\r\n    results.processed = totalReminders;\r\n    results.failed = totalFailed;\r\n    results.message = `Sent ${totalReminders} abandoned cart reminders${totalFailed > 0 ? `, ${totalFailed} failed` : ''}`;\r\n\r\n    return results;\r\n  } catch (error: any) {\r\n    results.success = false;\r\n    results.message = `Error sending abandoned cart reminders: ${error.message}`;\r\n    results.errors?.push(error.message);\r\n    return results;\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\lib\\automations\\attendance-auto-clockout.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'User' is defined but never used. Allowed unused vars must match /^_/u.","line":9,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":12},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":138,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":138,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5263,5266],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5263,5266],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":182,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":182,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6970,6973],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6970,6973],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":187,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":187,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7131,7134],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7131,7134],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":198,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":198,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7493,7496],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7493,7496],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Automatic Clock-Out for Forgotten Sessions\r\n * Auto-clock-out employees who forgot to clock out\r\n */\r\n\r\nimport connectDB from '@/lib/mongodb';\r\nimport Attendance from '@/models/Attendance';\r\nimport Tenant from '@/models/Tenant';\r\nimport User from '@/models/User';\r\nimport { sendEmail } from '@/lib/notifications';\r\nimport { getTenantSettingsById } from '@/lib/tenant';\r\nimport { AutomationResult } from './types';\r\n\r\nexport interface AutoClockOutOptions {\r\n  tenantId?: string;\r\n  gracePeriodHours?: number; // Hours after shift end to auto-clock-out (default: 2)\r\n}\r\n\r\n/**\r\n * Automatically clock out employees who forgot to clock out\r\n */\r\nexport async function autoClockOutForgottenSessions(\r\n  options: AutoClockOutOptions = {}\r\n): Promise<AutomationResult> {\r\n  await connectDB();\r\n\r\n  const results: AutomationResult = {\r\n    success: true,\r\n    message: '',\r\n    processed: 0,\r\n    failed: 0,\r\n    errors: [],\r\n  };\r\n\r\n  try {\r\n    const gracePeriodHours = options.gracePeriodHours || 2;\r\n\r\n    // Get tenants to process\r\n    let tenants;\r\n    if (options.tenantId) {\r\n      const tenant = await Tenant.findById(options.tenantId).lean();\r\n      tenants = tenant ? [tenant] : [];\r\n    } else {\r\n      // Get all active tenants\r\n      tenants = await Tenant.find({ status: 'active' }).lean();\r\n    }\r\n\r\n    if (tenants.length === 0) {\r\n      results.message = 'No tenants found to process';\r\n      return results;\r\n    }\r\n\r\n    let totalProcessed = 0;\r\n    let totalFailed = 0;\r\n    const now = new Date();\r\n\r\n    for (const tenant of tenants) {\r\n      try {\r\n        const tenantId = tenant._id.toString();\r\n        const tenantSettings = await getTenantSettingsById(tenantId);\r\n\r\n        // Check if attendance notifications are enabled\r\n        if (!tenantSettings?.attendanceNotifications?.enabled) {\r\n          continue;\r\n        }\r\n\r\n        // Find all open attendance sessions\r\n        const openSessions = await Attendance.find({\r\n          tenantId,\r\n          clockOut: null,\r\n        })\r\n          .populate('userId', 'name email')\r\n          .lean();\r\n\r\n        for (const session of openSessions) {\r\n          try {\r\n            const clockInTime = new Date(session.clockIn);\r\n            const hoursSinceClockIn = (now.getTime() - clockInTime.getTime()) / (1000 * 60 * 60);\r\n\r\n            // Get expected shift end time (if configured)\r\n            const expectedEndTime = tenantSettings?.attendanceNotifications?.expectedStartTime\r\n              ? (() => {\r\n                  // Simple logic: if expected start is 9 AM, assume 8-hour shift\r\n                  const [hours, minutes] = tenantSettings.attendanceNotifications.expectedStartTime.split(':').map(Number);\r\n                  const expectedStart = new Date(clockInTime);\r\n                  expectedStart.setHours(hours, minutes || 0, 0, 0);\r\n                  \r\n                  // If clock-in was before expected start, use expected start\r\n                  if (clockInTime < expectedStart) {\r\n                    const expectedEnd = new Date(expectedStart);\r\n                    expectedEnd.setHours(expectedEnd.getHours() + 8); // 8-hour shift\r\n                    return expectedEnd;\r\n                  } else {\r\n                    // Use clock-in time + 8 hours\r\n                    const expectedEnd = new Date(clockInTime);\r\n                    expectedEnd.setHours(expectedEnd.getHours() + 8);\r\n                    return expectedEnd;\r\n                  }\r\n                })()\r\n              : null;\r\n\r\n            // Determine if we should auto-clock-out\r\n            let shouldAutoClockOut = false;\r\n            let clockOutTime = now;\r\n\r\n            if (expectedEndTime) {\r\n              // Auto-clock-out if past expected end time + grace period\r\n              const gracePeriodEnd = new Date(expectedEndTime.getTime() + gracePeriodHours * 60 * 60 * 1000);\r\n              if (now > gracePeriodEnd) {\r\n                shouldAutoClockOut = true;\r\n                clockOutTime = expectedEndTime; // Use expected end time, not current time\r\n              }\r\n            } else {\r\n              // If no expected end time, use max hours without clock-out\r\n              const maxHours = tenantSettings?.attendanceNotifications?.maxHoursWithoutClockOut || 12;\r\n              if (hoursSinceClockIn > maxHours) {\r\n                shouldAutoClockOut = true;\r\n                // Use clock-in + max hours as clock-out time\r\n                clockOutTime = new Date(clockInTime.getTime() + maxHours * 60 * 60 * 1000);\r\n              }\r\n            }\r\n\r\n            if (shouldAutoClockOut) {\r\n              // Calculate total hours\r\n              const totalMs = clockOutTime.getTime() - clockInTime.getTime();\r\n              const totalHours = Math.round((totalMs / (1000 * 60 * 60)) * 100) / 100;\r\n\r\n              // Update attendance record\r\n              await Attendance.findByIdAndUpdate(session._id, {\r\n                clockOut: clockOutTime,\r\n                totalHours,\r\n                notes: (session.notes || '') + (session.notes ? '\\n' : '') + `[AUTO] Automatically clocked out after grace period.`,\r\n              });\r\n\r\n              totalProcessed++;\r\n\r\n              // Send notification to employee and manager\r\n              const user = session.userId as any;\r\n              if (user?.email && tenantSettings?.emailNotifications) {\r\n                const companyName = tenantSettings?.companyName || tenant.name || 'Business';\r\n                await sendEmail({\r\n                  to: user.email,\r\n                  subject: `Auto Clock-Out: ${user.name || 'Employee'}`,\r\n                  message: `Hello ${user.name || 'Employee'},\r\n\r\nYour attendance session has been automatically clocked out.\r\n\r\nClock-in: ${clockInTime.toLocaleString()}\r\nClock-out: ${clockOutTime.toLocaleString()}\r\nTotal hours: ${totalHours} hours\r\n\r\nThis occurred because you did not manually clock out within the grace period. If this is incorrect, please contact your manager.\r\n\r\nBest regards,\r\n${companyName} Attendance System`,\r\n                  type: 'email',\r\n                }).catch(() => {\r\n                  // Don't fail if email fails\r\n                });\r\n              }\r\n\r\n              // Also notify manager/admin\r\n              if (tenantSettings?.email && tenantSettings?.email !== user?.email) {\r\n                await sendEmail({\r\n                  to: tenantSettings.email,\r\n                  subject: `Auto Clock-Out Alert: ${user?.name || 'Employee'}`,\r\n                  message: `An employee has been automatically clocked out:\r\n\r\nEmployee: ${user?.name || 'Unknown'}\r\nEmail: ${user?.email || 'N/A'}\r\nClock-in: ${clockInTime.toLocaleString()}\r\nClock-out: ${clockOutTime.toLocaleString()}\r\nTotal hours: ${totalHours} hours\r\n\r\nPlease review this attendance record.`,\r\n                  type: 'email',\r\n                }).catch(() => {\r\n                  // Don't fail if email fails\r\n                });\r\n              }\r\n            }\r\n          } catch (error: any) {\r\n            totalFailed++;\r\n            results.errors?.push(`Session ${session._id}: ${error.message}`);\r\n          }\r\n        }\r\n      } catch (error: any) {\r\n        totalFailed++;\r\n        results.errors?.push(`Tenant ${tenant.name}: ${error.message}`);\r\n      }\r\n    }\r\n\r\n    results.processed = totalProcessed;\r\n    results.failed = totalFailed;\r\n    results.message = `Auto-clocked out ${totalProcessed} sessions${totalFailed > 0 ? `, ${totalFailed} failed` : ''}`;\r\n\r\n    return results;\r\n  } catch (error: any) {\r\n    results.success = false;\r\n    results.message = `Error auto-clocking out sessions: ${error.message}`;\r\n    results.errors?.push(error.message);\r\n    return results;\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\lib\\automations\\attendance-violations.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'User' is defined but never used. Allowed unused vars must match /^_/u.","line":9,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":12},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":95,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":95,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3096,3099],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3096,3099],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":124,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":124,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4184,4187],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4184,4187],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":134,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":134,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4560,4563],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4560,4563],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":145,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":145,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4929,4932],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4929,4932],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Attendance Violation Alerts\r\n * Alert managers for attendance issues (late arrivals, missing clock-ins)\r\n */\r\n\r\nimport connectDB from '@/lib/mongodb';\r\nimport Attendance from '@/models/Attendance';\r\nimport Tenant from '@/models/Tenant';\r\nimport User from '@/models/User';\r\nimport { sendEmail } from '@/lib/notifications';\r\nimport { getTenantSettingsById } from '@/lib/tenant';\r\nimport { AutomationResult } from './types';\r\n\r\nexport interface AttendanceViolationOptions {\r\n  tenantId?: string;\r\n  lateThresholdMinutes?: number; // Minutes late to trigger alert (default: 15)\r\n}\r\n\r\n/**\r\n * Detect and alert on attendance violations\r\n */\r\nexport async function detectAttendanceViolations(\r\n  options: AttendanceViolationOptions = {}\r\n): Promise<AutomationResult> {\r\n  await connectDB();\r\n\r\n  const results: AutomationResult = {\r\n    success: true,\r\n    message: '',\r\n    processed: 0,\r\n    failed: 0,\r\n    errors: [],\r\n  };\r\n\r\n  try {\r\n    const lateThresholdMinutes = options.lateThresholdMinutes || 15;\r\n    const now = new Date();\r\n    const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());\r\n\r\n    // Get tenants to process\r\n    let tenants;\r\n    if (options.tenantId) {\r\n      const tenant = await Tenant.findById(options.tenantId).lean();\r\n      tenants = tenant ? [tenant] : [];\r\n    } else {\r\n      tenants = await Tenant.find({ status: 'active' }).lean();\r\n    }\r\n\r\n    if (tenants.length === 0) {\r\n      results.message = 'No tenants found to process';\r\n      return results;\r\n    }\r\n\r\n    let totalViolations = 0;\r\n    let totalFailed = 0;\r\n\r\n    for (const tenant of tenants) {\r\n      try {\r\n        const tenantId = tenant._id.toString();\r\n        const tenantSettings = await getTenantSettingsById(tenantId);\r\n\r\n        // Skip if attendance notifications disabled\r\n        if (!tenantSettings?.attendanceNotifications?.enabled) {\r\n          continue;\r\n        }\r\n\r\n        // Get expected start time from tenant settings\r\n        const expectedStartTime = tenantSettings?.attendanceNotifications?.expectedStartTime;\r\n        if (!expectedStartTime) {\r\n          continue; // Can't check violations without expected start time\r\n        }\r\n\r\n        const [expectedHour, expectedMinute] = expectedStartTime.split(':').map(Number);\r\n        const expectedStart = new Date(today);\r\n        expectedStart.setHours(expectedHour, expectedMinute || 0, 0, 0);\r\n\r\n        // Find attendance records for today\r\n        const todayAttendance = await Attendance.find({\r\n          tenantId,\r\n          clockIn: {\r\n            $gte: today,\r\n            $lt: new Date(today.getTime() + 24 * 60 * 60 * 1000),\r\n          },\r\n        })\r\n          .populate('userId', 'name email')\r\n          .lean();\r\n\r\n        // Check for late arrivals\r\n        for (const attendance of todayAttendance) {\r\n          try {\r\n            const clockInTime = new Date(attendance.clockIn);\r\n            const minutesLate = (clockInTime.getTime() - expectedStart.getTime()) / (1000 * 60);\r\n\r\n            if (minutesLate > lateThresholdMinutes) {\r\n              const user = attendance.userId as any;\r\n              if (!user) continue;\r\n\r\n              // Send alert to manager\r\n              if (tenantSettings?.emailNotifications && tenantSettings?.email) {\r\n                const companyName = tenantSettings?.companyName || tenant.name || 'Business';\r\n                \r\n                await sendEmail({\r\n                  to: tenantSettings.email,\r\n                  subject: `Attendance Violation: Late Arrival - ${user.name || 'Employee'}`,\r\n                  message: `Attendance Violation Alert for ${companyName}\r\n\r\nEmployee: ${user.name || 'Unknown'}\r\nEmail: ${user.email || 'N/A'}\r\nExpected Start Time: ${expectedStart.toLocaleTimeString()}\r\nActual Clock-In Time: ${clockInTime.toLocaleTimeString()}\r\nMinutes Late: ${Math.round(minutesLate)}\r\n\r\nPlease review this attendance record.\r\n\r\nThis is an automated alert from your POS system.`,\r\n                  type: 'email',\r\n                }).catch(() => {\r\n                  // Don't fail if email fails\r\n                });\r\n\r\n                totalViolations++;\r\n              }\r\n            }\r\n          } catch (error: any) {\r\n            totalFailed++;\r\n            results.errors?.push(`Attendance ${attendance._id}: ${error.message}`);\r\n          }\r\n        }\r\n\r\n        // Check for missing clock-ins (users who should have clocked in but haven't)\r\n        // This would require a user schedule system, which may not exist\r\n        // For now, we'll skip this check\r\n\r\n      } catch (error: any) {\r\n        totalFailed++;\r\n        results.errors?.push(`Tenant ${tenant.name}: ${error.message}`);\r\n      }\r\n    }\r\n\r\n    results.processed = totalViolations;\r\n    results.failed = totalFailed;\r\n    results.message = `Detected ${totalViolations} attendance violations${totalFailed > 0 ? `, ${totalFailed} failed` : ''}`;\r\n\r\n    return results;\r\n  } catch (error: any) {\r\n    results.success = false;\r\n    results.message = `Error detecting attendance violations: ${error.message}`;\r\n    results.errors?.push(error.message);\r\n    return results;\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\lib\\automations\\audit-log-cleanup.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":80,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":80,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2281,2284],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2281,2284],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":91,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":91,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2668,2671],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2668,2671],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Automatic Audit Log Cleanup\r\n * Archive or delete old audit logs based on retention policy\r\n */\r\n\r\nimport connectDB from '@/lib/mongodb';\r\nimport AuditLog from '@/models/AuditLog';\r\nimport Tenant from '@/models/Tenant';\r\nimport { AutomationResult } from './types';\r\n\r\nexport interface AuditLogCleanupOptions {\r\n  tenantId?: string;\r\n  retentionYears?: number; // Years to keep logs (default: 2)\r\n  archive?: boolean; // Archive instead of delete (default: false)\r\n}\r\n\r\n/**\r\n * Clean up old audit logs based on retention policy\r\n */\r\nexport async function cleanupAuditLogs(\r\n  options: AuditLogCleanupOptions = {}\r\n): Promise<AutomationResult> {\r\n  await connectDB();\r\n\r\n  const results: AutomationResult = {\r\n    success: true,\r\n    message: '',\r\n    processed: 0,\r\n    failed: 0,\r\n    errors: [],\r\n  };\r\n\r\n  try {\r\n    const retentionYears = options.retentionYears || 2;\r\n    const cutoffDate = new Date();\r\n    cutoffDate.setFullYear(cutoffDate.getFullYear() - retentionYears);\r\n\r\n    // Get tenants to process\r\n    let tenants;\r\n    if (options.tenantId) {\r\n      const tenant = await Tenant.findById(options.tenantId).lean();\r\n      tenants = tenant ? [tenant] : [];\r\n    } else {\r\n      tenants = await Tenant.find({ status: 'active' }).lean();\r\n    }\r\n\r\n    let totalDeleted = 0;\r\n    let totalFailed = 0;\r\n\r\n    for (const tenant of tenants) {\r\n      try {\r\n        const tenantId = tenant._id.toString();\r\n\r\n        // Find old audit logs\r\n        const oldLogs = await AuditLog.find({\r\n          tenantId,\r\n          createdAt: { $lt: cutoffDate },\r\n        }).lean();\r\n\r\n        if (oldLogs.length === 0) {\r\n          continue;\r\n        }\r\n\r\n        if (options.archive) {\r\n          // TODO: Archive to separate collection or database\r\n          // For now, we'll just delete\r\n          const deleteResult = await AuditLog.deleteMany({\r\n            tenantId,\r\n            createdAt: { $lt: cutoffDate },\r\n          });\r\n          totalDeleted += deleteResult.deletedCount || 0;\r\n        } else {\r\n          // Delete old logs\r\n          const deleteResult = await AuditLog.deleteMany({\r\n            tenantId,\r\n            createdAt: { $lt: cutoffDate },\r\n          });\r\n          totalDeleted += deleteResult.deletedCount || 0;\r\n        }\r\n      } catch (error: any) {\r\n        totalFailed++;\r\n        results.errors?.push(`Tenant ${tenant.name}: ${error.message}`);\r\n      }\r\n    }\r\n\r\n    results.processed = totalDeleted;\r\n    results.failed = totalFailed;\r\n    results.message = `${options.archive ? 'Archived' : 'Deleted'} ${totalDeleted} audit logs${totalFailed > 0 ? `, ${totalFailed} failed` : ''}`;\r\n\r\n    return results;\r\n  } catch (error: any) {\r\n    results.success = false;\r\n    results.message = `Error cleaning up audit logs: ${error.message}`;\r\n    results.errors?.push(error.message);\r\n    return results;\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\lib\\automations\\booking-confirmations.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":105,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":105,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3367,3370],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3367,3370],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":110,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":110,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3528,3531],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3528,3531],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":121,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":121,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3888,3891],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3888,3891],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Automatic Booking Confirmations\r\n * Auto-confirm bookings based on rules (e.g., no conflicts, payment received)\r\n */\r\n\r\nimport connectDB from '@/lib/mongodb';\r\nimport Booking from '@/models/Booking';\r\nimport Tenant from '@/models/Tenant';\r\nimport { sendBookingConfirmation } from '@/lib/notifications';\r\nimport { getTenantSettingsById } from '@/lib/tenant';\r\nimport { AutomationResult } from './types';\r\n\r\nexport interface BookingConfirmationOptions {\r\n  tenantId?: string;\r\n  bookingId?: string; // For single booking confirmation\r\n}\r\n\r\n/**\r\n * Automatically confirm bookings based on rules\r\n */\r\nexport async function autoConfirmBookings(\r\n  options: BookingConfirmationOptions = {}\r\n): Promise<AutomationResult> {\r\n  await connectDB();\r\n\r\n  const results: AutomationResult = {\r\n    success: true,\r\n    message: '',\r\n    processed: 0,\r\n    failed: 0,\r\n    errors: [],\r\n  };\r\n\r\n  try {\r\n    // Get tenants to process\r\n    let tenants;\r\n    if (options.tenantId) {\r\n      const tenant = await Tenant.findById(options.tenantId).lean();\r\n      tenants = tenant ? [tenant] : [];\r\n    } else {\r\n      tenants = await Tenant.find({ status: 'active' }).lean();\r\n    }\r\n\r\n    if (tenants.length === 0) {\r\n      results.message = 'No tenants found to process';\r\n      return results;\r\n    }\r\n\r\n    let totalConfirmed = 0;\r\n    let totalFailed = 0;\r\n\r\n    for (const tenant of tenants) {\r\n      try {\r\n        const tenantId = tenant._id.toString();\r\n        const tenantSettings = await getTenantSettingsById(tenantId);\r\n\r\n        // Find pending bookings that can be auto-confirmed\r\n        // Rules: no conflicts, within business hours (if configured), status is pending\r\n        const pendingBookings = await Booking.find({\r\n          tenantId,\r\n          status: 'pending',\r\n          confirmationSent: { $ne: true },\r\n        }).lean();\r\n\r\n        for (const booking of pendingBookings) {\r\n          try {\r\n            // Check for conflicts (bookings that overlap)\r\n            const conflictingBookings = await Booking.find({\r\n              tenantId,\r\n              _id: { $ne: booking._id },\r\n              status: { $in: ['pending', 'confirmed'] },\r\n              $or: [\r\n                {\r\n                  startTime: { $lt: booking.endTime },\r\n                  endTime: { $gt: booking.startTime },\r\n                },\r\n              ],\r\n            }).lean();\r\n\r\n            // If no conflicts, auto-confirm\r\n            if (conflictingBookings.length === 0) {\r\n              await Booking.findByIdAndUpdate(booking._id, {\r\n                status: 'confirmed',\r\n                confirmationSent: true,\r\n              });\r\n\r\n              // Send confirmation email/SMS\r\n              await sendBookingConfirmation(\r\n                {\r\n                  customerName: booking.customerName,\r\n                  customerEmail: booking.customerEmail,\r\n                  customerPhone: booking.customerPhone,\r\n                  serviceName: booking.serviceName,\r\n                  startTime: booking.startTime,\r\n                  endTime: booking.endTime,\r\n                  staffName: booking.staffName,\r\n                  notes: booking.notes,\r\n                  bookingId: booking._id.toString(),\r\n                },\r\n                tenantSettings || undefined\r\n              );\r\n\r\n              totalConfirmed++;\r\n            }\r\n          } catch (error: any) {\r\n            totalFailed++;\r\n            results.errors?.push(`Booking ${booking._id}: ${error.message}`);\r\n          }\r\n        }\r\n      } catch (error: any) {\r\n        totalFailed++;\r\n        results.errors?.push(`Tenant ${tenant.name}: ${error.message}`);\r\n      }\r\n    }\r\n\r\n    results.processed = totalConfirmed;\r\n    results.failed = totalFailed;\r\n    results.message = `Auto-confirmed ${totalConfirmed} bookings${totalFailed > 0 ? `, ${totalFailed} failed` : ''}`;\r\n\r\n    return results;\r\n  } catch (error: any) {\r\n    results.success = false;\r\n    results.message = `Error auto-confirming bookings: ${error.message}`;\r\n    results.errors?.push(error.message);\r\n    return results;\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\lib\\automations\\booking-no-show.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":124,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":124,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4292,4295],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4292,4295],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":129,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":129,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4453,4456],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4453,4456],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":140,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":140,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4803,4806],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4803,4806],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Automatic No-Show Detection and Follow-up\r\n * Detect no-shows and automatically update status and send follow-up\r\n */\r\n\r\nimport connectDB from '@/lib/mongodb';\r\nimport Booking from '@/models/Booking';\r\nimport Tenant from '@/models/Tenant';\r\nimport { sendEmail, sendSMS } from '@/lib/notifications';\r\nimport { getTenantSettingsById } from '@/lib/tenant';\r\nimport { formatDate, formatTime } from '@/lib/formatting';\r\nimport { AutomationResult } from './types';\r\n\r\nexport interface NoShowDetectionOptions {\r\n  tenantId?: string;\r\n  gracePeriodMinutes?: number; // Minutes after start time to mark as no-show (default: 15)\r\n}\r\n\r\n/**\r\n * Automatically detect and handle no-shows\r\n */\r\nexport async function detectNoShows(\r\n  options: NoShowDetectionOptions = {}\r\n): Promise<AutomationResult> {\r\n  await connectDB();\r\n\r\n  const results: AutomationResult = {\r\n    success: true,\r\n    message: '',\r\n    processed: 0,\r\n    failed: 0,\r\n    errors: [],\r\n  };\r\n\r\n  try {\r\n    const gracePeriodMinutes = options.gracePeriodMinutes || 15;\r\n    const now = new Date();\r\n\r\n    // Get tenants to process\r\n    let tenants;\r\n    if (options.tenantId) {\r\n      const tenant = await Tenant.findById(options.tenantId).lean();\r\n      tenants = tenant ? [tenant] : [];\r\n    } else {\r\n      tenants = await Tenant.find({ status: 'active' }).lean();\r\n    }\r\n\r\n    if (tenants.length === 0) {\r\n      results.message = 'No tenants found to process';\r\n      return results;\r\n    }\r\n\r\n    let totalNoShows = 0;\r\n    let totalFailed = 0;\r\n\r\n    for (const tenant of tenants) {\r\n      try {\r\n        const tenantId = tenant._id.toString();\r\n        const tenantSettings = await getTenantSettingsById(tenantId);\r\n\r\n        // Find bookings that:\r\n        // 1. Are past start time + grace period\r\n        // 2. Are still pending or confirmed (not completed/cancelled/no-show)\r\n        const gracePeriodEnd = new Date(now.getTime() - gracePeriodMinutes * 60 * 1000);\r\n        \r\n        const potentialNoShows = await Booking.find({\r\n          tenantId,\r\n          startTime: { $lte: gracePeriodEnd },\r\n          status: { $in: ['pending', 'confirmed'] },\r\n        }).lean();\r\n\r\n        for (const booking of potentialNoShows) {\r\n          try {\r\n            // Mark as no-show\r\n            await Booking.findByIdAndUpdate(booking._id, {\r\n              status: 'no-show',\r\n            });\r\n\r\n            totalNoShows++;\r\n\r\n            // Send follow-up email/SMS\r\n            if (tenantSettings?.emailNotifications || tenantSettings?.smsNotifications) {\r\n              const companyName = tenantSettings?.companyName || tenant.name || 'Business';\r\n              const formattedDate = formatDate(booking.startTime, tenantSettings);\r\n              const formattedTime = formatTime(booking.startTime, tenantSettings);\r\n\r\n              const emailMessage = `We noticed you missed your appointment with ${companyName}.\r\n\r\nService: ${booking.serviceName}\r\nScheduled Date: ${formattedDate}\r\nScheduled Time: ${formattedTime}\r\n${booking.staffName ? `Staff: ${booking.staffName}` : ''}\r\n\r\nWe understand that sometimes things come up. If you'd like to reschedule, please contact us and we'll be happy to help.\r\n\r\nThank you,\r\n${companyName}`;\r\n\r\n              const smsMessage = `We noticed you missed your appointment for ${booking.serviceName} on ${formattedDate} at ${formattedTime}. If you'd like to reschedule, please contact us. - ${companyName}`;\r\n\r\n              // Send email\r\n              if (booking.customerEmail && tenantSettings?.emailNotifications) {\r\n                await sendEmail({\r\n                  to: booking.customerEmail,\r\n                  subject: `Missed Appointment - ${companyName}`,\r\n                  message: emailMessage,\r\n                  type: 'email',\r\n                }).catch(() => {\r\n                  // Don't fail if email fails\r\n                });\r\n              }\r\n\r\n              // Send SMS\r\n              if (booking.customerPhone && tenantSettings?.smsNotifications) {\r\n                await sendSMS({\r\n                  to: booking.customerPhone,\r\n                  message: smsMessage,\r\n                  type: 'sms',\r\n                }).catch(() => {\r\n                  // Don't fail if SMS fails\r\n                });\r\n              }\r\n            }\r\n          } catch (error: any) {\r\n            totalFailed++;\r\n            results.errors?.push(`Booking ${booking._id}: ${error.message}`);\r\n          }\r\n        }\r\n      } catch (error: any) {\r\n        totalFailed++;\r\n        results.errors?.push(`Tenant ${tenant.name}: ${error.message}`);\r\n      }\r\n    }\r\n\r\n    results.processed = totalNoShows;\r\n    results.failed = totalFailed;\r\n    results.message = `Detected ${totalNoShows} no-shows${totalFailed > 0 ? `, ${totalFailed} failed` : ''}`;\r\n\r\n    return results;\r\n  } catch (error: any) {\r\n    results.success = false;\r\n    results.message = `Error detecting no-shows: ${error.message}`;\r\n    results.errors?.push(error.message);\r\n    return results;\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\lib\\automations\\booking-reminders.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":99,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":99,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3248,3251],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3248,3251],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":104,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":104,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3409,3412],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3409,3412],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":115,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":115,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3773,3776],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3773,3776],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Automated Booking Reminders\r\n * Sends reminders for upcoming bookings\r\n */\r\n\r\nimport connectDB from '@/lib/mongodb';\r\nimport Booking from '@/models/Booking';\r\nimport Tenant from '@/models/Tenant';\r\nimport { sendBookingReminder } from '@/lib/notifications';\r\nimport { getTenantSettingsById } from '@/lib/tenant';\r\nimport { AutomationResult } from './types';\r\n\r\nexport interface BookingReminderOptions {\r\n  tenantId?: string;\r\n  hoursBefore?: number;\r\n}\r\n\r\n/**\r\n * Send booking reminders for all tenants or a specific tenant\r\n */\r\nexport async function sendBookingReminders(\r\n  options: BookingReminderOptions = {}\r\n): Promise<AutomationResult> {\r\n  await connectDB();\r\n\r\n  const { tenantId, hoursBefore = 24 } = options;\r\n  const results: AutomationResult = {\r\n    success: true,\r\n    message: '',\r\n    processed: 0,\r\n    failed: 0,\r\n    errors: [],\r\n  };\r\n\r\n  try {\r\n    // Get tenants to process\r\n    let tenants;\r\n    if (tenantId) {\r\n      const tenant = await Tenant.findById(tenantId).lean();\r\n      tenants = tenant ? [tenant] : [];\r\n    } else {\r\n      // Get all active tenants\r\n      tenants = await Tenant.find({ status: 'active' }).lean();\r\n    }\r\n\r\n    if (tenants.length === 0) {\r\n      results.message = 'No tenants found to process';\r\n      return results;\r\n    }\r\n\r\n    let totalProcessed = 0;\r\n    let totalFailed = 0;\r\n\r\n    for (const tenant of tenants) {\r\n      try {\r\n        // Check if booking reminders are enabled for this tenant\r\n        const tenantSettings = await getTenantSettingsById(tenant._id.toString());\r\n        if (!tenantSettings?.emailNotifications && !tenantSettings?.smsNotifications) {\r\n          continue; // Skip if notifications disabled\r\n        }\r\n\r\n        // Calculate the time window for bookings that need reminders\r\n        const now = new Date();\r\n        const reminderWindowStart = new Date(now.getTime() + hoursBefore * 60 * 60 * 1000);\r\n        const reminderWindowEnd = new Date(reminderWindowStart.getTime() + 60 * 60 * 1000); // 1 hour window\r\n\r\n        // Find bookings that need reminders\r\n        const bookingsToRemind = await Booking.find({\r\n          tenantId: tenant._id,\r\n          startTime: {\r\n            $gte: reminderWindowStart,\r\n            $lte: reminderWindowEnd,\r\n          },\r\n          status: { $in: ['pending', 'confirmed'] },\r\n          reminderSent: { $ne: true },\r\n        }).lean();\r\n\r\n        // Send reminders for each booking\r\n        for (const booking of bookingsToRemind) {\r\n          try {\r\n            await sendBookingReminder(\r\n              {\r\n                customerName: booking.customerName,\r\n                customerEmail: booking.customerEmail,\r\n                customerPhone: booking.customerPhone,\r\n                serviceName: booking.serviceName,\r\n                startTime: booking.startTime,\r\n                endTime: booking.endTime,\r\n                staffName: booking.staffName,\r\n                notes: booking.notes,\r\n                bookingId: booking._id.toString(),\r\n              },\r\n              tenantSettings || undefined\r\n            );\r\n\r\n            // Mark reminder as sent\r\n            await Booking.findByIdAndUpdate(booking._id, { reminderSent: true });\r\n            totalProcessed++;\r\n          } catch (error: any) {\r\n            totalFailed++;\r\n            results.errors?.push(`Booking ${booking._id}: ${error.message}`);\r\n          }\r\n        }\r\n      } catch (error: any) {\r\n        totalFailed++;\r\n        results.errors?.push(`Tenant ${tenant.name}: ${error.message}`);\r\n      }\r\n    }\r\n\r\n    results.processed = totalProcessed;\r\n    results.failed = totalFailed;\r\n    results.message = `Processed ${totalProcessed} booking reminders${totalFailed > 0 ? `, ${totalFailed} failed` : ''}`;\r\n\r\n    return results;\r\n  } catch (error: any) {\r\n    results.success = false;\r\n    results.message = `Error sending booking reminders: ${error.message}`;\r\n    results.errors?.push(error.message);\r\n    return results;\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\lib\\automations\\break-detection.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":99,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":99,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3209,3212],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3209,3212],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":104,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":104,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3370,3373],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3370,3373],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":115,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":115,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3739,3742],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3739,3742],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Automatic Break Time Detection\r\n * Auto-detect and log breaks based on inactivity\r\n */\r\n\r\nimport connectDB from '@/lib/mongodb';\r\nimport Attendance from '@/models/Attendance';\r\nimport Transaction from '@/models/Transaction';\r\nimport Tenant from '@/models/Tenant';\r\nimport { AutomationResult } from './types';\r\n\r\nexport interface BreakDetectionOptions {\r\n  tenantId?: string;\r\n  inactivityMinutes?: number; // Minutes of inactivity to detect as break (default: 30)\r\n}\r\n\r\n/**\r\n * Automatically detect and log breaks based on transaction inactivity\r\n */\r\nexport async function detectBreaks(\r\n  options: BreakDetectionOptions = {}\r\n): Promise<AutomationResult> {\r\n  await connectDB();\r\n\r\n  const results: AutomationResult = {\r\n    success: true,\r\n    message: '',\r\n    processed: 0,\r\n    failed: 0,\r\n    errors: [],\r\n  };\r\n\r\n  try {\r\n    const inactivityMinutes = options.inactivityMinutes || 30;\r\n    const now = new Date();\r\n\r\n    // Get tenants to process\r\n    let tenants;\r\n    if (options.tenantId) {\r\n      const tenant = await Tenant.findById(options.tenantId).lean();\r\n      tenants = tenant ? [tenant] : [];\r\n    } else {\r\n      tenants = await Tenant.find({ status: 'active' }).lean();\r\n    }\r\n\r\n    if (tenants.length === 0) {\r\n      results.message = 'No tenants found to process';\r\n      return results;\r\n    }\r\n\r\n    let totalBreaksDetected = 0;\r\n    let totalFailed = 0;\r\n\r\n    for (const tenant of tenants) {\r\n      try {\r\n        const tenantId = tenant._id.toString();\r\n\r\n        // Find active attendance sessions\r\n        const activeSessions = await Attendance.find({\r\n          tenantId,\r\n          clockOut: null,\r\n        }).lean();\r\n\r\n        for (const session of activeSessions) {\r\n          try {\r\n            const clockInTime = new Date(session.clockIn);\r\n            \r\n            // Get last transaction for this user during this session\r\n            const lastTransaction = await Transaction.findOne({\r\n              tenantId,\r\n              userId: session.userId,\r\n              createdAt: { $gte: clockInTime },\r\n            })\r\n              .sort({ createdAt: -1 })\r\n              .lean();\r\n\r\n            if (!lastTransaction) {\r\n              // No transactions yet, can't detect break\r\n              continue;\r\n            }\r\n\r\n            const lastActivityTime = new Date(lastTransaction.createdAt);\r\n            const minutesSinceActivity = (now.getTime() - lastActivityTime.getTime()) / (1000 * 60);\r\n\r\n            // If no activity for X minutes and no break started, start break\r\n            if (minutesSinceActivity >= inactivityMinutes && !session.breakStart) {\r\n              await Attendance.findByIdAndUpdate(session._id, {\r\n                breakStart: lastActivityTime, // Use last activity time as break start\r\n              });\r\n              totalBreaksDetected++;\r\n            }\r\n            // If break started and activity resumed, end break\r\n            else if (session.breakStart && minutesSinceActivity < inactivityMinutes && !session.breakEnd) {\r\n              await Attendance.findByIdAndUpdate(session._id, {\r\n                breakEnd: now,\r\n              });\r\n              totalBreaksDetected++;\r\n            }\r\n          } catch (error: any) {\r\n            totalFailed++;\r\n            results.errors?.push(`Session ${session._id}: ${error.message}`);\r\n          }\r\n        }\r\n      } catch (error: any) {\r\n        totalFailed++;\r\n        results.errors?.push(`Tenant ${tenant.name}: ${error.message}`);\r\n      }\r\n    }\r\n\r\n    results.processed = totalBreaksDetected;\r\n    results.failed = totalFailed;\r\n    results.message = `Detected ${totalBreaksDetected} break periods${totalFailed > 0 ? `, ${totalFailed} failed` : ''}`;\r\n\r\n    return results;\r\n  } catch (error: any) {\r\n    results.success = false;\r\n    results.message = `Error detecting breaks: ${error.message}`;\r\n    results.errors?.push(error.message);\r\n    return results;\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\lib\\automations\\cash-count-reminders.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'User' is defined but never used. Allowed unused vars must match /^_/u.","line":10,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":12},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":79,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":79,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2488,2491],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2488,2491],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":131,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":131,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4714,4717],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4714,4717],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":136,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":136,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4875,4878],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4875,4878],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":147,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":147,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5237,5240],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5237,5240],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Automated Cash Count Reminders\r\n * Remind staff to count and close drawers at shift end\r\n */\r\n\r\nimport connectDB from '@/lib/mongodb';\r\nimport Attendance from '@/models/Attendance';\r\nimport CashDrawerSession from '@/models/CashDrawerSession';\r\nimport Tenant from '@/models/Tenant';\r\nimport User from '@/models/User';\r\nimport { sendEmail, sendSMS } from '@/lib/notifications';\r\nimport { getTenantSettingsById } from '@/lib/tenant';\r\nimport { AutomationResult } from './types';\r\n\r\nexport interface CashCountReminderOptions {\r\n  tenantId?: string;\r\n  reminderMinutesBefore?: number; // Minutes before shift end to send reminder (default: 30)\r\n}\r\n\r\n/**\r\n * Send reminders to staff to count and close cash drawers before shift end\r\n */\r\nexport async function sendCashCountReminders(\r\n  options: CashCountReminderOptions = {}\r\n): Promise<AutomationResult> {\r\n  await connectDB();\r\n\r\n  const results: AutomationResult = {\r\n    success: true,\r\n    message: '',\r\n    processed: 0,\r\n    failed: 0,\r\n    errors: [],\r\n  };\r\n\r\n  try {\r\n    const reminderMinutesBefore = options.reminderMinutesBefore || 30;\r\n    const now = new Date();\r\n    const reminderWindowStart = new Date(now.getTime() + reminderMinutesBefore * 60 * 1000);\r\n    const reminderWindowEnd = new Date(reminderWindowStart.getTime() + 60 * 60 * 1000); // 1 hour window\r\n\r\n    // Get tenants to process\r\n    let tenants;\r\n    if (options.tenantId) {\r\n      const tenant = await Tenant.findById(options.tenantId).lean();\r\n      tenants = tenant ? [tenant] : [];\r\n    } else {\r\n      tenants = await Tenant.find({ status: 'active' }).lean();\r\n    }\r\n\r\n    if (tenants.length === 0) {\r\n      results.message = 'No tenants found to process';\r\n      return results;\r\n    }\r\n\r\n    let totalReminders = 0;\r\n    let totalFailed = 0;\r\n\r\n    for (const tenant of tenants) {\r\n      try {\r\n        const tenantId = tenant._id.toString();\r\n        const tenantSettings = await getTenantSettingsById(tenantId);\r\n\r\n        // Skip if notifications disabled\r\n        if (!tenantSettings?.emailNotifications && !tenantSettings?.smsNotifications) {\r\n          continue;\r\n        }\r\n\r\n        // Find active attendance sessions (clocked in but not out)\r\n        const activeSessions = await Attendance.find({\r\n          tenantId,\r\n          clockOut: null,\r\n        })\r\n          .populate('userId', 'name email')\r\n          .lean();\r\n\r\n        for (const session of activeSessions) {\r\n          try {\r\n            const user = session.userId as any;\r\n            if (!user) continue;\r\n\r\n            // Estimate shift end time (8 hours from clock-in, or use tenant settings)\r\n            const clockInTime = new Date(session.clockIn);\r\n            const estimatedShiftEnd = new Date(clockInTime.getTime() + 8 * 60 * 60 * 1000); // 8-hour shift default\r\n\r\n            // Check if shift end is within reminder window\r\n            if (estimatedShiftEnd >= reminderWindowStart && estimatedShiftEnd <= reminderWindowEnd) {\r\n              // Check if user has an open cash drawer\r\n              const openDrawer = await CashDrawerSession.findOne({\r\n                tenantId,\r\n                userId: user._id,\r\n                status: 'open',\r\n              }).lean();\r\n\r\n              if (openDrawer) {\r\n                const companyName = tenantSettings?.companyName || tenant.name || 'Business';\r\n                const reminderMessage = `Reminder: Your shift is ending soon. Please count and close your cash drawer before leaving.\r\n\r\nShift End: ${estimatedShiftEnd.toLocaleTimeString()}\r\nCash Drawer Session: ${openDrawer._id.toString().slice(-8)}\r\n\r\nThank you,\r\n${companyName}`;\r\n\r\n                // Send email reminder\r\n                if (user.email && tenantSettings?.emailNotifications) {\r\n                  await sendEmail({\r\n                    to: user.email,\r\n                    subject: `Cash Drawer Count Reminder - ${companyName}`,\r\n                    message: reminderMessage,\r\n                    type: 'email',\r\n                  }).catch(() => {\r\n                    // Don't fail if email fails\r\n                  });\r\n                }\r\n\r\n                // Send SMS reminder\r\n                if (tenantSettings?.phone && tenantSettings?.smsNotifications) {\r\n                  await sendSMS({\r\n                    to: tenantSettings.phone,\r\n                    message: `Reminder: Please count and close cash drawer before shift end at ${estimatedShiftEnd.toLocaleTimeString()}. - ${companyName}`,\r\n                    type: 'sms',\r\n                  }).catch(() => {\r\n                    // Don't fail if SMS fails\r\n                  });\r\n                }\r\n\r\n                totalReminders++;\r\n              }\r\n            }\r\n          } catch (error: any) {\r\n            totalFailed++;\r\n            results.errors?.push(`Session ${session._id}: ${error.message}`);\r\n          }\r\n        }\r\n      } catch (error: any) {\r\n        totalFailed++;\r\n        results.errors?.push(`Tenant ${tenant.name}: ${error.message}`);\r\n      }\r\n    }\r\n\r\n    results.processed = totalReminders;\r\n    results.failed = totalFailed;\r\n    results.message = `Sent ${totalReminders} cash count reminders${totalFailed > 0 ? `, ${totalFailed} failed` : ''}`;\r\n\r\n    return results;\r\n  } catch (error: any) {\r\n    results.success = false;\r\n    results.message = `Error sending cash count reminders: ${error.message}`;\r\n    results.errors?.push(error.message);\r\n    return results;\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\lib\\automations\\cash-drawer-closure.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":142,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":142,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5330,5333],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5330,5333],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":249,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":249,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9257,9260],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9257,9260],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":254,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":254,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9418,9421],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9418,9421],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":265,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":265,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9779,9782],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9779,9782],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Automatic End-of-Day Cash Drawer Closure\r\n * Automatically close cash drawers at end of business day\r\n */\r\n\r\nimport connectDB from '@/lib/mongodb';\r\nimport CashDrawerSession from '@/models/CashDrawerSession';\r\nimport Tenant from '@/models/Tenant';\r\nimport Transaction from '@/models/Transaction';\r\nimport Expense from '@/models/Expense';\r\nimport { sendEmail } from '@/lib/notifications';\r\nimport { getTenantSettingsById } from '@/lib/tenant';\r\nimport { AutomationResult } from './types';\r\n\r\nexport interface CashDrawerClosureOptions {\r\n  tenantId?: string;\r\n  forceClose?: boolean; // Force close even if not end of day\r\n}\r\n\r\n/**\r\n * Automatically close cash drawers at end of business day\r\n */\r\nexport async function autoCloseCashDrawers(\r\n  options: CashDrawerClosureOptions = {}\r\n): Promise<AutomationResult> {\r\n  await connectDB();\r\n\r\n  const results: AutomationResult = {\r\n    success: true,\r\n    message: '',\r\n    processed: 0,\r\n    failed: 0,\r\n    errors: [],\r\n  };\r\n\r\n  try {\r\n    // Get tenants to process\r\n    let tenants;\r\n    if (options.tenantId) {\r\n      const tenant = await Tenant.findById(options.tenantId).lean();\r\n      tenants = tenant ? [tenant] : [];\r\n    } else {\r\n      // Get all active tenants\r\n      tenants = await Tenant.find({ status: 'active' }).lean();\r\n    }\r\n\r\n    if (tenants.length === 0) {\r\n      results.message = 'No tenants found to process';\r\n      return results;\r\n    }\r\n\r\n    const now = new Date();\r\n    const currentHour = now.getHours();\r\n    let totalProcessed = 0;\r\n    let totalFailed = 0;\r\n\r\n    for (const tenant of tenants) {\r\n      try {\r\n        const tenantId = tenant._id.toString();\r\n        const tenantSettings = await getTenantSettingsById(tenantId);\r\n\r\n        // Get business hours (if configured)\r\n        // For now, we'll use a default end time (e.g., 10 PM) or check if it's past business hours\r\n        // You can extend this to use tenant business hours configuration\r\n        const defaultEndHour = 22; // 10 PM\r\n        const isEndOfDay = currentHour >= defaultEndHour || options.forceClose;\r\n\r\n        if (!isEndOfDay && !options.forceClose) {\r\n          continue; // Not end of day yet\r\n        }\r\n\r\n        // Find all open cash drawer sessions\r\n        const openSessions = await CashDrawerSession.find({\r\n          tenantId,\r\n          status: 'open',\r\n        })\r\n          .populate('userId', 'name email')\r\n          .lean();\r\n\r\n        for (const session of openSessions) {\r\n          try {\r\n            // Calculate expected amount\r\n            const sessionStart = new Date(session.openingTime);\r\n            const sessionEnd = now;\r\n\r\n            // Get cash transactions for this session\r\n            const cashTransactions = await Transaction.find({\r\n              tenantId,\r\n              paymentMethod: 'cash',\r\n              createdAt: { $gte: sessionStart, $lte: sessionEnd },\r\n              status: 'completed',\r\n            }).lean();\r\n\r\n            const cashSales = cashTransactions.reduce((sum, t) => sum + t.total, 0);\r\n\r\n            // Get cash expenses for this session\r\n            const cashExpenses = await Expense.find({\r\n              tenantId,\r\n              paymentMethod: 'cash',\r\n              date: { $gte: sessionStart, $lte: sessionEnd },\r\n            }).lean();\r\n\r\n            const cashExpensesTotal = cashExpenses.reduce((sum, e) => sum + e.amount, 0);\r\n\r\n            // Calculate expected amount\r\n            const expectedAmount = session.openingAmount + cashSales - cashExpensesTotal;\r\n\r\n            // For auto-closure, we'll set closing amount to expected (no physical count)\r\n            // In production, you might want to flag these for review\r\n            const closingAmount = expectedAmount;\r\n\r\n            // Calculate shortage/overage (will be 0 for auto-closure, but calculated for reporting)\r\n            const actualDifference = closingAmount - expectedAmount;\r\n            const shortage = actualDifference < 0 ? Math.abs(actualDifference) : 0;\r\n            const overage = actualDifference > 0 ? actualDifference : 0;\r\n\r\n            // Update session\r\n            await CashDrawerSession.findByIdAndUpdate(session._id, {\r\n              status: 'closed',\r\n              closingTime: sessionEnd,\r\n              closingAmount,\r\n              expectedAmount,\r\n              shortage: shortage > 0 ? shortage : undefined,\r\n              overage: overage > 0 ? overage : undefined,\r\n              notes: (session.notes || '') + (session.notes ? '\\n' : '') + '[AUTO] Automatically closed at end of business day.',\r\n            });\r\n\r\n            totalProcessed++;\r\n\r\n            // Check for discrepancies (#13 - Cash Drawer Discrepancy Alerts)\r\n            const discrepancyThreshold = {\r\n              shortage: 10, // $10\r\n              overage: 20, // $20\r\n            };\r\n            \r\n            const hasDiscrepancy = shortage > discrepancyThreshold.shortage || overage > discrepancyThreshold.overage;\r\n            const isLargeDiscrepancy = shortage > 50 || overage > 100; // Large discrepancies need immediate attention\r\n\r\n            // Send summary report to managers\r\n            if (tenantSettings?.emailNotifications && tenantSettings?.email) {\r\n              const companyName = tenantSettings?.companyName || tenant.name || 'Business';\r\n              const user = session.userId as any;\r\n              \r\n              const reportHtml = `\r\n<!DOCTYPE html>\r\n<html>\r\n<head>\r\n  <meta charset=\"UTF-8\">\r\n  <style>\r\n    body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }\r\n    .report { max-width: 600px; margin: 0 auto; padding: 20px; }\r\n    .header { text-align: center; border-bottom: 2px solid #000; padding-bottom: 10px; margin-bottom: 20px; }\r\n    .summary { background-color: #f4f4f4; padding: 15px; border-radius: 5px; margin-bottom: 20px; }\r\n    .summary-item { display: flex; justify-content: space-between; margin-bottom: 10px; }\r\n    .alert { background-color: #fff3cd; border: 1px solid #ffc107; padding: 10px; border-radius: 5px; margin-top: 10px; }\r\n  </style>\r\n</head>\r\n<body>\r\n  <div class=\"report\">\r\n    <div class=\"header\">\r\n      <h2>End of Day Cash Drawer Report</h2>\r\n      <p>${companyName}</p>\r\n      <p>${sessionEnd.toLocaleDateString()} ${sessionEnd.toLocaleTimeString()}</p>\r\n    </div>\r\n\r\n    <div class=\"summary\">\r\n      <h3>Session Summary</h3>\r\n      <div class=\"summary-item\">\r\n        <span><strong>Cashier:</strong></span>\r\n        <span>${user?.name || 'Unknown'}</span>\r\n      </div>\r\n      <div class=\"summary-item\">\r\n        <span><strong>Opening Amount:</strong></span>\r\n        <span>$${session.openingAmount.toFixed(2)}</span>\r\n      </div>\r\n      <div class=\"summary-item\">\r\n        <span><strong>Cash Sales:</strong></span>\r\n        <span>$${cashSales.toFixed(2)}</span>\r\n      </div>\r\n      <div class=\"summary-item\">\r\n        <span><strong>Cash Expenses:</strong></span>\r\n        <span>$${cashExpensesTotal.toFixed(2)}</span>\r\n      </div>\r\n      <div class=\"summary-item\">\r\n        <span><strong>Expected Amount:</strong></span>\r\n        <span>$${expectedAmount.toFixed(2)}</span>\r\n      </div>\r\n      <div class=\"summary-item\">\r\n        <span><strong>Closing Amount:</strong></span>\r\n        <span>$${closingAmount.toFixed(2)}</span>\r\n      </div>\r\n      ${shortage > 0 ? `\r\n      <div class=\"alert\">\r\n        <strong> Shortage:</strong> $${shortage.toFixed(2)}\r\n      </div>\r\n      ` : ''}\r\n      ${overage > 0 ? `\r\n      <div class=\"alert\">\r\n        <strong> Overage:</strong> $${overage.toFixed(2)}\r\n      </div>\r\n      ` : ''}\r\n    </div>\r\n\r\n    <p><em>This drawer was automatically closed at end of business day. Please verify the closing amount.</em></p>\r\n  </div>\r\n</body>\r\n</html>\r\n              `.trim();\r\n\r\n              const subject = hasDiscrepancy\r\n                ? ` Cash Drawer Discrepancy Alert - ${companyName}`\r\n                : `End of Day Cash Drawer Report - ${companyName}`;\r\n\r\n              await sendEmail({\r\n                to: tenantSettings.email,\r\n                subject,\r\n                message: reportHtml,\r\n                type: 'email',\r\n              }).catch(() => {\r\n                // Don't fail if email fails\r\n              });\r\n\r\n              // Send immediate alert for large discrepancies\r\n              if (isLargeDiscrepancy && tenantSettings?.email) {\r\n                await sendEmail({\r\n                  to: tenantSettings.email,\r\n                  subject: ` URGENT: Large Cash Drawer Discrepancy - ${companyName}`,\r\n                  message: `URGENT: Large Cash Drawer Discrepancy Detected\r\n\r\nCashier: ${user?.name || 'Unknown'}\r\nSession ID: ${session._id.toString().slice(-8)}\r\nTime: ${sessionEnd.toLocaleString()}\r\n\r\n${shortage > 50 ? `SHORTAGE: $${shortage.toFixed(2)}` : ''}\r\n${overage > 100 ? `OVERAGE: $${overage.toFixed(2)}` : ''}\r\n\r\nExpected Amount: $${expectedAmount.toFixed(2)}\r\nClosing Amount: $${closingAmount.toFixed(2)}\r\n\r\nThis requires immediate review. Please investigate this discrepancy as soon as possible.\r\n\r\nThis is an automated security alert from your POS system.`,\r\n                  type: 'email',\r\n                }).catch(() => {\r\n                  // Don't fail if email fails\r\n                });\r\n              }\r\n            }\r\n          } catch (error: any) {\r\n            totalFailed++;\r\n            results.errors?.push(`Session ${session._id}: ${error.message}`);\r\n          }\r\n        }\r\n      } catch (error: any) {\r\n        totalFailed++;\r\n        results.errors?.push(`Tenant ${tenant.name}: ${error.message}`);\r\n      }\r\n    }\r\n\r\n    results.processed = totalProcessed;\r\n    results.failed = totalFailed;\r\n    results.message = `Auto-closed ${totalProcessed} cash drawers${totalFailed > 0 ? `, ${totalFailed} failed` : ''}`;\r\n\r\n    return results;\r\n  } catch (error: any) {\r\n    results.success = false;\r\n    results.message = `Error auto-closing cash drawers: ${error.message}`;\r\n    results.errors?.push(error.message);\r\n    return results;\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\lib\\automations\\customer-lifetime-value.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'avgOrderValue' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":96,"column":19,"nodeType":null,"messageId":"unusedVar","endLine":96,"endColumn":32},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'purchaseFrequency' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":104,"column":19,"nodeType":null,"messageId":"unusedVar","endLine":104,"endColumn":36},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'clv' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":107,"column":19,"nodeType":null,"messageId":"unusedVar","endLine":107,"endColumn":22},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":120,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":120,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4115,4118],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4115,4118],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":125,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":125,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4278,4281],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4278,4281],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":136,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":136,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4643,4646],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4643,4646],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Customer Lifetime Value Calculation\r\n * Automatically calculate and update customer lifetime value\r\n */\r\n\r\nimport connectDB from '@/lib/mongodb';\r\nimport Customer from '@/models/Customer';\r\nimport Transaction from '@/models/Transaction';\r\nimport Tenant from '@/models/Tenant';\r\nimport { AutomationResult } from './types';\r\nimport mongoose from 'mongoose';\r\n\r\nexport interface CustomerLifetimeValueOptions {\r\n  tenantId?: string;\r\n  updateCustomers?: boolean; // Update customer records with CLV (default: true)\r\n}\r\n\r\n/**\r\n * Calculate and update customer lifetime value\r\n */\r\nexport async function calculateCustomerLifetimeValue(\r\n  options: CustomerLifetimeValueOptions = {}\r\n): Promise<AutomationResult> {\r\n  await connectDB();\r\n\r\n  const results: AutomationResult = {\r\n    success: true,\r\n    message: '',\r\n    processed: 0,\r\n    failed: 0,\r\n    errors: [],\r\n  };\r\n\r\n  try {\r\n    const updateCustomers = options.updateCustomers !== false;\r\n\r\n    // Get tenants to process\r\n    let tenants;\r\n    if (options.tenantId) {\r\n      const tenant = await Tenant.findById(options.tenantId).lean();\r\n      tenants = tenant ? [tenant] : [];\r\n    } else {\r\n      tenants = await Tenant.find({ status: 'active' }).lean();\r\n    }\r\n\r\n    if (tenants.length === 0) {\r\n      results.message = 'No tenants found to process';\r\n      return results;\r\n    }\r\n\r\n    let totalUpdated = 0;\r\n    let totalFailed = 0;\r\n\r\n    for (const tenant of tenants) {\r\n      try {\r\n        const tenantId = tenant._id.toString();\r\n\r\n        // Get all customers\r\n        const customers = await Customer.find({ tenantId }).lean();\r\n\r\n        for (const customer of customers) {\r\n          try {\r\n            // Calculate total spent from transactions\r\n            // Match by customer email or customer ID (if transactions have customerId field)\r\n            const transactions = await Transaction.aggregate([\r\n              {\r\n                $match: {\r\n                  tenantId: new mongoose.Types.ObjectId(tenantId),\r\n                  status: 'completed',\r\n                  // Match by email in notes or customerId if field exists\r\n                  $or: [\r\n                    customer.email ? { notes: { $regex: customer.email, $options: 'i' } } : {},\r\n                    // Add customerId match if field exists in Transaction model\r\n                  ],\r\n                },\r\n              },\r\n              {\r\n                $group: {\r\n                  _id: null,\r\n                  totalSpent: { $sum: '$total' },\r\n                  transactionCount: { $sum: 1 },\r\n                  firstPurchase: { $min: '$createdAt' },\r\n                  lastPurchase: { $max: '$createdAt' },\r\n                },\r\n              },\r\n            ]);\r\n\r\n            const clvData = transactions[0] || {\r\n              totalSpent: 0,\r\n              transactionCount: 0,\r\n              firstPurchase: null,\r\n              lastPurchase: null,\r\n            };\r\n\r\n            // Calculate average order value\r\n            const avgOrderValue = clvData.transactionCount > 0\r\n              ? clvData.totalSpent / clvData.transactionCount\r\n              : 0;\r\n\r\n            // Calculate purchase frequency (transactions per month)\r\n            const monthsActive = clvData.firstPurchase\r\n              ? Math.max(1, (Date.now() - new Date(clvData.firstPurchase).getTime()) / (1000 * 60 * 60 * 24 * 30))\r\n              : 1;\r\n            const purchaseFrequency = clvData.transactionCount / monthsActive;\r\n\r\n            // Simple CLV calculation: totalSpent (can be enhanced with predictive models)\r\n            const clv = clvData.totalSpent;\r\n\r\n            if (updateCustomers) {\r\n              // Update customer record\r\n              await Customer.findByIdAndUpdate(customer._id, {\r\n                totalSpent: clvData.totalSpent,\r\n                lastPurchaseDate: clvData.lastPurchase ? new Date(clvData.lastPurchase) : undefined,\r\n                // Store CLV in notes or custom field (if model supports it)\r\n                notes: customer.notes || '',\r\n              });\r\n            }\r\n\r\n            totalUpdated++;\r\n          } catch (error: any) {\r\n            totalFailed++;\r\n            results.errors?.push(`Customer ${customer._id}: ${error.message}`);\r\n          }\r\n        }\r\n      } catch (error: any) {\r\n        totalFailed++;\r\n        results.errors?.push(`Tenant ${tenant.name}: ${error.message}`);\r\n      }\r\n    }\r\n\r\n    results.processed = totalUpdated;\r\n    results.failed = totalFailed;\r\n    results.message = `Updated ${totalUpdated} customer lifetime values${totalFailed > 0 ? `, ${totalFailed} failed` : ''}`;\r\n\r\n    return results;\r\n  } catch (error: any) {\r\n    results.success = false;\r\n    results.message = `Error calculating customer lifetime value: ${error.message}`;\r\n    results.errors?.push(error.message);\r\n    return results;\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\lib\\automations\\customer-welcome.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":131,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":131,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4237,4240],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4237,4240],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * New Customer Welcome Emails\r\n * Sends welcome emails when new customers are added\r\n */\r\n\r\nimport connectDB from '@/lib/mongodb';\r\nimport Customer from '@/models/Customer';\r\nimport Tenant from '@/models/Tenant';\r\nimport { sendEmail } from '@/lib/notifications';\r\nimport { getTenantSettingsById } from '@/lib/tenant';\r\nimport { AutomationResult } from './types';\r\n\r\nexport interface CustomerWelcomeOptions {\r\n  customerId: string;\r\n  tenantId: string;\r\n}\r\n\r\n/**\r\n * Send welcome email to new customer\r\n */\r\nexport async function sendCustomerWelcomeEmail(\r\n  options: CustomerWelcomeOptions\r\n): Promise<AutomationResult> {\r\n  await connectDB();\r\n\r\n  const results: AutomationResult = {\r\n    success: true,\r\n    message: '',\r\n    processed: 0,\r\n    failed: 0,\r\n    errors: [],\r\n  };\r\n\r\n  try {\r\n    const customer = await Customer.findById(options.customerId).lean();\r\n    if (!customer) {\r\n      results.success = false;\r\n      results.message = 'Customer not found';\r\n      return results;\r\n    }\r\n\r\n    if (!customer.email) {\r\n      results.message = 'Customer has no email address';\r\n      return results;\r\n    }\r\n\r\n    const tenant = await Tenant.findById(options.tenantId).lean();\r\n    if (!tenant) {\r\n      results.success = false;\r\n      results.message = 'Tenant not found';\r\n      return results;\r\n    }\r\n\r\n    const tenantSettings = await getTenantSettingsById(options.tenantId);\r\n\r\n    // Check if email notifications are enabled\r\n    if (!tenantSettings?.emailNotifications) {\r\n      results.message = 'Email notifications disabled for this tenant';\r\n      return results;\r\n    }\r\n\r\n    const companyName = tenantSettings?.companyName || tenant.name || 'Business';\r\n    const customerName = `${customer.firstName} ${customer.lastName}`;\r\n\r\n    // Build welcome email\r\n    const welcomeHtml = `\r\n<!DOCTYPE html>\r\n<html>\r\n<head>\r\n  <meta charset=\"UTF-8\">\r\n  <style>\r\n    body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }\r\n    .container { max-width: 600px; margin: 0 auto; padding: 20px; }\r\n    .header { text-align: center; border-bottom: 2px solid #000; padding-bottom: 10px; margin-bottom: 20px; }\r\n    .content { margin-bottom: 20px; }\r\n    .footer { text-align: center; margin-top: 20px; font-size: 12px; color: #666; }\r\n    .button { display: inline-block; padding: 12px 24px; background-color: #2563eb; color: white; text-decoration: none; border-radius: 5px; margin-top: 20px; }\r\n  </style>\r\n</head>\r\n<body>\r\n  <div class=\"container\">\r\n    <div class=\"header\">\r\n      <h2>Welcome to ${companyName}!</h2>\r\n    </div>\r\n\r\n    <div class=\"content\">\r\n      <p>Hello ${customerName},</p>\r\n      \r\n      <p>Thank you for joining us! We're excited to have you as a valued customer.</p>\r\n      \r\n      ${tenantSettings?.enableLoyaltyProgram ? `\r\n      <p><strong>Loyalty Program:</strong> As a member, you'll earn points with every purchase and enjoy exclusive benefits and rewards.</p>\r\n      ` : ''}\r\n      \r\n      <p>We're here to serve you and provide the best experience possible. If you have any questions or need assistance, please don't hesitate to reach out to us.</p>\r\n      \r\n      ${tenantSettings?.phone ? `<p><strong>Contact Us:</strong> ${tenantSettings.phone}</p>` : ''}\r\n      ${tenantSettings?.email ? `<p><strong>Email:</strong> ${tenantSettings.email}</p>` : ''}\r\n      ${tenantSettings?.address ? `\r\n      <p><strong>Address:</strong><br>\r\n      ${[tenantSettings.address.street, tenantSettings.address.city, tenantSettings.address.state, tenantSettings.address.zipCode].filter(Boolean).join('<br>')}\r\n      </p>\r\n      ` : ''}\r\n      \r\n      <p>We look forward to serving you!</p>\r\n      \r\n      <p>Best regards,<br>\r\n      The ${companyName} Team</p>\r\n    </div>\r\n\r\n    <div class=\"footer\">\r\n      <p>This is an automated welcome email from ${companyName}.</p>\r\n      <p>If you did not create an account, please ignore this email.</p>\r\n    </div>\r\n  </div>\r\n</body>\r\n</html>\r\n    `.trim();\r\n\r\n    await sendEmail({\r\n      to: customer.email,\r\n      subject: `Welcome to ${companyName}!`,\r\n      message: welcomeHtml,\r\n      type: 'email',\r\n    });\r\n\r\n    results.processed = 1;\r\n    results.message = 'Welcome email sent successfully';\r\n\r\n    return results;\r\n  } catch (error: any) {\r\n    results.success = false;\r\n    results.message = `Error sending welcome email: ${error.message}`;\r\n    results.errors?.push(error.message);\r\n    results.failed = 1;\r\n    return results;\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\lib\\automations\\data-archiving.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Transaction' is defined but never used. Allowed unused vars must match /^_/u.","line":7,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'archiveCollectionName' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":64,"column":15,"nodeType":null,"messageId":"unusedVar","endLine":64,"endColumn":36},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":95,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":95,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2964,2967],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2964,2967],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":100,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":100,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3131,3134],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3131,3134],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":111,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":111,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3482,3485],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3482,3485],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Automated Data Archiving\r\n * Automatically archive old data to reduce database size\r\n */\r\n\r\nimport connectDB from '@/lib/mongodb';\r\nimport Transaction from '@/models/Transaction';\r\nimport Tenant from '@/models/Tenant';\r\nimport { AutomationResult } from './types';\r\nimport mongoose from 'mongoose';\r\n\r\nexport interface DataArchivingOptions {\r\n  tenantId?: string;\r\n  archiveYears?: number; // Years to keep before archiving (default: 2)\r\n  collections?: string[]; // Collections to archive (default: ['transactions'])\r\n}\r\n\r\n/**\r\n * Archive old data to reduce database size\r\n */\r\nexport async function archiveOldData(\r\n  options: DataArchivingOptions = {}\r\n): Promise<AutomationResult> {\r\n  await connectDB();\r\n\r\n  const results: AutomationResult = {\r\n    success: true,\r\n    message: '',\r\n    processed: 0,\r\n    failed: 0,\r\n    errors: [],\r\n  };\r\n\r\n  try {\r\n    const archiveYears = options.archiveYears || 2;\r\n    const collections = options.collections || ['transactions'];\r\n    const cutoffDate = new Date();\r\n    cutoffDate.setFullYear(cutoffDate.getFullYear() - archiveYears);\r\n\r\n    // Get tenants to process\r\n    let tenants;\r\n    if (options.tenantId) {\r\n      const tenant = await Tenant.findById(options.tenantId).lean();\r\n      tenants = tenant ? [tenant] : [];\r\n    } else {\r\n      tenants = await Tenant.find({ status: 'active' }).lean();\r\n    }\r\n\r\n    if (tenants.length === 0) {\r\n      results.message = 'No tenants found to process';\r\n      return results;\r\n    }\r\n\r\n    let totalArchived = 0;\r\n    let totalFailed = 0;\r\n\r\n    for (const tenant of tenants) {\r\n      try {\r\n        const tenantId = tenant._id.toString();\r\n        const db = mongoose.connection.db;\r\n        if (!db) continue;\r\n\r\n        // Create archive collection if it doesn't exist\r\n        const archiveCollectionName = `${collections[0]}_archive`;\r\n\r\n        for (const collectionName of collections) {\r\n          try {\r\n            const collection = db.collection(collectionName);\r\n            \r\n            // Find old documents\r\n            const oldDocuments = await collection.find({\r\n              tenantId: new mongoose.Types.ObjectId(tenantId),\r\n              createdAt: { $lt: cutoffDate },\r\n            }).limit(1000).toArray(); // Process in batches\r\n\r\n            if (oldDocuments.length === 0) {\r\n              continue;\r\n            }\r\n\r\n            // Move to archive collection\r\n            const archiveCollection = db.collection(`${collectionName}_archive`);\r\n            await archiveCollection.insertMany(oldDocuments.map(doc => ({\r\n              ...doc,\r\n              archivedAt: new Date(),\r\n              originalCollection: collectionName,\r\n            })));\r\n\r\n            // Delete from original collection\r\n            const ids = oldDocuments.map(doc => doc._id);\r\n            await collection.deleteMany({\r\n              _id: { $in: ids },\r\n            });\r\n\r\n            totalArchived += oldDocuments.length;\r\n          } catch (error: any) {\r\n            totalFailed++;\r\n            results.errors?.push(`Collection ${collectionName}: ${error.message}`);\r\n          }\r\n        }\r\n      } catch (error: any) {\r\n        totalFailed++;\r\n        results.errors?.push(`Tenant ${tenant.name}: ${error.message}`);\r\n      }\r\n    }\r\n\r\n    results.processed = totalArchived;\r\n    results.failed = totalFailed;\r\n    results.message = `Archived ${totalArchived} records${totalFailed > 0 ? `, ${totalFailed} failed` : ''}`;\r\n\r\n    return results;\r\n  } catch (error: any) {\r\n    results.success = false;\r\n    results.message = `Error archiving data: ${error.message}`;\r\n    results.errors?.push(error.message);\r\n    return results;\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\lib\\automations\\database-backups.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":58,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":58,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1736,1739],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1736,1739],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":115,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":115,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3621,3624],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3621,3624],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Automated Database Backups\r\n * Scheduled automatic backups\r\n */\r\n\r\nimport connectDB from '@/lib/mongodb';\r\nimport mongoose from 'mongoose';\r\nimport { AutomationResult } from './types';\r\nimport * as fs from 'fs/promises';\r\nimport * as path from 'path';\r\n\r\nexport interface DatabaseBackupOptions {\r\n  tenantId?: string; // If specified, backup only this tenant's data\r\n  backupPath?: string; // Local backup path\r\n  uploadToCloud?: boolean; // Upload to cloud storage (S3, Azure, etc.)\r\n}\r\n\r\n/**\r\n * Create database backup\r\n */\r\nexport async function createDatabaseBackup(\r\n  options: DatabaseBackupOptions = {}\r\n): Promise<AutomationResult> {\r\n  await connectDB();\r\n\r\n  const results: AutomationResult = {\r\n    success: true,\r\n    message: '',\r\n    processed: 0,\r\n    failed: 0,\r\n    errors: [],\r\n  };\r\n\r\n  try {\r\n    // For MongoDB, we'll use mongodump if available, or export collections\r\n    // This is a simplified version - in production, use mongodump or MongoDB Atlas backup API\r\n    \r\n    const backupDir = options.backupPath || path.join(process.cwd(), 'backups');\r\n    const timestamp = new Date().toISOString().replace(/[:.]/g, '-');\r\n    const backupFileName = `backup-${timestamp}.json`;\r\n    const backupPath = path.join(backupDir, backupFileName);\r\n\r\n    // Ensure backup directory exists\r\n    try {\r\n      await fs.mkdir(backupDir, { recursive: true });\r\n    } catch (error) {\r\n      // Directory might already exist\r\n    }\r\n\r\n    // Get database connection\r\n    const db = mongoose.connection.db;\r\n    if (!db) {\r\n      throw new Error('Database connection not available');\r\n    }\r\n\r\n    // Get all collections\r\n    const collections = await db.listCollections().toArray();\r\n    const backupData: Record<string, any[]> = {};\r\n\r\n    // Export each collection\r\n    for (const collectionInfo of collections) {\r\n      const collectionName = collectionInfo.name;\r\n      \r\n      // Skip system collections\r\n      if (collectionName.startsWith('system.')) {\r\n        continue;\r\n      }\r\n\r\n      // If tenantId specified, filter by tenant\r\n      if (options.tenantId) {\r\n        const collection = db.collection(collectionName);\r\n        const documents = await collection.find({ tenantId: new mongoose.Types.ObjectId(options.tenantId) }).toArray();\r\n        if (documents.length > 0) {\r\n          backupData[collectionName] = documents;\r\n        }\r\n      } else {\r\n        const collection = db.collection(collectionName);\r\n        const documents = await collection.find({}).limit(10000).toArray(); // Limit to prevent memory issues\r\n        if (documents.length > 0) {\r\n          backupData[collectionName] = documents;\r\n        }\r\n      }\r\n    }\r\n\r\n    // Write backup to file\r\n    await fs.writeFile(backupPath, JSON.stringify(backupData, null, 2), 'utf-8');\r\n\r\n    // Rotate old backups (keep last 7)\r\n    try {\r\n      const files = await fs.readdir(backupDir);\r\n      const backupFiles = files\r\n        .filter(f => f.startsWith('backup-') && f.endsWith('.json'))\r\n        .sort()\r\n        .reverse();\r\n      \r\n      // Keep only last 7 backups\r\n      if (backupFiles.length > 7) {\r\n        for (const file of backupFiles.slice(7)) {\r\n          await fs.unlink(path.join(backupDir, file)).catch(() => {\r\n            // Ignore errors\r\n          });\r\n        }\r\n      }\r\n    } catch (error) {\r\n      // Ignore rotation errors\r\n    }\r\n\r\n    results.processed = 1;\r\n    results.message = `Backup created: ${backupFileName}`;\r\n\r\n    // TODO: Upload to cloud storage if uploadToCloud is true\r\n    // This would require AWS S3, Azure Blob, or similar integration\r\n\r\n    return results;\r\n  } catch (error: any) {\r\n    results.success = false;\r\n    results.message = `Error creating backup: ${error.message}`;\r\n    results.errors?.push(error.message);\r\n    results.failed = 1;\r\n    return results;\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\lib\\automations\\discount-management.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'companyName' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":95,"column":21,"nodeType":null,"messageId":"unusedVar","endLine":95,"endColumn":32},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":105,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":105,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3581,3584],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3581,3584],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'companyName' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":119,"column":21,"nodeType":null,"messageId":"unusedVar","endLine":119,"endColumn":32},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":133,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":133,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4907,4910],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4907,4910],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":180,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":180,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7011,7014],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7011,7014],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":191,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":191,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7429,7432],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7429,7432],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Automatic Discount Activation/Deactivation\r\n * Auto-activate and deactivate discounts based on dates and conditions\r\n */\r\n\r\nimport connectDB from '@/lib/mongodb';\r\nimport Discount from '@/models/Discount';\r\nimport Tenant from '@/models/Tenant';\r\nimport { sendEmail } from '@/lib/notifications';\r\nimport { getTenantSettingsById } from '@/lib/tenant';\r\nimport { AutomationResult } from './types';\r\n\r\nexport interface DiscountManagementOptions {\r\n  tenantId?: string;\r\n}\r\n\r\n/**\r\n * Automatically activate/deactivate discounts based on validity dates\r\n */\r\nexport async function manageDiscountStatus(\r\n  options: DiscountManagementOptions = {}\r\n): Promise<AutomationResult> {\r\n  await connectDB();\r\n\r\n  const results: AutomationResult = {\r\n    success: true,\r\n    message: '',\r\n    processed: 0,\r\n    failed: 0,\r\n    errors: [],\r\n  };\r\n\r\n  try {\r\n    // Get tenants to process\r\n    let tenants;\r\n    if (options.tenantId) {\r\n      const tenant = await Tenant.findById(options.tenantId).lean();\r\n      tenants = tenant ? [tenant] : [];\r\n    } else {\r\n      // Get all active tenants\r\n      tenants = await Tenant.find({ status: 'active' }).lean();\r\n    }\r\n\r\n    if (tenants.length === 0) {\r\n      results.message = 'No tenants found to process';\r\n      return results;\r\n    }\r\n\r\n    const now = new Date();\r\n    let totalActivated = 0;\r\n    let totalDeactivated = 0;\r\n    let totalFailed = 0;\r\n\r\n    for (const tenant of tenants) {\r\n      try {\r\n        const tenantId = tenant._id.toString();\r\n        const tenantSettings = await getTenantSettingsById(tenantId);\r\n\r\n        // Find discounts that need activation (validFrom has arrived, but not active)\r\n        const discountsToActivate = await Discount.find({\r\n          tenantId,\r\n          validFrom: { $lte: now },\r\n          validUntil: { $gte: now },\r\n          isActive: false,\r\n        }).lean();\r\n\r\n        // Find discounts that need deactivation (validUntil has passed, but still active)\r\n        // First, get all active discounts\r\n        const allActiveDiscounts = await Discount.find({\r\n          tenantId,\r\n          isActive: true,\r\n        }).lean();\r\n\r\n        // Filter discounts that need deactivation\r\n        const discountsToDeactivate = allActiveDiscounts.filter((discount) => {\r\n          // Check if validUntil has passed\r\n          if (discount.validUntil < now) {\r\n            return true;\r\n          }\r\n          // Check if usage limit reached\r\n          if (discount.usageLimit && discount.usageCount >= discount.usageLimit) {\r\n            return true;\r\n          }\r\n          return false;\r\n        });\r\n\r\n        // Activate discounts\r\n        for (const discount of discountsToActivate) {\r\n          try {\r\n            await Discount.findByIdAndUpdate(discount._id, { isActive: true });\r\n            totalActivated++;\r\n\r\n            // Send notification if enabled\r\n            if (tenantSettings?.emailNotifications && tenantSettings?.email) {\r\n              const companyName = tenantSettings?.companyName || tenant.name || 'Business';\r\n              await sendEmail({\r\n                to: tenantSettings.email,\r\n                subject: `Discount Activated: ${discount.code}`,\r\n                message: `The discount \"${discount.code}\" (${discount.name || 'No name'}) has been automatically activated.\\n\\nValid until: ${discount.validUntil.toLocaleDateString()}\\nUsage limit: ${discount.usageLimit || 'Unlimited'}`,\r\n                type: 'email',\r\n              }).catch(() => {\r\n                // Don't fail if email fails\r\n              });\r\n            }\r\n          } catch (error: any) {\r\n            totalFailed++;\r\n            results.errors?.push(`Activate discount ${discount.code}: ${error.message}`);\r\n          }\r\n        }\r\n\r\n        // Deactivate discounts\r\n        for (const discount of discountsToDeactivate) {\r\n          try {\r\n            await Discount.findByIdAndUpdate(discount._id, { isActive: false });\r\n            totalDeactivated++;\r\n\r\n            // Send notification if enabled\r\n            if (tenantSettings?.emailNotifications && tenantSettings?.email) {\r\n              const companyName = tenantSettings?.companyName || tenant.name || 'Business';\r\n              const reason = discount.validUntil < now\r\n                ? 'expired (validUntil date passed)'\r\n                : 'reached usage limit';\r\n              \r\n              await sendEmail({\r\n                to: tenantSettings.email,\r\n                subject: `Discount Deactivated: ${discount.code}`,\r\n                message: `The discount \"${discount.code}\" (${discount.name || 'No name'}) has been automatically deactivated.\\n\\nReason: ${reason}\\nUsage count: ${discount.usageCount || 0}${discount.usageLimit ? ` / ${discount.usageLimit}` : ''}`,\r\n                type: 'email',\r\n              }).catch(() => {\r\n                // Don't fail if email fails\r\n              });\r\n            }\r\n          } catch (error: any) {\r\n            totalFailed++;\r\n            results.errors?.push(`Deactivate discount ${discount.code}: ${error.message}`);\r\n          }\r\n        }\r\n\r\n        // Check for discounts approaching usage limits (#10 - Discount Usage Limit Alerts)\r\n        const activeDiscounts = await Discount.find({\r\n          tenantId,\r\n          isActive: true,\r\n          usageLimit: { $exists: true, $ne: null },\r\n        }).lean();\r\n\r\n        for (const discount of activeDiscounts) {\r\n          if (!discount.usageLimit) continue;\r\n          \r\n          const usagePercent = (discount.usageCount / discount.usageLimit) * 100;\r\n          const alertThresholds = [80, 90, 100];\r\n          \r\n          // Check if we should send an alert (80%, 90%, or 100%)\r\n          const shouldAlert = alertThresholds.some(threshold => {\r\n            return usagePercent >= threshold && usagePercent < threshold + 5; // 5% window to avoid duplicate alerts\r\n          });\r\n\r\n          if (shouldAlert && tenantSettings?.emailNotifications && tenantSettings?.email) {\r\n            const threshold = Math.floor(usagePercent / 10) * 10; // Round to nearest 10\r\n            const companyName = tenantSettings?.companyName || tenant.name || 'Business';\r\n            \r\n            await sendEmail({\r\n              to: tenantSettings.email,\r\n              subject: `Discount Usage Alert: ${discount.code} - ${threshold}% Used`,\r\n              message: `Discount Usage Alert for ${companyName}\r\n\r\nThe discount \"${discount.code}\" (${discount.name || 'No name'}) has reached ${usagePercent.toFixed(1)}% of its usage limit.\r\n\r\nCurrent Usage: ${discount.usageCount} / ${discount.usageLimit}\r\nRemaining Uses: ${discount.usageLimit - discount.usageCount}\r\n\r\n${usagePercent >= 100 ? ' This discount has reached its usage limit and will be deactivated.' : 'Please review and consider creating a new discount if needed.'}\r\n\r\nThis is an automated alert from your POS system.`,\r\n              type: 'email',\r\n            }).catch(() => {\r\n              // Don't fail if email fails\r\n            });\r\n          }\r\n        }\r\n      } catch (error: any) {\r\n        totalFailed++;\r\n        results.errors?.push(`Tenant ${tenant.name}: ${error.message}`);\r\n      }\r\n    }\r\n\r\n    results.processed = totalActivated + totalDeactivated;\r\n    results.failed = totalFailed;\r\n    results.message = `Activated ${totalActivated} discounts, deactivated ${totalDeactivated} discounts${totalFailed > 0 ? `, ${totalFailed} failed` : ''}`;\r\n\r\n    return results;\r\n  } catch (error: any) {\r\n    results.success = false;\r\n    results.message = `Error managing discount status: ${error.message}`;\r\n    results.errors?.push(error.message);\r\n    return results;\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\lib\\automations\\dynamic-pricing.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'mongoose' is defined but never used. Allowed unused vars must match /^_/u.","line":12,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'tenantSettings' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":59,"column":15,"nodeType":null,"messageId":"unusedVar","endLine":59,"endColumn":29},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":107,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":107,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3622,3625],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3622,3625],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":112,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":112,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3783,3786],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3783,3786],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":123,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":123,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4138,4141],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4138,4141],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Dynamic Pricing Automation\r\n * Automatically adjust prices based on demand, time, or stock levels\r\n */\r\n\r\nimport connectDB from '@/lib/mongodb';\r\nimport Product from '@/models/Product';\r\nimport Transaction from '@/models/Transaction';\r\nimport Tenant from '@/models/Tenant';\r\nimport { getTenantSettingsById } from '@/lib/tenant';\r\nimport { AutomationResult } from './types';\r\nimport mongoose from 'mongoose';\r\n\r\nexport interface DynamicPricingOptions {\r\n  tenantId?: string;\r\n  enableTimeBased?: boolean; // Enable time-based pricing (e.g., happy hour)\r\n  enableDemandBased?: boolean; // Enable demand-based pricing\r\n  enableStockBased?: boolean; // Enable stock-based pricing (clearance)\r\n}\r\n\r\n/**\r\n * Apply dynamic pricing rules\r\n * Note: This is a framework - actual pricing rules need to be configured per tenant\r\n */\r\nexport async function applyDynamicPricing(\r\n  options: DynamicPricingOptions = {}\r\n): Promise<AutomationResult> {\r\n  await connectDB();\r\n\r\n  const results: AutomationResult = {\r\n    success: true,\r\n    message: '',\r\n    processed: 0,\r\n    failed: 0,\r\n    errors: [],\r\n  };\r\n\r\n  try {\r\n    // Get tenants to process\r\n    let tenants;\r\n    if (options.tenantId) {\r\n      const tenant = await Tenant.findById(options.tenantId).lean();\r\n      tenants = tenant ? [tenant] : [];\r\n    } else {\r\n      tenants = await Tenant.find({ status: 'active' }).lean();\r\n    }\r\n\r\n    if (tenants.length === 0) {\r\n      results.message = 'No tenants found to process';\r\n      return results;\r\n    }\r\n\r\n    let totalUpdated = 0;\r\n    let totalFailed = 0;\r\n\r\n    for (const tenant of tenants) {\r\n      try {\r\n        const tenantId = tenant._id.toString();\r\n        const tenantSettings = await getTenantSettingsById(tenantId);\r\n\r\n        // Get products\r\n        const products = await Product.find({ tenantId }).lean();\r\n\r\n        for (const product of products) {\r\n          try {\r\n            let newPrice = product.price;\r\n            let priceChanged = false;\r\n            const now = new Date();\r\n            const currentHour = now.getHours();\r\n\r\n            // Time-based pricing (e.g., happy hour 2-4 PM: 10% discount)\r\n            if (options.enableTimeBased && currentHour >= 14 && currentHour < 16) {\r\n              newPrice = product.price * 0.9; // 10% discount\r\n              priceChanged = true;\r\n            }\r\n\r\n            // Stock-based pricing (clearance: 20% discount if stock > 50)\r\n            if (options.enableStockBased && product.stock > 50) {\r\n              newPrice = product.price * 0.8; // 20% discount for clearance\r\n              priceChanged = true;\r\n            }\r\n\r\n            // Demand-based pricing (increase price if high demand)\r\n            if (options.enableDemandBased) {\r\n              const last7Days = new Date(Date.now() - 7 * 24 * 60 * 60 * 1000);\r\n              const recentSales = await Transaction.countDocuments({\r\n                tenantId,\r\n                'items.product': product._id,\r\n                createdAt: { $gte: last7Days },\r\n                status: 'completed',\r\n              });\r\n\r\n              if (recentSales > 20) {\r\n                // High demand - increase price by 5%\r\n                newPrice = product.price * 1.05;\r\n                priceChanged = true;\r\n              }\r\n            }\r\n\r\n            // Update product price if changed\r\n            if (priceChanged && newPrice !== product.price) {\r\n              await Product.findByIdAndUpdate(product._id, {\r\n                price: Math.round(newPrice * 100) / 100, // Round to 2 decimals\r\n              });\r\n              totalUpdated++;\r\n            }\r\n          } catch (error: any) {\r\n            totalFailed++;\r\n            results.errors?.push(`Product ${product._id}: ${error.message}`);\r\n          }\r\n        }\r\n      } catch (error: any) {\r\n        totalFailed++;\r\n        results.errors?.push(`Tenant ${tenant.name}: ${error.message}`);\r\n      }\r\n    }\r\n\r\n    results.processed = totalUpdated;\r\n    results.failed = totalFailed;\r\n    results.message = `Updated ${totalUpdated} product prices${totalFailed > 0 ? `, ${totalFailed} failed` : ''}`;\r\n\r\n    return results;\r\n  } catch (error: any) {\r\n    results.success = false;\r\n    results.message = `Error applying dynamic pricing: ${error.message}`;\r\n    results.errors?.push(error.message);\r\n    return results;\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\lib\\automations\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\lib\\automations\\low-stock-alerts.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":88,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":88,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2533,2536],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2533,2536],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":124,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":124,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3998,4001],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3998,4001],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":139,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":139,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4453,4456],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4453,4456],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":144,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":144,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4616,4619],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4616,4619],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":155,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":155,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4979,4982],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4979,4982],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Low Stock Email/SMS Alerts\r\n * Sends notifications when products reach low stock thresholds\r\n */\r\n\r\nimport connectDB from '@/lib/mongodb';\r\nimport Tenant from '@/models/Tenant';\r\nimport { getLowStockProducts } from '@/lib/stock';\r\nimport { sendEmail, sendSMS } from '@/lib/notifications';\r\nimport { getTenantSettingsById } from '@/lib/tenant';\r\nimport { AutomationResult } from './types';\r\n\r\nexport interface LowStockAlertOptions {\r\n  tenantId?: string;\r\n  threshold?: number;\r\n}\r\n\r\n/**\r\n * Send low stock alerts for all tenants or a specific tenant\r\n */\r\nexport async function sendLowStockAlerts(\r\n  options: LowStockAlertOptions = {}\r\n): Promise<AutomationResult> {\r\n  await connectDB();\r\n\r\n  const results: AutomationResult = {\r\n    success: true,\r\n    message: '',\r\n    processed: 0,\r\n    failed: 0,\r\n    errors: [],\r\n  };\r\n\r\n  try {\r\n    // Get tenants to process\r\n    let tenants;\r\n    if (options.tenantId) {\r\n      const tenant = await Tenant.findById(options.tenantId).lean();\r\n      tenants = tenant ? [tenant] : [];\r\n    } else {\r\n      // Get all active tenants with inventory enabled\r\n      tenants = await Tenant.find({\r\n        status: 'active',\r\n        'settings.enableInventory': true,\r\n        'settings.lowStockAlert': true,\r\n      }).lean();\r\n    }\r\n\r\n    if (tenants.length === 0) {\r\n      results.message = 'No tenants found to process';\r\n      return results;\r\n    }\r\n\r\n    let totalProcessed = 0;\r\n    let totalFailed = 0;\r\n\r\n    for (const tenant of tenants) {\r\n      try {\r\n        const tenantSettings = await getTenantSettingsById(tenant._id.toString());\r\n\r\n        // Skip if notifications disabled\r\n        if (!tenantSettings?.emailNotifications && !tenantSettings?.smsNotifications) {\r\n          continue;\r\n        }\r\n\r\n        // Skip if low stock alerts disabled\r\n        if (!tenantSettings?.lowStockAlert) {\r\n          continue;\r\n        }\r\n\r\n        // Get low stock products\r\n        const threshold = options.threshold || tenantSettings?.lowStockThreshold || 10;\r\n        const lowStockProducts = await getLowStockProducts(\r\n          tenant._id.toString(),\r\n          undefined,\r\n          threshold\r\n        );\r\n\r\n        if (lowStockProducts.length === 0) {\r\n          continue; // No low stock products\r\n        }\r\n\r\n        // Prepare alert message\r\n        const companyName = tenantSettings?.companyName || tenant.name || 'Business';\r\n        const productList = lowStockProducts\r\n          .slice(0, 20) // Limit to 20 products in email\r\n          .map(\r\n            (product: any) =>\r\n              `- ${product.name}${product.sku ? ` (SKU: ${product.sku})` : ''}: ${product.currentStock || 0} units (Threshold: ${product.threshold || threshold})`\r\n          )\r\n          .join('\\n');\r\n\r\n        const moreProducts = lowStockProducts.length > 20\r\n          ? `\\n... and ${lowStockProducts.length - 20} more products`\r\n          : '';\r\n\r\n        const emailSubject = `Low Stock Alert - ${lowStockProducts.length} Product${lowStockProducts.length > 1 ? 's' : ''}`;\r\n        const emailBody = `Low Stock Alert for ${companyName}\r\n\r\nThe following products are running low on stock:\r\n\r\n${productList}${moreProducts}\r\n\r\nPlease review your inventory and consider reordering these items.\r\n\r\nThis is an automated alert from your POS system.`;\r\n\r\n        const smsBody = `Low Stock Alert: ${lowStockProducts.length} product${lowStockProducts.length > 1 ? 's' : ''} below threshold. Check your POS system for details.`;\r\n\r\n        // Get recipient email/phone from tenant settings\r\n        const recipientEmail = tenantSettings?.email;\r\n        const recipientPhone = tenantSettings?.phone;\r\n\r\n        // Send email alert\r\n        if (recipientEmail && tenantSettings?.emailNotifications) {\r\n          try {\r\n            await sendEmail({\r\n              to: recipientEmail,\r\n              subject: emailSubject,\r\n              message: emailBody,\r\n              type: 'email',\r\n            });\r\n            totalProcessed++;\r\n          } catch (error: any) {\r\n            totalFailed++;\r\n            results.errors?.push(`Email to ${recipientEmail}: ${error.message}`);\r\n          }\r\n        }\r\n\r\n        // Send SMS alert\r\n        if (recipientPhone && tenantSettings?.smsNotifications) {\r\n          try {\r\n            await sendSMS({\r\n              to: recipientPhone,\r\n              message: smsBody,\r\n              type: 'sms',\r\n            });\r\n            totalProcessed++;\r\n          } catch (error: any) {\r\n            totalFailed++;\r\n            results.errors?.push(`SMS to ${recipientPhone}: ${error.message}`);\r\n          }\r\n        }\r\n      } catch (error: any) {\r\n        totalFailed++;\r\n        results.errors?.push(`Tenant ${tenant.name}: ${error.message}`);\r\n      }\r\n    }\r\n\r\n    results.processed = totalProcessed;\r\n    results.failed = totalFailed;\r\n    results.message = `Processed ${totalProcessed} low stock alerts${totalFailed > 0 ? `, ${totalFailed} failed` : ''}`;\r\n\r\n    return results;\r\n  } catch (error: any) {\r\n    results.success = false;\r\n    results.message = `Error sending low stock alerts: ${error.message}`;\r\n    results.errors?.push(error.message);\r\n    return results;\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\lib\\automations\\multi-branch-sync.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Customer' is defined but never used. Allowed unused vars must match /^_/u.","line":8,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Discount' is defined but never used. Allowed unused vars must match /^_/u.","line":9,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'conflictResolution' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":42,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":42,"endColumn":29},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":84,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":84,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2648,2651],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2648,2651],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":104,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":104,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3296,3299],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3296,3299],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":115,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":115,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3713,3716],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3713,3716],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Multi-Branch Data Synchronization\r\n * Automatically sync relevant data across branches\r\n */\r\n\r\nimport connectDB from '@/lib/mongodb';\r\nimport Product from '@/models/Product';\r\nimport Customer from '@/models/Customer';\r\nimport Discount from '@/models/Discount';\r\nimport Branch from '@/models/Branch';\r\nimport Tenant from '@/models/Tenant';\r\nimport { AutomationResult } from './types';\r\n\r\nexport interface MultiBranchSyncOptions {\r\n  tenantId?: string;\r\n  syncProducts?: boolean;\r\n  syncCustomers?: boolean;\r\n  syncDiscounts?: boolean;\r\n  conflictResolution?: 'last-write-wins' | 'manual'; // How to handle conflicts\r\n}\r\n\r\n/**\r\n * Sync data across branches\r\n */\r\nexport async function syncMultiBranchData(\r\n  options: MultiBranchSyncOptions = {}\r\n): Promise<AutomationResult> {\r\n  await connectDB();\r\n\r\n  const results: AutomationResult = {\r\n    success: true,\r\n    message: '',\r\n    processed: 0,\r\n    failed: 0,\r\n    errors: [],\r\n  };\r\n\r\n  try {\r\n    const syncProducts = options.syncProducts !== false;\r\n    const syncCustomers = options.syncCustomers !== false;\r\n    const syncDiscounts = options.syncDiscounts !== false;\r\n    const conflictResolution = options.conflictResolution || 'last-write-wins';\r\n\r\n    // Get tenants to process\r\n    let tenants;\r\n    if (options.tenantId) {\r\n      const tenant = await Tenant.findById(options.tenantId).lean();\r\n      tenants = tenant ? [tenant] : [];\r\n    } else {\r\n      tenants = await Tenant.find({ status: 'active' }).lean();\r\n    }\r\n\r\n    if (tenants.length === 0) {\r\n      results.message = 'No tenants found to process';\r\n      return results;\r\n    }\r\n\r\n    let totalSynced = 0;\r\n    let totalFailed = 0;\r\n\r\n    for (const tenant of tenants) {\r\n      try {\r\n        const tenantId = tenant._id.toString();\r\n\r\n        // Get all branches\r\n        const branches = await Branch.find({ tenantId, isActive: true }).lean();\r\n        \r\n        if (branches.length < 2) {\r\n          continue; // Need at least 2 branches to sync\r\n        }\r\n\r\n        // Sync products (pricing, descriptions, etc.)\r\n        if (syncProducts) {\r\n          // Get master product data (from first branch or tenant-level)\r\n          const masterProducts = await Product.find({ tenantId }).lean();\r\n\r\n          // For each product, sync pricing and basic info across branches\r\n          // Note: Stock levels are branch-specific and shouldn't be synced\r\n          for (const product of masterProducts) {\r\n            try {\r\n              // Product updates are already tenant-level, so no sync needed\r\n              // Branch stock is intentionally separate\r\n              totalSynced++;\r\n            } catch (error: any) {\r\n              totalFailed++;\r\n              results.errors?.push(`Product ${product._id}: ${error.message}`);\r\n            }\r\n          }\r\n        }\r\n\r\n        // Sync customers (customer data should be tenant-level, not branch-specific)\r\n        if (syncCustomers) {\r\n          // Customers are already tenant-level, so no sync needed\r\n          // This is more of a validation check\r\n          totalSynced++;\r\n        }\r\n\r\n        // Sync discounts (discounts are tenant-level)\r\n        if (syncDiscounts) {\r\n          // Discounts are already tenant-level, so no sync needed\r\n          totalSynced++;\r\n        }\r\n\r\n      } catch (error: any) {\r\n        totalFailed++;\r\n        results.errors?.push(`Tenant ${tenant.name}: ${error.message}`);\r\n      }\r\n    }\r\n\r\n    results.processed = totalSynced;\r\n    results.failed = totalFailed;\r\n    results.message = `Synced ${totalSynced} items${totalFailed > 0 ? `, ${totalFailed} failed` : ''}. Note: Most data is already tenant-level and doesn't require branch sync.`;\r\n\r\n    return results;\r\n  } catch (error: any) {\r\n    results.success = false;\r\n    results.message = `Error syncing multi-branch data: ${error.message}`;\r\n    results.errors?.push(error.message);\r\n    return results;\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\lib\\automations\\offline-sync.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Transaction' is defined but never used. Allowed unused vars must match /^_/u.","line":7,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Tenant' is defined but never used. Allowed unused vars must match /^_/u.","line":8,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":14},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'options' is assigned a value but never used. Allowed unused args must match /^_/u.","line":22,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":22,"endColumn":10},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":43,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":43,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1386,1389],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1386,1389],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Offline Transaction Sync Automation\r\n * Automatically sync offline transactions when online\r\n */\r\n\r\nimport connectDB from '@/lib/mongodb';\r\nimport Transaction from '@/models/Transaction';\r\nimport Tenant from '@/models/Tenant';\r\nimport { AutomationResult } from './types';\r\n\r\nexport interface OfflineSyncOptions {\r\n  tenantId?: string;\r\n  maxRetries?: number; // Maximum retry attempts (default: 3)\r\n}\r\n\r\n/**\r\n * Sync offline transactions\r\n * Note: This assumes offline transactions are stored with a flag or in a separate collection\r\n * This is a framework that can be extended based on your offline storage implementation\r\n */\r\nexport async function syncOfflineTransactions(\r\n  options: OfflineSyncOptions = {}\r\n): Promise<AutomationResult> {\r\n  await connectDB();\r\n\r\n  const results: AutomationResult = {\r\n    success: true,\r\n    message: '',\r\n    processed: 0,\r\n    failed: 0,\r\n    errors: [],\r\n  };\r\n\r\n  try {\r\n    // TODO: This requires an offline transaction storage mechanism\r\n    // For now, we'll check for transactions that might be marked as offline\r\n    // In production, you'd have a separate OfflineTransaction model or flag\r\n\r\n    results.message = 'Offline transaction sync requires offline storage implementation. This feature needs to be extended based on your offline storage mechanism.';\r\n    results.processed = 0;\r\n\r\n    return results;\r\n  } catch (error: any) {\r\n    results.success = false;\r\n    results.message = `Error syncing offline transactions: ${error.message}`;\r\n    results.errors?.push(error.message);\r\n    return results;\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\lib\\automations\\predictive-stock.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":70,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":70,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2054,2057],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2054,2057],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":140,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":140,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4652,4655],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4652,4655],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":180,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":180,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6145,6148],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6145,6148],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":191,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":191,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6513,6516],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6513,6516],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Predictive Stock Replenishment\r\n * Predict future stock needs based on historical sales patterns\r\n */\r\n\r\nimport connectDB from '@/lib/mongodb';\r\nimport Product from '@/models/Product';\r\nimport Transaction from '@/models/Transaction';\r\nimport Tenant from '@/models/Tenant';\r\nimport { sendEmail } from '@/lib/notifications';\r\nimport { getTenantSettingsById } from '@/lib/tenant';\r\nimport { AutomationResult } from './types';\r\nimport mongoose from 'mongoose';\r\n\r\nexport interface PredictiveStockOptions {\r\n  tenantId?: string;\r\n  analysisDays?: number; // Days of history to analyze (default: 30)\r\n  predictionDays?: number; // Days ahead to predict (default: 7)\r\n}\r\n\r\n/**\r\n * Analyze sales patterns and predict stock needs\r\n */\r\nexport async function predictStockNeeds(\r\n  options: PredictiveStockOptions = {}\r\n): Promise<AutomationResult> {\r\n  await connectDB();\r\n\r\n  const results: AutomationResult = {\r\n    success: true,\r\n    message: '',\r\n    processed: 0,\r\n    failed: 0,\r\n    errors: [],\r\n  };\r\n\r\n  try {\r\n    const analysisDays = options.analysisDays || 30;\r\n    const predictionDays = options.predictionDays || 7;\r\n    const analysisStartDate = new Date(Date.now() - analysisDays * 24 * 60 * 60 * 1000);\r\n\r\n    // Get tenants to process\r\n    let tenants;\r\n    if (options.tenantId) {\r\n      const tenant = await Tenant.findById(options.tenantId).lean();\r\n      tenants = tenant ? [tenant] : [];\r\n    } else {\r\n      tenants = await Tenant.find({ status: 'active' }).lean();\r\n    }\r\n\r\n    if (tenants.length === 0) {\r\n      results.message = 'No tenants found to process';\r\n      return results;\r\n    }\r\n\r\n    let totalPredictions = 0;\r\n    let totalFailed = 0;\r\n\r\n    for (const tenant of tenants) {\r\n      try {\r\n        const tenantId = tenant._id.toString();\r\n        const tenantSettings = await getTenantSettingsById(tenantId);\r\n\r\n        // Get all products with inventory tracking\r\n        const products = await Product.find({\r\n          tenantId,\r\n          trackInventory: true,\r\n        }).lean();\r\n\r\n        const predictions: any[] = [];\r\n\r\n        for (const product of products) {\r\n          try {\r\n            // Get sales history for this product\r\n            const salesHistory = await Transaction.aggregate([\r\n              {\r\n                $match: {\r\n                  tenantId: new mongoose.Types.ObjectId(tenantId),\r\n                  createdAt: { $gte: analysisStartDate },\r\n                  status: 'completed',\r\n                  'items.product': product._id,\r\n                },\r\n              },\r\n              {\r\n                $unwind: '$items',\r\n              },\r\n              {\r\n                $match: {\r\n                  'items.product': product._id,\r\n                },\r\n              },\r\n              {\r\n                $group: {\r\n                  _id: {\r\n                    $dateToString: { format: '%Y-%m-%d', date: '$createdAt' },\r\n                  },\r\n                  quantity: { $sum: '$items.quantity' },\r\n                },\r\n              },\r\n              {\r\n                $sort: { _id: 1 },\r\n              },\r\n            ]);\r\n\r\n            if (salesHistory.length === 0) {\r\n              continue; // No sales history\r\n            }\r\n\r\n            // Calculate average daily sales\r\n            const totalQuantity = salesHistory.reduce((sum, day) => sum + day.quantity, 0);\r\n            const avgDailySales = totalQuantity / analysisDays;\r\n\r\n            // Predict future needs\r\n            const predictedNeeds = avgDailySales * predictionDays;\r\n\r\n            // Get current stock\r\n            const currentStock = product.stock || 0;\r\n            const threshold = product.lowStockThreshold || tenantSettings?.lowStockThreshold || 10;\r\n\r\n            // Predict when stock will hit threshold\r\n            const daysUntilThreshold = currentStock > threshold\r\n              ? Math.floor((currentStock - threshold) / avgDailySales)\r\n              : 0;\r\n\r\n            // If predicted to hit threshold within prediction window, suggest reorder\r\n            if (daysUntilThreshold <= predictionDays && currentStock > 0) {\r\n              const suggestedReorderQuantity = Math.ceil(predictedNeeds + threshold - currentStock);\r\n\r\n              predictions.push({\r\n                productId: product._id,\r\n                productName: product.name,\r\n                sku: product.sku,\r\n                currentStock,\r\n                avgDailySales: Math.round(avgDailySales * 100) / 100,\r\n                predictedNeeds: Math.ceil(predictedNeeds),\r\n                daysUntilThreshold,\r\n                suggestedReorderQuantity,\r\n              });\r\n            }\r\n          } catch (error: any) {\r\n            // Skip product on error\r\n          }\r\n        }\r\n\r\n        if (predictions.length > 0 && tenantSettings?.emailNotifications && tenantSettings?.email) {\r\n          const companyName = tenantSettings?.companyName || tenant.name || 'Business';\r\n          \r\n          const predictionsList = predictions.slice(0, 20).map(p => \r\n            `- ${p.productName}${p.sku ? ` (SKU: ${p.sku})` : ''}\r\n  Current Stock: ${p.currentStock}\r\n  Avg Daily Sales: ${p.avgDailySales}\r\n  Predicted Needs (${predictionDays} days): ${p.predictedNeeds}\r\n  Days Until Threshold: ${p.daysUntilThreshold}\r\n  Suggested Reorder: ${p.suggestedReorderQuantity} units`\r\n          ).join('\\n\\n');\r\n\r\n          const emailBody = `Predictive Stock Replenishment Report for ${companyName}\r\n\r\nAnalysis Period: Last ${analysisDays} days\r\nPrediction Window: Next ${predictionDays} days\r\n\r\nThe following products are predicted to need replenishment:\r\n\r\n${predictionsList}\r\n${predictions.length > 20 ? `\\n... and ${predictions.length - 20} more products` : ''}\r\n\r\nThis is an automated predictive analysis from your POS system.`;\r\n\r\n          await sendEmail({\r\n            to: tenantSettings.email,\r\n            subject: `Predictive Stock Replenishment Report - ${companyName}`,\r\n            message: emailBody,\r\n            type: 'email',\r\n          }).catch(() => {\r\n            // Don't fail if email fails\r\n          });\r\n\r\n          totalPredictions += predictions.length;\r\n        }\r\n      } catch (error: any) {\r\n        totalFailed++;\r\n        results.errors?.push(`Tenant ${tenant.name}: ${error.message}`);\r\n      }\r\n    }\r\n\r\n    results.processed = totalPredictions;\r\n    results.failed = totalFailed;\r\n    results.message = `Generated ${totalPredictions} stock predictions${totalFailed > 0 ? `, ${totalFailed} failed` : ''}`;\r\n\r\n    return results;\r\n  } catch (error: any) {\r\n    results.success = false;\r\n    results.message = `Error predicting stock needs: ${error.message}`;\r\n    results.errors?.push(error.message);\r\n    return results;\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\lib\\automations\\product-performance.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":72,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":72,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2160,2163],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2160,2163],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":73,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":73,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2202,2205],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2202,2205],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":140,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":140,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4462,4465],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4462,4465],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":194,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":194,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6374,6377],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6374,6377],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":205,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":205,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6736,6739],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6736,6739],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Product Performance Alerts\r\n * Alert on product performance changes\r\n */\r\n\r\nimport connectDB from '@/lib/mongodb';\r\nimport Product from '@/models/Product';\r\nimport Transaction from '@/models/Transaction';\r\nimport Tenant from '@/models/Tenant';\r\nimport mongoose from 'mongoose';\r\nimport { sendEmail } from '@/lib/notifications';\r\nimport { getTenantSettingsById } from '@/lib/tenant';\r\nimport { AutomationResult } from './types';\r\n\r\nexport interface ProductPerformanceOptions {\r\n  tenantId?: string;\r\n  daysToAnalyze?: number; // Days to look back for performance (default: 30)\r\n  slowMovingThreshold?: number; // Days without sales to consider slow-moving (default: 30)\r\n}\r\n\r\n/**\r\n * Analyze product performance and send alerts\r\n */\r\nexport async function analyzeProductPerformance(\r\n  options: ProductPerformanceOptions = {}\r\n): Promise<AutomationResult> {\r\n  await connectDB();\r\n\r\n  const results: AutomationResult = {\r\n    success: true,\r\n    message: '',\r\n    processed: 0,\r\n    failed: 0,\r\n    errors: [],\r\n  };\r\n\r\n  try {\r\n    const daysToAnalyze = options.daysToAnalyze || 30;\r\n    const slowMovingThreshold = options.slowMovingThreshold || 30;\r\n    const analysisStartDate = new Date(Date.now() - daysToAnalyze * 24 * 60 * 60 * 1000);\r\n\r\n    // Get tenants to process\r\n    let tenants;\r\n    if (options.tenantId) {\r\n      const tenant = await Tenant.findById(options.tenantId).lean();\r\n      tenants = tenant ? [tenant] : [];\r\n    } else {\r\n      tenants = await Tenant.find({ status: 'active' }).lean();\r\n    }\r\n\r\n    if (tenants.length === 0) {\r\n      results.message = 'No tenants found to process';\r\n      return results;\r\n    }\r\n\r\n    let totalAlerts = 0;\r\n    let totalFailed = 0;\r\n\r\n    for (const tenant of tenants) {\r\n      try {\r\n        const tenantId = tenant._id.toString();\r\n        const tenantSettings = await getTenantSettingsById(tenantId);\r\n\r\n        // Skip if notifications disabled\r\n        if (!tenantSettings?.emailNotifications) {\r\n          continue;\r\n        }\r\n\r\n        // Get all products\r\n        const products = await Product.find({ tenantId, trackInventory: true }).lean();\r\n\r\n        const slowMovingProducts: any[] = [];\r\n        const topPerformers: any[] = [];\r\n\r\n        for (const product of products) {\r\n          try {\r\n            // Get sales for this product in the analysis period\r\n            const sales = await Transaction.aggregate([\r\n              {\r\n                $match: {\r\n                  tenantId: new mongoose.Types.ObjectId(tenantId),\r\n                  createdAt: { $gte: analysisStartDate },\r\n                  status: 'completed',\r\n                  'items.product': product._id,\r\n                },\r\n              },\r\n              {\r\n                $unwind: '$items',\r\n              },\r\n              {\r\n                $match: {\r\n                  'items.product': product._id,\r\n                },\r\n              },\r\n              {\r\n                $group: {\r\n                  _id: null,\r\n                  totalQuantity: { $sum: '$items.quantity' },\r\n                  totalRevenue: { $sum: '$items.subtotal' },\r\n                },\r\n              },\r\n            ]);\r\n\r\n            const salesData = sales[0] || { totalQuantity: 0, totalRevenue: 0 };\r\n            const salesCount = salesData.totalQuantity || 0;\r\n            const revenue = salesData.totalRevenue || 0;\r\n\r\n            // Get last sale date\r\n            const lastSale = await Transaction.findOne({\r\n              tenantId,\r\n              'items.product': product._id,\r\n              status: 'completed',\r\n            })\r\n              .sort({ createdAt: -1 })\r\n              .lean();\r\n\r\n            const daysSinceLastSale = lastSale\r\n              ? Math.floor((Date.now() - new Date(lastSale.createdAt).getTime()) / (1000 * 60 * 60 * 24))\r\n              : daysToAnalyze;\r\n\r\n            // Identify slow-moving products\r\n            if (daysSinceLastSale >= slowMovingThreshold && salesCount === 0) {\r\n              slowMovingProducts.push({\r\n                ...product,\r\n                daysSinceLastSale,\r\n                salesCount,\r\n                revenue,\r\n              });\r\n            }\r\n\r\n            // Identify top performers (top 10 by revenue)\r\n            if (revenue > 0) {\r\n              topPerformers.push({\r\n                ...product,\r\n                daysSinceLastSale,\r\n                salesCount,\r\n                revenue,\r\n              });\r\n            }\r\n          } catch (error: any) {\r\n            // Skip product on error\r\n          }\r\n        }\r\n\r\n        // Sort top performers by revenue\r\n        topPerformers.sort((a, b) => b.revenue - a.revenue);\r\n\r\n        // Send alerts if there are slow-moving products or top performers to report\r\n        if (slowMovingProducts.length > 0 || topPerformers.length > 0) {\r\n          const companyName = tenantSettings?.companyName || tenant.name || 'Business';\r\n          \r\n          const slowMovingList = slowMovingProducts.slice(0, 20).map(p => \r\n            `- ${p.name}${p.sku ? ` (SKU: ${p.sku})` : ''}: No sales in ${p.daysSinceLastSale} days`\r\n          ).join('\\n');\r\n\r\n          const topPerformersList = topPerformers.slice(0, 10).map(p => \r\n            `- ${p.name}${p.sku ? ` (SKU: ${p.sku})` : ''}: $${p.revenue.toFixed(2)} revenue, ${p.salesCount} units sold`\r\n          ).join('\\n');\r\n\r\n          const emailBody = `Product Performance Report for ${companyName}\r\n\r\nAnalysis Period: Last ${daysToAnalyze} days\r\n\r\n${slowMovingProducts.length > 0 ? `\r\nSLOW-MOVING PRODUCTS (${slowMovingProducts.length}):\r\n${slowMovingList}\r\n${slowMovingProducts.length > 20 ? `... and ${slowMovingProducts.length - 20} more` : ''}\r\n\r\nConsider running promotions or reviewing pricing for these products.\r\n` : ''}\r\n\r\n${topPerformers.length > 0 ? `\r\nTOP PERFORMERS (Top 10):\r\n${topPerformersList}\r\n\r\nConsider increasing stock levels for these products.\r\n` : ''}\r\n\r\nThis is an automated product performance report from your POS system.`;\r\n\r\n          if (tenantSettings.email) {\r\n            await sendEmail({\r\n              to: tenantSettings.email,\r\n              subject: `Product Performance Report - ${companyName}`,\r\n              message: emailBody,\r\n              type: 'email',\r\n            }).catch(() => {\r\n              // Don't fail if email fails\r\n            });\r\n          }\r\n\r\n          totalAlerts++;\r\n        }\r\n      } catch (error: any) {\r\n        totalFailed++;\r\n        results.errors?.push(`Tenant ${tenant.name}: ${error.message}`);\r\n      }\r\n    }\r\n\r\n    results.processed = totalAlerts;\r\n    results.failed = totalFailed;\r\n    results.message = `Sent ${totalAlerts} product performance alerts${totalFailed > 0 ? `, ${totalFailed} failed` : ''}`;\r\n\r\n    return results;\r\n  } catch (error: any) {\r\n    results.success = false;\r\n    results.message = `Error analyzing product performance: ${error.message}`;\r\n    results.errors?.push(error.message);\r\n    return results;\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\lib\\automations\\purchase-orders.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Product' is defined but never used. Allowed unused vars must match /^_/u.","line":7,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":15},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":65,"column":69,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":65,"endColumn":72,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1988,1991],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1988,1991],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":76,"column":68,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":76,"endColumn":71,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2400,2403],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2400,2403],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":153,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":153,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5215,5218],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5215,5218],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":164,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":164,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5571,5574],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5571,5574],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Automated Purchase Order Generation\r\n * Automatically generate purchase orders when stock hits reorder point\r\n */\r\n\r\nimport connectDB from '@/lib/mongodb';\r\nimport Product from '@/models/Product';\r\nimport Tenant from '@/models/Tenant';\r\nimport { getLowStockProducts } from '@/lib/stock';\r\nimport { sendEmail } from '@/lib/notifications';\r\nimport { getTenantSettingsById } from '@/lib/tenant';\r\nimport { AutomationResult } from './types';\r\n\r\nexport interface PurchaseOrderOptions {\r\n  tenantId?: string;\r\n  generateDocuments?: boolean; // Generate PDF/CSV documents\r\n  sendToSuppliers?: boolean; // Send to suppliers via email\r\n}\r\n\r\n/**\r\n * Generate purchase orders for products below reorder point\r\n */\r\nexport async function generatePurchaseOrders(\r\n  options: PurchaseOrderOptions = {}\r\n): Promise<AutomationResult> {\r\n  await connectDB();\r\n\r\n  const results: AutomationResult = {\r\n    success: true,\r\n    message: '',\r\n    processed: 0,\r\n    failed: 0,\r\n    errors: [],\r\n  };\r\n\r\n  try {\r\n    // Get tenants to process\r\n    let tenants;\r\n    if (options.tenantId) {\r\n      const tenant = await Tenant.findById(options.tenantId).lean();\r\n      tenants = tenant ? [tenant] : [];\r\n    } else {\r\n      tenants = await Tenant.find({ status: 'active' }).lean();\r\n    }\r\n\r\n    if (tenants.length === 0) {\r\n      results.message = 'No tenants found to process';\r\n      return results;\r\n    }\r\n\r\n    let totalOrders = 0;\r\n    let totalFailed = 0;\r\n\r\n    for (const tenant of tenants) {\r\n      try {\r\n        const tenantId = tenant._id.toString();\r\n        const tenantSettings = await getTenantSettingsById(tenantId);\r\n\r\n        // Get products that need reordering\r\n        // For now, we'll use low stock products as a proxy\r\n        // In production, you'd check reorderPoint field on Product\r\n        const lowStockProducts = await getLowStockProducts(tenantId);\r\n\r\n        // Group products that need reordering\r\n        const productsToReorder = lowStockProducts.filter((product: any) => {\r\n          // Check if product has reorderPoint set (if field exists)\r\n          // For now, we'll use products below threshold\r\n          return product.currentStock <= (product.threshold || 10);\r\n        });\r\n\r\n        if (productsToReorder.length === 0) {\r\n          continue;\r\n        }\r\n\r\n        // Generate purchase order data\r\n        const purchaseOrderItems = productsToReorder.map((product: any) => {\r\n          // Calculate reorder quantity (if reorderQuantity field exists, use it; otherwise suggest threshold * 2)\r\n          const reorderQuantity = product.reorderQuantity || ((product.threshold || 10) * 2);\r\n          \r\n          return {\r\n            productId: product._id,\r\n            name: product.name,\r\n            sku: product.sku || 'N/A',\r\n            currentStock: product.currentStock || 0,\r\n            reorderQuantity,\r\n            unitPrice: product.price || 0,\r\n            subtotal: (product.price || 0) * reorderQuantity,\r\n          };\r\n        });\r\n\r\n        const totalAmount = purchaseOrderItems.reduce((sum, item) => sum + item.subtotal, 0);\r\n        const orderDate = new Date();\r\n        const orderNumber = `PO-${orderDate.toISOString().split('T')[0].replace(/-/g, '')}-${Date.now().toString().slice(-6)}`;\r\n\r\n        // Generate purchase order document (CSV format for now)\r\n        const csvContent = [\r\n          ['Purchase Order', orderNumber],\r\n          ['Date', orderDate.toLocaleDateString()],\r\n          ['Tenant', tenant.name],\r\n          [],\r\n          ['Product Name', 'SKU', 'Current Stock', 'Reorder Quantity', 'Unit Price', 'Subtotal'],\r\n          ...purchaseOrderItems.map(item => [\r\n            item.name,\r\n            item.sku,\r\n            item.currentStock.toString(),\r\n            item.reorderQuantity.toString(),\r\n            item.unitPrice.toFixed(2),\r\n            item.subtotal.toFixed(2),\r\n          ]),\r\n          [],\r\n          ['Total Amount', totalAmount.toFixed(2)],\r\n        ].map(row => row.join(',')).join('\\n');\r\n\r\n        // Send to tenant email for approval\r\n        if (tenantSettings?.emailNotifications && tenantSettings?.email) {\r\n          const companyName = tenantSettings?.companyName || tenant.name || 'Business';\r\n          \r\n          const emailBody = `Purchase Order Generated for ${companyName}\r\n\r\nOrder Number: ${orderNumber}\r\nDate: ${orderDate.toLocaleDateString()}\r\n\r\nThe following products need to be reordered:\r\n\r\n${purchaseOrderItems.map(item => \r\n  `- ${item.name} (SKU: ${item.sku})\r\n  Current Stock: ${item.currentStock}\r\n  Reorder Quantity: ${item.reorderQuantity}\r\n  Unit Price: $${item.unitPrice.toFixed(2)}\r\n  Subtotal: $${item.subtotal.toFixed(2)}`\r\n).join('\\n\\n')}\r\n\r\nTotal Amount: $${totalAmount.toFixed(2)}\r\n\r\nPlease review and approve this purchase order.\r\n\r\nCSV Data:\r\n${csvContent}\r\n\r\nThis is an automated purchase order from your POS system.`;\r\n\r\n          await sendEmail({\r\n            to: tenantSettings.email,\r\n            subject: `Purchase Order Generated: ${orderNumber} - ${companyName}`,\r\n            message: emailBody,\r\n            type: 'email',\r\n          }).catch(() => {\r\n            // Don't fail if email fails\r\n          });\r\n\r\n          totalOrders++;\r\n        }\r\n      } catch (error: any) {\r\n        totalFailed++;\r\n        results.errors?.push(`Tenant ${tenant.name}: ${error.message}`);\r\n      }\r\n    }\r\n\r\n    results.processed = totalOrders;\r\n    results.failed = totalFailed;\r\n    results.message = `Generated ${totalOrders} purchase orders${totalFailed > 0 ? `, ${totalFailed} failed` : ''}`;\r\n\r\n    return results;\r\n  } catch (error: any) {\r\n    results.success = false;\r\n    results.message = `Error generating purchase orders: ${error.message}`;\r\n    results.errors?.push(error.message);\r\n    return results;\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\lib\\automations\\recurring-bookings.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Booking' is defined but never used. Allowed unused vars must match /^_/u.","line":7,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Tenant' is defined but never used. Allowed unused vars must match /^_/u.","line":8,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":14},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'options' is assigned a value but never used. Allowed unused args must match /^_/u.","line":22,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":22,"endColumn":10},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":43,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":43,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1329,1332],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1329,1332],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Recurring Booking Generation\r\n * Automatically create recurring bookings based on patterns\r\n */\r\n\r\nimport connectDB from '@/lib/mongodb';\r\nimport Booking from '@/models/Booking';\r\nimport Tenant from '@/models/Tenant';\r\nimport { AutomationResult } from './types';\r\n\r\nexport interface RecurringBookingOptions {\r\n  tenantId?: string;\r\n  daysAhead?: number; // How many days ahead to generate (default: 30)\r\n}\r\n\r\n/**\r\n * Generate recurring bookings\r\n * Note: This requires a RecurringBookingTemplate model which doesn't exist yet\r\n * This is a placeholder implementation that can be extended\r\n */\r\nexport async function generateRecurringBookings(\r\n  options: RecurringBookingOptions = {}\r\n): Promise<AutomationResult> {\r\n  await connectDB();\r\n\r\n  const results: AutomationResult = {\r\n    success: true,\r\n    message: '',\r\n    processed: 0,\r\n    failed: 0,\r\n    errors: [],\r\n  };\r\n\r\n  try {\r\n    // TODO: This automation requires a RecurringBookingTemplate model\r\n    // For now, we'll return a message indicating this needs to be implemented\r\n    // after the data model is created\r\n\r\n    results.message = 'Recurring booking generation requires RecurringBookingTemplate model. This feature needs to be implemented after adding the template data model.';\r\n    results.processed = 0;\r\n\r\n    return results;\r\n  } catch (error: any) {\r\n    results.success = false;\r\n    results.message = `Error generating recurring bookings: ${error.message}`;\r\n    results.errors?.push(error.message);\r\n    return results;\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\lib\\automations\\report-delivery.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":185,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":185,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5856,5859],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5856,5859],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":214,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":214,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6663,6666],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6663,6666],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":225,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":225,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7017,7020],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7017,7020],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Scheduled Report Generation and Delivery\r\n * Automatically generates and emails reports on schedule\r\n */\r\n\r\nimport connectDB from '@/lib/mongodb';\r\nimport Tenant from '@/models/Tenant';\r\nimport { sendEmail } from '@/lib/notifications';\r\nimport { getTenantSettingsById } from '@/lib/tenant';\r\nimport { getSalesReport } from '@/lib/analytics';\r\nimport { AutomationResult } from './types';\r\n\r\nexport interface ReportDeliveryOptions {\r\n  tenantId?: string;\r\n  reportType?: 'daily' | 'weekly' | 'monthly';\r\n  period?: 'daily' | 'weekly' | 'monthly';\r\n}\r\n\r\n/**\r\n * Generate and send sales report\r\n */\r\nexport async function sendSalesReport(\r\n  options: ReportDeliveryOptions = {}\r\n): Promise<AutomationResult> {\r\n  await connectDB();\r\n\r\n  const results: AutomationResult = {\r\n    success: true,\r\n    message: '',\r\n    processed: 0,\r\n    failed: 0,\r\n    errors: [],\r\n  };\r\n\r\n  try {\r\n    const period = options.period || 'daily';\r\n\r\n    // Get tenants to process\r\n    let tenants;\r\n    if (options.tenantId) {\r\n      const tenant = await Tenant.findById(options.tenantId).lean();\r\n      tenants = tenant ? [tenant] : [];\r\n    } else {\r\n      // Get all active tenants\r\n      tenants = await Tenant.find({ status: 'active' }).lean();\r\n    }\r\n\r\n    if (tenants.length === 0) {\r\n      results.message = 'No tenants found to process';\r\n      return results;\r\n    }\r\n\r\n    let totalProcessed = 0;\r\n    let totalFailed = 0;\r\n\r\n    for (const tenant of tenants) {\r\n      try {\r\n        const tenantSettings = await getTenantSettingsById(tenant._id.toString());\r\n\r\n        // Skip if email notifications disabled\r\n        if (!tenantSettings?.emailNotifications) {\r\n          continue;\r\n        }\r\n\r\n        // Get recipient email\r\n        const recipientEmail = tenantSettings?.email;\r\n        if (!recipientEmail) {\r\n          continue; // No email to send to\r\n        }\r\n\r\n        // Calculate date range based on period\r\n        const endDate = new Date();\r\n        let startDate: Date;\r\n\r\n        switch (period) {\r\n          case 'daily':\r\n            startDate = new Date(endDate);\r\n            startDate.setDate(startDate.getDate() - 1);\r\n            break;\r\n          case 'weekly':\r\n            startDate = new Date(endDate);\r\n            startDate.setDate(startDate.getDate() - 7);\r\n            break;\r\n          case 'monthly':\r\n            startDate = new Date(endDate);\r\n            startDate.setMonth(startDate.getMonth() - 1);\r\n            break;\r\n          default:\r\n            startDate = new Date(endDate);\r\n            startDate.setDate(startDate.getDate() - 1);\r\n        }\r\n\r\n        // Generate report\r\n        const report = await getSalesReport(\r\n          tenant._id.toString(),\r\n          period,\r\n          startDate,\r\n          endDate\r\n        );\r\n\r\n        // Format report data\r\n        const companyName = tenantSettings?.companyName || tenant.name || 'Business';\r\n        const periodLabel = period.charAt(0).toUpperCase() + period.slice(1);\r\n        const dateRange = `${startDate.toLocaleDateString()} - ${endDate.toLocaleDateString()}`;\r\n\r\n        // Build report HTML\r\n        const reportHtml = `\r\n<!DOCTYPE html>\r\n<html>\r\n<head>\r\n  <meta charset=\"UTF-8\">\r\n  <style>\r\n    body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }\r\n    .report { max-width: 800px; margin: 0 auto; padding: 20px; }\r\n    .header { text-align: center; border-bottom: 2px solid #000; padding-bottom: 10px; margin-bottom: 20px; }\r\n    .summary { background-color: #f4f4f4; padding: 15px; border-radius: 5px; margin-bottom: 20px; }\r\n    .summary-item { display: flex; justify-content: space-between; margin-bottom: 10px; }\r\n    .summary-item strong { font-size: 1.1em; }\r\n    table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }\r\n    th, td { padding: 10px; text-align: left; border-bottom: 1px solid #ddd; }\r\n    th { background-color: #f4f4f4; font-weight: bold; }\r\n    .footer { text-align: center; margin-top: 20px; font-size: 12px; color: #666; }\r\n  </style>\r\n</head>\r\n<body>\r\n  <div class=\"report\">\r\n    <div class=\"header\">\r\n      <h2>${periodLabel} Sales Report</h2>\r\n      <p>${companyName}</p>\r\n      <p>${dateRange}</p>\r\n    </div>\r\n\r\n    <div class=\"summary\">\r\n      <div class=\"summary-item\">\r\n        <span><strong>Total Sales:</strong></span>\r\n        <span><strong>${report.totalSales?.toFixed(2) || '0.00'}</strong></span>\r\n      </div>\r\n      <div class=\"summary-item\">\r\n        <span>Total Transactions:</span>\r\n        <span>${report.totalTransactions || 0}</span>\r\n      </div>\r\n      <div class=\"summary-item\">\r\n        <span>Average Transaction:</span>\r\n        <span>${report.averageTransaction?.toFixed(2) || '0.00'}</span>\r\n      </div>\r\n    </div>\r\n\r\n    ${report.salesByPaymentMethod ? `\r\n    <h3>Sales by Payment Method</h3>\r\n    <table>\r\n      <thead>\r\n        <tr>\r\n          <th>Payment Method</th>\r\n          <th style=\"text-align: right;\">Amount</th>\r\n        </tr>\r\n      </thead>\r\n      <tbody>\r\n        <tr>\r\n          <td>Cash</td>\r\n          <td style=\"text-align: right;\">${report.salesByPaymentMethod.cash?.toFixed(2) || '0.00'}</td>\r\n        </tr>\r\n        <tr>\r\n          <td>Card</td>\r\n          <td style=\"text-align: right;\">${report.salesByPaymentMethod.card?.toFixed(2) || '0.00'}</td>\r\n        </tr>\r\n        <tr>\r\n          <td>Digital</td>\r\n          <td style=\"text-align: right;\">${report.salesByPaymentMethod.digital?.toFixed(2) || '0.00'}</td>\r\n        </tr>\r\n      </tbody>\r\n    </table>\r\n    ` : ''}\r\n\r\n    ${report.salesByDay && report.salesByDay.length > 0 ? `\r\n    <h3>Daily Breakdown</h3>\r\n    <table>\r\n      <thead>\r\n        <tr>\r\n          <th>Date</th>\r\n          <th style=\"text-align: right;\">Sales</th>\r\n          <th style=\"text-align: right;\">Transactions</th>\r\n        </tr>\r\n      </thead>\r\n      <tbody>\r\n        ${report.salesByDay.map((item: any) => `\r\n        <tr>\r\n          <td>${new Date(item.date).toLocaleDateString()}</td>\r\n          <td style=\"text-align: right;\">${item.sales?.toFixed(2) || '0.00'}</td>\r\n          <td style=\"text-align: right;\">${item.transactions || 0}</td>\r\n        </tr>\r\n        `).join('')}\r\n      </tbody>\r\n    </table>\r\n    ` : ''}\r\n\r\n    <div class=\"footer\">\r\n      <p>This is an automated report from your POS system.</p>\r\n      <p>Generated on ${new Date().toLocaleString()}</p>\r\n    </div>\r\n  </div>\r\n</body>\r\n</html>\r\n        `.trim();\r\n\r\n        // Send email\r\n        await sendEmail({\r\n          to: recipientEmail,\r\n          subject: `${periodLabel} Sales Report - ${companyName}`,\r\n          message: reportHtml,\r\n          type: 'email',\r\n        });\r\n\r\n        totalProcessed++;\r\n      } catch (error: any) {\r\n        totalFailed++;\r\n        results.errors?.push(`Tenant ${tenant.name}: ${error.message}`);\r\n      }\r\n    }\r\n\r\n    results.processed = totalProcessed;\r\n    results.failed = totalFailed;\r\n    results.message = `Processed ${totalProcessed} reports${totalFailed > 0 ? `, ${totalFailed} failed` : ''}`;\r\n\r\n    return results;\r\n  } catch (error: any) {\r\n    results.success = false;\r\n    results.message = `Error sending reports: ${error.message}`;\r\n    results.errors?.push(error.message);\r\n    return results;\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\lib\\automations\\sales-trend-analysis.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":205,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":205,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7237,7240],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7237,7240],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":216,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":216,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7602,7605],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7602,7605],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Automated Sales Trend Analysis\r\n * Analyze sales trends and send insights\r\n */\r\n\r\nimport connectDB from '@/lib/mongodb';\r\nimport Transaction from '@/models/Transaction';\r\nimport Tenant from '@/models/Tenant';\r\nimport mongoose from 'mongoose';\r\nimport { sendEmail } from '@/lib/notifications';\r\nimport { getTenantSettingsById } from '@/lib/tenant';\r\nimport { AutomationResult } from './types';\r\n\r\nexport interface SalesTrendAnalysisOptions {\r\n  tenantId?: string;\r\n  period?: 'daily' | 'weekly' | 'monthly';\r\n  comparePeriods?: boolean; // Compare with previous period\r\n}\r\n\r\n/**\r\n * Analyze sales trends and send insights\r\n */\r\nexport async function analyzeSalesTrends(\r\n  options: SalesTrendAnalysisOptions = {}\r\n): Promise<AutomationResult> {\r\n  await connectDB();\r\n\r\n  const results: AutomationResult = {\r\n    success: true,\r\n    message: '',\r\n    processed: 0,\r\n    failed: 0,\r\n    errors: [],\r\n  };\r\n\r\n  try {\r\n    const period = options.period || 'weekly';\r\n    const comparePeriods = options.comparePeriods !== false;\r\n\r\n    // Get tenants to process\r\n    let tenants;\r\n    if (options.tenantId) {\r\n      const tenant = await Tenant.findById(options.tenantId).lean();\r\n      tenants = tenant ? [tenant] : [];\r\n    } else {\r\n      tenants = await Tenant.find({ status: 'active' }).lean();\r\n    }\r\n\r\n    if (tenants.length === 0) {\r\n      results.message = 'No tenants found to process';\r\n      return results;\r\n    }\r\n\r\n    let totalAnalyses = 0;\r\n    let totalFailed = 0;\r\n\r\n    for (const tenant of tenants) {\r\n      try {\r\n        const tenantId = tenant._id.toString();\r\n        const tenantSettings = await getTenantSettingsById(tenantId);\r\n\r\n        // Skip if notifications disabled\r\n        if (!tenantSettings?.emailNotifications) {\r\n          continue;\r\n        }\r\n\r\n        const now = new Date();\r\n        let currentPeriodStart: Date;\r\n        const currentPeriodEnd: Date = now;\r\n        let previousPeriodStart: Date;\r\n        let previousPeriodEnd: Date;\r\n\r\n        // Calculate period dates\r\n        switch (period) {\r\n          case 'daily':\r\n            currentPeriodStart = new Date(now);\r\n            currentPeriodStart.setHours(0, 0, 0, 0);\r\n            previousPeriodStart = new Date(currentPeriodStart);\r\n            previousPeriodStart.setDate(previousPeriodStart.getDate() - 1);\r\n            previousPeriodEnd = new Date(currentPeriodStart);\r\n            break;\r\n          case 'weekly':\r\n            const dayOfWeek = now.getDay();\r\n            currentPeriodStart = new Date(now);\r\n            currentPeriodStart.setDate(currentPeriodStart.getDate() - dayOfWeek);\r\n            currentPeriodStart.setHours(0, 0, 0, 0);\r\n            previousPeriodStart = new Date(currentPeriodStart);\r\n            previousPeriodStart.setDate(previousPeriodStart.getDate() - 7);\r\n            previousPeriodEnd = new Date(currentPeriodStart);\r\n            break;\r\n          case 'monthly':\r\n            currentPeriodStart = new Date(now.getFullYear(), now.getMonth(), 1);\r\n            previousPeriodStart = new Date(now.getFullYear(), now.getMonth() - 1, 1);\r\n            previousPeriodEnd = new Date(now.getFullYear(), now.getMonth(), 0);\r\n            break;\r\n        }\r\n\r\n        // Get current period sales\r\n        const currentSales = await Transaction.aggregate([\r\n          {\r\n            $match: {\r\n              tenantId: new mongoose.Types.ObjectId(tenantId),\r\n              createdAt: { $gte: currentPeriodStart, $lte: currentPeriodEnd },\r\n              status: 'completed',\r\n            },\r\n          },\r\n          {\r\n            $group: {\r\n              _id: null,\r\n              totalSales: { $sum: '$total' },\r\n              transactionCount: { $sum: 1 },\r\n              avgTransaction: { $avg: '$total' },\r\n            },\r\n          },\r\n        ]);\r\n\r\n        const currentData = currentSales[0] || {\r\n          totalSales: 0,\r\n          transactionCount: 0,\r\n          avgTransaction: 0,\r\n        };\r\n\r\n        let previousData = null;\r\n        if (comparePeriods) {\r\n          const previousSales = await Transaction.aggregate([\r\n            {\r\n              $match: {\r\n                tenantId: new mongoose.Types.ObjectId(tenantId),\r\n                createdAt: { $gte: previousPeriodStart, $lte: previousPeriodEnd },\r\n                status: 'completed',\r\n              },\r\n            },\r\n            {\r\n              $group: {\r\n                _id: null,\r\n                totalSales: { $sum: '$total' },\r\n                transactionCount: { $sum: 1 },\r\n                avgTransaction: { $avg: '$total' },\r\n              },\r\n            },\r\n          ]);\r\n\r\n          previousData = previousSales[0] || {\r\n            totalSales: 0,\r\n            transactionCount: 0,\r\n            avgTransaction: 0,\r\n          };\r\n        }\r\n\r\n        // Calculate trends\r\n        let trendAnalysis = '';\r\n        let salesChange = 0;\r\n        let salesChangePercent = '0';\r\n        \r\n        if (previousData) {\r\n          salesChange = currentData.totalSales - previousData.totalSales;\r\n          salesChangePercent = previousData.totalSales > 0\r\n            ? ((salesChange / previousData.totalSales) * 100).toFixed(1)\r\n            : '0';\r\n\r\n          const transactionChange = currentData.transactionCount - previousData.transactionCount;\r\n          const transactionChangePercent = previousData.transactionCount > 0\r\n            ? ((transactionChange / previousData.transactionCount) * 100).toFixed(1)\r\n            : '0';\r\n\r\n          const salesChangeNum = parseFloat(salesChangePercent || '0');\r\n          trendAnalysis = `\r\nCOMPARISON WITH PREVIOUS ${period.toUpperCase()}:\r\n\r\nSales: ${salesChange >= 0 ? '+' : ''}$${salesChange.toFixed(2)} (${salesChangePercent}%)\r\nTransactions: ${transactionChange >= 0 ? '+' : ''}${transactionChange} (${transactionChangePercent}%)\r\n\r\n${salesChangeNum > 0 ? ' Sales are increasing!' : salesChangeNum < 0 ? ' Sales are decreasing' : ' Sales are stable'}\r\n`;\r\n        }\r\n\r\n        const companyName = tenantSettings?.companyName || tenant.name || 'Business';\r\n        const emailBody = `${period.toUpperCase()} Sales Trend Analysis for ${companyName}\r\n\r\nCurrent Period: ${currentPeriodStart.toLocaleDateString()} - ${currentPeriodEnd.toLocaleDateString()}\r\n\r\nCURRENT PERIOD STATISTICS:\r\n- Total Sales: $${currentData.totalSales.toFixed(2)}\r\n- Transaction Count: ${currentData.transactionCount}\r\n- Average Transaction: $${currentData.avgTransaction.toFixed(2)}\r\n${trendAnalysis}\r\n\r\n${previousData && parseFloat(salesChangePercent || '0') > 0 ? ' Suggestion: Consider increasing inventory for high-performing products.' : ''}\r\n${previousData && parseFloat(salesChangePercent || '0') < 0 ? ' Suggestion: Review marketing strategies and consider promotions.' : ''}\r\n\r\nThis is an automated sales trend analysis from your POS system.`;\r\n\r\n        if (tenantSettings.email) {\r\n          await sendEmail({\r\n            to: tenantSettings.email,\r\n            subject: `${period.charAt(0).toUpperCase() + period.slice(1)} Sales Trend Analysis - ${companyName}`,\r\n            message: emailBody,\r\n            type: 'email',\r\n          }).catch(() => {\r\n            // Don't fail if email fails\r\n          });\r\n        }\r\n\r\n        totalAnalyses++;\r\n      } catch (error: any) {\r\n        totalFailed++;\r\n        results.errors?.push(`Tenant ${tenant.name}: ${error.message}`);\r\n      }\r\n    }\r\n\r\n    results.processed = totalAnalyses;\r\n    results.failed = totalFailed;\r\n    results.message = `Generated ${totalAnalyses} sales trend analyses${totalFailed > 0 ? `, ${totalFailed} failed` : ''}`;\r\n\r\n    return results;\r\n  } catch (error: any) {\r\n    results.success = false;\r\n    results.message = `Error analyzing sales trends: ${error.message}`;\r\n    results.errors?.push(error.message);\r\n    return results;\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\lib\\automations\\session-expiration.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":92,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":92,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2994,2997],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2994,2997],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":97,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":97,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3149,3152],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3149,3152],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":108,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":108,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3578,3581],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3578,3581],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Automatic Session Expiration\r\n * Enhanced session management with activity tracking\r\n */\r\n\r\nimport connectDB from '@/lib/mongodb';\r\nimport AuditLog from '@/models/AuditLog';\r\nimport User from '@/models/User';\r\nimport Tenant from '@/models/Tenant';\r\nimport { AutomationResult } from './types';\r\n\r\nexport interface SessionExpirationOptions {\r\n  tenantId?: string;\r\n  inactivityHours?: number; // Hours of inactivity before expiration (default: 24)\r\n}\r\n\r\n/**\r\n * Check for expired sessions based on inactivity\r\n * Note: This is a simplified implementation using audit logs\r\n * In production, you might want a dedicated session tracking system\r\n */\r\nexport async function expireInactiveSessions(\r\n  options: SessionExpirationOptions = {}\r\n): Promise<AutomationResult> {\r\n  await connectDB();\r\n\r\n  const results: AutomationResult = {\r\n    success: true,\r\n    message: '',\r\n    processed: 0,\r\n    failed: 0,\r\n    errors: [],\r\n  };\r\n\r\n  try {\r\n    const inactivityHours = options.inactivityHours || 24;\r\n    const cutoffTime = new Date(Date.now() - inactivityHours * 60 * 60 * 1000);\r\n\r\n    // Get tenants to process\r\n    let tenants;\r\n    if (options.tenantId) {\r\n      const tenant = await Tenant.findById(options.tenantId).lean();\r\n      tenants = tenant ? [tenant] : [];\r\n    } else {\r\n      tenants = await Tenant.find({ status: 'active' }).lean();\r\n    }\r\n\r\n    if (tenants.length === 0) {\r\n      results.message = 'No tenants found to process';\r\n      return results;\r\n    }\r\n\r\n    let totalExpired = 0;\r\n    let totalFailed = 0;\r\n\r\n    for (const tenant of tenants) {\r\n      try {\r\n        const tenantId = tenant._id.toString();\r\n\r\n        // Get all active users\r\n        const users = await User.find({ tenantId, isActive: true }).lean();\r\n\r\n        for (const user of users) {\r\n          try {\r\n            // Get last activity from audit logs\r\n            const lastActivity = await AuditLog.findOne({\r\n              tenantId,\r\n              userId: user._id,\r\n            })\r\n              .sort({ createdAt: -1 })\r\n              .lean();\r\n\r\n            if (!lastActivity) {\r\n              // No activity logged, check lastLogin\r\n              if (user.lastLogin && new Date(user.lastLogin) < cutoffTime) {\r\n                // User has been inactive, but we can't invalidate JWT tokens\r\n                // This would require a token blacklist or session store\r\n                // For now, we'll just log it\r\n                totalExpired++;\r\n              }\r\n              continue;\r\n            }\r\n\r\n            // Check if last activity is before cutoff\r\n            if (new Date(lastActivity.createdAt) < cutoffTime) {\r\n              // Session expired due to inactivity\r\n              // Note: JWT tokens can't be invalidated server-side without a blacklist\r\n              // This automation would work better with a session store or token blacklist\r\n              // For now, we'll track it in results\r\n              totalExpired++;\r\n            }\r\n          } catch (error: any) {\r\n            totalFailed++;\r\n            results.errors?.push(`User ${user._id}: ${error.message}`);\r\n          }\r\n        }\r\n      } catch (error: any) {\r\n        totalFailed++;\r\n        results.errors?.push(`Tenant ${tenant.name}: ${error.message}`);\r\n      }\r\n    }\r\n\r\n    results.processed = totalExpired;\r\n    results.failed = totalFailed;\r\n    results.message = `Found ${totalExpired} expired sessions${totalFailed > 0 ? `, ${totalFailed} failed` : ''}. Note: JWT tokens require a blacklist system for full session expiration.`;\r\n\r\n    return results;\r\n  } catch (error: any) {\r\n    results.success = false;\r\n    results.message = `Error checking session expiration: ${error.message}`;\r\n    results.errors?.push(error.message);\r\n    return results;\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\lib\\automations\\stock-transfer.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":85,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":85,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2646,2649],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2646,2649],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":127,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":127,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4522,4525],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4522,4525],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":135,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":135,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4877,4880],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4877,4880],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":201,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":201,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7457,7460],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7457,7460],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":206,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":206,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7618,7621],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7618,7621],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":217,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":217,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8011,8014],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8011,8014],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Automated Stock Transfer Between Branches\r\n * Automatically transfer stock from well-stocked branches to low-stock branches\r\n */\r\n\r\nimport connectDB from '@/lib/mongodb';\r\nimport Product from '@/models/Product';\r\nimport Branch from '@/models/Branch';\r\nimport StockMovement from '@/models/StockMovement';\r\nimport Tenant from '@/models/Tenant';\r\nimport { sendEmail } from '@/lib/notifications';\r\nimport { getTenantSettingsById } from '@/lib/tenant';\r\nimport { AutomationResult } from './types';\r\nimport mongoose from 'mongoose';\r\n\r\nexport interface StockTransferOptions {\r\n  tenantId?: string;\r\n  autoApprove?: boolean; // Auto-approve transfers (default: false - requires approval)\r\n  minStockThreshold?: number; // Minimum stock to trigger transfer (default: 5)\r\n}\r\n\r\n/**\r\n * Detect stock imbalances and create transfer requests\r\n */\r\nexport async function detectStockImbalances(\r\n  options: StockTransferOptions = {}\r\n): Promise<AutomationResult> {\r\n  await connectDB();\r\n\r\n  const results: AutomationResult = {\r\n    success: true,\r\n    message: '',\r\n    processed: 0,\r\n    failed: 0,\r\n    errors: [],\r\n  };\r\n\r\n  try {\r\n    const minStockThreshold = options.minStockThreshold || 5;\r\n    const autoApprove = options.autoApprove || false;\r\n\r\n    // Get tenants to process\r\n    let tenants;\r\n    if (options.tenantId) {\r\n      const tenant = await Tenant.findById(options.tenantId).lean();\r\n      tenants = tenant ? [tenant] : [];\r\n    } else {\r\n      tenants = await Tenant.find({ status: 'active' }).lean();\r\n    }\r\n\r\n    if (tenants.length === 0) {\r\n      results.message = 'No tenants found to process';\r\n      return results;\r\n    }\r\n\r\n    let totalTransfers = 0;\r\n    let totalFailed = 0;\r\n\r\n    for (const tenant of tenants) {\r\n      try {\r\n        const tenantId = tenant._id.toString();\r\n        const tenantSettings = await getTenantSettingsById(tenantId);\r\n\r\n        // Get all branches for this tenant\r\n        const branches = await Branch.find({ tenantId, isActive: true }).lean();\r\n        \r\n        if (branches.length < 2) {\r\n          continue; // Need at least 2 branches for transfers\r\n        }\r\n\r\n        // Get all products with branch stock\r\n        const products = await Product.find({\r\n          tenantId,\r\n          trackInventory: true,\r\n          branchStock: { $exists: true, $ne: [] },\r\n        }).lean();\r\n\r\n        for (const product of products) {\r\n          try {\r\n            if (!product.branchStock || product.branchStock.length < 2) {\r\n              continue;\r\n            }\r\n\r\n            // Find branches with low stock and high stock\r\n            const branchStocks = product.branchStock.map((bs: any) => ({\r\n              branchId: bs.branchId.toString(),\r\n              stock: bs.stock || 0,\r\n            }));\r\n\r\n            // Sort by stock level\r\n            branchStocks.sort((a, b) => a.stock - b.stock);\r\n\r\n            const lowStockBranches = branchStocks.filter(bs => bs.stock <= minStockThreshold);\r\n            const highStockBranches = branchStocks.filter(bs => bs.stock > minStockThreshold * 3);\r\n\r\n            if (lowStockBranches.length === 0 || highStockBranches.length === 0) {\r\n              continue; // No imbalance\r\n            }\r\n\r\n            // Create transfer requests\r\n            for (const lowStock of lowStockBranches.slice(0, 2)) { // Limit to 2 transfers per product\r\n              const highStock = highStockBranches[highStockBranches.length - 1]; // Use highest stock branch\r\n              \r\n              const transferQuantity = Math.min(\r\n                Math.ceil((minStockThreshold * 2 - lowStock.stock) / 2), // Transfer enough to bring to 2x threshold\r\n                Math.floor(highStock.stock / 2) // Don't take more than half from source\r\n              );\r\n\r\n              if (transferQuantity <= 0) {\r\n                continue;\r\n              }\r\n\r\n              // Get branch names\r\n              const fromBranch = branches.find(b => b._id.toString() === highStock.branchId);\r\n              const toBranch = branches.find(b => b._id.toString() === lowStock.branchId);\r\n\r\n              if (!fromBranch || !toBranch) {\r\n                continue;\r\n              }\r\n\r\n              if (autoApprove) {\r\n                // Auto-transfer (update stock)\r\n                const productDoc = await Product.findById(product._id);\r\n                if (productDoc && productDoc.branchStock) {\r\n                  // Update source branch stock\r\n                  const fromBranchStock = productDoc.branchStock.find(\r\n                    (bs: any) => bs.branchId.toString() === highStock.branchId\r\n                  );\r\n                  if (fromBranchStock) {\r\n                    fromBranchStock.stock -= transferQuantity;\r\n                  }\r\n\r\n                  // Update destination branch stock\r\n                  const toBranchStock = productDoc.branchStock.find(\r\n                    (bs: any) => bs.branchId.toString() === lowStock.branchId\r\n                  );\r\n                  if (toBranchStock) {\r\n                    toBranchStock.stock += transferQuantity;\r\n                  } else {\r\n                    // Add new branch stock entry\r\n                    productDoc.branchStock.push({\r\n                      branchId: new mongoose.Types.ObjectId(lowStock.branchId),\r\n                      stock: transferQuantity,\r\n                    });\r\n                  }\r\n\r\n                  await productDoc.save();\r\n\r\n                  // Create stock movement records\r\n                  await StockMovement.create({\r\n                    productId: product._id,\r\n                    tenantId,\r\n                    branchId: fromBranch._id,\r\n                    quantity: -transferQuantity,\r\n                    reason: `Auto-transfer to ${toBranch.name}`,\r\n                    type: 'transfer-out',\r\n                  });\r\n\r\n                  await StockMovement.create({\r\n                    productId: product._id,\r\n                    tenantId,\r\n                    branchId: toBranch._id,\r\n                    quantity: transferQuantity,\r\n                    reason: `Auto-transfer from ${fromBranch.name}`,\r\n                    type: 'transfer-in',\r\n                  });\r\n                }\r\n              } else {\r\n                // Create transfer request (notification only for now)\r\n                // In production, you might want a TransferRequest model\r\n                if (tenantSettings?.emailNotifications && tenantSettings?.email) {\r\n                  const companyName = tenantSettings?.companyName || tenant.name || 'Business';\r\n                  \r\n                  await sendEmail({\r\n                    to: tenantSettings.email,\r\n                    subject: `Stock Transfer Request: ${product.name}`,\r\n                    message: `Stock Transfer Request for ${companyName}\r\n\r\nProduct: ${product.name}${product.sku ? ` (SKU: ${product.sku})` : ''}\r\n\r\nFrom: ${fromBranch.name}\r\nCurrent Stock: ${highStock.stock}\r\nTransfer Quantity: ${transferQuantity}\r\n\r\nTo: ${toBranch.name}\r\nCurrent Stock: ${lowStock.stock}\r\nAfter Transfer: ${lowStock.stock + transferQuantity}\r\n\r\nPlease review and approve this transfer request.\r\n\r\nThis is an automated stock transfer request from your POS system.`,\r\n                    type: 'email',\r\n                  }).catch(() => {\r\n                    // Don't fail if email fails\r\n                  });\r\n                }\r\n              }\r\n\r\n              totalTransfers++;\r\n            }\r\n          } catch (error: any) {\r\n            totalFailed++;\r\n            results.errors?.push(`Product ${product._id}: ${error.message}`);\r\n          }\r\n        }\r\n      } catch (error: any) {\r\n        totalFailed++;\r\n        results.errors?.push(`Tenant ${tenant.name}: ${error.message}`);\r\n      }\r\n    }\r\n\r\n    results.processed = totalTransfers;\r\n    results.failed = totalFailed;\r\n    results.message = `${autoApprove ? 'Processed' : 'Created'} ${totalTransfers} stock transfers${totalFailed > 0 ? `, ${totalFailed} failed` : ''}`;\r\n\r\n    return results;\r\n  } catch (error: any) {\r\n    results.success = false;\r\n    results.message = `Error detecting stock imbalances: ${error.message}`;\r\n    results.errors?.push(error.message);\r\n    return results;\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\lib\\automations\\suspicious-activity.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":156,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":156,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5374,5377],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5374,5377],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":167,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":167,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5742,5745],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5742,5745],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Suspicious Activity Detection\r\n * Detect and alert on suspicious patterns\r\n */\r\n\r\nimport connectDB from '@/lib/mongodb';\r\nimport Transaction from '@/models/Transaction';\r\nimport CashDrawerSession from '@/models/CashDrawerSession';\r\nimport AuditLog from '@/models/AuditLog';\r\nimport Tenant from '@/models/Tenant';\r\nimport { sendEmail } from '@/lib/notifications';\r\nimport { getTenantSettingsById } from '@/lib/tenant';\r\nimport { AutomationResult } from './types';\r\n\r\nexport interface SuspiciousActivityOptions {\r\n  tenantId?: string;\r\n  refundThreshold?: number; // Number of refunds to trigger alert (default: 5 per day)\r\n  voidThreshold?: number; // Number of voids to trigger alert (default: 10 per day)\r\n  discountThreshold?: number; // Discount amount to trigger alert (default: $100)\r\n  failedLoginThreshold?: number; // Failed logins to trigger alert (default: 5)\r\n}\r\n\r\n/**\r\n * Detect suspicious activity patterns\r\n */\r\nexport async function detectSuspiciousActivity(\r\n  options: SuspiciousActivityOptions = {}\r\n): Promise<AutomationResult> {\r\n  await connectDB();\r\n\r\n  const results: AutomationResult = {\r\n    success: true,\r\n    message: '',\r\n    processed: 0,\r\n    failed: 0,\r\n    errors: [],\r\n  };\r\n\r\n  try {\r\n    const refundThreshold = options.refundThreshold || 5;\r\n    const voidThreshold = options.voidThreshold || 10;\r\n    const discountThreshold = options.discountThreshold || 100;\r\n    const failedLoginThreshold = options.failedLoginThreshold || 5;\r\n\r\n    const today = new Date();\r\n    today.setHours(0, 0, 0, 0);\r\n\r\n    // Get tenants to process\r\n    let tenants;\r\n    if (options.tenantId) {\r\n      const tenant = await Tenant.findById(options.tenantId).lean();\r\n      tenants = tenant ? [tenant] : [];\r\n    } else {\r\n      tenants = await Tenant.find({ status: 'active' }).lean();\r\n    }\r\n\r\n    if (tenants.length === 0) {\r\n      results.message = 'No tenants found to process';\r\n      return results;\r\n    }\r\n\r\n    let totalAlerts = 0;\r\n    let totalFailed = 0;\r\n\r\n    for (const tenant of tenants) {\r\n      try {\r\n        const tenantId = tenant._id.toString();\r\n        const tenantSettings = await getTenantSettingsById(tenantId);\r\n\r\n        const suspiciousActivities: string[] = [];\r\n\r\n        // Check for excessive refunds\r\n        const refundsToday = await Transaction.countDocuments({\r\n          tenantId,\r\n          status: 'refunded',\r\n          updatedAt: { $gte: today },\r\n        });\r\n\r\n        if (refundsToday >= refundThreshold) {\r\n          suspiciousActivities.push(`Excessive refunds: ${refundsToday} refunds today (threshold: ${refundThreshold})`);\r\n        }\r\n\r\n        // Check for excessive voids/cancellations\r\n        const voidsToday = await Transaction.countDocuments({\r\n          tenantId,\r\n          status: 'cancelled',\r\n          createdAt: { $gte: today },\r\n        });\r\n\r\n        if (voidsToday >= voidThreshold) {\r\n          suspiciousActivities.push(`Excessive voids: ${voidsToday} cancelled transactions today (threshold: ${voidThreshold})`);\r\n        }\r\n\r\n        // Check for large discounts\r\n        const largeDiscounts = await Transaction.find({\r\n          tenantId,\r\n          discountAmount: { $gte: discountThreshold },\r\n          createdAt: { $gte: today },\r\n        }).lean();\r\n\r\n        if (largeDiscounts.length > 0) {\r\n          suspiciousActivities.push(`Large discounts detected: ${largeDiscounts.length} transactions with discounts >= $${discountThreshold}`);\r\n        }\r\n\r\n        // Check for failed login attempts\r\n        const failedLogins = await AuditLog.countDocuments({\r\n          tenantId,\r\n          action: 'LOGIN',\r\n          'metadata.success': false,\r\n          createdAt: { $gte: today },\r\n        });\r\n\r\n        if (failedLogins >= failedLoginThreshold) {\r\n          suspiciousActivities.push(`Multiple failed login attempts: ${failedLogins} failed logins today (threshold: ${failedLoginThreshold})`);\r\n        }\r\n\r\n        // Check for cash drawer discrepancies\r\n        const drawersWithDiscrepancies = await CashDrawerSession.find({\r\n          tenantId,\r\n          closingTime: { $gte: today },\r\n          $or: [\r\n            { shortage: { $gte: 50 } },\r\n            { overage: { $gte: 100 } },\r\n          ],\r\n        }).lean();\r\n\r\n        if (drawersWithDiscrepancies.length > 0) {\r\n          suspiciousActivities.push(`Cash drawer discrepancies: ${drawersWithDiscrepancies.length} drawers with significant shortages/overages`);\r\n        }\r\n\r\n        // Send alert if suspicious activities found\r\n        if (suspiciousActivities.length > 0 && tenantSettings?.emailNotifications && tenantSettings?.email) {\r\n          const companyName = tenantSettings?.companyName || tenant.name || 'Business';\r\n          \r\n          await sendEmail({\r\n            to: tenantSettings.email,\r\n            subject: ` Suspicious Activity Alert - ${companyName}`,\r\n            message: `Suspicious Activity Detected for ${companyName}\r\n\r\nDate: ${today.toLocaleDateString()}\r\n\r\nThe following suspicious activities were detected:\r\n\r\n${suspiciousActivities.map(activity => `- ${activity}`).join('\\n')}\r\n\r\nPlease review these activities immediately.\r\n\r\nThis is an automated security alert from your POS system.`,\r\n            type: 'email',\r\n          }).catch(() => {\r\n            // Don't fail if email fails\r\n          });\r\n\r\n          totalAlerts++;\r\n        }\r\n      } catch (error: any) {\r\n        totalFailed++;\r\n        results.errors?.push(`Tenant ${tenant.name}: ${error.message}`);\r\n      }\r\n    }\r\n\r\n    results.processed = totalAlerts;\r\n    results.failed = totalFailed;\r\n    results.message = `Detected ${totalAlerts} suspicious activity patterns${totalFailed > 0 ? `, ${totalFailed} failed` : ''}`;\r\n\r\n    return results;\r\n  } catch (error: any) {\r\n    results.success = false;\r\n    results.message = `Error detecting suspicious activity: ${error.message}`;\r\n    results.errors?.push(error.message);\r\n    return results;\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\lib\\automations\\transaction-receipts.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Tenant' is defined but never used. Allowed unused vars must match /^_/u.","line":8,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":14},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":167,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":167,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5939,5942],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5939,5942],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":200,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":200,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6915,6918],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6915,6918],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":235,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":235,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7829,7832],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7829,7832],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":246,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":246,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8163,8166],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8163,8166],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Transaction Receipt Auto-Email\r\n * Automatically emails receipts for transactions\r\n */\r\n\r\nimport connectDB from '@/lib/mongodb';\r\nimport Transaction from '@/models/Transaction';\r\nimport Tenant from '@/models/Tenant';\r\nimport { sendEmail } from '@/lib/notifications';\r\nimport { getTenantSettingsById } from '@/lib/tenant';\r\nimport { formatDate, formatTime } from '@/lib/formatting';\r\nimport { formatCurrency } from '@/lib/currency';\r\nimport { AutomationResult } from './types';\r\n\r\nexport interface TransactionReceiptOptions {\r\n  tenantId?: string;\r\n  transactionId?: string;\r\n  customerEmail?: string;\r\n}\r\n\r\n/**\r\n * Send receipt email for a specific transaction\r\n */\r\nexport async function sendTransactionReceipt(\r\n  options: TransactionReceiptOptions\r\n): Promise<AutomationResult> {\r\n  await connectDB();\r\n\r\n  const results: AutomationResult = {\r\n    success: true,\r\n    message: '',\r\n    processed: 0,\r\n    failed: 0,\r\n    errors: [],\r\n  };\r\n\r\n  try {\r\n    if (!options.transactionId) {\r\n      results.success = false;\r\n      results.message = 'Transaction ID is required';\r\n      return results;\r\n    }\r\n\r\n    const transaction = await Transaction.findById(options.transactionId)\r\n      .populate('tenantId')\r\n      .lean();\r\n\r\n    if (!transaction) {\r\n      results.success = false;\r\n      results.message = 'Transaction not found';\r\n      return results;\r\n    }\r\n\r\n    const tenantId = transaction.tenantId.toString();\r\n    const tenantSettings = await getTenantSettingsById(tenantId);\r\n\r\n    // Check if email notifications are enabled\r\n    if (!tenantSettings?.emailNotifications) {\r\n      results.message = 'Email notifications disabled for this tenant';\r\n      return results;\r\n    }\r\n\r\n    // Get customer email (from transaction notes or options)\r\n    const customerEmail = options.customerEmail || transaction.notes?.match(/email[:\\s]+([^\\s]+)/i)?.[1];\r\n\r\n    if (!customerEmail) {\r\n      results.message = 'Customer email not found';\r\n      return results;\r\n    }\r\n\r\n    // Generate receipt content\r\n    const companyName = tenantSettings?.companyName || 'Business';\r\n    const receiptNumber = transaction.receiptNumber || transaction._id.toString().slice(-8);\r\n    const formattedDate = formatDate(transaction.createdAt, tenantSettings);\r\n    const formattedTime = formatTime(transaction.createdAt, tenantSettings);\r\n\r\n    // Build receipt HTML\r\n    const itemsList = transaction.items\r\n      .map(\r\n        (item) =>\r\n          `  <tr>\r\n    <td>${item.name}</td>\r\n    <td style=\"text-align: center;\">${item.quantity}</td>\r\n    <td style=\"text-align: right;\">${formatCurrency(item.price, tenantSettings)}</td>\r\n    <td style=\"text-align: right;\">${formatCurrency(item.subtotal, tenantSettings)}</td>\r\n  </tr>`\r\n      )\r\n      .join('\\n');\r\n\r\n    const receiptHtml = `\r\n<!DOCTYPE html>\r\n<html>\r\n<head>\r\n  <meta charset=\"UTF-8\">\r\n  <style>\r\n    body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }\r\n    .receipt { max-width: 600px; margin: 0 auto; padding: 20px; border: 1px solid #ddd; }\r\n    .header { text-align: center; border-bottom: 2px solid #000; padding-bottom: 10px; margin-bottom: 20px; }\r\n    .info { margin-bottom: 20px; }\r\n    table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }\r\n    th, td { padding: 8px; text-align: left; border-bottom: 1px solid #ddd; }\r\n    th { background-color: #f4f4f4; font-weight: bold; }\r\n    .total { border-top: 2px solid #000; padding-top: 10px; margin-top: 10px; }\r\n    .total-row { font-weight: bold; font-size: 1.1em; }\r\n    .footer { text-align: center; margin-top: 20px; font-size: 12px; color: #666; }\r\n  </style>\r\n</head>\r\n<body>\r\n  <div class=\"receipt\">\r\n    <div class=\"header\">\r\n      <h2>${companyName}</h2>\r\n      ${tenantSettings?.address ? `<p>${[tenantSettings.address.street, tenantSettings.address.city, tenantSettings.address.state, tenantSettings.address.zipCode].filter(Boolean).join(', ')}</p>` : ''}\r\n      ${tenantSettings?.phone ? `<p>${tenantSettings.phone}</p>` : ''}\r\n    </div>\r\n    \r\n    <div class=\"info\">\r\n      <p><strong>Receipt Number:</strong> ${receiptNumber}</p>\r\n      <p><strong>Date:</strong> ${formattedDate}</p>\r\n      <p><strong>Time:</strong> ${formattedTime}</p>\r\n    </div>\r\n\r\n    <table>\r\n      <thead>\r\n        <tr>\r\n          <th>Item</th>\r\n          <th style=\"text-align: center;\">Qty</th>\r\n          <th style=\"text-align: right;\">Price</th>\r\n          <th style=\"text-align: right;\">Subtotal</th>\r\n        </tr>\r\n      </thead>\r\n      <tbody>\r\n${itemsList}\r\n      </tbody>\r\n    </table>\r\n\r\n    <div class=\"total\">\r\n      <p><strong>Subtotal:</strong> ${formatCurrency(transaction.subtotal, tenantSettings)}</p>\r\n      ${transaction.discountAmount ? `<p><strong>Discount:</strong> -${formatCurrency(transaction.discountAmount, tenantSettings)}</p>` : ''}\r\n      ${transaction.taxAmount ? `<p><strong>${tenantSettings?.taxLabel || 'Tax'}:</strong> ${formatCurrency(transaction.taxAmount, tenantSettings)}</p>` : ''}\r\n      <p class=\"total-row\"><strong>Total:</strong> ${formatCurrency(transaction.total, tenantSettings)}</p>\r\n      <p><strong>Payment Method:</strong> ${transaction.paymentMethod.toUpperCase()}</p>\r\n      ${transaction.cashReceived ? `<p><strong>Cash Received:</strong> ${formatCurrency(transaction.cashReceived, tenantSettings)}</p>` : ''}\r\n      ${transaction.change ? `<p><strong>Change:</strong> ${formatCurrency(transaction.change, tenantSettings)}</p>` : ''}\r\n    </div>\r\n\r\n    <div class=\"footer\">\r\n      <p>Thank you for your business!</p>\r\n      ${tenantSettings?.receiptFooter || ''}\r\n    </div>\r\n  </div>\r\n</body>\r\n</html>\r\n    `.trim();\r\n\r\n    // Send email\r\n    await sendEmail({\r\n      to: customerEmail,\r\n      subject: `Receipt from ${companyName} - ${receiptNumber}`,\r\n      message: receiptHtml,\r\n      type: 'email',\r\n    });\r\n\r\n    results.processed = 1;\r\n    results.message = 'Receipt sent successfully';\r\n\r\n    return results;\r\n  } catch (error: any) {\r\n    results.success = false;\r\n    results.message = `Error sending receipt: ${error.message}`;\r\n    results.errors?.push(error.message);\r\n    results.failed = 1;\r\n    return results;\r\n  }\r\n}\r\n\r\n/**\r\n * Send receipts for recent transactions that haven't been emailed\r\n * This can be called periodically to catch any missed receipts\r\n */\r\nexport async function sendPendingReceipts(\r\n  options: { tenantId?: string; hoursAgo?: number } = {}\r\n): Promise<AutomationResult> {\r\n  await connectDB();\r\n\r\n  const results: AutomationResult = {\r\n    success: true,\r\n    message: '',\r\n    processed: 0,\r\n    failed: 0,\r\n    errors: [],\r\n  };\r\n\r\n  try {\r\n    const hoursAgo = options.hoursAgo || 24;\r\n    const since = new Date(Date.now() - hoursAgo * 60 * 60 * 1000);\r\n\r\n    // Find transactions without receipt email sent\r\n    // Note: We'll need to add a field to track if receipt was sent\r\n    // For now, we'll check transactions with customer email in notes\r\n    const query: any = {\r\n      createdAt: { $gte: since },\r\n      status: 'completed',\r\n    };\r\n\r\n    if (options.tenantId) {\r\n      query.tenantId = options.tenantId;\r\n    }\r\n\r\n    const transactions = await Transaction.find(query)\r\n      .sort({ createdAt: -1 })\r\n      .limit(100)\r\n      .lean();\r\n\r\n    let processed = 0;\r\n    let failed = 0;\r\n\r\n    for (const transaction of transactions) {\r\n      try {\r\n        // Try to extract email from notes or skip if no email\r\n        const emailMatch = transaction.notes?.match(/email[:\\s]+([^\\s]+)/i);\r\n        if (!emailMatch) {\r\n          continue;\r\n        }\r\n\r\n        const result = await sendTransactionReceipt({\r\n          transactionId: transaction._id.toString(),\r\n          customerEmail: emailMatch[1],\r\n        });\r\n\r\n        if (result.success && result.processed > 0) {\r\n          processed++;\r\n        } else {\r\n          failed++;\r\n        }\r\n      } catch (error: any) {\r\n        failed++;\r\n        results.errors?.push(`Transaction ${transaction._id}: ${error.message}`);\r\n      }\r\n    }\r\n\r\n    results.processed = processed;\r\n    results.failed = failed;\r\n    results.message = `Processed ${processed} receipts${failed > 0 ? `, ${failed} failed` : ''}`;\r\n\r\n    return results;\r\n  } catch (error: any) {\r\n    results.success = false;\r\n    results.message = `Error processing pending receipts: ${error.message}`;\r\n    results.errors?.push(error.message);\r\n    return results;\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\lib\\automations\\types.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":17,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":17,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[326,329],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[326,329],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Types for automation system\r\n */\r\n\r\nexport interface AutomationResult {\r\n  success: boolean;\r\n  message: string;\r\n  processed: number;\r\n  failed: number;\r\n  errors?: string[];\r\n}\r\n\r\nexport interface TenantAutomationConfig {\r\n  tenantId: string;\r\n  tenantSlug: string;\r\n  enabled: boolean;\r\n  settings?: Record<string, any>;\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\lib\\business-hours.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ITenantSettings' is defined but never used. Allowed unused vars must match /^_/u.","line":6,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":25},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'year' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":169,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":169,"endColumn":13}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Business Hours Management\r\n * Handles business hours, special hours, and holiday checking\r\n */\r\n\r\nimport { ITenantSettings } from '@/models/Tenant';\r\n\r\nexport interface BusinessHours {\r\n  timezone?: string;\r\n  schedule?: {\r\n    [key: string]: {\r\n      enabled: boolean;\r\n      openTime?: string; // HH:MM format\r\n      closeTime?: string; // HH:MM format\r\n      breaks?: Array<{\r\n        start: string; // HH:MM\r\n        end: string; // HH:MM\r\n      }>;\r\n    };\r\n  };\r\n  specialHours?: Array<{\r\n    date: string; // YYYY-MM-DD\r\n    enabled: boolean;\r\n    openTime?: string;\r\n    closeTime?: string;\r\n    note?: string;\r\n  }>;\r\n}\r\n\r\nexport interface Holiday {\r\n  id: string;\r\n  name: string;\r\n  date: string; // YYYY-MM-DD or pattern for recurring\r\n  type: 'single' | 'recurring';\r\n  recurring?: {\r\n    pattern: 'yearly' | 'monthly' | 'weekly';\r\n    dayOfMonth?: number;\r\n    dayOfWeek?: number; // 0-6, Sunday = 0\r\n    month?: number; // 1-12\r\n  };\r\n  isBusinessClosed: boolean;\r\n}\r\n\r\nconst DAYS_OF_WEEK = ['sunday', 'monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday'];\r\n\r\n/**\r\n * Check if business is open at a given date/time\r\n */\r\nexport function isBusinessOpen(\r\n  date: Date,\r\n  businessHours?: BusinessHours,\r\n  holidays?: Holiday[]\r\n): { isOpen: boolean; reason?: string; nextOpen?: Date } {\r\n  // Check if it's a holiday and business is closed\r\n  if (holidays) {\r\n    const holiday = getHolidayForDate(date, holidays);\r\n    if (holiday && holiday.isBusinessClosed) {\r\n      return {\r\n        isOpen: false,\r\n        reason: `Closed for ${holiday.name}`,\r\n      };\r\n    }\r\n  }\r\n\r\n  // Check special hours first\r\n  if (businessHours?.specialHours) {\r\n    const dateStr = formatDateString(date);\r\n    const specialHour = businessHours.specialHours.find((sh) => sh.date === dateStr);\r\n    if (specialHour) {\r\n      if (!specialHour.enabled) {\r\n        return {\r\n          isOpen: false,\r\n          reason: specialHour.note || 'Closed (special hours)',\r\n        };\r\n      }\r\n      if (specialHour.openTime && specialHour.closeTime) {\r\n        return checkTimeRange(date, specialHour.openTime, specialHour.closeTime);\r\n      }\r\n    }\r\n  }\r\n\r\n  // Check regular schedule\r\n  if (businessHours?.schedule) {\r\n    const dayName = DAYS_OF_WEEK[date.getDay()];\r\n    const daySchedule = businessHours.schedule[dayName];\r\n    \r\n    if (!daySchedule || !daySchedule.enabled) {\r\n      return {\r\n        isOpen: false,\r\n        reason: `Closed on ${dayName}`,\r\n      };\r\n    }\r\n\r\n    if (daySchedule.openTime && daySchedule.closeTime) {\r\n      const timeCheck = checkTimeRange(date, daySchedule.openTime, daySchedule.closeTime);\r\n      \r\n      // Check breaks\r\n      if (timeCheck.isOpen && daySchedule.breaks) {\r\n        for (const breakTime of daySchedule.breaks) {\r\n          const breakCheck = checkTimeRange(date, breakTime.start, breakTime.end);\r\n          if (!breakCheck.isOpen) {\r\n            return {\r\n              isOpen: false,\r\n              reason: 'Closed for break',\r\n            };\r\n          }\r\n        }\r\n      }\r\n\r\n      return timeCheck;\r\n    }\r\n  }\r\n\r\n  // Default: assume open if no schedule is set\r\n  return { isOpen: true };\r\n}\r\n\r\n/**\r\n * Check if time falls within a range\r\n */\r\nfunction checkTimeRange(date: Date, openTime: string, closeTime: string): { isOpen: boolean; nextOpen?: Date } {\r\n  const [openHour, openMinute] = openTime.split(':').map(Number);\r\n  const [closeHour, closeMinute] = closeTime.split(':').map(Number);\r\n\r\n  const currentHour = date.getHours();\r\n  const currentMinute = date.getMinutes();\r\n  const currentTime = currentHour * 60 + currentMinute;\r\n  const openTimeMinutes = openHour * 60 + openMinute;\r\n  const closeTimeMinutes = closeHour * 60 + closeMinute;\r\n\r\n  // Handle overnight hours (e.g., 22:00 - 02:00)\r\n  if (closeTimeMinutes < openTimeMinutes) {\r\n    const isOpen = currentTime >= openTimeMinutes || currentTime < closeTimeMinutes;\r\n    if (!isOpen) {\r\n      // Next open is today if we're before close, otherwise tomorrow\r\n      const nextOpen = new Date(date);\r\n      if (currentTime < openTimeMinutes) {\r\n        nextOpen.setHours(openHour, openMinute, 0, 0);\r\n      } else {\r\n        nextOpen.setDate(nextOpen.getDate() + 1);\r\n        nextOpen.setHours(openHour, openMinute, 0, 0);\r\n      }\r\n      return { isOpen: false, nextOpen };\r\n    }\r\n    return { isOpen: true };\r\n  }\r\n\r\n  // Normal hours\r\n  const isOpen = currentTime >= openTimeMinutes && currentTime < closeTimeMinutes;\r\n  if (!isOpen) {\r\n    const nextOpen = new Date(date);\r\n    if (currentTime < openTimeMinutes) {\r\n      nextOpen.setHours(openHour, openMinute, 0, 0);\r\n    } else {\r\n      nextOpen.setDate(nextOpen.getDate() + 1);\r\n      nextOpen.setHours(openHour, openMinute, 0, 0);\r\n    }\r\n    return { isOpen: false, nextOpen };\r\n  }\r\n\r\n  return { isOpen: true };\r\n}\r\n\r\n/**\r\n * Get holiday for a specific date\r\n */\r\nexport function getHolidayForDate(date: Date, holidays: Holiday[]): Holiday | null {\r\n  const dateStr = formatDateString(date);\r\n  const year = date.getFullYear();\r\n  const month = date.getMonth() + 1;\r\n  const day = date.getDate();\r\n  const dayOfWeek = date.getDay();\r\n\r\n  for (const holiday of holidays) {\r\n    if (holiday.type === 'single') {\r\n      if (holiday.date === dateStr) {\r\n        return holiday;\r\n      }\r\n    } else if (holiday.type === 'recurring' && holiday.recurring) {\r\n      const { pattern, dayOfMonth, dayOfWeek: dow, month: holidayMonth } = holiday.recurring;\r\n\r\n      if (pattern === 'yearly') {\r\n        if (holidayMonth && dayOfMonth) {\r\n          if (month === holidayMonth && day === dayOfMonth) {\r\n            return holiday;\r\n          }\r\n        } else if (dow !== undefined) {\r\n          // Recurring yearly on specific day of week (e.g., Thanksgiving)\r\n          // This is simplified - you might need more complex logic\r\n          if (dayOfWeek === dow) {\r\n            return holiday;\r\n          }\r\n        }\r\n      } else if (pattern === 'monthly' && dayOfMonth) {\r\n        if (day === dayOfMonth) {\r\n          return holiday;\r\n        }\r\n      } else if (pattern === 'weekly' && dow !== undefined) {\r\n        if (dayOfWeek === dow) {\r\n          return holiday;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  return null;\r\n}\r\n\r\n/**\r\n * Format date as YYYY-MM-DD\r\n */\r\nfunction formatDateString(date: Date): string {\r\n  const year = date.getFullYear();\r\n  const month = String(date.getMonth() + 1).padStart(2, '0');\r\n  const day = String(date.getDate()).padStart(2, '0');\r\n  return `${year}-${month}-${day}`;\r\n}\r\n\r\n/**\r\n * Get next business open time\r\n */\r\nexport function getNextOpenTime(\r\n  fromDate: Date,\r\n  businessHours?: BusinessHours,\r\n  holidays?: Holiday[]\r\n): Date | null {\r\n  const checkDate = new Date(fromDate);\r\n  let attempts = 0;\r\n  const maxAttempts = 365; // Prevent infinite loop\r\n\r\n  while (attempts < maxAttempts) {\r\n    const status = isBusinessOpen(checkDate, businessHours, holidays);\r\n    \r\n    if (status.isOpen) {\r\n      return checkDate;\r\n    }\r\n\r\n    if (status.nextOpen) {\r\n      return status.nextOpen;\r\n    }\r\n\r\n    // Move to next day and check opening time\r\n    checkDate.setDate(checkDate.getDate() + 1);\r\n    checkDate.setHours(0, 0, 0, 0);\r\n    attempts++;\r\n  }\r\n\r\n  return null;\r\n}\r\n\r\n/**\r\n * Get business hours for a specific day\r\n */\r\nexport function getBusinessHoursForDay(\r\n  dayName: string,\r\n  businessHours?: BusinessHours\r\n): { enabled: boolean; openTime?: string; closeTime?: string; breaks?: Array<{ start: string; end: string }> } | null {\r\n  if (!businessHours?.schedule) {\r\n    return null;\r\n  }\r\n\r\n  return businessHours.schedule[dayName.toLowerCase()] || null;\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\lib\\business-type-helpers.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getAllowedProductTypes' is defined but never used. Allowed unused vars must match /^_/u.","line":7,"column":47,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":69},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":55,"column":106,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":55,"endColumn":109,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1982,1985],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1982,1985],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":56,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":56,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2023,2026],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2023,2026],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Business Type Helper Functions\r\n * \r\n * Utilities for working with business types and industry-specific features\r\n */\r\n\r\nimport { getBusinessTypeConfig, BusinessType, getAllowedProductTypes } from './business-types';\r\nimport { ITenantSettings } from '@/models/Tenant';\r\nimport { IProduct } from '@/models/Product';\r\n\r\n/**\r\n * Get business type from tenant settings\r\n */\r\nexport function getBusinessType(settings?: ITenantSettings): BusinessType {\r\n  if (!settings?.businessType) {\r\n    return 'general';\r\n  }\r\n  const type = settings.businessType.toLowerCase() as BusinessType;\r\n  return ['retail', 'restaurant', 'laundry', 'service', 'general'].includes(type) ? type : 'general';\r\n}\r\n\r\n/**\r\n * Check if business type supports a feature\r\n */\r\nexport function supportsFeature(\r\n  settings: ITenantSettings | undefined,\r\n  feature: 'inventory' | 'categories' | 'discounts' | 'loyalty' | 'customers' | 'booking'\r\n): boolean {\r\n  if (!settings) return false;\r\n  \r\n  const businessType = getBusinessType(settings);\r\n  const config = getBusinessTypeConfig(businessType);\r\n  \r\n  switch (feature) {\r\n    case 'inventory':\r\n      return settings.enableInventory ?? config.defaultFeatures.enableInventory;\r\n    case 'categories':\r\n      return settings.enableCategories ?? config.defaultFeatures.enableCategories;\r\n    case 'discounts':\r\n      return settings.enableDiscounts ?? config.defaultFeatures.enableDiscounts;\r\n    case 'loyalty':\r\n      return settings.enableLoyaltyProgram ?? config.defaultFeatures.enableLoyaltyProgram;\r\n    case 'customers':\r\n      return settings.enableCustomerManagement ?? config.defaultFeatures.enableCustomerManagement;\r\n    case 'booking':\r\n      return settings.enableBookingScheduling ?? config.defaultFeatures.enableBookingScheduling;\r\n    default:\r\n      return false;\r\n  }\r\n}\r\n\r\n/**\r\n * Get product fields relevant to business type\r\n */\r\nexport function getRelevantProductFields(product: IProduct, businessType?: BusinessType): Record<string, any> {\r\n  const relevant: Record<string, any> = {\r\n    id: product._id,\r\n    name: product.name,\r\n    description: product.description,\r\n    price: product.price,\r\n    productType: product.productType,\r\n    image: product.image,\r\n    categoryId: product.categoryId,\r\n  };\r\n\r\n  const type = businessType || 'general';\r\n\r\n  // Retail-specific fields\r\n  if (type === 'retail') {\r\n    relevant.sku = product.sku;\r\n    relevant.stock = product.stock;\r\n    relevant.trackInventory = product.trackInventory;\r\n    relevant.variations = product.variations;\r\n    relevant.branchStock = product.branchStock;\r\n  }\r\n\r\n  // Restaurant-specific fields\r\n  if (type === 'restaurant') {\r\n    relevant.modifiers = product.modifiers;\r\n    relevant.allergens = product.allergens;\r\n    relevant.nutritionInfo = product.nutritionInfo;\r\n  }\r\n\r\n  // Laundry-specific fields\r\n  if (type === 'laundry') {\r\n    relevant.serviceType = product.serviceType;\r\n    relevant.weightBased = product.weightBased;\r\n    relevant.pickupDelivery = product.pickupDelivery;\r\n    relevant.estimatedDuration = product.estimatedDuration;\r\n  }\r\n\r\n  // Service-specific fields\r\n  if (type === 'service') {\r\n    relevant.serviceDuration = product.serviceDuration;\r\n    relevant.staffRequired = product.staffRequired;\r\n    relevant.equipmentRequired = product.equipmentRequired;\r\n  }\r\n\r\n  return relevant;\r\n}\r\n\r\n/**\r\n * Validate product for business type\r\n */\r\nexport function validateProductForBusiness(\r\n  product: Partial<IProduct>,\r\n  settings: ITenantSettings\r\n): { valid: boolean; errors: string[] } {\r\n  const businessType = getBusinessType(settings);\r\n  const config = getBusinessTypeConfig(businessType);\r\n  const errors: string[] = [];\r\n\r\n  // Check required fields\r\n  if (config.requiredFields.includes('name') && (!product.name || !product.name.trim())) {\r\n    errors.push('Product name is required');\r\n  }\r\n\r\n  if (config.requiredFields.includes('price') && (product.price === undefined || product.price < 0)) {\r\n    errors.push('Product price is required and must be positive');\r\n  }\r\n\r\n  if (config.requiredFields.includes('sku') && businessType === 'retail' && !product.sku) {\r\n    errors.push('SKU is required for retail products');\r\n  }\r\n\r\n  // Check product type\r\n  if (product.productType && !config.productTypes.includes(product.productType)) {\r\n    errors.push(\r\n      `Product type \"${product.productType}\" is not allowed for ${config.name}. ` +\r\n      `Allowed types: ${config.productTypes.join(', ')}`\r\n    );\r\n  }\r\n\r\n  // Business-specific validations\r\n  if (businessType === 'restaurant' && product.modifiers) {\r\n    for (const modifier of product.modifiers) {\r\n      if (!modifier.name || !modifier.options || modifier.options.length === 0) {\r\n        errors.push('Modifiers must have a name and at least one option');\r\n      }\r\n    }\r\n  }\r\n\r\n  if (businessType === 'laundry' && product.weightBased && product.price === undefined) {\r\n    errors.push('Weight-based services must have a base price per unit');\r\n  }\r\n\r\n  return {\r\n    valid: errors.length === 0,\r\n    errors,\r\n  };\r\n}\r\n\r\n/**\r\n * Get default product settings for business type\r\n */\r\nexport function getDefaultProductSettings(settings: ITenantSettings): Partial<IProduct> {\r\n  const businessType = getBusinessType(settings);\r\n  const config = getBusinessTypeConfig(businessType);\r\n\r\n  const defaults: Partial<IProduct> = {\r\n    productType: config.productTypes[0] || 'regular',\r\n    trackInventory: config.defaultFeatures.enableInventory,\r\n  };\r\n\r\n  // Retail defaults\r\n  if (businessType === 'retail') {\r\n    defaults.trackInventory = true;\r\n    defaults.allowOutOfStockSales = false;\r\n  }\r\n\r\n  // Service defaults\r\n  if (businessType === 'service' || businessType === 'laundry') {\r\n    defaults.trackInventory = false;\r\n    defaults.productType = 'service';\r\n  }\r\n\r\n  // Restaurant defaults\r\n  if (businessType === 'restaurant') {\r\n    defaults.trackInventory = true;\r\n    defaults.productType = 'regular';\r\n  }\r\n\r\n  return defaults;\r\n}\r\n\r\n/**\r\n * Format product for display based on business type\r\n */\r\nexport function formatProductForDisplay(\r\n  product: IProduct,\r\n  settings: ITenantSettings\r\n): {\r\n  title: string;\r\n  subtitle?: string;\r\n  price: string;\r\n  details: string[];\r\n} {\r\n  const businessType = getBusinessType(settings);\r\n  const details: string[] = [];\r\n\r\n  const title = product.name;\r\n  let subtitle: string | undefined;\r\n\r\n  // Format based on business type\r\n  if (businessType === 'restaurant') {\r\n    if (product.allergens && product.allergens.length > 0) {\r\n      details.push(`Allergens: ${product.allergens.join(', ')}`);\r\n    }\r\n    if (product.nutritionInfo?.calories) {\r\n      details.push(`${product.nutritionInfo.calories} calories`);\r\n    }\r\n    if (product.modifiers && product.modifiers.length > 0) {\r\n      details.push(`${product.modifiers.length} modifier${product.modifiers.length > 1 ? 's' : ''} available`);\r\n    }\r\n  }\r\n\r\n  if (businessType === 'laundry') {\r\n    if (product.serviceType) {\r\n      subtitle = product.serviceType.charAt(0).toUpperCase() + product.serviceType.slice(1).replace('-', ' ');\r\n    }\r\n    if (product.estimatedDuration) {\r\n      details.push(`Estimated: ${product.estimatedDuration} minutes`);\r\n    }\r\n    if (product.weightBased) {\r\n      details.push('Price per unit weight');\r\n    }\r\n    if (product.pickupDelivery) {\r\n      details.push('Pickup & Delivery available');\r\n    }\r\n  }\r\n\r\n  if (businessType === 'service') {\r\n    if (product.serviceDuration) {\r\n      details.push(`Duration: ${product.serviceDuration} minutes`);\r\n    }\r\n    if (product.staffRequired && product.staffRequired > 1) {\r\n      details.push(`${product.staffRequired} staff required`);\r\n    }\r\n  }\r\n\r\n  if (businessType === 'retail') {\r\n    if (product.sku) {\r\n      details.push(`SKU: ${product.sku}`);\r\n    }\r\n    if (product.trackInventory) {\r\n      details.push(`Stock: ${product.stock}`);\r\n    }\r\n  }\r\n\r\n  return {\r\n    title,\r\n    subtitle,\r\n    price: `$${product.price.toFixed(2)}`,\r\n    details,\r\n  };\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\lib\\business-types.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":25,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":25,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[783,786],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[783,786],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":180,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":180,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5679,5682],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5679,5682],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":207,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":207,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6553,6556],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6553,6556],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":207,"column":82,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":207,"endColumn":85,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6582,6585],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6582,6585],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Business Type Configuration System\r\n * \r\n * Defines industry-specific configurations, features, and extensions\r\n * while maintaining consistency with the Standard POS Architecture Baseline\r\n */\r\n\r\nexport type BusinessType = 'retail' | 'restaurant' | 'laundry' | 'service' | 'general';\r\n\r\nexport interface BusinessTypeConfig {\r\n  type: BusinessType;\r\n  name: string;\r\n  description: string;\r\n  defaultFeatures: {\r\n    enableInventory: boolean;\r\n    enableCategories: boolean;\r\n    enableDiscounts: boolean;\r\n    enableLoyaltyProgram: boolean;\r\n    enableCustomerManagement: boolean;\r\n    enableBookingScheduling: boolean;\r\n  };\r\n  productTypes: ('regular' | 'bundle' | 'service')[];\r\n  requiredFields: string[];\r\n  optionalFields: string[];\r\n  defaultSettings: Record<string, any>;\r\n}\r\n\r\nexport const BUSINESS_TYPE_CONFIGS: Record<BusinessType, BusinessTypeConfig> = {\r\n  retail: {\r\n    type: 'retail',\r\n    name: 'Retail Store',\r\n    description: 'Physical or online retail store selling products',\r\n    defaultFeatures: {\r\n      enableInventory: true,\r\n      enableCategories: true,\r\n      enableDiscounts: true,\r\n      enableLoyaltyProgram: true,\r\n      enableCustomerManagement: true,\r\n      enableBookingScheduling: false,\r\n    },\r\n    productTypes: ['regular', 'bundle'],\r\n    requiredFields: ['name', 'price', 'sku'],\r\n    optionalFields: ['description', 'image', 'variations', 'branchStock'],\r\n    defaultSettings: {\r\n      businessType: 'retail',\r\n      enableInventory: true,\r\n      enableCategories: true,\r\n    },\r\n  },\r\n  restaurant: {\r\n    type: 'restaurant',\r\n    name: 'Restaurant / Food Service',\r\n    description: 'Restaurant, cafe, or food service establishment',\r\n    defaultFeatures: {\r\n      enableInventory: true,\r\n      enableCategories: true,\r\n      enableDiscounts: true,\r\n      enableLoyaltyProgram: true,\r\n      enableCustomerManagement: true,\r\n      enableBookingScheduling: true,\r\n    },\r\n    productTypes: ['regular', 'bundle', 'service'],\r\n    requiredFields: ['name', 'price'],\r\n    optionalFields: ['description', 'image', 'modifiers', 'allergens', 'nutritionInfo'],\r\n    defaultSettings: {\r\n      businessType: 'restaurant',\r\n      enableInventory: true,\r\n      enableCategories: true,\r\n      enableBookingScheduling: true,\r\n    },\r\n  },\r\n  laundry: {\r\n    type: 'laundry',\r\n    name: 'Laundry Service',\r\n    description: 'Laundry, dry cleaning, or garment care service',\r\n    defaultFeatures: {\r\n      enableInventory: false,\r\n      enableCategories: true,\r\n      enableDiscounts: true,\r\n      enableLoyaltyProgram: true,\r\n      enableCustomerManagement: true,\r\n      enableBookingScheduling: true,\r\n    },\r\n    productTypes: ['service'],\r\n    requiredFields: ['name', 'price'],\r\n    optionalFields: ['description', 'serviceType', 'weightBased', 'pickupDelivery', 'estimatedDuration'],\r\n    defaultSettings: {\r\n      businessType: 'laundry',\r\n      enableInventory: false,\r\n      enableCategories: true,\r\n      enableBookingScheduling: true,\r\n    },\r\n  },\r\n  service: {\r\n    type: 'service',\r\n    name: 'Service Business',\r\n    description: 'General service business (salon, spa, repair, etc.)',\r\n    defaultFeatures: {\r\n      enableInventory: false,\r\n      enableCategories: true,\r\n      enableDiscounts: true,\r\n      enableLoyaltyProgram: true,\r\n      enableCustomerManagement: true,\r\n      enableBookingScheduling: true,\r\n    },\r\n    productTypes: ['service'],\r\n    requiredFields: ['name', 'price'],\r\n    optionalFields: ['description', 'serviceDuration', 'staffRequired', 'equipmentRequired'],\r\n    defaultSettings: {\r\n      businessType: 'service',\r\n      enableInventory: false,\r\n      enableCategories: true,\r\n      enableBookingScheduling: true,\r\n    },\r\n  },\r\n  general: {\r\n    type: 'general',\r\n    name: 'General Business',\r\n    description: 'General purpose POS for any business type',\r\n    defaultFeatures: {\r\n      enableInventory: true,\r\n      enableCategories: true,\r\n      enableDiscounts: true,\r\n      enableLoyaltyProgram: false,\r\n      enableCustomerManagement: true,\r\n      enableBookingScheduling: false,\r\n    },\r\n    productTypes: ['regular', 'bundle', 'service'],\r\n    requiredFields: ['name', 'price'],\r\n    optionalFields: ['description', 'image', 'sku'],\r\n    defaultSettings: {\r\n      businessType: 'general',\r\n      enableInventory: true,\r\n      enableCategories: true,\r\n    },\r\n  },\r\n};\r\n\r\n/**\r\n * Get business type configuration\r\n */\r\nexport function getBusinessTypeConfig(businessType?: string): BusinessTypeConfig {\r\n  const type = (businessType?.toLowerCase() as BusinessType) || 'general';\r\n  return BUSINESS_TYPE_CONFIGS[type] || BUSINESS_TYPE_CONFIGS.general;\r\n}\r\n\r\n/**\r\n * Get default features for a business type\r\n */\r\nexport function getDefaultFeatures(businessType?: string) {\r\n  return getBusinessTypeConfig(businessType).defaultFeatures;\r\n}\r\n\r\n/**\r\n * Get default settings for a business type\r\n */\r\nexport function getDefaultSettings(businessType?: string) {\r\n  return getBusinessTypeConfig(businessType).defaultSettings;\r\n}\r\n\r\n/**\r\n * Check if a feature is enabled by default for a business type\r\n */\r\nexport function isFeatureEnabled(businessType: string | undefined, feature: keyof BusinessTypeConfig['defaultFeatures']): boolean {\r\n  const config = getBusinessTypeConfig(businessType);\r\n  return config.defaultFeatures[feature];\r\n}\r\n\r\n/**\r\n * Get allowed product types for a business type\r\n */\r\nexport function getAllowedProductTypes(businessType?: string): ('regular' | 'bundle' | 'service')[] {\r\n  return getBusinessTypeConfig(businessType).productTypes;\r\n}\r\n\r\n/**\r\n * Validate product against business type requirements\r\n */\r\nexport function validateProductForBusinessType(\r\n  product: any,\r\n  businessType?: string\r\n): { valid: boolean; errors: string[] } {\r\n  const config = getBusinessTypeConfig(businessType);\r\n  const errors: string[] = [];\r\n\r\n  // Check required fields\r\n  for (const field of config.requiredFields) {\r\n    if (!product[field] || (typeof product[field] === 'string' && !product[field].trim())) {\r\n      errors.push(`${field} is required for ${config.name} businesses`);\r\n    }\r\n  }\r\n\r\n  // Check product type\r\n  if (product.productType && !config.productTypes.includes(product.productType)) {\r\n    errors.push(`Product type \"${product.productType}\" is not allowed for ${config.name} businesses. Allowed types: ${config.productTypes.join(', ')}`);\r\n  }\r\n\r\n  return {\r\n    valid: errors.length === 0,\r\n    errors,\r\n  };\r\n}\r\n\r\n/**\r\n * Apply business type defaults to tenant settings\r\n */\r\nexport function applyBusinessTypeDefaults(settings: any, businessType?: string): any {\r\n  const config = getBusinessTypeConfig(businessType);\r\n  const defaults = config.defaultSettings;\r\n  \r\n  return {\r\n    ...settings,\r\n    ...defaults,\r\n    // Merge feature flags\r\n    enableInventory: settings.enableInventory ?? config.defaultFeatures.enableInventory,\r\n    enableCategories: settings.enableCategories ?? config.defaultFeatures.enableCategories,\r\n    enableDiscounts: settings.enableDiscounts ?? config.defaultFeatures.enableDiscounts,\r\n    enableLoyaltyProgram: settings.enableLoyaltyProgram ?? config.defaultFeatures.enableLoyaltyProgram,\r\n    enableCustomerManagement: settings.enableCustomerManagement ?? config.defaultFeatures.enableCustomerManagement,\r\n    enableBookingScheduling: settings.enableBookingScheduling ?? config.defaultFeatures.enableBookingScheduling,\r\n  };\r\n}\r\n\r\n/**\r\n * Get industry-specific field suggestions\r\n */\r\nexport function getIndustryFields(businessType?: string): string[] {\r\n  const config = getBusinessTypeConfig(businessType);\r\n  return [...config.requiredFields, ...config.optionalFields];\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\lib\\config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\lib\\confirm.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\lib\\cron.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'manageDiscountStatus' is defined but never used. Allowed unused vars must match /^_/u.","line":19,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":19,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'autoClockOutForgottenSessions' is defined but never used. Allowed unused vars must match /^_/u.","line":20,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":20,"endColumn":32},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'autoCloseCashDrawers' is defined but never used. Allowed unused vars must match /^_/u.","line":21,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":21,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'expireInactiveSessions' is defined but never used. Allowed unused vars must match /^_/u.","line":31,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":31,"endColumn":25},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":65,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":65,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1788,1791],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1788,1791],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":78,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":78,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2215,2218],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2215,2218],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":91,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":91,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2673,2676],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2673,2676],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":104,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":104,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3141,3144],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3141,3144],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":117,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":117,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3617,3620],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3617,3620],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":130,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":130,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4076,4079],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4076,4079],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":144,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":144,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4619,4622],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4619,4622],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":158,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":158,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5166,5169],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5166,5169],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":172,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":172,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5717,5720],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5717,5720],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":185,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":185,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6180,6183],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6180,6183],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":198,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":198,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6643,6646],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6643,6646],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":211,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":211,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7129,7132],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7129,7132],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":224,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":224,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7625,7628],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7625,7628],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":237,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":237,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8087,8090],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8087,8090],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":250,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":250,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8573,8576],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8573,8576],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":263,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":263,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9047,9050],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9047,9050],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":276,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":276,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9484,9487],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9484,9487],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":289,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":289,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9950,9953],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9950,9953],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":302,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":302,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10441,10444],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10441,10444],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":315,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":315,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10913,10916],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10913,10916],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":329,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":329,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11486,11489],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11486,11489],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":342,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":342,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11942,11945],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11942,11945],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":355,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":355,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12426,12429],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12426,12429],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":372,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":372,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12975,12978],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12975,12978],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":385,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":385,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13427,13430],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13427,13430],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":398,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":398,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13868,13871],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13868,13871],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":411,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":411,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14350,14353],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14350,14353],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":424,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":424,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14873,14876],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14873,14876],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":437,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":437,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15411,15414],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15411,15414],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":450,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":450,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15953,15956],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15953,15956],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":34,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Cron Job Service\r\n * Manages scheduled automation tasks\r\n * \r\n * For Next.js deployments:\r\n * - Vercel: Use Vercel Cron Jobs (vercel.json)\r\n * - Self-hosted: Use node-cron (this file)\r\n * - External: Use external cron services (cron-job.org, EasyCron, etc.)\r\n */\r\n\r\nimport * as cron from 'node-cron';\r\nimport {\r\n  sendBookingReminders,\r\n  autoConfirmBookings,\r\n  detectNoShows,\r\n  sendLowStockAlerts,\r\n  sendSalesReport,\r\n  sendPendingReceipts,\r\n  manageDiscountStatus,\r\n  autoClockOutForgottenSessions,\r\n  autoCloseCashDrawers,\r\n  sendCashCountReminders,\r\n  detectAttendanceViolations,\r\n  sendAbandonedCartReminders,\r\n  detectBreaks,\r\n  generatePurchaseOrders,\r\n  createDatabaseBackup,\r\n  cleanupAuditLogs,\r\n  analyzeProductPerformance,\r\n  calculateCustomerLifetimeValue,\r\n  expireInactiveSessions,\r\n  detectStockImbalances,\r\n  predictStockNeeds,\r\n  applyDynamicPricing,\r\n  archiveOldData,\r\n  syncMultiBranchData,\r\n  detectSuspiciousActivity,\r\n  analyzeSalesTrends,\r\n} from './automations';\r\n\r\nlet cronJobs: cron.ScheduledTask[] = [];\r\n\r\n/**\r\n * Initialize cron jobs\r\n * Only runs in Node.js environment (not in Edge runtime)\r\n */\r\nexport function initializeCronJobs() {\r\n  // Only run in server environment\r\n  if (typeof window !== 'undefined' || process.env.NEXT_RUNTIME === 'edge') {\r\n    return;\r\n  }\r\n\r\n  // Clear existing jobs\r\n  stopCronJobs();\r\n\r\n  console.log(' Initializing cron jobs...');\r\n\r\n  // 1. Booking Reminders - Every hour\r\n  // Runs at the top of every hour\r\n  const bookingRemindersJob = cron.schedule('0 * * * *', async () => {\r\n    console.log(' Running booking reminders automation...');\r\n    try {\r\n      const result = await sendBookingReminders({ hoursBefore: 24 });\r\n      console.log(' Booking reminders:', result.message);\r\n    } catch (error: any) {\r\n      console.error(' Booking reminders error:', error.message);\r\n    }\r\n  }, {\r\n    timezone: 'UTC',\r\n  });\r\n\r\n  // 2. Low Stock Alerts - Every hour\r\n  const lowStockJob = cron.schedule('0 * * * *', async () => {\r\n    console.log(' Running low stock alerts automation...');\r\n    try {\r\n      const result = await sendLowStockAlerts();\r\n      console.log(' Low stock alerts:', result.message);\r\n    } catch (error: any) {\r\n      console.error(' Low stock alerts error:', error.message);\r\n    }\r\n  }, {\r\n    timezone: 'UTC',\r\n  });\r\n\r\n  // 3. Daily Sales Report - Every day at 8 AM\r\n  const dailyReportJob = cron.schedule('0 8 * * *', async () => {\r\n    console.log(' Running daily sales report automation...');\r\n    try {\r\n      const result = await sendSalesReport({ period: 'daily' });\r\n      console.log(' Daily sales report:', result.message);\r\n    } catch (error: any) {\r\n      console.error(' Daily sales report error:', error.message);\r\n    }\r\n  }, {\r\n    timezone: 'UTC',\r\n  });\r\n\r\n  // 4. Weekly Sales Report - Every Monday at 9 AM\r\n  const weeklyReportJob = cron.schedule('0 9 * * 1', async () => {\r\n    console.log(' Running weekly sales report automation...');\r\n    try {\r\n      const result = await sendSalesReport({ period: 'weekly' });\r\n      console.log(' Weekly sales report:', result.message);\r\n    } catch (error: any) {\r\n      console.error(' Weekly sales report error:', error.message);\r\n    }\r\n  }, {\r\n    timezone: 'UTC',\r\n  });\r\n\r\n  // 5. Monthly Sales Report - 1st of month at 10 AM\r\n  const monthlyReportJob = cron.schedule('0 10 1 * *', async () => {\r\n    console.log(' Running monthly sales report automation...');\r\n    try {\r\n      const result = await sendSalesReport({ period: 'monthly' });\r\n      console.log(' Monthly sales report:', result.message);\r\n    } catch (error: any) {\r\n      console.error(' Monthly sales report error:', error.message);\r\n    }\r\n  }, {\r\n    timezone: 'UTC',\r\n  });\r\n\r\n  // 6. Pending Receipts - Every 6 hours\r\n  const pendingReceiptsJob = cron.schedule('0 */6 * * *', async () => {\r\n    console.log(' Running pending receipts automation...');\r\n    try {\r\n      const result = await sendPendingReceipts({ hoursAgo: 24 });\r\n      console.log(' Pending receipts:', result.message);\r\n    } catch (error: any) {\r\n      console.error(' Pending receipts error:', error.message);\r\n    }\r\n  }, {\r\n    timezone: 'UTC',\r\n  });\r\n\r\n  // 7. Discount Management - Every 6 hours\r\n  const discountManagementJob = cron.schedule('0 */6 * * *', async () => {\r\n    console.log(' Running discount management automation...');\r\n    try {\r\n      const { manageDiscountStatus } = await import('./automations/discount-management');\r\n      const result = await manageDiscountStatus();\r\n      console.log(' Discount management:', result.message);\r\n    } catch (error: any) {\r\n      console.error(' Discount management error:', error.message);\r\n    }\r\n  }, {\r\n    timezone: 'UTC',\r\n  });\r\n\r\n  // 8. Auto Clock-Out - Every 2 hours\r\n  const autoClockOutJob = cron.schedule('0 */2 * * *', async () => {\r\n    console.log(' Running auto clock-out automation...');\r\n    try {\r\n      const { autoClockOutForgottenSessions } = await import('./automations/attendance-auto-clockout');\r\n      const result = await autoClockOutForgottenSessions();\r\n      console.log(' Auto clock-out:', result.message);\r\n    } catch (error: any) {\r\n      console.error(' Auto clock-out error:', error.message);\r\n    }\r\n  }, {\r\n    timezone: 'UTC',\r\n  });\r\n\r\n  // 9. Cash Drawer Auto-Close - Every day at 10 PM\r\n  const cashDrawerCloseJob = cron.schedule('0 22 * * *', async () => {\r\n    console.log(' Running cash drawer auto-close automation...');\r\n    try {\r\n      const { autoCloseCashDrawers } = await import('./automations/cash-drawer-closure');\r\n      const result = await autoCloseCashDrawers();\r\n      console.log(' Cash drawer auto-close:', result.message);\r\n    } catch (error: any) {\r\n      console.error(' Cash drawer auto-close error:', error.message);\r\n    }\r\n  }, {\r\n    timezone: 'UTC',\r\n  });\r\n\r\n  // 10. Booking Confirmations - Every 15 minutes\r\n  const bookingConfirmJob = cron.schedule('*/15 * * * *', async () => {\r\n    console.log(' Running booking confirmations automation...');\r\n    try {\r\n      const result = await autoConfirmBookings();\r\n      console.log(' Booking confirmations:', result.message);\r\n    } catch (error: any) {\r\n      console.error(' Booking confirmations error:', error.message);\r\n    }\r\n  }, {\r\n    timezone: 'UTC',\r\n  });\r\n\r\n  // 11. No-Show Detection - Every 30 minutes\r\n  const noShowJob = cron.schedule('*/30 * * * *', async () => {\r\n    console.log(' Running no-show detection automation...');\r\n    try {\r\n      const result = await detectNoShows({ gracePeriodMinutes: 15 });\r\n      console.log(' No-show detection:', result.message);\r\n    } catch (error: any) {\r\n      console.error(' No-show detection error:', error.message);\r\n    }\r\n  }, {\r\n    timezone: 'UTC',\r\n  });\r\n\r\n  // 12. Cash Count Reminders - Daily at 5 PM\r\n  const cashCountReminderJob = cron.schedule('0 17 * * *', async () => {\r\n    console.log(' Running cash count reminders automation...');\r\n    try {\r\n      const result = await sendCashCountReminders({ reminderMinutesBefore: 30 });\r\n      console.log(' Cash count reminders:', result.message);\r\n    } catch (error: any) {\r\n      console.error(' Cash count reminders error:', error.message);\r\n    }\r\n  }, {\r\n    timezone: 'UTC',\r\n  });\r\n\r\n  // 13. Attendance Violations - Daily at 9 AM\r\n  const attendanceViolationsJob = cron.schedule('0 9 * * *', async () => {\r\n    console.log(' Running attendance violations automation...');\r\n    try {\r\n      const result = await detectAttendanceViolations({ lateThresholdMinutes: 15 });\r\n      console.log(' Attendance violations:', result.message);\r\n    } catch (error: any) {\r\n      console.error(' Attendance violations error:', error.message);\r\n    }\r\n  }, {\r\n    timezone: 'UTC',\r\n  });\r\n\r\n  // 14. Break Detection - Every 30 minutes\r\n  const breakDetectionJob = cron.schedule('*/30 * * * *', async () => {\r\n    console.log(' Running break detection automation...');\r\n    try {\r\n      const result = await detectBreaks({ inactivityMinutes: 30 });\r\n      console.log(' Break detection:', result.message);\r\n    } catch (error: any) {\r\n      console.error(' Break detection error:', error.message);\r\n    }\r\n  }, {\r\n    timezone: 'UTC',\r\n  });\r\n\r\n  // 15. Abandoned Cart Reminders - Every 12 hours\r\n  const abandonedCartJob = cron.schedule('0 */12 * * *', async () => {\r\n    console.log(' Running abandoned cart reminders automation...');\r\n    try {\r\n      const result = await sendAbandonedCartReminders({ hoursAgo: 24 });\r\n      console.log(' Abandoned cart reminders:', result.message);\r\n    } catch (error: any) {\r\n      console.error(' Abandoned cart reminders error:', error.message);\r\n    }\r\n  }, {\r\n    timezone: 'UTC',\r\n  });\r\n\r\n  // 16. Purchase Order Generation - Daily at 9 AM\r\n  const purchaseOrderJob = cron.schedule('0 9 * * *', async () => {\r\n    console.log(' Running purchase order generation automation...');\r\n    try {\r\n      const result = await generatePurchaseOrders();\r\n      console.log(' Purchase order generation:', result.message);\r\n    } catch (error: any) {\r\n      console.error(' Purchase order generation error:', error.message);\r\n    }\r\n  }, {\r\n    timezone: 'UTC',\r\n  });\r\n\r\n  // 17. Database Backups - Daily at 2 AM\r\n  const backupJob = cron.schedule('0 2 * * *', async () => {\r\n    console.log(' Running database backup automation...');\r\n    try {\r\n      const result = await createDatabaseBackup();\r\n      console.log(' Database backup:', result.message);\r\n    } catch (error: any) {\r\n      console.error(' Database backup error:', error.message);\r\n    }\r\n  }, {\r\n    timezone: 'UTC',\r\n  });\r\n\r\n  // 18. Audit Log Cleanup - Weekly on Sunday at 4 AM\r\n  const auditCleanupJob = cron.schedule('0 4 * * 0', async () => {\r\n    console.log(' Running audit log cleanup automation...');\r\n    try {\r\n      const result = await cleanupAuditLogs({ retentionYears: 2 });\r\n      console.log(' Audit log cleanup:', result.message);\r\n    } catch (error: any) {\r\n      console.error(' Audit log cleanup error:', error.message);\r\n    }\r\n  }, {\r\n    timezone: 'UTC',\r\n  });\r\n\r\n  // 19. Product Performance - Weekly on Monday at 10 AM\r\n  const productPerformanceJob = cron.schedule('0 10 * * 1', async () => {\r\n    console.log(' Running product performance automation...');\r\n    try {\r\n      const result = await analyzeProductPerformance({ daysToAnalyze: 30 });\r\n      console.log(' Product performance:', result.message);\r\n    } catch (error: any) {\r\n      console.error(' Product performance error:', error.message);\r\n    }\r\n  }, {\r\n    timezone: 'UTC',\r\n  });\r\n\r\n  // 20. Customer Lifetime Value - Weekly on Sunday at 2 AM\r\n  const clvJob = cron.schedule('0 2 * * 0', async () => {\r\n    console.log(' Running customer lifetime value automation...');\r\n    try {\r\n      const result = await calculateCustomerLifetimeValue();\r\n      console.log(' Customer lifetime value:', result.message);\r\n    } catch (error: any) {\r\n      console.error(' Customer lifetime value error:', error.message);\r\n    }\r\n  }, {\r\n    timezone: 'UTC',\r\n  });\r\n\r\n  // 21. Session Expiration - Every 6 hours\r\n  const sessionExpirationJob = cron.schedule('0 */6 * * *', async () => {\r\n    console.log(' Running session expiration automation...');\r\n    try {\r\n      const { expireInactiveSessions } = await import('./automations/session-expiration');\r\n      const result = await expireInactiveSessions({ inactivityHours: 24 });\r\n      console.log(' Session expiration:', result.message);\r\n    } catch (error: any) {\r\n      console.error(' Session expiration error:', error.message);\r\n    }\r\n  }, {\r\n    timezone: 'UTC',\r\n  });\r\n\r\n  // 22. Stock Transfer - Daily at 8 AM\r\n  const stockTransferJob = cron.schedule('0 8 * * *', async () => {\r\n    console.log(' Running stock transfer automation...');\r\n    try {\r\n      const result = await detectStockImbalances({ autoApprove: false });\r\n      console.log(' Stock transfer:', result.message);\r\n    } catch (error: any) {\r\n      console.error(' Stock transfer error:', error.message);\r\n    }\r\n  }, {\r\n    timezone: 'UTC',\r\n  });\r\n\r\n  // 23. Predictive Stock - Weekly on Monday at 9 AM\r\n  const predictiveStockJob = cron.schedule('0 9 * * 1', async () => {\r\n    console.log(' Running predictive stock automation...');\r\n    try {\r\n      const result = await predictStockNeeds({ analysisDays: 30, predictionDays: 7 });\r\n      console.log(' Predictive stock:', result.message);\r\n    } catch (error: any) {\r\n      console.error(' Predictive stock error:', error.message);\r\n    }\r\n  }, {\r\n    timezone: 'UTC',\r\n  });\r\n\r\n  // 24. Dynamic Pricing - Every 30 minutes\r\n  const dynamicPricingJob = cron.schedule('*/30 * * * *', async () => {\r\n    console.log(' Running dynamic pricing automation...');\r\n    try {\r\n      const result = await applyDynamicPricing({\r\n        enableTimeBased: true,\r\n        enableDemandBased: true,\r\n        enableStockBased: true,\r\n      });\r\n      console.log(' Dynamic pricing:', result.message);\r\n    } catch (error: any) {\r\n      console.error(' Dynamic pricing error:', error.message);\r\n    }\r\n  }, {\r\n    timezone: 'UTC',\r\n  });\r\n\r\n  // 25. Data Archiving - Weekly on Sunday at 3 AM\r\n  const dataArchiveJob = cron.schedule('0 3 * * 0', async () => {\r\n    console.log(' Running data archiving automation...');\r\n    try {\r\n      const result = await archiveOldData({ archiveYears: 2 });\r\n      console.log(' Data archiving:', result.message);\r\n    } catch (error: any) {\r\n      console.error(' Data archiving error:', error.message);\r\n    }\r\n  }, {\r\n    timezone: 'UTC',\r\n  });\r\n\r\n  // 26. Multi-Branch Sync - Every 4 hours\r\n  const multiBranchSyncJob = cron.schedule('0 */4 * * *', async () => {\r\n    console.log(' Running multi-branch sync automation...');\r\n    try {\r\n      const result = await syncMultiBranchData();\r\n      console.log(' Multi-branch sync:', result.message);\r\n    } catch (error: any) {\r\n      console.error(' Multi-branch sync error:', error.message);\r\n    }\r\n  }, {\r\n    timezone: 'UTC',\r\n  });\r\n\r\n  // 27. Suspicious Activity - Every 15 minutes\r\n  const suspiciousActivityJob = cron.schedule('*/15 * * * *', async () => {\r\n    console.log(' Running suspicious activity detection automation...');\r\n    try {\r\n      const result = await detectSuspiciousActivity();\r\n      console.log(' Suspicious activity detection:', result.message);\r\n    } catch (error: any) {\r\n      console.error(' Suspicious activity detection error:', error.message);\r\n    }\r\n  }, {\r\n    timezone: 'UTC',\r\n  });\r\n\r\n  // 28. Sales Trend Analysis (Daily) - Daily at 9 AM\r\n  const salesTrendDailyJob = cron.schedule('0 9 * * *', async () => {\r\n    console.log(' Running daily sales trend analysis automation...');\r\n    try {\r\n      const result = await analyzeSalesTrends({ period: 'daily', comparePeriods: true });\r\n      console.log(' Daily sales trend analysis:', result.message);\r\n    } catch (error: any) {\r\n      console.error(' Daily sales trend analysis error:', error.message);\r\n    }\r\n  }, {\r\n    timezone: 'UTC',\r\n  });\r\n\r\n  // 29. Sales Trend Analysis (Weekly) - Weekly on Monday at 10 AM\r\n  const salesTrendWeeklyJob = cron.schedule('0 10 * * 1', async () => {\r\n    console.log(' Running weekly sales trend analysis automation...');\r\n    try {\r\n      const result = await analyzeSalesTrends({ period: 'weekly', comparePeriods: true });\r\n      console.log(' Weekly sales trend analysis:', result.message);\r\n    } catch (error: any) {\r\n      console.error(' Weekly sales trend analysis error:', error.message);\r\n    }\r\n  }, {\r\n    timezone: 'UTC',\r\n  });\r\n\r\n  // 30. Sales Trend Analysis (Monthly) - Monthly on 1st at 11 AM\r\n  const salesTrendMonthlyJob = cron.schedule('0 11 1 * *', async () => {\r\n    console.log(' Running monthly sales trend analysis automation...');\r\n    try {\r\n      const result = await analyzeSalesTrends({ period: 'monthly', comparePeriods: true });\r\n      console.log(' Monthly sales trend analysis:', result.message);\r\n    } catch (error: any) {\r\n      console.error(' Monthly sales trend analysis error:', error.message);\r\n    }\r\n  }, {\r\n    timezone: 'UTC',\r\n  });\r\n\r\n  // Store jobs\r\n  cronJobs = [\r\n    bookingRemindersJob,\r\n    bookingConfirmJob,\r\n    noShowJob,\r\n    lowStockJob,\r\n    purchaseOrderJob,\r\n    dailyReportJob,\r\n    weeklyReportJob,\r\n    monthlyReportJob,\r\n    pendingReceiptsJob,\r\n    discountManagementJob,\r\n    attendanceViolationsJob,\r\n    breakDetectionJob,\r\n    autoClockOutJob,\r\n    cashDrawerCloseJob,\r\n    cashCountReminderJob,\r\n    abandonedCartJob,\r\n    productPerformanceJob,\r\n    clvJob,\r\n    sessionExpirationJob,\r\n    stockTransferJob,\r\n    predictiveStockJob,\r\n    dynamicPricingJob,\r\n    dataArchiveJob,\r\n    backupJob,\r\n    auditCleanupJob,\r\n    multiBranchSyncJob,\r\n    suspiciousActivityJob,\r\n    salesTrendDailyJob,\r\n    salesTrendWeeklyJob,\r\n    salesTrendMonthlyJob,\r\n  ];\r\n\r\n  // Start all jobs if enabled\r\n  const cronEnabled = process.env.ENABLE_CRON_JOBS === 'true';\r\n  if (cronEnabled) {\r\n    cronJobs.forEach(job => job.start());\r\n    console.log(` Started ${cronJobs.length} cron jobs`);\r\n  } else {\r\n    console.log('  Cron jobs disabled (set ENABLE_CRON_JOBS=true to enable)');\r\n  }\r\n}\r\n\r\n/**\r\n * Stop all cron jobs\r\n */\r\nexport function stopCronJobs() {\r\n  cronJobs.forEach(job => job.stop());\r\n  cronJobs = [];\r\n  console.log(' Stopped all cron jobs');\r\n}\r\n\r\n/**\r\n * Get status of cron jobs\r\n */\r\nexport function getCronJobStatus() {\r\n  return {\r\n    enabled: process.env.ENABLE_CRON_JOBS === 'true',\r\n    activeJobs: cronJobs.length,\r\n    jobs: cronJobs.map((job, index) => ({\r\n      index,\r\n      running: job.getStatus() === 'scheduled',\r\n    })),\r\n  };\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\lib\\currency.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\lib\\error-handler.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":13,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":13,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[285,288],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[285,288],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":30,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":30,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[805,808],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[805,808],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server';\r\n\r\nexport interface ApiError {\r\n  success: false;\r\n  error: string;\r\n  errors?: Array<{ field: string; message: string }>;\r\n  code?: string;\r\n}\r\n\r\n/**\r\n * Standardized error handler for API routes\r\n */\r\nexport function handleApiError(error: any, defaultMessage: string = 'An error occurred'): NextResponse<ApiError> {\r\n  console.error('API Error:', error);\r\n\r\n  // Validation errors\r\n  if (error.name === 'ValidationException' && error.errors) {\r\n    return NextResponse.json(\r\n      {\r\n        success: false,\r\n        error: 'Validation failed',\r\n        errors: error.errors,\r\n      },\r\n      { status: 400 }\r\n    );\r\n  }\r\n\r\n  // Mongoose validation errors\r\n  if (error.name === 'ValidationError') {\r\n    const errors = Object.values(error.errors).map((err: any) => ({\r\n      field: err.path,\r\n      message: err.message,\r\n    }));\r\n    return NextResponse.json(\r\n      {\r\n        success: false,\r\n        error: 'Validation failed',\r\n        errors,\r\n      },\r\n      { status: 400 }\r\n    );\r\n  }\r\n\r\n  // Duplicate key errors\r\n  if (error.code === 11000) {\r\n    const field = Object.keys(error.keyPattern || {})[0] || 'field';\r\n    return NextResponse.json(\r\n      {\r\n        success: false,\r\n        error: `${field} already exists`,\r\n        code: 'DUPLICATE_KEY',\r\n      },\r\n      { status: 400 }\r\n    );\r\n  }\r\n\r\n  // Authentication/Authorization errors\r\n  if (error.message === 'Unauthorized') {\r\n    return NextResponse.json(\r\n      {\r\n        success: false,\r\n        error: 'Unauthorized',\r\n        code: 'UNAUTHORIZED',\r\n      },\r\n      { status: 401 }\r\n    );\r\n  }\r\n\r\n  if (error.message.includes('Forbidden') || error.message.includes('permissions')) {\r\n    return NextResponse.json(\r\n      {\r\n        success: false,\r\n        error: 'Forbidden: Insufficient permissions',\r\n        code: 'FORBIDDEN',\r\n      },\r\n      { status: 403 }\r\n    );\r\n  }\r\n\r\n  // Default error\r\n  return NextResponse.json(\r\n    {\r\n      success: false,\r\n      error: error.message || defaultMessage,\r\n    },\r\n    { status: error.statusCode || 500 }\r\n  );\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\lib\\export.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":8,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":8,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[152,155],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[152,155],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":37,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":37,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[966,969],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[966,969],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":37,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":37,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[986,989],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[986,989],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":73,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":73,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1870,1873],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1870,1873],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":110,"column":9,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":110,"endColumn":12,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3108,3111],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3108,3111],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'rowIndex' is defined but never used. Allowed unused args must match /^_/u.","line":153,"column":24,"nodeType":null,"messageId":"unusedVar","endLine":153,"endColumn":32}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Export utility functions for CSV/Excel/PDF export\r\n */\r\n\r\n/**\r\n * Convert array of objects to CSV string\r\n */\r\nexport function arrayToCSV(data: any[], headers: string[]): string {\r\n  if (!data || data.length === 0) {\r\n    return headers.join(',');\r\n  }\r\n\r\n  const rows = [headers.join(',')];\r\n  \r\n  for (const item of data) {\r\n    const row = headers.map(header => {\r\n      const value = getNestedValue(item, header);\r\n      // Escape commas, quotes, and newlines in CSV\r\n      if (value === null || value === undefined) {\r\n        return '';\r\n      }\r\n      const stringValue = String(value);\r\n      if (stringValue.includes(',') || stringValue.includes('\"') || stringValue.includes('\\n')) {\r\n        return `\"${stringValue.replace(/\"/g, '\"\"')}\"`;\r\n      }\r\n      return stringValue;\r\n    });\r\n    rows.push(row.join(','));\r\n  }\r\n  \r\n  return rows.join('\\n');\r\n}\r\n\r\n/**\r\n * Get nested value from object using dot notation\r\n */\r\nfunction getNestedValue(obj: any, path: string): any {\r\n  const keys = path.split('.');\r\n  let value = obj;\r\n  for (const key of keys) {\r\n    if (value === null || value === undefined) {\r\n      return '';\r\n    }\r\n    value = value[key];\r\n  }\r\n  return value;\r\n}\r\n\r\n/**\r\n * Download CSV file\r\n */\r\nexport function downloadCSV(csv: string, filename: string): void {\r\n  const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });\r\n  const link = document.createElement('a');\r\n  const url = URL.createObjectURL(blob);\r\n  \r\n  link.setAttribute('href', url);\r\n  link.setAttribute('download', filename);\r\n  link.style.visibility = 'hidden';\r\n  \r\n  document.body.appendChild(link);\r\n  link.click();\r\n  document.body.removeChild(link);\r\n  \r\n  // Clean up\r\n  setTimeout(() => URL.revokeObjectURL(url), 100);\r\n}\r\n\r\n/**\r\n * Export data to Excel format (XLSX)\r\n * Requires: npm install xlsx\r\n */\r\nexport async function downloadExcel(data: any[], headers: string[], filename: string): Promise<void> {\r\n  try {\r\n    const XLSX = await import('xlsx');\r\n    \r\n    // Prepare worksheet data\r\n    const worksheetData = [\r\n      headers, // Header row\r\n      ...data.map(row => headers.map(header => {\r\n        const value = getNestedValue(row, header);\r\n        return value !== null && value !== undefined ? String(value) : '';\r\n      })),\r\n    ];\r\n    \r\n    // Create workbook and worksheet\r\n    const workbook = XLSX.utils.book_new();\r\n    const worksheet = XLSX.utils.aoa_to_sheet(worksheetData);\r\n    \r\n    // Set column widths (auto-width approximation)\r\n    const colWidths = headers.map(() => ({ wch: 15 }));\r\n    worksheet['!cols'] = colWidths;\r\n    \r\n    // Add worksheet to workbook\r\n    XLSX.utils.book_append_sheet(workbook, worksheet, 'Sheet1');\r\n    \r\n    // Generate file and download\r\n    XLSX.writeFile(workbook, filename.endsWith('.xlsx') ? filename : `${filename}.xlsx`);\r\n  } catch (error) {\r\n    console.error('Error exporting to Excel:', error);\r\n    throw new Error('Excel export failed. Please ensure xlsx package is installed.');\r\n  }\r\n}\r\n\r\n/**\r\n * Export data to PDF format\r\n * Requires: npm install jspdf\r\n */\r\nexport async function downloadPDF(\r\n  data: any[], \r\n  headers: string[], \r\n  filename: string,\r\n  title?: string\r\n): Promise<void> {\r\n  try {\r\n    const jsPDF = (await import('jspdf')).default;\r\n    \r\n    const doc = new jsPDF();\r\n    const pageWidth = doc.internal.pageSize.getWidth();\r\n    const pageHeight = doc.internal.pageSize.getHeight();\r\n    const margin = 10;\r\n    const startY = title ? 20 : margin;\r\n    let y = startY;\r\n    \r\n    // Add title if provided\r\n    if (title) {\r\n      doc.setFontSize(16);\r\n      doc.setFont(undefined, 'bold');\r\n      doc.text(title, margin, y);\r\n      y += 10;\r\n    }\r\n    \r\n    // Calculate column widths\r\n    const colCount = headers.length;\r\n    const colWidth = (pageWidth - 2 * margin) / colCount;\r\n    \r\n    // Header row\r\n    doc.setFontSize(10);\r\n    doc.setFont(undefined, 'bold');\r\n    headers.forEach((header, index) => {\r\n      const x = margin + index * colWidth;\r\n      doc.text(header, x, y);\r\n    });\r\n    y += 7;\r\n    \r\n    // Draw header line\r\n    doc.setLineWidth(0.5);\r\n    doc.line(margin, y - 2, pageWidth - margin, y - 2);\r\n    y += 3;\r\n    \r\n    // Data rows\r\n    doc.setFont(undefined, 'normal');\r\n    data.forEach((row, rowIndex) => {\r\n      // Check if we need a new page\r\n      if (y > pageHeight - 20) {\r\n        doc.addPage();\r\n        y = margin;\r\n      }\r\n      \r\n      headers.forEach((header, colIndex) => {\r\n        const x = margin + colIndex * colWidth;\r\n        const value = getNestedValue(row, header);\r\n        const text = value !== null && value !== undefined ? String(value).substring(0, 20) : '';\r\n        doc.text(text, x, y);\r\n      });\r\n      y += 6;\r\n    });\r\n    \r\n    // Save PDF\r\n    doc.save(filename.endsWith('.pdf') ? filename : `${filename}.pdf`);\r\n  } catch (error) {\r\n    console.error('Error exporting to PDF:', error);\r\n    throw new Error('PDF export failed. Please ensure jspdf package is installed.');\r\n  }\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\lib\\formatting.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\lib\\hardware\\barcode-scanner.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\lib\\hardware\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\lib\\hardware\\qr-reader.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":44,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":44,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1220,1223],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1220,1223],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * QR Code Reader Service\r\n * Supports camera-based QR code scanning\r\n */\r\n\r\nimport jsQR from 'jsqr';\r\n\r\nexport interface QRReaderConfig {\r\n  enabled: boolean;\r\n  cameraId?: string;\r\n}\r\n\r\nclass QRReaderService {\r\n  private config: QRReaderConfig | null = null;\r\n  private listeners: Array<(data: string) => void> = [];\r\n  private stream: MediaStream | null = null;\r\n  private videoElement: HTMLVideoElement | null = null;\r\n  private scanInterval: NodeJS.Timeout | null = null;\r\n\r\n  setConfig(config: QRReaderConfig): void {\r\n    this.config = config;\r\n  }\r\n\r\n  async startScanning(\r\n    videoElement: HTMLVideoElement,\r\n    onScan: (data: string) => void\r\n  ): Promise<boolean> {\r\n    try {\r\n      this.videoElement = videoElement;\r\n      this.listeners.push(onScan);\r\n\r\n      const constraints: MediaStreamConstraints = {\r\n        video: {\r\n          facingMode: 'environment', // Use back camera on mobile\r\n          ...(this.config?.cameraId && { deviceId: this.config.cameraId }),\r\n        },\r\n      };\r\n\r\n      this.stream = await navigator.mediaDevices.getUserMedia(constraints);\r\n      videoElement.srcObject = this.stream;\r\n      \r\n      try {\r\n        await videoElement.play();\r\n      } catch (playError: any) {\r\n        // Handle AbortError gracefully - this happens when navigation occurs\r\n        // while play() is pending, which is expected behavior\r\n        if (playError.name === 'AbortError' || playError.name === 'NotAllowedError') {\r\n          // Clean up resources if play was interrupted\r\n          if (this.stream) {\r\n            this.stream.getTracks().forEach(track => track.stop());\r\n            this.stream = null;\r\n          }\r\n          if (videoElement) {\r\n            videoElement.srcObject = null;\r\n          }\r\n          return false;\r\n        }\r\n        throw playError; // Re-throw other errors\r\n      }\r\n\r\n      // Start scanning for QR codes\r\n      this.scanInterval = setInterval(() => {\r\n        this.scanFrame(videoElement);\r\n      }, 500); // Scan every 500ms\r\n\r\n      return true;\r\n    } catch (error) {\r\n      console.error('Failed to start QR scanning:', error);\r\n      // Ensure cleanup on error\r\n      if (this.stream) {\r\n        this.stream.getTracks().forEach(track => track.stop());\r\n        this.stream = null;\r\n      }\r\n      if (videoElement) {\r\n        videoElement.srcObject = null;\r\n      }\r\n      return false;\r\n    }\r\n  }\r\n\r\n  async stopScanning(): Promise<void> {\r\n    if (this.scanInterval) {\r\n      clearInterval(this.scanInterval);\r\n      this.scanInterval = null;\r\n    }\r\n\r\n    if (this.videoElement) {\r\n      try {\r\n        // Pause the video element before cleanup to prevent AbortError\r\n        this.videoElement.pause();\r\n        this.videoElement.srcObject = null;\r\n      } catch (error) {\r\n        // Ignore errors during cleanup (e.g., if element is already removed)\r\n      }\r\n      this.videoElement = null;\r\n    }\r\n\r\n    if (this.stream) {\r\n      this.stream.getTracks().forEach(track => track.stop());\r\n      this.stream = null;\r\n    }\r\n\r\n    this.listeners = [];\r\n  }\r\n\r\n  private async scanFrame(video: HTMLVideoElement): Promise<void> {\r\n    try {\r\n      // Use a QR code scanning library (like jsQR or html5-qrcode)\r\n      // For now, we'll use a simple canvas-based approach\r\n      const canvas = document.createElement('canvas');\r\n      const context = canvas.getContext('2d');\r\n      if (!context || video.readyState !== video.HAVE_ENOUGH_DATA) {\r\n        return;\r\n      }\r\n\r\n      canvas.width = video.videoWidth;\r\n      canvas.height = video.videoHeight;\r\n      context.drawImage(video, 0, 0, canvas.width, canvas.height);\r\n\r\n      const imageData = context.getImageData(0, 0, canvas.width, canvas.height);\r\n\r\n      // Try to decode QR code\r\n      // Note: This requires a QR code library like jsQR\r\n      // For now, we'll use a placeholder that can be replaced with actual library\r\n      const qrData = await this.decodeQRCode(imageData);\r\n      if (qrData) {\r\n        this.notifyListeners(qrData);\r\n      }\r\n    } catch (error) {\r\n      // Silently fail - scanning is continuous\r\n    }\r\n  }\r\n\r\n  private async decodeQRCode(imageData: ImageData): Promise<string | null> {\r\n    try {\r\n      const code = jsQR(imageData.data, imageData.width, imageData.height);\r\n      return code ? code.data : null;\r\n    } catch (error) {\r\n      // Silently fail - scanning is continuous\r\n      return null;\r\n    }\r\n  }\r\n\r\n  private notifyListeners(data: string): void {\r\n    this.listeners.forEach(listener => {\r\n      try {\r\n        listener(data);\r\n      } catch (error) {\r\n        console.error('Error in QR scan listener:', error);\r\n      }\r\n    });\r\n  }\r\n\r\n  onScan(callback: (data: string) => void): () => void {\r\n    this.listeners.push(callback);\r\n    return () => {\r\n      this.listeners = this.listeners.filter(l => l !== callback);\r\n    };\r\n  }\r\n}\r\n\r\nexport const qrReaderService = new QRReaderService();\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\lib\\hardware\\receipt-printer.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":8,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":8,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[272,275],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[272,275],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":9,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":9,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[296,299],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[296,299],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":69,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":69,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1686,1689],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1686,1689],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":80,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":80,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2183,2186],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2183,2186],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'data' is defined but never used. Allowed unused args must match /^_/u.","line":294,"column":37,"nodeType":null,"messageId":"unusedVar","endLine":294,"endColumn":41}],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":337,"column":43,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":337,"endColumn":77,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Receipt Printer Service\r\n * Supports ESC/POS printers via WebUSB, Serial API, or network printing\r\n */\r\n\r\n// Web API types (available in browsers that support these APIs)\r\n// Using any for browser APIs that may not have complete type definitions\r\ntype USBDevice = any;\r\ntype SerialPort = any;\r\n\r\nexport interface PrinterConfig {\r\n  type: 'usb' | 'serial' | 'network' | 'browser';\r\n  name?: string;\r\n  vendorId?: number;\r\n  productId?: number;\r\n  port?: string;\r\n  ipAddress?: string;\r\n  portNumber?: number;\r\n}\r\n\r\nexport interface ReceiptData {\r\n  storeName?: string;\r\n  logo?: string;\r\n  address?: string;\r\n  phone?: string;\r\n  email?: string;\r\n  website?: string;\r\n  receiptNumber: string;\r\n  date: string;\r\n  time?: string;\r\n  items: Array<{\r\n    name: string;\r\n    quantity: number;\r\n    price: number;\r\n    subtotal: number;\r\n    sku?: string;\r\n  }>;\r\n  subtotal: number;\r\n  discount?: number;\r\n  tax?: number;\r\n  taxLabel?: string;\r\n  total: number;\r\n  paymentMethod: string;\r\n  cashReceived?: number;\r\n  change?: number;\r\n  footer?: string;\r\n  header?: string;\r\n  customerName?: string;\r\n  customerEmail?: string;\r\n  customerPhone?: string;\r\n  template?: string; // Template HTML to use\r\n}\r\n\r\nclass ReceiptPrinterService {\r\n  private config: PrinterConfig | null = null;\r\n  private device: USBDevice | SerialPort | null = null;\r\n\r\n  async setConfig(config: PrinterConfig): Promise<void> {\r\n    this.config = config;\r\n  }\r\n\r\n  async connect(): Promise<boolean> {\r\n    if (!this.config) {\r\n      throw new Error('Printer configuration not set');\r\n    }\r\n\r\n    try {\r\n      if (this.config.type === 'usb' && 'usb' in navigator) {\r\n        const device = await (navigator as any).usb.requestDevice({\r\n          filters: this.config.vendorId && this.config.productId\r\n            ? [{ vendorId: this.config.vendorId, productId: this.config.productId }]\r\n            : [],\r\n        });\r\n        await device.open();\r\n        await device.selectConfiguration(1);\r\n        await device.claimInterface(0);\r\n        this.device = device;\r\n        return true;\r\n      } else if (this.config.type === 'serial' && 'serial' in navigator) {\r\n        const port = await (navigator as any).serial.requestPort();\r\n        await port.open({ baudRate: 9600 });\r\n        this.device = port;\r\n        return true;\r\n      }\r\n      return false;\r\n    } catch (error) {\r\n      console.error('Failed to connect to printer:', error);\r\n      return false;\r\n    }\r\n  }\r\n\r\n  async disconnect(): Promise<void> {\r\n    if (this.device) {\r\n      if ('close' in this.device) {\r\n        await (this.device as SerialPort).close();\r\n      } else if ('close' in this.device) {\r\n        await (this.device as USBDevice).close();\r\n      }\r\n      this.device = null;\r\n    }\r\n  }\r\n\r\n  private async sendData(data: Uint8Array): Promise<void> {\r\n    if (!this.device || !this.config) {\r\n      // Throw error to be caught by printReceipt's try-catch for fallback\r\n      throw new Error('Printer not connected');\r\n    }\r\n\r\n    try {\r\n      if (this.config.type === 'usb') {\r\n        await (this.device as USBDevice).transferOut(1, data);\r\n      } else if (this.config.type === 'serial') {\r\n        const writer = (this.device as SerialPort).writable.getWriter();\r\n        await writer.write(data);\r\n        writer.releaseLock();\r\n      }\r\n    } catch (error) {\r\n      console.warn('Failed to send data to printer:', error);\r\n      // Re-throw to be caught by printReceipt's try-catch\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  private encodeText(text: string): Uint8Array {\r\n    return new TextEncoder().encode(text);\r\n  }\r\n\r\n  // ESC/POS Commands\r\n  private ESC = 0x1B;\r\n  private GS = 0x1D;\r\n  private LF = 0x0A;\r\n\r\n  private init(): Uint8Array {\r\n    return new Uint8Array([this.ESC, 0x40]); // ESC @ - Initialize printer\r\n  }\r\n\r\n  private cut(): Uint8Array {\r\n    return new Uint8Array([this.GS, 0x56, 0x00]); // GS V 0 - Full cut\r\n  }\r\n\r\n  private feed(lines: number = 3): Uint8Array {\r\n    return new Uint8Array([this.ESC, 0x64, lines]); // ESC d n - Feed n lines\r\n  }\r\n\r\n  private setAlign(align: 'left' | 'center' | 'right'): Uint8Array {\r\n    const alignCodes = { left: 0, center: 1, right: 2 };\r\n    return new Uint8Array([this.ESC, 0x61, alignCodes[align]]);\r\n  }\r\n\r\n  private setFontSize(size: 'normal' | 'large'): Uint8Array {\r\n    if (size === 'large') {\r\n      return new Uint8Array([this.GS, 0x21, 0x11]); // Double width and height\r\n    }\r\n    return new Uint8Array([this.GS, 0x21, 0x00]); // Normal size\r\n  }\r\n\r\n  private setBold(enabled: boolean): Uint8Array {\r\n    return new Uint8Array([this.ESC, 0x45, enabled ? 1 : 0]);\r\n  }\r\n\r\n  async printReceipt(data: ReceiptData): Promise<boolean> {\r\n    try {\r\n      if (this.config?.type === 'browser') {\r\n        // Fallback to browser print dialog\r\n        return this.printViaBrowser(data);\r\n      }\r\n\r\n      if (!this.device && this.config && this.config.type !== 'network') {\r\n        const connected = await this.connect();\r\n        if (!connected) {\r\n          console.warn('Could not connect to printer, falling back to browser print');\r\n          return this.printViaBrowser(data);\r\n        }\r\n      }\r\n\r\n      if (this.config?.type === 'network') {\r\n        return this.printViaNetwork(data);\r\n      }\r\n\r\n      // Build ESC/POS commands\r\n      const commands: Uint8Array[] = [];\r\n\r\n      // Initialize\r\n      commands.push(this.init());\r\n\r\n      // Header\r\n      commands.push(this.setAlign('center'));\r\n      commands.push(this.setFontSize('large'));\r\n      commands.push(this.setBold(true));\r\n      if (data.storeName) {\r\n        commands.push(this.encodeText(data.storeName + '\\n'));\r\n      }\r\n      commands.push(this.setFontSize('normal'));\r\n      commands.push(this.setBold(false));\r\n      if (data.address) {\r\n        commands.push(this.encodeText(data.address + '\\n'));\r\n      }\r\n      if (data.phone) {\r\n        commands.push(this.encodeText(data.phone + '\\n'));\r\n      }\r\n      commands.push(this.encodeText('--------------------------------\\n'));\r\n\r\n      // Receipt info\r\n      commands.push(this.setAlign('left'));\r\n      commands.push(this.encodeText(`Receipt: ${data.receiptNumber}\\n`));\r\n      commands.push(this.encodeText(`Date: ${data.date}\\n`));\r\n      commands.push(this.encodeText('--------------------------------\\n'));\r\n\r\n      // Items\r\n      data.items.forEach((item) => {\r\n        const name = item.name.substring(0, 20).padEnd(20);\r\n        const qty = `x${item.quantity}`.padStart(4);\r\n        const price = `$${item.price.toFixed(2)}`.padStart(8);\r\n        const subtotal = `$${item.subtotal.toFixed(2)}`.padStart(10);\r\n        commands.push(this.encodeText(`${name} ${qty} ${price}\\n`));\r\n        commands.push(this.encodeText(`${subtotal}\\n`));\r\n      });\r\n\r\n      commands.push(this.encodeText('--------------------------------\\n'));\r\n\r\n      // Totals\r\n      commands.push(this.setAlign('right'));\r\n      commands.push(this.encodeText(`Subtotal: $${data.subtotal.toFixed(2)}\\n`));\r\n      if (data.tax) {\r\n        commands.push(this.encodeText(`Tax: $${data.tax.toFixed(2)}\\n`));\r\n      }\r\n      commands.push(this.setBold(true));\r\n      commands.push(this.encodeText(`TOTAL: $${data.total.toFixed(2)}\\n`));\r\n      commands.push(this.setBold(false));\r\n\r\n      commands.push(this.encodeText('--------------------------------\\n'));\r\n      commands.push(this.setAlign('left'));\r\n      commands.push(this.encodeText(`Payment: ${data.paymentMethod}\\n`));\r\n      if (data.cashReceived) {\r\n        commands.push(this.encodeText(`Cash: $${data.cashReceived.toFixed(2)}\\n`));\r\n      }\r\n      if (data.change) {\r\n        commands.push(this.encodeText(`Change: $${data.change.toFixed(2)}\\n`));\r\n      }\r\n\r\n      // Footer\r\n      if (data.footer) {\r\n        commands.push(this.encodeText('--------------------------------\\n'));\r\n        commands.push(this.setAlign('center'));\r\n        commands.push(this.encodeText(data.footer + '\\n'));\r\n      }\r\n\r\n      // Feed and cut\r\n      commands.push(this.feed(3));\r\n      commands.push(this.cut());\r\n\r\n      // Check if printer is connected before attempting to send commands\r\n      if (!this.device || !this.config) {\r\n        console.warn('Printer not connected, falling back to browser print');\r\n        return this.printViaBrowser(data);\r\n      }\r\n\r\n      // Send all commands\r\n      for (const cmd of commands) {\r\n        await this.sendData(cmd);\r\n      }\r\n\r\n      return true;\r\n    } catch (error) {\r\n      console.error('Print error:', error);\r\n      // Fallback to browser print\r\n      return this.printViaBrowser(data);\r\n    }\r\n  }\r\n\r\n  private async printViaNetwork(data: ReceiptData): Promise<boolean> {\r\n    if (!this.config?.ipAddress) {\r\n      return false;\r\n    }\r\n\r\n    try {\r\n      // Send ESC/POS commands via HTTP POST to printer\r\n      const commands = await this.buildEscPosCommands(data);\r\n      const response = await fetch(`http://${this.config.ipAddress}:${this.config.portNumber || 9100}`, {\r\n        method: 'POST',\r\n        body: commands as unknown as BodyInit,\r\n        headers: {\r\n          'Content-Type': 'application/octet-stream',\r\n        },\r\n      });\r\n\r\n      return response.ok;\r\n    } catch (error) {\r\n      console.error('Network print error:', error);\r\n      return false;\r\n    }\r\n  }\r\n\r\n  private async buildEscPosCommands(data: ReceiptData): Promise<Uint8Array> {\r\n    const commands: Uint8Array[] = [];\r\n    // Same command building as printReceipt but return as single array\r\n    // (Implementation similar to printReceipt method)\r\n    commands.push(this.init());\r\n    // ... build commands ...\r\n    commands.push(this.cut());\r\n\r\n    // Combine all commands\r\n    const totalLength = commands.reduce((sum, cmd) => sum + cmd.length, 0);\r\n    const combined = new Uint8Array(totalLength);\r\n    let offset = 0;\r\n    for (const cmd of commands) {\r\n      combined.set(cmd, offset);\r\n      offset += cmd.length;\r\n    }\r\n    return combined;\r\n  }\r\n\r\n  private printViaBrowser(data: ReceiptData): boolean {\r\n    const printWindow = window.open('', '_blank');\r\n    if (!printWindow) {\r\n      return false;\r\n    }\r\n\r\n    const html = this.generateReceiptHTML(data);\r\n    printWindow.document.write(html);\r\n    printWindow.document.close();\r\n    printWindow.focus();\r\n    setTimeout(() => {\r\n      printWindow.print();\r\n      printWindow.close();\r\n    }, 250);\r\n\r\n    return true;\r\n  }\r\n\r\n  private generateReceiptHTML(data: ReceiptData): string {\r\n    // If custom template is provided, use it\r\n    if (data.template) {\r\n      try {\r\n        // Import template rendering function dynamically to avoid circular dependencies\r\n        // eslint-disable-next-line @typescript-eslint/no-require-imports\r\n        const { renderReceiptTemplate } = require('@/lib/receipt-templates');\r\n        return renderReceiptTemplate(data.template, data);\r\n      } catch (error) {\r\n        console.error('Error rendering receipt template:', error);\r\n        // Fall through to default template\r\n      }\r\n    }\r\n\r\n    // Default template\r\n    return `\r\n      <!DOCTYPE html>\r\n      <html>\r\n        <head>\r\n          <title>Receipt</title>\r\n          <style>\r\n            @media print {\r\n              @page { margin: 0; size: 80mm auto; }\r\n              body { margin: 0; padding: 10px; }\r\n            }\r\n            body {\r\n              font-family: 'Courier New', monospace;\r\n              font-size: 12px;\r\n              width: 80mm;\r\n              margin: 0 auto;\r\n              padding: 10px;\r\n            }\r\n            .header { text-align: center; border-bottom: 2px dashed #000; padding-bottom: 10px; margin-bottom: 10px; }\r\n            .item { display: flex; justify-content: space-between; margin-bottom: 5px; }\r\n            .total { border-top: 2px dashed #000; padding-top: 10px; margin-top: 10px; font-weight: bold; }\r\n            .footer { text-align: center; margin-top: 20px; font-size: 10px; }\r\n          </style>\r\n        </head>\r\n        <body>\r\n          <div class=\"header\">\r\n            ${data.storeName ? `<h2>${data.storeName}</h2>` : ''}\r\n            ${data.logo ? `<img src=\"${data.logo}\" alt=\"Logo\" style=\"max-width: 100px; max-height: 60px;\" />` : ''}\r\n            <p>Receipt #${data.receiptNumber}</p>\r\n            <p>${data.date}${data.time ? ` ${data.time}` : ''}</p>\r\n            ${data.address ? `<p>${data.address}</p>` : ''}\r\n            ${data.phone ? `<p>${data.phone}</p>` : ''}\r\n            ${data.email ? `<p>${data.email}</p>` : ''}\r\n            ${data.header ? `<p>${data.header}</p>` : ''}\r\n          </div>\r\n          ${data.items.map(item => `\r\n            <div class=\"item\">\r\n              <div>\r\n                <div>${item.name} x${item.quantity}</div>\r\n                <div style=\"font-size: 10px;\">@ $${item.price.toFixed(2)}</div>\r\n              </div>\r\n              <div>$${item.subtotal.toFixed(2)}</div>\r\n            </div>\r\n          `).join('')}\r\n          <div class=\"total\">\r\n            <div class=\"item\">\r\n              <div>Subtotal:</div>\r\n              <div>$${data.subtotal.toFixed(2)}</div>\r\n            </div>\r\n            ${data.discount ? `\r\n              <div class=\"item\">\r\n                <div>Discount:</div>\r\n                <div>-$${data.discount.toFixed(2)}</div>\r\n              </div>\r\n            ` : ''}\r\n            ${data.tax ? `\r\n              <div class=\"item\">\r\n                <div>${data.taxLabel || 'Tax'}:</div>\r\n                <div>$${data.tax.toFixed(2)}</div>\r\n              </div>\r\n            ` : ''}\r\n            <div class=\"item\">\r\n              <div>TOTAL:</div>\r\n              <div>$${data.total.toFixed(2)}</div>\r\n            </div>\r\n            <div class=\"item\">\r\n              <div>Payment:</div>\r\n              <div>${data.paymentMethod}</div>\r\n            </div>\r\n            ${data.cashReceived ? `\r\n              <div class=\"item\">\r\n                <div>Cash:</div>\r\n                <div>$${data.cashReceived.toFixed(2)}</div>\r\n              </div>\r\n            ` : ''}\r\n            ${data.change ? `\r\n              <div class=\"item\">\r\n                <div>Change:</div>\r\n                <div>$${data.change.toFixed(2)}</div>\r\n              </div>\r\n            ` : ''}\r\n          </div>\r\n          ${data.footer ? `<div class=\"footer\">${data.footer}</div>` : ''}\r\n        </body>\r\n      </html>\r\n    `;\r\n  }\r\n\r\n  async openCashDrawer(): Promise<boolean> {\r\n    try {\r\n      if (this.config?.type === 'browser' || !this.device) {\r\n        return false;\r\n      }\r\n\r\n      // ESC/POS command to open cash drawer (pulse pin 2)\r\n      const command = new Uint8Array([\r\n        this.ESC, 0x70, 0x00, 0x19, 0xFF // ESC p m t1 t2\r\n      ]);\r\n\r\n      await this.sendData(command);\r\n      return true;\r\n    } catch (error) {\r\n      console.error('Failed to open cash drawer:', error);\r\n      return false;\r\n    }\r\n  }\r\n}\r\n\r\nexport const receiptPrinterService = new ReceiptPrinterService();\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\lib\\hardware\\status-checker.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'receiptPrinterService' is defined but never used. Allowed unused vars must match /^_/u.","line":7,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":31},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'barcodeScannerService' is defined but never used. Allowed unused vars must match /^_/u.","line":8,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":31},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'qrReaderService' is defined but never used. Allowed unused vars must match /^_/u.","line":9,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":25},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":79,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":79,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2440,2443],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2440,2443],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":153,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":153,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4839,4842],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4839,4842],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'response' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":171,"column":15,"nodeType":null,"messageId":"unusedVar","endLine":171,"endColumn":23},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":175,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":175,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5571,5574],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5571,5574],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":184,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":184,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6000,6003],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6000,6003],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":189,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":189,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6153,6156],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6153,6156],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":209,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":209,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6772,6775],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6772,6775],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":237,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":237,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7501,7504],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7501,7504],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":237,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":237,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7521,7524],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7521,7524],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":274,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":274,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8549,8552],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8549,8552],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":326,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":326,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10359,10362],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10359,10362],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":339,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":339,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10773,10776],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10773,10776],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":15,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Hardware Status Checker\r\n * Checks the status and availability of all hardware devices\r\n */\r\n\r\nimport { hardwareService } from './index';\r\nimport { receiptPrinterService } from './receipt-printer';\r\nimport { barcodeScannerService } from './barcode-scanner';\r\nimport { qrReaderService } from './qr-reader';\r\n\r\nexport interface DeviceStatus {\r\n  name: string;\r\n  type: 'printer' | 'barcode-scanner' | 'qr-reader' | 'cash-drawer' | 'touchscreen';\r\n  status: 'connected' | 'disconnected' | 'error' | 'not-configured' | 'available';\r\n  message?: string;\r\n  lastChecked?: Date;\r\n}\r\n\r\nexport interface HardwareStatus {\r\n  devices: DeviceStatus[];\r\n  overallStatus: 'all-connected' | 'partial' | 'none';\r\n  lastCheck: Date;\r\n}\r\n\r\nclass HardwareStatusChecker {\r\n  private statusCache: HardwareStatus | null = null;\r\n  private cacheTimeout = 5000; // Cache for 5 seconds\r\n  private lastCheckTime = 0;\r\n\r\n  async checkAllDevices(): Promise<HardwareStatus> {\r\n    const now = Date.now();\r\n    \r\n    // Return cached status if still valid\r\n    if (this.statusCache && (now - this.lastCheckTime) < this.cacheTimeout) {\r\n      return this.statusCache;\r\n    }\r\n\r\n    const devices: DeviceStatus[] = [];\r\n    const config = hardwareService.getConfig();\r\n\r\n    // Check Receipt Printer\r\n    const printerStatus = await this.checkPrinter(config.printer);\r\n    devices.push(printerStatus);\r\n\r\n    // Check Barcode Scanner\r\n    const scannerStatus = this.checkBarcodeScanner(config.barcodeScanner);\r\n    devices.push(scannerStatus);\r\n\r\n    // Check QR Reader\r\n    const qrStatus = this.checkQRReader(config.qrReader);\r\n    devices.push(qrStatus);\r\n\r\n    // Check Cash Drawer\r\n    const drawerStatus = this.checkCashDrawer(config.cashDrawer, config.printer);\r\n    devices.push(drawerStatus);\r\n\r\n    // Check Touchscreen\r\n    const touchscreenStatus = this.checkTouchscreen(config.touchscreen);\r\n    devices.push(touchscreenStatus);\r\n\r\n    // Determine overall status\r\n    const connectedCount = devices.filter(d => d.status === 'connected' || d.status === 'available').length;\r\n    const overallStatus = connectedCount === devices.length \r\n      ? 'all-connected' \r\n      : connectedCount > 0 \r\n        ? 'partial' \r\n        : 'none';\r\n\r\n    this.statusCache = {\r\n      devices,\r\n      overallStatus,\r\n      lastCheck: new Date(),\r\n    };\r\n    this.lastCheckTime = now;\r\n\r\n    return this.statusCache;\r\n  }\r\n\r\n  private async checkPrinter(printerConfig: any): Promise<DeviceStatus> {\r\n    if (!printerConfig) {\r\n      return {\r\n        name: 'Receipt Printer',\r\n        type: 'printer',\r\n        status: 'not-configured',\r\n        message: 'No printer configured',\r\n      };\r\n    }\r\n\r\n    try {\r\n      switch (printerConfig.type) {\r\n        case 'usb':\r\n          // Check if WebUSB is available\r\n          if (!('usb' in navigator)) {\r\n            return {\r\n              name: 'USB Printer',\r\n              type: 'printer',\r\n              status: 'error',\r\n              message: 'WebUSB not supported in this browser',\r\n            };\r\n          }\r\n          // Note: Can't actually check connection without user interaction\r\n          return {\r\n            name: 'USB Printer',\r\n            type: 'printer',\r\n            status: 'available',\r\n            message: 'USB printer configured (requires connection test)',\r\n          };\r\n\r\n        case 'serial':\r\n          // Check if Serial API is available\r\n          if (!('serial' in navigator)) {\r\n            return {\r\n              name: 'Serial Printer',\r\n              type: 'printer',\r\n              status: 'error',\r\n              message: 'Serial API not supported in this browser',\r\n            };\r\n          }\r\n          return {\r\n            name: 'Serial Printer',\r\n            type: 'printer',\r\n            status: 'available',\r\n            message: 'Serial printer configured (requires connection test)',\r\n          };\r\n\r\n        case 'network':\r\n          if (!printerConfig.ipAddress) {\r\n            return {\r\n              name: 'Network Printer',\r\n              type: 'printer',\r\n              status: 'not-configured',\r\n              message: 'IP address not configured',\r\n            };\r\n          }\r\n          // Try to ping the printer\r\n          const networkStatus = await this.checkNetworkPrinter(printerConfig.ipAddress, printerConfig.portNumber || 9100);\r\n          return {\r\n            name: `Network Printer (${printerConfig.ipAddress})`,\r\n            type: 'printer',\r\n            status: networkStatus.connected ? 'connected' : 'disconnected',\r\n            message: networkStatus.message,\r\n          };\r\n\r\n        case 'browser':\r\n        default:\r\n          return {\r\n            name: 'Browser Print',\r\n            type: 'printer',\r\n            status: 'available',\r\n            message: 'Browser print dialog available',\r\n          };\r\n      }\r\n    } catch (error: any) {\r\n      return {\r\n        name: 'Receipt Printer',\r\n        type: 'printer',\r\n        status: 'error',\r\n        message: error.message || 'Unknown error',\r\n      };\r\n    }\r\n  }\r\n\r\n  private async checkNetworkPrinter(ip: string, port: number): Promise<{ connected: boolean; message: string }> {\r\n    try {\r\n      // Try to connect to printer port (with timeout)\r\n      const controller = new AbortController();\r\n      const timeoutId = setTimeout(() => controller.abort(), 2000);\r\n\r\n      try {\r\n        // Note: CORS will likely block this, but we can try\r\n        const response = await fetch(`http://${ip}:${port}`, {\r\n          method: 'GET',\r\n          signal: controller.signal,\r\n          mode: 'no-cors',\r\n        } as any);\r\n        clearTimeout(timeoutId);\r\n        return { connected: true, message: 'Printer reachable' };\r\n      } catch (error) {\r\n        clearTimeout(timeoutId);\r\n        // Even if fetch fails, the printer might be reachable (CORS issue)\r\n        // We'll assume it's configured correctly\r\n        return { connected: true, message: 'Printer configured (connection test limited by browser)' };\r\n      }\r\n    } catch (error: any) {\r\n      return { connected: false, message: error.message || 'Cannot reach printer' };\r\n    }\r\n  }\r\n\r\n  private checkBarcodeScanner(scannerConfig: any): DeviceStatus {\r\n    if (!scannerConfig || !scannerConfig.enabled) {\r\n      return {\r\n        name: 'Barcode Scanner',\r\n        type: 'barcode-scanner',\r\n        status: 'not-configured',\r\n        message: 'Barcode scanner not enabled',\r\n      };\r\n    }\r\n\r\n    // Barcode scanners work as keyboard input, so they're always \"available\"\r\n    // if enabled. We can't actually detect if one is connected.\r\n    return {\r\n      name: 'Barcode Scanner',\r\n      type: 'barcode-scanner',\r\n      status: 'available',\r\n      message: 'Scanner enabled (keyboard input mode)',\r\n    };\r\n  }\r\n\r\n  private checkQRReader(qrConfig: any): DeviceStatus {\r\n    if (!qrConfig || !qrConfig.enabled) {\r\n      return {\r\n        name: 'QR Code Reader',\r\n        type: 'qr-reader',\r\n        status: 'not-configured',\r\n        message: 'QR code reader not enabled',\r\n      };\r\n    }\r\n\r\n    // Check if camera access is available\r\n    if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {\r\n      return {\r\n        name: 'QR Code Reader',\r\n        type: 'qr-reader',\r\n        status: 'error',\r\n        message: 'Camera API not available',\r\n      };\r\n    }\r\n\r\n    return {\r\n      name: 'QR Code Reader',\r\n      type: 'qr-reader',\r\n      status: 'available',\r\n      message: 'Camera access available',\r\n    };\r\n  }\r\n\r\n  private checkCashDrawer(drawerConfig: any, printerConfig: any): DeviceStatus {\r\n    if (!drawerConfig || !drawerConfig.enabled) {\r\n      return {\r\n        name: 'Cash Drawer',\r\n        type: 'cash-drawer',\r\n        status: 'not-configured',\r\n        message: 'Cash drawer not enabled',\r\n      };\r\n    }\r\n\r\n    if (drawerConfig.connectedToPrinter) {\r\n      // Cash drawer status depends on printer status\r\n      if (!printerConfig) {\r\n        return {\r\n          name: 'Cash Drawer',\r\n          type: 'cash-drawer',\r\n          status: 'error',\r\n          message: 'Cash drawer requires printer configuration',\r\n        };\r\n      }\r\n      return {\r\n        name: 'Cash Drawer',\r\n        type: 'cash-drawer',\r\n        status: 'available',\r\n        message: 'Connected to printer',\r\n      };\r\n    }\r\n\r\n    // Direct cash drawer connection (not implemented yet)\r\n    return {\r\n      name: 'Cash Drawer',\r\n      type: 'cash-drawer',\r\n      status: 'not-configured',\r\n      message: 'Direct cash drawer connection not configured',\r\n    };\r\n  }\r\n\r\n  private checkTouchscreen(touchscreenConfig: any): DeviceStatus {\r\n    const hasTouch = hardwareService.isTouchscreen();\r\n    \r\n    if (!touchscreenConfig || !touchscreenConfig.enabled) {\r\n      return {\r\n        name: 'Touchscreen Display',\r\n        type: 'touchscreen',\r\n        status: hasTouch ? 'available' : 'not-configured',\r\n        message: hasTouch \r\n          ? 'Touchscreen detected but optimizations disabled' \r\n          : 'No touchscreen detected',\r\n      };\r\n    }\r\n\r\n    return {\r\n      name: 'Touchscreen Display',\r\n      type: 'touchscreen',\r\n      status: hasTouch ? 'connected' : 'disconnected',\r\n      message: hasTouch \r\n        ? 'Touchscreen detected and optimized' \r\n        : 'Touchscreen optimizations enabled but no touchscreen detected',\r\n    };\r\n  }\r\n\r\n  async testDevice(deviceType: string): Promise<{ success: boolean; message: string }> {\r\n    const config = hardwareService.getConfig();\r\n\r\n    switch (deviceType) {\r\n      case 'printer':\r\n        if (!config.printer) {\r\n          return { success: false, message: 'No printer configured' };\r\n        }\r\n        try {\r\n          const testReceipt = {\r\n            storeName: 'Test Store',\r\n            receiptNumber: 'TEST-001',\r\n            date: new Date().toLocaleString(),\r\n            items: [{ name: 'Test Item', quantity: 1, price: 10.00, subtotal: 10.00 }],\r\n            subtotal: 10.00,\r\n            total: 10.00,\r\n            paymentMethod: 'cash',\r\n            cashReceived: 20.00,\r\n            change: 10.00,\r\n            footer: 'Hardware Status Test',\r\n          };\r\n          const success = await hardwareService.printReceipt(testReceipt);\r\n          return { \r\n            success, \r\n            message: success \r\n              ? 'Test receipt sent successfully' \r\n              : 'Failed to send test receipt' \r\n          };\r\n        } catch (error: any) {\r\n          return { success: false, message: error.message || 'Print test failed' };\r\n        }\r\n\r\n      case 'cash-drawer':\r\n        try {\r\n          const success = await hardwareService.openCashDrawer();\r\n          return { \r\n            success, \r\n            message: success \r\n              ? 'Cash drawer opened' \r\n              : 'Failed to open cash drawer' \r\n          };\r\n        } catch (error: any) {\r\n          return { success: false, message: error.message || 'Cash drawer test failed' };\r\n        }\r\n\r\n      case 'barcode-scanner':\r\n        // Can't really test without actual scan\r\n        return { success: true, message: 'Scan a barcode to test' };\r\n\r\n      case 'qr-reader':\r\n        // Can't test without camera access\r\n        return { success: true, message: 'Open QR scanner to test' };\r\n\r\n      default:\r\n        return { success: false, message: 'Unknown device type' };\r\n    }\r\n  }\r\n\r\n  clearCache(): void {\r\n    this.statusCache = null;\r\n    this.lastCheckTime = 0;\r\n  }\r\n}\r\n\r\nexport const hardwareStatusChecker = new HardwareStatusChecker();\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\lib\\location-detection.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\lib\\mongodb.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":18,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":18,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[466,469],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[466,469],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":20,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":20,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[537,540],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[537,540],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":21,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":21,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[572,575],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[572,575],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import mongoose from 'mongoose';\r\n\r\nconst MONGODB_URI = process.env.MONGODB_URI || 'mongodb://localhost:27017/pos-system';\r\n\r\nif (!MONGODB_URI) {\r\n  throw new Error('Please define the MONGODB_URI environment variable inside .env.local');\r\n}\r\n\r\ninterface MongooseCache {\r\n  conn: typeof mongoose | null;\r\n  promise: Promise<typeof mongoose> | null;\r\n}\r\n\r\ndeclare global {\r\n  var mongoose: MongooseCache | undefined;\r\n}\r\n\r\nconst cached: MongooseCache = (globalThis as any).mongoose || { conn: null, promise: null };\r\n\r\nif (!(globalThis as any).mongoose) {\r\n  (globalThis as any).mongoose = cached;\r\n}\r\n\r\nasync function connectDB(): Promise<typeof mongoose> {\r\n  if (cached.conn) {\r\n    return cached.conn;\r\n  }\r\n\r\n  if (!cached.promise) {\r\n    const opts = {\r\n      bufferCommands: false,\r\n    };\r\n\r\n    cached.promise = mongoose.connect(MONGODB_URI, opts).then((mongoose) => {\r\n      return mongoose;\r\n    });\r\n  }\r\n\r\n  try {\r\n    cached.conn = await cached.promise;\r\n  } catch (e) {\r\n    cached.promise = null;\r\n    throw e;\r\n  }\r\n\r\n  return cached.conn;\r\n}\r\n\r\nexport default connectDB;\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\lib\\multi-currency.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'formatNumber' is defined but never used. Allowed unused vars must match /^_/u.","line":7,"column":26,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":38}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Multi-Currency Support\r\n * Handles exchange rates and currency conversion\r\n */\r\n\r\nimport { ITenantSettings } from '@/models/Tenant';\r\nimport { formatCurrency, formatNumber } from './currency';\r\n\r\nexport interface ExchangeRateResponse {\r\n  base: string;\r\n  rates: Record<string, number>;\r\n  date?: string;\r\n}\r\n\r\n/**\r\n * Fetch exchange rates from API\r\n * Supports multiple providers: exchangerate-api.com (free tier), fixer.io, etc.\r\n */\r\nexport async function fetchExchangeRates(\r\n  baseCurrency: string,\r\n  targetCurrencies: string[],\r\n  apiKey?: string\r\n): Promise<Record<string, number> | null> {\r\n  try {\r\n    // Try exchangerate-api.com first (free, no API key needed for basic usage)\r\n    if (!apiKey) {\r\n      const response = await fetch(`https://api.exchangerate-api.com/v4/latest/${baseCurrency}`);\r\n      if (response.ok) {\r\n        const data = await response.json();\r\n        const rates: Record<string, number> = {};\r\n        targetCurrencies.forEach((currency) => {\r\n          if (data.rates && data.rates[currency]) {\r\n            rates[currency] = data.rates[currency];\r\n          }\r\n        });\r\n        return rates;\r\n      }\r\n    }\r\n\r\n    // Try Fixer.io if API key is provided\r\n    if (apiKey) {\r\n      const response = await fetch(\r\n        `https://api.fixer.io/latest?access_key=${apiKey}&base=${baseCurrency}&symbols=${targetCurrencies.join(',')}`\r\n      );\r\n      if (response.ok) {\r\n        const data: ExchangeRateResponse = await response.json();\r\n        return data.rates || null;\r\n      }\r\n    }\r\n\r\n    return null;\r\n  } catch (error) {\r\n    console.error('Error fetching exchange rates:', error);\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Convert amount from one currency to another\r\n */\r\nexport function convertCurrency(\r\n  amount: number,\r\n  fromCurrency: string,\r\n  toCurrency: string,\r\n  exchangeRates: Record<string, number>\r\n): number {\r\n  if (fromCurrency === toCurrency) {\r\n    return amount;\r\n  }\r\n\r\n  // If converting from base currency\r\n  if (exchangeRates[toCurrency]) {\r\n    return amount * exchangeRates[toCurrency];\r\n  }\r\n\r\n  // If converting to base currency\r\n  if (exchangeRates[fromCurrency]) {\r\n    return amount / exchangeRates[fromCurrency];\r\n  }\r\n\r\n  // Cross-currency conversion (via base)\r\n  // This assumes base currency is in the rates\r\n  // For simplicity, we'll use direct rate if available\r\n  return amount;\r\n}\r\n\r\n/**\r\n * Format amount in multiple currencies\r\n */\r\nexport function formatMultiCurrency(\r\n  amount: number,\r\n  baseCurrency: string,\r\n  displayCurrencies: string[],\r\n  exchangeRates: Record<string, number>,\r\n  settings: ITenantSettings\r\n): Array<{ currency: string; formatted: string; amount: number }> {\r\n  const results: Array<{ currency: string; formatted: string; amount: number }> = [];\r\n\r\n  displayCurrencies.forEach((currency) => {\r\n    const convertedAmount = convertCurrency(amount, baseCurrency, currency, exchangeRates);\r\n    \r\n    // Create temporary settings for this currency\r\n    const tempSettings: ITenantSettings = {\r\n      ...settings,\r\n      currency,\r\n      currencySymbol: undefined, // Will be auto-detected\r\n    };\r\n\r\n    results.push({\r\n      currency,\r\n      formatted: formatCurrency(convertedAmount, tempSettings),\r\n      amount: convertedAmount,\r\n    });\r\n  });\r\n\r\n  return results;\r\n}\r\n\r\n/**\r\n * Get exchange rate for a specific currency pair\r\n */\r\nexport function getExchangeRate(\r\n  fromCurrency: string,\r\n  toCurrency: string,\r\n  exchangeRates: Record<string, number>\r\n): number | null {\r\n  if (fromCurrency === toCurrency) {\r\n    return 1;\r\n  }\r\n\r\n  if (exchangeRates[toCurrency]) {\r\n    return exchangeRates[toCurrency];\r\n  }\r\n\r\n  return null;\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\lib\\notification-templates.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":248,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":248,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7859,7862],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7859,7862],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Notification Template System\r\n * Manages email and SMS templates with variable substitution\r\n */\r\n\r\nimport { ITenantSettings } from '@/models/Tenant';\r\nimport { formatDate, formatTime } from './formatting';\r\n\r\nexport interface NotificationTemplate {\r\n  id: string;\r\n  name: string;\r\n  type: 'email' | 'sms';\r\n  category: 'booking' | 'stock' | 'attendance' | 'transaction';\r\n  subject?: string; // For email only\r\n  body: string;\r\n  variables?: string[]; // Available variables\r\n}\r\n\r\nexport interface TemplateVariables {\r\n  [key: string]: string | number | Date | undefined;\r\n}\r\n\r\n/**\r\n * Default notification templates\r\n */\r\nexport const DEFAULT_NOTIFICATION_TEMPLATES: Record<string, NotificationTemplate> = {\r\n  email_booking_confirmation: {\r\n    id: 'email_booking_confirmation',\r\n    name: 'Booking Confirmation (Email)',\r\n    type: 'email',\r\n    category: 'booking',\r\n    subject: 'Booking Confirmation: {{serviceName}}',\r\n    body: `Hello {{customerName}},\r\n\r\nYour booking for {{serviceName}} is confirmed.\r\n\r\nDate: {{date}}\r\nTime: {{time}}\r\n{{#if staffName}}Staff: {{staffName}}{{/if}}\r\n{{#if notes}}Notes: {{notes}}{{/if}}\r\n\r\nWe look forward to seeing you!\r\n\r\nBest regards,\r\n{{companyName}}`,\r\n    variables: ['customerName', 'serviceName', 'date', 'time', 'staffName', 'notes', 'companyName'],\r\n  },\r\n  sms_booking_confirmation: {\r\n    id: 'sms_booking_confirmation',\r\n    name: 'Booking Confirmation (SMS)',\r\n    type: 'sms',\r\n    category: 'booking',\r\n    body: `Hi {{customerName}}, your booking for {{serviceName}} is confirmed for {{date}} at {{time}}. See you soon!`,\r\n    variables: ['customerName', 'serviceName', 'date', 'time'],\r\n  },\r\n  email_booking_reminder: {\r\n    id: 'email_booking_reminder',\r\n    name: 'Booking Reminder (Email)',\r\n    type: 'email',\r\n    category: 'booking',\r\n    subject: 'Reminder: {{serviceName}} Booking',\r\n    body: `Hello {{customerName}},\r\n\r\nThis is a reminder that you have a booking for {{serviceName}}.\r\n\r\nDate: {{date}}\r\nTime: {{time}}\r\n{{#if staffName}}Staff: {{staffName}}{{/if}}\r\n\r\nSee you soon!\r\n\r\nBest regards,\r\n{{companyName}}`,\r\n    variables: ['customerName', 'serviceName', 'date', 'time', 'staffName', 'companyName'],\r\n  },\r\n  sms_booking_reminder: {\r\n    id: 'sms_booking_reminder',\r\n    name: 'Booking Reminder (SMS)',\r\n    type: 'sms',\r\n    category: 'booking',\r\n    body: `Reminder: You have a booking for {{serviceName}} on {{date}} at {{time}}. See you soon!`,\r\n    variables: ['customerName', 'serviceName', 'date', 'time'],\r\n  },\r\n  email_low_stock: {\r\n    id: 'email_low_stock',\r\n    name: 'Low Stock Alert (Email)',\r\n    type: 'email',\r\n    category: 'stock',\r\n    subject: 'Low Stock Alert: {{productName}}',\r\n    body: `Hello,\r\n\r\nThis is an automated alert that the following product is running low on stock:\r\n\r\nProduct: {{productName}}\r\nSKU: {{sku}}\r\nCurrent Stock: {{currentStock}}\r\nThreshold: {{threshold}}\r\n\r\nPlease consider restocking soon.\r\n\r\nBest regards,\r\n{{companyName}}`,\r\n    variables: ['productName', 'sku', 'currentStock', 'threshold', 'companyName'],\r\n  },\r\n  sms_low_stock: {\r\n    id: 'sms_low_stock',\r\n    name: 'Low Stock Alert (SMS)',\r\n    type: 'sms',\r\n    category: 'stock',\r\n    body: `Low stock alert: {{productName}} ({{sku}}) has {{currentStock}} units remaining. Threshold: {{threshold}}`,\r\n    variables: ['productName', 'sku', 'currentStock', 'threshold'],\r\n  },\r\n};\r\n\r\n/**\r\n * Render notification template with variables\r\n */\r\nexport function renderNotificationTemplate(\r\n  template: string,\r\n  variables: TemplateVariables,\r\n  settings?: ITenantSettings\r\n): string {\r\n  let rendered = template;\r\n\r\n  // Format dates if they exist and settings are provided\r\n  if (settings) {\r\n    if (variables.date && variables.date instanceof Date) {\r\n      variables.date = formatDate(variables.date, settings);\r\n    }\r\n    if (variables.time && variables.time instanceof Date) {\r\n      variables.time = formatTime(variables.time, settings);\r\n    }\r\n    if (variables.startTime && variables.startTime instanceof Date) {\r\n      variables.startTime = formatTime(variables.startTime, settings);\r\n    }\r\n    if (variables.endTime && variables.endTime instanceof Date) {\r\n      variables.endTime = formatTime(variables.endTime, settings);\r\n    }\r\n  } else {\r\n    // Use default formatting if settings not provided\r\n    if (variables.date && variables.date instanceof Date) {\r\n      variables.date = variables.date.toLocaleDateString();\r\n    }\r\n    if (variables.time && variables.time instanceof Date) {\r\n      variables.time = variables.time.toLocaleTimeString();\r\n    }\r\n    if (variables.startTime && variables.startTime instanceof Date) {\r\n      variables.startTime = variables.startTime.toLocaleTimeString();\r\n    }\r\n    if (variables.endTime && variables.endTime instanceof Date) {\r\n      variables.endTime = variables.endTime.toLocaleTimeString();\r\n    }\r\n  }\r\n\r\n  // Replace simple variables {{variable}}\r\n  rendered = rendered.replace(/\\{\\{(\\w+)\\}\\}/g, (match, key) => {\r\n    const value = variables[key];\r\n    return value !== undefined && value !== null ? String(value) : '';\r\n  });\r\n\r\n  // Handle {{#if condition}} blocks\r\n  rendered = rendered.replace(/\\{\\{#if\\s+(\\w+)\\}\\}([\\s\\S]*?)\\{\\{\\/if\\}\\}/g, (match, condition, content) => {\r\n    const value = variables[condition];\r\n    // Check if value exists and is truthy (not empty string, not 0, not undefined/null)\r\n    if (value !== undefined && value !== null && value !== '' && value !== 0) {\r\n      return processTemplateContent(content, variables);\r\n    }\r\n    return '';\r\n  });\r\n\r\n  return rendered;\r\n}\r\n\r\n/**\r\n * Process template content recursively\r\n */\r\nfunction processTemplateContent(content: string, variables: TemplateVariables): string {\r\n  let processed = content;\r\n\r\n  // Replace variables\r\n  processed = processed.replace(/\\{\\{(\\w+)\\}\\}/g, (match, key) => {\r\n    const value = variables[key];\r\n    return value !== undefined && value !== null ? String(value) : '';\r\n  });\r\n\r\n  // Handle nested if blocks\r\n  processed = processed.replace(/\\{\\{#if\\s+(\\w+)\\}\\}([\\s\\S]*?)\\{\\{\\/if\\}\\}/g, (match, condition, nestedContent) => {\r\n    const value = variables[condition];\r\n    // Check if value exists and is truthy (not empty string, not 0, not undefined/null)\r\n    if (value !== undefined && value !== null && value !== '' && value !== 0) {\r\n      return processTemplateContent(nestedContent, variables);\r\n    }\r\n    return '';\r\n  });\r\n\r\n  return processed;\r\n}\r\n\r\n/**\r\n * Get default template for a notification type\r\n */\r\nexport function getDefaultTemplate(\r\n  type: 'email' | 'sms',\r\n  category: 'booking' | 'stock' | 'attendance' | 'transaction',\r\n  subcategory?: string\r\n): NotificationTemplate | null {\r\n  const key = `${type}_${category}${subcategory ? `_${subcategory}` : ''}`;\r\n  return DEFAULT_NOTIFICATION_TEMPLATES[key] || null;\r\n}\r\n\r\n/**\r\n * Extract variables from template\r\n */\r\nexport function extractTemplateVariables(template: string): string[] {\r\n  const variables = new Set<string>();\r\n  \r\n  // Find all {{variable}} patterns\r\n  const matches = template.matchAll(/\\{\\{(\\w+)\\}\\}/g);\r\n  for (const match of matches) {\r\n    variables.add(match[1]);\r\n  }\r\n\r\n  // Find variables in {{#if variable}} blocks\r\n  const ifMatches = template.matchAll(/\\{\\{#if\\s+(\\w+)\\}\\}/g);\r\n  for (const match of ifMatches) {\r\n    variables.add(match[1]);\r\n  }\r\n\r\n  return Array.from(variables);\r\n}\r\n\r\n/**\r\n * Validate template\r\n */\r\nexport function validateNotificationTemplate(template: string): { valid: boolean; error?: string } {\r\n  try {\r\n    // Check for balanced tags\r\n    const ifMatches = template.match(/\\{\\{#if/g) || [];\r\n    const endIfMatches = template.match(/\\{\\{\\/if\\}\\}/g) || [];\r\n    if (ifMatches.length !== endIfMatches.length) {\r\n      return {\r\n        valid: false,\r\n        error: 'Unbalanced {{#if}} tags',\r\n      };\r\n    }\r\n\r\n    return { valid: true };\r\n  } catch (error: any) {\r\n    return {\r\n      valid: false,\r\n      error: error.message || 'Invalid template',\r\n    };\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\lib\\notifications.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":131,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":131,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4315,4318],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4315,4318],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":214,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":214,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7168,7171],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7168,7171],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'message' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":305,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":305,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'message' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":416,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":416,"endColumn":16}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Notification service for sending emails and SMS\r\n * Supports multiple providers via environment variables\r\n */\r\n\r\nimport { ITenantSettings } from '@/models/Tenant';\r\nimport { formatDate, formatTime } from '@/lib/formatting';\r\nimport { getDefaultTenantSettings } from '@/lib/currency';\r\nimport { renderNotificationTemplate, getDefaultTemplate } from '@/lib/notification-templates';\r\n\r\nexport interface NotificationOptions {\r\n  to: string;\r\n  subject?: string;\r\n  message: string;\r\n  type: 'email' | 'sms';\r\n}\r\n\r\nexport interface BookingNotificationData {\r\n  customerName: string;\r\n  customerEmail?: string;\r\n  customerPhone?: string;\r\n  serviceName: string;\r\n  startTime: Date;\r\n  endTime: Date;\r\n  staffName?: string;\r\n  notes?: string;\r\n  bookingId: string;\r\n}\r\n\r\n/**\r\n * Send email notification\r\n * Supports multiple providers: Resend, SendGrid, SMTP (via nodemailer), or console logging\r\n */\r\nexport async function sendEmail(options: NotificationOptions): Promise<boolean> {\r\n  try {\r\n    const emailProvider = process.env.EMAIL_PROVIDER || 'console';\r\n    const fromEmail = process.env.FROM_EMAIL || process.env.EMAIL_FROM || 'noreply@localhost';\r\n\r\n    // If no provider is configured, log to console (development mode)\r\n    if (emailProvider === 'console' || !process.env.EMAIL_API_KEY) {\r\n      console.log(' Email notification (console mode):', {\r\n        to: options.to,\r\n        from: fromEmail,\r\n        subject: options.subject,\r\n        message: options.message.substring(0, 200) + (options.message.length > 200 ? '...' : ''),\r\n      });\r\n      return true;\r\n    }\r\n\r\n    // Resend provider\r\n    if (emailProvider === 'resend') {\r\n      const resendApiKey = process.env.EMAIL_API_KEY || process.env.RESEND_API_KEY;\r\n      if (!resendApiKey) {\r\n        throw new Error('RESEND_API_KEY or EMAIL_API_KEY is required when using Resend');\r\n      }\r\n\r\n      // Dynamic import to avoid requiring package at build time\r\n      const { Resend } = await import('resend');\r\n      const resend = new Resend(resendApiKey);\r\n\r\n      const result = await resend.emails.send({\r\n        from: fromEmail,\r\n        to: options.to,\r\n        subject: options.subject || 'Notification',\r\n        text: options.message,\r\n        html: options.message.replace(/\\n/g, '<br>'),\r\n      });\r\n\r\n      if (result.error) {\r\n        throw new Error(result.error.message || 'Failed to send email via Resend');\r\n      }\r\n\r\n      return true;\r\n    }\r\n\r\n    // SendGrid provider\r\n    if (emailProvider === 'sendgrid') {\r\n      const sendgridApiKey = process.env.EMAIL_API_KEY || process.env.SENDGRID_API_KEY;\r\n      if (!sendgridApiKey) {\r\n        throw new Error('SENDGRID_API_KEY or EMAIL_API_KEY is required when using SendGrid');\r\n      }\r\n\r\n      const sgMail = await import('@sendgrid/mail');\r\n      sgMail.default.setApiKey(sendgridApiKey);\r\n\r\n      await sgMail.default.send({\r\n        to: options.to,\r\n        from: fromEmail,\r\n        subject: options.subject || 'Notification',\r\n        text: options.message,\r\n        html: options.message.replace(/\\n/g, '<br>'),\r\n      });\r\n\r\n      return true;\r\n    }\r\n\r\n    // SMTP provider (using nodemailer)\r\n    if (emailProvider === 'smtp') {\r\n      const nodemailer = await import('nodemailer');\r\n      \r\n      const transporter = nodemailer.createTransport({\r\n        host: process.env.SMTP_HOST || 'smtp.gmail.com',\r\n        port: parseInt(process.env.SMTP_PORT || '587', 10),\r\n        secure: process.env.SMTP_SECURE === 'true',\r\n        auth: {\r\n          user: process.env.SMTP_USER || process.env.EMAIL_API_KEY,\r\n          pass: process.env.SMTP_PASSWORD || process.env.EMAIL_PASSWORD,\r\n        },\r\n      });\r\n\r\n      await transporter.sendMail({\r\n        from: fromEmail,\r\n        to: options.to,\r\n        subject: options.subject || 'Notification',\r\n        text: options.message,\r\n        html: options.message.replace(/\\n/g, '<br>'),\r\n      });\r\n\r\n      return true;\r\n    }\r\n\r\n    // Unknown provider\r\n    console.warn(`Unknown email provider: ${emailProvider}, falling back to console logging`);\r\n    console.log(' Email notification:', {\r\n      to: options.to,\r\n      from: fromEmail,\r\n      subject: options.subject,\r\n      message: options.message.substring(0, 200) + (options.message.length > 200 ? '...' : ''),\r\n    });\r\n    return true;\r\n  } catch (error: any) {\r\n    console.error('Failed to send email:', error);\r\n    return false;\r\n  }\r\n}\r\n\r\n/**\r\n * Send SMS notification\r\n * Supports multiple providers: Twilio, AWS SNS, or console logging\r\n */\r\nexport async function sendSMS(options: NotificationOptions): Promise<boolean> {\r\n  try {\r\n    const smsProvider = process.env.SMS_PROVIDER || 'console';\r\n    const fromPhone = process.env.SMS_FROM || process.env.TWILIO_PHONE;\r\n\r\n    // If no provider is configured, log to console (development mode)\r\n    if (smsProvider === 'console' || (!process.env.SMS_API_KEY && !process.env.TWILIO_ACCOUNT_SID)) {\r\n      console.log(' SMS notification (console mode):', {\r\n        to: options.to,\r\n        from: fromPhone || 'N/A',\r\n        message: options.message.substring(0, 160) + (options.message.length > 160 ? '...' : ''),\r\n      });\r\n      return true;\r\n    }\r\n\r\n    // Twilio provider\r\n    if (smsProvider === 'twilio') {\r\n      const accountSid = process.env.TWILIO_ACCOUNT_SID || process.env.SMS_API_KEY;\r\n      const authToken = process.env.TWILIO_AUTH_TOKEN || process.env.SMS_PASSWORD;\r\n      \r\n      if (!accountSid || !authToken) {\r\n        throw new Error('TWILIO_ACCOUNT_SID and TWILIO_AUTH_TOKEN (or SMS_API_KEY and SMS_PASSWORD) are required when using Twilio');\r\n      }\r\n\r\n      if (!fromPhone) {\r\n        throw new Error('TWILIO_PHONE or SMS_FROM is required when using Twilio');\r\n      }\r\n\r\n      const twilio = await import('twilio');\r\n      const client = twilio.default(accountSid, authToken);\r\n\r\n      const message = await client.messages.create({\r\n        body: options.message,\r\n        from: fromPhone,\r\n        to: options.to,\r\n      });\r\n\r\n      if (message.errorCode) {\r\n        throw new Error(`Twilio error: ${message.errorMessage || 'Unknown error'}`);\r\n      }\r\n\r\n      return true;\r\n    }\r\n\r\n    // AWS SNS provider\r\n    if (smsProvider === 'aws-sns') {\r\n      const { SNSClient, PublishCommand } = await import('@aws-sdk/client-sns');\r\n      \r\n      const snsClient = new SNSClient({\r\n        region: process.env.AWS_REGION || 'us-east-1',\r\n        credentials: {\r\n          accessKeyId: process.env.AWS_ACCESS_KEY_ID || process.env.SMS_API_KEY || '',\r\n          secretAccessKey: process.env.AWS_SECRET_ACCESS_KEY || process.env.SMS_PASSWORD || '',\r\n        },\r\n      });\r\n\r\n      const command = new PublishCommand({\r\n        PhoneNumber: options.to,\r\n        Message: options.message,\r\n      });\r\n\r\n      await snsClient.send(command);\r\n      return true;\r\n    }\r\n\r\n    // Unknown provider\r\n    console.warn(`Unknown SMS provider: ${smsProvider}, falling back to console logging`);\r\n    console.log(' SMS notification:', {\r\n      to: options.to,\r\n      from: fromPhone || 'N/A',\r\n      message: options.message.substring(0, 160) + (options.message.length > 160 ? '...' : ''),\r\n    });\r\n    return true;\r\n  } catch (error: any) {\r\n    console.error('Failed to send SMS:', error);\r\n    return false;\r\n  }\r\n}\r\n\r\n/**\r\n * Send booking confirmation\r\n */\r\nexport async function sendBookingConfirmation(\r\n  data: BookingNotificationData,\r\n  settings?: ITenantSettings\r\n): Promise<{ email: boolean; sms: boolean }> {\r\n  const results = { email: false, sms: false };\r\n  const tenantSettings = settings || getDefaultTenantSettings();\r\n\r\n  // Check if notifications are enabled for this tenant\r\n  if (!tenantSettings.emailNotifications && !tenantSettings.smsNotifications) {\r\n    console.log('Notifications disabled for tenant, skipping booking confirmation');\r\n    return results;\r\n  }\r\n\r\n  // Use template if available, otherwise use default message\r\n  const emailTemplate = tenantSettings.notificationTemplates?.email?.bookingConfirmation;\r\n  const smsTemplate = tenantSettings.notificationTemplates?.sms?.bookingConfirmation;\r\n\r\n  let emailMessage = '';\r\n  let smsMessage = '';\r\n\r\n  if (emailTemplate) {\r\n    // Template may contain subject|body format\r\n    const parts = emailTemplate.split('|');\r\n    emailMessage = parts.length > 1 ? parts[1] : parts[0];\r\n    emailMessage = renderNotificationTemplate(emailMessage, {\r\n      customerName: data.customerName,\r\n      serviceName: data.serviceName,\r\n      date: data.startTime,\r\n      time: data.startTime,\r\n      staffName: data.staffName,\r\n      notes: data.notes,\r\n      companyName: tenantSettings.companyName || 'Business',\r\n    }, tenantSettings);\r\n  } else {\r\n    // Fallback to default template\r\n    const defaultTemplate = getDefaultTemplate('email', 'booking', 'confirmation');\r\n    if (defaultTemplate) {\r\n      emailMessage = renderNotificationTemplate(defaultTemplate.body, {\r\n        customerName: data.customerName,\r\n        serviceName: data.serviceName,\r\n        date: data.startTime,\r\n        time: data.startTime,\r\n        staffName: data.staffName,\r\n        notes: data.notes,\r\n        companyName: tenantSettings.companyName || 'Business',\r\n      }, tenantSettings);\r\n    } else {\r\n      // Ultimate fallback\r\n      const formattedDate = formatDate(data.startTime, tenantSettings);\r\n      const formattedTime = formatTime(data.startTime, tenantSettings);\r\n      emailMessage = `Your booking for ${data.serviceName} is confirmed.\\n\\n` +\r\n        `Date: ${formattedDate}\\n` +\r\n        `Time: ${formattedTime}\\n` +\r\n        (data.staffName ? `Staff: ${data.staffName}\\n` : '') +\r\n        (data.notes ? `Notes: ${data.notes}\\n` : '') +\r\n        `\\nWe look forward to seeing you!`;\r\n    }\r\n  }\r\n\r\n  if (smsTemplate) {\r\n    smsMessage = renderNotificationTemplate(smsTemplate, {\r\n      customerName: data.customerName,\r\n      serviceName: data.serviceName,\r\n      date: data.startTime,\r\n      time: data.startTime,\r\n    }, tenantSettings);\r\n  } else {\r\n    const defaultTemplate = getDefaultTemplate('sms', 'booking', 'confirmation');\r\n    if (defaultTemplate) {\r\n      smsMessage = renderNotificationTemplate(defaultTemplate.body, {\r\n        customerName: data.customerName,\r\n        serviceName: data.serviceName,\r\n        date: data.startTime,\r\n        time: data.startTime,\r\n      }, tenantSettings);\r\n    } else {\r\n      const formattedDate = formatDate(data.startTime, tenantSettings);\r\n      const formattedTime = formatTime(data.startTime, tenantSettings);\r\n      smsMessage = `Hi ${data.customerName}, your booking for ${data.serviceName} is confirmed for ${formattedDate} at ${formattedTime}. See you soon!`;\r\n    }\r\n  }\r\n\r\n  const message = emailMessage || smsMessage;\r\n\r\n  // Send email if email is provided and email notifications are enabled\r\n  if (data.customerEmail && tenantSettings.emailNotifications) {\r\n    const emailTemplate = tenantSettings.notificationTemplates?.email?.bookingConfirmation;\r\n    let subject = `Booking Confirmation: ${data.serviceName}`;\r\n    if (emailTemplate && emailTemplate.includes('|')) {\r\n      subject = emailTemplate.split('|')[0];\r\n      subject = renderNotificationTemplate(subject, {\r\n        serviceName: data.serviceName,\r\n      }, tenantSettings);\r\n    }\r\n    results.email = await sendEmail({\r\n      to: data.customerEmail,\r\n      subject,\r\n      message: emailMessage,\r\n      type: 'email',\r\n    });\r\n  }\r\n\r\n  // Send SMS if phone is provided and SMS notifications are enabled\r\n  if (data.customerPhone && tenantSettings.smsNotifications) {\r\n    results.sms = await sendSMS({\r\n      to: data.customerPhone,\r\n      message: smsMessage,\r\n      type: 'sms',\r\n    });\r\n  }\r\n\r\n  return results;\r\n}\r\n\r\n/**\r\n * Send booking reminder\r\n */\r\nexport async function sendBookingReminder(\r\n  data: BookingNotificationData,\r\n  settings?: ITenantSettings\r\n): Promise<{ email: boolean; sms: boolean }> {\r\n  const results = { email: false, sms: false };\r\n  const tenantSettings = settings || getDefaultTenantSettings();\r\n\r\n  // Check if notifications are enabled for this tenant\r\n  if (!tenantSettings.emailNotifications && !tenantSettings.smsNotifications) {\r\n    console.log('Notifications disabled for tenant, skipping booking reminder');\r\n    return results;\r\n  }\r\n\r\n  // Use template if available\r\n  const emailTemplate = tenantSettings.notificationTemplates?.email?.bookingReminder;\r\n  const smsTemplate = tenantSettings.notificationTemplates?.sms?.bookingReminder;\r\n\r\n  let emailMessage = '';\r\n  let smsMessage = '';\r\n\r\n  if (emailTemplate) {\r\n    const parts = emailTemplate.split('|');\r\n    emailMessage = parts.length > 1 ? parts[1] : parts[0];\r\n    emailMessage = renderNotificationTemplate(emailMessage, {\r\n      customerName: data.customerName,\r\n      serviceName: data.serviceName,\r\n      date: data.startTime,\r\n      time: data.startTime,\r\n      staffName: data.staffName,\r\n      companyName: tenantSettings.companyName || 'Business',\r\n    }, tenantSettings);\r\n  } else {\r\n    const defaultTemplate = getDefaultTemplate('email', 'booking', 'reminder');\r\n    if (defaultTemplate) {\r\n      emailMessage = renderNotificationTemplate(defaultTemplate.body, {\r\n        customerName: data.customerName,\r\n        serviceName: data.serviceName,\r\n        date: data.startTime,\r\n        time: data.startTime,\r\n        staffName: data.staffName,\r\n        companyName: tenantSettings.companyName || 'Business',\r\n      }, tenantSettings);\r\n    } else {\r\n      const formattedDate = formatDate(data.startTime, tenantSettings);\r\n      const formattedTime = formatTime(data.startTime, tenantSettings);\r\n      emailMessage = `Reminder: You have a booking for ${data.serviceName}.\\n\\n` +\r\n        `Date: ${formattedDate}\\n` +\r\n        `Time: ${formattedTime}\\n` +\r\n        (data.staffName ? `Staff: ${data.staffName}\\n` : '') +\r\n        `\\nSee you soon!`;\r\n    }\r\n  }\r\n\r\n  if (smsTemplate) {\r\n    smsMessage = renderNotificationTemplate(smsTemplate, {\r\n      customerName: data.customerName,\r\n      serviceName: data.serviceName,\r\n      date: data.startTime,\r\n      time: data.startTime,\r\n    }, tenantSettings);\r\n  } else {\r\n    const defaultTemplate = getDefaultTemplate('sms', 'booking', 'reminder');\r\n    if (defaultTemplate) {\r\n      smsMessage = renderNotificationTemplate(defaultTemplate.body, {\r\n        customerName: data.customerName,\r\n        serviceName: data.serviceName,\r\n        date: data.startTime,\r\n        time: data.startTime,\r\n      }, tenantSettings);\r\n    } else {\r\n      const formattedDate = formatDate(data.startTime, tenantSettings);\r\n      const formattedTime = formatTime(data.startTime, tenantSettings);\r\n      smsMessage = `Reminder: You have a booking for ${data.serviceName} on ${formattedDate} at ${formattedTime}. See you soon!`;\r\n    }\r\n  }\r\n\r\n  const message = emailMessage || smsMessage;\r\n\r\n  // Send email if email is provided and email notifications are enabled\r\n  if (data.customerEmail && tenantSettings.emailNotifications) {\r\n    const emailTemplate = tenantSettings.notificationTemplates?.email?.bookingReminder;\r\n    let subject = `Reminder: ${data.serviceName} Booking`;\r\n    if (emailTemplate && emailTemplate.includes('|')) {\r\n      subject = emailTemplate.split('|')[0];\r\n      subject = renderNotificationTemplate(subject, {\r\n        serviceName: data.serviceName,\r\n      }, tenantSettings);\r\n    }\r\n    results.email = await sendEmail({\r\n      to: data.customerEmail,\r\n      subject,\r\n      message: emailMessage,\r\n      type: 'email',\r\n    });\r\n  }\r\n\r\n  // Send SMS if phone is provided and SMS notifications are enabled\r\n  if (data.customerPhone && tenantSettings.smsNotifications) {\r\n    results.sms = await sendSMS({\r\n      to: data.customerPhone,\r\n      message: smsMessage,\r\n      type: 'sms',\r\n    });\r\n  }\r\n\r\n  return results;\r\n}\r\n\r\n/**\r\n * Send attendance notification email\r\n */\r\nexport interface AttendanceNotificationData {\r\n  userName: string;\r\n  userEmail: string;\r\n  type: 'late_arrival' | 'missing_clock_out';\r\n  clockInTime: Date | string;\r\n  hoursSinceClockIn?: number;\r\n  minutesLate?: number;\r\n  expectedTime?: Date | string;\r\n  message: string;\r\n}\r\n\r\nexport async function sendAttendanceNotification(\r\n  data: AttendanceNotificationData,\r\n  settings?: ITenantSettings\r\n): Promise<boolean> {\r\n  try {\r\n    const tenantSettings = settings || getDefaultTenantSettings();\r\n\r\n    // Check if email notifications are enabled for this tenant\r\n    if (!tenantSettings.emailNotifications) {\r\n      console.log('Email notifications disabled for tenant, skipping attendance notification');\r\n      return false;\r\n    }\r\n\r\n    const clockInDate = formatDate(data.clockInTime, tenantSettings);\r\n    const clockInTime = formatTime(data.clockInTime, tenantSettings);\r\n    \r\n    let subject = '';\r\n    let emailBody = '';\r\n    \r\n    if (data.type === 'late_arrival') {\r\n      subject = `Late Arrival Alert: ${data.userName}`;\r\n      emailBody = `\r\nHello ${data.userName},\r\n\r\nThis is an automated notification regarding your attendance.\r\n\r\nYou clocked in late on ${clockInDate} at ${clockInTime}.\r\n${data.minutesLate ? `You were ${data.minutesLate} minutes late.` : ''}\r\n${data.expectedTime ? `Expected time: ${formatTime(data.expectedTime, tenantSettings)}` : ''}\r\n\r\n${data.message}\r\n\r\nPlease ensure you arrive on time for your scheduled shifts.\r\n\r\nBest regards,\r\nAttendance Management System\r\n      `.trim();\r\n    } else if (data.type === 'missing_clock_out') {\r\n      subject = `Missing Clock-Out Alert: ${data.userName}`;\r\n      emailBody = `\r\nHello ${data.userName},\r\n\r\nThis is an automated notification regarding your attendance.\r\n\r\nYou clocked in on ${clockInDate} at ${clockInTime} but have not yet clocked out.\r\n${data.hoursSinceClockIn ? `You have been clocked in for ${data.hoursSinceClockIn.toFixed(1)} hours.` : ''}\r\n\r\n${data.message}\r\n\r\nPlease remember to clock out at the end of your shift.\r\n\r\nBest regards,\r\nAttendance Management System\r\n      `.trim();\r\n    }\r\n\r\n    return await sendEmail({\r\n      to: data.userEmail,\r\n      subject,\r\n      message: emailBody,\r\n      type: 'email',\r\n    });\r\n  } catch (error) {\r\n    console.error('Failed to send attendance notification:', error);\r\n    return false;\r\n  }\r\n}\r\n\r\n/**\r\n * Send booking cancellation notification\r\n */\r\nexport async function sendBookingCancellation(\r\n  data: BookingNotificationData,\r\n  settings?: ITenantSettings\r\n): Promise<{ email: boolean; sms: boolean }> {\r\n  const results = { email: false, sms: false };\r\n  const tenantSettings = settings || getDefaultTenantSettings();\r\n\r\n  // Check if notifications are enabled for this tenant\r\n  if (!tenantSettings.emailNotifications && !tenantSettings.smsNotifications) {\r\n    console.log('Notifications disabled for tenant, skipping booking cancellation');\r\n    return results;\r\n  }\r\n\r\n  const formattedDate = formatDate(data.startTime, tenantSettings);\r\n  const formattedTime = formatTime(data.startTime, tenantSettings);\r\n\r\n  const message = `Your booking for ${data.serviceName} has been cancelled.\\n\\n` +\r\n    `Original Date: ${formattedDate}\\n` +\r\n    `Original Time: ${formattedTime}\\n` +\r\n    `\\nIf you need to reschedule, please contact us.`;\r\n\r\n  // Send email if email is provided and email notifications are enabled\r\n  if (data.customerEmail && tenantSettings.emailNotifications) {\r\n    results.email = await sendEmail({\r\n      to: data.customerEmail,\r\n      subject: `Booking Cancelled: ${data.serviceName}`,\r\n      message,\r\n      type: 'email',\r\n    });\r\n  }\r\n\r\n  // Send SMS if phone is provided and SMS notifications are enabled\r\n  if (data.customerPhone && tenantSettings.smsNotifications) {\r\n    results.sms = await sendSMS({\r\n      to: data.customerPhone,\r\n      message,\r\n      type: 'sms',\r\n    });\r\n  }\r\n\r\n  return results;\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\lib\\offline-storage.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\lib\\paypal.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\lib\\pin-validation.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":13,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":13,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[548,551],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[548,551],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":18,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":18,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[729,732],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[729,732],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import User from '@/models/User';\r\nimport bcrypt from 'bcryptjs';\r\n\r\n/**\r\n * Check if a PIN is already in use by another user in the same tenant\r\n * This function compares the candidate PIN with all existing hashed PINs\r\n * @param tenantId - The tenant ID to check within\r\n * @param candidatePin - The plain text PIN to check\r\n * @param excludeUserId - User ID to exclude from the check (the user being updated)\r\n * @returns Promise<boolean> - true if PIN is already in use, false otherwise\r\n */\r\nexport async function isPinDuplicate(\r\n  tenantId: any,\r\n  candidatePin: string,\r\n  excludeUserId?: string\r\n): Promise<boolean> {\r\n  // Get all users in the tenant with PINs (excluding the current user if specified)\r\n  const query: any = { tenantId, pin: { $exists: true, $ne: null } };\r\n  if (excludeUserId) {\r\n    query._id = { $ne: excludeUserId };\r\n  }\r\n  \r\n  const users = await User.find(query).select('+pin').lean();\r\n  \r\n  // Compare candidate PIN with each hashed PIN\r\n  for (const user of users) {\r\n    if (user.pin) {\r\n      const isMatch = await bcrypt.compare(candidatePin, user.pin);\r\n      if (isMatch) {\r\n        return true; // PIN is already in use\r\n      }\r\n    }\r\n  }\r\n  \r\n  return false; // PIN is not in use\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\lib\\receipt-templates.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":148,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":148,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3754,3757],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3754,3757],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":154,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":154,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4014,4017],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4014,4017],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":164,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":164,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4398,4401],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4398,4401],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":181,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":181,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4867,4870],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4867,4870],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":245,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":245,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6808,6811],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6808,6811],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Receipt Template System\r\n * Manages custom receipt templates with variable substitution\r\n */\r\n\r\nexport interface ReceiptTemplate {\r\n  id: string;\r\n  name: string;\r\n  html: string;\r\n  isDefault?: boolean;\r\n  createdAt?: Date;\r\n  updatedAt?: Date;\r\n}\r\n\r\nexport interface ReceiptData {\r\n  storeName?: string;\r\n  logo?: string;\r\n  address?: string;\r\n  phone?: string;\r\n  email?: string;\r\n  website?: string;\r\n  receiptNumber: string;\r\n  date: string;\r\n  time: string;\r\n  items: Array<{\r\n    name: string;\r\n    quantity: number;\r\n    price: number;\r\n    subtotal: number;\r\n    sku?: string;\r\n  }>;\r\n  subtotal: number;\r\n  discount?: number;\r\n  tax?: number;\r\n  taxLabel?: string;\r\n  total: number;\r\n  paymentMethod: string;\r\n  cashReceived?: number;\r\n  change?: number;\r\n  footer?: string;\r\n  header?: string;\r\n  customerName?: string;\r\n  customerEmail?: string;\r\n  customerPhone?: string;\r\n}\r\n\r\n/**\r\n * Default receipt template\r\n */\r\nexport const DEFAULT_RECEIPT_TEMPLATE: ReceiptTemplate = {\r\n  id: 'default',\r\n  name: 'Default Template',\r\n  html: `<!DOCTYPE html>\r\n<html>\r\n<head>\r\n  <title>Receipt</title>\r\n  <style>\r\n    @media print {\r\n      @page { margin: 0; size: 80mm auto; }\r\n      body { margin: 0; padding: 10px; }\r\n    }\r\n    body {\r\n      font-family: 'Courier New', monospace;\r\n      font-size: 12px;\r\n      width: 80mm;\r\n      margin: 0 auto;\r\n      padding: 10px;\r\n    }\r\n    .header { text-align: center; border-bottom: 2px dashed #000; padding-bottom: 10px; margin-bottom: 10px; }\r\n    .item { display: flex; justify-content: space-between; margin-bottom: 5px; }\r\n    .total { border-top: 2px dashed #000; padding-top: 10px; margin-top: 10px; font-weight: bold; }\r\n    .footer { text-align: center; margin-top: 20px; font-size: 10px; }\r\n  </style>\r\n</head>\r\n<body>\r\n  <div class=\"header\">\r\n    {{#if storeName}}<h2>{{storeName}}</h2>{{/if}}\r\n    {{#if logo}}<img src=\"{{logo}}\" alt=\"Logo\" style=\"max-width: 100px; max-height: 60px;\" />{{/if}}\r\n    <p>Receipt #{{receiptNumber}}</p>\r\n    <p>{{date}} {{time}}</p>\r\n    {{#if address}}<p>{{address}}</p>{{/if}}\r\n    {{#if phone}}<p>{{phone}}</p>{{/if}}\r\n    {{#if email}}<p>{{email}}</p>{{/if}}\r\n    {{#if header}}<p>{{header}}</p>{{/if}}\r\n  </div>\r\n  {{#each items}}\r\n  <div class=\"item\">\r\n    <div>\r\n      <div>{{name}} x{{quantity}}</div>\r\n      <div style=\"font-size: 10px;\">@ {{price}}</div>\r\n    </div>\r\n    <div>{{subtotal}}</div>\r\n  </div>\r\n  {{/each}}\r\n  <div class=\"total\">\r\n    <div class=\"item\">\r\n      <div>Subtotal:</div>\r\n      <div>{{subtotal}}</div>\r\n    </div>\r\n    {{#if discount}}\r\n    <div class=\"item\">\r\n      <div>Discount:</div>\r\n      <div>-{{discount}}</div>\r\n    </div>\r\n    {{/if}}\r\n    {{#if tax}}\r\n    <div class=\"item\">\r\n      <div>{{taxLabel}}:</div>\r\n      <div>{{tax}}</div>\r\n    </div>\r\n    {{/if}}\r\n    <div class=\"item\">\r\n      <div>TOTAL:</div>\r\n      <div>{{total}}</div>\r\n    </div>\r\n    <div class=\"item\">\r\n      <div>Payment:</div>\r\n      <div>{{paymentMethod}}</div>\r\n    </div>\r\n    {{#if cashReceived}}\r\n    <div class=\"item\">\r\n      <div>Cash:</div>\r\n      <div>{{cashReceived}}</div>\r\n    </div>\r\n    {{/if}}\r\n    {{#if change}}\r\n    <div class=\"item\">\r\n      <div>Change:</div>\r\n      <div>{{change}}</div>\r\n    </div>\r\n    {{/if}}\r\n  </div>\r\n  {{#if footer}}<div class=\"footer\">{{footer}}</div>{{/if}}\r\n</body>\r\n</html>`,\r\n  isDefault: true,\r\n};\r\n\r\n/**\r\n * Simple template engine for receipt rendering\r\n * Supports Handlebars-like syntax: {{variable}}, {{#if condition}}, {{#each array}}\r\n */\r\nexport function renderReceiptTemplate(template: string, data: ReceiptData): string {\r\n  let html = template;\r\n\r\n  // Replace simple variables {{variable}}\r\n  html = html.replace(/\\{\\{(\\w+)\\}\\}/g, (match, key) => {\r\n    const value = (data as any)[key];\r\n    return value !== undefined && value !== null ? String(value) : '';\r\n  });\r\n\r\n  // Handle {{#if condition}} blocks\r\n  html = html.replace(/\\{\\{#if\\s+(\\w+)\\}\\}([\\s\\S]*?)\\{\\{\\/if\\}\\}/g, (match, condition, content) => {\r\n    const value = (data as any)[condition];\r\n    if (value && value !== false && value !== '' && value !== 0) {\r\n      // Recursively process nested content\r\n      return processTemplateContent(content, data);\r\n    }\r\n    return '';\r\n  });\r\n\r\n  // Handle {{#each array}} blocks\r\n  html = html.replace(/\\{\\{#each\\s+(\\w+)\\}\\}([\\s\\S]*?)\\{\\{\\/each\\}\\}/g, (match, arrayKey, content) => {\r\n    const array = (data as any)[arrayKey];\r\n    if (Array.isArray(array)) {\r\n      return array.map((item, index) => {\r\n        // Create a context with item properties and index\r\n        const itemContext = { ...data, ...item, index, '@index': index };\r\n        return processTemplateContent(content, itemContext);\r\n      }).join('');\r\n    }\r\n    return '';\r\n  });\r\n\r\n  return html;\r\n}\r\n\r\n/**\r\n * Process template content recursively\r\n */\r\nfunction processTemplateContent(content: string, data: any): string {\r\n  let processed = content;\r\n\r\n  // Replace variables\r\n  processed = processed.replace(/\\{\\{(\\w+)\\}\\}/g, (match, key) => {\r\n    const value = data[key];\r\n    return value !== undefined && value !== null ? String(value) : '';\r\n  });\r\n\r\n  // Handle nested if blocks\r\n  processed = processed.replace(/\\{\\{#if\\s+(\\w+)\\}\\}([\\s\\S]*?)\\{\\{\\/if\\}\\}/g, (match, condition, nestedContent) => {\r\n    const value = data[condition];\r\n    if (value && value !== false && value !== '' && value !== 0) {\r\n      return processTemplateContent(nestedContent, data);\r\n    }\r\n    return '';\r\n  });\r\n\r\n  return processed;\r\n}\r\n\r\n/**\r\n * Get default template if none exists\r\n */\r\nexport function getDefaultTemplate(): ReceiptTemplate {\r\n  return DEFAULT_RECEIPT_TEMPLATE;\r\n}\r\n\r\n/**\r\n * Validate template HTML\r\n */\r\nexport function validateTemplate(html: string): { valid: boolean; error?: string } {\r\n  try {\r\n    // Basic validation - check for required variables\r\n    const requiredVars = ['receiptNumber', 'date', 'total'];\r\n    const missing = requiredVars.filter((varName) => !html.includes(`{{${varName}}}`) && !html.includes(`{{#each ${varName}}}`));\r\n    \r\n    if (missing.length > 0) {\r\n      return {\r\n        valid: false,\r\n        error: `Missing required variables: ${missing.join(', ')}`,\r\n      };\r\n    }\r\n\r\n    // Check for balanced tags\r\n    const ifMatches = html.match(/\\{\\{#if/g) || [];\r\n    const endIfMatches = html.match(/\\{\\{\\/if\\}\\}/g) || [];\r\n    if (ifMatches.length !== endIfMatches.length) {\r\n      return {\r\n        valid: false,\r\n        error: 'Unbalanced {{#if}} tags',\r\n      };\r\n    }\r\n\r\n    const eachMatches = html.match(/\\{\\{#each/g) || [];\r\n    const endEachMatches = html.match(/\\{\\{\\/each\\}\\}/g) || [];\r\n    if (eachMatches.length !== endEachMatches.length) {\r\n      return {\r\n        valid: false,\r\n        error: 'Unbalanced {{#each}} tags',\r\n      };\r\n    }\r\n\r\n    return { valid: true };\r\n  } catch (error: any) {\r\n    return {\r\n      valid: false,\r\n      error: error.message || 'Invalid template',\r\n    };\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\lib\\receipt.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\lib\\stock.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'IProductVariation' is defined but never used. Allowed unused vars must match /^_/u.","line":5,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":27},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":147,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":147,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4687,4690],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4687,4690],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'updateField' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":165,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":165,"endColumn":16},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":269,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":269,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8002,8005],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8002,8005],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":276,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":276,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8166,8169],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8166,8169],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":324,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":324,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9487,9490],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9487,9490],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import connectDB from './mongodb';\r\nimport Product from '@/models/Product';\r\nimport ProductBundle from '@/models/ProductBundle';\r\nimport StockMovement from '@/models/StockMovement';\r\nimport { IProductVariation } from '@/models/Product';\r\n\r\nexport interface StockUpdateOptions {\r\n  transactionId?: string;\r\n  userId?: string;\r\n  reason?: string;\r\n  notes?: string;\r\n  branchId?: string;\r\n  variation?: {\r\n    size?: string;\r\n    color?: string;\r\n    type?: string;\r\n  };\r\n}\r\n\r\n/**\r\n * Get current stock for a product, considering branch and variation\r\n */\r\nexport async function getProductStock(\r\n  productId: string,\r\n  tenantId: string,\r\n  options: {\r\n    branchId?: string;\r\n    variation?: {\r\n      size?: string;\r\n      color?: string;\r\n      type?: string;\r\n    };\r\n  } = {}\r\n): Promise<number> {\r\n  await connectDB();\r\n\r\n  const product = await Product.findOne({ _id: productId, tenantId });\r\n  if (!product) {\r\n    throw new Error('Product not found');\r\n  }\r\n\r\n  // If product doesn't track inventory, return a high number\r\n  if (!product.trackInventory) {\r\n    return 999999;\r\n  }\r\n\r\n  // If product has variations, check variation stock\r\n  if (product.hasVariations && options.variation && product.variations) {\r\n    const variationOption = options.variation;\r\n    const variation = product.variations.find((v) => {\r\n      const matchSize = !variationOption.size || v.size === variationOption.size;\r\n      const matchColor = !variationOption.color || v.color === variationOption.color;\r\n      const matchType = !variationOption.type || v.type === variationOption.type;\r\n      return matchSize && matchColor && matchType;\r\n    });\r\n\r\n    if (variation && variation.stock !== undefined) {\r\n      // If branch-specific stock is requested\r\n      if (options.branchId && product.branchStock) {\r\n        // For variations with branches, we'd need to extend the model\r\n        // For now, return variation stock\r\n        return variation.stock;\r\n      }\r\n      return variation.stock;\r\n    }\r\n    return 0;\r\n  }\r\n\r\n  // If branch-specific stock is requested\r\n  if (options.branchId && product.branchStock) {\r\n    const branchStock = product.branchStock.find(\r\n      (bs) => bs.branchId.toString() === options.branchId\r\n    );\r\n    if (branchStock) {\r\n      return branchStock.stock;\r\n    }\r\n    return 0;\r\n  }\r\n\r\n  // Return master stock\r\n  return product.stock || 0;\r\n}\r\n\r\n/**\r\n * Update product stock and create stock movement record\r\n * Supports variations, branches, and bundles\r\n */\r\nexport async function updateStock(\r\n  productId: string,\r\n  tenantId: string,\r\n  quantity: number,\r\n  type: 'sale' | 'purchase' | 'adjustment' | 'return' | 'damage' | 'transfer',\r\n  options: StockUpdateOptions = {}\r\n): Promise<void> {\r\n  await connectDB();\r\n\r\n  const product = await Product.findOne({ _id: productId, tenantId });\r\n  if (!product) {\r\n    throw new Error('Product not found');\r\n  }\r\n\r\n  // If product doesn't track inventory, skip stock update\r\n  if (product.trackInventory === false) {\r\n    console.log(`Skipping stock update for product ${productId}: trackInventory is false`);\r\n    return;\r\n  }\r\n\r\n  let previousStock: number;\r\n  let newStock: number;\r\n  let updateField: string = 'stock';\r\n\r\n  // Handle variations\r\n  if (product.hasVariations && options.variation && product.variations) {\r\n    const variationIndex = product.variations.findIndex((v) => {\r\n      const matchSize = !options.variation?.size || v.size === options.variation.size;\r\n      const matchColor = !options.variation?.color || v.color === options.variation.color;\r\n      const matchType = !options.variation?.type || v.type === options.variation.type;\r\n      return matchSize && matchColor && matchType;\r\n    });\r\n\r\n    if (variationIndex === -1) {\r\n      throw new Error('Product variation not found');\r\n    }\r\n\r\n    previousStock = product.variations[variationIndex].stock || 0;\r\n    newStock = previousStock + quantity;\r\n\r\n    // Only check for negative stock if product doesn't allow out-of-stock sales\r\n    if (newStock < 0 && !product.allowOutOfStockSales) {\r\n      throw new Error(\r\n        `Insufficient stock for variation. Available: ${previousStock}, Requested: ${Math.abs(quantity)}`\r\n      );\r\n    }\r\n\r\n    product.variations[variationIndex].stock = newStock;\r\n    updateField = `variations.${variationIndex}.stock`;\r\n  }\r\n  // Handle branch-specific stock\r\n  else if (options.branchId && product.branchStock) {\r\n    const branchStockIndex = product.branchStock.findIndex(\r\n      (bs) => bs.branchId.toString() === options.branchId\r\n    );\r\n\r\n    if (branchStockIndex === -1) {\r\n      // Create new branch stock entry\r\n      product.branchStock.push({\r\n        branchId: options.branchId as any,\r\n        stock: quantity,\r\n      });\r\n      previousStock = 0;\r\n      newStock = quantity;\r\n    } else {\r\n      previousStock = product.branchStock[branchStockIndex].stock;\r\n      newStock = previousStock + quantity;\r\n\r\n      // Only check for negative stock if product doesn't allow out-of-stock sales\r\n      if (newStock < 0 && !product.allowOutOfStockSales) {\r\n        throw new Error(\r\n          `Insufficient stock at branch. Available: ${previousStock}, Requested: ${Math.abs(quantity)}`\r\n        );\r\n      }\r\n\r\n      product.branchStock[branchStockIndex].stock = newStock;\r\n    }\r\n    updateField = `branchStock.${branchStockIndex}.stock`;\r\n  }\r\n  // Handle master stock\r\n  else {\r\n    previousStock = product.stock || 0;\r\n    newStock = previousStock + quantity;\r\n\r\n    // Only check for negative stock if product doesn't allow out-of-stock sales\r\n    if (newStock < 0 && !product.allowOutOfStockSales) {\r\n      throw new Error(\r\n        `Insufficient stock. Available: ${previousStock}, Requested: ${Math.abs(quantity)}`\r\n      );\r\n    }\r\n\r\n    product.stock = newStock;\r\n  }\r\n\r\n  // Mark nested arrays as modified if needed\r\n  if (product.isModified('variations')) {\r\n    product.markModified('variations');\r\n  }\r\n  if (product.isModified('branchStock')) {\r\n    product.markModified('branchStock');\r\n  }\r\n\r\n  await product.save();\r\n  \r\n  // Log the update for debugging\r\n  console.log(`Stock updated: Product ${productId}, ${previousStock} -> ${newStock} (${quantity > 0 ? '+' : ''}${quantity})`);\r\n\r\n  // Create stock movement record\r\n  await StockMovement.create({\r\n    productId,\r\n    tenantId,\r\n    branchId: options.branchId,\r\n    variation: options.variation,\r\n    type,\r\n    quantity,\r\n    previousStock,\r\n    newStock,\r\n    reason: options.reason,\r\n    transactionId: options.transactionId,\r\n    userId: options.userId,\r\n    notes: options.notes,\r\n  });\r\n}\r\n\r\n/**\r\n * Update stock for a bundle (updates stock for all items in bundle)\r\n */\r\nexport async function updateBundleStock(\r\n  bundleId: string,\r\n  tenantId: string,\r\n  quantity: number,\r\n  type: 'sale' | 'purchase' | 'adjustment' | 'return' | 'damage' | 'transfer',\r\n  options: StockUpdateOptions = {}\r\n): Promise<void> {\r\n  await connectDB();\r\n\r\n  const bundle = await ProductBundle.findOne({ _id: bundleId, tenantId });\r\n  if (!bundle) {\r\n    throw new Error('Bundle not found');\r\n  }\r\n\r\n  if (!bundle.trackInventory) {\r\n    return;\r\n  }\r\n\r\n  // Update stock for each item in the bundle\r\n  for (const item of bundle.items) {\r\n    const itemQuantity = item.quantity * quantity; // Multiply by bundle quantity\r\n    await updateStock(\r\n      item.productId.toString(),\r\n      tenantId,\r\n      -itemQuantity, // Negative for sale, positive for purchase\r\n      type,\r\n      {\r\n        ...options,\r\n        variation: item.variation,\r\n        reason: options.reason || `Bundle ${type}: ${bundle.name}`,\r\n        notes: options.notes || `Part of bundle: ${bundle.name}`,\r\n      }\r\n    );\r\n  }\r\n}\r\n\r\n/**\r\n * Get stock movements for a product\r\n */\r\nexport async function getStockMovements(\r\n  productId: string,\r\n  tenantId: string,\r\n  options: {\r\n    branchId?: string;\r\n    variation?: {\r\n      size?: string;\r\n      color?: string;\r\n      type?: string;\r\n    };\r\n    limit?: number;\r\n  } = {}\r\n) {\r\n  await connectDB();\r\n\r\n  const query: any = { productId, tenantId };\r\n  \r\n  if (options.branchId) {\r\n    query.branchId = options.branchId;\r\n  }\r\n\r\n  if (options.variation) {\r\n    const variationQuery: any = {};\r\n    if (options.variation.size) variationQuery['variation.size'] = options.variation.size;\r\n    if (options.variation.color) variationQuery['variation.color'] = options.variation.color;\r\n    if (options.variation.type) variationQuery['variation.type'] = options.variation.type;\r\n    Object.assign(query, variationQuery);\r\n  }\r\n\r\n  return StockMovement.find(query)\r\n    .sort({ createdAt: -1 })\r\n    .limit(options.limit || 50)\r\n    .populate('userId', 'name email')\r\n    .populate('transactionId', 'receiptNumber total')\r\n    .populate('branchId', 'name code')\r\n    .lean();\r\n}\r\n\r\n/**\r\n * Check if product is low on stock\r\n */\r\nexport async function checkLowStock(\r\n  productId: string,\r\n  tenantId: string,\r\n  threshold?: number\r\n): Promise<boolean> {\r\n  await connectDB();\r\n\r\n  const product = await Product.findOne({ _id: productId, tenantId });\r\n  if (!product) {\r\n    return false;\r\n  }\r\n\r\n  if (!product.trackInventory) {\r\n    return false;\r\n  }\r\n\r\n  const stockThreshold = threshold || product.lowStockThreshold || 10;\r\n  const currentStock = await getProductStock(productId, tenantId);\r\n\r\n  return currentStock <= stockThreshold;\r\n}\r\n\r\n/**\r\n * Get all products with low stock\r\n */\r\nexport async function getLowStockProducts(\r\n  tenantId: string,\r\n  branchId?: string,\r\n  threshold?: number\r\n): Promise<any[]> {\r\n  await connectDB();\r\n\r\n  const products = await Product.find({\r\n    tenantId,\r\n    trackInventory: true,\r\n  }).lean();\r\n\r\n  const lowStockProducts = [];\r\n\r\n  for (const product of products) {\r\n    let isLowStock = false;\r\n    let currentStock = 0;\r\n\r\n    if (product.hasVariations && product.variations) {\r\n      // Check each variation\r\n      for (const variation of product.variations) {\r\n        const stock = variation.stock || 0;\r\n        const stockThreshold = threshold || product.lowStockThreshold || 10;\r\n        if (stock <= stockThreshold) {\r\n          isLowStock = true;\r\n          currentStock = Math.min(currentStock || stock, stock);\r\n        }\r\n      }\r\n    } else if (branchId && product.branchStock) {\r\n      const branchStock = product.branchStock.find(\r\n        (bs) => bs.branchId.toString() === branchId\r\n      );\r\n      if (branchStock) {\r\n        currentStock = branchStock.stock;\r\n        const stockThreshold = threshold || product.lowStockThreshold || 10;\r\n        isLowStock = currentStock <= stockThreshold;\r\n      }\r\n    } else {\r\n      currentStock = product.stock || 0;\r\n      const stockThreshold = threshold || product.lowStockThreshold || 10;\r\n      isLowStock = currentStock <= stockThreshold;\r\n    }\r\n\r\n    if (isLowStock) {\r\n      lowStockProducts.push({\r\n        ...product,\r\n        currentStock,\r\n        threshold: threshold || product.lowStockThreshold || 10,\r\n      });\r\n    }\r\n  }\r\n\r\n  return lowStockProducts;\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\lib\\subscription.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'mongoose' is defined but never used. Allowed unused vars must match /^_/u.","line":5,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":16},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":64,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":64,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1733,1736],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1733,1736],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":188,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":188,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5662,5665],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5662,5665],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":216,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":216,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6462,6465],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6462,6465],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":237,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":237,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7008,7011],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7008,7011],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":253,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":253,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7493,7496],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7493,7496],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import connectDB from '@/lib/mongodb';\r\nimport Subscription from '@/models/Subscription';\r\nimport SubscriptionPlan from '@/models/SubscriptionPlan';\r\nimport Tenant from '@/models/Tenant';\r\nimport mongoose from 'mongoose';\r\n\r\nexport interface SubscriptionLimits {\r\n  maxUsers: number;\r\n  maxBranches: number;\r\n  maxProducts: number;\r\n  maxTransactions: number;\r\n}\r\n\r\nexport interface SubscriptionFeatures {\r\n  enableInventory: boolean;\r\n  enableCategories: boolean;\r\n  enableDiscounts: boolean;\r\n  enableLoyaltyProgram: boolean;\r\n  enableCustomerManagement: boolean;\r\n  enableBookingScheduling: boolean;\r\n  enableReports: boolean;\r\n  enableMultiBranch: boolean;\r\n  enableHardwareIntegration: boolean;\r\n  prioritySupport: boolean;\r\n  customIntegrations: boolean;\r\n  dedicatedAccountManager: boolean;\r\n}\r\n\r\nexport interface SubscriptionStatus {\r\n  isActive: boolean;\r\n  isTrial: boolean;\r\n  isExpired: boolean;\r\n  isTrialExpired: boolean;\r\n  planName: string;\r\n  limits: SubscriptionLimits;\r\n  features: SubscriptionFeatures;\r\n  usage: {\r\n    currentUsers: number;\r\n    currentBranches: number;\r\n    currentProducts: number;\r\n    currentTransactions: number;\r\n  };\r\n  billingCycle: 'monthly' | 'yearly';\r\n  trialEndDate?: Date;\r\n  nextBillingDate?: Date;\r\n}\r\n\r\nexport class SubscriptionService {\r\n  /**\r\n   * Get subscription status for a tenant\r\n   */\r\n  static async getSubscriptionStatus(tenantId: string): Promise<SubscriptionStatus | null> {\r\n    try {\r\n      await connectDB();\r\n\r\n      const subscription = await Subscription.findOne({ tenantId })\r\n        .populate('planId', 'name tier price features')\r\n        .lean();\r\n\r\n      if (!subscription) {\r\n        return null;\r\n      }\r\n\r\n      const plan = subscription.planId as any;\r\n      const now = new Date();\r\n\r\n      const status: SubscriptionStatus = {\r\n        isActive: subscription.status === 'active',\r\n        isTrial: subscription.isTrial,\r\n        isExpired: subscription.endDate ? now > subscription.endDate : false,\r\n        isTrialExpired: subscription.trialEndDate ? now > subscription.trialEndDate : false,\r\n        planName: plan.name,\r\n        billingCycle: subscription.billingCycle,\r\n        trialEndDate: subscription.trialEndDate,\r\n        nextBillingDate: subscription.nextBillingDate,\r\n        limits: {\r\n          maxUsers: plan.features.maxUsers,\r\n          maxBranches: plan.features.maxBranches,\r\n          maxProducts: plan.features.maxProducts,\r\n          maxTransactions: plan.features.maxTransactions,\r\n        },\r\n        features: {\r\n          enableInventory: plan.features.enableInventory,\r\n          enableCategories: plan.features.enableCategories,\r\n          enableDiscounts: plan.features.enableDiscounts,\r\n          enableLoyaltyProgram: plan.features.enableLoyaltyProgram,\r\n          enableCustomerManagement: plan.features.enableCustomerManagement,\r\n          enableBookingScheduling: plan.features.enableBookingScheduling,\r\n          enableReports: plan.features.enableReports,\r\n          enableMultiBranch: plan.features.enableMultiBranch,\r\n          enableHardwareIntegration: plan.features.enableHardwareIntegration,\r\n          prioritySupport: plan.features.prioritySupport,\r\n          customIntegrations: plan.features.customIntegrations,\r\n          dedicatedAccountManager: plan.features.dedicatedAccountManager,\r\n        },\r\n        usage: subscription.usage,\r\n      };\r\n\r\n      return status;\r\n    } catch (error) {\r\n      console.error('Error getting subscription status:', error);\r\n      return null;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Check if tenant can perform an action based on subscription limits\r\n   */\r\n  static async checkLimit(\r\n    tenantId: string,\r\n    limitType: keyof SubscriptionLimits,\r\n    currentCount: number\r\n  ): Promise<{ allowed: boolean; limit: number; upgradeRequired: boolean }> {\r\n    const status = await this.getSubscriptionStatus(tenantId);\r\n\r\n    if (!status) {\r\n      // No subscription - allow basic usage during trial\r\n      return { allowed: true, limit: 10, upgradeRequired: false };\r\n    }\r\n\r\n    if (!status.isActive && !status.isTrial) {\r\n      return { allowed: false, limit: 0, upgradeRequired: true };\r\n    }\r\n\r\n    if (status.isExpired || status.isTrialExpired) {\r\n      return { allowed: false, limit: 0, upgradeRequired: true };\r\n    }\r\n\r\n    const limit = status.limits[limitType];\r\n\r\n    // -1 means unlimited\r\n    if (limit === -1) {\r\n      return { allowed: true, limit: -1, upgradeRequired: false };\r\n    }\r\n\r\n    return {\r\n      allowed: currentCount < limit,\r\n      limit,\r\n      upgradeRequired: currentCount >= limit,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Check if tenant has access to a feature\r\n   */\r\n  static async checkFeature(\r\n    tenantId: string,\r\n    feature: keyof SubscriptionFeatures\r\n  ): Promise<boolean> {\r\n    const status = await this.getSubscriptionStatus(tenantId);\r\n\r\n    if (!status) {\r\n      // No subscription - allow basic features during trial\r\n      const basicFeatures: (keyof SubscriptionFeatures)[] = [\r\n        'enableInventory',\r\n        'enableCategories',\r\n        'enableReports'\r\n      ];\r\n      return basicFeatures.includes(feature);\r\n    }\r\n\r\n    if (!status.isActive && !status.isTrial) {\r\n      return false;\r\n    }\r\n\r\n    if (status.isExpired || status.isTrialExpired) {\r\n      return false;\r\n    }\r\n\r\n    return status.features[feature];\r\n  }\r\n\r\n  /**\r\n   * Update usage counters for a tenant\r\n   */\r\n  static async updateUsage(\r\n    tenantId: string,\r\n    updates: Partial<{\r\n      users: number;\r\n      branches: number;\r\n      products: number;\r\n      transactions: number;\r\n    }>\r\n  ): Promise<void> {\r\n    try {\r\n      await connectDB();\r\n\r\n      const updateObj: any = {};\r\n\r\n      if (updates.users !== undefined) {\r\n        updateObj['usage.currentUsers'] = updates.users;\r\n      }\r\n      if (updates.branches !== undefined) {\r\n        updateObj['usage.currentBranches'] = updates.branches;\r\n      }\r\n      if (updates.products !== undefined) {\r\n        updateObj['usage.currentProducts'] = updates.products;\r\n      }\r\n      if (updates.transactions !== undefined) {\r\n        updateObj['usage.currentTransactions'] = updates.transactions;\r\n      }\r\n\r\n      await Subscription.findOneAndUpdate(\r\n        { tenantId },\r\n        updateObj,\r\n        { upsert: false }\r\n      );\r\n    } catch (error) {\r\n      console.error('Error updating subscription usage:', error);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get all subscription plans\r\n   */\r\n  static async getPlans(): Promise<any[]> {\r\n    try {\r\n      await connectDB();\r\n      return await SubscriptionPlan.find({ isActive: true }).sort({ 'price.monthly': 1 }).lean();\r\n    } catch (error) {\r\n      console.error('Error getting subscription plans:', error);\r\n      return [];\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Create or update subscription for a tenant\r\n   */\r\n  static async createSubscription(\r\n    tenantId: string,\r\n    planId: string,\r\n    options: {\r\n      isTrial?: boolean;\r\n      billingCycle?: 'monthly' | 'yearly';\r\n      startDate?: Date;\r\n    } = {}\r\n  ): Promise<any> {\r\n    try {\r\n      await connectDB();\r\n\r\n      const { isTrial = true, billingCycle = 'monthly', startDate = new Date() } = options;\r\n\r\n      // Check if tenant already has a subscription\r\n      const existingSubscription = await Subscription.findOne({\r\n        tenantId,\r\n        status: { $in: ['active', 'trial'] }\r\n      });\r\n\r\n      if (existingSubscription) {\r\n        throw new Error('Tenant already has an active subscription');\r\n      }\r\n\r\n      const subscriptionData: any = {\r\n        tenantId,\r\n        planId,\r\n        status: isTrial ? 'trial' : 'active',\r\n        billingCycle,\r\n        startDate,\r\n        isTrial,\r\n        autoRenew: true,\r\n        usage: {\r\n          currentUsers: 1,\r\n          currentBranches: 1,\r\n          currentProducts: 0,\r\n          currentTransactions: 0,\r\n          lastResetDate: startDate,\r\n        },\r\n      };\r\n\r\n      // Set trial/billing dates\r\n      if (isTrial) {\r\n        const trialEndDate = new Date(startDate);\r\n        trialEndDate.setDate(trialEndDate.getDate() + 30);\r\n        subscriptionData.trialEndDate = trialEndDate;\r\n        subscriptionData.nextBillingDate = trialEndDate;\r\n      } else {\r\n        const nextBilling = new Date(startDate);\r\n        if (billingCycle === 'yearly') {\r\n          nextBilling.setFullYear(nextBilling.getFullYear() + 1);\r\n        } else {\r\n          nextBilling.setMonth(nextBilling.getMonth() + 1);\r\n        }\r\n        subscriptionData.nextBillingDate = nextBilling;\r\n      }\r\n\r\n      const subscription = await Subscription.create(subscriptionData);\r\n\r\n      // Update tenant with subscription reference\r\n      await Tenant.findByIdAndUpdate(tenantId, {\r\n        subscriptionId: subscription._id\r\n      });\r\n\r\n      return subscription;\r\n    } catch (error) {\r\n      console.error('Error creating subscription:', error);\r\n      throw error;\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Middleware function to check subscription limits before allowing actions\r\n */\r\nexport async function checkSubscriptionLimit(\r\n  tenantId: string,\r\n  limitType: keyof SubscriptionLimits,\r\n  currentCount: number\r\n): Promise<void> {\r\n  const result = await SubscriptionService.checkLimit(tenantId, limitType, currentCount);\r\n\r\n  if (!result.allowed) {\r\n    if (result.upgradeRequired) {\r\n      throw new Error(`Subscription limit exceeded for ${limitType}. Current: ${currentCount}, Limit: ${result.limit}. Please upgrade your plan.`);\r\n    } else {\r\n      throw new Error(`Action not allowed due to subscription limits.`);\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Middleware function to check feature access\r\n */\r\nexport async function checkFeatureAccess(\r\n  tenantId: string,\r\n  feature: keyof SubscriptionFeatures\r\n): Promise<void> {\r\n  const hasAccess = await SubscriptionService.checkFeature(tenantId, feature);\r\n\r\n  if (!hasAccess) {\r\n    throw new Error(`Feature '${feature}' is not available in your current subscription plan. Please upgrade to access this feature.`);\r\n  }\r\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\lib\\sync-service.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'OfflineTransaction' is defined but never used. Allowed unused vars must match /^_/u.","line":6,"column":29,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":47},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":61,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":61,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1939,1942],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1939,1942],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Sync Service\r\n * Handles syncing offline transactions when connection is restored\r\n */\r\n\r\nimport { getOfflineStorage, OfflineTransaction } from './offline-storage';\r\n\r\nexport interface SyncResult {\r\n  success: boolean;\r\n  synced: number;\r\n  failed: number;\r\n  errors: Array<{ id: string; error: string }>;\r\n}\r\n\r\nclass SyncService {\r\n  private isSyncing = false;\r\n  private syncListeners: Array<(result: SyncResult) => void> = [];\r\n\r\n  async sync(tenant: string): Promise<SyncResult> {\r\n    if (this.isSyncing) {\r\n      return { success: false, synced: 0, failed: 0, errors: [] };\r\n    }\r\n\r\n    this.isSyncing = true;\r\n    const storage = await getOfflineStorage();\r\n    const pendingTransactions = await storage.getPendingTransactions(tenant);\r\n\r\n    if (pendingTransactions.length === 0) {\r\n      this.isSyncing = false;\r\n      return { success: true, synced: 0, failed: 0, errors: [] };\r\n    }\r\n\r\n    let synced = 0;\r\n    let failed = 0;\r\n    const errors: Array<{ id: string; error: string }> = [];\r\n\r\n    for (const transaction of pendingTransactions) {\r\n      try {\r\n        const response = await fetch(`/api/transactions?tenant=${tenant}`, {\r\n          method: 'POST',\r\n          headers: { 'Content-Type': 'application/json' },\r\n          body: JSON.stringify({\r\n            items: transaction.items,\r\n            paymentMethod: transaction.paymentMethod,\r\n            cashReceived: transaction.cashReceived,\r\n            discountCode: transaction.discountCode,\r\n          }),\r\n        });\r\n\r\n        const data = await response.json();\r\n\r\n        if (data.success) {\r\n          await storage.markTransactionSynced(transaction.id);\r\n          synced++;\r\n        } else {\r\n          const errorMsg = data.error || 'Unknown error';\r\n          await storage.markTransactionError(transaction.id, errorMsg);\r\n          failed++;\r\n          errors.push({ id: transaction.id, error: errorMsg });\r\n        }\r\n      } catch (error: any) {\r\n        const errorMsg = error.message || 'Network error';\r\n        await storage.markTransactionError(transaction.id, errorMsg);\r\n        failed++;\r\n        errors.push({ id: transaction.id, error: errorMsg });\r\n      }\r\n    }\r\n\r\n    // Clean up synced transactions (optional - keep for history or delete)\r\n    // For now, we'll keep them marked as synced\r\n\r\n    this.isSyncing = false;\r\n\r\n    const result: SyncResult = {\r\n      success: failed === 0,\r\n      synced,\r\n      failed,\r\n      errors,\r\n    };\r\n\r\n    // Notify listeners\r\n    this.syncListeners.forEach(listener => listener(result));\r\n\r\n    return result;\r\n  }\r\n\r\n  onSync(listener: (result: SyncResult) => void): () => void {\r\n    this.syncListeners.push(listener);\r\n    return () => {\r\n      this.syncListeners = this.syncListeners.filter(l => l !== listener);\r\n    };\r\n  }\r\n\r\n  getIsSyncing(): boolean {\r\n    return this.isSyncing;\r\n  }\r\n}\r\n\r\n// Singleton instance\r\nexport const syncService = new SyncService();\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\lib\\tax-calculation.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Product' is defined but never used. Allowed unused vars must match /^_/u.","line":3,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ITenant' is defined but never used. Allowed unused vars must match /^_/u.","line":4,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":17}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import TaxRule from '@/models/TaxRule';\r\nimport Tenant, { ITenantSettings } from '@/models/Tenant';\r\nimport Product from '@/models/Product';\r\nimport { ITenant } from '@/models/Tenant';\r\n\r\n/**\r\n * Calculate tax amount for a transaction\r\n * Uses TaxRule model if available, otherwise falls back to Tenant settings\r\n */\r\nexport async function calculateTax(\r\n  tenantId: string,\r\n  subtotalAfterDiscount: number,\r\n  items: Array<{\r\n    productId?: string;\r\n    productType?: 'regular' | 'bundle' | 'service';\r\n    categoryId?: string;\r\n  }>,\r\n  tenantSettings?: ITenantSettings\r\n): Promise<{ taxAmount: number; taxRate: number; taxLabel: string }> {\r\n  // Default values\r\n  let taxAmount = 0;\r\n  let taxRate = 0;\r\n  let taxLabel = 'Tax';\r\n\r\n  // Try to get tax rules from TaxRule model first\r\n  const taxRules = await TaxRule.find({\r\n    tenantId,\r\n    isActive: true,\r\n  }).sort({ priority: -1 }).lean();\r\n\r\n  if (taxRules.length > 0) {\r\n    // Use TaxRule model - apply the highest priority matching rule\r\n    for (const rule of taxRules) {\r\n      let applies = false;\r\n\r\n      // Check if rule applies to this transaction\r\n      if (rule.appliesTo === 'all') {\r\n        applies = true;\r\n      } else if (rule.appliesTo === 'products') {\r\n        // Check if any item is a product\r\n        applies = items.some(item => item.productType === 'regular' || item.productType === 'bundle');\r\n      } else if (rule.appliesTo === 'services') {\r\n        // Check if any item is a service\r\n        applies = items.some(item => item.productType === 'service');\r\n      } else if (rule.appliesTo === 'categories') {\r\n        // Check if any item matches the category\r\n        if (rule.categoryIds && rule.categoryIds.length > 0) {\r\n          applies = items.some(item => \r\n            item.categoryId && rule.categoryIds?.some(catId => catId.toString() === item.categoryId)\r\n          );\r\n        }\r\n      }\r\n\r\n      // Check product-specific rules\r\n      if (rule.productIds && rule.productIds.length > 0) {\r\n        applies = items.some(item => \r\n          item.productId && rule.productIds?.some(prodId => prodId.toString() === item.productId)\r\n        );\r\n      }\r\n\r\n      if (applies) {\r\n        taxRate = rule.rate;\r\n        taxLabel = rule.label;\r\n        taxAmount = (subtotalAfterDiscount * taxRate) / 100;\r\n        break; // Use first matching rule\r\n      }\r\n    }\r\n  } else {\r\n    // Fall back to Tenant settings\r\n    if (tenantSettings?.taxEnabled && tenantSettings.taxRate) {\r\n      taxRate = tenantSettings.taxRate;\r\n      taxLabel = tenantSettings.taxLabel || 'Tax';\r\n      taxAmount = (subtotalAfterDiscount * taxRate) / 100;\r\n    }\r\n  }\r\n\r\n  return {\r\n    taxAmount: Math.round(taxAmount * 100) / 100, // Round to 2 decimal places\r\n    taxRate,\r\n    taxLabel,\r\n  };\r\n}\r\n\r\n/**\r\n * Get applicable tax rate for a product\r\n */\r\nexport async function getProductTaxRate(\r\n  tenantId: string,\r\n  productId: string,\r\n  productType: 'regular' | 'bundle' | 'service',\r\n  categoryId?: string\r\n): Promise<number> {\r\n  const taxRules = await TaxRule.find({\r\n    tenantId,\r\n    isActive: true,\r\n  }).sort({ priority: -1 }).lean();\r\n\r\n  if (taxRules.length > 0) {\r\n    for (const rule of taxRules) {\r\n      let applies = false;\r\n\r\n      if (rule.appliesTo === 'all') {\r\n        applies = true;\r\n      } else if (rule.appliesTo === 'products' && (productType === 'regular' || productType === 'bundle')) {\r\n        applies = true;\r\n      } else if (rule.appliesTo === 'services' && productType === 'service') {\r\n        applies = true;\r\n      } else if (rule.appliesTo === 'categories' && categoryId) {\r\n        applies = rule.categoryIds?.some(catId => catId.toString() === categoryId) || false;\r\n      }\r\n\r\n      if (rule.productIds && rule.productIds.length > 0) {\r\n        applies = rule.productIds.some(prodId => prodId.toString() === productId);\r\n      }\r\n\r\n      if (applies) {\r\n        return rule.rate;\r\n      }\r\n    }\r\n  }\r\n\r\n  // Fall back to tenant settings\r\n  const tenant = await Tenant.findById(tenantId).lean();\r\n  if (tenant?.settings?.taxEnabled && tenant.settings.taxRate) {\r\n    return tenant.settings.taxRate;\r\n  }\r\n\r\n  return 0;\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\lib\\tax-rules.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ITenantSettings' is defined but never used. Allowed unused vars must match /^_/u.","line":6,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":25}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Regional Tax Rules\r\n * Handles multiple tax rates based on region, product type, category, etc.\r\n */\r\n\r\nimport { ITenantSettings } from '@/models/Tenant';\r\n\r\nexport interface TaxRule {\r\n  id: string;\r\n  name: string;\r\n  rate: number;\r\n  label: string;\r\n  appliesTo?: 'all' | 'products' | 'services' | 'categories';\r\n  categoryIds?: string[];\r\n  productIds?: string[];\r\n  region?: {\r\n    country?: string;\r\n    state?: string;\r\n    city?: string;\r\n    zipCodes?: string[];\r\n  };\r\n  priority: number;\r\n  isActive: boolean;\r\n}\r\n\r\nexport interface TaxCalculationContext {\r\n  productId?: string;\r\n  categoryId?: string;\r\n  productType?: 'product' | 'service';\r\n  region?: {\r\n    country?: string;\r\n    state?: string;\r\n    city?: string;\r\n    zipCode?: string;\r\n  };\r\n  subtotal: number;\r\n}\r\n\r\n/**\r\n * Calculate tax based on rules\r\n */\r\nexport function calculateTax(\r\n  context: TaxCalculationContext,\r\n  taxRules?: TaxRule[],\r\n  defaultTaxRate?: number\r\n): { amount: number; rate: number; label: string; appliedRules: TaxRule[] } {\r\n  if (!taxRules || taxRules.length === 0) {\r\n    // Fall back to default tax rate\r\n    if (defaultTaxRate && defaultTaxRate > 0) {\r\n      return {\r\n        amount: (context.subtotal * defaultTaxRate) / 100,\r\n        rate: defaultTaxRate,\r\n        label: 'Tax',\r\n        appliedRules: [],\r\n      };\r\n    }\r\n    return {\r\n      amount: 0,\r\n      rate: 0,\r\n      label: 'Tax',\r\n      appliedRules: [],\r\n    };\r\n  }\r\n\r\n  // Filter active rules\r\n  const activeRules = taxRules.filter((rule) => rule.isActive);\r\n\r\n  // Find applicable rules\r\n  const applicableRules: TaxRule[] = [];\r\n\r\n  for (const rule of activeRules) {\r\n    if (isRuleApplicable(rule, context)) {\r\n      applicableRules.push(rule);\r\n    }\r\n  }\r\n\r\n  // Sort by priority (higher priority first)\r\n  applicableRules.sort((a, b) => b.priority - a.priority);\r\n\r\n  // Apply the highest priority rule (or combine if needed)\r\n  // For simplicity, we'll use the highest priority rule\r\n  // In a more complex system, you might combine multiple rules\r\n  if (applicableRules.length > 0) {\r\n    const rule = applicableRules[0];\r\n    return {\r\n      amount: (context.subtotal * rule.rate) / 100,\r\n      rate: rule.rate,\r\n      label: rule.label,\r\n      appliedRules: [rule],\r\n    };\r\n  }\r\n\r\n  // No applicable rule, use default\r\n  if (defaultTaxRate && defaultTaxRate > 0) {\r\n    return {\r\n      amount: (context.subtotal * defaultTaxRate) / 100,\r\n      rate: defaultTaxRate,\r\n      label: 'Tax',\r\n      appliedRules: [],\r\n    };\r\n  }\r\n\r\n  return {\r\n    amount: 0,\r\n    rate: 0,\r\n    label: 'Tax',\r\n    appliedRules: [],\r\n  };\r\n}\r\n\r\n/**\r\n * Check if a tax rule is applicable to the context\r\n */\r\nfunction isRuleApplicable(rule: TaxRule, context: TaxCalculationContext): boolean {\r\n  // Check appliesTo\r\n  if (rule.appliesTo === 'products' && context.productType !== 'product') {\r\n    return false;\r\n  }\r\n  if (rule.appliesTo === 'services' && context.productType !== 'service') {\r\n    return false;\r\n  }\r\n\r\n  // Check category\r\n  if (rule.appliesTo === 'categories' && rule.categoryIds) {\r\n    if (!context.categoryId || !rule.categoryIds.includes(context.categoryId)) {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  // Check product IDs\r\n  if (rule.productIds && rule.productIds.length > 0) {\r\n    if (!context.productId || !rule.productIds.includes(context.productId)) {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  // Check region\r\n  if (rule.region) {\r\n    if (!context.region) {\r\n      return false;\r\n    }\r\n\r\n    if (rule.region.country && context.region.country !== rule.region.country) {\r\n      return false;\r\n    }\r\n\r\n    if (rule.region.state && context.region.state !== rule.region.state) {\r\n      return false;\r\n    }\r\n\r\n    if (rule.region.city && context.region.city !== rule.region.city) {\r\n      return false;\r\n    }\r\n\r\n    if (rule.region.zipCodes && rule.region.zipCodes.length > 0) {\r\n      if (!context.region.zipCode || !rule.region.zipCodes.includes(context.region.zipCode)) {\r\n        return false;\r\n      }\r\n    }\r\n  }\r\n\r\n  return true;\r\n}\r\n\r\n/**\r\n * Calculate tax for multiple items\r\n */\r\nexport function calculateTaxForItems(\r\n  items: Array<{\r\n    productId?: string;\r\n    categoryId?: string;\r\n    productType?: 'product' | 'service';\r\n    subtotal: number;\r\n  }>,\r\n  taxRules?: TaxRule[],\r\n  defaultTaxRate?: number,\r\n  region?: {\r\n    country?: string;\r\n    state?: string;\r\n    city?: string;\r\n    zipCode?: string;\r\n  }\r\n): { totalTax: number; itemTaxes: Array<{ itemIndex: number; tax: number; rate: number; label: string }> } {\r\n  const itemTaxes: Array<{ itemIndex: number; tax: number; rate: number; label: string }> = [];\r\n  let totalTax = 0;\r\n\r\n  items.forEach((item, index) => {\r\n    const context: TaxCalculationContext = {\r\n      productId: item.productId,\r\n      categoryId: item.categoryId,\r\n      productType: item.productType,\r\n      region,\r\n      subtotal: item.subtotal,\r\n    };\r\n\r\n    const taxResult = calculateTax(context, taxRules, defaultTaxRate);\r\n    itemTaxes.push({\r\n      itemIndex: index,\r\n      tax: taxResult.amount,\r\n      rate: taxResult.rate,\r\n      label: taxResult.label,\r\n    });\r\n    totalTax += taxResult.amount;\r\n  });\r\n\r\n  return { totalTax, itemTaxes };\r\n}\r\n\r\n/**\r\n * Get tax rules for a specific region\r\n */\r\nexport function getTaxRulesForRegion(\r\n  region: {\r\n    country?: string;\r\n    state?: string;\r\n    city?: string;\r\n    zipCode?: string;\r\n  },\r\n  taxRules?: TaxRule[]\r\n): TaxRule[] {\r\n  if (!taxRules) {\r\n    return [];\r\n  }\r\n\r\n  return taxRules.filter((rule) => {\r\n    if (!rule.isActive) {\r\n      return false;\r\n    }\r\n\r\n    if (!rule.region) {\r\n      return true; // Rule applies to all regions\r\n    }\r\n\r\n    if (rule.region.country && region.country !== rule.region.country) {\r\n      return false;\r\n    }\r\n\r\n    if (rule.region.state && region.state !== rule.region.state) {\r\n      return false;\r\n    }\r\n\r\n    if (rule.region.city && region.city !== rule.region.city) {\r\n      return false;\r\n    }\r\n\r\n    if (rule.region.zipCodes && rule.region.zipCodes.length > 0) {\r\n      if (!region.zipCode || !rule.region.zipCodes.includes(region.zipCode)) {\r\n        return false;\r\n      }\r\n    }\r\n\r\n    return true;\r\n  });\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\lib\\tenant.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\lib\\toast.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":33,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":33,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[739,742],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[739,742],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import toast from 'react-hot-toast';\r\n\r\n/**\r\n * Toast notification utilities\r\n * Provides user-friendly toast notifications to replace alert() calls\r\n */\r\n\r\nexport const showToast = {\r\n  success: (message: string) => {\r\n    toast.success(message, {\r\n      duration: 4000,\r\n    });\r\n  },\r\n  error: (message: string) => {\r\n    toast.error(message, {\r\n      duration: 5000,\r\n    });\r\n  },\r\n  info: (message: string) => {\r\n    toast(message, {\r\n      duration: 4000,\r\n      icon: '',\r\n    });\r\n  },\r\n  loading: (message: string) => {\r\n    return toast.loading(message);\r\n  },\r\n  promise: <T,>(\r\n    promise: Promise<T>,\r\n    messages: {\r\n      loading: string;\r\n      success: string | ((data: T) => string);\r\n      error: string | ((error: any) => string);\r\n    }\r\n  ) => {\r\n    return toast.promise(promise, messages);\r\n  },\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\lib\\validation-translations.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\lib\\validation.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\models\\Address.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\models\\Attendance.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\models\\AuditLog.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\models\\Booking.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\models\\Branch.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\models\\CashDrawerSession.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\models\\Category.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\models\\Customer.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\models\\CustomerOTP.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\models\\Discount.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\models\\Expense.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\models\\Invoice.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\models\\Payment.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\models\\Product.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\models\\ProductBundle.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\models\\SavedCart.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\models\\StockMovement.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\models\\Subscription.ts","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'featureName' is defined but never used. Allowed unused args must match /^_/u.","line":197,"column":53,"nodeType":null,"messageId":"unusedVar","endLine":197,"endColumn":64,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'usage' is defined but never used. Allowed unused args must match /^_/u.","line":215,"column":51,"nodeType":null,"messageId":"unusedVar","endLine":215,"endColumn":56,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\models\\SubscriptionPlan.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\models\\TaxRule.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\models\\Tenant.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\models\\Transaction.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\models\\User.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\next.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\parse-lint.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\postcss.config.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\scripts\\apply-business-type-defaults.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":55,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":55,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1939,1942],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1939,1942],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":85,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":85,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2809,2812],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2809,2812],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Migration Script: Apply Business Type Defaults\r\n * \r\n * This script applies business type defaults to existing tenants.\r\n * Run this after setting business types for tenants.\r\n * \r\n * Usage:\r\n *   npx tsx scripts/apply-business-type-defaults.ts [tenant-slug] [business-type]\r\n * \r\n * Examples:\r\n *   npx tsx scripts/apply-business-type-defaults.ts my-tenant restaurant\r\n *   npx tsx scripts/apply-business-type-defaults.ts  # Apply to all tenants\r\n */\r\n\r\nimport connectDB from '../lib/mongodb';\r\nimport Tenant from '../models/Tenant';\r\nimport { applyBusinessTypeDefaults } from '../lib/business-types';\r\n\r\nasync function applyDefaultsToTenant(tenantSlug: string, businessType?: string) {\r\n  try {\r\n    await connectDB();\r\n    \r\n    const tenant = await Tenant.findOne({ slug: tenantSlug });\r\n    if (!tenant) {\r\n      console.error(`Tenant \"${tenantSlug}\" not found`);\r\n      return false;\r\n    }\r\n\r\n    const targetBusinessType = businessType || tenant.settings.businessType;\r\n    if (!targetBusinessType) {\r\n      console.error(`No business type specified for tenant \"${tenantSlug}\"`);\r\n      return false;\r\n    }\r\n\r\n    console.log(`Applying business type defaults for \"${tenantSlug}\" (${targetBusinessType})...`);\r\n    \r\n    const updatedSettings = applyBusinessTypeDefaults(tenant.settings, targetBusinessType);\r\n    \r\n    await Tenant.updateOne(\r\n      { _id: tenant._id },\r\n      { $set: { settings: updatedSettings } }\r\n    );\r\n\r\n    console.log(` Successfully applied defaults for \"${tenantSlug}\"`);\r\n    console.log(`   Features enabled:`, {\r\n      inventory: updatedSettings.enableInventory,\r\n      categories: updatedSettings.enableCategories,\r\n      discounts: updatedSettings.enableDiscounts,\r\n      loyalty: updatedSettings.enableLoyaltyProgram,\r\n      customers: updatedSettings.enableCustomerManagement,\r\n      booking: updatedSettings.enableBookingScheduling,\r\n    });\r\n    \r\n    return true;\r\n  } catch (error: any) {\r\n    console.error(`Error applying defaults to \"${tenantSlug}\":`, error.message);\r\n    return false;\r\n  }\r\n}\r\n\r\nasync function applyDefaultsToAllTenants() {\r\n  try {\r\n    await connectDB();\r\n    \r\n    const tenants = await Tenant.find({ isActive: true });\r\n    console.log(`Found ${tenants.length} active tenants`);\r\n    \r\n    let successCount = 0;\r\n    let skipCount = 0;\r\n    \r\n    for (const tenant of tenants) {\r\n      if (!tenant.settings.businessType) {\r\n        console.log(`  Skipping \"${tenant.slug}\" - no business type set`);\r\n        skipCount++;\r\n        continue;\r\n      }\r\n\r\n      const success = await applyDefaultsToTenant(tenant.slug, tenant.settings.businessType);\r\n      if (success) {\r\n        successCount++;\r\n      }\r\n    }\r\n    \r\n    console.log(`\\n Completed: ${successCount} tenants updated, ${skipCount} skipped`);\r\n  } catch (error: any) {\r\n    console.error('Error applying defaults:', error.message);\r\n    process.exit(1);\r\n  }\r\n}\r\n\r\nasync function main() {\r\n  const args = process.argv.slice(2);\r\n  \r\n  if (args.length === 0) {\r\n    // Apply to all tenants\r\n    console.log('Applying business type defaults to all tenants...\\n');\r\n    await applyDefaultsToAllTenants();\r\n  } else if (args.length === 1) {\r\n    // Apply to specific tenant (use existing business type)\r\n    const tenantSlug = args[0];\r\n    await applyDefaultsToTenant(tenantSlug);\r\n  } else if (args.length === 2) {\r\n    // Apply to specific tenant with business type\r\n    const [tenantSlug, businessType] = args;\r\n    await applyDefaultsToTenant(tenantSlug, businessType);\r\n  } else {\r\n    console.error('Usage:');\r\n    console.error('  npx tsx scripts/apply-business-type-defaults.ts [tenant-slug] [business-type]');\r\n    console.error('');\r\n    console.error('Examples:');\r\n    console.error('  npx tsx scripts/apply-business-type-defaults.ts');\r\n    console.error('  npx tsx scripts/apply-business-type-defaults.ts my-tenant');\r\n    console.error('  npx tsx scripts/apply-business-type-defaults.ts my-tenant restaurant');\r\n    process.exit(1);\r\n  }\r\n  \r\n  process.exit(0);\r\n}\r\n\r\nmain();\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\scripts\\create-admin-user.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\scripts\\create-default-tenant.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\scripts\\create-subscription-plans.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\scripts\\create-subscription-plans.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":153,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":153,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4286,4289],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4286,4289],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import mongoose from 'mongoose';\r\nimport SubscriptionPlan from '../models/SubscriptionPlan';\r\nimport dotenv from 'dotenv';\r\n\r\n// Load environment variables\r\ndotenv.config({ path: '.env.local' });\r\n\r\nconst subscriptionPlans = [\r\n  {\r\n    name: 'Starter',\r\n    tier: 'starter',\r\n    description: 'Perfect for micro businesses getting started with POS',\r\n    price: {\r\n      monthly: 999,\r\n      currency: 'PHP',\r\n    },\r\n    features: {\r\n      maxUsers: 3,\r\n      maxBranches: 1,\r\n      maxProducts: 100,\r\n      maxTransactions: 1000,\r\n      enableInventory: true,\r\n      enableCategories: true,\r\n      enableDiscounts: false,\r\n      enableLoyaltyProgram: false,\r\n      enableCustomerManagement: false,\r\n      enableBookingScheduling: false,\r\n      enableReports: true,\r\n      enableMultiBranch: false,\r\n      enableHardwareIntegration: false,\r\n      prioritySupport: false,\r\n      customIntegrations: false,\r\n      dedicatedAccountManager: false,\r\n    },\r\n    isActive: true,\r\n    isCustom: false,\r\n  },\r\n  {\r\n    name: 'Pro',\r\n    tier: 'pro',\r\n    description: 'Ideal for core MSMEs scaling their operations',\r\n    price: {\r\n      monthly: 1999,\r\n      currency: 'PHP',\r\n    },\r\n    features: {\r\n      maxUsers: 10,\r\n      maxBranches: 2,\r\n      maxProducts: 1000,\r\n      maxTransactions: 10000,\r\n      enableInventory: true,\r\n      enableCategories: true,\r\n      enableDiscounts: true,\r\n      enableLoyaltyProgram: true,\r\n      enableCustomerManagement: false,\r\n      enableBookingScheduling: false,\r\n      enableReports: true,\r\n      enableMultiBranch: false,\r\n      enableHardwareIntegration: true,\r\n      prioritySupport: false,\r\n      customIntegrations: false,\r\n      dedicatedAccountManager: false,\r\n    },\r\n    isActive: true,\r\n    isCustom: false,\r\n  },\r\n  {\r\n    name: 'Business',\r\n    tier: 'business',\r\n    description: 'Designed for multi-branch businesses',\r\n    price: {\r\n      monthly: 3999,\r\n      currency: 'PHP',\r\n    },\r\n    features: {\r\n      maxUsers: 25,\r\n      maxBranches: 5,\r\n      maxProducts: 5000,\r\n      maxTransactions: 50000,\r\n      enableInventory: true,\r\n      enableCategories: true,\r\n      enableDiscounts: true,\r\n      enableLoyaltyProgram: true,\r\n      enableCustomerManagement: true,\r\n      enableBookingScheduling: true,\r\n      enableReports: true,\r\n      enableMultiBranch: true,\r\n      enableHardwareIntegration: true,\r\n      prioritySupport: true,\r\n      customIntegrations: false,\r\n      dedicatedAccountManager: false,\r\n    },\r\n    isActive: true,\r\n    isCustom: false,\r\n  },\r\n  {\r\n    name: 'Enterprise',\r\n    tier: 'enterprise',\r\n    description: 'Custom solutions for chains and LGUs',\r\n    price: {\r\n      monthly: 0, // Custom pricing\r\n      currency: 'PHP',\r\n    },\r\n    features: {\r\n      maxUsers: -1, // Unlimited\r\n      maxBranches: -1, // Unlimited\r\n      maxProducts: -1, // Unlimited\r\n      maxTransactions: -1, // Unlimited\r\n      enableInventory: true,\r\n      enableCategories: true,\r\n      enableDiscounts: true,\r\n      enableLoyaltyProgram: true,\r\n      enableCustomerManagement: true,\r\n      enableBookingScheduling: true,\r\n      enableReports: true,\r\n      enableMultiBranch: true,\r\n      enableHardwareIntegration: true,\r\n      prioritySupport: true,\r\n      customIntegrations: true,\r\n      dedicatedAccountManager: true,\r\n    },\r\n    isActive: true,\r\n    isCustom: true,\r\n  },\r\n];\r\n\r\nasync function createSubscriptionPlans() {\r\n  try {\r\n    const MONGODB_URI = process.env.MONGODB_URI || 'mongodb://localhost:27017/pos-system';\r\n\r\n    if (!MONGODB_URI) {\r\n      throw new Error('Please define the MONGODB_URI environment variable');\r\n    }\r\n\r\n    console.log('Connecting to MongoDB...');\r\n    await mongoose.connect(MONGODB_URI);\r\n    console.log('Connected to database');\r\n\r\n    // Clear existing plans\r\n    await SubscriptionPlan.deleteMany({});\r\n    console.log('Cleared existing subscription plans');\r\n\r\n    // Create new plans\r\n    const createdPlans = await SubscriptionPlan.insertMany(subscriptionPlans);\r\n    console.log(`Created ${createdPlans.length} subscription plans:`);\r\n\r\n    createdPlans.forEach(plan => {\r\n      console.log(`- ${plan.name} (${plan.tier}): ${plan.price.monthly}/month`);\r\n    });\r\n\r\n    console.log('Subscription plans created successfully!');\r\n    process.exit(0);\r\n  } catch (error: any) {\r\n    console.error('Error creating subscription plans:', error.message);\r\n    process.exit(1);\r\n  }\r\n}\r\n\r\ncreateSubscriptionPlans();","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\scripts\\create-tenant.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":234,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":234,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7595,7598],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7595,7598],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":260,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":260,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8339,8342],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8339,8342],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":299,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":299,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10400,10403],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10400,10403],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Script to create a new tenant\r\n * \r\n * Usage:\r\n *   npx tsx scripts/create-tenant.ts <slug> <name> [options]\r\n *   npx tsx scripts/create-tenant.ts --interactive\r\n *   npx tsx scripts/create-tenant.ts  (runs in interactive mode automatically)\r\n * \r\n * Options:\r\n *   --domain <domain>        Custom domain (optional)\r\n *   --subdomain <subdomain>  Subdomain (optional)\r\n *   --currency <code>        Currency code (default: USD)\r\n *   --language <lang>        Language: en or es (default: en)\r\n *   --email <email>          Contact email (optional)\r\n *   --phone <phone>          Contact phone (optional)\r\n *   --company <name>         Company name (optional)\r\n *   --interactive            Interactive mode (prompts for all fields)\r\n * \r\n * Examples:\r\n *   npx tsx scripts/create-tenant.ts my-store \"My Store\"\r\n *   npx tsx scripts/create-tenant.ts coffee-shop \"Coffee Shop\" --currency EUR --language es\r\n *   npx tsx scripts/create-tenant.ts --interactive\r\n *   npm run tenant:create  (runs in interactive mode)\r\n */\r\n\r\nimport dotenv from 'dotenv';\r\nimport { resolve } from 'path';\r\n\r\n// Load .env.local file (Next.js convention)\r\ndotenv.config({ path: resolve(process.cwd(), '.env.local') });\r\n// Also try .env as fallback\r\ndotenv.config({ path: resolve(process.cwd(), '.env') });\r\n\r\nimport mongoose from 'mongoose';\r\nimport Tenant from '../models/Tenant';\r\nimport User from '../models/User';\r\nimport { getDefaultTenantSettings } from '../lib/currency';\r\nimport * as readline from 'readline';\r\n\r\nconst MONGODB_URI = process.env.MONGODB_URI || 'mongodb://localhost:27017/pos-system';\r\n\r\ninterface TenantInput {\r\n  slug: string;\r\n  name: string;\r\n  domain?: string;\r\n  subdomain?: string;\r\n  currency?: string;\r\n  language?: 'en' | 'es';\r\n  email?: string;\r\n  phone?: string;\r\n  companyName?: string;\r\n}\r\n\r\n// Create readline interface for interactive mode\r\nfunction createReadline(): readline.Interface {\r\n  return readline.createInterface({\r\n    input: process.stdin,\r\n    output: process.stdout,\r\n  });\r\n}\r\n\r\n// Prompt for user input\r\nfunction question(rl: readline.Interface, query: string): Promise<string> {\r\n  return new Promise((resolve) => {\r\n    rl.question(query, resolve);\r\n  });\r\n}\r\n\r\n// Validate slug format\r\nfunction validateSlug(slug: string): boolean {\r\n  return /^[a-z0-9-]+$/.test(slug);\r\n}\r\n\r\n// Interactive mode\r\nasync function interactiveMode(): Promise<TenantInput> {\r\n  const rl = createReadline();\r\n  const input: TenantInput = { slug: '', name: '' };\r\n\r\n  console.log('\\n');\r\n  console.log('  Create New Tenant - Interactive Mode');\r\n  console.log('\\n');\r\n\r\n  // Required fields\r\n  while (!input.slug || !validateSlug(input.slug)) {\r\n    input.slug = (await question(rl, 'Tenant slug (lowercase, numbers, hyphens only): ')).trim().toLowerCase();\r\n    if (!input.slug) {\r\n      console.log(' Slug is required');\r\n    } else if (!validateSlug(input.slug)) {\r\n      console.log(' Slug can only contain lowercase letters, numbers, and hyphens');\r\n      input.slug = '';\r\n    }\r\n  }\r\n\r\n  while (!input.name) {\r\n    input.name = (await question(rl, 'Tenant name: ')).trim();\r\n    if (!input.name) {\r\n      console.log(' Name is required');\r\n    }\r\n  }\r\n\r\n  // Optional fields\r\n  const domain = await question(rl, 'Custom domain (optional, press Enter to skip): ');\r\n  if (domain.trim()) input.domain = domain.trim();\r\n\r\n  const subdomain = await question(rl, 'Subdomain (optional, press Enter to skip): ');\r\n  if (subdomain.trim()) input.subdomain = subdomain.trim().toLowerCase();\r\n\r\n  const currency = await question(rl, 'Currency code (default: USD): ');\r\n  input.currency = currency.trim() || 'USD';\r\n\r\n  const language = await question(rl, 'Language (en/es, default: en): ');\r\n  input.language = (language.trim().toLowerCase() === 'es' ? 'es' : 'en') as 'en' | 'es';\r\n\r\n  const email = await question(rl, 'Contact email (optional, press Enter to skip): ');\r\n  if (email.trim()) input.email = email.trim();\r\n\r\n  const phone = await question(rl, 'Contact phone (optional, press Enter to skip): ');\r\n  if (phone.trim()) input.phone = phone.trim();\r\n\r\n  const companyName = await question(rl, 'Company name (optional, press Enter to skip): ');\r\n  if (companyName.trim()) input.companyName = companyName.trim();\r\n\r\n  rl.close();\r\n  return input;\r\n}\r\n\r\n// Parse command line arguments\r\nfunction parseArgs(): { input: TenantInput | null; interactive: boolean } {\r\n  const args = process.argv.slice(2);\r\n  \r\n  if (args.includes('--interactive') || args.includes('-i')) {\r\n    return { input: null, interactive: true };\r\n  }\r\n\r\n  if (args.length < 2) {\r\n    return { input: null, interactive: false };\r\n  }\r\n\r\n  const input: TenantInput = {\r\n    slug: args[0].toLowerCase(),\r\n    name: args[1],\r\n  };\r\n\r\n  // Parse options\r\n  for (let i = 2; i < args.length; i++) {\r\n    const arg = args[i];\r\n    const nextArg = args[i + 1];\r\n\r\n    switch (arg) {\r\n      case '--domain':\r\n      case '-d':\r\n        if (nextArg) input.domain = nextArg;\r\n        i++;\r\n        break;\r\n      case '--subdomain':\r\n      case '-s':\r\n        if (nextArg) input.subdomain = nextArg.toLowerCase();\r\n        i++;\r\n        break;\r\n      case '--currency':\r\n      case '-c':\r\n        if (nextArg) input.currency = nextArg.toUpperCase();\r\n        i++;\r\n        break;\r\n      case '--language':\r\n      case '-l':\r\n        if (nextArg) input.language = (nextArg.toLowerCase() === 'es' ? 'es' : 'en') as 'en' | 'es';\r\n        i++;\r\n        break;\r\n      case '--email':\r\n      case '-e':\r\n        if (nextArg) input.email = nextArg;\r\n        i++;\r\n        break;\r\n      case '--phone':\r\n      case '-p':\r\n        if (nextArg) input.phone = nextArg;\r\n        i++;\r\n        break;\r\n      case '--company':\r\n      case '--company-name':\r\n        if (nextArg) input.companyName = nextArg;\r\n        i++;\r\n        break;\r\n    }\r\n  }\r\n\r\n  return { input, interactive: false };\r\n}\r\n\r\n// Create tenant\r\nasync function createTenant(input: TenantInput) {\r\n  try {\r\n    await mongoose.connect(MONGODB_URI);\r\n    console.log(' Connected to MongoDB\\n');\r\n\r\n    // Check if tenant already exists\r\n    const existing = await Tenant.findOne({ \r\n      $or: [\r\n        { slug: input.slug },\r\n        ...(input.domain ? [{ domain: input.domain }] : []),\r\n        ...(input.subdomain ? [{ subdomain: input.subdomain }] : []),\r\n      ]\r\n    });\r\n\r\n    if (existing) {\r\n      console.log(' Tenant already exists with:');\r\n      if (existing.slug === input.slug) console.log(`   - Slug: ${existing.slug}`);\r\n      if (existing.domain === input.domain) console.log(`   - Domain: ${existing.domain}`);\r\n      if (existing.subdomain === input.subdomain) console.log(`   - Subdomain: ${existing.subdomain}`);\r\n      await mongoose.disconnect();\r\n      process.exit(1);\r\n    }\r\n\r\n    // Validate slug\r\n    if (!validateSlug(input.slug)) {\r\n      console.log(' Invalid slug format. Slug can only contain lowercase letters, numbers, and hyphens');\r\n      await mongoose.disconnect();\r\n      process.exit(1);\r\n    }\r\n\r\n    // Get default settings and customize\r\n    const defaultSettings = getDefaultTenantSettings();\r\n    const settings = {\r\n      ...defaultSettings,\r\n      currency: input.currency || defaultSettings.currency,\r\n      language: input.language || defaultSettings.language,\r\n      ...(input.email && { email: input.email }),\r\n      ...(input.phone && { phone: input.phone }),\r\n      ...(input.companyName && { companyName: input.companyName }),\r\n    };\r\n\r\n    // Create tenant\r\n    const tenantData: any = {\r\n      slug: input.slug,\r\n      name: input.name,\r\n      settings,\r\n      isActive: true,\r\n    };\r\n\r\n    if (input.domain) tenantData.domain = input.domain;\r\n    if (input.subdomain) tenantData.subdomain = input.subdomain;\r\n\r\n    const tenant = await Tenant.create(tenantData);\r\n\r\n    // Automatically create admin user for the tenant\r\n    const adminEmail = `admin@${tenant.slug}.local`;\r\n    const adminPassword = `Admin${tenant.slug}123!`;\r\n    let adminUser = null;\r\n    \r\n    try {\r\n      adminUser = await User.create({\r\n        email: adminEmail,\r\n        password: adminPassword,\r\n        name: 'Administrator',\r\n        role: 'admin',\r\n        tenantId: tenant._id,\r\n        isActive: true,\r\n      });\r\n    } catch (userError: any) {\r\n      console.log('\\n  Warning: Failed to create admin user:', userError.message);\r\n    }\r\n\r\n    console.log('\\n Tenant created successfully!\\n');\r\n    console.log('Tenant Details:');\r\n    console.log('');\r\n    console.log(`  Slug:        ${tenant.slug}`);\r\n    console.log(`  Name:        ${tenant.name}`);\r\n    if (tenant.domain) console.log(`  Domain:      ${tenant.domain}`);\r\n    if (tenant.subdomain) console.log(`  Subdomain:   ${tenant.subdomain}`);\r\n    console.log(`  Currency:    ${tenant.settings.currency}`);\r\n    console.log(`  Language:    ${tenant.settings.language}`);\r\n    if (tenant.settings.email) console.log(`  Email:       ${tenant.settings.email}`);\r\n    if (tenant.settings.phone) console.log(`  Phone:       ${tenant.settings.phone}`);\r\n    console.log(`  Active:      ${tenant.isActive ? 'Yes' : 'No'}`);\r\n    console.log(`  Created:     ${tenant.createdAt}`);\r\n    console.log('\\n');\r\n    \r\n    if (adminUser) {\r\n      console.log(' Admin User Created:');\r\n      console.log('');\r\n      console.log(`  Email:       ${adminEmail}`);\r\n      console.log(`  Password:    ${adminPassword}`);\r\n      console.log(`  Role:        admin`);\r\n      console.log('\\n');\r\n      console.log('  IMPORTANT: Please change the admin password after first login!\\n');\r\n    }\r\n    \r\n    console.log('Next steps:');\r\n    console.log(`  1. Access your tenant at: http://localhost:3000/${tenant.slug}/${tenant.settings.language}`);\r\n    if (adminUser) {\r\n      console.log(`  2. Login with admin credentials above`);\r\n    } else {\r\n      console.log(`  2. Create an admin user: npx tsx scripts/create-admin-user.ts ${tenant.slug} <email> <password> \"<name>\"`);\r\n    }\r\n    console.log(`  3. Configure settings at: http://localhost:3000/${tenant.slug}/${tenant.settings.language}/settings\\n`);\r\n\r\n    await mongoose.disconnect();\r\n  } catch (error: any) {\r\n    console.error('\\n Error creating tenant:', error.message);\r\n    \r\n    if (error.code === 11000) {\r\n      const field = Object.keys(error.keyPattern)[0];\r\n      console.error(`   Duplicate ${field}: ${error.keyValue[field]}`);\r\n    }\r\n    \r\n    await mongoose.disconnect();\r\n    process.exit(1);\r\n  }\r\n}\r\n\r\n// Main function\r\nasync function main() {\r\n  const { input, interactive } = parseArgs();\r\n\r\n  if (interactive || !input) {\r\n    // If interactive flag is set or no input provided, enter interactive mode\r\n    const tenantInput = await interactiveMode();\r\n    await createTenant(tenantInput);\r\n  } else {\r\n    await createTenant(input);\r\n  }\r\n}\r\n\r\nmain();\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\scripts\\install.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\scripts\\postinstall.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\scripts\\reset-collections.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":100,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":100,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3697,3700],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3697,3700],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":135,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":135,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4716,4719],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4716,4719],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":210,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":210,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7495,7498],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7495,7498],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":326,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":326,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11570,11573],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11570,11573],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Script to reset/clean database collections\r\n * Usage: \r\n *   npx tsx scripts/reset-collections.ts [options]\r\n * \r\n * Options:\r\n *   --all                    Clean all collections\r\n *   --tenant=<slug>          Clean collections for specific tenant\r\n *   --collection=<name>      Clean specific collection(s), comma-separated\r\n *   --keep-tenants           Keep tenant collection when using --all\r\n *   --keep-users             Keep user collection when using --all\r\n *   --create-default-store   Create default store/tenant after reset\r\n *   --create-admin           Create admin user for default store (requires --create-default-store)\r\n *   --create-demo-tenant     Create demo tenant with sample data\r\n *   --force                  Skip confirmation prompt\r\n * \r\n * Examples:\r\n *   npx tsx scripts/reset-collections.ts --all\r\n *   npx tsx scripts/reset-collections.ts --all --create-default-store\r\n *   npx tsx scripts/reset-collections.ts --all --create-default-store --create-admin\r\n *   npx tsx scripts/reset-collections.ts --all --create-default-store --create-demo-tenant\r\n *   npx tsx scripts/reset-collections.ts --tenant=default\r\n *   npx tsx scripts/reset-collections.ts --collection=transactions,products\r\n *   npx tsx scripts/reset-collections.ts --all --keep-tenants --keep-users\r\n */\r\n\r\nimport dotenv from 'dotenv';\r\nimport { resolve } from 'path';\r\nimport readline from 'readline';\r\n\r\n// Load .env.local file (Next.js convention)\r\ndotenv.config({ path: resolve(process.cwd(), '.env.local') });\r\n// Also try .env as fallback\r\ndotenv.config({ path: resolve(process.cwd(), '.env') });\r\n\r\nimport mongoose from 'mongoose';\r\n\r\n// Import all models\r\nimport Attendance from '../models/Attendance';\r\nimport AuditLog from '../models/AuditLog';\r\nimport Booking from '../models/Booking';\r\nimport Branch from '../models/Branch';\r\nimport CashDrawerSession from '../models/CashDrawerSession';\r\nimport Category from '../models/Category';\r\nimport Discount from '../models/Discount';\r\nimport Expense from '../models/Expense';\r\nimport Product from '../models/Product';\r\nimport ProductBundle from '../models/ProductBundle';\r\nimport SavedCart from '../models/SavedCart';\r\nimport StockMovement from '../models/StockMovement';\r\nimport Tenant from '../models/Tenant';\r\nimport Transaction from '../models/Transaction';\r\nimport User from '../models/User';\r\nimport { getDefaultTenantSettings } from '../lib/currency';\r\n\r\nconst MONGODB_URI = process.env.MONGODB_URI || 'mongodb://localhost:27017/pos-system';\r\n\r\n// Collection mapping (Mongoose automatically pluralizes and lowercases model names)\r\nconst COLLECTIONS = {\r\n  attendances: Attendance,\r\n  auditlogs: AuditLog,\r\n  bookings: Booking,\r\n  branches: Branch,\r\n  cashdrawersessions: CashDrawerSession,\r\n  categories: Category,\r\n  discounts: Discount,\r\n  expenses: Expense,\r\n  products: Product,\r\n  productbundles: ProductBundle,\r\n  savedcarts: SavedCart,\r\n  stockmovements: StockMovement,\r\n  tenants: Tenant,\r\n  transactions: Transaction,\r\n  users: User,\r\n} as const;\r\n\r\ntype CollectionName = keyof typeof COLLECTIONS;\r\n\r\n// Helper function to prompt for confirmation\r\nfunction askQuestion(query: string): Promise<string> {\r\n  const rl = readline.createInterface({\r\n    input: process.stdin,\r\n    output: process.stdout,\r\n  });\r\n\r\n  return new Promise((resolve) => {\r\n    rl.question(query, (answer) => {\r\n      rl.close();\r\n      resolve(answer);\r\n    });\r\n  });\r\n}\r\n\r\n// Get collection counts\r\nasync function getCollectionCounts(tenantId?: mongoose.Types.ObjectId) {\r\n  const counts: Record<string, number> = {};\r\n  \r\n  for (const [name, model] of Object.entries(COLLECTIONS)) {\r\n    try {\r\n      const mongooseModel = model as mongoose.Model<any>;\r\n      if (tenantId && 'tenantId' in model.schema.paths) {\r\n        counts[name] = await mongooseModel.countDocuments({ tenantId });\r\n      } else {\r\n        counts[name] = await mongooseModel.countDocuments();\r\n      }\r\n    } catch (error) {\r\n      counts[name] = 0;\r\n    }\r\n  }\r\n  \r\n  return counts;\r\n}\r\n\r\n// Clean collections\r\nasync function cleanCollections(\r\n  collections: CollectionName[],\r\n  tenantId?: mongoose.Types.ObjectId,\r\n  keepTenants = false,\r\n  keepUsers = false\r\n) {\r\n  const results: Record<string, { deleted: number; error?: string }> = {};\r\n  \r\n  for (const collectionName of collections) {\r\n    // Skip if keeping tenants or users\r\n    if (collectionName === 'tenants' && keepTenants) {\r\n      results[collectionName] = { deleted: 0 };\r\n      continue;\r\n    }\r\n    if (collectionName === 'users' && keepUsers) {\r\n      results[collectionName] = { deleted: 0 };\r\n      continue;\r\n    }\r\n    \r\n    const model = COLLECTIONS[collectionName];\r\n    const mongooseModel = model as mongoose.Model<any>;\r\n    \r\n    try {\r\n      let deleteResult;\r\n      if (tenantId && 'tenantId' in model.schema.paths) {\r\n        deleteResult = await mongooseModel.deleteMany({ tenantId });\r\n      } else {\r\n        deleteResult = await mongooseModel.deleteMany({});\r\n      }\r\n      results[collectionName] = { deleted: deleteResult.deletedCount || 0 };\r\n    } catch (error: unknown) {\r\n      results[collectionName] = { \r\n        deleted: 0, \r\n        error: typeof error === 'object' && error !== null && 'message' in error ? (error as { message: string }).message : String(error)\r\n      };\r\n    }\r\n  }\r\n  \r\n  return results;\r\n}\r\n\r\n// Create default store/tenant\r\nasync function createDefaultStore(createAdmin = false) {\r\n  try {\r\n    console.log('');\r\n    console.log('Creating default store...');\r\n    \r\n    // Check if default tenant already exists\r\n    const existing = await Tenant.findOne({ slug: 'default' });\r\n    if (existing) {\r\n      console.log('  Default tenant already exists');\r\n      if (createAdmin) {\r\n        // Check if admin user exists\r\n        const adminExists = await User.findOne({ \r\n          email: 'admin@default.local',\r\n          tenantId: existing._id \r\n        });\r\n        if (!adminExists) {\r\n          console.log('Creating admin user for default store...');\r\n          const adminUser = await User.create({\r\n            email: 'admin@default.local',\r\n            password: 'Admindefault123!',\r\n            name: 'Administrator',\r\n            role: 'admin',\r\n            tenantId: existing._id,\r\n            isActive: true,\r\n          });\r\n          console.log(' Admin user created for default store');\r\n          console.log(`  Email:    ${adminUser.email}`);\r\n          console.log(`  Password: Admindefault123!`);\r\n          console.log(`  Role:     admin`);\r\n          console.log(`  Tenant:   ${existing.name} (${existing.slug})`);\r\n          console.log(`  Tenant ID: ${existing._id}`);\r\n          console.log('');\r\n          console.log('  IMPORTANT: Please change the admin password after first login!');\r\n        } else {\r\n          console.log('  Admin user already exists for default store');\r\n          console.log(`  Tenant: ${existing.name} (${existing.slug})`);\r\n        }\r\n      }\r\n      return existing;\r\n    }\r\n\r\n    // Get default settings and customize (following tenant signup route pattern)\r\n    const defaultSettings = getDefaultTenantSettings();\r\n    const settings = {\r\n      ...defaultSettings,\r\n      currency: defaultSettings.currency || 'USD',\r\n      language: (defaultSettings.language || 'en') as 'en' | 'es',\r\n      companyName: 'Default Store',\r\n      email: 'admin@default.local',\r\n      phone: '+1-555-0000',\r\n    };\r\n\r\n    // Create tenant first (following tenant signup route hierarchy)\r\n    const tenantData: any = {\r\n      slug: 'default',\r\n      name: 'Default Store',\r\n      settings,\r\n      isActive: true,\r\n    };\r\n\r\n    const tenant = await Tenant.create(tenantData);\r\n\r\n    console.log(' Default store created');\r\n    console.log(`  Name: ${tenant.name}`);\r\n    console.log(`  Slug: ${tenant.slug}`);\r\n    console.log(`  Tenant ID: ${tenant._id}`);\r\n\r\n    // Create admin user for the tenant (after tenant is created)\r\n    if (createAdmin) {\r\n      try {\r\n        const adminEmail = 'admin@default.local';\r\n        const adminPassword = 'Admindefault123!';\r\n        const adminName = 'Administrator';\r\n        \r\n        console.log('');\r\n        console.log('Creating admin user for default store...');\r\n        const adminUser = await User.create({\r\n          email: adminEmail.toLowerCase(),\r\n          password: adminPassword,\r\n          name: adminName,\r\n          role: 'admin',\r\n          tenantId: tenant._id,\r\n          isActive: true,\r\n        });\r\n        \r\n        console.log('');\r\n        console.log(' Admin user created for default store');\r\n        console.log(`  Email:    ${adminUser.email}`);\r\n        console.log(`  Password: Admindefault123!`);\r\n        console.log(`  Role:     admin`);\r\n        console.log(`  Tenant:   ${tenant.name} (${tenant.slug})`);\r\n        console.log(`  Tenant ID: ${tenant._id}`);\r\n        console.log('');\r\n        console.log('  IMPORTANT: Please change the admin password after first login!');\r\n      } catch (userError: unknown) {\r\n        console.log('');\r\n        console.log('  Warning: Failed to create admin user:', typeof userError === 'object' && userError !== null && 'message' in userError ? (userError as { message: string }).message : String(userError));\r\n        console.log(`  Tenant: ${tenant.name} (${tenant.slug})`);\r\n      }\r\n    }\r\n\r\n    return tenant;\r\n  } catch (error: unknown) {\r\n    console.error(' Error creating default store:', typeof error === 'object' && error !== null && 'message' in error ? (error as { message: string }).message : String(error));\r\n    throw error;\r\n  }\r\n}\r\n\r\n// Create demo tenant with sample data\r\nasync function createDemoTenant() {\r\n  try {\r\n    console.log('');\r\n    console.log('Creating demo tenant...');\r\n    \r\n    // Check if demo tenant already exists\r\n    const existing = await Tenant.findOne({ slug: 'demo' });\r\n    if (existing) {\r\n      console.log('  Demo tenant already exists');\r\n      console.log(`  Name: ${existing.name}`);\r\n      console.log(`  Slug: ${existing.slug}`);\r\n      return existing;\r\n    }\r\n\r\n    // Create demo tenant with settings\r\n    const defaultSettings = getDefaultTenantSettings();\r\n    const demoTenant = await Tenant.create({\r\n      slug: 'demo',\r\n      name: 'Demo Store',\r\n      settings: {\r\n        ...defaultSettings,\r\n        companyName: 'Demo Store',\r\n        email: 'demo@store.local',\r\n        phone: '+1-555-0123',\r\n        address: {\r\n          street: '123 Demo Street',\r\n          city: 'Demo City',\r\n          state: 'DC',\r\n          zipCode: '12345',\r\n          country: 'USA',\r\n        },\r\n      },\r\n      isActive: true,\r\n    });\r\n\r\n    console.log(' Demo tenant created');\r\n    console.log(`  Name: ${demoTenant.name}`);\r\n    console.log(`  Slug: ${demoTenant.slug}`);\r\n    console.log(`  Tenant ID: ${demoTenant._id}`);\r\n\r\n    // Create demo admin user\r\n    try {\r\n      console.log('');\r\n      console.log('Creating demo admin user...');\r\n      const demoAdmin = await User.create({\r\n        email: 'admin@demo.local',\r\n        password: 'Admindemo123!',\r\n        name: 'Demo Administrator',\r\n        role: 'admin',\r\n        tenantId: demoTenant._id,\r\n        isActive: true,\r\n      });\r\n      \r\n      console.log(' Demo admin user created');\r\n      console.log(`  Email:    ${demoAdmin.email}`);\r\n      console.log(`  Password: Admindemo123!`);\r\n      console.log(`  Role:     admin`);\r\n      console.log(`  Tenant:   ${demoTenant.name} (${demoTenant.slug})`);\r\n      console.log('');\r\n      console.log('  IMPORTANT: Please change the admin password after first login!');\r\n    } catch (userError: any) {\r\n      console.log('');\r\n      console.log('  Warning: Failed to create demo admin user:', userError.message);\r\n    }\r\n\r\n    // Create demo categories\r\n    try {\r\n      console.log('');\r\n      console.log('Creating demo categories...');\r\n      const categories = [\r\n        { name: 'Electronics', description: 'Electronic products' },\r\n        { name: 'Clothing', description: 'Apparel and accessories' },\r\n        { name: 'Food & Beverages', description: 'Food and drink items' },\r\n        { name: 'Books', description: 'Books and publications' },\r\n      ];\r\n\r\n      const createdCategories = [];\r\n      for (const cat of categories) {\r\n        const category = await Category.create({\r\n          name: cat.name,\r\n          description: cat.description,\r\n          tenantId: demoTenant._id,\r\n          isActive: true,\r\n        });\r\n        createdCategories.push(category);\r\n      }\r\n      console.log(` Created ${createdCategories.length} demo categories`);\r\n    } catch (catError: unknown) {\r\n      console.log('  Warning: Failed to create demo categories:', typeof catError === 'object' && catError !== null && 'message' in catError ? (catError as { message: string }).message : String(catError));\r\n    }\r\n\r\n    // Create demo products\r\n    try {\r\n      console.log('');\r\n      console.log('Creating demo products...');\r\n      const products = [\r\n        { name: 'Laptop Computer', price: 999.99, stock: 10, category: 'Electronics', sku: 'LAP-001' },\r\n        { name: 'Wireless Mouse', price: 29.99, stock: 50, category: 'Electronics', sku: 'MOU-001' },\r\n        { name: 'T-Shirt', price: 19.99, stock: 100, category: 'Clothing', sku: 'TSH-001' },\r\n        { name: 'Jeans', price: 49.99, stock: 75, category: 'Clothing', sku: 'JEA-001' },\r\n        { name: 'Coffee', price: 12.99, stock: 200, category: 'Food & Beverages', sku: 'COF-001' },\r\n        { name: 'Bottled Water', price: 1.99, stock: 500, category: 'Food & Beverages', sku: 'WAT-001' },\r\n        { name: 'Programming Book', price: 39.99, stock: 25, category: 'Books', sku: 'BOK-001' },\r\n        { name: 'Novel', price: 14.99, stock: 40, category: 'Books', sku: 'BOK-002' },\r\n      ];\r\n\r\n      // Get category IDs\r\n      const categories = await Category.find({ tenantId: demoTenant._id });\r\n      const categoryMap = new Map(categories.map(cat => [cat.name, cat._id]));\r\n\r\n      const createdProducts = [];\r\n      for (const prod of products) {\r\n        const categoryId = categoryMap.get(prod.category);\r\n        const product = await Product.create({\r\n          name: prod.name,\r\n          price: prod.price,\r\n          stock: prod.stock,\r\n          sku: prod.sku,\r\n          category: prod.category,\r\n          categoryId: categoryId,\r\n          tenantId: demoTenant._id,\r\n          productType: 'regular',\r\n          hasVariations: false,\r\n          trackInventory: true,\r\n        });\r\n        createdProducts.push(product);\r\n      }\r\n      console.log(` Created ${createdProducts.length} demo products`);\r\n    } catch (prodError: unknown) {\r\n      console.log('  Warning: Failed to create demo products:', typeof prodError === 'object' && prodError !== null && 'message' in prodError ? (prodError as { message: string }).message : String(prodError));\r\n    }\r\n\r\n    console.log('');\r\n    console.log(' Demo tenant setup complete');\r\n    console.log(`  Access at: /demo/en`);\r\n    console.log(`  Admin login: admin@demo.local / Admindemo123!`);\r\n\r\n    return demoTenant;\r\n  } catch (error: unknown) {\r\n    console.error(' Error creating demo tenant:', typeof error === 'object' && error !== null && 'message' in error ? (error as { message: string }).message : String(error));\r\n    throw error;\r\n  }\r\n}\r\n\r\n// Main function\r\nasync function resetCollections() {\r\n  try {\r\n    // Parse arguments\r\n    const args = process.argv.slice(2);\r\n    const cleanAll = args.includes('--all');\r\n    const force = args.includes('--force');\r\n    const keepTenants = args.includes('--keep-tenants');\r\n    const keepUsers = args.includes('--keep-users');\r\n    const shouldCreateDefaultStore = args.includes('--create-default-store');\r\n    const createAdmin = args.includes('--create-admin');\r\n    const shouldCreateDemoTenant = args.includes('--create-demo-tenant');\r\n    \r\n    const tenantSlug = args.find(arg => arg.startsWith('--tenant='))?.split('=')[1];\r\n    const collectionArg = args.find(arg => arg.startsWith('--collection='))?.split('=')[1];\r\n    \r\n    // Connect to MongoDB\r\n    await mongoose.connect(MONGODB_URI);\r\n    console.log(' Connected to MongoDB');\r\n    console.log('');\r\n    \r\n    let tenantId: mongoose.Types.ObjectId | undefined;\r\n    let collectionsToClean: CollectionName[] = [];\r\n    \r\n    // Handle tenant-specific cleaning\r\n    if (tenantSlug) {\r\n      const tenant = await Tenant.findOne({ slug: tenantSlug });\r\n      if (!tenant) {\r\n        console.error(` Tenant \"${tenantSlug}\" not found`);\r\n        await mongoose.disconnect();\r\n        process.exit(1);\r\n      }\r\n      tenantId = tenant._id;\r\n      console.log(`Target tenant: ${tenant.name} (${tenant.slug})`);\r\n      console.log('');\r\n    }\r\n    \r\n    // Determine which collections to clean\r\n    if (cleanAll) {\r\n      collectionsToClean = Object.keys(COLLECTIONS) as CollectionName[];\r\n    } else if (collectionArg) {\r\n      const requested = collectionArg.split(',').map(c => c.trim().toLowerCase());\r\n      collectionsToClean = requested.filter(c => c in COLLECTIONS) as CollectionName[];\r\n      \r\n      if (collectionsToClean.length === 0) {\r\n        console.error(' No valid collections specified');\r\n        console.log('Available collections:', Object.keys(COLLECTIONS).join(', '));\r\n        await mongoose.disconnect();\r\n        process.exit(1);\r\n      }\r\n    } else {\r\n      console.error(' No action specified. Use --all, --tenant=<slug>, or --collection=<name>');\r\n      console.log('');\r\n      console.log('Usage examples:');\r\n      console.log('  npx tsx scripts/reset-collections.ts --all');\r\n      console.log('  npx tsx scripts/reset-collections.ts --all --create-default-store');\r\n      console.log('  npx tsx scripts/reset-collections.ts --all --create-default-store --create-admin');\r\n      console.log('  npx tsx scripts/reset-collections.ts --all --create-default-store --create-demo-tenant');\r\n      console.log('  npx tsx scripts/reset-collections.ts --tenant=default');\r\n      console.log('  npx tsx scripts/reset-collections.ts --collection=transactions,products');\r\n      await mongoose.disconnect();\r\n      process.exit(1);\r\n    }\r\n    \r\n    // Get current counts\r\n    console.log('Current collection counts:');\r\n    const counts = await getCollectionCounts(tenantId);\r\n    let totalCount = 0;\r\n    \r\n    for (const collectionName of collectionsToClean) {\r\n      const count = counts[collectionName] || 0;\r\n      if (collectionName === 'tenants' && keepTenants) {\r\n        console.log(`  ${collectionName.padEnd(20)} ${count.toString().padStart(6)} (keeping)`);\r\n      } else if (collectionName === 'users' && keepUsers) {\r\n        console.log(`  ${collectionName.padEnd(20)} ${count.toString().padStart(6)} (keeping)`);\r\n      } else {\r\n        console.log(`  ${collectionName.padEnd(20)} ${count.toString().padStart(6)}`);\r\n        totalCount += count;\r\n      }\r\n    }\r\n    console.log('');\r\n    \r\n    if (totalCount === 0) {\r\n      console.log(' No documents to delete');\r\n      await mongoose.disconnect();\r\n      return;\r\n    }\r\n    \r\n    // Confirmation prompt\r\n    if (!force) {\r\n      const action = tenantSlug \r\n        ? `clean ${totalCount} document(s) for tenant \"${tenantSlug}\"`\r\n        : `clean ${totalCount} document(s) from ${collectionsToClean.length} collection(s)`;\r\n      \r\n      console.log(`  WARNING: This will ${action}`);\r\n      console.log('This action cannot be undone!');\r\n      console.log('');\r\n      \r\n      const answer = await askQuestion('Are you sure you want to continue? (yes/no): ');\r\n      if (answer.toLowerCase() !== 'yes' && answer.toLowerCase() !== 'y') {\r\n        console.log('Operation cancelled');\r\n        await mongoose.disconnect();\r\n        return;\r\n      }\r\n      console.log('');\r\n    }\r\n    \r\n    // Clean collections\r\n    console.log('Cleaning collections...');\r\n    const results = await cleanCollections(collectionsToClean, tenantId, keepTenants, keepUsers);\r\n    \r\n    // Display results\r\n    console.log('');\r\n    console.log('Results:');\r\n    let totalDeleted = 0;\r\n    let hasErrors = false;\r\n    \r\n    for (const [collectionName, result] of Object.entries(results)) {\r\n      if (result.error) {\r\n        console.log(`   ${collectionName.padEnd(20)} Error: ${result.error}`);\r\n        hasErrors = true;\r\n      } else if (result.deleted > 0) {\r\n        console.log(`   ${collectionName.padEnd(20)} ${result.deleted.toString().padStart(6)} deleted`);\r\n        totalDeleted += result.deleted;\r\n      } else if (collectionName === 'tenants' && keepTenants) {\r\n        console.log(`  - ${collectionName.padEnd(20)} skipped (kept)`);\r\n      } else if (collectionName === 'users' && keepUsers) {\r\n        console.log(`  - ${collectionName.padEnd(20)} skipped (kept)`);\r\n      } else {\r\n        console.log(`  - ${collectionName.padEnd(20)} 0 (already empty)`);\r\n      }\r\n    }\r\n    \r\n    console.log('');\r\n    console.log(` Total: ${totalDeleted} document(s) deleted`);\r\n    \r\n    if (hasErrors) {\r\n      console.log('  Some collections had errors during deletion');\r\n    }\r\n    \r\n    // Create default store if requested\r\n    if (shouldCreateDefaultStore) {\r\n      try {\r\n        await createDefaultStore(createAdmin);\r\n        console.log('');\r\n        console.log(' Default store setup complete');\r\n      } catch (error: unknown) {\r\n        console.log('');\r\n        console.log('  Warning: Failed to create default store:', typeof error === 'object' && error !== null && 'message' in error ? (error as { message: string }).message : String(error));\r\n      }\r\n    }\r\n\r\n    // Create demo tenant if requested\r\n    if (shouldCreateDemoTenant) {\r\n      try {\r\n        await createDemoTenant();\r\n      } catch (error: unknown) {\r\n        console.log('');\r\n        console.log('  Warning: Failed to create demo tenant:', typeof error === 'object' && error !== null && 'message' in error ? (error as { message: string }).message : String(error));\r\n      }\r\n    }\r\n    \r\n    await mongoose.disconnect();\r\n    console.log(' Disconnected from MongoDB');\r\n  } catch (error: unknown) {\r\n    console.error(' Error resetting collections:', typeof error === 'object' && error !== null && 'message' in error ? (error as { message: string }).message : String(error));\r\n    if (mongoose.connection.readyState === 1) {\r\n      await mongoose.disconnect();\r\n    }\r\n    process.exit(1);\r\n  }\r\n}\r\n\r\nresetCollections();\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\scripts\\test-automations.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":24,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":24,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[660,663],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[660,663],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'text' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":47,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":47,"endColumn":17},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":77,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":77,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2455,2458],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2455,2458],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":132,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":132,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4645,4648],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4645,4648],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"#!/usr/bin/env tsx\r\n/**\r\n * Test Automation Script\r\n * Tests all automation endpoints\r\n * \r\n * Usage: npx tsx scripts/test-automations.ts\r\n */\r\n\r\nimport { config } from 'dotenv';\r\nimport { resolve } from 'path';\r\n\r\n// Load .env.local first (takes precedence), then .env\r\nconfig({ path: resolve(process.cwd(), '.env.local') });\r\nconfig({ path: resolve(process.cwd(), '.env') });\r\n\r\nconst BASE_URL = process.env.BASE_URL || 'http://localhost:3000';\r\n// Use actual CRON_SECRET from environment, or allow testing without it\r\nconst CRON_SECRET = process.env.CRON_SECRET;\r\n\r\ninterface TestResult {\r\n  name: string;\r\n  success: boolean;\r\n  message: string;\r\n  data?: any;\r\n}\r\n\r\nasync function testAutomation(name: string, endpoint: string): Promise<TestResult> {\r\n  try {\r\n    // Handle endpoints that already have query params\r\n    const separator = endpoint.includes('?') ? '&' : '?';\r\n    // Only add secret if CRON_SECRET is configured\r\n    const secretParam = CRON_SECRET ? `${separator}secret=${CRON_SECRET}` : '';\r\n    const url = `${BASE_URL}${endpoint}${secretParam}`;\r\n    console.log(`\\n Testing: ${name}`);\r\n    console.log(`   URL: ${url}`);\r\n    \r\n    const response = await fetch(url, {\r\n      method: 'GET',\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n      },\r\n    });\r\n    \r\n    // Check if response is HTML (error page)\r\n    const contentType = response.headers.get('content-type') || '';\r\n    if (contentType.includes('text/html')) {\r\n      const text = await response.text();\r\n      console.log(`    Server returned HTML (likely 404 or error page)`);\r\n      console.log(`   Status: ${response.status} ${response.statusText}`);\r\n      return {\r\n        name,\r\n        success: false,\r\n        message: `Server returned HTML instead of JSON. Status: ${response.status}. Is the server running?`,\r\n      };\r\n    }\r\n    \r\n    const data = await response.json();\r\n    \r\n    if (response.ok && data.success !== false) {\r\n      console.log(`    Success: ${data.message || 'OK'}`);\r\n      return {\r\n        name,\r\n        success: true,\r\n        message: data.message || 'OK',\r\n        data,\r\n      };\r\n    } else {\r\n      console.log(`    Failed: ${data.error || data.message || 'Unknown error'}`);\r\n      console.log(`   Status: ${response.status}`);\r\n      return {\r\n        name,\r\n        success: false,\r\n        message: data.error || data.message || 'Unknown error',\r\n        data,\r\n      };\r\n    }\r\n  } catch (error: any) {\r\n    if (error.message.includes('fetch failed') || error.message.includes('ECONNREFUSED')) {\r\n      console.log(`    Connection Error: Is the server running at ${BASE_URL}?`);\r\n      return {\r\n        name,\r\n        success: false,\r\n        message: `Connection failed. Is the server running at ${BASE_URL}?`,\r\n      };\r\n    }\r\n    console.log(`    Error: ${error.message}`);\r\n    return {\r\n      name,\r\n      success: false,\r\n      message: error.message,\r\n    };\r\n  }\r\n}\r\n\r\nasync function main() {\r\n  console.log(' Testing LocalPro POS Automations');\r\n  console.log('=====================================');\r\n  console.log(`Base URL: ${BASE_URL}`);\r\n  console.log(`Cron Secret: ${CRON_SECRET ? '***' + CRON_SECRET.slice(-4) : 'NOT SET'}`);\r\n  \r\n  if (CRON_SECRET) {\r\n    console.log('    CRON_SECRET is configured - using authentication');\r\n    console.log(`   Secret length: ${CRON_SECRET.length} characters`);\r\n  } else {\r\n    console.warn('\\n  Note: CRON_SECRET is not set. Endpoints will work without authentication.');\r\n    console.warn('   Set CRON_SECRET in .env.local if you want to test with authentication.');\r\n    console.warn('   Make sure .env.local exists in the project root and contains: CRON_SECRET=your-secret');\r\n  }\r\n  \r\n  // Test server connection first\r\n  console.log('\\n Checking server connection...');\r\n  try {\r\n    const healthCheckUrl = CRON_SECRET \r\n      ? `${BASE_URL}/api/automations/status?secret=${CRON_SECRET}`\r\n      : `${BASE_URL}/api/automations/status`;\r\n    \r\n    const healthCheck = await fetch(healthCheckUrl, {\r\n      method: 'GET',\r\n      headers: { 'Content-Type': 'application/json' },\r\n    });\r\n    \r\n    if (healthCheck.ok) {\r\n      console.log('    Server is reachable and responding');\r\n    } else if (healthCheck.status === 401) {\r\n      console.error('    Authentication failed!');\r\n      console.error('   The CRON_SECRET in your environment does not match what the server expects.');\r\n      console.error('   Check your .env.local file and ensure CRON_SECRET matches.');\r\n      process.exit(1);\r\n    } else {\r\n      console.log(`     Server responded with status: ${healthCheck.status}`);\r\n    }\r\n  } catch (error: any) {\r\n    console.error(`    Cannot connect to server at ${BASE_URL}`);\r\n    console.error(`   Error: ${error.message}`);\r\n    console.error('\\n Make sure your Next.js server is running:');\r\n    console.error('   npm run dev');\r\n    process.exit(1);\r\n  }\r\n\r\n  const tests = [\r\n    { name: 'Automation Status', endpoint: '/api/automations/status' },\r\n    { name: 'Booking Reminders', endpoint: '/api/automations/booking-reminders' },\r\n    { name: 'Booking Confirmations', endpoint: '/api/automations/bookings/confirm' },\r\n    { name: 'No-Show Detection', endpoint: '/api/automations/bookings/no-show' },\r\n    { name: 'Low Stock Alerts', endpoint: '/api/automations/low-stock-alerts' },\r\n    { name: 'Purchase Orders', endpoint: '/api/automations/purchase-orders' },\r\n    { name: 'Sales Report (Daily)', endpoint: '/api/automations/reports/sales?period=daily' },\r\n    { name: 'Transaction Receipts', endpoint: '/api/automations/transaction-receipts' },\r\n    { name: 'Discount Management', endpoint: '/api/automations/discounts/manage' },\r\n    { name: 'Attendance Violations', endpoint: '/api/automations/attendance/violations' },\r\n    { name: 'Break Detection', endpoint: '/api/automations/attendance/break-detection' },\r\n    { name: 'Auto Clock-Out', endpoint: '/api/automations/attendance/auto-clockout' },\r\n    { name: 'Cash Drawer Auto-Close', endpoint: '/api/automations/cash-drawer/auto-close' },\r\n    { name: 'Cash Count Reminders', endpoint: '/api/automations/cash-drawer/reminders' },\r\n    { name: 'Abandoned Cart Reminders', endpoint: '/api/automations/carts/abandoned' },\r\n    { name: 'Product Performance', endpoint: '/api/automations/products/performance' },\r\n    { name: 'Customer Lifetime Value', endpoint: '/api/automations/customers/lifetime-value' },\r\n    { name: 'Session Expiration', endpoint: '/api/automations/sessions/expire' },\r\n    { name: 'Stock Transfer', endpoint: '/api/automations/stock/transfer' },\r\n    { name: 'Predictive Stock', endpoint: '/api/automations/stock/predictive' },\r\n    { name: 'Dynamic Pricing', endpoint: '/api/automations/pricing/dynamic' },\r\n    { name: 'Data Archiving', endpoint: '/api/automations/data/archive' },\r\n    { name: 'Database Backups', endpoint: '/api/automations/backups/create' },\r\n    { name: 'Audit Log Cleanup', endpoint: '/api/automations/audit-logs/cleanup' },\r\n    { name: 'Multi-Branch Sync', endpoint: '/api/automations/sync/multi-branch' },\r\n    { name: 'Suspicious Activity', endpoint: '/api/automations/security/suspicious-activity' },\r\n    { name: 'Sales Trend Analysis (Daily)', endpoint: '/api/automations/analytics/sales-trends?period=daily' },\r\n    { name: 'Sales Trend Analysis (Weekly)', endpoint: '/api/automations/analytics/sales-trends?period=weekly' },\r\n  ];\r\n\r\n  const results: TestResult[] = [];\r\n\r\n  for (const test of tests) {\r\n    const result = await testAutomation(test.name, test.endpoint);\r\n    results.push(result);\r\n    \r\n    // Small delay between tests\r\n    await new Promise(resolve => setTimeout(resolve, 500));\r\n  }\r\n\r\n  // Summary\r\n  console.log('\\n\\n Test Summary');\r\n  console.log('=====================================');\r\n  \r\n  const passed = results.filter(r => r.success).length;\r\n  const failed = results.filter(r => !r.success).length;\r\n  \r\n  console.log(` Passed: ${passed}`);\r\n  console.log(` Failed: ${failed}`);\r\n  console.log(` Total: ${results.length}`);\r\n  \r\n  if (failed > 0) {\r\n    console.log('\\n Failed Tests:');\r\n    results.filter(r => !r.success).forEach(r => {\r\n      console.log(`   - ${r.name}: ${r.message}`);\r\n    });\r\n  }\r\n  \r\n  console.log('\\n Testing complete!');\r\n  \r\n  process.exit(failed > 0 ? 1 : 0);\r\n}\r\n\r\nmain().catch(error => {\r\n  console.error('Fatal error:', error);\r\n  process.exit(1);\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\scripts\\test-customer-auth.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":149,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":149,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4655,4658],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4655,4658],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Test script for customer authentication endpoints\r\n * \r\n * Usage:\r\n *   tsx scripts/test-customer-auth.ts\r\n * \r\n * Make sure your .env file has Twilio credentials configured\r\n */\r\n\r\nimport 'dotenv/config';\r\nimport readline from 'readline';\r\n\r\nconst API_BASE = process.env.NEXT_PUBLIC_API_URL || 'http://localhost:3000/api';\r\nconst TENANT_SLUG = 'default';\r\n\r\n// Test phone number (replace with your test number)\r\nconst TEST_PHONE = process.argv[2] || '+1234567890';\r\n\r\nasync function testCustomerAuth() {\r\n  console.log(' Testing Customer Authentication Flow\\n');\r\n  console.log(`API Base: ${API_BASE}`);\r\n  console.log(`Tenant: ${TENANT_SLUG}`);\r\n  console.log(`Test Phone: ${TEST_PHONE}\\n`);\r\n\r\n  try {\r\n    // Step 1: Send OTP\r\n    console.log(' Step 1: Sending OTP...');\r\n    const sendOTPResponse = await fetch(`${API_BASE}/auth/customer/send-otp`, {\r\n      method: 'POST',\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n      },\r\n      body: JSON.stringify({\r\n        phone: TEST_PHONE,\r\n        tenantSlug: TENANT_SLUG,\r\n      }),\r\n    });\r\n\r\n    const sendOTPData = await sendOTPResponse.json();\r\n    \r\n    if (!sendOTPData.success) {\r\n      console.error(' Failed to send OTP:', sendOTPData.error);\r\n      return;\r\n    }\r\n\r\n    console.log(' OTP sent successfully!');\r\n    \r\n    // In development, OTP is logged to console\r\n    // In production, check SMS\r\n    if (process.env.NODE_ENV !== 'production') {\r\n      console.log(' Check your backend console for the OTP code');\r\n    } else {\r\n      console.log(' Check your SMS for the OTP code');\r\n    }\r\n\r\n    // Wait for user to enter OTP\r\n    console.log('\\n Waiting for OTP...');\r\n    console.log('Enter the OTP code:');\r\n    \r\n    // For automated testing, you could read from stdin\r\n    // For now, we'll use a placeholder\r\n    const rl = readline.createInterface({\r\n      input: process.stdin,\r\n      output: process.stdout,\r\n    });\r\n\r\n    const otp = await new Promise<string>((resolve) => {\r\n      rl.question('OTP: ', (answer: string) => {\r\n        rl.close();\r\n        resolve(answer.trim());\r\n      });\r\n    });\r\n\r\n    if (!otp || otp.length !== 6) {\r\n      console.error(' Invalid OTP format');\r\n      return;\r\n    }\r\n\r\n    // Step 2: Verify OTP\r\n    console.log('\\n Step 2: Verifying OTP...');\r\n    const verifyOTPResponse = await fetch(`${API_BASE}/auth/customer/verify-otp`, {\r\n      method: 'POST',\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n      },\r\n      body: JSON.stringify({\r\n        phone: TEST_PHONE,\r\n        otp,\r\n        tenantSlug: TENANT_SLUG,\r\n        firstName: 'Test',\r\n        lastName: 'User',\r\n      }),\r\n    });\r\n\r\n    const verifyOTPData = await verifyOTPResponse.json();\r\n\r\n    if (!verifyOTPData.success) {\r\n      console.error(' Failed to verify OTP:', verifyOTPData.error);\r\n      return;\r\n    }\r\n\r\n    console.log(' OTP verified successfully!');\r\n    console.log(' Customer Data:', JSON.stringify(verifyOTPData.data.customer, null, 2));\r\n    console.log(' Token received:', verifyOTPData.data.token.substring(0, 20) + '...');\r\n\r\n    const token = verifyOTPData.data.token;\r\n    const customerId = verifyOTPData.data.customer._id;\r\n\r\n    // Step 3: Test authenticated endpoint - Get bookings\r\n    console.log('\\n Step 3: Testing authenticated endpoint (Get Bookings)...');\r\n    const bookingsResponse = await fetch(`${API_BASE}/bookings/customer/${customerId}`, {\r\n      method: 'GET',\r\n      headers: {\r\n        'Authorization': `Bearer ${token}`,\r\n        'Content-Type': 'application/json',\r\n      },\r\n    });\r\n\r\n    const bookingsData = await bookingsResponse.json();\r\n\r\n    if (!bookingsData.success) {\r\n      console.error(' Failed to get bookings:', bookingsData.error);\r\n    } else {\r\n      console.log(' Bookings retrieved successfully!');\r\n      console.log(' Bookings count:', bookingsData.data.length);\r\n    }\r\n\r\n    // Step 4: Test authenticated endpoint - Get orders\r\n    console.log('\\n Step 4: Testing authenticated endpoint (Get Orders)...');\r\n    const ordersResponse = await fetch(`${API_BASE}/transactions/customer/${customerId}`, {\r\n      method: 'GET',\r\n      headers: {\r\n        'Authorization': `Bearer ${token}`,\r\n        'Content-Type': 'application/json',\r\n      },\r\n    });\r\n\r\n    const ordersData = await ordersResponse.json();\r\n\r\n    if (!ordersData.success) {\r\n      console.error(' Failed to get orders:', ordersData.error);\r\n    } else {\r\n      console.log(' Orders retrieved successfully!');\r\n      console.log(' Orders count:', ordersData.data.length);\r\n    }\r\n\r\n    console.log('\\n All tests completed successfully!');\r\n\r\n  } catch (error: any) {\r\n    console.error(' Test failed:', error.message);\r\n    console.error(error.stack);\r\n  }\r\n}\r\n\r\n// Run tests\r\ntestCustomerAuth().catch(console.error);\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\types\\jsqr.d.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\corew\\localpro-pos\\types\\negotiator.d.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]
